function nI(d,s){for(var u=0;u<s.length;u++){const g=s[u];if(typeof g!="string"&&!Array.isArray(g)){for(const A in g)if(A!=="default"&&!(A in d)){const E=Object.getOwnPropertyDescriptor(g,A);E&&Object.defineProperty(d,A,E.get?E:{enumerable:!0,get:()=>g[A]})}}}return Object.freeze(Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}))}function g2(d,s){return function(){return d.apply(s,arguments)}}const{toString:rI}=Object.prototype,{getPrototypeOf:G_}=Object,Xg=(d=>s=>{const u=rI.call(s);return d[u]||(d[u]=u.slice(8,-1).toLowerCase())})(Object.create(null)),Wl=d=>(d=d.toLowerCase(),s=>Xg(s)===d),Yg=d=>s=>typeof s===d,{isArray:Hd}=Array,pp=Yg("undefined");function oI(d){return d!==null&&!pp(d)&&d.constructor!==null&&!pp(d.constructor)&&_l(d.constructor.isBuffer)&&d.constructor.isBuffer(d)}const _2=Wl("ArrayBuffer");function sI(d){let s;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?s=ArrayBuffer.isView(d):s=d&&d.buffer&&_2(d.buffer),s}const aI=Yg("string"),_l=Yg("function"),y2=Yg("number"),Kg=d=>d!==null&&typeof d=="object",lI=d=>d===!0||d===!1,Tg=d=>{if(Xg(d)!=="object")return!1;const s=G_(d);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Symbol.toStringTag in d)&&!(Symbol.iterator in d)},cI=Wl("Date"),uI=Wl("File"),hI=Wl("Blob"),dI=Wl("FileList"),fI=d=>Kg(d)&&_l(d.pipe),pI=d=>{let s;return d&&(typeof FormData=="function"&&d instanceof FormData||_l(d.append)&&((s=Xg(d))==="formdata"||s==="object"&&_l(d.toString)&&d.toString()==="[object FormData]"))},mI=Wl("URLSearchParams"),[gI,_I,yI,vI]=["ReadableStream","Request","Response","Headers"].map(Wl),xI=d=>d.trim?d.trim():d.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function vp(d,s,{allOwnKeys:u=!1}={}){if(d===null||typeof d>"u")return;let g,A;if(typeof d!="object"&&(d=[d]),Hd(d))for(g=0,A=d.length;g<A;g++)s.call(null,d[g],g,d);else{const E=u?Object.getOwnPropertyNames(d):Object.keys(d),O=E.length;let r;for(g=0;g<O;g++)r=E[g],s.call(null,d[r],r,d)}}function v2(d,s){s=s.toLowerCase();const u=Object.keys(d);let g=u.length,A;for(;g-- >0;)if(A=u[g],s===A.toLowerCase())return A;return null}const x2=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),w2=d=>!pp(d)&&d!==x2;function C_(){const{caseless:d}=w2(this)&&this||{},s={},u=(g,A)=>{const E=d&&v2(s,A)||A;Tg(s[E])&&Tg(g)?s[E]=C_(s[E],g):Tg(g)?s[E]=C_({},g):Hd(g)?s[E]=g.slice():s[E]=g};for(let g=0,A=arguments.length;g<A;g++)arguments[g]&&vp(arguments[g],u);return s}const wI=(d,s,u,{allOwnKeys:g}={})=>(vp(s,(A,E)=>{u&&_l(A)?d[E]=g2(A,u):d[E]=A},{allOwnKeys:g}),d),bI=d=>(d.charCodeAt(0)===65279&&(d=d.slice(1)),d),CI=(d,s,u,g)=>{d.prototype=Object.create(s.prototype,g),d.prototype.constructor=d,Object.defineProperty(d,"super",{value:s.prototype}),u&&Object.assign(d.prototype,u)},EI=(d,s,u,g)=>{let A,E,O;const r={};if(s=s||{},d==null)return s;do{for(A=Object.getOwnPropertyNames(d),E=A.length;E-- >0;)O=A[E],(!g||g(O,d,s))&&!r[O]&&(s[O]=d[O],r[O]=!0);d=u!==!1&&G_(d)}while(d&&(!u||u(d,s))&&d!==Object.prototype);return s},TI=(d,s,u)=>{d=String(d),(u===void 0||u>d.length)&&(u=d.length),u-=s.length;const g=d.indexOf(s,u);return g!==-1&&g===u},SI=d=>{if(!d)return null;if(Hd(d))return d;let s=d.length;if(!y2(s))return null;const u=new Array(s);for(;s-- >0;)u[s]=d[s];return u},AI=(d=>s=>d&&s instanceof d)(typeof Uint8Array<"u"&&G_(Uint8Array)),II=(d,s)=>{const g=(d&&d[Symbol.iterator]).call(d);let A;for(;(A=g.next())&&!A.done;){const E=A.value;s.call(d,E[0],E[1])}},MI=(d,s)=>{let u;const g=[];for(;(u=d.exec(s))!==null;)g.push(u);return g},LI=Wl("HTMLFormElement"),OI=d=>d.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(u,g,A){return g.toUpperCase()+A}),Xw=(({hasOwnProperty:d})=>(s,u)=>d.call(s,u))(Object.prototype),PI=Wl("RegExp"),b2=(d,s)=>{const u=Object.getOwnPropertyDescriptors(d),g={};vp(u,(A,E)=>{let O;(O=s(A,E,d))!==!1&&(g[E]=O||A)}),Object.defineProperties(d,g)},DI=d=>{b2(d,(s,u)=>{if(_l(d)&&["arguments","caller","callee"].indexOf(u)!==-1)return!1;const g=d[u];if(_l(g)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+u+"'")})}})},RI=(d,s)=>{const u={},g=A=>{A.forEach(E=>{u[E]=!0})};return Hd(d)?g(d):g(String(d).split(s)),u},kI=()=>{},BI=(d,s)=>d!=null&&Number.isFinite(d=+d)?d:s,t_="abcdefghijklmnopqrstuvwxyz",Yw="0123456789",C2={DIGIT:Yw,ALPHA:t_,ALPHA_DIGIT:t_+t_.toUpperCase()+Yw},NI=(d=16,s=C2.ALPHA_DIGIT)=>{let u="";const{length:g}=s;for(;d--;)u+=s[Math.random()*g|0];return u};function FI(d){return!!(d&&_l(d.append)&&d[Symbol.toStringTag]==="FormData"&&d[Symbol.iterator])}const zI=d=>{const s=new Array(10),u=(g,A)=>{if(Kg(g)){if(s.indexOf(g)>=0)return;if(!("toJSON"in g)){s[A]=g;const E=Hd(g)?[]:{};return vp(g,(O,r)=>{const U=u(O,A+1);!pp(U)&&(E[r]=U)}),s[A]=void 0,E}}return g};return u(d,0)},VI=Wl("AsyncFunction"),UI=d=>d&&(Kg(d)||_l(d))&&_l(d.then)&&_l(d.catch),Xt={isArray:Hd,isArrayBuffer:_2,isBuffer:oI,isFormData:pI,isArrayBufferView:sI,isString:aI,isNumber:y2,isBoolean:lI,isObject:Kg,isPlainObject:Tg,isReadableStream:gI,isRequest:_I,isResponse:yI,isHeaders:vI,isUndefined:pp,isDate:cI,isFile:uI,isBlob:hI,isRegExp:PI,isFunction:_l,isStream:fI,isURLSearchParams:mI,isTypedArray:AI,isFileList:dI,forEach:vp,merge:C_,extend:wI,trim:xI,stripBOM:bI,inherits:CI,toFlatObject:EI,kindOf:Xg,kindOfTest:Wl,endsWith:TI,toArray:SI,forEachEntry:II,matchAll:MI,isHTMLForm:LI,hasOwnProperty:Xw,hasOwnProp:Xw,reduceDescriptors:b2,freezeMethods:DI,toObjectSet:RI,toCamelCase:OI,noop:kI,toFiniteNumber:BI,findKey:v2,global:x2,isContextDefined:w2,ALPHABET:C2,generateString:NI,isSpecCompliantForm:FI,toJSONObject:zI,isAsyncFn:VI,isThenable:UI};function Jn(d,s,u,g,A){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=d,this.name="AxiosError",s&&(this.code=s),u&&(this.config=u),g&&(this.request=g),A&&(this.response=A)}Xt.inherits(Jn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Xt.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const E2=Jn.prototype,T2={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(d=>{T2[d]={value:d}});Object.defineProperties(Jn,T2);Object.defineProperty(E2,"isAxiosError",{value:!0});Jn.from=(d,s,u,g,A,E)=>{const O=Object.create(E2);return Xt.toFlatObject(d,O,function(U){return U!==Error.prototype},r=>r!=="isAxiosError"),Jn.call(O,d.message,s,u,g,A),O.cause=d,O.name=d.name,E&&Object.assign(O,E),O};const jI=null;function E_(d){return Xt.isPlainObject(d)||Xt.isArray(d)}function S2(d){return Xt.endsWith(d,"[]")?d.slice(0,-2):d}function Kw(d,s,u){return d?d.concat(s).map(function(A,E){return A=S2(A),!u&&E?"["+A+"]":A}).join(u?".":""):s}function qI(d){return Xt.isArray(d)&&!d.some(E_)}const HI=Xt.toFlatObject(Xt,{},null,function(s){return/^is[A-Z]/.test(s)});function Qg(d,s,u){if(!Xt.isObject(d))throw new TypeError("target must be an object");s=s||new FormData,u=Xt.toFlatObject(u,{metaTokens:!0,dots:!1,indexes:!1},!1,function(K,N){return!Xt.isUndefined(N[K])});const g=u.metaTokens,A=u.visitor||Y,E=u.dots,O=u.indexes,U=(u.Blob||typeof Blob<"u"&&Blob)&&Xt.isSpecCompliantForm(s);if(!Xt.isFunction(A))throw new TypeError("visitor must be a function");function W(he){if(he===null)return"";if(Xt.isDate(he))return he.toISOString();if(!U&&Xt.isBlob(he))throw new Jn("Blob is not supported. Use a Buffer instead.");return Xt.isArrayBuffer(he)||Xt.isTypedArray(he)?U&&typeof Blob=="function"?new Blob([he]):Buffer.from(he):he}function Y(he,K,N){let z=he;if(he&&!N&&typeof he=="object"){if(Xt.endsWith(K,"{}"))K=g?K:K.slice(0,-2),he=JSON.stringify(he);else if(Xt.isArray(he)&&qI(he)||(Xt.isFileList(he)||Xt.endsWith(K,"[]"))&&(z=Xt.toArray(he)))return K=S2(K),z.forEach(function(G,Q){!(Xt.isUndefined(G)||G===null)&&s.append(O===!0?Kw([K],Q,E):O===null?K:K+"[]",W(G))}),!1}return E_(he)?!0:(s.append(Kw(N,K,E),W(he)),!1)}const se=[],Ae=Object.assign(HI,{defaultVisitor:Y,convertValue:W,isVisitable:E_});function Ce(he,K){if(!Xt.isUndefined(he)){if(se.indexOf(he)!==-1)throw Error("Circular reference detected in "+K.join("."));se.push(he),Xt.forEach(he,function(z,q){(!(Xt.isUndefined(z)||z===null)&&A.call(s,z,Xt.isString(q)?q.trim():q,K,Ae))===!0&&Ce(z,K?K.concat(q):[q])}),se.pop()}}if(!Xt.isObject(d))throw new TypeError("data must be an object");return Ce(d),s}function Qw(d){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(d).replace(/[!'()~]|%20|%00/g,function(g){return s[g]})}function W_(d,s){this._pairs=[],d&&Qg(d,this,s)}const A2=W_.prototype;A2.append=function(s,u){this._pairs.push([s,u])};A2.toString=function(s){const u=s?function(g){return s.call(this,g,Qw)}:Qw;return this._pairs.map(function(A){return u(A[0])+"="+u(A[1])},"").join("&")};function GI(d){return encodeURIComponent(d).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function I2(d,s,u){if(!s)return d;const g=u&&u.encode||GI,A=u&&u.serialize;let E;if(A?E=A(s,u):E=Xt.isURLSearchParams(s)?s.toString():new W_(s,u).toString(g),E){const O=d.indexOf("#");O!==-1&&(d=d.slice(0,O)),d+=(d.indexOf("?")===-1?"?":"&")+E}return d}class WI{constructor(){this.handlers=[]}use(s,u,g){return this.handlers.push({fulfilled:s,rejected:u,synchronous:g?g.synchronous:!1,runWhen:g?g.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){Xt.forEach(this.handlers,function(g){g!==null&&s(g)})}}const Jw=WI,M2={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},$I=typeof URLSearchParams<"u"?URLSearchParams:W_,ZI=typeof FormData<"u"?FormData:null,XI=typeof Blob<"u"?Blob:null,YI={isBrowser:!0,classes:{URLSearchParams:$I,FormData:ZI,Blob:XI},protocols:["http","https","file","blob","url","data"]},$_=typeof window<"u"&&typeof document<"u",KI=(d=>$_&&["ReactNative","NativeScript","NS"].indexOf(d)<0)(typeof navigator<"u"&&navigator.product),QI=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),JI=$_&&window.location.href||"http://localhost",e3=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:$_,hasStandardBrowserEnv:KI,hasStandardBrowserWebWorkerEnv:QI,origin:JI},Symbol.toStringTag,{value:"Module"})),Hl={...e3,...YI};function t3(d,s){return Qg(d,new Hl.classes.URLSearchParams,Object.assign({visitor:function(u,g,A,E){return Hl.isNode&&Xt.isBuffer(u)?(this.append(g,u.toString("base64")),!1):E.defaultVisitor.apply(this,arguments)}},s))}function i3(d){return Xt.matchAll(/\w+|\[(\w*)]/g,d).map(s=>s[0]==="[]"?"":s[1]||s[0])}function n3(d){const s={},u=Object.keys(d);let g;const A=u.length;let E;for(g=0;g<A;g++)E=u[g],s[E]=d[E];return s}function L2(d){function s(u,g,A,E){let O=u[E++];if(O==="__proto__")return!0;const r=Number.isFinite(+O),U=E>=u.length;return O=!O&&Xt.isArray(A)?A.length:O,U?(Xt.hasOwnProp(A,O)?A[O]=[A[O],g]:A[O]=g,!r):((!A[O]||!Xt.isObject(A[O]))&&(A[O]=[]),s(u,g,A[O],E)&&Xt.isArray(A[O])&&(A[O]=n3(A[O])),!r)}if(Xt.isFormData(d)&&Xt.isFunction(d.entries)){const u={};return Xt.forEachEntry(d,(g,A)=>{s(i3(g),A,u,0)}),u}return null}function r3(d,s,u){if(Xt.isString(d))try{return(s||JSON.parse)(d),Xt.trim(d)}catch(g){if(g.name!=="SyntaxError")throw g}return(u||JSON.stringify)(d)}const Z_={transitional:M2,adapter:["xhr","http","fetch"],transformRequest:[function(s,u){const g=u.getContentType()||"",A=g.indexOf("application/json")>-1,E=Xt.isObject(s);if(E&&Xt.isHTMLForm(s)&&(s=new FormData(s)),Xt.isFormData(s))return A?JSON.stringify(L2(s)):s;if(Xt.isArrayBuffer(s)||Xt.isBuffer(s)||Xt.isStream(s)||Xt.isFile(s)||Xt.isBlob(s)||Xt.isReadableStream(s))return s;if(Xt.isArrayBufferView(s))return s.buffer;if(Xt.isURLSearchParams(s))return u.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let r;if(E){if(g.indexOf("application/x-www-form-urlencoded")>-1)return t3(s,this.formSerializer).toString();if((r=Xt.isFileList(s))||g.indexOf("multipart/form-data")>-1){const U=this.env&&this.env.FormData;return Qg(r?{"files[]":s}:s,U&&new U,this.formSerializer)}}return E||A?(u.setContentType("application/json",!1),r3(s)):s}],transformResponse:[function(s){const u=this.transitional||Z_.transitional,g=u&&u.forcedJSONParsing,A=this.responseType==="json";if(Xt.isResponse(s)||Xt.isReadableStream(s))return s;if(s&&Xt.isString(s)&&(g&&!this.responseType||A)){const O=!(u&&u.silentJSONParsing)&&A;try{return JSON.parse(s)}catch(r){if(O)throw r.name==="SyntaxError"?Jn.from(r,Jn.ERR_BAD_RESPONSE,this,null,this.response):r}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Hl.classes.FormData,Blob:Hl.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Xt.forEach(["delete","get","head","post","put","patch"],d=>{Z_.headers[d]={}});const X_=Z_,o3=Xt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),s3=d=>{const s={};let u,g,A;return d&&d.split(`
`).forEach(function(O){A=O.indexOf(":"),u=O.substring(0,A).trim().toLowerCase(),g=O.substring(A+1).trim(),!(!u||s[u]&&o3[u])&&(u==="set-cookie"?s[u]?s[u].push(g):s[u]=[g]:s[u]=s[u]?s[u]+", "+g:g)}),s},eb=Symbol("internals");function cp(d){return d&&String(d).trim().toLowerCase()}function Sg(d){return d===!1||d==null?d:Xt.isArray(d)?d.map(Sg):String(d)}function a3(d){const s=Object.create(null),u=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let g;for(;g=u.exec(d);)s[g[1]]=g[2];return s}const l3=d=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(d.trim());function i_(d,s,u,g,A){if(Xt.isFunction(g))return g.call(this,s,u);if(A&&(s=u),!!Xt.isString(s)){if(Xt.isString(g))return s.indexOf(g)!==-1;if(Xt.isRegExp(g))return g.test(s)}}function c3(d){return d.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,u,g)=>u.toUpperCase()+g)}function u3(d,s){const u=Xt.toCamelCase(" "+s);["get","set","has"].forEach(g=>{Object.defineProperty(d,g+u,{value:function(A,E,O){return this[g].call(this,s,A,E,O)},configurable:!0})})}class Jg{constructor(s){s&&this.set(s)}set(s,u,g){const A=this;function E(r,U,W){const Y=cp(U);if(!Y)throw new Error("header name must be a non-empty string");const se=Xt.findKey(A,Y);(!se||A[se]===void 0||W===!0||W===void 0&&A[se]!==!1)&&(A[se||U]=Sg(r))}const O=(r,U)=>Xt.forEach(r,(W,Y)=>E(W,Y,U));if(Xt.isPlainObject(s)||s instanceof this.constructor)O(s,u);else if(Xt.isString(s)&&(s=s.trim())&&!l3(s))O(s3(s),u);else if(Xt.isHeaders(s))for(const[r,U]of s.entries())E(U,r,g);else s!=null&&E(u,s,g);return this}get(s,u){if(s=cp(s),s){const g=Xt.findKey(this,s);if(g){const A=this[g];if(!u)return A;if(u===!0)return a3(A);if(Xt.isFunction(u))return u.call(this,A,g);if(Xt.isRegExp(u))return u.exec(A);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,u){if(s=cp(s),s){const g=Xt.findKey(this,s);return!!(g&&this[g]!==void 0&&(!u||i_(this,this[g],g,u)))}return!1}delete(s,u){const g=this;let A=!1;function E(O){if(O=cp(O),O){const r=Xt.findKey(g,O);r&&(!u||i_(g,g[r],r,u))&&(delete g[r],A=!0)}}return Xt.isArray(s)?s.forEach(E):E(s),A}clear(s){const u=Object.keys(this);let g=u.length,A=!1;for(;g--;){const E=u[g];(!s||i_(this,this[E],E,s,!0))&&(delete this[E],A=!0)}return A}normalize(s){const u=this,g={};return Xt.forEach(this,(A,E)=>{const O=Xt.findKey(g,E);if(O){u[O]=Sg(A),delete u[E];return}const r=s?c3(E):String(E).trim();r!==E&&delete u[E],u[r]=Sg(A),g[r]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const u=Object.create(null);return Xt.forEach(this,(g,A)=>{g!=null&&g!==!1&&(u[A]=s&&Xt.isArray(g)?g.join(", "):g)}),u}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,u])=>s+": "+u).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...u){const g=new this(s);return u.forEach(A=>g.set(A)),g}static accessor(s){const g=(this[eb]=this[eb]={accessors:{}}).accessors,A=this.prototype;function E(O){const r=cp(O);g[r]||(u3(A,O),g[r]=!0)}return Xt.isArray(s)?s.forEach(E):E(s),this}}Jg.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Xt.reduceDescriptors(Jg.prototype,({value:d},s)=>{let u=s[0].toUpperCase()+s.slice(1);return{get:()=>d,set(g){this[u]=g}}});Xt.freezeMethods(Jg);const Gl=Jg;function n_(d,s){const u=this||X_,g=s||u,A=Gl.from(g.headers);let E=g.data;return Xt.forEach(d,function(r){E=r.call(u,E,A.normalize(),s?s.status:void 0)}),A.normalize(),E}function O2(d){return!!(d&&d.__CANCEL__)}function Gd(d,s,u){Jn.call(this,d??"canceled",Jn.ERR_CANCELED,s,u),this.name="CanceledError"}Xt.inherits(Gd,Jn,{__CANCEL__:!0});function P2(d,s,u){const g=u.config.validateStatus;!u.status||!g||g(u.status)?d(u):s(new Jn("Request failed with status code "+u.status,[Jn.ERR_BAD_REQUEST,Jn.ERR_BAD_RESPONSE][Math.floor(u.status/100)-4],u.config,u.request,u))}function h3(d){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(d);return s&&s[1]||""}function d3(d,s){d=d||10;const u=new Array(d),g=new Array(d);let A=0,E=0,O;return s=s!==void 0?s:1e3,function(U){const W=Date.now(),Y=g[E];O||(O=W),u[A]=U,g[A]=W;let se=E,Ae=0;for(;se!==A;)Ae+=u[se++],se=se%d;if(A=(A+1)%d,A===E&&(E=(E+1)%d),W-O<s)return;const Ce=Y&&W-Y;return Ce?Math.round(Ae*1e3/Ce):void 0}}function f3(d,s){let u=0;const g=1e3/s;let A=null;return function(){const O=this===!0,r=Date.now();if(O||r-u>g)return A&&(clearTimeout(A),A=null),u=r,d.apply(null,arguments);A||(A=setTimeout(()=>(A=null,u=Date.now(),d.apply(null,arguments)),g-(r-u)))}}const Rg=(d,s,u=3)=>{let g=0;const A=d3(50,250);return f3(E=>{const O=E.loaded,r=E.lengthComputable?E.total:void 0,U=O-g,W=A(U),Y=O<=r;g=O;const se={loaded:O,total:r,progress:r?O/r:void 0,bytes:U,rate:W||void 0,estimated:W&&r&&Y?(r-O)/W:void 0,event:E,lengthComputable:r!=null};se[s?"download":"upload"]=!0,d(se)},u)},p3=Hl.hasStandardBrowserEnv?function(){const s=/(msie|trident)/i.test(navigator.userAgent),u=document.createElement("a");let g;function A(E){let O=E;return s&&(u.setAttribute("href",O),O=u.href),u.setAttribute("href",O),{href:u.href,protocol:u.protocol?u.protocol.replace(/:$/,""):"",host:u.host,search:u.search?u.search.replace(/^\?/,""):"",hash:u.hash?u.hash.replace(/^#/,""):"",hostname:u.hostname,port:u.port,pathname:u.pathname.charAt(0)==="/"?u.pathname:"/"+u.pathname}}return g=A(window.location.href),function(O){const r=Xt.isString(O)?A(O):O;return r.protocol===g.protocol&&r.host===g.host}}():function(){return function(){return!0}}(),m3=Hl.hasStandardBrowserEnv?{write(d,s,u,g,A,E){const O=[d+"="+encodeURIComponent(s)];Xt.isNumber(u)&&O.push("expires="+new Date(u).toGMTString()),Xt.isString(g)&&O.push("path="+g),Xt.isString(A)&&O.push("domain="+A),E===!0&&O.push("secure"),document.cookie=O.join("; ")},read(d){const s=document.cookie.match(new RegExp("(^|;\\s*)("+d+")=([^;]*)"));return s?decodeURIComponent(s[3]):null},remove(d){this.write(d,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function g3(d){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(d)}function _3(d,s){return s?d.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):d}function D2(d,s){return d&&!g3(s)?_3(d,s):s}const tb=d=>d instanceof Gl?{...d}:d;function Rh(d,s){s=s||{};const u={};function g(W,Y,se){return Xt.isPlainObject(W)&&Xt.isPlainObject(Y)?Xt.merge.call({caseless:se},W,Y):Xt.isPlainObject(Y)?Xt.merge({},Y):Xt.isArray(Y)?Y.slice():Y}function A(W,Y,se){if(Xt.isUndefined(Y)){if(!Xt.isUndefined(W))return g(void 0,W,se)}else return g(W,Y,se)}function E(W,Y){if(!Xt.isUndefined(Y))return g(void 0,Y)}function O(W,Y){if(Xt.isUndefined(Y)){if(!Xt.isUndefined(W))return g(void 0,W)}else return g(void 0,Y)}function r(W,Y,se){if(se in s)return g(W,Y);if(se in d)return g(void 0,W)}const U={url:E,method:E,data:E,baseURL:O,transformRequest:O,transformResponse:O,paramsSerializer:O,timeout:O,timeoutMessage:O,withCredentials:O,withXSRFToken:O,adapter:O,responseType:O,xsrfCookieName:O,xsrfHeaderName:O,onUploadProgress:O,onDownloadProgress:O,decompress:O,maxContentLength:O,maxBodyLength:O,beforeRedirect:O,transport:O,httpAgent:O,httpsAgent:O,cancelToken:O,socketPath:O,responseEncoding:O,validateStatus:r,headers:(W,Y)=>A(tb(W),tb(Y),!0)};return Xt.forEach(Object.keys(Object.assign({},d,s)),function(Y){const se=U[Y]||A,Ae=se(d[Y],s[Y],Y);Xt.isUndefined(Ae)&&se!==r||(u[Y]=Ae)}),u}const R2=d=>{const s=Rh({},d);let{data:u,withXSRFToken:g,xsrfHeaderName:A,xsrfCookieName:E,headers:O,auth:r}=s;s.headers=O=Gl.from(O),s.url=I2(D2(s.baseURL,s.url),d.params,d.paramsSerializer),r&&O.set("Authorization","Basic "+btoa((r.username||"")+":"+(r.password?unescape(encodeURIComponent(r.password)):"")));let U;if(Xt.isFormData(u)){if(Hl.hasStandardBrowserEnv||Hl.hasStandardBrowserWebWorkerEnv)O.setContentType(void 0);else if((U=O.getContentType())!==!1){const[W,...Y]=U?U.split(";").map(se=>se.trim()).filter(Boolean):[];O.setContentType([W||"multipart/form-data",...Y].join("; "))}}if(Hl.hasStandardBrowserEnv&&(g&&Xt.isFunction(g)&&(g=g(s)),g||g!==!1&&p3(s.url))){const W=A&&E&&m3.read(E);W&&O.set(A,W)}return s},y3=typeof XMLHttpRequest<"u",v3=y3&&function(d){return new Promise(function(u,g){const A=R2(d);let E=A.data;const O=Gl.from(A.headers).normalize();let{responseType:r}=A,U;function W(){A.cancelToken&&A.cancelToken.unsubscribe(U),A.signal&&A.signal.removeEventListener("abort",U)}let Y=new XMLHttpRequest;Y.open(A.method.toUpperCase(),A.url,!0),Y.timeout=A.timeout;function se(){if(!Y)return;const Ce=Gl.from("getAllResponseHeaders"in Y&&Y.getAllResponseHeaders()),K={data:!r||r==="text"||r==="json"?Y.responseText:Y.response,status:Y.status,statusText:Y.statusText,headers:Ce,config:d,request:Y};P2(function(z){u(z),W()},function(z){g(z),W()},K),Y=null}"onloadend"in Y?Y.onloadend=se:Y.onreadystatechange=function(){!Y||Y.readyState!==4||Y.status===0&&!(Y.responseURL&&Y.responseURL.indexOf("file:")===0)||setTimeout(se)},Y.onabort=function(){Y&&(g(new Jn("Request aborted",Jn.ECONNABORTED,A,Y)),Y=null)},Y.onerror=function(){g(new Jn("Network Error",Jn.ERR_NETWORK,A,Y)),Y=null},Y.ontimeout=function(){let he=A.timeout?"timeout of "+A.timeout+"ms exceeded":"timeout exceeded";const K=A.transitional||M2;A.timeoutErrorMessage&&(he=A.timeoutErrorMessage),g(new Jn(he,K.clarifyTimeoutError?Jn.ETIMEDOUT:Jn.ECONNABORTED,A,Y)),Y=null},E===void 0&&O.setContentType(null),"setRequestHeader"in Y&&Xt.forEach(O.toJSON(),function(he,K){Y.setRequestHeader(K,he)}),Xt.isUndefined(A.withCredentials)||(Y.withCredentials=!!A.withCredentials),r&&r!=="json"&&(Y.responseType=A.responseType),typeof A.onDownloadProgress=="function"&&Y.addEventListener("progress",Rg(A.onDownloadProgress,!0)),typeof A.onUploadProgress=="function"&&Y.upload&&Y.upload.addEventListener("progress",Rg(A.onUploadProgress)),(A.cancelToken||A.signal)&&(U=Ce=>{Y&&(g(!Ce||Ce.type?new Gd(null,d,Y):Ce),Y.abort(),Y=null)},A.cancelToken&&A.cancelToken.subscribe(U),A.signal&&(A.signal.aborted?U():A.signal.addEventListener("abort",U)));const Ae=h3(A.url);if(Ae&&Hl.protocols.indexOf(Ae)===-1){g(new Jn("Unsupported protocol "+Ae+":",Jn.ERR_BAD_REQUEST,d));return}Y.send(E||null)})},x3=(d,s)=>{let u=new AbortController,g;const A=function(U){if(!g){g=!0,O();const W=U instanceof Error?U:this.reason;u.abort(W instanceof Jn?W:new Gd(W instanceof Error?W.message:W))}};let E=s&&setTimeout(()=>{A(new Jn(`timeout ${s} of ms exceeded`,Jn.ETIMEDOUT))},s);const O=()=>{d&&(E&&clearTimeout(E),E=null,d.forEach(U=>{U&&(U.removeEventListener?U.removeEventListener("abort",A):U.unsubscribe(A))}),d=null)};d.forEach(U=>U&&U.addEventListener&&U.addEventListener("abort",A));const{signal:r}=u;return r.unsubscribe=O,[r,()=>{E&&clearTimeout(E),E=null}]},w3=x3,b3=function*(d,s){let u=d.byteLength;if(!s||u<s){yield d;return}let g=0,A;for(;g<u;)A=g+s,yield d.slice(g,A),g=A},C3=async function*(d,s,u){for await(const g of d)yield*b3(ArrayBuffer.isView(g)?g:await u(String(g)),s)},ib=(d,s,u,g,A)=>{const E=C3(d,s,A);let O=0;return new ReadableStream({type:"bytes",async pull(r){const{done:U,value:W}=await E.next();if(U){r.close(),g();return}let Y=W.byteLength;u&&u(O+=Y),r.enqueue(new Uint8Array(W))},cancel(r){return g(r),E.return()}},{highWaterMark:2})},nb=(d,s)=>{const u=d!=null;return g=>setTimeout(()=>s({lengthComputable:u,total:d,loaded:g}))},e0=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",k2=e0&&typeof ReadableStream=="function",T_=e0&&(typeof TextEncoder=="function"?(d=>s=>d.encode(s))(new TextEncoder):async d=>new Uint8Array(await new Response(d).arrayBuffer())),E3=k2&&(()=>{let d=!1;const s=new Request(Hl.origin,{body:new ReadableStream,method:"POST",get duplex(){return d=!0,"half"}}).headers.has("Content-Type");return d&&!s})(),rb=64*1024,S_=k2&&!!(()=>{try{return Xt.isReadableStream(new Response("").body)}catch{}})(),kg={stream:S_&&(d=>d.body)};e0&&(d=>{["text","arrayBuffer","blob","formData","stream"].forEach(s=>{!kg[s]&&(kg[s]=Xt.isFunction(d[s])?u=>u[s]():(u,g)=>{throw new Jn(`Response type '${s}' is not supported`,Jn.ERR_NOT_SUPPORT,g)})})})(new Response);const T3=async d=>{if(d==null)return 0;if(Xt.isBlob(d))return d.size;if(Xt.isSpecCompliantForm(d))return(await new Request(d).arrayBuffer()).byteLength;if(Xt.isArrayBufferView(d))return d.byteLength;if(Xt.isURLSearchParams(d)&&(d=d+""),Xt.isString(d))return(await T_(d)).byteLength},S3=async(d,s)=>{const u=Xt.toFiniteNumber(d.getContentLength());return u??T3(s)},A3=e0&&(async d=>{let{url:s,method:u,data:g,signal:A,cancelToken:E,timeout:O,onDownloadProgress:r,onUploadProgress:U,responseType:W,headers:Y,withCredentials:se="same-origin",fetchOptions:Ae}=R2(d);W=W?(W+"").toLowerCase():"text";let[Ce,he]=A||E||O?w3([A,E],O):[],K,N;const z=()=>{!K&&setTimeout(()=>{Ce&&Ce.unsubscribe()}),K=!0};let q;try{if(U&&E3&&u!=="get"&&u!=="head"&&(q=await S3(Y,g))!==0){let fe=new Request(s,{method:"POST",body:g,duplex:"half"}),ce;Xt.isFormData(g)&&(ce=fe.headers.get("content-type"))&&Y.setContentType(ce),fe.body&&(g=ib(fe.body,rb,nb(q,Rg(U)),null,T_))}Xt.isString(se)||(se=se?"cors":"omit"),N=new Request(s,{...Ae,signal:Ce,method:u.toUpperCase(),headers:Y.normalize().toJSON(),body:g,duplex:"half",withCredentials:se});let G=await fetch(N);const Q=S_&&(W==="stream"||W==="response");if(S_&&(r||Q)){const fe={};["status","statusText","headers"].forEach(Ue=>{fe[Ue]=G[Ue]});const ce=Xt.toFiniteNumber(G.headers.get("content-length"));G=new Response(ib(G.body,rb,r&&nb(ce,Rg(r,!0)),Q&&z,T_),fe)}W=W||"text";let ee=await kg[Xt.findKey(kg,W)||"text"](G,d);return!Q&&z(),he&&he(),await new Promise((fe,ce)=>{P2(fe,ce,{data:ee,headers:Gl.from(G.headers),status:G.status,statusText:G.statusText,config:d,request:N})})}catch(G){throw z(),G&&G.name==="TypeError"&&/fetch/i.test(G.message)?Object.assign(new Jn("Network Error",Jn.ERR_NETWORK,d,N),{cause:G.cause||G}):Jn.from(G,G&&G.code,d,N)}}),A_={http:jI,xhr:v3,fetch:A3};Xt.forEach(A_,(d,s)=>{if(d){try{Object.defineProperty(d,"name",{value:s})}catch{}Object.defineProperty(d,"adapterName",{value:s})}});const ob=d=>`- ${d}`,I3=d=>Xt.isFunction(d)||d===null||d===!1,B2={getAdapter:d=>{d=Xt.isArray(d)?d:[d];const{length:s}=d;let u,g;const A={};for(let E=0;E<s;E++){u=d[E];let O;if(g=u,!I3(u)&&(g=A_[(O=String(u)).toLowerCase()],g===void 0))throw new Jn(`Unknown adapter '${O}'`);if(g)break;A[O||"#"+E]=g}if(!g){const E=Object.entries(A).map(([r,U])=>`adapter ${r} `+(U===!1?"is not supported by the environment":"is not available in the build"));let O=s?E.length>1?`since :
`+E.map(ob).join(`
`):" "+ob(E[0]):"as no adapter specified";throw new Jn("There is no suitable adapter to dispatch the request "+O,"ERR_NOT_SUPPORT")}return g},adapters:A_};function r_(d){if(d.cancelToken&&d.cancelToken.throwIfRequested(),d.signal&&d.signal.aborted)throw new Gd(null,d)}function sb(d){return r_(d),d.headers=Gl.from(d.headers),d.data=n_.call(d,d.transformRequest),["post","put","patch"].indexOf(d.method)!==-1&&d.headers.setContentType("application/x-www-form-urlencoded",!1),B2.getAdapter(d.adapter||X_.adapter)(d).then(function(g){return r_(d),g.data=n_.call(d,d.transformResponse,g),g.headers=Gl.from(g.headers),g},function(g){return O2(g)||(r_(d),g&&g.response&&(g.response.data=n_.call(d,d.transformResponse,g.response),g.response.headers=Gl.from(g.response.headers))),Promise.reject(g)})}const N2="1.7.2",Y_={};["object","boolean","number","function","string","symbol"].forEach((d,s)=>{Y_[d]=function(g){return typeof g===d||"a"+(s<1?"n ":" ")+d}});const ab={};Y_.transitional=function(s,u,g){function A(E,O){return"[Axios v"+N2+"] Transitional option '"+E+"'"+O+(g?". "+g:"")}return(E,O,r)=>{if(s===!1)throw new Jn(A(O," has been removed"+(u?" in "+u:"")),Jn.ERR_DEPRECATED);return u&&!ab[O]&&(ab[O]=!0,console.warn(A(O," has been deprecated since v"+u+" and will be removed in the near future"))),s?s(E,O,r):!0}};function M3(d,s,u){if(typeof d!="object")throw new Jn("options must be an object",Jn.ERR_BAD_OPTION_VALUE);const g=Object.keys(d);let A=g.length;for(;A-- >0;){const E=g[A],O=s[E];if(O){const r=d[E],U=r===void 0||O(r,E,d);if(U!==!0)throw new Jn("option "+E+" must be "+U,Jn.ERR_BAD_OPTION_VALUE);continue}if(u!==!0)throw new Jn("Unknown option "+E,Jn.ERR_BAD_OPTION)}}const I_={assertOptions:M3,validators:Y_},ju=I_.validators;class Bg{constructor(s){this.defaults=s,this.interceptors={request:new Jw,response:new Jw}}async request(s,u){try{return await this._request(s,u)}catch(g){if(g instanceof Error){let A;Error.captureStackTrace?Error.captureStackTrace(A={}):A=new Error;const E=A.stack?A.stack.replace(/^.+\n/,""):"";try{g.stack?E&&!String(g.stack).endsWith(E.replace(/^.+\n.+\n/,""))&&(g.stack+=`
`+E):g.stack=E}catch{}}throw g}}_request(s,u){typeof s=="string"?(u=u||{},u.url=s):u=s||{},u=Rh(this.defaults,u);const{transitional:g,paramsSerializer:A,headers:E}=u;g!==void 0&&I_.assertOptions(g,{silentJSONParsing:ju.transitional(ju.boolean),forcedJSONParsing:ju.transitional(ju.boolean),clarifyTimeoutError:ju.transitional(ju.boolean)},!1),A!=null&&(Xt.isFunction(A)?u.paramsSerializer={serialize:A}:I_.assertOptions(A,{encode:ju.function,serialize:ju.function},!0)),u.method=(u.method||this.defaults.method||"get").toLowerCase();let O=E&&Xt.merge(E.common,E[u.method]);E&&Xt.forEach(["delete","get","head","post","put","patch","common"],he=>{delete E[he]}),u.headers=Gl.concat(O,E);const r=[];let U=!0;this.interceptors.request.forEach(function(K){typeof K.runWhen=="function"&&K.runWhen(u)===!1||(U=U&&K.synchronous,r.unshift(K.fulfilled,K.rejected))});const W=[];this.interceptors.response.forEach(function(K){W.push(K.fulfilled,K.rejected)});let Y,se=0,Ae;if(!U){const he=[sb.bind(this),void 0];for(he.unshift.apply(he,r),he.push.apply(he,W),Ae=he.length,Y=Promise.resolve(u);se<Ae;)Y=Y.then(he[se++],he[se++]);return Y}Ae=r.length;let Ce=u;for(se=0;se<Ae;){const he=r[se++],K=r[se++];try{Ce=he(Ce)}catch(N){K.call(this,N);break}}try{Y=sb.call(this,Ce)}catch(he){return Promise.reject(he)}for(se=0,Ae=W.length;se<Ae;)Y=Y.then(W[se++],W[se++]);return Y}getUri(s){s=Rh(this.defaults,s);const u=D2(s.baseURL,s.url);return I2(u,s.params,s.paramsSerializer)}}Xt.forEach(["delete","get","head","options"],function(s){Bg.prototype[s]=function(u,g){return this.request(Rh(g||{},{method:s,url:u,data:(g||{}).data}))}});Xt.forEach(["post","put","patch"],function(s){function u(g){return function(E,O,r){return this.request(Rh(r||{},{method:s,headers:g?{"Content-Type":"multipart/form-data"}:{},url:E,data:O}))}}Bg.prototype[s]=u(),Bg.prototype[s+"Form"]=u(!0)});const Ag=Bg;class K_{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let u;this.promise=new Promise(function(E){u=E});const g=this;this.promise.then(A=>{if(!g._listeners)return;let E=g._listeners.length;for(;E-- >0;)g._listeners[E](A);g._listeners=null}),this.promise.then=A=>{let E;const O=new Promise(r=>{g.subscribe(r),E=r}).then(A);return O.cancel=function(){g.unsubscribe(E)},O},s(function(E,O,r){g.reason||(g.reason=new Gd(E,O,r),u(g.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const u=this._listeners.indexOf(s);u!==-1&&this._listeners.splice(u,1)}static source(){let s;return{token:new K_(function(A){s=A}),cancel:s}}}const L3=K_;function O3(d){return function(u){return d.apply(null,u)}}function P3(d){return Xt.isObject(d)&&d.isAxiosError===!0}const M_={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(M_).forEach(([d,s])=>{M_[s]=d});const D3=M_;function F2(d){const s=new Ag(d),u=g2(Ag.prototype.request,s);return Xt.extend(u,Ag.prototype,s,{allOwnKeys:!0}),Xt.extend(u,s,null,{allOwnKeys:!0}),u.create=function(A){return F2(Rh(d,A))},u}const ps=F2(X_);ps.Axios=Ag;ps.CanceledError=Gd;ps.CancelToken=L3;ps.isCancel=O2;ps.VERSION=N2;ps.toFormData=Qg;ps.AxiosError=Jn;ps.Cancel=ps.CanceledError;ps.all=function(s){return Promise.all(s)};ps.spread=O3;ps.isAxiosError=P3;ps.mergeConfig=Rh;ps.AxiosHeaders=Gl;ps.formToJSON=d=>L2(Xt.isHTMLForm(d)?new FormData(d):d);ps.getAdapter=B2.getAdapter;ps.HttpStatusCode=D3;ps.default=ps;const R3=ps;var Po=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function t0(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}function k3(d){if(d.__esModule)return d;var s=d.default;if(typeof s=="function"){var u=function g(){return this instanceof g?Reflect.construct(s,arguments,this.constructor):s.apply(this,arguments)};u.prototype=s.prototype}else u={};return Object.defineProperty(u,"__esModule",{value:!0}),Object.keys(d).forEach(function(g){var A=Object.getOwnPropertyDescriptor(d,g);Object.defineProperty(u,g,A.get?A:{enumerable:!0,get:function(){return d[g]}})}),u}var B3={exports:{}};(function(d,s){(function(u,g){d.exports=g()})(self,()=>(()=>{var u={170:(E,O,r)=>{r.r(O),r.d(O,{afterMain:()=>vt,afterRead:()=>Ue,afterWrite:()=>Ui,applyStyles:()=>Vr,arrow:()=>wi,auto:()=>Ae,basePlacements:()=>Ce,beforeMain:()=>He,beforeRead:()=>fe,beforeWrite:()=>xt,bottom:()=>W,clippingParents:()=>N,computeStyles:()=>Go,createPopper:()=>hr,createPopperBase:()=>Cr,createPopperLite:()=>nr,detectOverflow:()=>gn,end:()=>K,eventListeners:()=>Ro,flip:()=>No,hide:()=>Tr,left:()=>se,main:()=>nt,modifierPhases:()=>Mt,offset:()=>Rs,placements:()=>ee,popper:()=>q,popperGenerator:()=>To,popperOffsets:()=>tr,preventOverflow:()=>Fo,read:()=>ce,reference:()=>G,right:()=>Y,start:()=>he,top:()=>U,variationPlacements:()=>Q,viewport:()=>z,write:()=>Ot});var U="top",W="bottom",Y="right",se="left",Ae="auto",Ce=[U,W,Y,se],he="start",K="end",N="clippingParents",z="viewport",q="popper",G="reference",Q=Ce.reduce(function(Ke,ve){return Ke.concat([ve+"-"+he,ve+"-"+K])},[]),ee=[].concat(Ce,[Ae]).reduce(function(Ke,ve){return Ke.concat([ve,ve+"-"+he,ve+"-"+K])},[]),fe="beforeRead",ce="read",Ue="afterRead",He="beforeMain",nt="main",vt="afterMain",xt="beforeWrite",Ot="write",Ui="afterWrite",Mt=[fe,ce,Ue,He,nt,vt,xt,Ot,Ui];function _i(Ke){return Ke?(Ke.nodeName||"").toLowerCase():null}function di(Ke){if(Ke==null)return window;if(Ke.toString()!=="[object Window]"){var ve=Ke.ownerDocument;return ve&&ve.defaultView||window}return Ke}function Un(Ke){return Ke instanceof di(Ke).Element||Ke instanceof Element}function Nn(Ke){return Ke instanceof di(Ke).HTMLElement||Ke instanceof HTMLElement}function Vi(Ke){return typeof ShadowRoot<"u"&&(Ke instanceof di(Ke).ShadowRoot||Ke instanceof ShadowRoot)}const Vr={name:"applyStyles",enabled:!0,phase:"write",fn:function(Ke){var ve=Ke.state;Object.keys(ve.elements).forEach(function(re){var ae=ve.styles[re]||{},Ee=ve.attributes[re]||{},Oe=ve.elements[re];Nn(Oe)&&_i(Oe)&&(Object.assign(Oe.style,ae),Object.keys(Ee).forEach(function(Re){var je=Ee[Re];je===!1?Oe.removeAttribute(Re):Oe.setAttribute(Re,je===!0?"":je)}))})},effect:function(Ke){var ve=Ke.state,re={popper:{position:ve.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(ve.elements.popper.style,re.popper),ve.styles=re,ve.elements.arrow&&Object.assign(ve.elements.arrow.style,re.arrow),function(){Object.keys(ve.elements).forEach(function(ae){var Ee=ve.elements[ae],Oe=ve.attributes[ae]||{},Re=Object.keys(ve.styles.hasOwnProperty(ae)?ve.styles[ae]:re[ae]).reduce(function(je,Je){return je[Je]="",je},{});Nn(Ee)&&_i(Ee)&&(Object.assign(Ee.style,Re),Object.keys(Oe).forEach(function(je){Ee.removeAttribute(je)}))})}},requires:["computeStyles"]};function Oi(Ke){return Ke.split("-")[0]}var ir=Math.max,fn=Math.min,At=Math.round;function Ri(){var Ke=navigator.userAgentData;return Ke!=null&&Ke.brands&&Array.isArray(Ke.brands)?Ke.brands.map(function(ve){return ve.brand+"/"+ve.version}).join(" "):navigator.userAgent}function Lr(){return!/^((?!chrome|android).)*safari/i.test(Ri())}function si(Ke,ve,re){ve===void 0&&(ve=!1),re===void 0&&(re=!1);var ae=Ke.getBoundingClientRect(),Ee=1,Oe=1;ve&&Nn(Ke)&&(Ee=Ke.offsetWidth>0&&At(ae.width)/Ke.offsetWidth||1,Oe=Ke.offsetHeight>0&&At(ae.height)/Ke.offsetHeight||1);var Re=(Un(Ke)?di(Ke):window).visualViewport,je=!Lr()&&re,Je=(ae.left+(je&&Re?Re.offsetLeft:0))/Ee,Ge=(ae.top+(je&&Re?Re.offsetTop:0))/Oe,rt=ae.width/Ee,ht=ae.height/Oe;return{width:rt,height:ht,top:Ge,right:Je+rt,bottom:Ge+ht,left:Je,x:Je,y:Ge}}function zi(Ke){var ve=si(Ke),re=Ke.offsetWidth,ae=Ke.offsetHeight;return Math.abs(ve.width-re)<=1&&(re=ve.width),Math.abs(ve.height-ae)<=1&&(ae=ve.height),{x:Ke.offsetLeft,y:Ke.offsetTop,width:re,height:ae}}function Qi(Ke,ve){var re=ve.getRootNode&&ve.getRootNode();if(Ke.contains(ve))return!0;if(re&&Vi(re)){var ae=ve;do{if(ae&&Ke.isSameNode(ae))return!0;ae=ae.parentNode||ae.host}while(ae)}return!1}function Sn(Ke){return di(Ke).getComputedStyle(Ke)}function Co(Ke){return["table","td","th"].indexOf(_i(Ke))>=0}function fi(Ke){return((Un(Ke)?Ke.ownerDocument:Ke.document)||window.document).documentElement}function $r(Ke){return _i(Ke)==="html"?Ke:Ke.assignedSlot||Ke.parentNode||(Vi(Ke)?Ke.host:null)||fi(Ke)}function Or(Ke){return Nn(Ke)&&Sn(Ke).position!=="fixed"?Ke.offsetParent:null}function Hi(Ke){for(var ve=di(Ke),re=Or(Ke);re&&Co(re)&&Sn(re).position==="static";)re=Or(re);return re&&(_i(re)==="html"||_i(re)==="body"&&Sn(re).position==="static")?ve:re||function(ae){var Ee=/firefox/i.test(Ri());if(/Trident/i.test(Ri())&&Nn(ae)&&Sn(ae).position==="fixed")return null;var Oe=$r(ae);for(Vi(Oe)&&(Oe=Oe.host);Nn(Oe)&&["html","body"].indexOf(_i(Oe))<0;){var Re=Sn(Oe);if(Re.transform!=="none"||Re.perspective!=="none"||Re.contain==="paint"||["transform","perspective"].indexOf(Re.willChange)!==-1||Ee&&Re.willChange==="filter"||Ee&&Re.filter&&Re.filter!=="none")return Oe;Oe=Oe.parentNode}return null}(Ke)||ve}function Hn(Ke){return["top","bottom"].indexOf(Ke)>=0?"x":"y"}function Fn(Ke,ve,re){return ir(Ke,fn(ve,re))}function ti(Ke){return Object.assign({},{top:0,right:0,bottom:0,left:0},Ke)}function Ii(Ke,ve){return ve.reduce(function(re,ae){return re[ae]=Ke,re},{})}const wi={name:"arrow",enabled:!0,phase:"main",fn:function(Ke){var ve,re=Ke.state,ae=Ke.name,Ee=Ke.options,Oe=re.elements.arrow,Re=re.modifiersData.popperOffsets,je=Oi(re.placement),Je=Hn(je),Ge=[se,Y].indexOf(je)>=0?"height":"width";if(Oe&&Re){var rt=function(Xi,tn){return ti(typeof(Xi=typeof Xi=="function"?Xi(Object.assign({},tn.rects,{placement:tn.placement})):Xi)!="number"?Xi:Ii(Xi,Ce))}(Ee.padding,re),ht=zi(Oe),pt=Je==="y"?U:se,$t=Je==="y"?W:Y,oi=re.rects.reference[Ge]+re.rects.reference[Je]-Re[Je]-re.rects.popper[Ge],bi=Re[Je]-re.rects.reference[Je],mt=Hi(Oe),Ti=mt?Je==="y"?mt.clientHeight||0:mt.clientWidth||0:0,ui=oi/2-bi/2,Gt=rt[pt],Yi=Ti-ht[Ge]-rt[$t],ei=Ti/2-ht[Ge]/2+ui,ii=Fn(Gt,ei,Yi),yi=Je;re.modifiersData[ae]=((ve={})[yi]=ii,ve.centerOffset=ii-ei,ve)}},effect:function(Ke){var ve=Ke.state,re=Ke.options.element,ae=re===void 0?"[data-popper-arrow]":re;ae!=null&&(typeof ae!="string"||(ae=ve.elements.popper.querySelector(ae)))&&Qi(ve.elements.popper,ae)&&(ve.elements.arrow=ae)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function on(Ke){return Ke.split("-")[1]}var Do={top:"auto",right:"auto",bottom:"auto",left:"auto"};function so(Ke){var ve,re=Ke.popper,ae=Ke.popperRect,Ee=Ke.placement,Oe=Ke.variation,Re=Ke.offsets,je=Ke.position,Je=Ke.gpuAcceleration,Ge=Ke.adaptive,rt=Ke.roundOffsets,ht=Ke.isFixed,pt=Re.x,$t=pt===void 0?0:pt,oi=Re.y,bi=oi===void 0?0:oi,mt=typeof rt=="function"?rt({x:$t,y:bi}):{x:$t,y:bi};$t=mt.x,bi=mt.y;var Ti=Re.hasOwnProperty("x"),ui=Re.hasOwnProperty("y"),Gt=se,Yi=U,ei=window;if(Ge){var ii=Hi(re),yi="clientHeight",Xi="clientWidth";ii===di(re)&&Sn(ii=fi(re)).position!=="static"&&je==="absolute"&&(yi="scrollHeight",Xi="scrollWidth"),(Ee===U||(Ee===se||Ee===Y)&&Oe===K)&&(Yi=W,bi-=(ht&&ii===ei&&ei.visualViewport?ei.visualViewport.height:ii[yi])-ae.height,bi*=Je?1:-1),(Ee===se||(Ee===U||Ee===W)&&Oe===K)&&(Gt=Y,$t-=(ht&&ii===ei&&ei.visualViewport?ei.visualViewport.width:ii[Xi])-ae.width,$t*=Je?1:-1)}var tn,Dn=Object.assign({position:je},Ge&&Do),pn=rt===!0?function(Ar,es){var ar=Ar.x,_n=Ar.y,Pi=es.devicePixelRatio||1;return{x:At(ar*Pi)/Pi||0,y:At(_n*Pi)/Pi||0}}({x:$t,y:bi},di(re)):{x:$t,y:bi};return $t=pn.x,bi=pn.y,Je?Object.assign({},Dn,((tn={})[Yi]=ui?"0":"",tn[Gt]=Ti?"0":"",tn.transform=(ei.devicePixelRatio||1)<=1?"translate("+$t+"px, "+bi+"px)":"translate3d("+$t+"px, "+bi+"px, 0)",tn)):Object.assign({},Dn,((ve={})[Yi]=ui?bi+"px":"",ve[Gt]=Ti?$t+"px":"",ve.transform="",ve))}const Go={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(Ke){var ve=Ke.state,re=Ke.options,ae=re.gpuAcceleration,Ee=ae===void 0||ae,Oe=re.adaptive,Re=Oe===void 0||Oe,je=re.roundOffsets,Je=je===void 0||je,Ge={placement:Oi(ve.placement),variation:on(ve.placement),popper:ve.elements.popper,popperRect:ve.rects.popper,gpuAcceleration:Ee,isFixed:ve.options.strategy==="fixed"};ve.modifiersData.popperOffsets!=null&&(ve.styles.popper=Object.assign({},ve.styles.popper,so(Object.assign({},Ge,{offsets:ve.modifiersData.popperOffsets,position:ve.options.strategy,adaptive:Re,roundOffsets:Je})))),ve.modifiersData.arrow!=null&&(ve.styles.arrow=Object.assign({},ve.styles.arrow,so(Object.assign({},Ge,{offsets:ve.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:Je})))),ve.attributes.popper=Object.assign({},ve.attributes.popper,{"data-popper-placement":ve.placement})},data:{}};var Pr={passive:!0};const Ro={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(Ke){var ve=Ke.state,re=Ke.instance,ae=Ke.options,Ee=ae.scroll,Oe=Ee===void 0||Ee,Re=ae.resize,je=Re===void 0||Re,Je=di(ve.elements.popper),Ge=[].concat(ve.scrollParents.reference,ve.scrollParents.popper);return Oe&&Ge.forEach(function(rt){rt.addEventListener("scroll",re.update,Pr)}),je&&Je.addEventListener("resize",re.update,Pr),function(){Oe&&Ge.forEach(function(rt){rt.removeEventListener("scroll",re.update,Pr)}),je&&Je.removeEventListener("resize",re.update,Pr)}},data:{}};var ao={left:"right",right:"left",bottom:"top",top:"bottom"};function yr(Ke){return Ke.replace(/left|right|bottom|top/g,function(ve){return ao[ve]})}var ko={start:"end",end:"start"};function Bo(Ke){return Ke.replace(/start|end/g,function(ve){return ko[ve]})}function Wo(Ke){var ve=di(Ke);return{scrollLeft:ve.pageXOffset,scrollTop:ve.pageYOffset}}function er(Ke){return si(fi(Ke)).left+Wo(Ke).scrollLeft}function pi(Ke){var ve=Sn(Ke),re=ve.overflow,ae=ve.overflowX,Ee=ve.overflowY;return/auto|scroll|overlay|hidden/.test(re+Ee+ae)}function xi(Ke){return["html","body","#document"].indexOf(_i(Ke))>=0?Ke.ownerDocument.body:Nn(Ke)&&pi(Ke)?Ke:xi($r(Ke))}function Gn(Ke,ve){var re;ve===void 0&&(ve=[]);var ae=xi(Ke),Ee=ae===((re=Ke.ownerDocument)==null?void 0:re.body),Oe=di(ae),Re=Ee?[Oe].concat(Oe.visualViewport||[],pi(ae)?ae:[]):ae,je=ve.concat(Re);return Ee?je:je.concat(Gn($r(Re)))}function an(Ke){return Object.assign({},Ke,{left:Ke.x,top:Ke.y,right:Ke.x+Ke.width,bottom:Ke.y+Ke.height})}function Jo(Ke,ve,re){return ve===z?an(function(ae,Ee){var Oe=di(ae),Re=fi(ae),je=Oe.visualViewport,Je=Re.clientWidth,Ge=Re.clientHeight,rt=0,ht=0;if(je){Je=je.width,Ge=je.height;var pt=Lr();(pt||!pt&&Ee==="fixed")&&(rt=je.offsetLeft,ht=je.offsetTop)}return{width:Je,height:Ge,x:rt+er(ae),y:ht}}(Ke,re)):Un(ve)?function(ae,Ee){var Oe=si(ae,!1,Ee==="fixed");return Oe.top=Oe.top+ae.clientTop,Oe.left=Oe.left+ae.clientLeft,Oe.bottom=Oe.top+ae.clientHeight,Oe.right=Oe.left+ae.clientWidth,Oe.width=ae.clientWidth,Oe.height=ae.clientHeight,Oe.x=Oe.left,Oe.y=Oe.top,Oe}(ve,re):an(function(ae){var Ee,Oe=fi(ae),Re=Wo(ae),je=(Ee=ae.ownerDocument)==null?void 0:Ee.body,Je=ir(Oe.scrollWidth,Oe.clientWidth,je?je.scrollWidth:0,je?je.clientWidth:0),Ge=ir(Oe.scrollHeight,Oe.clientHeight,je?je.scrollHeight:0,je?je.clientHeight:0),rt=-Re.scrollLeft+er(ae),ht=-Re.scrollTop;return Sn(je||Oe).direction==="rtl"&&(rt+=ir(Oe.clientWidth,je?je.clientWidth:0)-Je),{width:Je,height:Ge,x:rt,y:ht}}(fi(Ke)))}function Ds(Ke,ve,re,ae){var Ee=ve==="clippingParents"?function(Je){var Ge=Gn($r(Je)),rt=["absolute","fixed"].indexOf(Sn(Je).position)>=0&&Nn(Je)?Hi(Je):Je;return Un(rt)?Ge.filter(function(ht){return Un(ht)&&Qi(ht,rt)&&_i(ht)!=="body"}):[]}(Ke):[].concat(ve),Oe=[].concat(Ee,[re]),Re=Oe[0],je=Oe.reduce(function(Je,Ge){var rt=Jo(Ke,Ge,ae);return Je.top=ir(rt.top,Je.top),Je.right=fn(rt.right,Je.right),Je.bottom=fn(rt.bottom,Je.bottom),Je.left=ir(rt.left,Je.left),Je},Jo(Ke,Re,ae));return je.width=je.right-je.left,je.height=je.bottom-je.top,je.x=je.left,je.y=je.top,je}function $o(Ke){var ve,re=Ke.reference,ae=Ke.element,Ee=Ke.placement,Oe=Ee?Oi(Ee):null,Re=Ee?on(Ee):null,je=re.x+re.width/2-ae.width/2,Je=re.y+re.height/2-ae.height/2;switch(Oe){case U:ve={x:je,y:re.y-ae.height};break;case W:ve={x:je,y:re.y+re.height};break;case Y:ve={x:re.x+re.width,y:Je};break;case se:ve={x:re.x-ae.width,y:Je};break;default:ve={x:re.x,y:re.y}}var Ge=Oe?Hn(Oe):null;if(Ge!=null){var rt=Ge==="y"?"height":"width";switch(Re){case he:ve[Ge]=ve[Ge]-(re[rt]/2-ae[rt]/2);break;case K:ve[Ge]=ve[Ge]+(re[rt]/2-ae[rt]/2)}}return ve}function gn(Ke,ve){ve===void 0&&(ve={});var re=ve,ae=re.placement,Ee=ae===void 0?Ke.placement:ae,Oe=re.strategy,Re=Oe===void 0?Ke.strategy:Oe,je=re.boundary,Je=je===void 0?N:je,Ge=re.rootBoundary,rt=Ge===void 0?z:Ge,ht=re.elementContext,pt=ht===void 0?q:ht,$t=re.altBoundary,oi=$t!==void 0&&$t,bi=re.padding,mt=bi===void 0?0:bi,Ti=ti(typeof mt!="number"?mt:Ii(mt,Ce)),ui=pt===q?G:q,Gt=Ke.rects.popper,Yi=Ke.elements[oi?ui:pt],ei=Ds(Un(Yi)?Yi:Yi.contextElement||fi(Ke.elements.popper),Je,rt,Re),ii=si(Ke.elements.reference),yi=$o({reference:ii,element:Gt,strategy:"absolute",placement:Ee}),Xi=an(Object.assign({},Gt,yi)),tn=pt===q?Xi:ii,Dn={top:ei.top-tn.top+Ti.top,bottom:tn.bottom-ei.bottom+Ti.bottom,left:ei.left-tn.left+Ti.left,right:tn.right-ei.right+Ti.right},pn=Ke.modifiersData.offset;if(pt===q&&pn){var Ar=pn[Ee];Object.keys(Dn).forEach(function(es){var ar=[Y,W].indexOf(es)>=0?1:-1,_n=[U,W].indexOf(es)>=0?"y":"x";Dn[es]+=Ar[_n]*ar})}return Dn}const No={name:"flip",enabled:!0,phase:"main",fn:function(Ke){var ve=Ke.state,re=Ke.options,ae=Ke.name;if(!ve.modifiersData[ae]._skip){for(var Ee=re.mainAxis,Oe=Ee===void 0||Ee,Re=re.altAxis,je=Re===void 0||Re,Je=re.fallbackPlacements,Ge=re.padding,rt=re.boundary,ht=re.rootBoundary,pt=re.altBoundary,$t=re.flipVariations,oi=$t===void 0||$t,bi=re.allowedAutoPlacements,mt=ve.options.placement,Ti=Oi(mt),ui=Je||(Ti===mt||!oi?[yr(mt)]:function(We){if(Oi(We)===Ae)return[];var ki=yr(We);return[Bo(We),ki,Bo(ki)]}(mt)),Gt=[mt].concat(ui).reduce(function(We,ki){return We.concat(Oi(ki)===Ae?function(dr,jr){jr===void 0&&(jr={});var So=jr,gr=So.placement,_o=So.boundary,Wi=So.rootBoundary,lr=So.padding,Vs=So.flipVariations,ks=So.allowedAutoPlacements,pa=ks===void 0?ee:ks,Bs=on(gr),Us=Bs?Vs?Q:Q.filter(function(Zo){return on(Zo)===Bs}):Ce,ms=Us.filter(function(Zo){return pa.indexOf(Zo)>=0});ms.length===0&&(ms=Us);var Bi=ms.reduce(function(Zo,Xo){return Zo[Xo]=gn(dr,{placement:Xo,boundary:_o,rootBoundary:Wi,padding:lr})[Oi(Xo)],Zo},{});return Object.keys(Bi).sort(function(Zo,Xo){return Bi[Zo]-Bi[Xo]})}(ve,{placement:ki,boundary:rt,rootBoundary:ht,padding:Ge,flipVariations:oi,allowedAutoPlacements:bi}):ki)},[]),Yi=ve.rects.reference,ei=ve.rects.popper,ii=new Map,yi=!0,Xi=Gt[0],tn=0;tn<Gt.length;tn++){var Dn=Gt[tn],pn=Oi(Dn),Ar=on(Dn)===he,es=[U,W].indexOf(pn)>=0,ar=es?"width":"height",_n=gn(ve,{placement:Dn,boundary:rt,rootBoundary:ht,altBoundary:pt,padding:Ge}),Pi=es?Ar?Y:se:Ar?W:U;Yi[ar]>ei[ar]&&(Pi=yr(Pi));var zo=yr(Pi),Rn=[];if(Oe&&Rn.push(_n[pn]<=0),je&&Rn.push(_n[Pi]<=0,_n[zo]<=0),Rn.every(function(We){return We})){Xi=Dn,yi=!1;break}ii.set(Dn,Rn)}if(yi)for(var Zr=function(We){var ki=Gt.find(function(dr){var jr=ii.get(dr);if(jr)return jr.slice(0,We).every(function(So){return So})});if(ki)return Xi=ki,"break"},Ct=oi?3:1;Ct>0&&Zr(Ct)!=="break";Ct--);ve.placement!==Xi&&(ve.modifiersData[ae]._skip=!0,ve.placement=Xi,ve.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Es(Ke,ve,re){return re===void 0&&(re={x:0,y:0}),{top:Ke.top-ve.height-re.y,right:Ke.right-ve.width+re.x,bottom:Ke.bottom-ve.height+re.y,left:Ke.left-ve.width-re.x}}function Ur(Ke){return[U,Y,W,se].some(function(ve){return Ke[ve]>=0})}const Tr={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(Ke){var ve=Ke.state,re=Ke.name,ae=ve.rects.reference,Ee=ve.rects.popper,Oe=ve.modifiersData.preventOverflow,Re=gn(ve,{elementContext:"reference"}),je=gn(ve,{altBoundary:!0}),Je=Es(Re,ae),Ge=Es(je,Ee,Oe),rt=Ur(Je),ht=Ur(Ge);ve.modifiersData[re]={referenceClippingOffsets:Je,popperEscapeOffsets:Ge,isReferenceHidden:rt,hasPopperEscaped:ht},ve.attributes.popper=Object.assign({},ve.attributes.popper,{"data-popper-reference-hidden":rt,"data-popper-escaped":ht})}},Rs={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(Ke){var ve=Ke.state,re=Ke.options,ae=Ke.name,Ee=re.offset,Oe=Ee===void 0?[0,0]:Ee,Re=ee.reduce(function(rt,ht){return rt[ht]=function(pt,$t,oi){var bi=Oi(pt),mt=[se,U].indexOf(bi)>=0?-1:1,Ti=typeof oi=="function"?oi(Object.assign({},$t,{placement:pt})):oi,ui=Ti[0],Gt=Ti[1];return ui=ui||0,Gt=(Gt||0)*mt,[se,Y].indexOf(bi)>=0?{x:Gt,y:ui}:{x:ui,y:Gt}}(ht,ve.rects,Oe),rt},{}),je=Re[ve.placement],Je=je.x,Ge=je.y;ve.modifiersData.popperOffsets!=null&&(ve.modifiersData.popperOffsets.x+=Je,ve.modifiersData.popperOffsets.y+=Ge),ve.modifiersData[ae]=Re}},tr={name:"popperOffsets",enabled:!0,phase:"read",fn:function(Ke){var ve=Ke.state,re=Ke.name;ve.modifiersData[re]=$o({reference:ve.rects.reference,element:ve.rects.popper,strategy:"absolute",placement:ve.placement})},data:{}},Fo={name:"preventOverflow",enabled:!0,phase:"main",fn:function(Ke){var ve=Ke.state,re=Ke.options,ae=Ke.name,Ee=re.mainAxis,Oe=Ee===void 0||Ee,Re=re.altAxis,je=Re!==void 0&&Re,Je=re.boundary,Ge=re.rootBoundary,rt=re.altBoundary,ht=re.padding,pt=re.tether,$t=pt===void 0||pt,oi=re.tetherOffset,bi=oi===void 0?0:oi,mt=gn(ve,{boundary:Je,rootBoundary:Ge,padding:ht,altBoundary:rt}),Ti=Oi(ve.placement),ui=on(ve.placement),Gt=!ui,Yi=Hn(Ti),ei=Yi==="x"?"y":"x",ii=ve.modifiersData.popperOffsets,yi=ve.rects.reference,Xi=ve.rects.popper,tn=typeof bi=="function"?bi(Object.assign({},ve.rects,{placement:ve.placement})):bi,Dn=typeof tn=="number"?{mainAxis:tn,altAxis:tn}:Object.assign({mainAxis:0,altAxis:0},tn),pn=ve.modifiersData.offset?ve.modifiersData.offset[ve.placement]:null,Ar={x:0,y:0};if(ii){if(Oe){var es,ar=Yi==="y"?U:se,_n=Yi==="y"?W:Y,Pi=Yi==="y"?"height":"width",zo=ii[Yi],Rn=zo+mt[ar],Zr=zo-mt[_n],Ct=$t?-Xi[Pi]/2:0,We=ui===he?yi[Pi]:Xi[Pi],ki=ui===he?-Xi[Pi]:-yi[Pi],dr=ve.elements.arrow,jr=$t&&dr?zi(dr):{width:0,height:0},So=ve.modifiersData["arrow#persistent"]?ve.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},gr=So[ar],_o=So[_n],Wi=Fn(0,yi[Pi],jr[Pi]),lr=Gt?yi[Pi]/2-Ct-Wi-gr-Dn.mainAxis:We-Wi-gr-Dn.mainAxis,Vs=Gt?-yi[Pi]/2+Ct+Wi+_o+Dn.mainAxis:ki+Wi+_o+Dn.mainAxis,ks=ve.elements.arrow&&Hi(ve.elements.arrow),pa=ks?Yi==="y"?ks.clientTop||0:ks.clientLeft||0:0,Bs=(es=pn==null?void 0:pn[Yi])!=null?es:0,Us=zo+Vs-Bs,ms=Fn($t?fn(Rn,zo+lr-Bs-pa):Rn,zo,$t?ir(Zr,Us):Zr);ii[Yi]=ms,Ar[Yi]=ms-zo}if(je){var Bi,Zo=Yi==="x"?U:se,Xo=Yi==="x"?W:Y,en=ii[ei],ma=ei==="y"?"height":"width",hn=en+mt[Zo],io=en-mt[Xo],Qs=[U,se].indexOf(Ti)!==-1,Ns=(Bi=pn==null?void 0:pn[ei])!=null?Bi:0,ga=Qs?hn:en-yi[ma]-Xi[ma]-Ns+Dn.altAxis,Yo=Qs?en+yi[ma]+Xi[ma]-Ns-Dn.altAxis:io,Yt=$t&&Qs?function(Js,ts,nn){var ho=Fn(Js,ts,nn);return ho>nn?nn:ho}(ga,en,Yo):Fn($t?ga:hn,en,$t?Yo:io);ii[ei]=Yt,Ar[ei]=Yt-en}ve.modifiersData[ae]=Ar}},requiresIfExists:["offset"]};function Eo(Ke,ve,re){re===void 0&&(re=!1);var ae,Ee,Oe=Nn(ve),Re=Nn(ve)&&function(ht){var pt=ht.getBoundingClientRect(),$t=At(pt.width)/ht.offsetWidth||1,oi=At(pt.height)/ht.offsetHeight||1;return $t!==1||oi!==1}(ve),je=fi(ve),Je=si(Ke,Re,re),Ge={scrollLeft:0,scrollTop:0},rt={x:0,y:0};return(Oe||!Oe&&!re)&&((_i(ve)!=="body"||pi(je))&&(Ge=(ae=ve)!==di(ae)&&Nn(ae)?{scrollLeft:(Ee=ae).scrollLeft,scrollTop:Ee.scrollTop}:Wo(ae)),Nn(ve)?((rt=si(ve,!0)).x+=ve.clientLeft,rt.y+=ve.clientTop):je&&(rt.x=er(je))),{x:Je.left+Ge.scrollLeft-rt.x,y:Je.top+Ge.scrollTop-rt.y,width:Je.width,height:Je.height}}function uo(Ke){var ve=new Map,re=new Set,ae=[];function Ee(Oe){re.add(Oe.name),[].concat(Oe.requires||[],Oe.requiresIfExists||[]).forEach(function(Re){if(!re.has(Re)){var je=ve.get(Re);je&&Ee(je)}}),ae.push(Oe)}return Ke.forEach(function(Oe){ve.set(Oe.name,Oe)}),Ke.forEach(function(Oe){re.has(Oe.name)||Ee(Oe)}),ae}var yn={placement:"bottom",modifiers:[],strategy:"absolute"};function Kn(){for(var Ke=arguments.length,ve=new Array(Ke),re=0;re<Ke;re++)ve[re]=arguments[re];return!ve.some(function(ae){return!(ae&&typeof ae.getBoundingClientRect=="function")})}function To(Ke){Ke===void 0&&(Ke={});var ve=Ke,re=ve.defaultModifiers,ae=re===void 0?[]:re,Ee=ve.defaultOptions,Oe=Ee===void 0?yn:Ee;return function(Re,je,Je){Je===void 0&&(Je=Oe);var Ge,rt,ht={placement:"bottom",orderedModifiers:[],options:Object.assign({},yn,Oe),modifiersData:{},elements:{reference:Re,popper:je},attributes:{},styles:{}},pt=[],$t=!1,oi={state:ht,setOptions:function(mt){var Ti=typeof mt=="function"?mt(ht.options):mt;bi(),ht.options=Object.assign({},Oe,ht.options,Ti),ht.scrollParents={reference:Un(Re)?Gn(Re):Re.contextElement?Gn(Re.contextElement):[],popper:Gn(je)};var ui,Gt,Yi=function(ei){var ii=uo(ei);return Mt.reduce(function(yi,Xi){return yi.concat(ii.filter(function(tn){return tn.phase===Xi}))},[])}((ui=[].concat(ae,ht.options.modifiers),Gt=ui.reduce(function(ei,ii){var yi=ei[ii.name];return ei[ii.name]=yi?Object.assign({},yi,ii,{options:Object.assign({},yi.options,ii.options),data:Object.assign({},yi.data,ii.data)}):ii,ei},{}),Object.keys(Gt).map(function(ei){return Gt[ei]})));return ht.orderedModifiers=Yi.filter(function(ei){return ei.enabled}),ht.orderedModifiers.forEach(function(ei){var ii=ei.name,yi=ei.options,Xi=yi===void 0?{}:yi,tn=ei.effect;if(typeof tn=="function"){var Dn=tn({state:ht,name:ii,instance:oi,options:Xi}),pn=function(){};pt.push(Dn||pn)}}),oi.update()},forceUpdate:function(){if(!$t){var mt=ht.elements,Ti=mt.reference,ui=mt.popper;if(Kn(Ti,ui)){ht.rects={reference:Eo(Ti,Hi(ui),ht.options.strategy==="fixed"),popper:zi(ui)},ht.reset=!1,ht.placement=ht.options.placement,ht.orderedModifiers.forEach(function(tn){return ht.modifiersData[tn.name]=Object.assign({},tn.data)});for(var Gt=0;Gt<ht.orderedModifiers.length;Gt++)if(ht.reset!==!0){var Yi=ht.orderedModifiers[Gt],ei=Yi.fn,ii=Yi.options,yi=ii===void 0?{}:ii,Xi=Yi.name;typeof ei=="function"&&(ht=ei({state:ht,options:yi,name:Xi,instance:oi})||ht)}else ht.reset=!1,Gt=-1}}},update:(Ge=function(){return new Promise(function(mt){oi.forceUpdate(),mt(ht)})},function(){return rt||(rt=new Promise(function(mt){Promise.resolve().then(function(){rt=void 0,mt(Ge())})})),rt}),destroy:function(){bi(),$t=!0}};if(!Kn(Re,je))return oi;function bi(){pt.forEach(function(mt){return mt()}),pt=[]}return oi.setOptions(Je).then(function(mt){!$t&&Je.onFirstUpdate&&Je.onFirstUpdate(mt)}),oi}}var Cr=To(),hr=To({defaultModifiers:[Ro,tr,Go,Vr,Rs,No,Fo,wi,Tr]}),nr=To({defaultModifiers:[Ro,tr,Go,Vr]})},223:(E,O)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.BREAKPOINTS=O.COMBO_BOX_ACCESSIBILITY_KEY_SET=O.SELECT_ACCESSIBILITY_KEY_SET=O.TABS_ACCESSIBILITY_KEY_SET=O.OVERLAY_ACCESSIBILITY_KEY_SET=O.DROPDOWN_ACCESSIBILITY_KEY_SET=O.POSITIONS=void 0,O.POSITIONS={auto:"auto","auto-start":"auto-start","auto-end":"auto-end",top:"top","top-left":"top-start","top-right":"top-end",bottom:"bottom","bottom-left":"bottom-start","bottom-right":"bottom-end",right:"right","right-start":"right-start","right-end":"right-end",left:"left","left-start":"left-start","left-end":"left-end"},O.DROPDOWN_ACCESSIBILITY_KEY_SET=["Escape","ArrowUp","ArrowDown","Home","End","Enter"],O.OVERLAY_ACCESSIBILITY_KEY_SET=["Escape","Tab"],O.TABS_ACCESSIBILITY_KEY_SET=["ArrowUp","ArrowLeft","ArrowDown","ArrowRight","Home","End"],O.SELECT_ACCESSIBILITY_KEY_SET=["ArrowUp","ArrowLeft","ArrowDown","ArrowRight","Home","End","Escape","Enter","Tab"],O.COMBO_BOX_ACCESSIBILITY_KEY_SET=["ArrowUp","ArrowLeft","ArrowDown","ArrowRight","Home","End","Escape","Enter"],O.BREAKPOINTS={sm:640,md:768,lg:1024,xl:1280,"2xl":1536}},158:function(E,O,r){var U=this&&this.__importDefault||function(Ot){return Ot&&Ot.__esModule?Ot:{default:Ot}};Object.defineProperty(O,"__esModule",{value:!0}),O.HSFileUpload=O.HSDataTable=O.HSStaticMethods=O.HSTooltip=O.HSTogglePassword=O.HSToggleCount=O.HSThemeSwitch=O.HSTabs=O.HSStrongPassword=O.HSStepper=O.HSSelect=O.HSScrollspy=O.HSRemoveElement=O.HSPinInput=O.HSOverlay=O.HSInputNumber=O.HSDropdown=O.HSComboBox=O.HSCollapse=O.HSCarousel=O.HSAccordion=O.HSCopyMarkup=void 0;var W=r(406);Object.defineProperty(O,"HSCopyMarkup",{enumerable:!0,get:function(){return U(W).default}});var Y=r(740);Object.defineProperty(O,"HSAccordion",{enumerable:!0,get:function(){return U(Y).default}});var se=r(268);Object.defineProperty(O,"HSCarousel",{enumerable:!0,get:function(){return U(se).default}});var Ae=r(485);Object.defineProperty(O,"HSCollapse",{enumerable:!0,get:function(){return U(Ae).default}});var Ce=r(809);Object.defineProperty(O,"HSComboBox",{enumerable:!0,get:function(){return U(Ce).default}});var he=r(891);Object.defineProperty(O,"HSDropdown",{enumerable:!0,get:function(){return U(he).default}});var K=r(332);Object.defineProperty(O,"HSInputNumber",{enumerable:!0,get:function(){return U(K).default}});var N=r(850);Object.defineProperty(O,"HSOverlay",{enumerable:!0,get:function(){return U(N).default}});var z=r(60);Object.defineProperty(O,"HSPinInput",{enumerable:!0,get:function(){return U(z).default}});var q=r(911);Object.defineProperty(O,"HSRemoveElement",{enumerable:!0,get:function(){return U(q).default}});var G=r(751);Object.defineProperty(O,"HSScrollspy",{enumerable:!0,get:function(){return U(G).default}});var Q=r(442);Object.defineProperty(O,"HSSelect",{enumerable:!0,get:function(){return U(Q).default}});var ee=r(887);Object.defineProperty(O,"HSStepper",{enumerable:!0,get:function(){return U(ee).default}});var fe=r(97);Object.defineProperty(O,"HSStrongPassword",{enumerable:!0,get:function(){return U(fe).default}});var ce=r(166);Object.defineProperty(O,"HSTabs",{enumerable:!0,get:function(){return U(ce).default}});var Ue=r(502);Object.defineProperty(O,"HSThemeSwitch",{enumerable:!0,get:function(){return U(Ue).default}});var He=r(684);Object.defineProperty(O,"HSToggleCount",{enumerable:!0,get:function(){return U(He).default}});var nt=r(100);Object.defineProperty(O,"HSTogglePassword",{enumerable:!0,get:function(){return U(nt).default}});var vt=r(969);Object.defineProperty(O,"HSTooltip",{enumerable:!0,get:function(){return U(vt).default}});var xt=r(957);Object.defineProperty(O,"HSStaticMethods",{enumerable:!0,get:function(){return U(xt).default}}),typeof DataTable<"u"&&typeof jQuery<"u"?O.HSDataTable=r(814).default:O.HSDataTable=null,typeof _<"u"&&typeof Dropzone<"u"?O.HSFileUpload=r(234).default:O.HSFileUpload=null},740:function(E,O,r){/*
 * HSAccordion
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */var U,W=this&&this.__extends||(U=function(he,K){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,z){N.__proto__=z}||function(N,z){for(var q in z)Object.prototype.hasOwnProperty.call(z,q)&&(N[q]=z[q])},U(he,K)},function(he,K){if(typeof K!="function"&&K!==null)throw new TypeError("Class extends value "+String(K)+" is not a constructor or null");function N(){this.constructor=he}U(he,K),he.prototype=K===null?Object.create(K):(N.prototype=K.prototype,new N)}),Y=this&&this.__assign||function(){return Y=Object.assign||function(he){for(var K,N=1,z=arguments.length;N<z;N++)for(var q in K=arguments[N])Object.prototype.hasOwnProperty.call(K,q)&&(he[q]=K[q]);return he},Y.apply(this,arguments)},se=this&&this.__importDefault||function(he){return he&&he.__esModule?he:{default:he}};Object.defineProperty(O,"__esModule",{value:!0});var Ae=r(292),Ce=function(he){function K(N,z,q){var G=he.call(this,N,z,q)||this;return G.toggle=G.el.querySelector(".hs-accordion-toggle")||null,G.content=G.el.querySelector(".hs-accordion-content")||null,G.group=G.el.closest(".hs-accordion-group")||null,G.isAlwaysOpened=G.group.hasAttribute("data-hs-accordion-always-open")||!1,G.toggle&&G.content&&G.init(),G}return W(K,he),K.prototype.init=function(){var N=this;this.createCollection(window.$hsAccordionCollection,this),this.toggle.addEventListener("click",function(z){z.stopPropagation(),N.el.classList.contains("active")?N.hide():N.show()})},K.prototype.show=function(){var N,z=this;if(this.group&&!this.isAlwaysOpened&&this.group.querySelector(":scope > .hs-accordion.active")&&this.group.querySelector(":scope > .hs-accordion.active")!==this.el&&window.$hsAccordionCollection.find(function(q){return q.element.el===z.group.querySelector(":scope > .hs-accordion.active")}).element.hide(),this.el.classList.contains("active"))return!1;this.el.classList.add("active"),!((N=this==null?void 0:this.toggle)===null||N===void 0)&&N.ariaExpanded&&(this.toggle.ariaExpanded="true"),this.content.style.display="block",this.content.style.height="0",setTimeout(function(){z.content.style.height="".concat(z.content.scrollHeight,"px")}),(0,Ae.afterTransition)(this.content,function(){z.content.style.display="block",z.content.style.height="",z.fireEvent("open",z.el),(0,Ae.dispatch)("open.hs.accordion",z.el,z.el)})},K.prototype.hide=function(){var N,z=this;if(!this.el.classList.contains("active"))return!1;this.el.classList.remove("active"),!((N=this==null?void 0:this.toggle)===null||N===void 0)&&N.ariaExpanded&&(this.toggle.ariaExpanded="false"),this.content.style.height="".concat(this.content.scrollHeight,"px"),setTimeout(function(){z.content.style.height="0"}),(0,Ae.afterTransition)(this.content,function(){z.content.style.display="",z.content.style.height="0",z.fireEvent("close",z.el),(0,Ae.dispatch)("close.hs.accordion",z.el,z.el)})},K.getInstance=function(N,z){var q=window.$hsAccordionCollection.find(function(G){return G.element.el===(typeof N=="string"?document.querySelector(N):N)});return q?z?q:q.element.el:null},K.show=function(N){var z=window.$hsAccordionCollection.find(function(q){return q.element.el===(typeof N=="string"?document.querySelector(N):N)});z&&z.element.content.style.display!=="block"&&z.element.show()},K.hide=function(N){var z=window.$hsAccordionCollection.find(function(q){return q.element.el===(typeof N=="string"?document.querySelector(N):N)});z&&z.element.content.style.display==="block"&&z.element.hide()},K.autoInit=function(){window.$hsAccordionCollection||(window.$hsAccordionCollection=[]),document.querySelectorAll(".hs-accordion:not(.--prevent-on-load-init)").forEach(function(N){window.$hsAccordionCollection.find(function(z){var q;return((q=z==null?void 0:z.element)===null||q===void 0?void 0:q.el)===N})||new K(N)})},K.treeView=function(){var N=this;if(!document.querySelectorAll(".hs-accordion-treeview-root").length)return!1;this.selectable=[],document.querySelectorAll(".hs-accordion-treeview-root").forEach(function(z){var q=z==null?void 0:z.getAttribute("data-hs-accordion-options"),G=q?JSON.parse(q):{};N.selectable.push({el:z,options:Y({},G)})}),this.selectable.length&&this.selectable.forEach(function(z){z.el.querySelectorAll(".hs-accordion-selectable").forEach(function(q){q.addEventListener("click",function(G){G.stopPropagation(),N.toggleSelected(z,q)})})})},K.toggleSelected=function(N,z){z.classList.contains("selected")?z.classList.remove("selected"):(N.el.querySelectorAll(".hs-accordion-selectable").forEach(function(q){return q.classList.remove("selected")}),z.classList.add("selected"))},K.on=function(N,z,q){var G=window.$hsAccordionCollection.find(function(Q){return Q.element.el===(typeof z=="string"?document.querySelector(z):z)});G&&(G.element.events[N]=q)},K}(se(r(961)).default);window.addEventListener("load",function(){Ce.autoInit(),document.querySelectorAll(".hs-accordion-treeview-root").length&&Ce.treeView()}),typeof window<"u"&&(window.HSAccordion=Ce),O.default=Ce},961:(E,O)=>{/*
 * HSBasePlugin
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */Object.defineProperty(O,"__esModule",{value:!0});var r=function(){function U(W,Y,se){this.el=W,this.options=Y,this.events=se,this.el=W,this.options=Y,this.events={}}return U.prototype.createCollection=function(W,Y){var se;W.push({id:((se=Y==null?void 0:Y.el)===null||se===void 0?void 0:se.id)||W.length+1,element:Y})},U.prototype.fireEvent=function(W,Y){if(Y===void 0&&(Y=null),this.events.hasOwnProperty(W))return this.events[W](Y)},U.prototype.on=function(W,Y){this.events[W]=Y},U}();O.default=r},268:function(E,O,r){/*
 * HSCarousel
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */var U,W=this&&this.__extends||(U=function(Ce,he){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(K,N){K.__proto__=N}||function(K,N){for(var z in N)Object.prototype.hasOwnProperty.call(N,z)&&(K[z]=N[z])},U(Ce,he)},function(Ce,he){if(typeof he!="function"&&he!==null)throw new TypeError("Class extends value "+String(he)+" is not a constructor or null");function K(){this.constructor=Ce}U(Ce,he),Ce.prototype=he===null?Object.create(he):(K.prototype=he.prototype,new K)}),Y=this&&this.__assign||function(){return Y=Object.assign||function(Ce){for(var he,K=1,N=arguments.length;K<N;K++)for(var z in he=arguments[K])Object.prototype.hasOwnProperty.call(he,z)&&(Ce[z]=he[z]);return Ce},Y.apply(this,arguments)},se=this&&this.__importDefault||function(Ce){return Ce&&Ce.__esModule?Ce:{default:Ce}};Object.defineProperty(O,"__esModule",{value:!0});var Ae=function(Ce){function he(K,N){var z,q,G,Q=Ce.call(this,K,N)||this,ee=K.getAttribute("data-hs-carousel"),fe=ee?JSON.parse(ee):{},ce=Y(Y({},fe),N);return Q.currentIndex=ce.currentIndex||0,Q.loadingClasses=ce.loadingClasses?"".concat(ce.loadingClasses).split(","):null,Q.loadingClassesRemove=!((z=Q.loadingClasses)===null||z===void 0)&&z[0]?Q.loadingClasses[0].split(" "):"opacity-0",Q.loadingClassesAdd=!((q=Q.loadingClasses)===null||q===void 0)&&q[1]?Q.loadingClasses[1].split(" "):"",Q.afterLoadingClassesAdd=!((G=Q.loadingClasses)===null||G===void 0)&&G[2]?Q.loadingClasses[2].split(" "):"",Q.isAutoPlay=ce.isAutoPlay!==void 0&&ce.isAutoPlay,Q.speed=ce.speed||4e3,Q.isInfiniteLoop=ce.isInfiniteLoop===void 0||ce.isInfiniteLoop,Q.isRTL=ce.isRTL!==void 0&&ce.isRTL,Q.inner=Q.el.querySelector(".hs-carousel-body")||null,Q.slides=Q.el.querySelectorAll(".hs-carousel-slide")||[],Q.prev=Q.el.querySelector(".hs-carousel-prev")||null,Q.next=Q.el.querySelector(".hs-carousel-next")||null,Q.dots=Q.el.querySelectorAll(".hs-carousel-pagination > *")||null,Q.sliderWidth=Q.inner.parentElement.clientWidth,Q.touchX={start:0,end:0},Q.init(),Q}return W(he,Ce),he.prototype.init=function(){var K,N,z=this;this.createCollection(window.$hsCarouselCollection,this),this.inner&&(this.calculateWidth(),this.loadingClassesRemove&&(typeof this.loadingClassesRemove=="string"?this.inner.classList.remove(this.loadingClassesRemove):(K=this.inner.classList).remove.apply(K,this.loadingClassesRemove)),this.loadingClassesAdd&&(typeof this.loadingClassesAdd=="string"?this.inner.classList.add(this.loadingClassesAdd):(N=this.inner.classList).add.apply(N,this.loadingClassesAdd))),this.prev&&this.prev.addEventListener("click",function(){z.goToPrev(),z.isAutoPlay&&(z.resetTimer(),z.setTimer())}),this.next&&this.next.addEventListener("click",function(){z.goToNext(),z.isAutoPlay&&(z.resetTimer(),z.setTimer())}),this.dots&&this.dots.forEach(function(q,G){return q.addEventListener("click",function(){z.goTo(G),z.isAutoPlay&&(z.resetTimer(),z.setTimer())})}),this.slides.length&&(this.addCurrentClass(),this.isInfiniteLoop||this.addDisabledClass(),this.isAutoPlay&&this.autoPlay()),this.inner&&this.afterLoadingClassesAdd&&setTimeout(function(){var q;typeof z.afterLoadingClassesAdd=="string"?z.inner.classList.add(z.afterLoadingClassesAdd):(q=z.inner.classList).add.apply(q,z.afterLoadingClassesAdd)}),this.el.classList.add("init"),this.el.addEventListener("touchstart",function(q){z.touchX.start=q.changedTouches[0].screenX}),this.el.addEventListener("touchend",function(q){z.touchX.end=q.changedTouches[0].screenX,z.detectDirection()}),this.observeResize()},he.prototype.observeResize=function(){var K=this;new ResizeObserver(function(){return K.recalculateWidth()}).observe(document.querySelector("body"))},he.prototype.calculateWidth=function(){var K=this;this.inner.style.width="".concat(this.sliderWidth*this.slides.length,"px"),this.inner.style.transform=this.calculateTransform(),this.slides.forEach(function(N){N.style.width="".concat(K.sliderWidth,"px")})},he.prototype.addCurrentClass=function(){var K=this;this.slides.forEach(function(N,z){z===K.currentIndex?N.classList.add("active"):N.classList.remove("active")}),this.dots&&this.dots.forEach(function(N,z){z===K.currentIndex?N.classList.add("active"):N.classList.remove("active")})},he.prototype.addDisabledClass=function(){if(!this.prev||!this.next)return!1;this.currentIndex===0?(this.next.classList.remove("disabled"),this.prev.classList.add("disabled")):this.currentIndex===this.slides.length-1?(this.prev.classList.remove("disabled"),this.next.classList.add("disabled")):(this.prev.classList.remove("disabled"),this.next.classList.remove("disabled"))},he.prototype.autoPlay=function(){this.setTimer()},he.prototype.setTimer=function(){var K=this;this.timer=setInterval(function(){K.currentIndex===K.slides.length-1?K.goTo(0):K.goToNext()},this.speed)},he.prototype.resetTimer=function(){clearInterval(this.timer)},he.prototype.detectDirection=function(){var K=this.touchX,N=K.start,z=K.end;z<N&&this.goToNext(),z>N&&this.goToPrev()},he.prototype.recalculateWidth=function(){this.sliderWidth=this.inner.parentElement.clientWidth,this.calculateWidth()},he.prototype.calculateTransform=function(){var K=this.currentIndex*this.sliderWidth;return this.isRTL?"translate(".concat(K,"px, 0px)"):"translate(-".concat(K,"px, 0px)")},he.prototype.goToPrev=function(){this.currentIndex===0&&this.isInfiniteLoop?(this.currentIndex=this.slides.length-1,this.inner.style.transform=this.calculateTransform(),this.addCurrentClass()):this.currentIndex!==0&&(this.currentIndex-=1,this.inner.style.transform=this.calculateTransform(),this.addCurrentClass(),this.addDisabledClass())},he.prototype.goToNext=function(){this.currentIndex===this.slides.length-1&&this.isInfiniteLoop?(this.currentIndex=0,this.inner.style.transform=this.calculateTransform(),this.addCurrentClass()):this.currentIndex<this.slides.length-1&&(this.currentIndex+=1,this.inner.style.transform=this.calculateTransform(),this.addCurrentClass(),this.addDisabledClass())},he.prototype.goTo=function(K){this.currentIndex=K,this.inner.style.transform=this.calculateTransform(),this.addCurrentClass(),this.isInfiniteLoop||this.addDisabledClass()},he.getInstance=function(K,N){var z=window.$hsCarouselCollection.find(function(q){return q.element.el===(typeof K=="string"?document.querySelector(K):K)});return z?N?z:z.element:null},he.autoInit=function(){window.$hsCarouselCollection||(window.$hsCarouselCollection=[]),document.querySelectorAll("[data-hs-carousel]:not(.--prevent-on-load-init)").forEach(function(K){window.$hsCarouselCollection.find(function(N){var z;return((z=N==null?void 0:N.element)===null||z===void 0?void 0:z.el)===K})||new he(K)})},he}(se(r(961)).default);window.addEventListener("load",function(){Ae.autoInit()}),window.addEventListener("resize",function(){if(!window.$hsCarouselCollection)return!1;window.$hsCarouselCollection.forEach(function(Ce){Ce.element.recalculateWidth()})}),typeof window<"u"&&(window.HSCarousel=Ae),O.default=Ae},485:function(E,O,r){/*
 * HSCollapse
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */var U,W=this&&this.__extends||(U=function(Ce,he){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(K,N){K.__proto__=N}||function(K,N){for(var z in N)Object.prototype.hasOwnProperty.call(N,z)&&(K[z]=N[z])},U(Ce,he)},function(Ce,he){if(typeof he!="function"&&he!==null)throw new TypeError("Class extends value "+String(he)+" is not a constructor or null");function K(){this.constructor=Ce}U(Ce,he),Ce.prototype=he===null?Object.create(he):(K.prototype=he.prototype,new K)}),Y=this&&this.__importDefault||function(Ce){return Ce&&Ce.__esModule?Ce:{default:Ce}};Object.defineProperty(O,"__esModule",{value:!0});var se=r(292),Ae=function(Ce){function he(K,N,z){var q=Ce.call(this,K,N,z)||this;return q.contentId=q.el.dataset.hsCollapse,q.content=document.querySelector(q.contentId),q.animationInProcess=!1,q.content&&q.init(),q}return W(he,Ce),he.prototype.init=function(){var K,N=this;this.createCollection(window.$hsCollapseCollection,this),!((K=this==null?void 0:this.el)===null||K===void 0)&&K.ariaExpanded&&(this.el.classList.contains("open")?this.el.ariaExpanded="true":this.el.ariaExpanded="false"),this.el.addEventListener("click",function(){N.content.classList.contains("open")?N.hide():N.show()})},he.prototype.hideAllMegaMenuItems=function(){this.content.querySelectorAll(".hs-mega-menu-content.block").forEach(function(K){K.classList.remove("block"),K.classList.add("hidden")})},he.prototype.show=function(){var K,N=this;if(this.animationInProcess||this.el.classList.contains("open"))return!1;this.animationInProcess=!0,this.el.classList.add("open"),!((K=this==null?void 0:this.el)===null||K===void 0)&&K.ariaExpanded&&(this.el.ariaExpanded="true"),this.content.classList.add("open"),this.content.classList.remove("hidden"),this.content.style.height="0",setTimeout(function(){N.content.style.height="".concat(N.content.scrollHeight,"px"),N.fireEvent("beforeOpen",N.el),(0,se.dispatch)("beforeOpen.hs.collapse",N.el,N.el)}),(0,se.afterTransition)(this.content,function(){N.content.style.height="",N.fireEvent("open",N.el),(0,se.dispatch)("open.hs.collapse",N.el,N.el),N.animationInProcess=!1})},he.prototype.hide=function(){var K,N=this;if(this.animationInProcess||!this.el.classList.contains("open"))return!1;this.animationInProcess=!0,this.el.classList.remove("open"),!((K=this==null?void 0:this.el)===null||K===void 0)&&K.ariaExpanded&&(this.el.ariaExpanded="false"),this.content.style.height="".concat(this.content.scrollHeight,"px"),setTimeout(function(){N.content.style.height="0"}),this.content.classList.remove("open"),(0,se.afterTransition)(this.content,function(){N.content.classList.add("hidden"),N.content.style.height="",N.fireEvent("hide",N.el),(0,se.dispatch)("hide.hs.collapse",N.el,N.el),N.animationInProcess=!1}),this.content.querySelectorAll(".hs-mega-menu-content.block").length&&this.hideAllMegaMenuItems()},he.getInstance=function(K,N){N===void 0&&(N=!1);var z=window.$hsCollapseCollection.find(function(q){return q.element.el===(typeof K=="string"?document.querySelector(K):K)});return z?N?z:z.element.el:null},he.autoInit=function(){window.$hsCollapseCollection||(window.$hsCollapseCollection=[]),document.querySelectorAll(".hs-collapse-toggle:not(.--prevent-on-load-init)").forEach(function(K){window.$hsCollapseCollection.find(function(N){var z;return((z=N==null?void 0:N.element)===null||z===void 0?void 0:z.el)===K})||new he(K)})},he.show=function(K){var N=window.$hsCollapseCollection.find(function(z){return z.element.el===(typeof K=="string"?document.querySelector(K):K)});N&&N.element.content.classList.contains("hidden")&&N.element.show()},he.hide=function(K){var N=window.$hsCollapseCollection.find(function(z){return z.element.el===(typeof K=="string"?document.querySelector(K):K)});N&&!N.element.content.classList.contains("hidden")&&N.element.hide()},he.on=function(K,N,z){var q=window.$hsCollapseCollection.find(function(G){return G.element.el===(typeof N=="string"?document.querySelector(N):N)});q&&(q.element.events[K]=z)},he}(Y(r(961)).default);window.addEventListener("load",function(){Ae.autoInit()}),typeof window<"u"&&(window.HSCollapse=Ae),O.default=Ae},809:function(E,O,r){/*
 * HSComboBox
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */var U,W=this&&this.__extends||(U=function(G,Q){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ee,fe){ee.__proto__=fe}||function(ee,fe){for(var ce in fe)Object.prototype.hasOwnProperty.call(fe,ce)&&(ee[ce]=fe[ce])},U(G,Q)},function(G,Q){if(typeof Q!="function"&&Q!==null)throw new TypeError("Class extends value "+String(Q)+" is not a constructor or null");function ee(){this.constructor=G}U(G,Q),G.prototype=Q===null?Object.create(Q):(ee.prototype=Q.prototype,new ee)}),Y=this&&this.__assign||function(){return Y=Object.assign||function(G){for(var Q,ee=1,fe=arguments.length;ee<fe;ee++)for(var ce in Q=arguments[ee])Object.prototype.hasOwnProperty.call(Q,ce)&&(G[ce]=Q[ce]);return G},Y.apply(this,arguments)},se=this&&this.__awaiter||function(G,Q,ee,fe){return new(ee||(ee=Promise))(function(ce,Ue){function He(xt){try{vt(fe.next(xt))}catch(Ot){Ue(Ot)}}function nt(xt){try{vt(fe.throw(xt))}catch(Ot){Ue(Ot)}}function vt(xt){var Ot;xt.done?ce(xt.value):(Ot=xt.value,Ot instanceof ee?Ot:new ee(function(Ui){Ui(Ot)})).then(He,nt)}vt((fe=fe.apply(G,Q||[])).next())})},Ae=this&&this.__generator||function(G,Q){var ee,fe,ce,Ue,He={label:0,sent:function(){if(1&ce[0])throw ce[1];return ce[1]},trys:[],ops:[]};return Ue={next:nt(0),throw:nt(1),return:nt(2)},typeof Symbol=="function"&&(Ue[Symbol.iterator]=function(){return this}),Ue;function nt(vt){return function(xt){return function(Ot){if(ee)throw new TypeError("Generator is already executing.");for(;Ue&&(Ue=0,Ot[0]&&(He=0)),He;)try{if(ee=1,fe&&(ce=2&Ot[0]?fe.return:Ot[0]?fe.throw||((ce=fe.return)&&ce.call(fe),0):fe.next)&&!(ce=ce.call(fe,Ot[1])).done)return ce;switch(fe=0,ce&&(Ot=[2&Ot[0],ce.value]),Ot[0]){case 0:case 1:ce=Ot;break;case 4:return He.label++,{value:Ot[1],done:!1};case 5:He.label++,fe=Ot[1],Ot=[0];continue;case 7:Ot=He.ops.pop(),He.trys.pop();continue;default:if(ce=He.trys,!((ce=ce.length>0&&ce[ce.length-1])||Ot[0]!==6&&Ot[0]!==2)){He=0;continue}if(Ot[0]===3&&(!ce||Ot[1]>ce[0]&&Ot[1]<ce[3])){He.label=Ot[1];break}if(Ot[0]===6&&He.label<ce[1]){He.label=ce[1],ce=Ot;break}if(ce&&He.label<ce[2]){He.label=ce[2],He.ops.push(Ot);break}ce[2]&&He.ops.pop(),He.trys.pop();continue}Ot=Q.call(G,He)}catch(Ui){Ot=[6,Ui],fe=0}finally{ee=ce=0}if(5&Ot[0])throw Ot[1];return{value:Ot[0]?Ot[1]:void 0,done:!0}}([vt,xt])}}},Ce=this&&this.__spreadArray||function(G,Q,ee){if(ee||arguments.length===2)for(var fe,ce=0,Ue=Q.length;ce<Ue;ce++)!fe&&ce in Q||(fe||(fe=Array.prototype.slice.call(Q,0,ce)),fe[ce]=Q[ce]);return G.concat(fe||Array.prototype.slice.call(Q))},he=this&&this.__importDefault||function(G){return G&&G.__esModule?G:{default:G}};Object.defineProperty(O,"__esModule",{value:!0});var K=r(292),N=he(r(961)),z=r(223),q=function(G){function Q(ee,fe,ce){var Ue,He,nt,vt,xt,Ot,Ui,Mt,_i,di,Un,Nn,Vi,Vr,Oi,ir,fn,At,Ri,Lr,si,zi,Qi,Sn,Co,fi=G.call(this,ee,fe,ce)||this,$r=ee.getAttribute("data-hs-combo-box"),Or=$r?JSON.parse($r):{},Hi=Y(Y({},Or),fe);return fi.gap=5,fi.viewport=(Ue=typeof(Hi==null?void 0:Hi.viewport)=="string"?document.querySelector(Hi==null?void 0:Hi.viewport):Hi==null?void 0:Hi.viewport)!==null&&Ue!==void 0?Ue:null,fi.preventVisibility=(He=Hi==null?void 0:Hi.preventVisibility)!==null&&He!==void 0&&He,fi.apiUrl=(nt=Hi==null?void 0:Hi.apiUrl)!==null&&nt!==void 0?nt:null,fi.apiDataPart=(vt=Hi==null?void 0:Hi.apiDataPart)!==null&&vt!==void 0?vt:null,fi.apiQuery=(xt=Hi==null?void 0:Hi.apiQuery)!==null&&xt!==void 0?xt:null,fi.apiSearchQuery=(Ot=Hi==null?void 0:Hi.apiSearchQuery)!==null&&Ot!==void 0?Ot:null,fi.apiHeaders=(Ui=Hi==null?void 0:Hi.apiHeaders)!==null&&Ui!==void 0?Ui:{},fi.apiGroupField=(Mt=Hi==null?void 0:Hi.apiGroupField)!==null&&Mt!==void 0?Mt:null,fi.outputItemTemplate=(_i=Hi==null?void 0:Hi.outputItemTemplate)!==null&&_i!==void 0?_i:`<div class="cursor-pointer py-2 px-4 w-full text-sm text-gray-800 hover:bg-gray-100 rounded-lg focus:outline-none focus:bg-gray-100 dark:bg-neutral-900 dark:hover:bg-neutral-800 dark:text-neutral-200 dark:focus:bg-neutral-800" data-hs-combo-box-output-item>
				<div class="flex justify-between items-center w-full">
					<span data-hs-combo-box-search-text></span>
					<span class="hidden hs-combo-box-selected:block">
						<svg class="shrink-0 size-3.5 text-blue-600 dark:text-blue-500" xmlns="http:.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<polyline points="20 6 9 17 4 12"></polyline>
						</svg>
					</span>
				</div>
			</div>`,fi.outputEmptyTemplate=(di=Hi==null?void 0:Hi.outputEmptyTemplate)!==null&&di!==void 0?di:'<div class="py-2 px-4 w-full text-sm text-gray-800 rounded-lg dark:bg-neutral-900 dark:text-neutral-200">Nothing found...</div>',fi.outputLoaderTemplate=(Un=Hi==null?void 0:Hi.outputLoaderTemplate)!==null&&Un!==void 0?Un:`<div class="flex justify-center items-center py-2 px-4 text-sm text-gray-800 rounded-lg bg-white dark:bg-neutral-900 dark:text-neutral-200">
				<div class="animate-spin inline-block size-6 border-[3px] border-current border-t-transparent text-blue-600 rounded-full dark:text-blue-500" role="status" aria-label="loading">
					<span class="sr-only">Loading...</span>
				</div>
			</div>`,fi.groupingType=(Nn=Hi==null?void 0:Hi.groupingType)!==null&&Nn!==void 0?Nn:null,fi.groupingTitleTemplate=(Vi=Hi==null?void 0:Hi.groupingTitleTemplate)!==null&&Vi!==void 0?Vi:fi.groupingType==="default"?'<div class="block mb-1 text-xs font-semibold uppercase text-blue-600 dark:text-blue-500"></div>':'<button type="button" class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-semibold whitespace-nowrap rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none"></button>',fi.tabsWrapperTemplate=(Vr=Hi==null?void 0:Hi.tabsWrapperTemplate)!==null&&Vr!==void 0?Vr:'<div class="overflow-x-auto p-4"></div>',fi.preventSelection=(Oi=Hi==null?void 0:Hi.preventSelection)!==null&&Oi!==void 0&&Oi,fi.preventAutoPosition=(ir=Hi==null?void 0:Hi.preventAutoPosition)!==null&&ir!==void 0&&ir,fi.isOpenOnFocus=(fn=Hi==null?void 0:Hi.isOpenOnFocus)!==null&&fn!==void 0&&fn,fi.input=(At=fi.el.querySelector("[data-hs-combo-box-input]"))!==null&&At!==void 0?At:null,fi.output=(Ri=fi.el.querySelector("[data-hs-combo-box-output]"))!==null&&Ri!==void 0?Ri:null,fi.itemsWrapper=(Lr=fi.el.querySelector("[data-hs-combo-box-output-items-wrapper]"))!==null&&Lr!==void 0?Lr:null,fi.items=(si=Array.from(fi.el.querySelectorAll("[data-hs-combo-box-output-item]")))!==null&&si!==void 0?si:[],fi.tabs=[],fi.toggle=(zi=fi.el.querySelector("[data-hs-combo-box-toggle]"))!==null&&zi!==void 0?zi:null,fi.toggleClose=(Qi=fi.el.querySelector("[data-hs-combo-box-close]"))!==null&&Qi!==void 0?Qi:null,fi.toggleOpen=(Sn=fi.el.querySelector("[data-hs-combo-box-open]"))!==null&&Sn!==void 0?Sn:null,fi.outputPlaceholder=null,fi.selected=fi.value=(Co=fi.el.querySelector("[data-hs-combo-box-input]").value)!==null&&Co!==void 0?Co:"",fi.isOpened=!1,fi.isCurrent=!1,fi.animationInProcess=!1,fi.selectedGroup="all",fi.init(),fi}return W(Q,G),Q.prototype.init=function(){this.createCollection(window.$hsComboBoxCollection,this),this.build()},Q.prototype.build=function(){this.buildInput(),this.groupingType&&this.setGroups(),this.buildItems(),this.preventVisibility&&(this.preventAutoPosition||this.recalculateDirection()),this.toggle&&this.buildToggle(),this.toggleClose&&this.buildToggleClose(),this.toggleOpen&&this.buildToggleOpen()},Q.prototype.setResultAndRender=function(ee){ee===void 0&&(ee="");var fe=this.preventVisibility?this.input.value:ee;this.setResults(fe),this.apiSearchQuery&&this.itemsFromJson()},Q.prototype.buildInput=function(){var ee=this;this.isOpenOnFocus&&this.input.addEventListener("focus",function(){ee.isOpened||(ee.setResultAndRender(),ee.open())}),this.input.addEventListener("input",(0,K.debounce)(function(fe){ee.setResultAndRender(fe.target.value),ee.input.value!==""?ee.el.classList.add("has-value"):ee.el.classList.remove("has-value"),ee.isOpened||ee.open()}))},Q.prototype.buildItems=function(){this.output.role="listbox",this.output.tabIndex=-1,this.output.ariaOrientation="vertical",this.apiUrl?this.itemsFromJson():(this.itemsWrapper?this.itemsWrapper.innerHTML="":this.output.innerHTML="",this.itemsFromHtml())},Q.prototype.setResults=function(ee){this.value=ee,this.resultItems(),this.hasVisibleItems()?this.destroyOutputPlaceholder():this.buildOutputPlaceholder()},Q.prototype.isItemExists=function(ee){return this.items.some(function(fe){var ce,Ue,He,nt=(ce=fe.getAttribute("data-hs-combo-box-output-item-group-field"))!==null&&ce!==void 0?ce:null,vt=(Ue=JSON.parse(fe.getAttribute("data-hs-combo-box-output-item")))!==null&&Ue!==void 0?Ue:null,xt=null;return nt&&(!((He=vt==null?void 0:vt.group)===null||He===void 0)&&He.name)&&(xt=ee[nt]),Array.from(fe.querySelectorAll("[data-hs-combo-box-search-text]")).some(function(Ot){var Ui;return!((Ui=vt==null?void 0:vt.group)===null||Ui===void 0)&&Ui.name&&xt?xt===vt.group.name&&Ot.getAttribute("data-hs-combo-box-search-text")===ee[Ot.getAttribute("data-hs-combo-box-output-item-field")]:Ot.getAttribute("data-hs-combo-box-search-text")===ee[Ot.getAttribute("data-hs-combo-box-output-item-field")]})})},Q.prototype.isTextExists=function(ee,fe){var ce=fe.map(function(Ue){return Ue.toLowerCase()});return Array.from(ee.querySelectorAll("[data-hs-combo-box-search-text]")).some(function(Ue){return ce.includes(Ue.getAttribute("data-hs-combo-box-search-text").toLowerCase())})},Q.prototype.isTextExistsAny=function(ee,fe){return Array.from(ee.querySelectorAll("[data-hs-combo-box-search-text]")).some(function(ce){return ce.getAttribute("data-hs-combo-box-search-text").toLowerCase().includes(fe.toLowerCase())})},Q.prototype.valuesBySelector=function(ee){return Array.from(ee.querySelectorAll("[data-hs-combo-box-search-text]")).reduce(function(fe,ce){return Ce(Ce([],fe,!0),[ce.getAttribute("data-hs-combo-box-search-text")],!1)},[])},Q.prototype.buildOutputLoader=function(){if(this.outputLoader)return!1;this.outputLoader=(0,K.htmlToElement)(this.outputLoaderTemplate),this.items.length||this.outputPlaceholder?(this.outputLoader.style.position="absolute",this.outputLoader.style.top="0",this.outputLoader.style.bottom="0",this.outputLoader.style.left="0",this.outputLoader.style.right="0",this.outputLoader.style.zIndex="2"):(this.outputLoader.style.position="",this.outputLoader.style.top="",this.outputLoader.style.bottom="",this.outputLoader.style.left="",this.outputLoader.style.right="",this.outputLoader.style.zIndex="",this.outputLoader.style.height="30px"),this.output.append(this.outputLoader)},Q.prototype.destroyOutputLoader=function(){this.outputLoader&&this.outputLoader.remove(),this.outputLoader=null},Q.prototype.itemsFromJson=function(){return se(this,void 0,void 0,function(){var ee,fe,ce,Ue,He,nt=this;return Ae(this,function(vt){switch(vt.label){case 0:this.buildOutputLoader(),vt.label=1;case 1:return vt.trys.push([1,4,,5]),ee="".concat(this.apiQuery),fe="".concat(this.apiSearchQuery,"=").concat(this.value.toLowerCase()),ce=this.apiUrl,this.apiQuery&&this.apiSearchQuery?ce+="?".concat(fe,"&").concat(ee):this.apiQuery?ce+="?".concat(ee):this.apiSearchQuery&&(ce+="?".concat(fe)),[4,fetch(ce,this.apiHeaders)];case 2:return[4,vt.sent().json()];case 3:return Ue=vt.sent(),this.apiDataPart&&(Ue=Ue[this.apiDataPart]),this.apiSearchQuery&&(this.items=[]),this.itemsWrapper?this.itemsWrapper.innerHTML="":this.output.innerHTML="",this.groupingType==="tabs"?(this.setApiGroups(Ue),this.groupTabsRender(),this.jsonItemsRender(Ue)):this.groupingType==="default"?(this.setApiGroups(Ue),this.groups.forEach(function(xt){var Ot=(0,K.htmlToElement)(nt.groupingTitleTemplate);Ot.setAttribute("data-hs-combo-box-group-title",xt.name),Ot.classList.add("--exclude-accessibility"),Ot.innerText=xt.title;var Ui=Ue.filter(function(Mt){return Mt[nt.apiGroupField]===xt.name});nt.itemsWrapper?nt.itemsWrapper.append(Ot):nt.output.append(Ot),nt.jsonItemsRender(Ui)})):this.jsonItemsRender(Ue),this.setResults(this.input.value),[3,5];case 4:return He=vt.sent(),console.error(He),[3,5];case 5:return this.destroyOutputLoader(),[2]}})})},Q.prototype.jsonItemsRender=function(ee){var fe=this;ee.forEach(function(ce,Ue){var He=(0,K.htmlToElement)(fe.outputItemTemplate);He.querySelectorAll("[data-hs-combo-box-output-item-field]").forEach(function(nt){var vt=ce[nt.getAttribute("data-hs-combo-box-output-item-field")],xt=nt.hasAttribute("data-hs-combo-box-output-item-hide-if-empty");nt.textContent=vt??"",!vt&&xt&&(nt.style.display="none")}),He.querySelectorAll("[data-hs-combo-box-search-text]").forEach(function(nt){var vt;nt.setAttribute("data-hs-combo-box-search-text",(vt=ce[nt.getAttribute("data-hs-combo-box-output-item-field")])!==null&&vt!==void 0?vt:"")}),He.querySelectorAll("[data-hs-combo-box-output-item-attr]").forEach(function(nt){JSON.parse(nt.getAttribute("data-hs-combo-box-output-item-attr")).forEach(function(vt){nt.setAttribute(vt.attr,ce[vt.valueFrom])})}),He.setAttribute("tabIndex","".concat(Ue)),fe.groupingType!=="tabs"&&fe.groupingType!=="default"||He.setAttribute("data-hs-combo-box-output-item",'{"group": {"name": "'.concat(ce[fe.apiGroupField],'", "title": "').concat(ce[fe.apiGroupField],'"}}')),fe.items=Ce(Ce([],fe.items,!0),[He],!1),fe.preventSelection||He.addEventListener("click",function(){fe.close(He.querySelector("[data-hs-combo-box-value]").getAttribute("data-hs-combo-box-search-text")),fe.setSelectedByValue(fe.valuesBySelector(He))}),fe.appendItemsToWrapper(He)})},Q.prototype.setGroups=function(){var ee=[];this.items.forEach(function(fe){var ce=JSON.parse(fe.getAttribute("data-hs-combo-box-output-item")).group;ee.some(function(Ue){return(Ue==null?void 0:Ue.name)===ce.name})||ee.push(ce)}),this.groups=ee},Q.prototype.setCurrent=function(){window.$hsComboBoxCollection.length&&(window.$hsComboBoxCollection.map(function(ee){return ee.element.isCurrent=!1}),this.isCurrent=!0)},Q.prototype.setApiGroups=function(ee){var fe=this,ce=[];ee.forEach(function(Ue){var He=Ue[fe.apiGroupField];ce.some(function(nt){return nt.name===He})||ce.push({name:He,title:He})}),this.groups=ce},Q.prototype.sortItems=function(){return this.items.sort(function(ee,fe){var ce=ee.querySelector("[data-hs-combo-box-value]").getAttribute("data-hs-combo-box-search-text"),Ue=fe.querySelector("[data-hs-combo-box-value]").getAttribute("data-hs-combo-box-search-text");return ce<Ue?-1:ce>Ue?1:0})},Q.prototype.itemRender=function(ee){var fe=this,ce=ee.querySelector("[data-hs-combo-box-value]").getAttribute("data-hs-combo-box-search-text");this.itemsWrapper?this.itemsWrapper.append(ee):this.output.append(ee),this.preventSelection||ee.addEventListener("click",function(){fe.close(ce),fe.setSelectedByValue(fe.valuesBySelector(ee))})},Q.prototype.plainRender=function(ee){var fe=this;ee.forEach(function(ce){fe.itemRender(ce)})},Q.prototype.groupTabsRender=function(){var ee=this,fe=(0,K.htmlToElement)(this.tabsWrapperTemplate),ce=(0,K.htmlToElement)('<div class="flex flex-nowrap gap-x-2"></div>');fe.append(ce),this.output.insertBefore(fe,this.output.firstChild);var Ue=(0,K.htmlToElement)(this.groupingTitleTemplate);Ue.setAttribute("data-hs-combo-box-group-title","all"),Ue.classList.add("--exclude-accessibility","active"),Ue.innerText="All",this.tabs=Ce(Ce([],this.tabs,!0),[Ue],!1),ce.append(Ue),Ue.addEventListener("click",function(){ee.selectedGroup="all";var He=ee.tabs.find(function(nt){return nt.getAttribute("data-hs-combo-box-group-title")===ee.selectedGroup});ee.tabs.forEach(function(nt){return nt.classList.remove("active")}),He.classList.add("active"),ee.setItemsVisibility()}),this.groups.forEach(function(He){var nt=(0,K.htmlToElement)(ee.groupingTitleTemplate);nt.setAttribute("data-hs-combo-box-group-title",He.name),nt.classList.add("--exclude-accessibility"),nt.innerText=He.title,ee.tabs=Ce(Ce([],ee.tabs,!0),[nt],!1),ce.append(nt),nt.addEventListener("click",function(){ee.selectedGroup=He.name;var vt=ee.tabs.find(function(xt){return xt.getAttribute("data-hs-combo-box-group-title")===ee.selectedGroup});ee.tabs.forEach(function(xt){return xt.classList.remove("active")}),vt.classList.add("active"),ee.setItemsVisibility()})})},Q.prototype.groupDefaultRender=function(){var ee=this;this.groups.forEach(function(fe){var ce=(0,K.htmlToElement)(ee.groupingTitleTemplate);ce.setAttribute("data-hs-combo-box-group-title",fe.name),ce.classList.add("--exclude-accessibility"),ce.innerText=fe.title,ee.itemsWrapper?ee.itemsWrapper.append(ce):ee.output.append(ce);var Ue=ee.sortItems().filter(function(He){return JSON.parse(He.getAttribute("data-hs-combo-box-output-item")).group.name===fe.name});ee.plainRender(Ue)})},Q.prototype.itemsFromHtml=function(){if(this.groupingType==="default")this.groupDefaultRender();else if(this.groupingType==="tabs"){var ee=this.sortItems();this.groupTabsRender(),this.plainRender(ee)}else ee=this.sortItems(),this.plainRender(ee);this.setResults(this.input.value)},Q.prototype.buildToggle=function(){var ee,fe,ce,Ue,He=this;this.isOpened?(!((ee=this==null?void 0:this.toggle)===null||ee===void 0)&&ee.ariaExpanded&&(this.toggle.ariaExpanded="true"),!((fe=this==null?void 0:this.input)===null||fe===void 0)&&fe.ariaExpanded&&(this.input.ariaExpanded="true")):(!((ce=this==null?void 0:this.toggle)===null||ce===void 0)&&ce.ariaExpanded&&(this.toggle.ariaExpanded="false"),!((Ue=this==null?void 0:this.input)===null||Ue===void 0)&&Ue.ariaExpanded&&(this.input.ariaExpanded="false")),this.toggle.addEventListener("click",function(){He.isOpened?He.close():He.open(He.toggle.getAttribute("data-hs-combo-box-toggle"))})},Q.prototype.buildToggleClose=function(){var ee=this;this.toggleClose.addEventListener("click",function(){return ee.close()})},Q.prototype.buildToggleOpen=function(){var ee=this;this.toggleOpen.addEventListener("click",function(){return ee.open()})},Q.prototype.setSelectedByValue=function(ee){var fe=this;this.items.forEach(function(ce){fe.isTextExists(ce,ee)?ce.classList.add("selected"):ce.classList.remove("selected")})},Q.prototype.setValue=function(ee){this.selected=ee,this.value=ee,this.input.value=ee,this.fireEvent("select",this.el),(0,K.dispatch)("select.hs.combobox",this.el,this.value)},Q.prototype.setItemsVisibility=function(){var ee=this;this.groupingType==="tabs"&&this.selectedGroup!=="all"&&this.items.forEach(function(ce){ce.style.display="none"});var fe=this.groupingType==="tabs"?this.selectedGroup==="all"?this.items:this.items.filter(function(ce){return JSON.parse(ce.getAttribute("data-hs-combo-box-output-item")).group.name===ee.selectedGroup}):this.items;this.groupingType==="tabs"&&this.selectedGroup!=="all"&&fe.forEach(function(ce){ce.style.display="block"}),fe.forEach(function(ce){ee.isTextExistsAny(ce,ee.value)?ce.style.display="block":ce.style.display="none"}),this.groupingType==="default"&&this.output.querySelectorAll("[data-hs-combo-box-group-title]").forEach(function(ce){var Ue=ce.getAttribute("data-hs-combo-box-group-title");ee.items.filter(function(He){return JSON.parse(He.getAttribute("data-hs-combo-box-output-item")).group.name===Ue&&He.style.display==="block"}).length?ce.style.display="block":ce.style.display="none"})},Q.prototype.hasVisibleItems=function(){return!!this.items.length&&this.items.some(function(ee){return ee.style.display==="block"})},Q.prototype.appendItemsToWrapper=function(ee){this.itemsWrapper?this.itemsWrapper.append(ee):this.output.append(ee)},Q.prototype.buildOutputPlaceholder=function(){this.outputPlaceholder||(this.outputPlaceholder=(0,K.htmlToElement)(this.outputEmptyTemplate)),this.appendItemsToWrapper(this.outputPlaceholder)},Q.prototype.destroyOutputPlaceholder=function(){this.outputPlaceholder&&this.outputPlaceholder.remove(),this.outputPlaceholder=null},Q.prototype.resultItems=function(){if(!this.items.length)return!1;this.setItemsVisibility(),this.setSelectedByValue([this.selected])},Q.prototype.setValueAndOpen=function(ee){this.value=ee,this.items.length&&this.setItemsVisibility()},Q.prototype.open=function(ee){var fe=this;return!this.animationInProcess&&(ee!==void 0&&this.setValueAndOpen(ee),!this.preventVisibility&&(this.animationInProcess=!0,this.output.style.display="block",this.preventAutoPosition||this.recalculateDirection(),setTimeout(function(){var ce,Ue;!((ce=fe==null?void 0:fe.input)===null||ce===void 0)&&ce.ariaExpanded&&(fe.input.ariaExpanded="true"),!((Ue=fe==null?void 0:fe.toggle)===null||Ue===void 0)&&Ue.ariaExpanded&&(fe.toggle.ariaExpanded="true"),fe.el.classList.add("active"),fe.animationInProcess=!1}),void(this.isOpened=!0)))},Q.prototype.setValueAndClear=function(ee){ee?this.setValue(ee):this.setValue(this.selected),this.outputPlaceholder&&this.destroyOutputPlaceholder()},Q.prototype.close=function(ee){var fe,ce,Ue=this;return!this.animationInProcess&&(this.preventVisibility?(this.setValueAndClear(ee),this.input.value!==""?this.el.classList.add("has-value"):this.el.classList.remove("has-value"),!1):(this.animationInProcess=!0,!((fe=this==null?void 0:this.input)===null||fe===void 0)&&fe.ariaExpanded&&(this.input.ariaExpanded="false"),!((ce=this==null?void 0:this.toggle)===null||ce===void 0)&&ce.ariaExpanded&&(this.toggle.ariaExpanded="false"),this.el.classList.remove("active"),this.preventAutoPosition||(this.output.classList.remove("bottom-full","top-full"),this.output.style.marginTop="",this.output.style.marginBottom=""),(0,K.afterTransition)(this.output,function(){Ue.output.style.display="none",Ue.setValueAndClear(ee),Ue.animationInProcess=!1}),this.input.value!==""?this.el.classList.add("has-value"):this.el.classList.remove("has-value"),void(this.isOpened=!1)))},Q.prototype.recalculateDirection=function(){(0,K.isEnoughSpace)(this.output,this.input,"bottom",this.gap,this.viewport)?(this.output.classList.remove("bottom-full"),this.output.style.marginBottom="",this.output.classList.add("top-full"),this.output.style.marginTop="".concat(this.gap,"px")):(this.output.classList.remove("top-full"),this.output.style.marginTop="",this.output.classList.add("bottom-full"),this.output.style.marginBottom="".concat(this.gap,"px"))},Q.getInstance=function(ee,fe){var ce=window.$hsComboBoxCollection.find(function(Ue){return Ue.element.el===(typeof ee=="string"?document.querySelector(ee):ee)});return ce?fe?ce:ce.element:null},Q.autoInit=function(){window.$hsComboBoxCollection||(window.$hsComboBoxCollection=[]),document.querySelectorAll("[data-hs-combo-box]:not(.--prevent-on-load-init)").forEach(function(ee){if(!window.$hsComboBoxCollection.find(function(Ue){var He;return((He=Ue==null?void 0:Ue.element)===null||He===void 0?void 0:He.el)===ee})){var fe=ee.getAttribute("data-hs-combo-box"),ce=fe?JSON.parse(fe):{};new Q(ee,ce)}}),window.$hsComboBoxCollection&&(window.addEventListener("click",function(ee){var fe=ee.target;Q.closeCurrentlyOpened(fe)}),document.addEventListener("keydown",function(ee){return Q.accessibility(ee)}))},Q.close=function(ee){var fe=window.$hsComboBoxCollection.find(function(ce){return ce.element.el===(typeof ee=="string"?document.querySelector(ee):ee)});fe&&fe.element.isOpened&&fe.element.close()},Q.closeCurrentlyOpened=function(ee){if(ee===void 0&&(ee=null),!ee.closest("[data-hs-combo-box].active")){var fe=window.$hsComboBoxCollection.filter(function(ce){return ce.element.isOpened})||null;fe&&fe.forEach(function(ce){ce.element.close()})}},Q.getPreparedItems=function(ee,fe){return ee===void 0&&(ee=!1),fe?(ee?Array.from(fe.querySelectorAll(":scope > *:not(.--exclude-accessibility)")).filter(function(ce){return ce.style.display!=="none"}).reverse():Array.from(fe.querySelectorAll(":scope > *:not(.--exclude-accessibility)")).filter(function(ce){return ce.style.display!=="none"})).filter(function(ce){return!ce.classList.contains("disabled")}):null},Q.setHighlighted=function(ee,fe,ce){fe.focus(),ce.value=fe.querySelector("[data-hs-combo-box-value]").getAttribute("data-hs-combo-box-search-text"),ee&&ee.classList.remove("hs-combo-box-output-item-highlighted"),fe.classList.add("hs-combo-box-output-item-highlighted")},Q.accessibility=function(ee){if(window.$hsComboBoxCollection.find(function(fe){return fe.element.preventVisibility?fe.element.isCurrent:fe.element.isOpened})&&z.COMBO_BOX_ACCESSIBILITY_KEY_SET.includes(ee.code)&&!ee.metaKey)switch(ee.code){case"Escape":ee.preventDefault(),this.onEscape();break;case"ArrowUp":ee.preventDefault(),ee.stopImmediatePropagation(),this.onArrow();break;case"ArrowDown":ee.preventDefault(),ee.stopImmediatePropagation(),this.onArrow(!1);break;case"Home":ee.preventDefault(),ee.stopImmediatePropagation(),this.onStartEnd();break;case"End":ee.preventDefault(),ee.stopImmediatePropagation(),this.onStartEnd(!1);break;case"Enter":ee.preventDefault(),this.onEnter(ee)}},Q.onEscape=function(){var ee=window.$hsComboBoxCollection.find(function(fe){return!fe.element.preventVisibility&&fe.element.isOpened});ee&&(ee.element.close(),ee.element.input.blur())},Q.onArrow=function(ee){var fe;ee===void 0&&(ee=!0);var ce=window.$hsComboBoxCollection.find(function(Ot){return Ot.element.preventVisibility?Ot.element.isCurrent:Ot.element.isOpened});if(ce){var Ue=(fe=ce.element.itemsWrapper)!==null&&fe!==void 0?fe:ce.element.output;if(!Ue)return!1;var He,nt=Q.getPreparedItems(ee,Ue),vt=Ue.querySelector(".hs-combo-box-output-item-highlighted");vt||nt[0].classList.add("hs-combo-box-output-item-highlighted");var xt=nt.findIndex(function(Ot){return Ot===vt});xt+1<nt.length&&xt++,He=nt[xt],Q.setHighlighted(vt,He,ce.element.input)}},Q.onStartEnd=function(ee){var fe;ee===void 0&&(ee=!0);var ce=window.$hsComboBoxCollection.find(function(vt){return vt.element.preventVisibility?vt.element.isCurrent:vt.element.isOpened});if(ce){var Ue=(fe=ce.element.itemsWrapper)!==null&&fe!==void 0?fe:ce.element.output;if(!Ue)return!1;var He=Q.getPreparedItems(ee,Ue),nt=Ue.querySelector(".hs-combo-box-output-item-highlighted");He.length&&Q.setHighlighted(nt,He[0],ce.element.input)}},Q.onEnter=function(ee){var fe=ee.target,ce=window.$hsComboBoxCollection.find(function(He){return!(0,K.isParentOrElementHidden)(He.element.el)&&ee.target.closest("[data-hs-combo-box]")===He.element.el}),Ue=ce.element.el.querySelector(".hs-combo-box-output-item-highlighted a");fe.hasAttribute("data-hs-combo-box-input")?(ce.element.close(),fe.blur()):(ce.element.preventSelection||ce.element.setSelectedByValue(ce.element.valuesBySelector(ee.target)),ce.element.preventSelection&&Ue&&window.location.assign(Ue.getAttribute("href")),ce.element.close(ce.element.preventSelection?null:ee.target.querySelector("[data-hs-combo-box-value]").getAttribute("data-hs-combo-box-search-text")))},Q}(N.default);window.addEventListener("load",function(){q.autoInit()}),document.addEventListener("scroll",function(){if(!window.$hsComboBoxCollection)return!1;var G=window.$hsComboBoxCollection.find(function(Q){return Q.element.isOpened});G&&!G.element.preventAutoPosition&&G.element.recalculateDirection()}),typeof window<"u"&&(window.HSComboBox=q),O.default=q},406:function(E,O,r){/*
 * HSCopyMarkup
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */var U,W=this&&this.__extends||(U=function(he,K){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,z){N.__proto__=z}||function(N,z){for(var q in z)Object.prototype.hasOwnProperty.call(z,q)&&(N[q]=z[q])},U(he,K)},function(he,K){if(typeof K!="function"&&K!==null)throw new TypeError("Class extends value "+String(K)+" is not a constructor or null");function N(){this.constructor=he}U(he,K),he.prototype=K===null?Object.create(K):(N.prototype=K.prototype,new N)}),Y=this&&this.__assign||function(){return Y=Object.assign||function(he){for(var K,N=1,z=arguments.length;N<z;N++)for(var q in K=arguments[N])Object.prototype.hasOwnProperty.call(K,q)&&(he[q]=K[q]);return he},Y.apply(this,arguments)},se=this&&this.__importDefault||function(he){return he&&he.__esModule?he:{default:he}};Object.defineProperty(O,"__esModule",{value:!0});var Ae=r(292),Ce=function(he){function K(N,z){var q=he.call(this,N,z)||this,G=N.getAttribute("data-hs-copy-markup"),Q=G?JSON.parse(G):{},ee=Y(Y({},Q),z);return q.targetSelector=(ee==null?void 0:ee.targetSelector)||null,q.wrapperSelector=(ee==null?void 0:ee.wrapperSelector)||null,q.limit=(ee==null?void 0:ee.limit)||null,q.items=[],q.targetSelector&&q.init(),q}return W(K,he),K.prototype.init=function(){var N=this;this.createCollection(window.$hsCopyMarkupCollection,this),this.setTarget(),this.setWrapper(),this.addPredefinedItems(),this.el.addEventListener("click",function(){return N.copy()})},K.prototype.copy=function(){if(this.limit&&this.items.length>=this.limit)return!1;this.el.hasAttribute("disabled")&&this.el.setAttribute("disabled","");var N=this.target.cloneNode(!0);this.addToItems(N),this.limit&&this.items.length>=this.limit&&this.el.setAttribute("disabled","disabled"),this.fireEvent("copy",N),(0,Ae.dispatch)("copy.hs.copyMarkup",N,N)},K.prototype.addPredefinedItems=function(){var N=this;Array.from(this.wrapper.children).filter(function(z){return!z.classList.contains("[--ignore-for-count]")}).forEach(function(z){N.addToItems(z)})},K.prototype.setTarget=function(){var N=typeof this.targetSelector=="string"?document.querySelector(this.targetSelector).cloneNode(!0):this.targetSelector.cloneNode(!0);N.removeAttribute("id"),this.target=N},K.prototype.setWrapper=function(){this.wrapper=typeof this.wrapperSelector=="string"?document.querySelector(this.wrapperSelector):this.wrapperSelector},K.prototype.addToItems=function(N){var z=this,q=N.querySelector("[data-hs-copy-markup-delete-item]");this.wrapper?this.wrapper.append(N):this.el.before(N),q&&q.addEventListener("click",function(){return z.delete(N)}),this.items.push(N)},K.prototype.delete=function(N){var z=this.items.indexOf(N);z!==-1&&this.items.splice(z,1),N.remove(),this.fireEvent("delete",N),(0,Ae.dispatch)("delete.hs.copyMarkup",N,N)},K.getInstance=function(N,z){var q=window.$hsCopyMarkupCollection.find(function(G){return G.element.el===(typeof N=="string"?document.querySelector(N):N)});return q?z?q:q.element:null},K.autoInit=function(){window.$hsCopyMarkupCollection||(window.$hsCopyMarkupCollection=[]),document.querySelectorAll("[data-hs-copy-markup]:not(.--prevent-on-load-init)").forEach(function(N){if(!window.$hsCopyMarkupCollection.find(function(G){var Q;return((Q=G==null?void 0:G.element)===null||Q===void 0?void 0:Q.el)===N})){var z=N.getAttribute("data-hs-copy-markup"),q=z?JSON.parse(z):{};new K(N,q)}})},K}(se(r(961)).default);window.addEventListener("load",function(){Ce.autoInit()}),typeof window<"u"&&(window.HSCopyMarkup=Ce),O.default=Ce},814:function(E,O,r){/*
 * HSDataTable
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */var U,W=this&&this.__extends||(U=function(K,N){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(z,q){z.__proto__=q}||function(z,q){for(var G in q)Object.prototype.hasOwnProperty.call(q,G)&&(z[G]=q[G])},U(K,N)},function(K,N){if(typeof N!="function"&&N!==null)throw new TypeError("Class extends value "+String(N)+" is not a constructor or null");function z(){this.constructor=K}U(K,N),K.prototype=N===null?Object.create(N):(z.prototype=N.prototype,new z)}),Y=this&&this.__assign||function(){return Y=Object.assign||function(K){for(var N,z=1,q=arguments.length;z<q;z++)for(var G in N=arguments[z])Object.prototype.hasOwnProperty.call(N,G)&&(K[G]=N[G]);return K},Y.apply(this,arguments)},se=this&&this.__spreadArray||function(K,N,z){if(z||arguments.length===2)for(var q,G=0,Q=N.length;G<Q;G++)!q&&G in N||(q||(q=Array.prototype.slice.call(N,0,G)),q[G]=N[G]);return K.concat(q||Array.prototype.slice.call(N))},Ae=this&&this.__importDefault||function(K){return K&&K.__esModule?K:{default:K}};Object.defineProperty(O,"__esModule",{value:!0});var Ce=r(292),he=function(K){function N(z,q,G){var Q,ee,fe,ce,Ue,He,nt,vt,xt,Ot,Ui,Mt,_i,di,Un,Nn,Vi,Vr,Oi,ir,fn,At,Ri,Lr,si,zi=K.call(this,z,q,G)||this;zi.el=typeof z=="string"?document.querySelector(z):z;var Qi=[];Array.from(zi.el.querySelectorAll("thead th, thead td")).forEach(function(fi,$r){fi.classList.contains("--exclude-from-ordering")&&Qi.push({targets:$r,orderable:!1})});var Sn=zi.el.getAttribute("data-hs-datatable"),Co=Sn?JSON.parse(Sn):{};return zi.concatOptions=Y(Y({searching:!0,lengthChange:!1,order:[],columnDefs:se([],Qi,!0)},Co),q),zi.table=zi.el.querySelector("table"),zi.search=(Q=zi.el.querySelector("[data-hs-datatable-search]"))!==null&&Q!==void 0?Q:null,zi.pageEntities=(ee=zi.el.querySelector("[data-hs-datatable-page-entities]"))!==null&&ee!==void 0?ee:null,zi.paging=(fe=zi.el.querySelector("[data-hs-datatable-paging]"))!==null&&fe!==void 0?fe:null,zi.pagingPrev=(ce=zi.el.querySelector("[data-hs-datatable-paging-prev]"))!==null&&ce!==void 0?ce:null,zi.pagingNext=(Ue=zi.el.querySelector("[data-hs-datatable-paging-next]"))!==null&&Ue!==void 0?Ue:null,zi.pagingPages=(He=zi.el.querySelector("[data-hs-datatable-paging-pages]"))!==null&&He!==void 0?He:null,zi.info=(nt=zi.el.querySelector("[data-hs-datatable-info]"))!==null&&nt!==void 0?nt:null,zi.infoFrom=(vt=zi.el.querySelector("[data-hs-datatable-info-from]"))!==null&&vt!==void 0?vt:null,zi.infoTo=(xt=zi.el.querySelector("[data-hs-datatable-info-to]"))!==null&&xt!==void 0?xt:null,zi.infoLength=(Ot=zi.el.querySelector("[data-hs-datatable-info-length]"))!==null&&Ot!==void 0?Ot:null,!((Ui=zi.concatOptions)===null||Ui===void 0)&&Ui.rowSelectingOptions&&(zi.rowSelectingAll=(Nn=!((_i=(Mt=zi.concatOptions)===null||Mt===void 0?void 0:Mt.rowSelectingOptions)===null||_i===void 0)&&_i.selectAllSelector?document.querySelector((Un=(di=zi.concatOptions)===null||di===void 0?void 0:di.rowSelectingOptions)===null||Un===void 0?void 0:Un.selectAllSelector):document.querySelector("[data-hs-datatable-row-selecting-all]"))!==null&&Nn!==void 0?Nn:null),!((Vi=zi.concatOptions)===null||Vi===void 0)&&Vi.rowSelectingOptions&&(zi.rowSelectingIndividual=(fn=(ir=(Oi=(Vr=zi.concatOptions)===null||Vr===void 0?void 0:Vr.rowSelectingOptions)===null||Oi===void 0?void 0:Oi.individualSelector)!==null&&ir!==void 0?ir:"[data-hs-datatable-row-selecting-individual]")!==null&&fn!==void 0?fn:null),zi.pageEntities&&(zi.concatOptions.pageLength=parseInt(zi.pageEntities.value)),zi.maxPagesToShow=3,zi.isRowSelecting=!!(!((At=zi.concatOptions)===null||At===void 0)&&At.rowSelectingOptions),zi.pageBtnClasses=(si=(Lr=(Ri=zi.concatOptions)===null||Ri===void 0?void 0:Ri.pagingOptions)===null||Lr===void 0?void 0:Lr.pageBtnClasses)!==null&&si!==void 0?si:null,zi.init(),zi}return W(N,K),N.prototype.init=function(){this.createCollection(window.$hsDataTableCollection,this),this.initTable(),this.search&&this.initSearch(),this.pageEntities&&this.initPageEntities(),this.paging&&this.initPaging(),this.pagingPrev&&this.initPagingPrev(),this.pagingNext&&this.initPagingNext(),this.pagingPages&&this.buildPagingPages(),this.info&&this.initInfo(),this.isRowSelecting&&this.initRowSelecting()},N.prototype.initTable=function(){var z=this;this.dataTable=new DataTable(this.table,this.concatOptions),this.isRowSelecting&&this.triggerChangeEventToRow(),this.dataTable.on("draw",function(){z.isRowSelecting&&z.updateSelectAllCheckbox(),z.isRowSelecting&&z.triggerChangeEventToRow(),z.updateInfo(),z.updatePaging()})},N.prototype.initSearch=function(){var z=this;this.search.addEventListener("input",(0,Ce.debounce)(function(q){return z.onSearchInput(q.target.value)}))},N.prototype.onSearchInput=function(z){this.dataTable.search(z).draw()},N.prototype.initPageEntities=function(){var z=this;this.pageEntities.addEventListener("change",function(q){return z.onEntitiesChange(parseInt(q.target.value))})},N.prototype.onEntitiesChange=function(z){this.dataTable.page.len(z).draw()},N.prototype.initInfo=function(){this.infoFrom&&this.initInfoFrom(),this.infoTo&&this.initInfoTo(),this.infoLength&&this.initInfoLength()},N.prototype.initInfoFrom=function(){var z=this.dataTable.page.info().start;this.infoFrom.innerText="".concat(z+1)},N.prototype.initInfoTo=function(){var z=this.dataTable.page.info().end;this.infoTo.innerText="".concat(z)},N.prototype.initInfoLength=function(){var z=this.dataTable.page.info().recordsTotal;this.infoLength.innerText="".concat(z)},N.prototype.updateInfo=function(){this.initInfo()},N.prototype.initPaging=function(){this.hidePagingIfSinglePage()},N.prototype.hidePagingIfSinglePage=function(){this.dataTable.page.info().pages<2?(this.paging.classList.add("hidden"),this.paging.style.display="none"):(this.paging.classList.remove("hidden"),this.paging.style.display="")},N.prototype.initPagingPrev=function(){var z=this;this.pagingPrev.addEventListener("click",function(){z.onPrevClick()})},N.prototype.onPrevClick=function(){this.dataTable.page("previous").draw("page")},N.prototype.disablePagingArrow=function(z,q){q?(z.classList.add("disabled"),z.setAttribute("disabled","disabled")):(z.classList.remove("disabled"),z.removeAttribute("disabled"))},N.prototype.initPagingNext=function(){var z=this;this.pagingNext.addEventListener("click",function(){z.onNextClick()})},N.prototype.onNextClick=function(){this.dataTable.page("next").draw("page")},N.prototype.buildPagingPages=function(){this.updatePaging()},N.prototype.updatePaging=function(){var z=this.dataTable.page.info(),q=z.page,G=z.pages,Q=z.length,ee=this.dataTable.rows({search:"applied"}).count(),fe=Math.ceil(ee/Q),ce=q+1,Ue=Math.max(1,ce-Math.floor(this.maxPagesToShow/2)),He=Math.min(fe,Ue+(this.maxPagesToShow-1));He-Ue+1<this.maxPagesToShow&&(Ue=Math.max(1,He-this.maxPagesToShow+1)),this.pagingPages.innerHTML="",Ue>1&&(this.buildPagingPage(1),Ue>2&&this.pagingPages.appendChild((0,Ce.htmlToElement)('<span class="ellipsis">...</span>')));for(var nt=Ue;nt<=He;nt++)this.buildPagingPage(nt);He<fe&&(He<fe-1&&this.pagingPages.appendChild((0,Ce.htmlToElement)('<span class="ellipsis">...</span>')),this.buildPagingPage(fe)),this.disablePagingArrow(this.pagingPrev,q===0),this.disablePagingArrow(this.pagingNext,q===G-1),this.hidePagingIfSinglePage()},N.prototype.buildPagingPage=function(z){var q=this,G=this.dataTable.page.info().page,Q=(0,Ce.htmlToElement)('<button type="button"></button>');Q.innerText="".concat(z),Q.setAttribute("data-page","".concat(z)),this.pageBtnClasses&&(0,Ce.classToClassList)(this.pageBtnClasses,Q),G===z-1&&Q.classList.add("active"),Q.addEventListener("click",function(){return q.onPageClick(z)}),this.pagingPages.append(Q)},N.prototype.onPageClick=function(z){this.dataTable.page(z-1).draw("page")},N.prototype.initRowSelecting=function(){var z=this;this.rowSelectingAll.addEventListener("change",function(){return z.onSelectAllChange()})},N.prototype.triggerChangeEventToRow=function(){var z=this;this.table.querySelectorAll("tbody ".concat(this.rowSelectingIndividual)).forEach(function(q){q.addEventListener("change",function(){z.updateSelectAllCheckbox()})})},N.prototype.onSelectAllChange=function(){var z=this,q=this.rowSelectingAll.checked;Array.from(this.dataTable.rows({page:"current",search:"applied"}).nodes()).forEach(function(G){var Q=G.querySelector(z.rowSelectingIndividual);Q&&(Q.checked=q)}),this.updateSelectAllCheckbox()},N.prototype.updateSelectAllCheckbox=function(){var z=this;if(!this.dataTable.rows({search:"applied"}).count())return this.rowSelectingAll.checked=!1,!1;var q=!0;Array.from(this.dataTable.rows({page:"current",search:"applied"}).nodes()).forEach(function(G){var Q=G.querySelector(z.rowSelectingIndividual);if(Q&&!Q.checked)return q=!1,!1}),this.rowSelectingAll.checked=q},N.getInstance=function(z,q){var G=window.$hsDataTableCollection.find(function(Q){return Q.element.el===(typeof z=="string"?document.querySelector(z):z)});return G?q?G:G.element.el:null},N.autoInit=function(){window.$hsDataTableCollection||(window.$hsDataTableCollection=[]),document.querySelectorAll("[data-hs-datatable]:not(.--prevent-on-load-init)").forEach(function(z){window.$hsDataTableCollection.find(function(q){var G;return((G=q==null?void 0:q.element)===null||G===void 0?void 0:G.el)===z})||new N(z)})},N}(Ae(r(961)).default);window.addEventListener("load",function(){document.querySelectorAll("[data-hs-datatable]:not(.--prevent-on-load-init)").length&&(typeof jQuery>"u"&&console.error("HSDataTable: jQuery is not available, please add it to the page."),typeof DataTable>"u"&&console.error("HSDataTable: DataTable is not available, please add it to the page.")),typeof DataTable<"u"&&typeof jQuery<"u"&&he.autoInit()}),typeof window<"u"&&(window.HSDataTable=he),O.default=he},891:function(E,O,r){/*
 * HSDropdown
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */var U,W=this&&this.__extends||(U=function(z,q){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(G,Q){G.__proto__=Q}||function(G,Q){for(var ee in Q)Object.prototype.hasOwnProperty.call(Q,ee)&&(G[ee]=Q[ee])},U(z,q)},function(z,q){if(typeof q!="function"&&q!==null)throw new TypeError("Class extends value "+String(q)+" is not a constructor or null");function G(){this.constructor=z}U(z,q),z.prototype=q===null?Object.create(q):(G.prototype=q.prototype,new G)}),Y=this&&this.__spreadArray||function(z,q,G){if(G||arguments.length===2)for(var Q,ee=0,fe=q.length;ee<fe;ee++)!Q&&ee in q||(Q||(Q=Array.prototype.slice.call(q,0,ee)),Q[ee]=q[ee]);return z.concat(Q||Array.prototype.slice.call(q))},se=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(O,"__esModule",{value:!0});var Ae=r(292),Ce=r(170),he=se(r(961)),K=r(223),N=function(z){function q(G,Q,ee){var fe=z.call(this,G,Q,ee)||this;return fe.toggle=fe.el.querySelector(":scope > .hs-dropdown-toggle")||fe.el.querySelector(":scope > .hs-dropdown-toggle-wrapper > .hs-dropdown-toggle")||fe.el.children[0],fe.closers=Array.from(fe.el.querySelectorAll(":scope .hs-dropdown-close"))||null,fe.menu=fe.el.querySelector(":scope > .hs-dropdown-menu"),fe.eventMode=(0,Ae.getClassProperty)(fe.el,"--trigger","click"),fe.closeMode=(0,Ae.getClassProperty)(fe.el,"--auto-close","true"),fe.animationInProcess=!1,fe.toggle&&fe.menu&&fe.init(),fe}return W(q,z),q.prototype.init=function(){var G=this;if(this.createCollection(window.$hsDropdownCollection,this),this.toggle.disabled)return!1;this.toggle&&this.buildToggle(),this.menu&&this.buildMenu(),this.closers&&this.buildClosers(),(0,Ae.isIOS)()||(0,Ae.isIpadOS)()||(this.el.addEventListener("mouseenter",function(){return G.onMouseEnterHandler()}),this.el.addEventListener("mouseleave",function(){return G.onMouseLeaveHandler()}))},q.prototype.resizeHandler=function(){this.eventMode=(0,Ae.getClassProperty)(this.el,"--trigger","click"),this.closeMode=(0,Ae.getClassProperty)(this.el,"--auto-close","true")},q.prototype.buildToggle=function(){var G,Q=this;!((G=this==null?void 0:this.toggle)===null||G===void 0)&&G.ariaExpanded&&(this.el.classList.contains("open")?this.toggle.ariaExpanded="true":this.toggle.ariaExpanded="false"),this.toggle.addEventListener("click",function(ee){return Q.onClickHandler(ee)})},q.prototype.buildMenu=function(){this.menu.role="menu"},q.prototype.buildClosers=function(){var G=this;this.closers.forEach(function(Q){Q.addEventListener("click",function(){return G.close()})})},q.prototype.onClickHandler=function(G){this.el.classList.contains("open")&&!this.menu.classList.contains("hidden")?this.close():this.open()},q.prototype.onMouseEnterHandler=function(){if(this.eventMode!=="hover")return!1;this.el._popper&&this.forceClearState(),!this.el.classList.contains("open")&&this.menu.classList.contains("hidden")&&this.open()},q.prototype.onMouseLeaveHandler=function(){if(this.eventMode!=="hover")return!1;this.el.classList.contains("open")&&!this.menu.classList.contains("hidden")&&this.close()},q.prototype.destroyPopper=function(){this.menu.classList.remove("block"),this.menu.classList.add("hidden"),this.menu.style.inset=null,this.menu.style.position=null,this.el&&this.el._popper&&this.el._popper.destroy(),this.animationInProcess=!1},q.prototype.absoluteStrategyModifiers=function(){var G=this;return[{name:"applyStyles",fn:function(Q){var ee=(window.getComputedStyle(G.el).getPropertyValue("--strategy")||"absolute").replace(" ",""),fe=(window.getComputedStyle(G.el).getPropertyValue("--adaptive")||"adaptive").replace(" ","");Q.state.elements.popper.style.position=ee,Q.state.elements.popper.style.transform=fe==="adaptive"?Q.state.styles.popper.transform:null,Q.state.elements.popper.style.top=null,Q.state.elements.popper.style.bottom=null,Q.state.elements.popper.style.left=null,Q.state.elements.popper.style.right=null,Q.state.elements.popper.style.margin=0}}]},q.prototype.open=function(){var G=this;if(this.el.classList.contains("open")||this.animationInProcess)return!1;this.animationInProcess=!0;var Q=(window.getComputedStyle(this.el).getPropertyValue("--placement")||"").replace(" ",""),ee=(window.getComputedStyle(this.el).getPropertyValue("--flip")||"true").replace(" ",""),fe=(window.getComputedStyle(this.el).getPropertyValue("--strategy")||"fixed").replace(" ",""),ce=parseInt((window.getComputedStyle(this.el).getPropertyValue("--offset")||"10").replace(" ","")),Ue=(window.getComputedStyle(this.el).getPropertyValue("--gpu-acceleration")||"true").replace(" ","");fe!=="static"&&(this.el._popper=(0,Ce.createPopper)(this.el,this.menu,{placement:K.POSITIONS[Q]||"bottom-start",strategy:fe,modifiers:Y(Y([],fe!=="fixed"?this.absoluteStrategyModifiers():[],!0),[{name:"flip",enabled:ee==="true"},{name:"offset",options:{offset:[0,ce]}},{name:"computeStyles",options:{adaptive:fe==="fixed",gpuAcceleration:Ue==="true"}}],!1)})),this.menu.style.margin=null,this.menu.classList.remove("hidden"),this.menu.classList.add("block"),setTimeout(function(){var He;!((He=G==null?void 0:G.toggle)===null||He===void 0)&&He.ariaExpanded&&(G.toggle.ariaExpanded="true"),G.el.classList.add("open"),G.animationInProcess=!1}),this.fireEvent("open",this.el),(0,Ae.dispatch)("open.hs.dropdown",this.el,this.el)},q.prototype.close=function(G){var Q=this;if(G===void 0&&(G=!0),this.animationInProcess||!this.el.classList.contains("open"))return!1;var ee;if(this.animationInProcess=!0,G){var fe=this.el.querySelector("[data-hs-dropdown-transition]")||this.menu;(0,Ae.afterTransition)(fe,function(){return Q.destroyPopper()})}else this.destroyPopper();Q.menu.style.margin=null,!((ee=Q==null?void 0:Q.toggle)===null||ee===void 0)&&ee.ariaExpanded&&(Q.toggle.ariaExpanded="false"),Q.el.classList.remove("open"),Q.fireEvent("close",Q.el),(0,Ae.dispatch)("close.hs.dropdown",Q.el,Q.el)},q.prototype.forceClearState=function(){this.destroyPopper(),this.menu.style.margin=null,this.el.classList.remove("open")},q.getInstance=function(G,Q){var ee=window.$hsDropdownCollection.find(function(fe){return fe.element.el===(typeof G=="string"?document.querySelector(G):G)});return ee?Q?ee:ee.element.el:null},q.autoInit=function(){if(window.$hsDropdownCollection||(window.$hsDropdownCollection=[]),document.querySelectorAll(".hs-dropdown:not(.--prevent-on-load-init)").forEach(function(Q){window.$hsDropdownCollection.find(function(ee){var fe;return((fe=ee==null?void 0:ee.element)===null||fe===void 0?void 0:fe.el)===Q})||new q(Q)}),window.$hsDropdownCollection){document.addEventListener("keydown",function(Q){return q.accessibility(Q)}),window.addEventListener("click",function(Q){var ee=Q.target;q.closeCurrentlyOpened(ee)});var G=window.innerWidth;window.addEventListener("resize",function(){window.innerWidth!==G&&(G=innerWidth,q.closeCurrentlyOpened(null,!1))})}},q.open=function(G){var Q=window.$hsDropdownCollection.find(function(ee){return ee.element.el===(typeof G=="string"?document.querySelector(G):G)});Q&&Q.element.menu.classList.contains("hidden")&&Q.element.open()},q.close=function(G){var Q=window.$hsDropdownCollection.find(function(ee){return ee.element.el===(typeof G=="string"?document.querySelector(G):G)});Q&&!Q.element.menu.classList.contains("hidden")&&Q.element.close()},q.accessibility=function(G){this.history=Ae.menuSearchHistory;var Q=window.$hsDropdownCollection.find(function(ee){return ee.element.el.classList.contains("open")});if(Q&&(K.DROPDOWN_ACCESSIBILITY_KEY_SET.includes(G.code)||G.code.length===4&&G.code[G.code.length-1].match(/^[A-Z]*$/))&&!G.metaKey&&!Q.element.menu.querySelector("input:focus")&&!Q.element.menu.querySelector("textarea:focus"))switch(G.code){case"Escape":Q.element.menu.querySelector(".hs-select.active")||(G.preventDefault(),this.onEscape(G));break;case"Enter":Q.element.menu.querySelector(".hs-select button:focus")||Q.element.menu.querySelector(".hs-collapse-toggle:focus")||this.onEnter(G);break;case"ArrowUp":G.preventDefault(),G.stopImmediatePropagation(),this.onArrow();break;case"ArrowDown":G.preventDefault(),G.stopImmediatePropagation(),this.onArrow(!1);break;case"Home":G.preventDefault(),G.stopImmediatePropagation(),this.onStartEnd();break;case"End":G.preventDefault(),G.stopImmediatePropagation(),this.onStartEnd(!1);break;default:G.preventDefault(),this.onFirstLetter(G.key)}},q.onEscape=function(G){var Q=G.target.closest(".hs-dropdown.open");if(window.$hsDropdownCollection.find(function(fe){return fe.element.el===Q})){var ee=window.$hsDropdownCollection.find(function(fe){return fe.element.el===Q});ee&&(ee.element.close(),ee.element.toggle.focus())}else this.closeCurrentlyOpened()},q.onEnter=function(G){var Q=G.target.parentElement;if(window.$hsDropdownCollection.find(function(fe){return fe.element.el===Q})){G.preventDefault();var ee=window.$hsDropdownCollection.find(function(fe){return fe.element.el===Q});ee&&ee.element.open()}},q.onArrow=function(G){G===void 0&&(G=!0);var Q=window.$hsDropdownCollection.find(function(He){return He.element.el.classList.contains("open")});if(Q){var ee=Q.element.menu;if(!ee)return!1;var fe=(G?Array.from(ee.querySelectorAll("a:not([hidden]), .hs-dropdown > button:not([hidden])")).reverse():Array.from(ee.querySelectorAll("a:not([hidden]), .hs-dropdown > button:not([hidden])"))).filter(function(He){return!He.classList.contains("disabled")}),ce=ee.querySelector("a:focus, button:focus"),Ue=fe.findIndex(function(He){return He===ce});Ue+1<fe.length&&Ue++,fe[Ue].focus()}},q.onStartEnd=function(G){G===void 0&&(G=!0);var Q=window.$hsDropdownCollection.find(function(ce){return ce.element.el.classList.contains("open")});if(Q){var ee=Q.element.menu;if(!ee)return!1;var fe=(G?Array.from(ee.querySelectorAll("a")):Array.from(ee.querySelectorAll("a")).reverse()).filter(function(ce){return!ce.classList.contains("disabled")});fe.length&&fe[0].focus()}},q.onFirstLetter=function(G){var Q=this,ee=window.$hsDropdownCollection.find(function(nt){return nt.element.el.classList.contains("open")});if(ee){var fe=ee.element.menu;if(!fe)return!1;var ce=Array.from(fe.querySelectorAll("a")),Ue=function(){return ce.findIndex(function(nt,vt){return nt.innerText.toLowerCase().charAt(0)===G.toLowerCase()&&Q.history.existsInHistory(vt)})},He=Ue();He===-1&&(this.history.clearHistory(),He=Ue()),He!==-1&&(ce[He].focus(),this.history.addHistory(He))}},q.closeCurrentlyOpened=function(G,Q){G===void 0&&(G=null),Q===void 0&&(Q=!0);var ee=G&&G.closest(".hs-dropdown")&&G.closest(".hs-dropdown").parentElement.closest(".hs-dropdown")?G.closest(".hs-dropdown").parentElement.closest(".hs-dropdown"):null,fe=ee?window.$hsDropdownCollection.filter(function(ce){return ce.element.el.classList.contains("open")&&ce.element.menu.closest(".hs-dropdown").parentElement.closest(".hs-dropdown")===ee}):window.$hsDropdownCollection.filter(function(ce){return ce.element.el.classList.contains("open")});G&&G.closest(".hs-dropdown")&&(0,Ae.getClassPropertyAlt)(G.closest(".hs-dropdown"),"--auto-close")==="inside"&&(fe=fe.filter(function(ce){return ce.element.el!==G.closest(".hs-dropdown")})),fe&&fe.forEach(function(ce){if(ce.element.closeMode==="false"||ce.element.closeMode==="outside")return!1;ce.element.close(Q)})},q.on=function(G,Q,ee){var fe=window.$hsDropdownCollection.find(function(ce){return ce.element.el===(typeof Q=="string"?document.querySelector(Q):Q)});fe&&(fe.element.events[G]=ee)},q}(he.default);window.addEventListener("load",function(){N.autoInit()}),window.addEventListener("resize",function(){window.$hsDropdownCollection||(window.$hsDropdownCollection=[]),window.$hsDropdownCollection.forEach(function(z){return z.element.resizeHandler()})}),typeof window<"u"&&(window.HSDropdown=N),O.default=N},234:function(E,O,r){/*
 * HSFileUpload
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */var U,W=this&&this.__extends||(U=function(K,N){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(z,q){z.__proto__=q}||function(z,q){for(var G in q)Object.prototype.hasOwnProperty.call(q,G)&&(z[G]=q[G])},U(K,N)},function(K,N){if(typeof N!="function"&&N!==null)throw new TypeError("Class extends value "+String(N)+" is not a constructor or null");function z(){this.constructor=K}U(K,N),K.prototype=N===null?Object.create(N):(z.prototype=N.prototype,new z)}),Y=this&&this.__assign||function(){return Y=Object.assign||function(K){for(var N,z=1,q=arguments.length;z<q;z++)for(var G in N=arguments[z])Object.prototype.hasOwnProperty.call(N,G)&&(K[G]=N[G]);return K},Y.apply(this,arguments)},se=this&&this.__importDefault||function(K){return K&&K.__esModule?K:{default:K}};Object.defineProperty(O,"__esModule",{value:!0});var Ae=r(292),Ce=se(r(961));typeof Dropzone<"u"&&(Dropzone.autoDiscover=!1);var he=function(K){function N(z,q,G){var Q,ee=K.call(this,z,q,G)||this;ee.extensions={},ee.el=typeof z=="string"?document.querySelector(z):z;var fe=ee.el.getAttribute("data-hs-file-upload"),ce=fe?JSON.parse(fe):{};return ee.previewTemplate=((Q=ee.el.querySelector("[data-hs-file-upload-preview]"))===null||Q===void 0?void 0:Q.innerHTML)||`<div class="p-3 bg-white border border-solid border-gray-300 rounded-xl dark:bg-neutral-800 dark:border-neutral-600">
			<div class="mb-2 flex justify-between items-center">
				<div class="flex items-center gap-x-3">
					<span class="size-8 flex justify-center items-center border border-gray-200 text-gray-500 rounded-lg dark:border-neutral-700 dark:text-neutral-500" data-hs-file-upload-file-icon></span>
					<div>
						<p class="text-sm font-medium text-gray-800 dark:text-white">
							<span class="truncate inline-block max-w-[300px] align-bottom" data-hs-file-upload-file-name></span>.<span data-hs-file-upload-file-ext></span>
						</p>
						<p class="text-xs text-gray-500 dark:text-neutral-500" data-hs-file-upload-file-size></p>
					</div>
				</div>
				<div class="inline-flex items-center gap-x-2">
					<button type="button" class="text-gray-500 hover:text-gray-800 dark:text-neutral-500 dark:hover:text-neutral-200" data-hs-file-upload-remove>
						<svg class="shrink-0 size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" x2="10" y1="11" y2="17"></line><line x1="14" x2="14" y1="11" y2="17"></line></svg>
					</button>
				</div>
			</div>
			<div class="flex items-center gap-x-3 whitespace-nowrap">
				<div class="flex w-full h-2 bg-gray-200 rounded-full overflow-hidden dark:bg-neutral-700" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" data-hs-file-upload-progress-bar>
					<div class="flex flex-col justify-center rounded-full overflow-hidden bg-blue-600 text-xs text-white text-center whitespace-nowrap transition-all duration-500 hs-file-upload-complete:bg-green-600 dark:bg-blue-500" style="width: 0" data-hs-file-upload-progress-bar-pane></div>
				</div>
				<div class="w-10 text-end">
					<span class="text-sm text-gray-800 dark:text-white">
						<span data-hs-file-upload-progress-bar-value>0</span>%
					</span>
				</div>
			</div>
		</div>`,ee.extensions=_.merge({default:{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/></svg>',class:"size-5"},xls:{icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.0243 1.43996H7.08805C6.82501 1.43996 6.57277 1.54445 6.38677 1.73043C6.20077 1.91642 6.09631 2.16868 6.09631 2.43171V6.64796L15.0243 11.856L19.4883 13.7398L23.9523 11.856V6.64796L15.0243 1.43996Z" fill="#21A366"></path><path d="M6.09631 6.64796H15.0243V11.856H6.09631V6.64796Z" fill="#107C41"></path><path d="M22.9605 1.43996H15.0243V6.64796H23.9523V2.43171C23.9523 2.16868 23.8478 1.91642 23.6618 1.73043C23.4758 1.54445 23.2235 1.43996 22.9605 1.43996Z" fill="#33C481"></path><path d="M15.0243 11.856H6.09631V21.2802C6.09631 21.5433 6.20077 21.7955 6.38677 21.9815C6.57277 22.1675 6.82501 22.272 7.08805 22.272H22.9606C23.2236 22.272 23.4759 22.1675 23.6618 21.9815C23.8478 21.7955 23.9523 21.5433 23.9523 21.2802V17.064L15.0243 11.856Z" fill="#185C37"></path><path d="M15.0243 11.856H23.9523V17.064H15.0243V11.856Z" fill="#107C41"></path><path opacity="0.1" d="M12.5446 5.15996H6.09631V19.296H12.5446C12.8073 19.2952 13.0591 19.1904 13.245 19.0046C13.4308 18.8188 13.5355 18.567 13.5363 18.3042V6.1517C13.5355 5.88892 13.4308 5.63712 13.245 5.4513C13.0591 5.26548 12.8073 5.16074 12.5446 5.15996Z" fill="black"></path><path opacity="0.2" d="M11.8006 5.90396H6.09631V20.04H11.8006C12.0633 20.0392 12.3151 19.9344 12.501 19.7486C12.6868 19.5628 12.7915 19.311 12.7923 19.0482V6.8957C12.7915 6.6329 12.6868 6.38114 12.501 6.19532C12.3151 6.0095 12.0633 5.90475 11.8006 5.90396Z" fill="black"></path><path opacity="0.2" d="M11.8006 5.90396H6.09631V18.552H11.8006C12.0633 18.5512 12.3151 18.4464 12.501 18.2606C12.6868 18.0748 12.7915 17.823 12.7923 17.5602V6.8957C12.7915 6.6329 12.6868 6.38114 12.501 6.19532C12.3151 6.0095 12.0633 5.90475 11.8006 5.90396Z" fill="black"></path><path opacity="0.2" d="M11.0566 5.90396H6.09631V18.552H11.0566C11.3193 18.5512 11.5711 18.4464 11.757 18.2606C11.9428 18.0748 12.0475 17.823 12.0483 17.5602V6.8957C12.0475 6.6329 11.9428 6.38114 11.757 6.19532C11.5711 6.0095 11.3193 5.90475 11.0566 5.90396Z" fill="black"></path><path d="M1.13604 5.90396H11.0566C11.3195 5.90396 11.5718 6.00842 11.7578 6.19442C11.9438 6.38042 12.0483 6.63266 12.0483 6.8957V16.8162C12.0483 17.0793 11.9438 17.3315 11.7578 17.5175C11.5718 17.7035 11.3195 17.808 11.0566 17.808H1.13604C0.873012 17.808 0.620754 17.7035 0.434765 17.5175C0.248775 17.3315 0.144287 17.0793 0.144287 16.8162V6.8957C0.144287 6.63266 0.248775 6.38042 0.434765 6.19442C0.620754 6.00842 0.873012 5.90396 1.13604 5.90396Z" fill="#107C41"></path><path d="M2.77283 15.576L5.18041 11.8455L2.9752 8.13596H4.74964L5.95343 10.5071C6.06401 10.7318 6.14015 10.8994 6.18185 11.01H6.19745C6.27683 10.8305 6.35987 10.6559 6.44669 10.4863L7.73309 8.13596H9.36167L7.09991 11.8247L9.41897 15.576H7.68545L6.29489 12.972C6.22943 12.861 6.17387 12.7445 6.12899 12.6238H6.10817C6.06761 12.7419 6.01367 12.855 5.94748 12.9608L4.51676 15.576H2.77283Z" fill="white"></path></svg>',class:"size-5"},doc:{icon:'<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M30.6141 1.91994H9.45071C9.09999 1.91994 8.76367 2.05926 8.51567 2.30725C8.26767 2.55523 8.12839 2.89158 8.12839 3.24228V8.86395L20.0324 12.3359L31.9364 8.86395V3.24228C31.9364 2.89158 31.797 2.55523 31.549 2.30725C31.3011 2.05926 30.9647 1.91994 30.6141 1.91994Z" fill="#41A5EE"></path><path d="M31.9364 8.86395H8.12839V15.8079L20.0324 19.2799L31.9364 15.8079V8.86395Z" fill="#2B7CD3"></path><path d="M31.9364 15.8079H8.12839V22.7519L20.0324 26.2239L31.9364 22.7519V15.8079Z" fill="#185ABD"></path><path d="M31.9364 22.752H8.12839V28.3736C8.12839 28.7244 8.26767 29.0607 8.51567 29.3087C8.76367 29.5567 9.09999 29.696 9.45071 29.696H30.6141C30.9647 29.696 31.3011 29.5567 31.549 29.3087C31.797 29.0607 31.9364 28.7244 31.9364 28.3736V22.752Z" fill="#103F91"></path><path opacity="0.1" d="M16.7261 6.87994H8.12839V25.7279H16.7261C17.0764 25.7269 17.4121 25.5872 17.6599 25.3395C17.9077 25.0917 18.0473 24.756 18.0484 24.4056V8.20226C18.0473 7.8519 17.9077 7.51616 17.6599 7.2684C17.4121 7.02064 17.0764 6.88099 16.7261 6.87994Z" class="fill-black dark:fill-neutral-200" fill="currentColor"></path><path opacity="0.2" d="M15.7341 7.87194H8.12839V26.7199H15.7341C16.0844 26.7189 16.4201 26.5792 16.6679 26.3315C16.9157 26.0837 17.0553 25.748 17.0564 25.3976V9.19426C17.0553 8.84386 16.9157 8.50818 16.6679 8.26042C16.4201 8.01266 16.0844 7.87299 15.7341 7.87194Z" class="fill-black dark:fill-neutral-200" fill="currentColor"></path><path opacity="0.2" d="M15.7341 7.87194H8.12839V24.7359H15.7341C16.0844 24.7349 16.4201 24.5952 16.6679 24.3475C16.9157 24.0997 17.0553 23.764 17.0564 23.4136V9.19426C17.0553 8.84386 16.9157 8.50818 16.6679 8.26042C16.4201 8.01266 16.0844 7.87299 15.7341 7.87194Z" class="fill-black dark:fill-neutral-200" fill="currentColor"></path><path opacity="0.2" d="M14.7421 7.87194H8.12839V24.7359H14.7421C15.0924 24.7349 15.4281 24.5952 15.6759 24.3475C15.9237 24.0997 16.0633 23.764 16.0644 23.4136V9.19426C16.0633 8.84386 15.9237 8.50818 15.6759 8.26042C15.4281 8.01266 15.0924 7.87299 14.7421 7.87194Z" class="fill-black dark:fill-neutral-200" fill="currentColor"></path><path d="M1.51472 7.87194H14.7421C15.0927 7.87194 15.4291 8.01122 15.6771 8.25922C15.925 8.50722 16.0644 8.84354 16.0644 9.19426V22.4216C16.0644 22.7723 15.925 23.1087 15.6771 23.3567C15.4291 23.6047 15.0927 23.7439 14.7421 23.7439H1.51472C1.16401 23.7439 0.827669 23.6047 0.579687 23.3567C0.3317 23.1087 0.192383 22.7723 0.192383 22.4216V9.19426C0.192383 8.84354 0.3317 8.50722 0.579687 8.25922C0.827669 8.01122 1.16401 7.87194 1.51472 7.87194Z" fill="#185ABD"></path><path d="M12.0468 20.7679H10.2612L8.17801 13.9231L5.99558 20.7679H4.20998L2.22598 10.8479H4.01158L5.40038 17.7919L7.48358 11.0463H8.97161L10.9556 17.7919L12.3444 10.8479H14.0308L12.0468 20.7679Z" fill="white"></path></svg>',class:"size-5"},zip:{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 22h2a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v18"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><circle cx="10" cy="20" r="2"/><path d="M10 7V6"/><path d="M10 12v-1"/><path d="M10 18v-2"/></svg>',class:"size-5"}},ce.extensions),ee.singleton=ce.singleton,ee.concatOptions=Y(Y({clickable:ee.el.querySelector("[data-hs-file-upload-trigger]"),previewsContainer:ee.el.querySelector("[data-hs-file-upload-previews]"),addRemoveLinks:!1,previewTemplate:ee.previewTemplate,autoHideTrigger:!1},ce),q),ee.init(),ee}return W(N,K),N.prototype.init=function(){this.createCollection(window.$hsFileUploadCollection,this),this.initDropzone()},N.prototype.initDropzone=function(){var z=this,q=this.el.querySelector("[data-hs-file-upload-clear]"),G=Array.from(this.el.querySelectorAll("[data-hs-file-upload-pseudo-trigger]"));this.dropzone=new Dropzone(this.el,this.concatOptions),this.dropzone.on("addedfile",function(Q){return z.onAddFile(Q)}),this.dropzone.on("removedfile",function(){return z.onRemoveFile()}),this.dropzone.on("uploadprogress",function(Q,ee){return z.onUploadProgress(Q,ee)}),this.dropzone.on("complete",function(Q){return z.onComplete(Q)}),q&&(q.onclick=function(){z.dropzone.files.length&&z.dropzone.removeAllFiles(!0)}),G.length&&G.forEach(function(Q){Q.onclick=function(){var ee,fe;!((ee=z.concatOptions)===null||ee===void 0)&&ee.clickable&&((fe=z.concatOptions)===null||fe===void 0?void 0:fe.clickable).click()}})},N.prototype.onAddFile=function(z){var q=this,G=z.previewElement,Q=z.previewElement.querySelector("[data-hs-file-upload-reload]");if(!G)return!1;this.singleton&&this.dropzone.files.length>1&&this.dropzone.removeFile(this.dropzone.files[0]),Q&&Q.addEventListener("click",function(ee){ee.preventDefault(),ee.stopPropagation();var fe=document.createElement("input");fe.type="file",fe.click(),fe.addEventListener("change",function(ce){var Ue,He=(Ue=ce.target.files)===null||Ue===void 0?void 0:Ue[0];if(He){var nt=He;nt.status=Dropzone.ADDED,nt.accepted=!0,nt.previewElement=z.previewElement,nt.previewTemplate=z.previewTemplate,nt.previewsContainer=z.previewsContainer,q.dropzone.removeFile(z),q.dropzone.addFile(nt)}})}),this.previewAccepted(z)},N.prototype.previewAccepted=function(z){var q=this,G=z.previewElement,Q=this.splitFileName(z.name),ee=G.querySelector("[data-hs-file-upload-file-name]"),fe=G.querySelector("[data-hs-file-upload-file-ext]"),ce=G.querySelector("[data-hs-file-upload-file-size]"),Ue=G.querySelector("[data-hs-file-upload-file-icon]"),He=this.el.querySelector("[data-hs-file-upload-trigger]"),nt=G.querySelector("[data-dz-thumbnail]"),vt=G.querySelector("[data-hs-file-upload-remove]");ee&&(ee.textContent=Q.name),fe&&(fe.textContent=Q.extension),ce&&(ce.textContent=this.formatFileSize(z.size)),nt&&(z.type.includes("image/")?nt.classList.remove("hidden"):this.setIcon(Q.extension,Ue)),this.dropzone.files.length>0&&this.concatOptions.autoHideTrigger&&(He.style.display="none"),vt&&(vt.onclick=function(){return q.dropzone.removeFile(z)})},N.prototype.onRemoveFile=function(){var z=this.el.querySelector("[data-hs-file-upload-trigger]");this.dropzone.files.length===0&&this.concatOptions.autoHideTrigger&&(z.style.display="")},N.prototype.onUploadProgress=function(z,q){var G=z.previewElement;if(!G)return!1;var Q=G.querySelector("[data-hs-file-upload-progress-bar]"),ee=G.querySelector("[data-hs-file-upload-progress-bar-pane]"),fe=G.querySelector("[data-hs-file-upload-progress-bar-value]"),ce=Math.floor(q);Q&&Q.setAttribute("aria-valuenow","".concat(ce)),ee&&(ee.style.width="".concat(ce,"%")),fe&&(fe.innerText="".concat(ce))},N.prototype.onComplete=function(z){var q=z.previewElement;if(!q)return!1;q.classList.add("complete")},N.prototype.setIcon=function(z,q){var G=this.createIcon(z);q.append(G)},N.prototype.createIcon=function(z){var q,G,Q=!((q=this.extensions[z])===null||q===void 0)&&q.icon?(0,Ae.htmlToElement)(this.extensions[z].icon):(0,Ae.htmlToElement)(this.extensions.default.icon);return(0,Ae.classToClassList)(!((G=this.extensions[z])===null||G===void 0)&&G.class?this.extensions[z].class:this.extensions.default.class,Q),Q},N.prototype.formatFileSize=function(z){return z<1024?z.toFixed(2)+" B":z<1048576?(z/1024).toFixed(2)+" KB":z<1073741824?(z/1048576).toFixed(2)+" MB":z<1099511627776?(z/1073741824).toFixed(2)+" GB":(z/1099511627776).toFixed(2)+" TB"},N.prototype.splitFileName=function(z){var q=z.lastIndexOf(".");return q==-1?{name:z,extension:""}:{name:z.substring(0,q),extension:z.substring(q+1)}},N.getInstance=function(z,q){var G=window.$hsFileUploadCollection.find(function(Q){return Q.element.el===(typeof z=="string"?document.querySelector(z):z)});return G?q?G:G.element.el:null},N.autoInit=function(){window.$hsFileUploadCollection||(window.$hsFileUploadCollection=[]),document.querySelectorAll("[data-hs-file-upload]:not(.--prevent-on-load-init)").forEach(function(z){window.$hsFileUploadCollection.find(function(q){var G;return((G=q==null?void 0:q.element)===null||G===void 0?void 0:G.el)===z})||new N(z)})},N}(Ce.default);window.addEventListener("load",function(){document.querySelectorAll("[data-hs-file-upload]:not(.--prevent-on-load-init)").length&&(typeof _>"u"&&console.error("HSFileUpload: Lodash is not available, please add it to the page."),typeof Dropzone>"u"&&console.error("HSFileUpload: Dropzone is not available, please add it to the page.")),typeof _<"u"&&typeof Dropzone<"u"&&he.autoInit()}),typeof window<"u"&&(window.HSFileUpload=he),O.default=he},332:function(E,O,r){/*
 * HSInputNumber
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */var U,W=this&&this.__extends||(U=function(he,K){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,z){N.__proto__=z}||function(N,z){for(var q in z)Object.prototype.hasOwnProperty.call(z,q)&&(N[q]=z[q])},U(he,K)},function(he,K){if(typeof K!="function"&&K!==null)throw new TypeError("Class extends value "+String(K)+" is not a constructor or null");function N(){this.constructor=he}U(he,K),he.prototype=K===null?Object.create(K):(N.prototype=K.prototype,new N)}),Y=this&&this.__assign||function(){return Y=Object.assign||function(he){for(var K,N=1,z=arguments.length;N<z;N++)for(var q in K=arguments[N])Object.prototype.hasOwnProperty.call(K,q)&&(he[q]=K[q]);return he},Y.apply(this,arguments)},se=this&&this.__importDefault||function(he){return he&&he.__esModule?he:{default:he}};Object.defineProperty(O,"__esModule",{value:!0});var Ae=r(292),Ce=function(he){function K(N,z){var q=he.call(this,N,z)||this;q.input=q.el.querySelector("[data-hs-input-number-input]")||null,q.increment=q.el.querySelector("[data-hs-input-number-increment]")||null,q.decrement=q.el.querySelector("[data-hs-input-number-decrement]")||null,q.input&&q.checkIsNumberAndConvert();var G=q.el.dataset.hsInputNumber,Q=G?JSON.parse(G):{step:1},ee=Y(Y({},Q),z);return q.minInputValue="min"in ee?ee.min:0,q.maxInputValue="max"in ee?ee.max:null,q.step="step"in ee&&ee.step>0?ee.step:1,q.init(),q}return W(K,he),K.prototype.init=function(){this.createCollection(window.$hsInputNumberCollection,this),this.input&&this.increment&&this.build()},K.prototype.checkIsNumberAndConvert=function(){var N=this.input.value.trim(),z=this.cleanAndExtractNumber(N);z!==null?(this.inputValue=z,this.input.value=z.toString()):(this.inputValue=0,this.input.value="0")},K.prototype.cleanAndExtractNumber=function(N){var z=[],q=!1;N.split("").forEach(function(ee){ee>="0"&&ee<="9"?z.push(ee):ee!=="."||q||(z.push(ee),q=!0)});var G=z.join(""),Q=parseFloat(G);return isNaN(Q)?null:Q},K.prototype.build=function(){this.input&&this.buildInput(),this.increment&&this.buildIncrement(),this.decrement&&this.buildDecrement(),this.inputValue<=0&&this.minInputValue===0&&(this.inputValue=0,this.input.value="0"),(this.inputValue<=0||this.minInputValue<0)&&this.changeValue(),this.input.hasAttribute("disabled")&&this.disableButtons()},K.prototype.buildInput=function(){var N=this;this.input.addEventListener("input",function(){return N.changeValue()})},K.prototype.buildIncrement=function(){var N=this;this.increment.addEventListener("click",function(){N.changeValue("increment")})},K.prototype.buildDecrement=function(){var N=this;this.decrement.addEventListener("click",function(){N.changeValue("decrement")})},K.prototype.changeValue=function(N){var z,q;N===void 0&&(N="none");var G={inputValue:this.inputValue},Q=(z=this.minInputValue)!==null&&z!==void 0?z:Number.MIN_SAFE_INTEGER,ee=(q=this.maxInputValue)!==null&&q!==void 0?q:Number.MAX_SAFE_INTEGER;switch(this.inputValue=isNaN(this.inputValue)?0:this.inputValue,N){case"increment":var fe=this.inputValue+this.step;this.inputValue=fe>=Q&&fe<=ee?fe:ee,this.input.value=this.inputValue.toString();break;case"decrement":var ce=this.inputValue-this.step;this.inputValue=ce>=Q&&ce<=ee?ce:Q,this.input.value=this.inputValue.toString();break;default:var Ue=isNaN(parseInt(this.input.value))?0:parseInt(this.input.value);this.inputValue=Ue>=ee?ee:Ue<=Q?Q:Ue,this.inputValue<=Q&&(this.input.value=this.inputValue.toString())}G.inputValue=this.inputValue,this.inputValue===Q?(this.el.classList.add("disabled"),this.decrement&&this.disableButtons("decrement")):(this.el.classList.remove("disabled"),this.decrement&&this.enableButtons("decrement")),this.inputValue===ee?(this.el.classList.add("disabled"),this.increment&&this.disableButtons("increment")):(this.el.classList.remove("disabled"),this.increment&&this.enableButtons("increment")),this.fireEvent("change",G),(0,Ae.dispatch)("change.hs.inputNumber",this.el,G)},K.prototype.disableButtons=function(N){N===void 0&&(N="all"),N==="all"?(this.increment.tagName!=="BUTTON"&&this.increment.tagName!=="INPUT"||this.increment.setAttribute("disabled","disabled"),this.decrement.tagName!=="BUTTON"&&this.decrement.tagName!=="INPUT"||this.decrement.setAttribute("disabled","disabled")):N==="increment"?this.increment.tagName!=="BUTTON"&&this.increment.tagName!=="INPUT"||this.increment.setAttribute("disabled","disabled"):N==="decrement"&&(this.decrement.tagName!=="BUTTON"&&this.decrement.tagName!=="INPUT"||this.decrement.setAttribute("disabled","disabled"))},K.prototype.enableButtons=function(N){N===void 0&&(N="all"),N==="all"?(this.increment.tagName!=="BUTTON"&&this.increment.tagName!=="INPUT"||this.increment.removeAttribute("disabled"),this.decrement.tagName!=="BUTTON"&&this.decrement.tagName!=="INPUT"||this.decrement.removeAttribute("disabled")):N==="increment"?this.increment.tagName!=="BUTTON"&&this.increment.tagName!=="INPUT"||this.increment.removeAttribute("disabled"):N==="decrement"&&(this.decrement.tagName!=="BUTTON"&&this.decrement.tagName!=="INPUT"||this.decrement.removeAttribute("disabled"))},K.getInstance=function(N,z){var q=window.$hsInputNumberCollection.find(function(G){return G.element.el===(typeof N=="string"?document.querySelector(N):N)});return q?z?q:q.element:null},K.autoInit=function(){window.$hsInputNumberCollection||(window.$hsInputNumberCollection=[]),document.querySelectorAll("[data-hs-input-number]:not(.--prevent-on-load-init)").forEach(function(N){window.$hsInputNumberCollection.find(function(z){var q;return((q=z==null?void 0:z.element)===null||q===void 0?void 0:q.el)===N})||new K(N)})},K}(se(r(961)).default);window.addEventListener("load",function(){Ce.autoInit()}),typeof window<"u"&&(window.HSInputNumber=Ce),O.default=Ce},850:function(E,O,r){/*
 * HSOverlay
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */var U,W=this&&this.__extends||(U=function(K,N){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(z,q){z.__proto__=q}||function(z,q){for(var G in q)Object.prototype.hasOwnProperty.call(q,G)&&(z[G]=q[G])},U(K,N)},function(K,N){if(typeof N!="function"&&N!==null)throw new TypeError("Class extends value "+String(N)+" is not a constructor or null");function z(){this.constructor=K}U(K,N),K.prototype=N===null?Object.create(N):(z.prototype=N.prototype,new z)}),Y=this&&this.__assign||function(){return Y=Object.assign||function(K){for(var N,z=1,q=arguments.length;z<q;z++)for(var G in N=arguments[z])Object.prototype.hasOwnProperty.call(N,G)&&(K[G]=N[G]);return K},Y.apply(this,arguments)},se=this&&this.__importDefault||function(K){return K&&K.__esModule?K:{default:K}};Object.defineProperty(O,"__esModule",{value:!0});var Ae=r(292),Ce=r(223),he=function(K){function N(z,q,G){var Q,ee,fe,ce,Ue=K.call(this,z,q,G)||this,He=z.getAttribute("data-hs-overlay-options"),nt=He?JSON.parse(He):{},vt=Y(Y({},nt),q);if(Ue.hiddenClass=(vt==null?void 0:vt.hiddenClass)||"hidden",Ue.emulateScrollbarSpace=(vt==null?void 0:vt.emulateScrollbarSpace)||!1,Ue.isClosePrev=(Q=vt==null?void 0:vt.isClosePrev)===null||Q===void 0||Q,Ue.backdropClasses=(ee=vt==null?void 0:vt.backdropClasses)!==null&&ee!==void 0?ee:"hs-overlay-backdrop transition duration fixed inset-0 bg-gray-900 bg-opacity-50 dark:bg-opacity-80 dark:bg-neutral-900",Ue.backdropExtraClasses=(fe=vt==null?void 0:vt.backdropExtraClasses)!==null&&fe!==void 0?fe:"",Ue.openNextOverlay=!1,Ue.autoHide=null,Ue.overlayId=Ue.el.getAttribute("data-hs-overlay"),Ue.overlay=document.querySelector(Ue.overlayId),Ue.overlay){Ue.isCloseWhenClickInside=(0,Ae.stringToBoolean)((0,Ae.getClassProperty)(Ue.overlay,"--close-when-click-inside","false")||"false"),Ue.isTabAccessibilityLimited=(0,Ae.stringToBoolean)((0,Ae.getClassProperty)(Ue.overlay,"--tab-accessibility-limited","true")||"true"),Ue.isLayoutAffect=(0,Ae.stringToBoolean)((0,Ae.getClassProperty)(Ue.overlay,"--is-layout-affect","false")||"false"),Ue.hasAutofocus=(0,Ae.stringToBoolean)((0,Ae.getClassProperty)(Ue.overlay,"--has-autofocus","true")||"true"),Ue.hasAbilityToCloseOnBackdropClick=(0,Ae.stringToBoolean)(Ue.overlay.getAttribute("data-hs-overlay-keyboard")||"true");var xt=(0,Ae.getClassProperty)(Ue.overlay,"--auto-close");Ue.autoClose=!isNaN(+xt)&&isFinite(+xt)?+xt:Ce.BREAKPOINTS[xt]||null;var Ot=(0,Ae.getClassProperty)(Ue.overlay,"--opened");Ue.openedBreakpoint=(!isNaN(+Ot)&&isFinite(+Ot)?+Ot:Ce.BREAKPOINTS[Ot])||null}return Ue.animationTarget=((ce=Ue==null?void 0:Ue.overlay)===null||ce===void 0?void 0:ce.querySelector(".hs-overlay-animation-target"))||Ue.overlay,Ue.overlay&&Ue.init(),Ue}return W(N,K),N.prototype.init=function(){var z,q=this;if(this.createCollection(window.$hsOverlayCollection,this),this.isLayoutAffect&&this.openedBreakpoint){var G=N.getInstance(this.el,!0);N.setOpened(this.openedBreakpoint,G)}!((z=this==null?void 0:this.el)===null||z===void 0)&&z.ariaExpanded&&(this.overlay.classList.contains("opened")?this.el.ariaExpanded="true":this.el.ariaExpanded="false"),this.el.addEventListener("click",function(){q.overlay.classList.contains("opened")?q.close():q.open()}),this.overlay.addEventListener("click",function(Q){Q.target.id&&"#".concat(Q.target.id)===q.overlayId&&q.isCloseWhenClickInside&&q.hasAbilityToCloseOnBackdropClick&&q.close()})},N.prototype.hideAuto=function(){var z=this,q=parseInt((0,Ae.getClassProperty)(this.overlay,"--auto-hide","0"));q&&(this.autoHide=setTimeout(function(){z.close()},q))},N.prototype.checkTimer=function(){this.autoHide&&(clearTimeout(this.autoHide),this.autoHide=null)},N.prototype.buildBackdrop=function(){var z=this,q=this.overlay.classList.value.split(" "),G=parseInt(window.getComputedStyle(this.overlay).getPropertyValue("z-index")),Q=this.overlay.getAttribute("data-hs-overlay-backdrop-container")||!1,ee=document.createElement("div"),fe="".concat(this.backdropClasses," ").concat(this.backdropExtraClasses),ce=(0,Ae.getClassProperty)(this.overlay,"--overlay-backdrop","true")!=="static",Ue=(0,Ae.getClassProperty)(this.overlay,"--overlay-backdrop","true")==="false";ee.id="".concat(this.overlay.id,"-backdrop"),"style"in ee&&(ee.style.zIndex="".concat(G-1));for(var He=0,nt=q;He<nt.length;He++){var vt=nt[He];(vt.startsWith("hs-overlay-backdrop-open:")||vt.includes(":hs-overlay-backdrop-open:"))&&(fe+=" ".concat(vt))}Ue||(Q&&((ee=document.querySelector(Q).cloneNode(!0)).classList.remove("hidden"),fe="".concat(ee.classList.toString()),ee.classList.value=""),ce&&ee.addEventListener("click",function(){return z.close()},!0),ee.setAttribute("data-hs-overlay-backdrop-template",""),document.body.appendChild(ee),setTimeout(function(){ee.classList.value=fe}))},N.prototype.destroyBackdrop=function(){var z=document.querySelector("#".concat(this.overlay.id,"-backdrop"));z&&(this.openNextOverlay&&(z.style.transitionDuration="".concat(1.8*parseFloat(window.getComputedStyle(z).transitionDuration.replace(/[^\d.-]/g,"")),"s")),z.classList.add("opacity-0"),(0,Ae.afterTransition)(z,function(){z.remove()}))},N.prototype.focusElement=function(){var z=this.overlay.querySelector("[autofocus]");if(!z)return!1;z.focus()},N.prototype.getScrollbarSize=function(){var z=document.createElement("div");z.style.overflow="scroll",z.style.width="100px",z.style.height="100px",document.body.appendChild(z);var q=z.offsetWidth-z.clientWidth;return document.body.removeChild(z),q},N.prototype.open=function(){var z=this;if(!this.overlay)return!1;var q=document.querySelectorAll(".hs-overlay.open"),G=window.$hsOverlayCollection.find(function(fe){return Array.from(q).includes(fe.element.overlay)&&!fe.element.isLayoutAffect}),Q=document.querySelectorAll('[data-hs-overlay="#'.concat(this.overlay.id,'"]')),ee=(0,Ae.getClassProperty)(this.overlay,"--body-scroll","false")!=="true";if(this.isClosePrev&&G)return this.openNextOverlay=!0,G.element.close().then(function(){z.open(),z.openNextOverlay=!1});ee&&(document.body.style.overflow="hidden",this.emulateScrollbarSpace&&(document.body.style.paddingRight="".concat(this.getScrollbarSize(),"px"))),this.buildBackdrop(),this.checkTimer(),this.hideAuto(),Q.forEach(function(fe){fe.ariaExpanded&&(fe.ariaExpanded="true")}),this.overlay.classList.remove(this.hiddenClass),this.overlay.setAttribute("aria-overlay","true"),this.overlay.setAttribute("tabindex","-1"),setTimeout(function(){if(z.overlay.classList.contains("opened"))return!1;z.overlay.classList.add("open","opened"),z.isLayoutAffect&&document.body.classList.add("hs-overlay-body-open"),z.fireEvent("open",z.el),(0,Ae.dispatch)("open.hs.overlay",z.el,z.el),z.hasAutofocus&&z.focusElement()},50)},N.prototype.close=function(z){var q=this;z===void 0&&(z=!1),this.isLayoutAffect&&document.body.classList.remove("hs-overlay-body-open");var G=function(Q){if(q.overlay.classList.contains("open"))return!1;document.querySelectorAll('[data-hs-overlay="#'.concat(q.overlay.id,'"]')).forEach(function(ee){ee.ariaExpanded&&(ee.ariaExpanded="false")}),q.overlay.classList.add(q.hiddenClass),q.destroyBackdrop(),q.fireEvent("close",q.el),(0,Ae.dispatch)("close.hs.overlay",q.el,q.el),document.querySelector(".hs-overlay.opened")||(document.body.style.overflow="",q.emulateScrollbarSpace&&(document.body.style.paddingRight="")),Q(q.overlay)};return new Promise(function(Q){if(!q.overlay)return!1;q.overlay.classList.remove("open","opened"),q.overlay.removeAttribute("aria-overlay"),q.overlay.removeAttribute("tabindex"),z?G(Q):(0,Ae.afterTransition)(q.animationTarget,function(){return G(Q)})})},N.getInstance=function(z,q){var G=window.$hsOverlayCollection.find(function(Q){return Q.element.el===(typeof z=="string"?document.querySelector(z):z)||Q.element.overlay===(typeof z=="string"?document.querySelector(z):z)});return G?q?G:G.element.el:null},N.autoInit=function(){window.$hsOverlayCollection||(window.$hsOverlayCollection=[]),document.querySelectorAll("[data-hs-overlay]:not(.--prevent-on-load-init)").forEach(function(z){window.$hsOverlayCollection.find(function(q){var G;return((G=q==null?void 0:q.element)===null||G===void 0?void 0:G.el)===z})||new N(z)}),window.$hsOverlayCollection&&document.addEventListener("keydown",function(z){return N.accessibility(z)})},N.open=function(z){var q=window.$hsOverlayCollection.find(function(G){return G.element.el===(typeof z=="string"?document.querySelector(z):z)||G.element.overlay===(typeof z=="string"?document.querySelector(z):z)});q&&q.element.overlay.classList.contains(q.element.hiddenClass)&&q.element.open()},N.close=function(z){var q=window.$hsOverlayCollection.find(function(G){return G.element.el===(typeof z=="string"?document.querySelector(z):z)||G.element.overlay===(typeof z=="string"?document.querySelector(z):z)});q&&!q.element.overlay.classList.contains(q.element.hiddenClass)&&q.element.close()},N.setOpened=function(z,q){document.body.clientWidth>=z?(document.body.classList.add("hs-overlay-body-open"),q.element.overlay.classList.add("opened")):q.element.close(!0)},N.accessibility=function(z){var q,G,Q=window.$hsOverlayCollection.filter(function(He){return He.element.overlay.classList.contains("open")}),ee=Q[Q.length-1],fe=(G=(q=ee==null?void 0:ee.element)===null||q===void 0?void 0:q.overlay)===null||G===void 0?void 0:G.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),ce=[];fe!=null&&fe.length&&fe.forEach(function(He){(0,Ae.isParentOrElementHidden)(He)||ce.push(He)});var Ue=ee&&!z.metaKey;if(Ue&&!ee.element.isTabAccessibilityLimited&&z.code==="Tab")return!1;Ue&&ce.length&&z.code==="Tab"&&(z.preventDefault(),this.onTab(ee,ce)),Ue&&z.code==="Escape"&&(z.preventDefault(),this.onEscape(ee))},N.onEscape=function(z){z&&z.element.hasAbilityToCloseOnBackdropClick&&z.element.close()},N.onTab=function(z,q){if(!q.length)return!1;var G=z.element.overlay.querySelector(":focus"),Q=Array.from(q).indexOf(G);Q>-1?q[(Q+1)%q.length].focus():q[0].focus()},N.on=function(z,q,G){var Q=window.$hsOverlayCollection.find(function(ee){return ee.element.el===(typeof q=="string"?document.querySelector(q):q)||ee.element.overlay===(typeof q=="string"?document.querySelector(q):q)});Q&&(Q.element.events[z]=G)},N}(se(r(961)).default);window.addEventListener("load",function(){he.autoInit()}),window.addEventListener("resize",function(){(function(){if(!window.$hsOverlayCollection.length||!window.$hsOverlayCollection.find(function(K){return K.element.autoClose}))return!1;window.$hsOverlayCollection.filter(function(K){return K.element.autoClose}).forEach(function(K){document.body.clientWidth>=K.element.autoClose&&K.element.close(!0)})})(),function(){if(!window.$hsOverlayCollection.length||!window.$hsOverlayCollection.find(function(K){return K.element.autoClose}))return!1;window.$hsOverlayCollection.filter(function(K){return K.element.autoClose}).forEach(function(K){document.body.clientWidth>=K.element.autoClose&&K.element.close(!0)})}(),function(){if(!window.$hsOverlayCollection.length||!window.$hsOverlayCollection.find(function(K){return K.element.overlay.classList.contains("opened")}))return!1;window.$hsOverlayCollection.filter(function(K){return K.element.overlay.classList.contains("opened")}).forEach(function(K){var N=parseInt(window.getComputedStyle(K.element.overlay).getPropertyValue("z-index")),z=document.querySelector("#".concat(K.element.overlay.id,"-backdrop"));if(N===parseInt(window.getComputedStyle(z).getPropertyValue("z-index"))+1)return!1;"style"in z&&(z.style.zIndex="".concat(N-1)),document.body.classList.add("hs-overlay-body-open")})}()}),typeof window<"u"&&(window.HSOverlay=he),O.default=he},60:function(E,O,r){/*
 * HSPinInput
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */var U,W=this&&this.__extends||(U=function(he,K){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,z){N.__proto__=z}||function(N,z){for(var q in z)Object.prototype.hasOwnProperty.call(z,q)&&(N[q]=z[q])},U(he,K)},function(he,K){if(typeof K!="function"&&K!==null)throw new TypeError("Class extends value "+String(K)+" is not a constructor or null");function N(){this.constructor=he}U(he,K),he.prototype=K===null?Object.create(K):(N.prototype=K.prototype,new N)}),Y=this&&this.__assign||function(){return Y=Object.assign||function(he){for(var K,N=1,z=arguments.length;N<z;N++)for(var q in K=arguments[N])Object.prototype.hasOwnProperty.call(K,q)&&(he[q]=K[q]);return he},Y.apply(this,arguments)},se=this&&this.__importDefault||function(he){return he&&he.__esModule?he:{default:he}};Object.defineProperty(O,"__esModule",{value:!0});var Ae=r(292),Ce=function(he){function K(N,z){var q=he.call(this,N,z)||this,G=N.getAttribute("data-hs-pin-input"),Q=G?JSON.parse(G):{},ee=Y(Y({},Q),z);return q.items=q.el.querySelectorAll("[data-hs-pin-input-item]"),q.currentItem=null,q.currentValue=new Array(q.items.length).fill(""),q.placeholders=[],q.availableCharsRE=new RegExp((ee==null?void 0:ee.availableCharsRE)||"^[a-zA-Z0-9]+$"),q.init(),q}return W(K,he),K.prototype.init=function(){this.createCollection(window.$hsPinInputCollection,this),this.items.length&&this.build()},K.prototype.build=function(){this.buildInputItems()},K.prototype.buildInputItems=function(){var N=this;this.items.forEach(function(z,q){N.placeholders.push(z.getAttribute("placeholder")||""),z.hasAttribute("autofocus")&&N.onFocusIn(q),z.addEventListener("input",function(G){return N.onInput(G,q)}),z.addEventListener("paste",function(G){return N.onPaste(G)}),z.addEventListener("keydown",function(G){return N.onKeydown(G,q)}),z.addEventListener("focusin",function(){return N.onFocusIn(q)}),z.addEventListener("focusout",function(){return N.onFocusOut(q)})})},K.prototype.checkIfNumber=function(N){return N.match(this.availableCharsRE)},K.prototype.autoFillAll=function(N){var z=this;Array.from(N).forEach(function(q,G){if(!(z!=null&&z.items[G]))return!1;z.items[G].value=q,z.items[G].dispatchEvent(new Event("input",{bubbles:!0}))})},K.prototype.setCurrentValue=function(){this.currentValue=Array.from(this.items).map(function(N){return N.value})},K.prototype.toggleCompleted=function(){this.currentValue.includes("")?this.el.classList.remove("active"):this.el.classList.add("active")},K.prototype.onInput=function(N,z){var q=N.target.value;if(this.currentItem=N.target,this.currentItem.value="",this.currentItem.value=q[q.length-1],!this.checkIfNumber(this.currentItem.value))return this.currentItem.value=this.currentValue[z]||"",!1;if(this.setCurrentValue(),this.currentItem.value){if(z<this.items.length-1&&this.items[z+1].focus(),!this.currentValue.includes("")){var G={currentValue:this.currentValue};this.fireEvent("completed",G),(0,Ae.dispatch)("completed.hs.pinInput",this.el,G)}this.toggleCompleted()}else z>0&&this.items[z-1].focus()},K.prototype.onKeydown=function(N,z){N.key==="Backspace"&&z>0&&(this.items[z].value===""?(this.items[z-1].value="",this.items[z-1].focus()):this.items[z].value=""),this.setCurrentValue(),this.toggleCompleted()},K.prototype.onFocusIn=function(N){this.items[N].setAttribute("placeholder","")},K.prototype.onFocusOut=function(N){this.items[N].setAttribute("placeholder",this.placeholders[N])},K.prototype.onPaste=function(N){var z=this;N.preventDefault(),this.items.forEach(function(q){document.activeElement===q&&z.autoFillAll(N.clipboardData.getData("text"))})},K.getInstance=function(N,z){var q=window.$hsPinInputCollection.find(function(G){return G.element.el===(typeof N=="string"?document.querySelector(N):N)});return q?z?q:q.element:null},K.autoInit=function(){window.$hsPinInputCollection||(window.$hsPinInputCollection=[]),document.querySelectorAll("[data-hs-pin-input]:not(.--prevent-on-load-init)").forEach(function(N){window.$hsPinInputCollection.find(function(z){var q;return((q=z==null?void 0:z.element)===null||q===void 0?void 0:q.el)===N})||new K(N)})},K}(se(r(961)).default);window.addEventListener("load",function(){Ce.autoInit()}),typeof window<"u"&&(window.HSPinInput=Ce),O.default=Ce},911:function(E,O,r){/*
 * HSRemoveElement
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */var U,W=this&&this.__extends||(U=function(he,K){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,z){N.__proto__=z}||function(N,z){for(var q in z)Object.prototype.hasOwnProperty.call(z,q)&&(N[q]=z[q])},U(he,K)},function(he,K){if(typeof K!="function"&&K!==null)throw new TypeError("Class extends value "+String(K)+" is not a constructor or null");function N(){this.constructor=he}U(he,K),he.prototype=K===null?Object.create(K):(N.prototype=K.prototype,new N)}),Y=this&&this.__assign||function(){return Y=Object.assign||function(he){for(var K,N=1,z=arguments.length;N<z;N++)for(var q in K=arguments[N])Object.prototype.hasOwnProperty.call(K,q)&&(he[q]=K[q]);return he},Y.apply(this,arguments)},se=this&&this.__importDefault||function(he){return he&&he.__esModule?he:{default:he}};Object.defineProperty(O,"__esModule",{value:!0});var Ae=r(292),Ce=function(he){function K(N,z){var q=he.call(this,N,z)||this,G=N.getAttribute("data-hs-remove-element-options"),Q=G?JSON.parse(G):{},ee=Y(Y({},Q),z);return q.removeTargetId=q.el.getAttribute("data-hs-remove-element"),q.removeTarget=document.querySelector(q.removeTargetId),q.removeTargetAnimationClass=(ee==null?void 0:ee.removeTargetAnimationClass)||"hs-removing",q.removeTarget&&q.init(),q}return W(K,he),K.prototype.init=function(){var N=this;this.createCollection(window.$hsRemoveElementCollection,this),this.el.addEventListener("click",function(){return N.remove()})},K.prototype.remove=function(){var N=this;if(!this.removeTarget)return!1;this.removeTarget.classList.add(this.removeTargetAnimationClass),(0,Ae.afterTransition)(this.removeTarget,function(){N.removeTarget.remove()})},K.autoInit=function(){window.$hsRemoveElementCollection||(window.$hsRemoveElementCollection=[]),document.querySelectorAll("[data-hs-remove-element]:not(.--prevent-on-load-init)").forEach(function(N){window.$hsRemoveElementCollection.find(function(z){var q;return((q=z==null?void 0:z.element)===null||q===void 0?void 0:q.el)===N})||new K(N)})},K}(se(r(961)).default);window.addEventListener("load",function(){Ce.autoInit()}),typeof window<"u"&&(window.HSRemoveElement=Ce),O.default=Ce},751:function(E,O,r){/*
 * HSScrollspy
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */var U,W=this&&this.__extends||(U=function(Ce,he){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(K,N){K.__proto__=N}||function(K,N){for(var z in N)Object.prototype.hasOwnProperty.call(N,z)&&(K[z]=N[z])},U(Ce,he)},function(Ce,he){if(typeof he!="function"&&he!==null)throw new TypeError("Class extends value "+String(he)+" is not a constructor or null");function K(){this.constructor=Ce}U(Ce,he),Ce.prototype=he===null?Object.create(he):(K.prototype=he.prototype,new K)}),Y=this&&this.__importDefault||function(Ce){return Ce&&Ce.__esModule?Ce:{default:Ce}};Object.defineProperty(O,"__esModule",{value:!0});var se=r(292),Ae=function(Ce){function he(K,N){N===void 0&&(N={});var z=Ce.call(this,K,N)||this;return z.activeSection=null,z.contentId=z.el.getAttribute("data-hs-scrollspy"),z.content=document.querySelector(z.contentId),z.links=z.el.querySelectorAll("[href]"),z.sections=[],z.scrollableId=z.el.getAttribute("data-hs-scrollspy-scrollable-parent"),z.scrollable=z.scrollableId?document.querySelector(z.scrollableId):document,z.init(),z}return W(he,Ce),he.prototype.init=function(){var K=this;this.createCollection(window.$hsScrollspyCollection,this),this.links.forEach(function(N){K.sections.push(K.scrollable.querySelector(N.getAttribute("href")))}),Array.from(this.sections).forEach(function(N){if(!N.getAttribute("id"))return!1;K.scrollable.addEventListener("scroll",function(z){return K.update(z,N)})}),this.links.forEach(function(N){N.addEventListener("click",function(z){if(z.preventDefault(),N.getAttribute("href")==="javascript:;")return!1;K.scrollTo(N)})})},he.prototype.update=function(K,N){var z=parseInt((0,se.getClassProperty)(this.el,"--scrollspy-offset","0")),q=parseInt((0,se.getClassProperty)(N,"--scrollspy-offset"))||z,G=K.target===document?0:parseInt(String(K.target.getBoundingClientRect().top)),Q=parseInt(String(N.getBoundingClientRect().top))-q-G,ee=N.offsetHeight;if(Q<=0&&Q+ee>0){if(this.activeSection===N)return!1;this.links.forEach(function(He){He.classList.remove("active")});var fe=this.el.querySelector('[href="#'.concat(N.getAttribute("id"),'"]'));if(fe){fe.classList.add("active");var ce=fe.closest("[data-hs-scrollspy-group]");if(ce){var Ue=ce.querySelector("[href]");Ue&&Ue.classList.add("active")}}this.activeSection=N}},he.prototype.scrollTo=function(K){var N=K.getAttribute("href"),z=document.querySelector(N),q=parseInt((0,se.getClassProperty)(this.el,"--scrollspy-offset","0")),G=parseInt((0,se.getClassProperty)(z,"--scrollspy-offset"))||q,Q=this.scrollable===document?0:this.scrollable.offsetTop,ee=z.offsetTop-G-Q,fe=this.scrollable===document?window:this.scrollable,ce=function(){window.history.replaceState(null,null,K.getAttribute("href")),"scrollTo"in fe&&fe.scrollTo({top:ee,left:0,behavior:"smooth"})},Ue=this.fireEvent("beforeScroll",this.el);(0,se.dispatch)("beforeScroll.hs.scrollspy",this.el,this.el),Ue instanceof Promise?Ue.then(function(){return ce()}):ce()},he.getInstance=function(K,N){N===void 0&&(N=!1);var z=window.$hsScrollspyCollection.find(function(q){return q.element.el===(typeof K=="string"?document.querySelector(K):K)});return z?N?z:z.element.el:null},he.autoInit=function(){window.$hsScrollspyCollection||(window.$hsScrollspyCollection=[]),document.querySelectorAll("[data-hs-scrollspy]:not(.--prevent-on-load-init)").forEach(function(K){window.$hsScrollspyCollection.find(function(N){var z;return((z=N==null?void 0:N.element)===null||z===void 0?void 0:z.el)===K})||new he(K)})},he}(Y(r(961)).default);window.addEventListener("load",function(){Ae.autoInit()}),typeof window<"u"&&(window.HSScrollspy=Ae),O.default=Ae},442:function(E,O,r){/*
 * HSSelect
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */var U,W=this&&this.__extends||(U=function(z,q){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(G,Q){G.__proto__=Q}||function(G,Q){for(var ee in Q)Object.prototype.hasOwnProperty.call(Q,ee)&&(G[ee]=Q[ee])},U(z,q)},function(z,q){if(typeof q!="function"&&q!==null)throw new TypeError("Class extends value "+String(q)+" is not a constructor or null");function G(){this.constructor=z}U(z,q),z.prototype=q===null?Object.create(q):(G.prototype=q.prototype,new G)}),Y=this&&this.__assign||function(){return Y=Object.assign||function(z){for(var q,G=1,Q=arguments.length;G<Q;G++)for(var ee in q=arguments[G])Object.prototype.hasOwnProperty.call(q,ee)&&(z[ee]=q[ee]);return z},Y.apply(this,arguments)},se=this&&this.__spreadArray||function(z,q,G){if(G||arguments.length===2)for(var Q,ee=0,fe=q.length;ee<fe;ee++)!Q&&ee in q||(Q||(Q=Array.prototype.slice.call(q,0,ee)),Q[ee]=q[ee]);return z.concat(Q||Array.prototype.slice.call(q))},Ae=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(O,"__esModule",{value:!0});var Ce=r(292),he=Ae(r(961)),K=r(223),N=function(z){function q(G,Q){var ee,fe,ce=z.call(this,G,Q)||this,Ue=G.getAttribute("data-hs-select"),He=Ue?JSON.parse(Ue):{},nt=Y(Y({},He),Q),vt={items:", ",betweenItemsAndCounter:"and"};return ce.value=(nt==null?void 0:nt.value)||ce.el.value||null,ce.placeholder=(nt==null?void 0:nt.placeholder)||"Select...",ce.hasSearch=(nt==null?void 0:nt.hasSearch)||!1,ce.preventSearchFocus=(nt==null?void 0:nt.preventSearchFocus)||!1,ce.mode=(nt==null?void 0:nt.mode)||"default",ce.viewport=(nt==null?void 0:nt.viewport)!==void 0?document.querySelector(nt==null?void 0:nt.viewport):null,ce.isOpened=!!(nt!=null&&nt.isOpened)||!1,ce.isMultiple=ce.el.hasAttribute("multiple")||!1,ce.isDisabled=ce.el.hasAttribute("disabled")||!1,ce.selectedItems=[],ce.wrapperClasses=(nt==null?void 0:nt.wrapperClasses)||null,ce.toggleTag=(nt==null?void 0:nt.toggleTag)||null,ce.toggleClasses=(nt==null?void 0:nt.toggleClasses)||null,ce.toggleSeparators=(ee=Y(Y({},vt),nt==null?void 0:nt.toggleSeparators))!==null&&ee!==void 0?ee:vt,ce.toggleCountText=(nt==null?void 0:nt.toggleCountText)||null,ce.toggleCountTextMinItems=(nt==null?void 0:nt.toggleCountTextMinItems)||1,ce.toggleCountTextMode=(nt==null?void 0:nt.toggleCountTextMode)||"countAfterLimit",ce.tagsItemTemplate=(nt==null?void 0:nt.tagsItemTemplate)||null,ce.tagsItemClasses=(nt==null?void 0:nt.tagsItemClasses)||null,ce.tagsInputClasses=(nt==null?void 0:nt.tagsInputClasses)||null,ce.dropdownTag=(nt==null?void 0:nt.dropdownTag)||null,ce.dropdownClasses=(nt==null?void 0:nt.dropdownClasses)||null,ce.dropdownDirectionClasses=(nt==null?void 0:nt.dropdownDirectionClasses)||null,ce.dropdownSpace=(nt==null?void 0:nt.dropdownSpace)||10,ce.searchWrapperTemplate=(nt==null?void 0:nt.searchWrapperTemplate)||null,ce.searchWrapperClasses=(nt==null?void 0:nt.searchWrapperClasses)||"bg-white p-2 sticky top-0",ce.searchClasses=(nt==null?void 0:nt.searchClasses)||"block w-[calc(100%-2rem)] text-sm border-gray-200 rounded-md focus:border-blue-500 focus:ring-blue-500 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-400 py-2 px-3 my-2 mx-4",ce.searchPlaceholder=(nt==null?void 0:nt.searchPlaceholder)||"Search...",ce.searchNoResultText=(nt==null?void 0:nt.searchNoResultText)||"No results found",ce.searchNoResultClasses=(nt==null?void 0:nt.searchNoResultClasses)||"px-4 text-sm text-gray-800 dark:text-neutral-200",ce.optionTemplate=(nt==null?void 0:nt.optionTemplate)||null,ce.optionTag=(nt==null?void 0:nt.optionTag)||null,ce.optionClasses=(nt==null?void 0:nt.optionClasses)||null,ce.extraMarkup=(nt==null?void 0:nt.extraMarkup)||null,ce.descriptionClasses=(nt==null?void 0:nt.descriptionClasses)||null,ce.iconClasses=(nt==null?void 0:nt.iconClasses)||null,ce.isAddTagOnEnter=(fe=nt==null?void 0:nt.isAddTagOnEnter)===null||fe===void 0||fe,ce.animationInProcess=!1,ce.selectOptions=[],ce.tagsInputHelper=null,ce.init(),ce}return W(q,z),q.prototype.setValue=function(G){this.value=G,this.clearSelections(),Array.isArray(G)?(this.toggleTextWrapper.innerHTML=this.value.length?this.stringFromValue():this.placeholder,this.unselectMultipleItems(),this.selectMultipleItems()):(this.setToggleTitle(),this.toggle.querySelector("[data-icon]")&&this.setToggleIcon(),this.toggle.querySelector("[data-title]")&&this.setToggleTitle(),this.selectSingleItem())},q.prototype.init=function(){this.createCollection(window.$hsSelectCollection,this),this.build()},q.prototype.build=function(){var G=this;if(this.el.style.display="none",this.el.children&&Array.from(this.el.children).filter(function(fe){return fe.value&&fe.value!==""}).forEach(function(fe){var ce=fe.getAttribute("data-hs-select-option");G.selectOptions=se(se([],G.selectOptions,!0),[{title:fe.textContent,val:fe.value,disabled:fe.disabled,options:ce!=="undefined"?JSON.parse(ce):null}],!1)}),this.isMultiple){var Q=Array.from(this.el.children).filter(function(fe){return fe.selected});if(Q){var ee=[];Q.forEach(function(fe){ee.push(fe.value)}),this.value=ee}}this.buildWrapper(),this.mode==="tags"?this.buildTags():this.buildToggle(),this.buildDropdown(),this.extraMarkup&&this.buildExtraMarkup()},q.prototype.buildWrapper=function(){var G=this;this.wrapper=document.createElement("div"),this.wrapper.classList.add("hs-select","relative"),this.mode==="tags"&&this.wrapper.addEventListener("click",function(Q){Q.target.closest("[data-hs-select-dropdown]")||Q.target.closest("[data-tag-value]")||G.tagsInput.focus()}),this.wrapperClasses&&(0,Ce.classToClassList)(this.wrapperClasses,this.wrapper),this.el.before(this.wrapper),this.wrapper.append(this.el)},q.prototype.buildExtraMarkup=function(){var G=this,Q=function(ee){G.wrapper.append((0,Ce.htmlToElement)(ee))};Array.isArray(this.extraMarkup)?this.extraMarkup.forEach(function(ee){return Q(ee)}):Q(this.extraMarkup)},q.prototype.buildToggle=function(){var G,Q,ee,fe,ce=this;this.toggleTextWrapper=document.createElement("span"),this.toggleTextWrapper.classList.add("truncate"),this.toggle=(0,Ce.htmlToElement)(this.toggleTag||"<div></div>"),ee=this.toggle.querySelector("[data-icon]"),fe=this.toggle.querySelector("[data-title]"),!this.isMultiple&&ee&&this.setToggleIcon(),!this.isMultiple&&fe&&this.setToggleTitle(),this.isMultiple?this.toggleTextWrapper.innerHTML=this.value.length?this.stringFromValue():this.placeholder:this.toggleTextWrapper.innerHTML=((G=this.getItemByValue(this.value))===null||G===void 0?void 0:G.title)||this.placeholder,fe||this.toggle.append(this.toggleTextWrapper),this.toggleClasses&&(0,Ce.classToClassList)(this.toggleClasses,this.toggle),this.isDisabled&&this.toggle.classList.add("disabled"),this.wrapper&&this.wrapper.append(this.toggle),!((Q=this.toggle)===null||Q===void 0)&&Q.ariaExpanded&&(this.isOpened?this.toggle.ariaExpanded="true":this.toggle.ariaExpanded="false"),this.toggle.addEventListener("click",function(){if(ce.isDisabled)return!1;ce.isOpened?ce.close():ce.open()})},q.prototype.setToggleIcon=function(){var G,Q,ee=this.toggle.querySelector("[data-icon]");if(ee.innerHTML="",ee){var fe=(0,Ce.htmlToElement)(((Q=(G=this.getItemByValue(this.value))===null||G===void 0?void 0:G.options)===null||Q===void 0?void 0:Q.icon)||"");ee.append(fe),fe?ee.classList.remove("hidden"):ee.classList.add("hidden")}},q.prototype.setToggleTitle=function(){var G,Q=this.toggle.querySelector("[data-title]");if(Q.classList.add("truncate"),Q.innerHTML="",Q){var ee=((G=this.getItemByValue(this.value))===null||G===void 0?void 0:G.title)||this.placeholder;Q.innerHTML=ee,this.toggle.append(Q)}},q.prototype.buildTags=function(){this.isDisabled&&this.wrapper.classList.add("disabled"),this.buildTagsInput(),this.setTagsItems()},q.prototype.reassignTagsInputPlaceholder=function(G){this.tagsInput.placeholder=G,this.tagsInputHelper.innerHTML=G,this.calculateInputWidth()},q.prototype.buildTagsItem=function(G){var Q,ee,fe,ce,Ue,He,nt,vt=this,xt=this.getItemByValue(G),Ot=document.createElement("div");if(Ot.setAttribute("data-tag-value",G),this.tagsItemClasses&&(0,Ce.classToClassList)(this.tagsItemClasses,Ot),this.tagsItemTemplate&&(ce=(0,Ce.htmlToElement)(this.tagsItemTemplate),Ot.append(ce)),(Q=xt==null?void 0:xt.options)===null||Q===void 0?void 0:Q.icon){var Ui=(0,Ce.htmlToElement)((ee=xt==null?void 0:xt.options)===null||ee===void 0?void 0:ee.icon);(nt=ce?ce.querySelector("[data-icon]"):document.createElement("span")).append(Ui),ce||Ot.append(nt)}ce&&ce.querySelector("[data-icon]")&&!(!((fe=xt==null?void 0:xt.options)===null||fe===void 0)&&fe.icon)&&ce.querySelector("[data-icon]").classList.add("hidden"),(Ue=ce?ce.querySelector("[data-title]"):document.createElement("span")).textContent=xt.title||"",ce||Ot.append(Ue),ce?He=ce.querySelector("[data-remove]"):((He=document.createElement("span")).textContent="X",Ot.append(He)),He.addEventListener("click",function(){vt.value=vt.value.filter(function(Mt){return Mt!==G}),vt.selectedItems=vt.selectedItems.filter(function(Mt){return Mt!==G}),vt.value.length||vt.reassignTagsInputPlaceholder(vt.placeholder),vt.unselectMultipleItems(),vt.selectMultipleItems(),Ot.remove()}),this.wrapper.append(Ot)},q.prototype.getItemByValue=function(G){return this.selectOptions.find(function(Q){return Q.val===G})},q.prototype.setTagsItems=function(){var G=this;this.value&&this.value.forEach(function(Q){G.selectedItems.includes(Q)||G.buildTagsItem(Q),G.selectedItems=G.selectedItems.includes(Q)?G.selectedItems:se(se([],G.selectedItems,!0),[Q],!1)})},q.prototype.buildTagsInput=function(){var G=this;this.tagsInput=document.createElement("input"),this.tagsInputClasses&&(0,Ce.classToClassList)(this.tagsInputClasses,this.tagsInput),this.tagsInput.addEventListener("focus",function(){return G.open()}),this.tagsInput.addEventListener("input",function(){return G.calculateInputWidth()}),this.tagsInput.addEventListener("input",(0,Ce.debounce)(function(Q){return G.searchOptions(Q.target.value)})),this.tagsInput.addEventListener("keydown",function(Q){if(Q.key==="Enter"&&G.isAddTagOnEnter){var ee=Q.target.value;if(G.selectOptions.find(function(fe){return fe.val===ee}))return!1;G.addSelectOption(ee,ee),G.buildOption(ee,ee),G.dropdown.querySelector('[data-value="'.concat(ee,'"]')).click(),G.resetTagsInputField()}}),this.wrapper.append(this.tagsInput),setTimeout(function(){G.adjustInputWidth(),G.reassignTagsInputPlaceholder(G.value.length?"":G.placeholder)})},q.prototype.buildDropdown=function(){var G=this;this.dropdown=(0,Ce.htmlToElement)(this.dropdownTag||"<div></div>"),this.dropdown.setAttribute("data-hs-select-dropdown",""),this.dropdown.classList.add("absolute","top-full"),this.dropdown.role="listbox",this.dropdown.tabIndex=-1,this.dropdown.ariaOrientation="vertical",this.isOpened||this.dropdown.classList.add("hidden"),this.dropdownClasses&&(0,Ce.classToClassList)(this.dropdownClasses,this.dropdown),this.wrapper&&this.wrapper.append(this.dropdown),this.dropdown&&this.hasSearch&&this.buildSearch(),this.selectOptions&&this.selectOptions.forEach(function(Q,ee){return G.buildOption(Q.title,Q.val,Q.disabled,Q.selected,Q.options,"".concat(ee))})},q.prototype.buildSearch=function(){var G,Q=this;this.searchWrapper=(0,Ce.htmlToElement)(this.searchWrapperTemplate||"<div></div>"),this.searchWrapperClasses&&(0,Ce.classToClassList)(this.searchWrapperClasses,this.searchWrapper),G=this.searchWrapper.querySelector("[data-input]"),this.search=(0,Ce.htmlToElement)('<input type="text" />'),this.search.placeholder=this.searchPlaceholder,this.searchClasses&&(0,Ce.classToClassList)(this.searchClasses,this.search),this.search.addEventListener("input",(0,Ce.debounce)(function(ee){return Q.searchOptions(ee.target.value)})),G?G.append(this.search):this.searchWrapper.append(this.search),this.dropdown.append(this.searchWrapper)},q.prototype.buildOption=function(G,Q,ee,fe,ce,Ue){var He=this;ee===void 0&&(ee=!1),fe===void 0&&(fe=!1),Ue===void 0&&(Ue="1");var nt=null,vt=(0,Ce.htmlToElement)(this.optionTag||"<div></div>");if(vt.setAttribute("data-value",Q),vt.setAttribute("data-title-value",G),vt.setAttribute("tabIndex",Ue),vt.classList.add("cursor-pointer"),ee&&vt.classList.add("disabled"),fe&&(this.isMultiple?this.value=se(se([],this.value,!0),[Q],!1):this.value=Q),this.optionTemplate&&(nt=(0,Ce.htmlToElement)(this.optionTemplate),vt.append(nt)),nt?nt.querySelector("[data-title]").textContent=G||"":vt.textContent=G||"",ce){if(ce.icon){var xt=(0,Ce.htmlToElement)(ce.icon);if(xt.classList.add("max-w-full"),nt)nt.querySelector("[data-icon]").append(xt);else{var Ot=(0,Ce.htmlToElement)("<div></div>");this.iconClasses&&(0,Ce.classToClassList)(this.iconClasses,Ot),Ot.append(xt),vt.append(Ot)}}if(ce.description)if(nt)nt.querySelector("[data-description]").append(ce.description);else{var Ui=(0,Ce.htmlToElement)("<div></div>");Ui.textContent=ce.description,this.descriptionClasses&&(0,Ce.classToClassList)(this.descriptionClasses,Ui),vt.append(Ui)}}nt&&nt.querySelector("[data-icon]")&&!ce&&!(ce!=null&&ce.icon)&&nt.querySelector("[data-icon]").classList.add("hidden"),this.value&&(this.isMultiple?this.value.includes(Q):this.value===Q)&&vt.classList.add("selected"),ee||vt.addEventListener("click",function(){return He.onSelectOption(Q)}),this.optionClasses&&(0,Ce.classToClassList)(this.optionClasses,vt),this.dropdown&&this.dropdown.append(vt),fe&&this.setNewValue()},q.prototype.destroyOption=function(G){var Q=this.dropdown.querySelector('[data-value="'.concat(G,'"]'));if(!Q)return!1;Q.remove()},q.prototype.buildOriginalOption=function(G,Q,ee,fe,ce){var Ue=(0,Ce.htmlToElement)("<option></option>");Ue.setAttribute("value",Q),ee&&Ue.setAttribute("disabled","disabled"),fe&&Ue.setAttribute("selected","selected"),Ue.setAttribute("data-hs-select-option",JSON.stringify(ce)),Ue.innerText=G,this.el.append(Ue)},q.prototype.destroyOriginalOption=function(G){var Q=this.el.querySelector('[value="'.concat(G,'"]'));if(!Q)return!1;Q.remove()},q.prototype.buildTagsInputHelper=function(){this.tagsInputHelper=document.createElement("span"),this.tagsInputHelper.style.fontSize=window.getComputedStyle(this.tagsInput).fontSize,this.tagsInputHelper.style.fontFamily=window.getComputedStyle(this.tagsInput).fontFamily,this.tagsInputHelper.style.fontWeight=window.getComputedStyle(this.tagsInput).fontWeight,this.tagsInputHelper.style.letterSpacing=window.getComputedStyle(this.tagsInput).letterSpacing,this.tagsInputHelper.style.visibility="hidden",this.tagsInputHelper.style.whiteSpace="pre",this.tagsInputHelper.style.position="absolute",this.wrapper.appendChild(this.tagsInputHelper)},q.prototype.calculateInputWidth=function(){this.tagsInputHelper.textContent=this.tagsInput.value||this.tagsInput.placeholder;var G=parseInt(window.getComputedStyle(this.tagsInput).paddingLeft)+parseInt(window.getComputedStyle(this.tagsInput).paddingRight),Q=parseInt(window.getComputedStyle(this.tagsInput).borderLeftWidth)+parseInt(window.getComputedStyle(this.tagsInput).borderRightWidth),ee=this.tagsInputHelper.offsetWidth+G+Q,fe=this.wrapper.offsetWidth-(parseInt(window.getComputedStyle(this.wrapper).paddingLeft)+parseInt(window.getComputedStyle(this.wrapper).paddingRight));this.tagsInput.style.width="".concat(Math.min(ee,fe)+2,"px")},q.prototype.adjustInputWidth=function(){this.buildTagsInputHelper(),this.calculateInputWidth()},q.prototype.onSelectOption=function(G){var Q=this;if(this.clearSelections(),this.isMultiple?(this.value=this.value.includes(G)?Array.from(this.value).filter(function(fe){return fe!==G}):se(se([],Array.from(this.value),!0),[G],!1),this.selectMultipleItems(),this.setNewValue()):(this.value=G,this.selectSingleItem(),this.setNewValue()),this.fireEvent("change",this.value),(0,Ce.dispatch)("change.hs.select",this.el,this.value),this.mode==="tags"){var ee=this.selectedItems.filter(function(fe){return!Q.value.includes(fe)});ee.length&&ee.forEach(function(fe){Q.selectedItems=Q.selectedItems.filter(function(ce){return ce!==fe}),Q.wrapper.querySelector('[data-tag-value="'.concat(fe,'"]')).remove()}),this.resetTagsInputField()}this.isMultiple||(this.toggle.querySelector("[data-icon]")&&this.setToggleIcon(),this.toggle.querySelector("[data-title]")&&this.setToggleTitle(),this.close()),this.value.length||this.mode!=="tags"||this.reassignTagsInputPlaceholder(this.placeholder),this.isOpened&&this.mode==="tags"&&this.tagsInput&&this.tagsInput.focus(),this.triggerChangeEventForNativeSelect()},q.prototype.triggerChangeEventForNativeSelect=function(){var G=new Event("change",{bubbles:!0});this.el.dispatchEvent(G)},q.prototype.addSelectOption=function(G,Q,ee,fe,ce){this.selectOptions=se(se([],this.selectOptions,!0),[{title:G,val:Q,disabled:ee,selected:fe,options:ce}],!1)},q.prototype.removeSelectOption=function(G,Q){if(Q===void 0&&(Q=!1),!this.selectOptions.some(function(ee){return ee.val===G}))return!1;this.selectOptions=this.selectOptions.filter(function(ee){return ee.val!==G}),console.log(Q),this.value=Q?this.value.filter(function(ee){return ee!==G}):G,console.log(this.value)},q.prototype.resetTagsInputField=function(){this.tagsInput.value="",this.reassignTagsInputPlaceholder(""),this.searchOptions("")},q.prototype.clearSelections=function(){Array.from(this.dropdown.children).forEach(function(G){G.classList.contains("selected")&&G.classList.remove("selected")}),Array.from(this.el.children).forEach(function(G){G.selected&&(G.selected=!1)})},q.prototype.setNewValue=function(){this.mode==="tags"?this.setTagsItems():(console.log(),this.value.length?this.toggleTextWrapper.innerHTML=this.stringFromValue():this.toggleTextWrapper.innerHTML=this.placeholder)},q.prototype.stringFromValue=function(){var G=this,Q=[],ee="";if(this.selectOptions.forEach(function(ce){G.isMultiple?G.value.includes(ce.val)&&Q.push(ce.title):G.value===ce.val&&Q.push(ce.title)}),this.toggleCountText&&this.toggleCountText!==""&&Q.length>=this.toggleCountTextMinItems)if(this.toggleCountTextMode==="nItemsAndCount"){var fe=Q.slice(0,this.toggleCountTextMinItems-1);ee="".concat(fe.join(this.toggleSeparators.items)," ").concat(this.toggleSeparators.betweenItemsAndCounter," ").concat(Q.length-fe.length," ").concat(this.toggleCountText)}else ee="".concat(Q.length," ").concat(this.toggleCountText);else ee=Q.join(this.toggleSeparators.items);return ee},q.prototype.selectSingleItem=function(){var G=this;Array.from(this.el.children).find(function(ee){return G.value===ee.value}).selected=!0;var Q=Array.from(this.dropdown.children).find(function(ee){return G.value===ee.getAttribute("data-value")});Q&&Q.classList.add("selected")},q.prototype.selectMultipleItems=function(){var G=this;Array.from(this.dropdown.children).filter(function(Q){return G.value.includes(Q.getAttribute("data-value"))}).forEach(function(Q){return Q.classList.add("selected")}),Array.from(this.el.children).filter(function(Q){return G.value.includes(Q.value)}).forEach(function(Q){return Q.selected=!0})},q.prototype.unselectMultipleItems=function(){Array.from(this.dropdown.children).forEach(function(G){return G.classList.remove("selected")}),Array.from(this.el.children).forEach(function(G){return G.selected=!1})},q.prototype.searchOptions=function(G){this.searchNoResult&&(this.searchNoResult.remove(),this.searchNoResult=null),this.searchNoResult=(0,Ce.htmlToElement)("<span></span>"),this.searchNoResult.innerText=this.searchNoResultText,(0,Ce.classToClassList)(this.searchNoResultClasses,this.searchNoResult);var Q=this.dropdown.querySelectorAll("[data-value]"),ee=!1;Q.forEach(function(fe){fe.getAttribute("data-title-value").toLocaleLowerCase().includes(G.toLocaleLowerCase())?(fe.classList.remove("hidden"),ee=!0):fe.classList.add("hidden")}),ee||this.dropdown.append(this.searchNoResult)},q.prototype.eraseToggleIcon=function(){var G=this.toggle.querySelector("[data-icon]");G&&(G.innerHTML=null,G.classList.add("hidden"))},q.prototype.eraseToggleTitle=function(){var G=this.toggle.querySelector("[data-title]");G?G.innerHTML=this.placeholder:this.toggleTextWrapper.innerHTML=this.placeholder},q.prototype.destroy=function(){var G=this.el.parentElement.parentElement;this.el.classList.remove("hidden"),this.el.style.display="",G.prepend(this.el),G.querySelector(".hs-select").remove(),this.wrapper=null},q.prototype.open=function(){var G,Q=this,ee=((G=window==null?void 0:window.$hsSelectCollection)===null||G===void 0?void 0:G.find(function(fe){return fe.element.isOpened}))||null;if(ee&&ee.element.close(),this.animationInProcess)return!1;this.animationInProcess=!0,this.dropdown.classList.remove("hidden"),this.recalculateDirection(),setTimeout(function(){var fe;!((fe=Q==null?void 0:Q.toggle)===null||fe===void 0)&&fe.ariaExpanded&&(Q.toggle.ariaExpanded="true"),Q.wrapper.classList.add("active"),Q.dropdown.classList.add("opened"),Q.hasSearch&&!Q.preventSearchFocus&&Q.search.focus(),Q.animationInProcess=!1}),this.isOpened=!0},q.prototype.close=function(){var G,Q,ee,fe,ce=this;if(this.animationInProcess)return!1;this.animationInProcess=!0,!((G=this==null?void 0:this.toggle)===null||G===void 0)&&G.ariaExpanded&&(this.toggle.ariaExpanded="false"),this.wrapper.classList.remove("active"),this.dropdown.classList.remove("opened","bottom-full","top-full"),!((Q=this.dropdownDirectionClasses)===null||Q===void 0)&&Q.bottom&&this.dropdown.classList.remove(this.dropdownDirectionClasses.bottom),!((ee=this.dropdownDirectionClasses)===null||ee===void 0)&&ee.top&&this.dropdown.classList.remove(this.dropdownDirectionClasses.top),this.dropdown.style.marginTop="",this.dropdown.style.marginBottom="",(0,Ce.afterTransition)(this.dropdown,function(){ce.dropdown.classList.add("hidden"),ce.hasSearch&&(ce.search.value="",ce.search.dispatchEvent(new Event("input",{bubbles:!0})),ce.search.blur()),ce.animationInProcess=!1}),(fe=this.dropdown.querySelector(".hs-select-option-highlighted"))===null||fe===void 0||fe.classList.remove("hs-select-option-highlighted"),this.isOpened=!1},q.prototype.addOption=function(G){var Q=this,ee="".concat(this.selectOptions.length),fe=function(ce){var Ue=ce.title,He=ce.val,nt=ce.disabled,vt=ce.selected,xt=ce.options;Q.selectOptions.some(function(Ot){return Ot.val===He})||(Q.addSelectOption(Ue,He,nt,vt,xt),Q.buildOption(Ue,He,nt,vt,xt,ee),Q.buildOriginalOption(Ue,He,nt,vt,xt),vt&&!Q.isMultiple&&Q.onSelectOption(He))};Array.isArray(G)?G.forEach(function(ce){fe(ce)}):fe(G)},q.prototype.removeOption=function(G){var Q=this,ee=function(fe,ce){ce===void 0&&(ce=!1),Q.selectOptions.some(function(Ue){return Ue.val===fe})&&(Q.removeSelectOption(fe,ce),Q.destroyOption(fe),Q.destroyOriginalOption(fe),Q.value===fe&&(Q.value=null,Q.eraseToggleTitle(),Q.eraseToggleIcon()))};Array.isArray(G)?G.forEach(function(fe){ee(fe,Q.isMultiple)}):ee(G,this.isMultiple),this.setNewValue()},q.prototype.recalculateDirection=function(){var G,Q,ee,fe;(0,Ce.isEnoughSpace)(this.dropdown,this.toggle||this.tagsInput,"bottom",this.dropdownSpace,this.viewport)?(this.dropdown.classList.remove("bottom-full"),!((G=this.dropdownDirectionClasses)===null||G===void 0)&&G.bottom&&this.dropdown.classList.remove(this.dropdownDirectionClasses.bottom),this.dropdown.style.marginBottom="",this.dropdown.classList.add("top-full"),!((Q=this.dropdownDirectionClasses)===null||Q===void 0)&&Q.top&&this.dropdown.classList.add(this.dropdownDirectionClasses.top),this.dropdown.style.marginTop="".concat(this.dropdownSpace,"px")):(this.dropdown.classList.remove("top-full"),!((ee=this.dropdownDirectionClasses)===null||ee===void 0)&&ee.top&&this.dropdown.classList.remove(this.dropdownDirectionClasses.top),this.dropdown.style.marginTop="",this.dropdown.classList.add("bottom-full"),!((fe=this.dropdownDirectionClasses)===null||fe===void 0)&&fe.bottom&&this.dropdown.classList.add(this.dropdownDirectionClasses.bottom),this.dropdown.style.marginBottom="".concat(this.dropdownSpace,"px"))},q.getInstance=function(G,Q){var ee=window.$hsSelectCollection.find(function(fe){return fe.element.el===(typeof G=="string"?document.querySelector(G):G)});return ee?Q?ee:ee.element:null},q.autoInit=function(){window.$hsSelectCollection||(window.$hsSelectCollection=[]),document.querySelectorAll("[data-hs-select]:not(.--prevent-on-load-init)").forEach(function(G){if(!window.$hsSelectCollection.find(function(fe){var ce;return((ce=fe==null?void 0:fe.element)===null||ce===void 0?void 0:ce.el)===G})){var Q=G.getAttribute("data-hs-select"),ee=Q?JSON.parse(Q):{};new q(G,ee)}}),window.$hsSelectCollection&&(window.addEventListener("click",function(G){var Q=G.target;q.closeCurrentlyOpened(Q)}),document.addEventListener("keydown",function(G){return q.accessibility(G)}))},q.open=function(G){var Q=window.$hsSelectCollection.find(function(ee){return ee.element.el===(typeof G=="string"?document.querySelector(G):G)});Q&&!Q.element.isOpened&&Q.element.open()},q.close=function(G){var Q=window.$hsSelectCollection.find(function(ee){return ee.element.el===(typeof G=="string"?document.querySelector(G):G)});Q&&Q.element.isOpened&&Q.element.close()},q.closeCurrentlyOpened=function(G){if(G===void 0&&(G=null),!G.closest(".hs-select.active")){var Q=window.$hsSelectCollection.filter(function(ee){return ee.element.isOpened})||null;Q&&Q.forEach(function(ee){ee.element.close()})}},q.accessibility=function(G){if(window.$hsSelectCollection.find(function(Q){return Q.element.isOpened})&&K.SELECT_ACCESSIBILITY_KEY_SET.includes(G.code)&&!G.metaKey)switch(G.code){case"Escape":G.preventDefault(),this.onEscape();break;case"ArrowUp":G.preventDefault(),G.stopImmediatePropagation(),this.onArrow();break;case"ArrowDown":G.preventDefault(),G.stopImmediatePropagation(),this.onArrow(!1);break;case"Tab":G.preventDefault(),G.stopImmediatePropagation(),this.onTab(G.shiftKey);break;case"Home":G.preventDefault(),G.stopImmediatePropagation(),this.onStartEnd();break;case"End":G.preventDefault(),G.stopImmediatePropagation(),this.onStartEnd(!1);break;case"Enter":G.preventDefault(),this.onEnter(G)}},q.onEscape=function(){var G=window.$hsSelectCollection.find(function(Q){return Q.element.isOpened});G&&G.element.close()},q.onArrow=function(G){G===void 0&&(G=!0);var Q=window.$hsSelectCollection.find(function(He){return He.element.isOpened});if(Q){var ee=Q.element.dropdown;if(!ee)return!1;var fe=(G?Array.from(ee.querySelectorAll(":scope > *:not(.hidden)")).reverse():Array.from(ee.querySelectorAll(":scope > *:not(.hidden)"))).filter(function(He){return!He.classList.contains("disabled")}),ce=ee.querySelector(".hs-select-option-highlighted")||ee.querySelector(".selected");ce||fe[0].classList.add("hs-select-option-highlighted");var Ue=fe.findIndex(function(He){return He===ce});Ue+1<fe.length&&Ue++,fe[Ue].focus(),ce&&ce.classList.remove("hs-select-option-highlighted"),fe[Ue].classList.add("hs-select-option-highlighted")}},q.onTab=function(G){G===void 0&&(G=!0);var Q=window.$hsSelectCollection.find(function(He){return He.element.isOpened});if(Q){var ee=Q.element.dropdown;if(!ee)return!1;var fe=(G?Array.from(ee.querySelectorAll(":scope >  *:not(.hidden)")).reverse():Array.from(ee.querySelectorAll(":scope >  *:not(.hidden)"))).filter(function(He){return!He.classList.contains("disabled")}),ce=ee.querySelector(".hs-select-option-highlighted")||ee.querySelector(".selected");ce||fe[0].classList.add("hs-select-option-highlighted");var Ue=fe.findIndex(function(He){return He===ce});if(!(Ue+1<fe.length))return ce&&ce.classList.remove("hs-select-option-highlighted"),Q.element.close(),Q.element.toggle.focus(),!1;fe[++Ue].focus(),ce&&ce.classList.remove("hs-select-option-highlighted"),fe[Ue].classList.add("hs-select-option-highlighted")}},q.onStartEnd=function(G){G===void 0&&(G=!0);var Q=window.$hsSelectCollection.find(function(Ue){return Ue.element.isOpened});if(Q){var ee=Q.element.dropdown;if(!ee)return!1;var fe=(G?Array.from(ee.querySelectorAll(":scope >  *:not(.hidden)")):Array.from(ee.querySelectorAll(":scope >  *:not(.hidden)")).reverse()).filter(function(Ue){return!Ue.classList.contains("disabled")}),ce=ee.querySelector(".hs-select-option-highlighted");fe.length&&(fe[0].focus(),ce&&ce.classList.remove("hs-select-option-highlighted"),fe[0].classList.add("hs-select-option-highlighted"))}},q.onEnter=function(G){var Q=G.target.previousSibling;if(window.$hsSelectCollection.find(function(ce){return ce.element.el===Q})){var ee=window.$hsSelectCollection.find(function(ce){return ce.element.isOpened}),fe=window.$hsSelectCollection.find(function(ce){return ce.element.el===Q});ee.element.close(),fe.element.open()}else(fe=window.$hsSelectCollection.find(function(ce){return ce.element.isOpened}))&&fe.element.onSelectOption(G.target.dataset.value||"")},q}(he.default);window.addEventListener("load",function(){N.autoInit()}),document.addEventListener("scroll",function(){if(!window.$hsSelectCollection)return!1;var z=window.$hsSelectCollection.find(function(q){return q.element.isOpened});z&&z.element.recalculateDirection()}),typeof window<"u"&&(window.HSSelect=N),O.default=N},887:function(E,O,r){/*
 * HSStepper
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */var U,W=this&&this.__extends||(U=function(he,K){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,z){N.__proto__=z}||function(N,z){for(var q in z)Object.prototype.hasOwnProperty.call(z,q)&&(N[q]=z[q])},U(he,K)},function(he,K){if(typeof K!="function"&&K!==null)throw new TypeError("Class extends value "+String(K)+" is not a constructor or null");function N(){this.constructor=he}U(he,K),he.prototype=K===null?Object.create(K):(N.prototype=K.prototype,new N)}),Y=this&&this.__assign||function(){return Y=Object.assign||function(he){for(var K,N=1,z=arguments.length;N<z;N++)for(var q in K=arguments[N])Object.prototype.hasOwnProperty.call(K,q)&&(he[q]=K[q]);return he},Y.apply(this,arguments)},se=this&&this.__importDefault||function(he){return he&&he.__esModule?he:{default:he}};Object.defineProperty(O,"__esModule",{value:!0});var Ae=r(292),Ce=function(he){function K(N,z){var q=he.call(this,N,z)||this,G=N.getAttribute("data-hs-stepper"),Q=G?JSON.parse(G):{},ee=Y(Y({},Q),z);return q.currentIndex=(ee==null?void 0:ee.currentIndex)||1,q.mode=(ee==null?void 0:ee.mode)||"linear",q.isCompleted=(ee==null?void 0:ee.isCompleted)!==void 0&&(ee==null?void 0:ee.isCompleted),q.totalSteps=1,q.navItems=[],q.contentItems=[],q.init(),q}return W(K,he),K.prototype.init=function(){this.createCollection(window.$hsStepperCollection,this),this.buildNav(),this.buildContent(),this.buildButtons(),this.setTotalSteps()},K.prototype.getUncompletedSteps=function(N){return N===void 0&&(N=!1),this.navItems.filter(function(z){var q=z.isCompleted,G=z.isSkip;return N?!q||G:!q&&!G})},K.prototype.setTotalSteps=function(){var N=this;this.navItems.forEach(function(z){var q=z.index;q>N.totalSteps&&(N.totalSteps=q)})},K.prototype.buildNav=function(){var N=this;this.el.querySelectorAll("[data-hs-stepper-nav-item]").forEach(function(z){return N.addNavItem(z)}),this.navItems.forEach(function(z){return N.buildNavItem(z)})},K.prototype.buildNavItem=function(N){var z=this,q=N.index,G=N.isDisabled,Q=N.el;q===this.currentIndex&&this.setCurrentNavItem(),(this.mode!=="linear"||G)&&Q.addEventListener("click",function(){return z.handleNavItemClick(N)})},K.prototype.addNavItem=function(N){var z=JSON.parse(N.getAttribute("data-hs-stepper-nav-item")),q=z.index,G=z.isFinal,Q=G!==void 0&&G,ee=z.isCompleted,fe=ee!==void 0&&ee,ce=z.isSkip,Ue=ce!==void 0&&ce,He=z.isOptional,nt=He!==void 0&&He,vt=z.isDisabled,xt=vt!==void 0&&vt,Ot=z.isProcessed,Ui=Ot!==void 0&&Ot,Mt=z.hasError,_i=Mt!==void 0&&Mt;fe&&N.classList.add("success"),Ue&&N.classList.add("skipped"),xt&&(N.tagName!=="BUTTON"&&N.tagName!=="INPUT"||N.setAttribute("disabled","disabled"),N.classList.add("disabled")),_i&&N.classList.add("error"),this.navItems.push({index:q,isFinal:Q,isCompleted:fe,isSkip:Ue,isOptional:nt,isDisabled:xt,isProcessed:Ui,hasError:_i,el:N})},K.prototype.setCurrentNavItem=function(){var N=this;this.navItems.forEach(function(z){var q=z.index,G=z.el;q===N.currentIndex?N.setCurrentNavItemActions(G):N.unsetCurrentNavItemActions(G)})},K.prototype.setCurrentNavItemActions=function(N){N.classList.add("active"),this.fireEvent("active",this.currentIndex),(0,Ae.dispatch)("active.hs.stepper",this.el,this.currentIndex)},K.prototype.getNavItem=function(N){return N===void 0&&(N=this.currentIndex),this.navItems.find(function(z){return z.index===N})},K.prototype.setProcessedNavItemActions=function(N){N.isProcessed=!0,N.el.classList.add("processed")},K.prototype.setErrorNavItemActions=function(N){N.hasError=!0,N.el.classList.add("error")},K.prototype.unsetCurrentNavItemActions=function(N){N.classList.remove("active")},K.prototype.handleNavItemClick=function(N){var z=N.index;this.currentIndex=z,this.setCurrentNavItem(),this.setCurrentContentItem(),this.checkForTheFirstStep()},K.prototype.buildContent=function(){var N=this;this.el.querySelectorAll("[data-hs-stepper-content-item]").forEach(function(z){return N.addContentItem(z)}),this.navItems.forEach(function(z){return N.buildContentItem(z)})},K.prototype.buildContentItem=function(N){N.index===this.currentIndex&&this.setCurrentContentItem()},K.prototype.addContentItem=function(N){var z=JSON.parse(N.getAttribute("data-hs-stepper-content-item")),q=z.index,G=z.isFinal,Q=G!==void 0&&G,ee=z.isCompleted,fe=ee!==void 0&&ee,ce=z.isSkip,Ue=ce!==void 0&&ce;fe&&N.classList.add("success"),Ue&&N.classList.add("skipped"),this.contentItems.push({index:q,isFinal:Q,isCompleted:fe,isSkip:Ue,el:N})},K.prototype.setCurrentContentItem=function(){var N=this;if(this.isCompleted){var z=this.contentItems.find(function(G){return G.isFinal}),q=this.contentItems.filter(function(G){return!G.isFinal});return z.el.style.display="",q.forEach(function(G){return G.el.style.display="none"}),!1}this.contentItems.forEach(function(G){var Q=G.index,ee=G.el;Q===N.currentIndex?N.setCurrentContentItemActions(ee):N.unsetCurrentContentItemActions(ee)})},K.prototype.hideAllContentItems=function(){this.contentItems.forEach(function(N){return N.el.style.display="none"})},K.prototype.setCurrentContentItemActions=function(N){N.style.display=""},K.prototype.unsetCurrentContentItemActions=function(N){N.style.display="none"},K.prototype.disableAll=function(){var N=this.getNavItem(this.currentIndex);N.hasError=!1,N.isCompleted=!1,N.isDisabled=!1,N.el.classList.remove("error","success"),this.disableButtons()},K.prototype.disableNavItemActions=function(N){N.isDisabled=!0,N.el.classList.add("disabled")},K.prototype.enableNavItemActions=function(N){N.isDisabled=!1,N.el.classList.remove("disabled")},K.prototype.buildButtons=function(){this.backBtn=this.el.querySelector("[data-hs-stepper-back-btn]"),this.nextBtn=this.el.querySelector("[data-hs-stepper-next-btn]"),this.skipBtn=this.el.querySelector("[data-hs-stepper-skip-btn]"),this.completeStepBtn=this.el.querySelector("[data-hs-stepper-complete-step-btn]"),this.finishBtn=this.el.querySelector("[data-hs-stepper-finish-btn]"),this.resetBtn=this.el.querySelector("[data-hs-stepper-reset-btn]"),this.buildBackButton(),this.buildNextButton(),this.buildSkipButton(),this.buildCompleteStepButton(),this.buildFinishButton(),this.buildResetButton()},K.prototype.buildBackButton=function(){var N=this;this.backBtn&&(this.checkForTheFirstStep(),this.backBtn.addEventListener("click",function(){if(N.handleBackButtonClick(),N.mode==="linear"){var z=N.navItems.find(function(G){return G.index===N.currentIndex}),q=N.contentItems.find(function(G){return G.index===N.currentIndex});if(!z||!q)return;z.isCompleted&&(z.isCompleted=!1,z.isSkip=!1,z.el.classList.remove("success","skipped")),q.isCompleted&&(q.isCompleted=!1,q.isSkip=!1,q.el.classList.remove("success","skipped")),N.mode==="linear"&&N.currentIndex!==N.totalSteps&&(N.nextBtn&&(N.nextBtn.style.display=""),N.completeStepBtn&&(N.completeStepBtn.style.display="")),N.showSkipButton(),N.showFinishButton(),N.showCompleteStepButton()}}))},K.prototype.handleBackButtonClick=function(){this.currentIndex!==1&&(this.mode==="linear"&&this.removeOptionalClasses(),this.currentIndex--,this.mode==="linear"&&this.removeOptionalClasses(),this.setCurrentNavItem(),this.setCurrentContentItem(),this.checkForTheFirstStep(),this.completeStepBtn&&this.changeTextAndDisableCompleteButtonIfStepCompleted(),this.fireEvent("back",this.currentIndex),(0,Ae.dispatch)("back.hs.stepper",this.el,this.currentIndex))},K.prototype.checkForTheFirstStep=function(){this.currentIndex===1?this.setToDisabled(this.backBtn):this.setToNonDisabled(this.backBtn)},K.prototype.setToDisabled=function(N){N.tagName!=="BUTTON"&&N.tagName!=="INPUT"||N.setAttribute("disabled","disabled"),N.classList.add("disabled")},K.prototype.setToNonDisabled=function(N){N.tagName!=="BUTTON"&&N.tagName!=="INPUT"||N.removeAttribute("disabled"),N.classList.remove("disabled")},K.prototype.buildNextButton=function(){var N=this;this.nextBtn&&this.nextBtn.addEventListener("click",function(){var z;if(N.fireEvent("beforeNext",N.currentIndex),(0,Ae.dispatch)("beforeNext.hs.stepper",N.el,N.currentIndex),(z=N.getNavItem(N.currentIndex))===null||z===void 0?void 0:z.isProcessed)return N.disableAll(),!1;N.goToNext()})},K.prototype.unsetProcessedNavItemActions=function(N){N.isProcessed=!1,N.el.classList.remove("processed")},K.prototype.handleNextButtonClick=function(N){if(N===void 0&&(N=!0),N)this.currentIndex===this.totalSteps?this.currentIndex=1:this.currentIndex++;else{var z=this.getUncompletedSteps();if(z.length===1){var q=z[0].index;this.currentIndex=q}else{if(this.currentIndex===this.totalSteps)return;this.currentIndex++}}this.mode==="linear"&&this.removeOptionalClasses(),this.setCurrentNavItem(),this.setCurrentContentItem(),this.checkForTheFirstStep(),this.completeStepBtn&&this.changeTextAndDisableCompleteButtonIfStepCompleted(),this.showSkipButton(),this.showFinishButton(),this.showCompleteStepButton(),this.fireEvent("next",this.currentIndex),(0,Ae.dispatch)("next.hs.stepper",this.el,this.currentIndex)},K.prototype.removeOptionalClasses=function(){var N=this,z=this.navItems.find(function(G){return G.index===N.currentIndex}),q=this.contentItems.find(function(G){return G.index===N.currentIndex});z.isSkip=!1,z.hasError=!1,z.isDisabled=!1,q.isSkip=!1,z.el.classList.remove("skipped","success","error"),q.el.classList.remove("skipped","success","error")},K.prototype.buildSkipButton=function(){var N=this;this.skipBtn&&(this.showSkipButton(),this.skipBtn.addEventListener("click",function(){N.handleSkipButtonClick(),N.mode==="linear"&&N.currentIndex===N.totalSteps&&(N.nextBtn&&(N.nextBtn.style.display="none"),N.completeStepBtn&&(N.completeStepBtn.style.display="none"),N.finishBtn&&(N.finishBtn.style.display=""))}))},K.prototype.setSkipItem=function(N){var z=this,q=this.navItems.find(function(Q){return Q.index===(N||z.currentIndex)}),G=this.contentItems.find(function(Q){return Q.index===(N||z.currentIndex)});q&&G&&(this.setSkipItemActions(q),this.setSkipItemActions(G))},K.prototype.setSkipItemActions=function(N){N.isSkip=!0,N.el.classList.add("skipped")},K.prototype.showSkipButton=function(){var N=this;if(this.skipBtn){var z=this.navItems.find(function(q){return q.index===N.currentIndex}).isOptional;this.skipBtn.style.display=z?"":"none"}},K.prototype.handleSkipButtonClick=function(){this.setSkipItem(),this.handleNextButtonClick(),this.fireEvent("skip",this.currentIndex),(0,Ae.dispatch)("skip.hs.stepper",this.el,this.currentIndex)},K.prototype.buildCompleteStepButton=function(){var N=this;this.completeStepBtn&&(this.completeStepBtnDefaultText=this.completeStepBtn.innerText,this.completeStepBtn.addEventListener("click",function(){return N.handleCompleteStepButtonClick()}))},K.prototype.changeTextAndDisableCompleteButtonIfStepCompleted=function(){var N=this,z=this.navItems.find(function(G){return G.index===N.currentIndex}),q=JSON.parse(this.completeStepBtn.getAttribute("data-hs-stepper-complete-step-btn")).completedText;z&&(z.isCompleted?(this.completeStepBtn.innerText=q||this.completeStepBtnDefaultText,this.completeStepBtn.setAttribute("disabled","disabled"),this.completeStepBtn.classList.add("disabled")):(this.completeStepBtn.innerText=this.completeStepBtnDefaultText,this.completeStepBtn.removeAttribute("disabled"),this.completeStepBtn.classList.remove("disabled")))},K.prototype.setCompleteItem=function(N){var z=this,q=this.navItems.find(function(Q){return Q.index===(N||z.currentIndex)}),G=this.contentItems.find(function(Q){return Q.index===(N||z.currentIndex)});q&&G&&(this.setCompleteItemActions(q),this.setCompleteItemActions(G))},K.prototype.setCompleteItemActions=function(N){N.isCompleted=!0,N.el.classList.add("success")},K.prototype.showCompleteStepButton=function(){this.completeStepBtn&&(this.getUncompletedSteps().length===1?this.completeStepBtn.style.display="none":this.completeStepBtn.style.display="")},K.prototype.handleCompleteStepButtonClick=function(){this.setCompleteItem(),this.fireEvent("complete",this.currentIndex),(0,Ae.dispatch)("complete.hs.stepper",this.el,this.currentIndex),this.handleNextButtonClick(!1),this.showFinishButton(),this.showCompleteStepButton(),this.checkForTheFirstStep(),this.completeStepBtn&&this.changeTextAndDisableCompleteButtonIfStepCompleted(),this.showSkipButton()},K.prototype.buildFinishButton=function(){var N=this;this.finishBtn&&(this.isCompleted&&this.setCompleted(),this.finishBtn.addEventListener("click",function(){return N.handleFinishButtonClick()}))},K.prototype.setCompleted=function(){this.el.classList.add("completed")},K.prototype.unsetCompleted=function(){this.el.classList.remove("completed")},K.prototype.showFinishButton=function(){this.finishBtn&&(this.getUncompletedSteps().length===1?this.finishBtn.style.display="":this.finishBtn.style.display="none")},K.prototype.handleFinishButtonClick=function(){var N=this,z=this.getUncompletedSteps(),q=this.getUncompletedSteps(!0),G=this.contentItems.find(function(ee){return ee.isFinal}).el;z.length&&z.forEach(function(ee){var fe=ee.index;return N.setCompleteItem(fe)}),this.currentIndex=this.totalSteps,this.setCurrentNavItem(),this.hideAllContentItems();var Q=this.navItems.find(function(ee){return ee.index===N.currentIndex});(Q?Q.el:null).classList.remove("active"),G.style.display="block",this.backBtn&&(this.backBtn.style.display="none"),this.nextBtn&&(this.nextBtn.style.display="none"),this.skipBtn&&(this.skipBtn.style.display="none"),this.completeStepBtn&&(this.completeStepBtn.style.display="none"),this.finishBtn&&(this.finishBtn.style.display="none"),this.resetBtn&&(this.resetBtn.style.display=""),q.length<=1&&(this.isCompleted=!0,this.setCompleted()),this.fireEvent("finish",this.currentIndex),(0,Ae.dispatch)("finish.hs.stepper",this.el,this.currentIndex)},K.prototype.buildResetButton=function(){var N=this;this.resetBtn&&this.resetBtn.addEventListener("click",function(){return N.handleResetButtonClick()})},K.prototype.handleResetButtonClick=function(){var N=this;this.backBtn&&(this.backBtn.style.display=""),this.nextBtn&&(this.nextBtn.style.display=""),this.completeStepBtn&&(this.completeStepBtn.style.display="",this.completeStepBtn.innerText=this.completeStepBtnDefaultText,this.completeStepBtn.removeAttribute("disabled"),this.completeStepBtn.classList.remove("disabled")),this.resetBtn&&(this.resetBtn.style.display="none"),this.navItems.forEach(function(z){var q=z.el;z.isSkip=!1,z.isCompleted=!1,N.unsetCurrentNavItemActions(q),q.classList.remove("success","skipped")}),this.contentItems.forEach(function(z){var q=z.el;z.isSkip=!1,z.isCompleted=!1,N.unsetCurrentContentItemActions(q),q.classList.remove("success","skipped")}),this.currentIndex=1,this.setCurrentNavItem(),this.setCurrentContentItem(),this.showFinishButton(),this.showCompleteStepButton(),this.checkForTheFirstStep(),this.unsetCompleted(),this.isCompleted=!1,this.fireEvent("reset",this.currentIndex),(0,Ae.dispatch)("reset.hs.stepper",this.el,this.currentIndex)},K.prototype.setProcessedNavItem=function(N){var z=this.getNavItem(N);z&&this.setProcessedNavItemActions(z)},K.prototype.unsetProcessedNavItem=function(N){var z=this.getNavItem(N);z&&this.unsetProcessedNavItemActions(z)},K.prototype.goToNext=function(){this.mode==="linear"&&this.setCompleteItem(),this.handleNextButtonClick(this.mode!=="linear"),this.mode==="linear"&&this.currentIndex===this.totalSteps&&(this.nextBtn&&(this.nextBtn.style.display="none"),this.completeStepBtn&&(this.completeStepBtn.style.display="none"))},K.prototype.disableButtons=function(){this.backBtn&&this.setToDisabled(this.backBtn),this.nextBtn&&this.setToDisabled(this.nextBtn)},K.prototype.enableButtons=function(){this.backBtn&&this.setToNonDisabled(this.backBtn),this.nextBtn&&this.setToNonDisabled(this.nextBtn)},K.prototype.setErrorNavItem=function(N){var z=this.getNavItem(N);z&&this.setErrorNavItemActions(z)},K.getInstance=function(N,z){var q=window.$hsStepperCollection.find(function(G){return G.element.el===(typeof N=="string"?document.querySelector(N):N)});return q?z?q:q.element:null},K.autoInit=function(){window.$hsStepperCollection||(window.$hsStepperCollection=[]),document.querySelectorAll("[data-hs-stepper]:not(.--prevent-on-load-init)").forEach(function(N){window.$hsStepperCollection.find(function(z){var q;return((q=z==null?void 0:z.element)===null||q===void 0?void 0:q.el)===N})||new K(N)})},K}(se(r(961)).default);window.addEventListener("load",function(){Ce.autoInit()}),typeof window<"u"&&(window.HSStepper=Ce),O.default=Ce},97:function(E,O,r){/*
 * HSStrongPassword
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */var U,W=this&&this.__extends||(U=function(he,K){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,z){N.__proto__=z}||function(N,z){for(var q in z)Object.prototype.hasOwnProperty.call(z,q)&&(N[q]=z[q])},U(he,K)},function(he,K){if(typeof K!="function"&&K!==null)throw new TypeError("Class extends value "+String(K)+" is not a constructor or null");function N(){this.constructor=he}U(he,K),he.prototype=K===null?Object.create(K):(N.prototype=K.prototype,new N)}),Y=this&&this.__assign||function(){return Y=Object.assign||function(he){for(var K,N=1,z=arguments.length;N<z;N++)for(var q in K=arguments[N])Object.prototype.hasOwnProperty.call(K,q)&&(he[q]=K[q]);return he},Y.apply(this,arguments)},se=this&&this.__importDefault||function(he){return he&&he.__esModule?he:{default:he}};Object.defineProperty(O,"__esModule",{value:!0});var Ae=r(292),Ce=function(he){function K(N,z){var q=he.call(this,N,z)||this;q.isOpened=!1,q.strength=0,q.passedRules=new Set;var G=N.getAttribute("data-hs-strong-password"),Q=G?JSON.parse(G):{},ee=Y(Y({},Q),z);return q.target=ee!=null&&ee.target?typeof(ee==null?void 0:ee.target)=="string"?document.querySelector(ee.target):ee.target:null,q.hints=ee!=null&&ee.hints?typeof(ee==null?void 0:ee.hints)=="string"?document.querySelector(ee.hints):ee.hints:null,q.stripClasses=(ee==null?void 0:ee.stripClasses)||null,q.minLength=(ee==null?void 0:ee.minLength)||6,q.mode=(ee==null?void 0:ee.mode)||"default",q.popoverSpace=(ee==null?void 0:ee.popoverSpace)||10,q.checksExclude=(ee==null?void 0:ee.checksExclude)||[],q.availableChecks=["lowercase","uppercase","numbers","special-characters","min-length"].filter(function(fe){return!q.checksExclude.includes(fe)}),q.specialCharactersSet=(ee==null?void 0:ee.specialCharactersSet)||"!\"#$%&'()*+,-./:;<=>?@[\\\\\\]^_`{|}~",q.target&&q.init(),q}return W(K,he),K.prototype.init=function(){this.createCollection(window.$hsStrongPasswordCollection,this),this.availableChecks.length&&this.build()},K.prototype.build=function(){var N=this;this.buildStrips(),this.hints&&this.buildHints(),this.setStrength(this.target.value),this.target.addEventListener("input",function(z){N.setStrength(z.target.value)})},K.prototype.buildStrips=function(){if(this.el.innerHTML="",this.stripClasses)for(var N=0;N<this.availableChecks.length;N++){var z=(0,Ae.htmlToElement)("<div></div>");(0,Ae.classToClassList)(this.stripClasses,z),this.el.append(z)}},K.prototype.buildHints=function(){var N=this;this.weakness=this.hints.querySelector("[data-hs-strong-password-hints-weakness-text]")||null,this.rules=Array.from(this.hints.querySelectorAll("[data-hs-strong-password-hints-rule-text]"))||null,this.rules.forEach(function(z){var q,G=z.getAttribute("data-hs-strong-password-hints-rule-text");!((q=N.checksExclude)===null||q===void 0)&&q.includes(G)&&z.remove()}),this.weakness&&this.buildWeakness(),this.rules&&this.buildRules(),this.mode==="popover"&&(this.target.addEventListener("focus",function(){N.isOpened=!0,N.hints.classList.remove("hidden"),N.hints.classList.add("block"),N.recalculateDirection()}),this.target.addEventListener("blur",function(){N.isOpened=!1,N.hints.classList.remove("block","bottom-full","top-full"),N.hints.classList.add("hidden"),N.hints.style.marginTop="",N.hints.style.marginBottom=""}))},K.prototype.buildWeakness=function(){var N=this;this.checkStrength(this.target.value),this.setWeaknessText(),this.target.addEventListener("input",function(){return setTimeout(function(){return N.setWeaknessText()})})},K.prototype.buildRules=function(){var N=this;this.setRulesText(),this.target.addEventListener("input",function(){return setTimeout(function(){return N.setRulesText()})})},K.prototype.setWeaknessText=function(){var N=this.weakness.getAttribute("data-hs-strong-password-hints-weakness-text"),z=JSON.parse(N);this.weakness.textContent=z[this.strength]},K.prototype.setRulesText=function(){var N=this;this.rules.forEach(function(z){var q=z.getAttribute("data-hs-strong-password-hints-rule-text");N.checkIfPassed(z,N.passedRules.has(q))})},K.prototype.togglePopover=function(){var N=this.el.querySelector(".popover");N&&N.classList.toggle("show")},K.prototype.checkStrength=function(N){var z=new Set,q={lowercase:/[a-z]+/,uppercase:/[A-Z]+/,numbers:/[0-9]+/,"special-characters":new RegExp("[".concat(this.specialCharactersSet,"]"))},G=0;return this.availableChecks.includes("lowercase")&&N.match(q.lowercase)&&(G+=1,z.add("lowercase")),this.availableChecks.includes("uppercase")&&N.match(q.uppercase)&&(G+=1,z.add("uppercase")),this.availableChecks.includes("numbers")&&N.match(q.numbers)&&(G+=1,z.add("numbers")),this.availableChecks.includes("special-characters")&&N.match(q["special-characters"])&&(G+=1,z.add("special-characters")),this.availableChecks.includes("min-length")&&N.length>=this.minLength&&(G+=1,z.add("min-length")),N.length||(G=0),G===this.availableChecks.length?this.el.classList.add("accepted"):this.el.classList.remove("accepted"),this.strength=G,this.passedRules=z,{strength:this.strength,rules:this.passedRules}},K.prototype.checkIfPassed=function(N,z){z===void 0&&(z=!1);var q=N.querySelector("[data-check]"),G=N.querySelector("[data-uncheck]");z?(N.classList.add("active"),q.classList.remove("hidden"),G.classList.add("hidden")):(N.classList.remove("active"),q.classList.add("hidden"),G.classList.remove("hidden"))},K.prototype.setStrength=function(N){var z=this.checkStrength(N),q=z.strength,G={strength:q,rules:z.rules};this.hideStrips(q),this.fireEvent("change",G),(0,Ae.dispatch)("change.hs.strongPassword",this.el,G)},K.prototype.hideStrips=function(N){Array.from(this.el.children).forEach(function(z,q){q<N?z.classList.add("passed"):z.classList.remove("passed")})},K.prototype.recalculateDirection=function(){(0,Ae.isEnoughSpace)(this.hints,this.target,"bottom",this.popoverSpace)?(this.hints.classList.remove("bottom-full"),this.hints.classList.add("top-full"),this.hints.style.marginBottom="",this.hints.style.marginTop="".concat(this.popoverSpace,"px")):(this.hints.classList.remove("top-full"),this.hints.classList.add("bottom-full"),this.hints.style.marginTop="",this.hints.style.marginBottom="".concat(this.popoverSpace,"px"))},K.getInstance=function(N){var z=window.$hsStrongPasswordCollection.find(function(q){return q.element.el===(typeof N=="string"?document.querySelector(N):N)});return z?z.element:null},K.autoInit=function(){window.$hsStrongPasswordCollection||(window.$hsStrongPasswordCollection=[]),document.querySelectorAll("[data-hs-strong-password]:not(.--prevent-on-load-init)").forEach(function(N){if(!window.$hsStrongPasswordCollection.find(function(G){var Q;return((Q=G==null?void 0:G.element)===null||Q===void 0?void 0:Q.el)===N})){var z=N.getAttribute("data-hs-strong-password"),q=z?JSON.parse(z):{};new K(N,q)}})},K}(se(r(961)).default);window.addEventListener("load",function(){Ce.autoInit()}),document.addEventListener("scroll",function(){if(!window.$hsStrongPasswordCollection)return!1;var he=window.$hsStrongPasswordCollection.find(function(K){return K.element.isOpened});he&&he.element.recalculateDirection()}),typeof window<"u"&&(window.HSStrongPassword=Ce),O.default=Ce},166:function(E,O,r){/*
 * HSTabs
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */var U,W=this&&this.__extends||(U=function(K,N){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(z,q){z.__proto__=q}||function(z,q){for(var G in q)Object.prototype.hasOwnProperty.call(q,G)&&(z[G]=q[G])},U(K,N)},function(K,N){if(typeof N!="function"&&N!==null)throw new TypeError("Class extends value "+String(N)+" is not a constructor or null");function z(){this.constructor=K}U(K,N),K.prototype=N===null?Object.create(N):(z.prototype=N.prototype,new z)}),Y=this&&this.__importDefault||function(K){return K&&K.__esModule?K:{default:K}};Object.defineProperty(O,"__esModule",{value:!0});var se=r(292),Ae=Y(r(961)),Ce=r(223),he=function(K){function N(z,q,G){var Q=K.call(this,z,q,G)||this;return Q.toggles=Q.el.querySelectorAll("[data-hs-tab]"),Q.extraToggleId=Q.el.getAttribute("data-hs-tab-select"),Q.extraToggle=document.querySelector(Q.extraToggleId),Q.current=Array.from(Q.toggles).find(function(ee){return ee.classList.contains("active")}),Q.currentContentId=Q.current.getAttribute("data-hs-tab"),Q.currentContent=document.querySelector(Q.currentContentId),Q.prev=null,Q.prevContentId=null,Q.prevContent=null,Q.init(),Q}return W(N,K),N.prototype.init=function(){var z=this;this.createCollection(window.$hsTabsCollection,this),this.toggles.forEach(function(q){q.addEventListener("click",function(){return z.open(q)})}),this.extraToggle&&this.extraToggle.addEventListener("change",function(q){return z.change(q)})},N.prototype.open=function(z){var q,G;this.prev=this.current,this.prevContentId=this.currentContentId,this.prevContent=this.currentContent,this.current=z,this.currentContentId=this.current.getAttribute("data-hs-tab"),this.currentContent=document.querySelector(this.currentContentId),!((q=this==null?void 0:this.prev)===null||q===void 0)&&q.ariaSelected&&(this.prev.ariaSelected="false"),this.prev.classList.remove("active"),this.prevContent.classList.add("hidden"),!((G=this==null?void 0:this.current)===null||G===void 0)&&G.ariaSelected&&(this.current.ariaSelected="true"),this.current.classList.add("active"),this.currentContent.classList.remove("hidden"),this.fireEvent("change",{el:z,prev:this.prevContentId,current:this.currentContentId}),(0,se.dispatch)("change.hs.tab",z,{el:z,prev:this.prevContentId,current:this.currentContentId})},N.prototype.change=function(z){var q=document.querySelector('[data-hs-tab="'.concat(z.target.value,'"]'));q&&q.click()},N.getInstance=function(z,q){var G=window.$hsTabsCollection.find(function(Q){return Q.element.el===(typeof z=="string"?document.querySelector(z):z)});return G?q?G:G.element:null},N.autoInit=function(){window.$hsTabsCollection||(window.$hsTabsCollection=[]),document.querySelectorAll('[role="tablist"]:not(select):not(.--prevent-on-load-init)').forEach(function(z){window.$hsTabsCollection.find(function(q){var G;return((G=q==null?void 0:q.element)===null||G===void 0?void 0:G.el)===z})||new N(z)}),window.$hsTabsCollection&&document.addEventListener("keydown",function(z){return N.accessibility(z)})},N.open=function(z){var q=window.$hsTabsCollection.find(function(Q){return Array.from(Q.element.toggles).includes(typeof z=="string"?document.querySelector(z):z)}),G=Array.from(q.element.toggles).find(function(Q){return Q===(typeof z=="string"?document.querySelector(z):z)});G&&!G.classList.contains("active")&&q.element.open(G)},N.accessibility=function(z){var q=document.querySelector("[data-hs-tab]:focus");if(q&&Ce.TABS_ACCESSIBILITY_KEY_SET.includes(z.code)&&!z.metaKey){var G=q.closest('[role="tablist"]').getAttribute("data-hs-tabs-vertical");switch(z.preventDefault(),z.code){case(G==="true"?"ArrowUp":"ArrowLeft"):this.onArrow();break;case(G==="true"?"ArrowDown":"ArrowRight"):this.onArrow(!1);break;case"Home":this.onStartEnd();break;case"End":this.onStartEnd(!1)}}},N.onArrow=function(z){z===void 0&&(z=!0);var q=document.querySelector("[data-hs-tab]:focus").closest('[role="tablist"]'),G=window.$hsTabsCollection.find(function(ce){return ce.element.el===q});if(G){var Q=z?Array.from(G.element.toggles).reverse():Array.from(G.element.toggles),ee=Q.find(function(ce){return document.activeElement===ce}),fe=Q.findIndex(function(ce){return ce===ee});Q[fe=fe+1<Q.length?fe+1:0].focus(),Q[fe].click()}},N.onStartEnd=function(z){z===void 0&&(z=!0);var q=document.querySelector("[data-hs-tab]:focus").closest('[role="tablist"]'),G=window.$hsTabsCollection.find(function(ee){return ee.element.el===q});if(G){var Q=z?Array.from(G.element.toggles):Array.from(G.element.toggles).reverse();Q.length&&(Q[0].focus(),Q[0].click())}},N.on=function(z,q,G){var Q=window.$hsTabsCollection.find(function(ee){return Array.from(ee.element.toggles).includes(typeof q=="string"?document.querySelector(q):q)});Q&&(Q.element.events[z]=G)},N}(Ae.default);window.addEventListener("load",function(){he.autoInit()}),typeof window<"u"&&(window.HSTabs=he),O.default=he},502:function(E,O,r){var U,W=this&&this.__extends||(U=function(Ce,he){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(K,N){K.__proto__=N}||function(K,N){for(var z in N)Object.prototype.hasOwnProperty.call(N,z)&&(K[z]=N[z])},U(Ce,he)},function(Ce,he){if(typeof he!="function"&&he!==null)throw new TypeError("Class extends value "+String(he)+" is not a constructor or null");function K(){this.constructor=Ce}U(Ce,he),Ce.prototype=he===null?Object.create(he):(K.prototype=he.prototype,new K)}),Y=this&&this.__assign||function(){return Y=Object.assign||function(Ce){for(var he,K=1,N=arguments.length;K<N;K++)for(var z in he=arguments[K])Object.prototype.hasOwnProperty.call(he,z)&&(Ce[z]=he[z]);return Ce},Y.apply(this,arguments)},se=this&&this.__importDefault||function(Ce){return Ce&&Ce.__esModule?Ce:{default:Ce}};Object.defineProperty(O,"__esModule",{value:!0});var Ae=function(Ce){function he(K,N){var z=Ce.call(this,K,N)||this,q=K.getAttribute("data-hs-theme-switch"),G=q?JSON.parse(q):{},Q=Y(Y({},G),N);return z.theme=(Q==null?void 0:Q.theme)||localStorage.getItem("hs_theme")||"default",z.themeSet=["light","dark","default"],z.init(),z}return W(he,Ce),he.prototype.init=function(){this.createCollection(window.$hsThemeSwitchCollection,this),this.theme!=="default"&&this.setAppearance()},he.prototype.setResetStyles=function(){var K=document.createElement("style");return K.innerText="*{transition: unset !important;}",K.setAttribute("data-hs-appearance-onload-styles",""),document.head.appendChild(K),K},he.prototype.addSystemThemeObserver=function(){var K=this;window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",function(N){N.matches?K.setAppearance("dark",!1):K.setAppearance("default",!1)})},he.prototype.removeSystemThemeObserver=function(){window.matchMedia("(prefers-color-scheme: dark)").removeEventListener},he.prototype.setAppearance=function(K,N,z){K===void 0&&(K=this.theme),N===void 0&&(N=!0),z===void 0&&(z=!0);var q=document.querySelector("html"),G=this.setResetStyles();N&&localStorage.setItem("hs_theme",K),K==="auto"&&(K=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"default"),q.classList.remove("light","dark","default","auto"),q.classList.add(K),setTimeout(function(){return G.remove()}),z&&window.dispatchEvent(new CustomEvent("on-hs-appearance-change",{detail:K}))},he.getInstance=function(K){var N=window.$hsThemeSwitchCollection.find(function(z){return z.element.el===(typeof K=="string"?document.querySelector(K):K)});return N?N.element:null},he.autoInit=function(){window.$hsThemeSwitchCollection||(window.$hsThemeSwitchCollection=[]);var K=function(N){localStorage.getItem("hs_theme")==="auto"?N.addSystemThemeObserver():N.removeSystemThemeObserver()};document.querySelectorAll("[data-hs-theme-switch]:not(.--prevent-on-load-init)").forEach(function(N){if(!window.$hsThemeSwitchCollection.find(function(q){var G;return((G=q==null?void 0:q.element)===null||G===void 0?void 0:G.el)===N})){var z=new he(N);z.el.checked=z.theme==="dark",K(z),z.el.addEventListener("change",function(q){var G=q.target.checked?"dark":"default";z.setAppearance(G),K(z)})}}),document.querySelectorAll("[data-hs-theme-click-value]:not(.--prevent-on-load-init)").forEach(function(N){var z=N.getAttribute("data-hs-theme-click-value"),q=new he(N);K(q),q.el.addEventListener("click",function(){q.setAppearance(z),K(q)})})},he}(se(r(961)).default);window.addEventListener("load",function(){Ae.autoInit()}),window.$hsThemeSwitchCollection&&window.addEventListener("on-hs-appearance-change",function(Ce){window.$hsThemeSwitchCollection.forEach(function(he){he.element.el.checked=Ce.detail==="dark"})}),typeof window<"u"&&(window.HSThemeSwitch=Ae),O.default=Ae},684:function(E,O,r){/*
 * HSToggleCount
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */var U,W=this&&this.__extends||(U=function(Ce,he){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(K,N){K.__proto__=N}||function(K,N){for(var z in N)Object.prototype.hasOwnProperty.call(N,z)&&(K[z]=N[z])},U(Ce,he)},function(Ce,he){if(typeof he!="function"&&he!==null)throw new TypeError("Class extends value "+String(he)+" is not a constructor or null");function K(){this.constructor=Ce}U(Ce,he),Ce.prototype=he===null?Object.create(he):(K.prototype=he.prototype,new K)}),Y=this&&this.__assign||function(){return Y=Object.assign||function(Ce){for(var he,K=1,N=arguments.length;K<N;K++)for(var z in he=arguments[K])Object.prototype.hasOwnProperty.call(he,z)&&(Ce[z]=he[z]);return Ce},Y.apply(this,arguments)},se=this&&this.__importDefault||function(Ce){return Ce&&Ce.__esModule?Ce:{default:Ce}};Object.defineProperty(O,"__esModule",{value:!0});var Ae=function(Ce){function he(K,N){var z=Ce.call(this,K,N)||this,q=K.getAttribute("data-hs-toggle-count"),G=q?JSON.parse(q):{},Q=Y(Y({},G),N);return z.target=Q!=null&&Q.target?typeof(Q==null?void 0:Q.target)=="string"?document.querySelector(Q.target):Q.target:null,z.min=(Q==null?void 0:Q.min)||0,z.max=(Q==null?void 0:Q.max)||0,z.duration=(Q==null?void 0:Q.duration)||700,z.isChecked=z.target.checked||!1,z.target&&z.init(),z}return W(he,Ce),he.prototype.init=function(){var K=this;this.createCollection(window.$hsToggleCountCollection,this),this.isChecked&&(this.el.innerText=String(this.max)),this.target.addEventListener("change",function(){K.isChecked=!K.isChecked,K.toggle()})},he.prototype.toggle=function(){this.isChecked?this.countUp():this.countDown()},he.prototype.animate=function(K,N){var z=this,q=0,G=function(Q){q||(q=Q);var ee=Math.min((Q-q)/z.duration,1);z.el.innerText=String(Math.floor(ee*(N-K)+K)),ee<1&&window.requestAnimationFrame(G)};window.requestAnimationFrame(G)},he.prototype.countUp=function(){this.animate(this.min,this.max)},he.prototype.countDown=function(){this.animate(this.max,this.min)},he.getInstance=function(K,N){var z=window.$hsToggleCountCollection.find(function(q){return q.element.el===(typeof K=="string"?document.querySelector(K):K)});return z?N?z:z.element:null},he.autoInit=function(){window.$hsToggleCountCollection||(window.$hsToggleCountCollection=[]),document.querySelectorAll("[data-hs-toggle-count]:not(.--prevent-on-load-init)").forEach(function(K){window.$hsToggleCountCollection.find(function(N){var z;return((z=N==null?void 0:N.element)===null||z===void 0?void 0:z.el)===K})||new he(K)})},he}(se(r(961)).default);window.addEventListener("load",function(){Ae.autoInit()}),typeof window<"u"&&(window.HSToggleCount=Ae),O.default=Ae},100:function(E,O,r){/*
 * HSTogglePassword
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */var U,W=this&&this.__extends||(U=function(he,K){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,z){N.__proto__=z}||function(N,z){for(var q in z)Object.prototype.hasOwnProperty.call(z,q)&&(N[q]=z[q])},U(he,K)},function(he,K){if(typeof K!="function"&&K!==null)throw new TypeError("Class extends value "+String(K)+" is not a constructor or null");function N(){this.constructor=he}U(he,K),he.prototype=K===null?Object.create(K):(N.prototype=K.prototype,new N)}),Y=this&&this.__assign||function(){return Y=Object.assign||function(he){for(var K,N=1,z=arguments.length;N<z;N++)for(var q in K=arguments[N])Object.prototype.hasOwnProperty.call(K,q)&&(he[q]=K[q]);return he},Y.apply(this,arguments)},se=this&&this.__importDefault||function(he){return he&&he.__esModule?he:{default:he}};Object.defineProperty(O,"__esModule",{value:!0});var Ae=r(292),Ce=function(he){function K(N,z){var q=he.call(this,N,z)||this,G=N.getAttribute("data-hs-toggle-password"),Q=G?JSON.parse(G):{},ee=Y(Y({},Q),z),fe=[];return ee!=null&&ee.target&&typeof(ee==null?void 0:ee.target)=="string"?(ee==null?void 0:ee.target.split(",")).forEach(function(ce){fe.push(document.querySelector(ce))}):ee!=null&&ee.target&&typeof(ee==null?void 0:ee.target)=="object"?ee.target.forEach(function(ce){return fe.push(document.querySelector(ce))}):ee.target.forEach(function(ce){return fe.push(ce)}),q.target=fe,q.isShown=!!q.el.hasAttribute("type")&&q.el.checked,q.eventType=(0,Ae.isFormElement)(q.el)?"change":"click",q.isMultiple=q.target.length>1&&!!q.el.closest("[data-hs-toggle-password-group]"),q.target&&q.init(),q}return W(K,he),K.prototype.init=function(){var N=this;this.createCollection(window.$hsTogglePasswordCollection,this),this.isShown?this.show():this.hide(),this.el.addEventListener(this.eventType,function(){N.isShown?N.hide():N.show(),N.fireEvent("toggle",N.target),(0,Ae.dispatch)("toggle.hs.toggle-select",N.el,N.target)})},K.prototype.getMultipleToggles=function(){var N=this.el.closest("[data-hs-toggle-password-group]").querySelectorAll("[data-hs-toggle-password]"),z=[];return N.forEach(function(q){z.push(K.getInstance(q))}),z},K.prototype.show=function(){this.isMultiple?(this.getMultipleToggles().forEach(function(N){return!!N&&(N.isShown=!0)}),this.el.closest("[data-hs-toggle-password-group]").classList.add("active")):(this.isShown=!0,this.el.classList.add("active")),this.target.forEach(function(N){N.type="text"})},K.prototype.hide=function(){this.isMultiple?(this.getMultipleToggles().forEach(function(N){return!!N&&(N.isShown=!1)}),this.el.closest("[data-hs-toggle-password-group]").classList.remove("active")):(this.isShown=!1,this.el.classList.remove("active")),this.target.forEach(function(N){N.type="password"})},K.getInstance=function(N,z){var q=window.$hsTogglePasswordCollection.find(function(G){return G.element.el===(typeof N=="string"?document.querySelector(N):N)});return q?z?q:q.element:null},K.autoInit=function(){window.$hsTogglePasswordCollection||(window.$hsTogglePasswordCollection=[]),document.querySelectorAll("[data-hs-toggle-password]:not(.--prevent-on-load-init)").forEach(function(N){window.$hsTogglePasswordCollection.find(function(z){var q;return((q=z==null?void 0:z.element)===null||q===void 0?void 0:q.el)===N})||new K(N)})},K}(se(r(961)).default);window.addEventListener("load",function(){Ce.autoInit()}),typeof window<"u"&&(window.HSTogglePassword=Ce),O.default=Ce},969:function(E,O,r){/*
 * HSTooltip
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */var U,W=this&&this.__extends||(U=function(q,G){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Q,ee){Q.__proto__=ee}||function(Q,ee){for(var fe in ee)Object.prototype.hasOwnProperty.call(ee,fe)&&(Q[fe]=ee[fe])},U(q,G)},function(q,G){if(typeof G!="function"&&G!==null)throw new TypeError("Class extends value "+String(G)+" is not a constructor or null");function Q(){this.constructor=q}U(q,G),q.prototype=G===null?Object.create(G):(Q.prototype=G.prototype,new Q)}),Y=this&&this.__assign||function(){return Y=Object.assign||function(q){for(var G,Q=1,ee=arguments.length;Q<ee;Q++)for(var fe in G=arguments[Q])Object.prototype.hasOwnProperty.call(G,fe)&&(q[fe]=G[fe]);return q},Y.apply(this,arguments)},se=this&&this.__spreadArray||function(q,G,Q){if(Q||arguments.length===2)for(var ee,fe=0,ce=G.length;fe<ce;fe++)!ee&&fe in G||(ee||(ee=Array.prototype.slice.call(G,0,fe)),ee[fe]=G[fe]);return q.concat(ee||Array.prototype.slice.call(G))},Ae=this&&this.__importDefault||function(q){return q&&q.__esModule?q:{default:q}};Object.defineProperty(O,"__esModule",{value:!0});var Ce=r(170),he=r(292),K=Ae(r(961)),N=r(223),z=function(q){function G(Q,ee,fe){var ce=q.call(this,Q,ee,fe)||this;return ce.el&&(ce.toggle=ce.el.querySelector(".hs-tooltip-toggle")||ce.el,ce.content=ce.el.querySelector(".hs-tooltip-content"),ce.eventMode=(0,he.getClassProperty)(ce.el,"--trigger")||"hover",ce.preventPopper=(0,he.getClassProperty)(ce.el,"--prevent-popper","false"),ce.placement=(0,he.getClassProperty)(ce.el,"--placement"),ce.strategy=(0,he.getClassProperty)(ce.el,"--strategy")),ce.el&&ce.toggle&&ce.content&&ce.init(),ce}return W(G,q),G.prototype.init=function(){var Q=this;this.createCollection(window.$hsTooltipCollection,this),this.eventMode==="click"?this.toggle.addEventListener("click",function(){return Q.click()}):this.eventMode==="focus"?this.toggle.addEventListener("click",function(){return Q.focus()}):this.eventMode==="hover"&&(this.toggle.addEventListener("mouseenter",function(){return Q.enter()}),this.toggle.addEventListener("mouseleave",function(){return Q.leave()})),this.preventPopper==="false"&&this.buildPopper()},G.prototype.enter=function(){this.show()},G.prototype.leave=function(){this.hide()},G.prototype.click=function(){var Q=this;if(this.el.classList.contains("show"))return!1;this.show();var ee=function(){setTimeout(function(){Q.hide(),Q.toggle.removeEventListener("click",ee,!0),Q.toggle.removeEventListener("blur",ee,!0)})};this.toggle.addEventListener("click",ee,!0),this.toggle.addEventListener("blur",ee,!0)},G.prototype.focus=function(){var Q=this;this.show();var ee=function(){Q.hide(),Q.toggle.removeEventListener("blur",ee,!0)};this.toggle.addEventListener("blur",ee,!0)},G.prototype.buildPopper=function(){this.popperInstance=(0,Ce.createPopper)(this.toggle,this.content,{placement:N.POSITIONS[this.placement]||"top",strategy:this.strategy||"fixed",modifiers:[{name:"offset",options:{offset:[0,5]}}]})},G.prototype.show=function(){var Q=this;this.content.classList.remove("hidden"),this.preventPopper==="false"&&(this.popperInstance.setOptions(function(ee){return Y(Y({},ee),{modifiers:se(se([],ee.modifiers,!0),[{name:"eventListeners",enabled:!0}],!1)})}),this.popperInstance.update()),setTimeout(function(){Q.el.classList.add("show"),Q.fireEvent("show",Q.el),(0,he.dispatch)("show.hs.tooltip",Q.el,Q.el)})},G.prototype.hide=function(){var Q=this;this.el.classList.remove("show"),this.preventPopper==="false"&&this.popperInstance.setOptions(function(ee){return Y(Y({},ee),{modifiers:se(se([],ee.modifiers,!0),[{name:"eventListeners",enabled:!1}],!1)})}),this.fireEvent("hide",this.el),(0,he.dispatch)("hide.hs.tooltip",this.el,this.el),(0,he.afterTransition)(this.content,function(){if(Q.el.classList.contains("show"))return!1;Q.content.classList.add("hidden")})},G.getInstance=function(Q,ee){ee===void 0&&(ee=!1);var fe=window.$hsTooltipCollection.find(function(ce){return ce.element.el===(typeof Q=="string"?document.querySelector(Q):Q)});return fe?ee?fe:fe.element.el:null},G.autoInit=function(){window.$hsTooltipCollection||(window.$hsTooltipCollection=[]),document.querySelectorAll(".hs-tooltip").forEach(function(Q){window.$hsTooltipCollection.find(function(ee){var fe;return((fe=ee==null?void 0:ee.element)===null||fe===void 0?void 0:fe.el)===Q})||new G(Q)})},G.show=function(Q){var ee=window.$hsTooltipCollection.find(function(fe){return fe.element.el===(typeof Q=="string"?document.querySelector(Q):Q)});if(ee)switch(ee.element.eventMode){case"click":ee.element.click();break;case"focus":ee.element.focus();break;default:ee.element.enter()}},G.hide=function(Q){var ee=window.$hsTooltipCollection.find(function(fe){return fe.element.el===(typeof Q=="string"?document.querySelector(Q):Q)});ee&&ee.element.hide()},G.on=function(Q,ee,fe){var ce=window.$hsTooltipCollection.find(function(Ue){return Ue.element.el===(typeof ee=="string"?document.querySelector(ee):ee)});ce&&(ce.element.events[Q]=fe)},G}(K.default);window.addEventListener("load",function(){z.autoInit()}),typeof window<"u"&&(window.HSTooltip=z),O.default=z},255:function(E,O,r){var U=this&&this.__importDefault||function(Ui){return Ui&&Ui.__esModule?Ui:{default:Ui}};Object.defineProperty(O,"__esModule",{value:!0}),O.COLLECTIONS=void 0;var W=U(r(406)),Y=U(r(740)),se=U(r(268)),Ae=U(r(485)),Ce=U(r(809)),he=U(r(814)),K=U(r(891)),N=U(r(234)),z=U(r(332)),q=U(r(850)),G=U(r(60)),Q=U(r(911)),ee=U(r(751)),fe=U(r(442)),ce=U(r(887)),Ue=U(r(97)),He=U(r(166)),nt=U(r(502)),vt=U(r(684)),xt=U(r(100)),Ot=U(r(969));O.COLLECTIONS=[{key:"copy-markup",fn:W.default,collection:"$hsCopyMarkupCollection"},{key:"accordion",fn:Y.default,collection:"$hsAccordionCollection"},{key:"carousel",fn:se.default,collection:"$hsCarouselCollection"},{key:"collapse",fn:Ae.default,collection:"$hsCollapseCollection"},{key:"combobox",fn:Ce.default,collection:"$hsComboBoxCollection"},{key:"datatable",fn:he.default,collection:"$hsDataTableCollection"},{key:"dropdown",fn:K.default,collection:"$hsDropdownCollection"},{key:"file-upload",fn:N.default,collection:"$hsFileUploadCollection"},{key:"input-number",fn:z.default,collection:"$hsInputNumberCollection"},{key:"overlay",fn:q.default,collection:"$hsOverlayCollection"},{key:"pin-input",fn:G.default,collection:"$hsPinInputCollection"},{key:"remove-element",fn:Q.default,collection:"$hsRemoveElementCollection"},{key:"scrollspy",fn:ee.default,collection:"$hsScrollspyCollection"},{key:"select",fn:fe.default,collection:"$hsSelectCollection"},{key:"stepper",fn:ce.default,collection:"$hsStepperCollection"},{key:"strong-password",fn:Ue.default,collection:"$hsStrongPasswordCollection"},{key:"tabs",fn:He.default,collection:"$hsTabsCollection"},{key:"theme-switch",fn:nt.default,collection:"$hsThemeSwitchCollection"},{key:"toggle-count",fn:vt.default,collection:"$hsToggleCountCollection"},{key:"toggle-password",fn:xt.default,collection:"$hsTogglePasswordCollection"},{key:"tooltip",fn:Ot.default,collection:"$hsTooltipCollection"}]},957:(E,O,r)=>{/*
 * HSStaticMethods
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */Object.defineProperty(O,"__esModule",{value:!0});var U=r(292),W=r(255),Y={getClassProperty:U.getClassProperty,afterTransition:U.afterTransition,autoInit:function(se){se===void 0&&(se="all"),se==="all"?W.COLLECTIONS.forEach(function(Ae){var Ce=Ae.fn;Ce==null||Ce.autoInit()}):W.COLLECTIONS.forEach(function(Ae){var Ce=Ae.key,he=Ae.fn;se.includes(Ce)&&(he==null||he.autoInit())})},cleanCollection:function(se){se===void 0&&(se="all"),se==="all"?W.COLLECTIONS.forEach(function(Ae){var Ce=Ae.collection;window[Ce]instanceof Array&&(window[Ce]=[])}):W.COLLECTIONS.forEach(function(Ae){var Ce=Ae.key,he=Ae.collection;se.includes(Ce)&&window[he]instanceof Array&&(window[he]=[])})}};typeof window<"u"&&(window.HSStaticMethods=Y),O.default=Y},292:function(E,O){var r=this;Object.defineProperty(O,"__esModule",{value:!0}),O.menuSearchHistory=O.classToClassList=O.htmlToElement=O.afterTransition=O.dispatch=O.debounce=O.isFormElement=O.isParentOrElementHidden=O.isEnoughSpace=O.isIpadOS=O.isIOS=O.getZIndex=O.getClassPropertyAlt=O.getClassProperty=O.stringToBoolean=void 0,O.getHighestZIndex=function(Y){var se=Number.NEGATIVE_INFINITY;return Y.forEach(function(Ae){var Ce=U(Ae);Ce!=="auto"&&(Ce=parseInt(Ce,10))>se&&(se=Ce)}),se},O.stringToBoolean=function(Y){return Y==="true"},O.getClassProperty=function(Y,se,Ae){return Ae===void 0&&(Ae=""),(window.getComputedStyle(Y).getPropertyValue(se)||Ae).replace(" ","")},O.getClassPropertyAlt=function(Y,se,Ae){Ae===void 0&&(Ae="");var Ce="";return Y.classList.forEach(function(he){he.includes(se)&&(Ce=he)}),Ce.match(/:(.*)]/)?Ce.match(/:(.*)]/)[1]:Ae};var U=function(Y){return window.getComputedStyle(Y).getPropertyValue("z-index")};O.getZIndex=U,O.isIOS=function(){return!!/iPad|iPhone|iPod/.test(navigator.platform)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)},O.isIpadOS=function(){return navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)},O.isEnoughSpace=function(Y,se,Ae,Ce,he){Ae===void 0&&(Ae="auto"),Ce===void 0&&(Ce=10),he===void 0&&(he=null);var K=se.getBoundingClientRect(),N=he?he.getBoundingClientRect():null,z=window.innerHeight,q=N?K.top-N.top:K.top,G=(he?N.bottom:z)-K.bottom,Q=Y.clientHeight+Ce;return Ae==="bottom"?G>=Q:Ae==="top"?q>=Q:q>=Q||G>=Q},O.isFormElement=function(Y){return Y instanceof HTMLInputElement||Y instanceof HTMLTextAreaElement||Y instanceof HTMLSelectElement};var W=function(Y){return!!Y&&(window.getComputedStyle(Y).display==="none"||W(Y.parentElement))};O.isParentOrElementHidden=W,O.debounce=function(Y,se){var Ae;return se===void 0&&(se=200),function(){for(var Ce=[],he=0;he<arguments.length;he++)Ce[he]=arguments[he];clearTimeout(Ae),Ae=setTimeout(function(){Y.apply(r,Ce)},se)}},O.dispatch=function(Y,se,Ae){Ae===void 0&&(Ae=null);var Ce=new CustomEvent(Y,{detail:{payload:Ae},bubbles:!0,cancelable:!0,composed:!1});se.dispatchEvent(Ce)},O.afterTransition=function(Y,se){var Ae=function(){se(),Y.removeEventListener("transitionend",Ae,!0)},Ce=window.getComputedStyle(Y),he=Ce.getPropertyValue("transition-duration");Ce.getPropertyValue("transition-property")!=="none"&&parseFloat(he)>0?Y.addEventListener("transitionend",Ae,!0):se()},O.htmlToElement=function(Y){var se=document.createElement("template");return Y=Y.trim(),se.innerHTML=Y,se.content.firstChild},O.classToClassList=function(Y,se,Ae,Ce){Ae===void 0&&(Ae=" "),Ce===void 0&&(Ce="add"),Y.split(Ae).forEach(function(he){return Ce==="add"?se.classList.add(he):se.classList.remove(he)})},O.menuSearchHistory={historyIndex:-1,addHistory:function(Y){this.historyIndex=Y},existsInHistory:function(Y){return Y>this.historyIndex},clearHistory:function(){this.historyIndex=-1}}}},g={};function A(E){var O=g[E];if(O!==void 0)return O.exports;var r=g[E]={exports:{}};return u[E].call(r.exports,r,r.exports,A),r.exports}return A.d=(E,O)=>{for(var r in O)A.o(O,r)&&!A.o(E,r)&&Object.defineProperty(E,r,{enumerable:!0,get:O[r]})},A.o=(E,O)=>Object.prototype.hasOwnProperty.call(E,O),A.r=E=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(E,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(E,"__esModule",{value:!0})},A(158)})())})(B3);var z2={exports:{}};(function(d,s){(function(u,g){d.exports=g()})(Po,function(){var u,g,A;function E(r,U){if(!u)u=U;else if(!g)g=U;else{var W="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+u+")(sharedChunk); ("+g+")(sharedChunk); self.onerror = null;",Y={};u(Y),A=U(Y),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(A.workerUrl=window.URL.createObjectURL(new Blob([W],{type:"text/javascript"})))}}E(["exports"],function(r){var U="3.5.2";let W;const Y={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(W==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{W={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):t}catch{W=t}}return W},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Y.API_URL)return null;try{const t=new URL(Y.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function se(t){return Y.API_URL_REGEX.test(t)}function Ae(t){return t.indexOf("mapbox:")===0}function Ce(t){return Y.API_CDN_URL_REGEX.test(t)}function he(t){return Y.API_SPRITE_REGEX.test(t)}function K(t){return Y.API_STYLE_REGEX.test(t)&&!he(t)}const N={create:"create",load:"load",fullLoad:"fullLoad"},z={mark(t){performance.mark(t)},measure(t,e,i){performance.measure(t,e,i)}};function q(t){const e=t.name.split("?")[0];return Ce(e)&&e.includes("mapbox-gl.js")?"javascript":Ce(e)&&e.includes("mapbox-gl.css")?"css":function(i){return Y.API_FONTS_REGEX.test(i)}(e)?"fontRange":he(e)?"sprite":K(e)?"style":function(i){return Y.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}function G(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Q={},ee={};Object.defineProperty(ee,"__esModule",{value:!0}),ee.setMatrixArrayType=function(t){ee.ARRAY_TYPE=ce=t},ee.toRadian=function(t){return t*He},ee.equals=function(t,e){return Math.abs(t-e)<=fe*Math.max(1,Math.abs(t),Math.abs(e))},ee.RANDOM=ee.ARRAY_TYPE=ee.EPSILON=void 0;var fe=1e-6;ee.EPSILON=fe;var ce=typeof Float32Array<"u"?Float32Array:Array;ee.ARRAY_TYPE=ce;var Ue=Math.random;ee.RANDOM=Ue;var He=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var nt={};function vt(t){return vt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vt(t)}Object.defineProperty(nt,"__esModule",{value:!0}),nt.create=function(){var t=new xt.ARRAY_TYPE(4);return xt.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},nt.clone=function(t){var e=new xt.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},nt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},nt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},nt.fromValues=function(t,e,i,o){var a=new xt.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=i,a[3]=o,a},nt.set=function(t,e,i,o,a){return t[0]=e,t[1]=i,t[2]=o,t[3]=a,t},nt.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},nt.invert=function(t,e){var i=e[0],o=e[1],a=e[2],h=e[3],f=i*h-a*o;return f?(t[0]=h*(f=1/f),t[1]=-o*f,t[2]=-a*f,t[3]=i*f,t):null},nt.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},nt.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},nt.multiply=Ui,nt.rotate=function(t,e,i){var o=e[0],a=e[1],h=e[2],f=e[3],x=Math.sin(i),w=Math.cos(i);return t[0]=o*w+h*x,t[1]=a*w+f*x,t[2]=o*-x+h*w,t[3]=a*-x+f*w,t},nt.scale=function(t,e,i){var o=e[1],a=e[2],h=e[3],f=i[0],x=i[1];return t[0]=e[0]*f,t[1]=o*f,t[2]=a*x,t[3]=h*x,t},nt.fromRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=-i,t[3]=o,t},nt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},nt.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},nt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},nt.LDU=function(t,e,i,o){return t[2]=o[2]/o[0],i[0]=o[0],i[1]=o[1],i[3]=o[3]-t[2]*i[1],[t,e,i]},nt.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},nt.subtract=Mt,nt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},nt.equals=function(t,e){var i=t[0],o=t[1],a=t[2],h=t[3],f=e[0],x=e[1],w=e[2],S=e[3];return Math.abs(i-f)<=xt.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(o-x)<=xt.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-w)<=xt.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(h-S)<=xt.EPSILON*Math.max(1,Math.abs(h),Math.abs(S))},nt.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},nt.multiplyScalarAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t},nt.sub=nt.mul=void 0;var xt=function(t,e){if(t&&t.__esModule)return t;if(t===null||vt(t)!=="object"&&typeof t!="function")return{default:t};var i=Ot(void 0);if(i&&i.has(t))return i.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var f=a?Object.getOwnPropertyDescriptor(t,h):null;f&&(f.get||f.set)?Object.defineProperty(o,h,f):o[h]=t[h]}return o.default=t,i&&i.set(t,o),o}(ee);function Ot(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Ot=function(o){return o?i:e})(t)}function Ui(t,e,i){var o=e[0],a=e[1],h=e[2],f=e[3],x=i[0],w=i[1],S=i[2],P=i[3];return t[0]=o*x+h*w,t[1]=a*x+f*w,t[2]=o*S+h*P,t[3]=a*S+f*P,t}function Mt(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}nt.mul=Ui,nt.sub=Mt;var _i={};function di(t){return di=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},di(t)}Object.defineProperty(_i,"__esModule",{value:!0}),_i.create=function(){var t=new Un.ARRAY_TYPE(6);return Un.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},_i.clone=function(t){var e=new Un.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},_i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},_i.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},_i.fromValues=function(t,e,i,o,a,h){var f=new Un.ARRAY_TYPE(6);return f[0]=t,f[1]=e,f[2]=i,f[3]=o,f[4]=a,f[5]=h,f},_i.set=function(t,e,i,o,a,h,f){return t[0]=e,t[1]=i,t[2]=o,t[3]=a,t[4]=h,t[5]=f,t},_i.invert=function(t,e){var i=e[0],o=e[1],a=e[2],h=e[3],f=e[4],x=e[5],w=i*h-o*a;return w?(t[0]=h*(w=1/w),t[1]=-o*w,t[2]=-a*w,t[3]=i*w,t[4]=(a*x-h*f)*w,t[5]=(o*f-i*x)*w,t):null},_i.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},_i.multiply=Vi,_i.rotate=function(t,e,i){var o=e[0],a=e[1],h=e[2],f=e[3],x=e[4],w=e[5],S=Math.sin(i),P=Math.cos(i);return t[0]=o*P+h*S,t[1]=a*P+f*S,t[2]=o*-S+h*P,t[3]=a*-S+f*P,t[4]=x,t[5]=w,t},_i.scale=function(t,e,i){var o=e[1],a=e[2],h=e[3],f=e[4],x=e[5],w=i[0],S=i[1];return t[0]=e[0]*w,t[1]=o*w,t[2]=a*S,t[3]=h*S,t[4]=f,t[5]=x,t},_i.translate=function(t,e,i){var o=e[0],a=e[1],h=e[2],f=e[3],x=e[4],w=e[5],S=i[0],P=i[1];return t[0]=o,t[1]=a,t[2]=h,t[3]=f,t[4]=o*S+h*P+x,t[5]=a*S+f*P+w,t},_i.fromRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=-i,t[3]=o,t[4]=0,t[5]=0,t},_i.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},_i.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},_i.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},_i.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},_i.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},_i.subtract=Vr,_i.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},_i.multiplyScalarAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t[4]=e[4]+i[4]*o,t[5]=e[5]+i[5]*o,t},_i.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},_i.equals=function(t,e){var i=t[0],o=t[1],a=t[2],h=t[3],f=t[4],x=t[5],w=e[0],S=e[1],P=e[2],R=e[3],B=e[4],H=e[5];return Math.abs(i-w)<=Un.EPSILON*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(o-S)<=Un.EPSILON*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(a-P)<=Un.EPSILON*Math.max(1,Math.abs(a),Math.abs(P))&&Math.abs(h-R)<=Un.EPSILON*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(f-B)<=Un.EPSILON*Math.max(1,Math.abs(f),Math.abs(B))&&Math.abs(x-H)<=Un.EPSILON*Math.max(1,Math.abs(x),Math.abs(H))},_i.sub=_i.mul=void 0;var Un=function(t,e){if(t&&t.__esModule)return t;if(t===null||di(t)!=="object"&&typeof t!="function")return{default:t};var i=Nn(void 0);if(i&&i.has(t))return i.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var f=a?Object.getOwnPropertyDescriptor(t,h):null;f&&(f.get||f.set)?Object.defineProperty(o,h,f):o[h]=t[h]}return o.default=t,i&&i.set(t,o),o}(ee);function Nn(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Nn=function(o){return o?i:e})(t)}function Vi(t,e,i){var o=e[0],a=e[1],h=e[2],f=e[3],x=e[4],w=e[5],S=i[0],P=i[1],R=i[2],B=i[3],H=i[4],$=i[5];return t[0]=o*S+h*P,t[1]=a*S+f*P,t[2]=o*R+h*B,t[3]=a*R+f*B,t[4]=o*H+h*$+x,t[5]=a*H+f*$+w,t}function Vr(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}_i.mul=Vi,_i.sub=Vr;var Oi={};function ir(t){return ir=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ir(t)}Object.defineProperty(Oi,"__esModule",{value:!0}),Oi.create=function(){var t=new fn.ARRAY_TYPE(9);return fn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},Oi.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},Oi.clone=function(t){var e=new fn.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Oi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Oi.fromValues=function(t,e,i,o,a,h,f,x,w){var S=new fn.ARRAY_TYPE(9);return S[0]=t,S[1]=e,S[2]=i,S[3]=o,S[4]=a,S[5]=h,S[6]=f,S[7]=x,S[8]=w,S},Oi.set=function(t,e,i,o,a,h,f,x,w,S){return t[0]=e,t[1]=i,t[2]=o,t[3]=a,t[4]=h,t[5]=f,t[6]=x,t[7]=w,t[8]=S,t},Oi.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Oi.transpose=function(t,e){if(t===e){var i=e[1],o=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=o,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},Oi.invert=function(t,e){var i=e[0],o=e[1],a=e[2],h=e[3],f=e[4],x=e[5],w=e[6],S=e[7],P=e[8],R=P*f-x*S,B=-P*h+x*w,H=S*h-f*w,$=i*R+o*B+a*H;return $?(t[0]=R*($=1/$),t[1]=(-P*o+a*S)*$,t[2]=(x*o-a*f)*$,t[3]=B*$,t[4]=(P*i-a*w)*$,t[5]=(-x*i+a*h)*$,t[6]=H*$,t[7]=(-S*i+o*w)*$,t[8]=(f*i-o*h)*$,t):null},Oi.adjoint=function(t,e){var i=e[0],o=e[1],a=e[2],h=e[3],f=e[4],x=e[5],w=e[6],S=e[7],P=e[8];return t[0]=f*P-x*S,t[1]=a*S-o*P,t[2]=o*x-a*f,t[3]=x*w-h*P,t[4]=i*P-a*w,t[5]=a*h-i*x,t[6]=h*S-f*w,t[7]=o*w-i*S,t[8]=i*f-o*h,t},Oi.determinant=function(t){var e=t[3],i=t[4],o=t[5],a=t[6],h=t[7],f=t[8];return t[0]*(f*i-o*h)+t[1]*(-f*e+o*a)+t[2]*(h*e-i*a)},Oi.multiply=Ri,Oi.translate=function(t,e,i){var o=e[0],a=e[1],h=e[2],f=e[3],x=e[4],w=e[5],S=e[6],P=e[7],R=e[8],B=i[0],H=i[1];return t[0]=o,t[1]=a,t[2]=h,t[3]=f,t[4]=x,t[5]=w,t[6]=B*o+H*f+S,t[7]=B*a+H*x+P,t[8]=B*h+H*w+R,t},Oi.rotate=function(t,e,i){var o=e[0],a=e[1],h=e[2],f=e[3],x=e[4],w=e[5],S=e[6],P=e[7],R=e[8],B=Math.sin(i),H=Math.cos(i);return t[0]=H*o+B*f,t[1]=H*a+B*x,t[2]=H*h+B*w,t[3]=H*f-B*o,t[4]=H*x-B*a,t[5]=H*w-B*h,t[6]=S,t[7]=P,t[8]=R,t},Oi.scale=function(t,e,i){var o=i[0],a=i[1];return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Oi.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},Oi.fromRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=0,t[3]=-i,t[4]=o,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Oi.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Oi.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},Oi.fromQuat=function(t,e){var i=e[0],o=e[1],a=e[2],h=e[3],f=i+i,x=o+o,w=a+a,S=i*f,P=o*f,R=o*x,B=a*f,H=a*x,$=a*w,te=h*f,ne=h*x,de=h*w;return t[0]=1-R-$,t[3]=P-de,t[6]=B+ne,t[1]=P+de,t[4]=1-S-$,t[7]=H-te,t[2]=B-ne,t[5]=H+te,t[8]=1-S-R,t},Oi.normalFromMat4=function(t,e){var i=e[0],o=e[1],a=e[2],h=e[3],f=e[4],x=e[5],w=e[6],S=e[7],P=e[8],R=e[9],B=e[10],H=e[11],$=e[12],te=e[13],ne=e[14],de=e[15],Se=i*x-o*f,Me=i*w-a*f,Le=i*S-h*f,ze=o*w-a*x,Fe=o*S-h*x,Xe=a*S-h*w,et=P*te-R*$,st=P*ne-B*$,_t=P*de-H*$,dt=R*ne-B*te,St=R*de-H*te,Vt=B*de-H*ne,bt=Se*Vt-Me*St+Le*dt+ze*_t-Fe*st+Xe*et;return bt?(t[0]=(x*Vt-w*St+S*dt)*(bt=1/bt),t[1]=(w*_t-f*Vt-S*st)*bt,t[2]=(f*St-x*_t+S*et)*bt,t[3]=(a*St-o*Vt-h*dt)*bt,t[4]=(i*Vt-a*_t+h*st)*bt,t[5]=(o*_t-i*St-h*et)*bt,t[6]=(te*Xe-ne*Fe+de*ze)*bt,t[7]=(ne*Le-$*Xe-de*Me)*bt,t[8]=($*Fe-te*Le+de*Se)*bt,t):null},Oi.projection=function(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},Oi.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},Oi.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},Oi.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},Oi.subtract=Lr,Oi.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},Oi.multiplyScalarAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t[4]=e[4]+i[4]*o,t[5]=e[5]+i[5]*o,t[6]=e[6]+i[6]*o,t[7]=e[7]+i[7]*o,t[8]=e[8]+i[8]*o,t},Oi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},Oi.equals=function(t,e){var i=t[0],o=t[1],a=t[2],h=t[3],f=t[4],x=t[5],w=t[6],S=t[7],P=t[8],R=e[0],B=e[1],H=e[2],$=e[3],te=e[4],ne=e[5],de=e[6],Se=e[7],Me=e[8];return Math.abs(i-R)<=fn.EPSILON*Math.max(1,Math.abs(i),Math.abs(R))&&Math.abs(o-B)<=fn.EPSILON*Math.max(1,Math.abs(o),Math.abs(B))&&Math.abs(a-H)<=fn.EPSILON*Math.max(1,Math.abs(a),Math.abs(H))&&Math.abs(h-$)<=fn.EPSILON*Math.max(1,Math.abs(h),Math.abs($))&&Math.abs(f-te)<=fn.EPSILON*Math.max(1,Math.abs(f),Math.abs(te))&&Math.abs(x-ne)<=fn.EPSILON*Math.max(1,Math.abs(x),Math.abs(ne))&&Math.abs(w-de)<=fn.EPSILON*Math.max(1,Math.abs(w),Math.abs(de))&&Math.abs(S-Se)<=fn.EPSILON*Math.max(1,Math.abs(S),Math.abs(Se))&&Math.abs(P-Me)<=fn.EPSILON*Math.max(1,Math.abs(P),Math.abs(Me))},Oi.sub=Oi.mul=void 0;var fn=function(t,e){if(t&&t.__esModule)return t;if(t===null||ir(t)!=="object"&&typeof t!="function")return{default:t};var i=At(void 0);if(i&&i.has(t))return i.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var f=a?Object.getOwnPropertyDescriptor(t,h):null;f&&(f.get||f.set)?Object.defineProperty(o,h,f):o[h]=t[h]}return o.default=t,i&&i.set(t,o),o}(ee);function At(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(At=function(o){return o?i:e})(t)}function Ri(t,e,i){var o=e[0],a=e[1],h=e[2],f=e[3],x=e[4],w=e[5],S=e[6],P=e[7],R=e[8],B=i[0],H=i[1],$=i[2],te=i[3],ne=i[4],de=i[5],Se=i[6],Me=i[7],Le=i[8];return t[0]=B*o+H*f+$*S,t[1]=B*a+H*x+$*P,t[2]=B*h+H*w+$*R,t[3]=te*o+ne*f+de*S,t[4]=te*a+ne*x+de*P,t[5]=te*h+ne*w+de*R,t[6]=Se*o+Me*f+Le*S,t[7]=Se*a+Me*x+Le*P,t[8]=Se*h+Me*w+Le*R,t}function Lr(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}Oi.mul=Ri,Oi.sub=Lr;var si={};function zi(t){return zi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zi(t)}Object.defineProperty(si,"__esModule",{value:!0}),si.create=function(){var t=new Qi.ARRAY_TYPE(16);return Qi.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},si.clone=function(t){var e=new Qi.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},si.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},si.fromValues=function(t,e,i,o,a,h,f,x,w,S,P,R,B,H,$,te){var ne=new Qi.ARRAY_TYPE(16);return ne[0]=t,ne[1]=e,ne[2]=i,ne[3]=o,ne[4]=a,ne[5]=h,ne[6]=f,ne[7]=x,ne[8]=w,ne[9]=S,ne[10]=P,ne[11]=R,ne[12]=B,ne[13]=H,ne[14]=$,ne[15]=te,ne},si.set=function(t,e,i,o,a,h,f,x,w,S,P,R,B,H,$,te,ne){return t[0]=e,t[1]=i,t[2]=o,t[3]=a,t[4]=h,t[5]=f,t[6]=x,t[7]=w,t[8]=S,t[9]=P,t[10]=R,t[11]=B,t[12]=H,t[13]=$,t[14]=te,t[15]=ne,t},si.identity=Co,si.transpose=function(t,e){if(t===e){var i=e[1],o=e[2],a=e[3],h=e[6],f=e[7],x=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=o,t[9]=h,t[11]=e[14],t[12]=a,t[13]=f,t[14]=x}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},si.invert=function(t,e){var i=e[0],o=e[1],a=e[2],h=e[3],f=e[4],x=e[5],w=e[6],S=e[7],P=e[8],R=e[9],B=e[10],H=e[11],$=e[12],te=e[13],ne=e[14],de=e[15],Se=i*x-o*f,Me=i*w-a*f,Le=i*S-h*f,ze=o*w-a*x,Fe=o*S-h*x,Xe=a*S-h*w,et=P*te-R*$,st=P*ne-B*$,_t=P*de-H*$,dt=R*ne-B*te,St=R*de-H*te,Vt=B*de-H*ne,bt=Se*Vt-Me*St+Le*dt+ze*_t-Fe*st+Xe*et;return bt?(t[0]=(x*Vt-w*St+S*dt)*(bt=1/bt),t[1]=(a*St-o*Vt-h*dt)*bt,t[2]=(te*Xe-ne*Fe+de*ze)*bt,t[3]=(B*Fe-R*Xe-H*ze)*bt,t[4]=(w*_t-f*Vt-S*st)*bt,t[5]=(i*Vt-a*_t+h*st)*bt,t[6]=(ne*Le-$*Xe-de*Me)*bt,t[7]=(P*Xe-B*Le+H*Me)*bt,t[8]=(f*St-x*_t+S*et)*bt,t[9]=(o*_t-i*St-h*et)*bt,t[10]=($*Fe-te*Le+de*Se)*bt,t[11]=(R*Le-P*Fe-H*Se)*bt,t[12]=(x*st-f*dt-w*et)*bt,t[13]=(i*dt-o*st+a*et)*bt,t[14]=(te*Me-$*ze-ne*Se)*bt,t[15]=(P*ze-R*Me+B*Se)*bt,t):null},si.adjoint=function(t,e){var i=e[0],o=e[1],a=e[2],h=e[3],f=e[4],x=e[5],w=e[6],S=e[7],P=e[8],R=e[9],B=e[10],H=e[11],$=e[12],te=e[13],ne=e[14],de=e[15];return t[0]=x*(B*de-H*ne)-R*(w*de-S*ne)+te*(w*H-S*B),t[1]=-(o*(B*de-H*ne)-R*(a*de-h*ne)+te*(a*H-h*B)),t[2]=o*(w*de-S*ne)-x*(a*de-h*ne)+te*(a*S-h*w),t[3]=-(o*(w*H-S*B)-x*(a*H-h*B)+R*(a*S-h*w)),t[4]=-(f*(B*de-H*ne)-P*(w*de-S*ne)+$*(w*H-S*B)),t[5]=i*(B*de-H*ne)-P*(a*de-h*ne)+$*(a*H-h*B),t[6]=-(i*(w*de-S*ne)-f*(a*de-h*ne)+$*(a*S-h*w)),t[7]=i*(w*H-S*B)-f*(a*H-h*B)+P*(a*S-h*w),t[8]=f*(R*de-H*te)-P*(x*de-S*te)+$*(x*H-S*R),t[9]=-(i*(R*de-H*te)-P*(o*de-h*te)+$*(o*H-h*R)),t[10]=i*(x*de-S*te)-f*(o*de-h*te)+$*(o*S-h*x),t[11]=-(i*(x*H-S*R)-f*(o*H-h*R)+P*(o*S-h*x)),t[12]=-(f*(R*ne-B*te)-P*(x*ne-w*te)+$*(x*B-w*R)),t[13]=i*(R*ne-B*te)-P*(o*ne-a*te)+$*(o*B-a*R),t[14]=-(i*(x*ne-w*te)-f*(o*ne-a*te)+$*(o*w-a*x)),t[15]=i*(x*B-w*R)-f*(o*B-a*R)+P*(o*w-a*x),t},si.determinant=function(t){var e=t[0],i=t[1],o=t[2],a=t[3],h=t[4],f=t[5],x=t[6],w=t[7],S=t[8],P=t[9],R=t[10],B=t[11],H=t[12],$=t[13],te=t[14],ne=t[15];return(e*f-i*h)*(R*ne-B*te)-(e*x-o*h)*(P*ne-B*$)+(e*w-a*h)*(P*te-R*$)+(i*x-o*f)*(S*ne-B*H)-(i*w-a*f)*(S*te-R*H)+(o*w-a*x)*(S*$-P*H)},si.multiply=fi,si.translate=function(t,e,i){var o,a,h,f,x,w,S,P,R,B,H,$,te=i[0],ne=i[1],de=i[2];return e===t?(t[12]=e[0]*te+e[4]*ne+e[8]*de+e[12],t[13]=e[1]*te+e[5]*ne+e[9]*de+e[13],t[14]=e[2]*te+e[6]*ne+e[10]*de+e[14],t[15]=e[3]*te+e[7]*ne+e[11]*de+e[15]):(a=e[1],h=e[2],f=e[3],x=e[4],w=e[5],S=e[6],P=e[7],R=e[8],B=e[9],H=e[10],$=e[11],t[0]=o=e[0],t[1]=a,t[2]=h,t[3]=f,t[4]=x,t[5]=w,t[6]=S,t[7]=P,t[8]=R,t[9]=B,t[10]=H,t[11]=$,t[12]=o*te+x*ne+R*de+e[12],t[13]=a*te+w*ne+B*de+e[13],t[14]=h*te+S*ne+H*de+e[14],t[15]=f*te+P*ne+$*de+e[15]),t},si.scale=function(t,e,i){var o=i[0],a=i[1],h=i[2];return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*h,t[9]=e[9]*h,t[10]=e[10]*h,t[11]=e[11]*h,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},si.rotate=function(t,e,i,o){var a,h,f,x,w,S,P,R,B,H,$,te,ne,de,Se,Me,Le,ze,Fe,Xe,et,st,_t,dt,St=o[0],Vt=o[1],bt=o[2],kt=Math.hypot(St,Vt,bt);return kt<Qi.EPSILON?null:(St*=kt=1/kt,Vt*=kt,bt*=kt,a=Math.sin(i),h=Math.cos(i),w=e[1],S=e[2],P=e[3],B=e[5],H=e[6],$=e[7],ne=e[9],de=e[10],Se=e[11],Me=St*St*(f=1-h)+h,Fe=St*Vt*f-bt*a,Xe=Vt*Vt*f+h,et=bt*Vt*f+St*a,st=St*bt*f+Vt*a,_t=Vt*bt*f-St*a,dt=bt*bt*f+h,t[0]=(x=e[0])*Me+(R=e[4])*(Le=Vt*St*f+bt*a)+(te=e[8])*(ze=bt*St*f-Vt*a),t[1]=w*Me+B*Le+ne*ze,t[2]=S*Me+H*Le+de*ze,t[3]=P*Me+$*Le+Se*ze,t[4]=x*Fe+R*Xe+te*et,t[5]=w*Fe+B*Xe+ne*et,t[6]=S*Fe+H*Xe+de*et,t[7]=P*Fe+$*Xe+Se*et,t[8]=x*st+R*_t+te*dt,t[9]=w*st+B*_t+ne*dt,t[10]=S*st+H*_t+de*dt,t[11]=P*st+$*_t+Se*dt,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},si.rotateX=function(t,e,i){var o=Math.sin(i),a=Math.cos(i),h=e[4],f=e[5],x=e[6],w=e[7],S=e[8],P=e[9],R=e[10],B=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=h*a+S*o,t[5]=f*a+P*o,t[6]=x*a+R*o,t[7]=w*a+B*o,t[8]=S*a-h*o,t[9]=P*a-f*o,t[10]=R*a-x*o,t[11]=B*a-w*o,t},si.rotateY=function(t,e,i){var o=Math.sin(i),a=Math.cos(i),h=e[0],f=e[1],x=e[2],w=e[3],S=e[8],P=e[9],R=e[10],B=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=h*a-S*o,t[1]=f*a-P*o,t[2]=x*a-R*o,t[3]=w*a-B*o,t[8]=h*o+S*a,t[9]=f*o+P*a,t[10]=x*o+R*a,t[11]=w*o+B*a,t},si.rotateZ=function(t,e,i){var o=Math.sin(i),a=Math.cos(i),h=e[0],f=e[1],x=e[2],w=e[3],S=e[4],P=e[5],R=e[6],B=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=h*a+S*o,t[1]=f*a+P*o,t[2]=x*a+R*o,t[3]=w*a+B*o,t[4]=S*a-h*o,t[5]=P*a-f*o,t[6]=R*a-x*o,t[7]=B*a-w*o,t},si.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},si.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},si.fromRotation=function(t,e,i){var o,a,h,f=i[0],x=i[1],w=i[2],S=Math.hypot(f,x,w);return S<Qi.EPSILON?null:(f*=S=1/S,x*=S,w*=S,o=Math.sin(e),a=Math.cos(e),t[0]=f*f*(h=1-a)+a,t[1]=x*f*h+w*o,t[2]=w*f*h-x*o,t[3]=0,t[4]=f*x*h-w*o,t[5]=x*x*h+a,t[6]=w*x*h+f*o,t[7]=0,t[8]=f*w*h+x*o,t[9]=x*w*h-f*o,t[10]=w*w*h+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},si.fromXRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},si.fromYRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},si.fromZRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},si.fromRotationTranslation=$r,si.fromQuat2=function(t,e){var i=new Qi.ARRAY_TYPE(3),o=-e[0],a=-e[1],h=-e[2],f=e[3],x=e[4],w=e[5],S=e[6],P=e[7],R=o*o+a*a+h*h+f*f;return R>0?(i[0]=2*(x*f+P*o+w*h-S*a)/R,i[1]=2*(w*f+P*a+S*o-x*h)/R,i[2]=2*(S*f+P*h+x*a-w*o)/R):(i[0]=2*(x*f+P*o+w*h-S*a),i[1]=2*(w*f+P*a+S*o-x*h),i[2]=2*(S*f+P*h+x*a-w*o)),$r(t,e,i),t},si.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},si.getScaling=Or,si.getRotation=function(t,e){var i=new Qi.ARRAY_TYPE(3);Or(i,e);var o=1/i[0],a=1/i[1],h=1/i[2],f=e[0]*o,x=e[1]*a,w=e[2]*h,S=e[4]*o,P=e[5]*a,R=e[6]*h,B=e[8]*o,H=e[9]*a,$=e[10]*h,te=f+P+$,ne=0;return te>0?(ne=2*Math.sqrt(te+1),t[3]=.25*ne,t[0]=(R-H)/ne,t[1]=(B-w)/ne,t[2]=(x-S)/ne):f>P&&f>$?(ne=2*Math.sqrt(1+f-P-$),t[3]=(R-H)/ne,t[0]=.25*ne,t[1]=(x+S)/ne,t[2]=(B+w)/ne):P>$?(ne=2*Math.sqrt(1+P-f-$),t[3]=(B-w)/ne,t[0]=(x+S)/ne,t[1]=.25*ne,t[2]=(R+H)/ne):(ne=2*Math.sqrt(1+$-f-P),t[3]=(x-S)/ne,t[0]=(B+w)/ne,t[1]=(R+H)/ne,t[2]=.25*ne),t},si.fromRotationTranslationScale=function(t,e,i,o){var a=e[0],h=e[1],f=e[2],x=e[3],w=a+a,S=h+h,P=f+f,R=a*w,B=a*S,H=a*P,$=h*S,te=h*P,ne=f*P,de=x*w,Se=x*S,Me=x*P,Le=o[0],ze=o[1],Fe=o[2];return t[0]=(1-($+ne))*Le,t[1]=(B+Me)*Le,t[2]=(H-Se)*Le,t[3]=0,t[4]=(B-Me)*ze,t[5]=(1-(R+ne))*ze,t[6]=(te+de)*ze,t[7]=0,t[8]=(H+Se)*Fe,t[9]=(te-de)*Fe,t[10]=(1-(R+$))*Fe,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},si.fromRotationTranslationScaleOrigin=function(t,e,i,o,a){var h=e[0],f=e[1],x=e[2],w=e[3],S=h+h,P=f+f,R=x+x,B=h*S,H=h*P,$=h*R,te=f*P,ne=f*R,de=x*R,Se=w*S,Me=w*P,Le=w*R,ze=o[0],Fe=o[1],Xe=o[2],et=a[0],st=a[1],_t=a[2],dt=(1-(te+de))*ze,St=(H+Le)*ze,Vt=($-Me)*ze,bt=(H-Le)*Fe,kt=(1-(B+de))*Fe,yt=(ne+Se)*Fe,Bt=($+Me)*Xe,jt=(ne-Se)*Xe,zt=(1-(B+te))*Xe;return t[0]=dt,t[1]=St,t[2]=Vt,t[3]=0,t[4]=bt,t[5]=kt,t[6]=yt,t[7]=0,t[8]=Bt,t[9]=jt,t[10]=zt,t[11]=0,t[12]=i[0]+et-(dt*et+bt*st+Bt*_t),t[13]=i[1]+st-(St*et+kt*st+jt*_t),t[14]=i[2]+_t-(Vt*et+yt*st+zt*_t),t[15]=1,t},si.fromQuat=function(t,e){var i=e[0],o=e[1],a=e[2],h=e[3],f=i+i,x=o+o,w=a+a,S=i*f,P=o*f,R=o*x,B=a*f,H=a*x,$=a*w,te=h*f,ne=h*x,de=h*w;return t[0]=1-R-$,t[1]=P+de,t[2]=B-ne,t[3]=0,t[4]=P-de,t[5]=1-S-$,t[6]=H+te,t[7]=0,t[8]=B+ne,t[9]=H-te,t[10]=1-S-R,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},si.frustum=function(t,e,i,o,a,h,f){var x=1/(i-e),w=1/(a-o),S=1/(h-f);return t[0]=2*h*x,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*h*w,t[6]=0,t[7]=0,t[8]=(i+e)*x,t[9]=(a+o)*w,t[10]=(f+h)*S,t[11]=-1,t[12]=0,t[13]=0,t[14]=f*h*2*S,t[15]=0,t},si.perspectiveNO=Hi,si.perspectiveZO=function(t,e,i,o,a){var h,f=1/Math.tan(e/2);return t[0]=f/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(t[10]=a*(h=1/(o-a)),t[14]=a*o*h):(t[10]=-1,t[14]=-o),t},si.perspectiveFromFieldOfView=function(t,e,i,o){var a=Math.tan(e.upDegrees*Math.PI/180),h=Math.tan(e.downDegrees*Math.PI/180),f=Math.tan(e.leftDegrees*Math.PI/180),x=Math.tan(e.rightDegrees*Math.PI/180),w=2/(f+x),S=2/(a+h);return t[0]=w,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=-(f-x)*w*.5,t[9]=(a-h)*S*.5,t[10]=o/(i-o),t[11]=-1,t[12]=0,t[13]=0,t[14]=o*i/(i-o),t[15]=0,t},si.orthoNO=Hn,si.orthoZO=function(t,e,i,o,a,h,f){var x=1/(e-i),w=1/(o-a),S=1/(h-f);return t[0]=-2*x,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*w,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=S,t[11]=0,t[12]=(e+i)*x,t[13]=(a+o)*w,t[14]=h*S,t[15]=1,t},si.lookAt=function(t,e,i,o){var a,h,f,x,w,S,P,R,B,H,$=e[0],te=e[1],ne=e[2],de=o[0],Se=o[1],Me=o[2],Le=i[0],ze=i[1],Fe=i[2];return Math.abs($-Le)<Qi.EPSILON&&Math.abs(te-ze)<Qi.EPSILON&&Math.abs(ne-Fe)<Qi.EPSILON?Co(t):(P=$-Le,R=te-ze,B=ne-Fe,a=Se*(B*=H=1/Math.hypot(P,R,B))-Me*(R*=H),h=Me*(P*=H)-de*B,f=de*R-Se*P,(H=Math.hypot(a,h,f))?(a*=H=1/H,h*=H,f*=H):(a=0,h=0,f=0),x=R*f-B*h,w=B*a-P*f,S=P*h-R*a,(H=Math.hypot(x,w,S))?(x*=H=1/H,w*=H,S*=H):(x=0,w=0,S=0),t[0]=a,t[1]=x,t[2]=P,t[3]=0,t[4]=h,t[5]=w,t[6]=R,t[7]=0,t[8]=f,t[9]=S,t[10]=B,t[11]=0,t[12]=-(a*$+h*te+f*ne),t[13]=-(x*$+w*te+S*ne),t[14]=-(P*$+R*te+B*ne),t[15]=1,t)},si.targetTo=function(t,e,i,o){var a=e[0],h=e[1],f=e[2],x=o[0],w=o[1],S=o[2],P=a-i[0],R=h-i[1],B=f-i[2],H=P*P+R*R+B*B;H>0&&(P*=H=1/Math.sqrt(H),R*=H,B*=H);var $=w*B-S*R,te=S*P-x*B,ne=x*R-w*P;return(H=$*$+te*te+ne*ne)>0&&($*=H=1/Math.sqrt(H),te*=H,ne*=H),t[0]=$,t[1]=te,t[2]=ne,t[3]=0,t[4]=R*ne-B*te,t[5]=B*$-P*ne,t[6]=P*te-R*$,t[7]=0,t[8]=P,t[9]=R,t[10]=B,t[11]=0,t[12]=a,t[13]=h,t[14]=f,t[15]=1,t},si.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},si.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},si.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},si.subtract=Fn,si.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},si.multiplyScalarAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t[4]=e[4]+i[4]*o,t[5]=e[5]+i[5]*o,t[6]=e[6]+i[6]*o,t[7]=e[7]+i[7]*o,t[8]=e[8]+i[8]*o,t[9]=e[9]+i[9]*o,t[10]=e[10]+i[10]*o,t[11]=e[11]+i[11]*o,t[12]=e[12]+i[12]*o,t[13]=e[13]+i[13]*o,t[14]=e[14]+i[14]*o,t[15]=e[15]+i[15]*o,t},si.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},si.equals=function(t,e){var i=t[0],o=t[1],a=t[2],h=t[3],f=t[4],x=t[5],w=t[6],S=t[7],P=t[8],R=t[9],B=t[10],H=t[11],$=t[12],te=t[13],ne=t[14],de=t[15],Se=e[0],Me=e[1],Le=e[2],ze=e[3],Fe=e[4],Xe=e[5],et=e[6],st=e[7],_t=e[8],dt=e[9],St=e[10],Vt=e[11],bt=e[12],kt=e[13],yt=e[14],Bt=e[15];return Math.abs(i-Se)<=Qi.EPSILON*Math.max(1,Math.abs(i),Math.abs(Se))&&Math.abs(o-Me)<=Qi.EPSILON*Math.max(1,Math.abs(o),Math.abs(Me))&&Math.abs(a-Le)<=Qi.EPSILON*Math.max(1,Math.abs(a),Math.abs(Le))&&Math.abs(h-ze)<=Qi.EPSILON*Math.max(1,Math.abs(h),Math.abs(ze))&&Math.abs(f-Fe)<=Qi.EPSILON*Math.max(1,Math.abs(f),Math.abs(Fe))&&Math.abs(x-Xe)<=Qi.EPSILON*Math.max(1,Math.abs(x),Math.abs(Xe))&&Math.abs(w-et)<=Qi.EPSILON*Math.max(1,Math.abs(w),Math.abs(et))&&Math.abs(S-st)<=Qi.EPSILON*Math.max(1,Math.abs(S),Math.abs(st))&&Math.abs(P-_t)<=Qi.EPSILON*Math.max(1,Math.abs(P),Math.abs(_t))&&Math.abs(R-dt)<=Qi.EPSILON*Math.max(1,Math.abs(R),Math.abs(dt))&&Math.abs(B-St)<=Qi.EPSILON*Math.max(1,Math.abs(B),Math.abs(St))&&Math.abs(H-Vt)<=Qi.EPSILON*Math.max(1,Math.abs(H),Math.abs(Vt))&&Math.abs($-bt)<=Qi.EPSILON*Math.max(1,Math.abs($),Math.abs(bt))&&Math.abs(te-kt)<=Qi.EPSILON*Math.max(1,Math.abs(te),Math.abs(kt))&&Math.abs(ne-yt)<=Qi.EPSILON*Math.max(1,Math.abs(ne),Math.abs(yt))&&Math.abs(de-Bt)<=Qi.EPSILON*Math.max(1,Math.abs(de),Math.abs(Bt))},si.sub=si.mul=si.ortho=si.perspective=void 0;var Qi=function(t,e){if(t&&t.__esModule)return t;if(t===null||zi(t)!=="object"&&typeof t!="function")return{default:t};var i=Sn(void 0);if(i&&i.has(t))return i.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var f=a?Object.getOwnPropertyDescriptor(t,h):null;f&&(f.get||f.set)?Object.defineProperty(o,h,f):o[h]=t[h]}return o.default=t,i&&i.set(t,o),o}(ee);function Sn(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Sn=function(o){return o?i:e})(t)}function Co(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function fi(t,e,i){var o=e[0],a=e[1],h=e[2],f=e[3],x=e[4],w=e[5],S=e[6],P=e[7],R=e[8],B=e[9],H=e[10],$=e[11],te=e[12],ne=e[13],de=e[14],Se=e[15],Me=i[0],Le=i[1],ze=i[2],Fe=i[3];return t[0]=Me*o+Le*x+ze*R+Fe*te,t[1]=Me*a+Le*w+ze*B+Fe*ne,t[2]=Me*h+Le*S+ze*H+Fe*de,t[3]=Me*f+Le*P+ze*$+Fe*Se,t[4]=(Me=i[4])*o+(Le=i[5])*x+(ze=i[6])*R+(Fe=i[7])*te,t[5]=Me*a+Le*w+ze*B+Fe*ne,t[6]=Me*h+Le*S+ze*H+Fe*de,t[7]=Me*f+Le*P+ze*$+Fe*Se,t[8]=(Me=i[8])*o+(Le=i[9])*x+(ze=i[10])*R+(Fe=i[11])*te,t[9]=Me*a+Le*w+ze*B+Fe*ne,t[10]=Me*h+Le*S+ze*H+Fe*de,t[11]=Me*f+Le*P+ze*$+Fe*Se,t[12]=(Me=i[12])*o+(Le=i[13])*x+(ze=i[14])*R+(Fe=i[15])*te,t[13]=Me*a+Le*w+ze*B+Fe*ne,t[14]=Me*h+Le*S+ze*H+Fe*de,t[15]=Me*f+Le*P+ze*$+Fe*Se,t}function $r(t,e,i){var o=e[0],a=e[1],h=e[2],f=e[3],x=o+o,w=a+a,S=h+h,P=o*x,R=o*w,B=o*S,H=a*w,$=a*S,te=h*S,ne=f*x,de=f*w,Se=f*S;return t[0]=1-(H+te),t[1]=R+Se,t[2]=B-de,t[3]=0,t[4]=R-Se,t[5]=1-(P+te),t[6]=$+ne,t[7]=0,t[8]=B+de,t[9]=$-ne,t[10]=1-(P+H),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function Or(t,e){var i=e[4],o=e[5],a=e[6],h=e[8],f=e[9],x=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(i,o,a),t[2]=Math.hypot(h,f,x),t}function Hi(t,e,i,o,a){var h,f=1/Math.tan(e/2);return t[0]=f/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(t[10]=(a+o)*(h=1/(o-a)),t[14]=2*a*o*h):(t[10]=-1,t[14]=-2*o),t}function Hn(t,e,i,o,a,h,f){var x=1/(e-i),w=1/(o-a),S=1/(h-f);return t[0]=-2*x,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*w,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*S,t[11]=0,t[12]=(e+i)*x,t[13]=(a+o)*w,t[14]=(f+h)*S,t[15]=1,t}function Fn(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}si.perspective=Hi,si.ortho=Hn,si.mul=fi,si.sub=Fn;var ti={},Ii={};function wi(t){return wi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wi(t)}Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.create=so,Ii.clone=function(t){var e=new on.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Ii.length=Go,Ii.fromValues=function(t,e,i){var o=new on.ARRAY_TYPE(3);return o[0]=t,o[1]=e,o[2]=i,o},Ii.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Ii.set=function(t,e,i,o){return t[0]=e,t[1]=i,t[2]=o,t},Ii.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},Ii.subtract=Pr,Ii.multiply=Ro,Ii.divide=ao,Ii.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Ii.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Ii.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},Ii.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},Ii.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Ii.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},Ii.scaleAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t},Ii.distance=yr,Ii.squaredDistance=ko,Ii.squaredLength=Bo,Ii.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Ii.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Ii.normalize=function(t,e){var i=e[0],o=e[1],a=e[2],h=i*i+o*o+a*a;return h>0&&(h=1/Math.sqrt(h)),t[0]=e[0]*h,t[1]=e[1]*h,t[2]=e[2]*h,t},Ii.dot=Wo,Ii.cross=function(t,e,i){var o=e[0],a=e[1],h=e[2],f=i[0],x=i[1],w=i[2];return t[0]=a*w-h*x,t[1]=h*f-o*w,t[2]=o*x-a*f,t},Ii.lerp=function(t,e,i,o){var a=e[0],h=e[1],f=e[2];return t[0]=a+o*(i[0]-a),t[1]=h+o*(i[1]-h),t[2]=f+o*(i[2]-f),t},Ii.hermite=function(t,e,i,o,a,h){var f=h*h,x=f*(2*h-3)+1,w=f*(h-2)+h,S=f*(h-1),P=f*(3-2*h);return t[0]=e[0]*x+i[0]*w+o[0]*S+a[0]*P,t[1]=e[1]*x+i[1]*w+o[1]*S+a[1]*P,t[2]=e[2]*x+i[2]*w+o[2]*S+a[2]*P,t},Ii.bezier=function(t,e,i,o,a,h){var f=1-h,x=f*f,w=h*h,S=x*f,P=3*h*x,R=3*w*f,B=w*h;return t[0]=e[0]*S+i[0]*P+o[0]*R+a[0]*B,t[1]=e[1]*S+i[1]*P+o[1]*R+a[1]*B,t[2]=e[2]*S+i[2]*P+o[2]*R+a[2]*B,t},Ii.random=function(t,e){e=e||1;var i=2*on.RANDOM()*Math.PI,o=2*on.RANDOM()-1,a=Math.sqrt(1-o*o)*e;return t[0]=Math.cos(i)*a,t[1]=Math.sin(i)*a,t[2]=o*e,t},Ii.transformMat4=function(t,e,i){var o=e[0],a=e[1],h=e[2],f=i[3]*o+i[7]*a+i[11]*h+i[15];return t[0]=(i[0]*o+i[4]*a+i[8]*h+i[12])/(f=f||1),t[1]=(i[1]*o+i[5]*a+i[9]*h+i[13])/f,t[2]=(i[2]*o+i[6]*a+i[10]*h+i[14])/f,t},Ii.transformMat3=function(t,e,i){var o=e[0],a=e[1],h=e[2];return t[0]=o*i[0]+a*i[3]+h*i[6],t[1]=o*i[1]+a*i[4]+h*i[7],t[2]=o*i[2]+a*i[5]+h*i[8],t},Ii.transformQuat=function(t,e,i){var o=i[0],a=i[1],h=i[2],f=e[0],x=e[1],w=e[2],S=a*w-h*x,P=h*f-o*w,R=o*x-a*f,B=a*R-h*P,H=h*S-o*R,$=o*P-a*S,te=2*i[3];return P*=te,R*=te,H*=2,$*=2,t[0]=f+(S*=te)+(B*=2),t[1]=x+P+H,t[2]=w+R+$,t},Ii.rotateX=function(t,e,i,o){var a=[],h=[];return a[0]=e[0]-i[0],a[1]=e[1]-i[1],a[2]=e[2]-i[2],h[0]=a[0],h[1]=a[1]*Math.cos(o)-a[2]*Math.sin(o),h[2]=a[1]*Math.sin(o)+a[2]*Math.cos(o),t[0]=h[0]+i[0],t[1]=h[1]+i[1],t[2]=h[2]+i[2],t},Ii.rotateY=function(t,e,i,o){var a=[],h=[];return a[0]=e[0]-i[0],a[1]=e[1]-i[1],a[2]=e[2]-i[2],h[0]=a[2]*Math.sin(o)+a[0]*Math.cos(o),h[1]=a[1],h[2]=a[2]*Math.cos(o)-a[0]*Math.sin(o),t[0]=h[0]+i[0],t[1]=h[1]+i[1],t[2]=h[2]+i[2],t},Ii.rotateZ=function(t,e,i,o){var a=[],h=[];return a[0]=e[0]-i[0],a[1]=e[1]-i[1],a[2]=e[2]-i[2],h[0]=a[0]*Math.cos(o)-a[1]*Math.sin(o),h[1]=a[0]*Math.sin(o)+a[1]*Math.cos(o),h[2]=a[2],t[0]=h[0]+i[0],t[1]=h[1]+i[1],t[2]=h[2]+i[2],t},Ii.angle=function(t,e){var i=t[0],o=t[1],a=t[2],h=e[0],f=e[1],x=e[2],w=Math.sqrt(i*i+o*o+a*a)*Math.sqrt(h*h+f*f+x*x),S=w&&Wo(t,e)/w;return Math.acos(Math.min(Math.max(S,-1),1))},Ii.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Ii.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Ii.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Ii.equals=function(t,e){var i=t[0],o=t[1],a=t[2],h=e[0],f=e[1],x=e[2];return Math.abs(i-h)<=on.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-f)<=on.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-x)<=on.EPSILON*Math.max(1,Math.abs(a),Math.abs(x))},Ii.forEach=Ii.sqrLen=Ii.len=Ii.sqrDist=Ii.dist=Ii.div=Ii.mul=Ii.sub=void 0;var on=function(t,e){if(t&&t.__esModule)return t;if(t===null||wi(t)!=="object"&&typeof t!="function")return{default:t};var i=Do(void 0);if(i&&i.has(t))return i.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var f=a?Object.getOwnPropertyDescriptor(t,h):null;f&&(f.get||f.set)?Object.defineProperty(o,h,f):o[h]=t[h]}return o.default=t,i&&i.set(t,o),o}(ee);function Do(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Do=function(o){return o?i:e})(t)}function so(){var t=new on.ARRAY_TYPE(3);return on.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Go(t){return Math.hypot(t[0],t[1],t[2])}function Pr(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Ro(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function ao(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function yr(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function ko(t,e){var i=e[0]-t[0],o=e[1]-t[1],a=e[2]-t[2];return i*i+o*o+a*a}function Bo(t){var e=t[0],i=t[1],o=t[2];return e*e+i*i+o*o}function Wo(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Ii.sub=Pr,Ii.mul=Ro,Ii.div=ao,Ii.dist=yr,Ii.sqrDist=ko,Ii.len=Go,Ii.sqrLen=Bo;var er,pi=(er=so(),function(t,e,i,o,a,h){var f,x;for(e||(e=3),i||(i=0),x=o?Math.min(o*e+i,t.length):t.length,f=i;f<x;f+=e)er[0]=t[f],er[1]=t[f+1],er[2]=t[f+2],a(er,er,h),t[f]=er[0],t[f+1]=er[1],t[f+2]=er[2];return t});Ii.forEach=pi;var xi={};function Gn(t){return Gn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gn(t)}Object.defineProperty(xi,"__esModule",{value:!0}),xi.create=Ds,xi.clone=function(t){var e=new an.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},xi.fromValues=function(t,e,i,o){var a=new an.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=i,a[3]=o,a},xi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},xi.set=function(t,e,i,o,a){return t[0]=e,t[1]=i,t[2]=o,t[3]=a,t},xi.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},xi.subtract=$o,xi.multiply=gn,xi.divide=No,xi.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},xi.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},xi.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},xi.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},xi.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},xi.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},xi.scaleAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t},xi.distance=Es,xi.squaredDistance=Ur,xi.length=Tr,xi.squaredLength=Rs,xi.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},xi.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},xi.normalize=function(t,e){var i=e[0],o=e[1],a=e[2],h=e[3],f=i*i+o*o+a*a+h*h;return f>0&&(f=1/Math.sqrt(f)),t[0]=i*f,t[1]=o*f,t[2]=a*f,t[3]=h*f,t},xi.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},xi.cross=function(t,e,i,o){var a=i[0]*o[1]-i[1]*o[0],h=i[0]*o[2]-i[2]*o[0],f=i[0]*o[3]-i[3]*o[0],x=i[1]*o[2]-i[2]*o[1],w=i[1]*o[3]-i[3]*o[1],S=i[2]*o[3]-i[3]*o[2],P=e[0],R=e[1],B=e[2],H=e[3];return t[0]=R*S-B*w+H*x,t[1]=-P*S+B*f-H*h,t[2]=P*w-R*f+H*a,t[3]=-P*x+R*h-B*a,t},xi.lerp=function(t,e,i,o){var a=e[0],h=e[1],f=e[2],x=e[3];return t[0]=a+o*(i[0]-a),t[1]=h+o*(i[1]-h),t[2]=f+o*(i[2]-f),t[3]=x+o*(i[3]-x),t},xi.random=function(t,e){var i,o,a,h,f,x;e=e||1;do f=(i=2*an.RANDOM()-1)*i+(o=2*an.RANDOM()-1)*o;while(f>=1);do x=(a=2*an.RANDOM()-1)*a+(h=2*an.RANDOM()-1)*h;while(x>=1);var w=Math.sqrt((1-f)/x);return t[0]=e*i,t[1]=e*o,t[2]=e*a*w,t[3]=e*h*w,t},xi.transformMat4=function(t,e,i){var o=e[0],a=e[1],h=e[2],f=e[3];return t[0]=i[0]*o+i[4]*a+i[8]*h+i[12]*f,t[1]=i[1]*o+i[5]*a+i[9]*h+i[13]*f,t[2]=i[2]*o+i[6]*a+i[10]*h+i[14]*f,t[3]=i[3]*o+i[7]*a+i[11]*h+i[15]*f,t},xi.transformQuat=function(t,e,i){var o=e[0],a=e[1],h=e[2],f=i[0],x=i[1],w=i[2],S=i[3],P=S*o+x*h-w*a,R=S*a+w*o-f*h,B=S*h+f*a-x*o,H=-f*o-x*a-w*h;return t[0]=P*S+H*-f+R*-w-B*-x,t[1]=R*S+H*-x+B*-f-P*-w,t[2]=B*S+H*-w+P*-x-R*-f,t[3]=e[3],t},xi.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},xi.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},xi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},xi.equals=function(t,e){var i=t[0],o=t[1],a=t[2],h=t[3],f=e[0],x=e[1],w=e[2],S=e[3];return Math.abs(i-f)<=an.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(o-x)<=an.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-w)<=an.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(h-S)<=an.EPSILON*Math.max(1,Math.abs(h),Math.abs(S))},xi.forEach=xi.sqrLen=xi.len=xi.sqrDist=xi.dist=xi.div=xi.mul=xi.sub=void 0;var an=function(t,e){if(t&&t.__esModule)return t;if(t===null||Gn(t)!=="object"&&typeof t!="function")return{default:t};var i=Jo(void 0);if(i&&i.has(t))return i.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var f=a?Object.getOwnPropertyDescriptor(t,h):null;f&&(f.get||f.set)?Object.defineProperty(o,h,f):o[h]=t[h]}return o.default=t,i&&i.set(t,o),o}(ee);function Jo(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Jo=function(o){return o?i:e})(t)}function Ds(){var t=new an.ARRAY_TYPE(4);return an.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function $o(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function gn(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function No(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function Es(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function Ur(t,e){var i=e[0]-t[0],o=e[1]-t[1],a=e[2]-t[2],h=e[3]-t[3];return i*i+o*o+a*a+h*h}function Tr(t){return Math.hypot(t[0],t[1],t[2],t[3])}function Rs(t){var e=t[0],i=t[1],o=t[2],a=t[3];return e*e+i*i+o*o+a*a}xi.sub=$o,xi.mul=gn,xi.div=No,xi.dist=Es,xi.sqrDist=Ur,xi.len=Tr,xi.sqrLen=Rs;var tr=function(){var t=Ds();return function(e,i,o,a,h,f){var x,w;for(i||(i=4),o||(o=0),w=a?Math.min(a*i+o,e.length):e.length,x=o;x<w;x+=i)t[0]=e[x],t[1]=e[x+1],t[2]=e[x+2],t[3]=e[x+3],h(t,t,f),e[x]=t[0],e[x+1]=t[1],e[x+2]=t[2],e[x+3]=t[3];return e}}();function Fo(t){return Fo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fo(t)}xi.forEach=tr,Object.defineProperty(ti,"__esModule",{value:!0}),ti.create=hr,ti.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},ti.setAxisAngle=nr,ti.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),o=Math.sin(i/2);return o>Eo.EPSILON?(t[0]=e[0]/o,t[1]=e[1]/o,t[2]=e[2]/o):(t[0]=1,t[1]=0,t[2]=0),i},ti.getAngle=function(t,e){var i=Re(t,e);return Math.acos(2*i*i-1)},ti.multiply=Ke,ti.rotateX=function(t,e,i){i*=.5;var o=e[0],a=e[1],h=e[2],f=e[3],x=Math.sin(i),w=Math.cos(i);return t[0]=o*w+f*x,t[1]=a*w+h*x,t[2]=h*w-a*x,t[3]=f*w-o*x,t},ti.rotateY=function(t,e,i){i*=.5;var o=e[0],a=e[1],h=e[2],f=e[3],x=Math.sin(i),w=Math.cos(i);return t[0]=o*w-h*x,t[1]=a*w+f*x,t[2]=h*w+o*x,t[3]=f*w-a*x,t},ti.rotateZ=function(t,e,i){i*=.5;var o=e[0],a=e[1],h=e[2],f=e[3],x=Math.sin(i),w=Math.cos(i);return t[0]=o*w+a*x,t[1]=a*w-o*x,t[2]=h*w+f*x,t[3]=f*w-h*x,t},ti.calculateW=function(t,e){var i=e[0],o=e[1],a=e[2];return t[0]=i,t[1]=o,t[2]=a,t[3]=Math.sqrt(Math.abs(1-i*i-o*o-a*a)),t},ti.exp=ve,ti.ln=re,ti.pow=function(t,e,i){return re(t,e),Oe(t,t,i),ve(t,t),t},ti.slerp=ae,ti.random=function(t){var e=Eo.RANDOM(),i=Eo.RANDOM(),o=Eo.RANDOM(),a=Math.sqrt(1-e),h=Math.sqrt(e);return t[0]=a*Math.sin(2*Math.PI*i),t[1]=a*Math.cos(2*Math.PI*i),t[2]=h*Math.sin(2*Math.PI*o),t[3]=h*Math.cos(2*Math.PI*o),t},ti.invert=function(t,e){var i=e[0],o=e[1],a=e[2],h=e[3],f=i*i+o*o+a*a+h*h,x=f?1/f:0;return t[0]=-i*x,t[1]=-o*x,t[2]=-a*x,t[3]=h*x,t},ti.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},ti.fromMat3=Ee,ti.fromEuler=function(t,e,i,o){var a=.5*Math.PI/180;e*=a,i*=a,o*=a;var h=Math.sin(e),f=Math.cos(e),x=Math.sin(i),w=Math.cos(i),S=Math.sin(o),P=Math.cos(o);return t[0]=h*w*P-f*x*S,t[1]=f*x*P+h*w*S,t[2]=f*w*S-h*x*P,t[3]=f*w*P+h*x*S,t},ti.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},ti.setAxes=ti.sqlerp=ti.rotationTo=ti.equals=ti.exactEquals=ti.normalize=ti.sqrLen=ti.squaredLength=ti.len=ti.length=ti.lerp=ti.dot=ti.scale=ti.mul=ti.add=ti.set=ti.copy=ti.fromValues=ti.clone=void 0;var Eo=Cr(ee),uo=Cr(Oi),yn=Cr(Ii),Kn=Cr(xi);function To(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(To=function(o){return o?i:e})(t)}function Cr(t,e){if(t&&t.__esModule)return t;if(t===null||Fo(t)!=="object"&&typeof t!="function")return{default:t};var i=To(e);if(i&&i.has(t))return i.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var f=a?Object.getOwnPropertyDescriptor(t,h):null;f&&(f.get||f.set)?Object.defineProperty(o,h,f):o[h]=t[h]}return o.default=t,i&&i.set(t,o),o}function hr(){var t=new Eo.ARRAY_TYPE(4);return Eo.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function nr(t,e,i){i*=.5;var o=Math.sin(i);return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=Math.cos(i),t}function Ke(t,e,i){var o=e[0],a=e[1],h=e[2],f=e[3],x=i[0],w=i[1],S=i[2],P=i[3];return t[0]=o*P+f*x+a*S-h*w,t[1]=a*P+f*w+h*x-o*S,t[2]=h*P+f*S+o*w-a*x,t[3]=f*P-o*x-a*w-h*S,t}function ve(t,e){var i=e[0],o=e[1],a=e[2],h=e[3],f=Math.sqrt(i*i+o*o+a*a),x=Math.exp(h),w=f>0?x*Math.sin(f)/f:0;return t[0]=i*w,t[1]=o*w,t[2]=a*w,t[3]=x*Math.cos(f),t}function re(t,e){var i=e[0],o=e[1],a=e[2],h=e[3],f=Math.sqrt(i*i+o*o+a*a),x=f>0?Math.atan2(f,h)/f:0;return t[0]=i*x,t[1]=o*x,t[2]=a*x,t[3]=.5*Math.log(i*i+o*o+a*a+h*h),t}function ae(t,e,i,o){var a,h,f,x,w,S=e[0],P=e[1],R=e[2],B=e[3],H=i[0],$=i[1],te=i[2],ne=i[3];return(h=S*H+P*$+R*te+B*ne)<0&&(h=-h,H=-H,$=-$,te=-te,ne=-ne),1-h>Eo.EPSILON?(a=Math.acos(h),f=Math.sin(a),x=Math.sin((1-o)*a)/f,w=Math.sin(o*a)/f):(x=1-o,w=o),t[0]=x*S+w*H,t[1]=x*P+w*$,t[2]=x*R+w*te,t[3]=x*B+w*ne,t}function Ee(t,e){var i,o=e[0]+e[4]+e[8];if(o>0)i=Math.sqrt(o+1),t[3]=.5*i,t[0]=(e[5]-e[7])*(i=.5/i),t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[3*a+a]&&(a=2);var h=(a+1)%3,f=(a+2)%3;i=Math.sqrt(e[3*a+a]-e[3*h+h]-e[3*f+f]+1),t[a]=.5*i,t[3]=(e[3*h+f]-e[3*f+h])*(i=.5/i),t[h]=(e[3*h+a]+e[3*a+h])*i,t[f]=(e[3*f+a]+e[3*a+f])*i}return t}ti.clone=Kn.clone,ti.fromValues=Kn.fromValues,ti.copy=Kn.copy,ti.set=Kn.set,ti.add=Kn.add,ti.mul=Ke;var Oe=Kn.scale;ti.scale=Oe;var Re=Kn.dot;ti.dot=Re,ti.lerp=Kn.lerp;var je=Kn.length;ti.length=je,ti.len=je;var Je=Kn.squaredLength;ti.squaredLength=Je,ti.sqrLen=Je;var Ge=Kn.normalize;ti.normalize=Ge,ti.exactEquals=Kn.exactEquals,ti.equals=Kn.equals;var rt,ht,pt,$t=(rt=yn.create(),ht=yn.fromValues(1,0,0),pt=yn.fromValues(0,1,0),function(t,e,i){var o=yn.dot(e,i);return o<-.999999?(yn.cross(rt,ht,e),yn.len(rt)<1e-6&&yn.cross(rt,pt,e),yn.normalize(rt,rt),nr(t,rt,Math.PI),t):o>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(yn.cross(rt,e,i),t[0]=rt[0],t[1]=rt[1],t[2]=rt[2],t[3]=1+o,Ge(t,t))});ti.rotationTo=$t;var oi,bi,mt=(oi=hr(),bi=hr(),function(t,e,i,o,a,h){return ae(oi,e,a,h),ae(bi,i,o,h),ae(t,oi,bi,2*h*(1-h)),t});ti.sqlerp=mt;var Ti,ui=(Ti=uo.create(),function(t,e,i,o){return Ti[0]=i[0],Ti[3]=i[1],Ti[6]=i[2],Ti[1]=o[0],Ti[4]=o[1],Ti[7]=o[2],Ti[2]=-e[0],Ti[5]=-e[1],Ti[8]=-e[2],Ge(t,Ee(t,Ti))});ti.setAxes=ui;var Gt={};function Yi(t){return Yi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yi(t)}Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.create=function(){var t=new ei.ARRAY_TYPE(8);return ei.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},Gt.clone=function(t){var e=new ei.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},Gt.fromValues=function(t,e,i,o,a,h,f,x){var w=new ei.ARRAY_TYPE(8);return w[0]=t,w[1]=e,w[2]=i,w[3]=o,w[4]=a,w[5]=h,w[6]=f,w[7]=x,w},Gt.fromRotationTranslationValues=function(t,e,i,o,a,h,f){var x=new ei.ARRAY_TYPE(8);x[0]=t,x[1]=e,x[2]=i,x[3]=o;var w=.5*a,S=.5*h,P=.5*f;return x[4]=w*o+S*i-P*e,x[5]=S*o+P*t-w*i,x[6]=P*o+w*e-S*t,x[7]=-w*t-S*e-P*i,x},Gt.fromRotationTranslation=Dn,Gt.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},Gt.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Gt.fromMat4=function(t,e){var i=ii.create();yi.getRotation(i,e);var o=new ei.ARRAY_TYPE(3);return yi.getTranslation(o,e),Dn(t,i,o),t},Gt.copy=pn,Gt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Gt.set=function(t,e,i,o,a,h,f,x,w){return t[0]=e,t[1]=i,t[2]=o,t[3]=a,t[4]=h,t[5]=f,t[6]=x,t[7]=w,t},Gt.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},Gt.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},Gt.getTranslation=function(t,e){var i=e[4],o=e[5],a=e[6],h=e[7],f=-e[0],x=-e[1],w=-e[2],S=e[3];return t[0]=2*(i*S+h*f+o*w-a*x),t[1]=2*(o*S+h*x+a*f-i*w),t[2]=2*(a*S+h*w+i*x-o*f),t},Gt.translate=function(t,e,i){var o=e[0],a=e[1],h=e[2],f=e[3],x=.5*i[0],w=.5*i[1],S=.5*i[2],P=e[4],R=e[5],B=e[6],H=e[7];return t[0]=o,t[1]=a,t[2]=h,t[3]=f,t[4]=f*x+a*S-h*w+P,t[5]=f*w+h*x-o*S+R,t[6]=f*S+o*w-a*x+B,t[7]=-o*x-a*w-h*S+H,t},Gt.rotateX=function(t,e,i){var o=-e[0],a=-e[1],h=-e[2],f=e[3],x=e[4],w=e[5],S=e[6],P=e[7],R=x*f+P*o+w*h-S*a,B=w*f+P*a+S*o-x*h,H=S*f+P*h+x*a-w*o,$=P*f-x*o-w*a-S*h;return ii.rotateX(t,e,i),t[4]=R*(f=t[3])+$*(o=t[0])+B*(h=t[2])-H*(a=t[1]),t[5]=B*f+$*a+H*o-R*h,t[6]=H*f+$*h+R*a-B*o,t[7]=$*f-R*o-B*a-H*h,t},Gt.rotateY=function(t,e,i){var o=-e[0],a=-e[1],h=-e[2],f=e[3],x=e[4],w=e[5],S=e[6],P=e[7],R=x*f+P*o+w*h-S*a,B=w*f+P*a+S*o-x*h,H=S*f+P*h+x*a-w*o,$=P*f-x*o-w*a-S*h;return ii.rotateY(t,e,i),t[4]=R*(f=t[3])+$*(o=t[0])+B*(h=t[2])-H*(a=t[1]),t[5]=B*f+$*a+H*o-R*h,t[6]=H*f+$*h+R*a-B*o,t[7]=$*f-R*o-B*a-H*h,t},Gt.rotateZ=function(t,e,i){var o=-e[0],a=-e[1],h=-e[2],f=e[3],x=e[4],w=e[5],S=e[6],P=e[7],R=x*f+P*o+w*h-S*a,B=w*f+P*a+S*o-x*h,H=S*f+P*h+x*a-w*o,$=P*f-x*o-w*a-S*h;return ii.rotateZ(t,e,i),t[4]=R*(f=t[3])+$*(o=t[0])+B*(h=t[2])-H*(a=t[1]),t[5]=B*f+$*a+H*o-R*h,t[6]=H*f+$*h+R*a-B*o,t[7]=$*f-R*o-B*a-H*h,t},Gt.rotateByQuatAppend=function(t,e,i){var o=i[0],a=i[1],h=i[2],f=i[3],x=e[0],w=e[1],S=e[2],P=e[3];return t[0]=x*f+P*o+w*h-S*a,t[1]=w*f+P*a+S*o-x*h,t[2]=S*f+P*h+x*a-w*o,t[3]=P*f-x*o-w*a-S*h,t[4]=(x=e[4])*f+(P=e[7])*o+(w=e[5])*h-(S=e[6])*a,t[5]=w*f+P*a+S*o-x*h,t[6]=S*f+P*h+x*a-w*o,t[7]=P*f-x*o-w*a-S*h,t},Gt.rotateByQuatPrepend=function(t,e,i){var o=e[0],a=e[1],h=e[2],f=e[3],x=i[0],w=i[1],S=i[2],P=i[3];return t[0]=o*P+f*x+a*S-h*w,t[1]=a*P+f*w+h*x-o*S,t[2]=h*P+f*S+o*w-a*x,t[3]=f*P-o*x-a*w-h*S,t[4]=o*(P=i[7])+f*(x=i[4])+a*(S=i[6])-h*(w=i[5]),t[5]=a*P+f*w+h*x-o*S,t[6]=h*P+f*S+o*w-a*x,t[7]=f*P-o*x-a*w-h*S,t},Gt.rotateAroundAxis=function(t,e,i,o){if(Math.abs(o)<ei.EPSILON)return pn(t,e);var a=Math.hypot(i[0],i[1],i[2]);o*=.5;var h=Math.sin(o),f=h*i[0]/a,x=h*i[1]/a,w=h*i[2]/a,S=Math.cos(o),P=e[0],R=e[1],B=e[2],H=e[3];t[0]=P*S+H*f+R*w-B*x,t[1]=R*S+H*x+B*f-P*w,t[2]=B*S+H*w+P*x-R*f,t[3]=H*S-P*f-R*x-B*w;var $=e[4],te=e[5],ne=e[6],de=e[7];return t[4]=$*S+de*f+te*w-ne*x,t[5]=te*S+de*x+ne*f-$*w,t[6]=ne*S+de*w+$*x-te*f,t[7]=de*S-$*f-te*x-ne*w,t},Gt.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t},Gt.multiply=Ar,Gt.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t},Gt.lerp=function(t,e,i,o){var a=1-o;return es(e,i)<0&&(o=-o),t[0]=e[0]*a+i[0]*o,t[1]=e[1]*a+i[1]*o,t[2]=e[2]*a+i[2]*o,t[3]=e[3]*a+i[3]*o,t[4]=e[4]*a+i[4]*o,t[5]=e[5]*a+i[5]*o,t[6]=e[6]*a+i[6]*o,t[7]=e[7]*a+i[7]*o,t},Gt.invert=function(t,e){var i=_n(e);return t[0]=-e[0]/i,t[1]=-e[1]/i,t[2]=-e[2]/i,t[3]=e[3]/i,t[4]=-e[4]/i,t[5]=-e[5]/i,t[6]=-e[6]/i,t[7]=e[7]/i,t},Gt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},Gt.normalize=function(t,e){var i=_n(e);if(i>0){i=Math.sqrt(i);var o=e[0]/i,a=e[1]/i,h=e[2]/i,f=e[3]/i,x=e[4],w=e[5],S=e[6],P=e[7],R=o*x+a*w+h*S+f*P;t[0]=o,t[1]=a,t[2]=h,t[3]=f,t[4]=(x-o*R)/i,t[5]=(w-a*R)/i,t[6]=(S-h*R)/i,t[7]=(P-f*R)/i}return t},Gt.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},Gt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},Gt.equals=function(t,e){var i=t[0],o=t[1],a=t[2],h=t[3],f=t[4],x=t[5],w=t[6],S=t[7],P=e[0],R=e[1],B=e[2],H=e[3],$=e[4],te=e[5],ne=e[6],de=e[7];return Math.abs(i-P)<=ei.EPSILON*Math.max(1,Math.abs(i),Math.abs(P))&&Math.abs(o-R)<=ei.EPSILON*Math.max(1,Math.abs(o),Math.abs(R))&&Math.abs(a-B)<=ei.EPSILON*Math.max(1,Math.abs(a),Math.abs(B))&&Math.abs(h-H)<=ei.EPSILON*Math.max(1,Math.abs(h),Math.abs(H))&&Math.abs(f-$)<=ei.EPSILON*Math.max(1,Math.abs(f),Math.abs($))&&Math.abs(x-te)<=ei.EPSILON*Math.max(1,Math.abs(x),Math.abs(te))&&Math.abs(w-ne)<=ei.EPSILON*Math.max(1,Math.abs(w),Math.abs(ne))&&Math.abs(S-de)<=ei.EPSILON*Math.max(1,Math.abs(S),Math.abs(de))},Gt.sqrLen=Gt.squaredLength=Gt.len=Gt.length=Gt.dot=Gt.mul=Gt.setReal=Gt.getReal=void 0;var ei=tn(ee),ii=tn(ti),yi=tn(si);function Xi(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Xi=function(o){return o?i:e})(t)}function tn(t,e){if(t&&t.__esModule)return t;if(t===null||Yi(t)!=="object"&&typeof t!="function")return{default:t};var i=Xi(e);if(i&&i.has(t))return i.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var f=a?Object.getOwnPropertyDescriptor(t,h):null;f&&(f.get||f.set)?Object.defineProperty(o,h,f):o[h]=t[h]}return o.default=t,i&&i.set(t,o),o}function Dn(t,e,i){var o=.5*i[0],a=.5*i[1],h=.5*i[2],f=e[0],x=e[1],w=e[2],S=e[3];return t[0]=f,t[1]=x,t[2]=w,t[3]=S,t[4]=o*S+a*w-h*x,t[5]=a*S+h*f-o*w,t[6]=h*S+o*x-a*f,t[7]=-o*f-a*x-h*w,t}function pn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Ar(t,e,i){var o=e[0],a=e[1],h=e[2],f=e[3],x=i[4],w=i[5],S=i[6],P=i[7],R=e[4],B=e[5],H=e[6],$=e[7],te=i[0],ne=i[1],de=i[2],Se=i[3];return t[0]=o*Se+f*te+a*de-h*ne,t[1]=a*Se+f*ne+h*te-o*de,t[2]=h*Se+f*de+o*ne-a*te,t[3]=f*Se-o*te-a*ne-h*de,t[4]=o*P+f*x+a*S-h*w+R*Se+$*te+B*de-H*ne,t[5]=a*P+f*w+h*x-o*S+B*Se+$*ne+H*te-R*de,t[6]=h*P+f*S+o*w-a*x+H*Se+$*de+R*ne-B*te,t[7]=f*P-o*x-a*w-h*S+$*Se-R*te-B*ne-H*de,t}Gt.getReal=ii.copy,Gt.setReal=ii.copy,Gt.mul=Ar;var es=ii.dot;Gt.dot=es;var ar=ii.length;Gt.length=ar,Gt.len=ar;var _n=ii.squaredLength;Gt.squaredLength=_n,Gt.sqrLen=_n;var Pi={};function zo(t){return zo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zo(t)}Object.defineProperty(Pi,"__esModule",{value:!0}),Pi.create=Ct,Pi.clone=function(t){var e=new Rn.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Pi.fromValues=function(t,e){var i=new Rn.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},Pi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Pi.set=function(t,e,i){return t[0]=e,t[1]=i,t},Pi.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},Pi.subtract=We,Pi.multiply=ki,Pi.divide=dr,Pi.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Pi.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Pi.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},Pi.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},Pi.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Pi.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},Pi.scaleAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t},Pi.distance=jr,Pi.squaredDistance=So,Pi.length=gr,Pi.squaredLength=_o,Pi.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Pi.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Pi.normalize=function(t,e){var i=e[0],o=e[1],a=i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t},Pi.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Pi.cross=function(t,e,i){var o=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=o,t},Pi.lerp=function(t,e,i,o){var a=e[0],h=e[1];return t[0]=a+o*(i[0]-a),t[1]=h+o*(i[1]-h),t},Pi.random=function(t,e){e=e||1;var i=2*Rn.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},Pi.transformMat2=function(t,e,i){var o=e[0],a=e[1];return t[0]=i[0]*o+i[2]*a,t[1]=i[1]*o+i[3]*a,t},Pi.transformMat2d=function(t,e,i){var o=e[0],a=e[1];return t[0]=i[0]*o+i[2]*a+i[4],t[1]=i[1]*o+i[3]*a+i[5],t},Pi.transformMat3=function(t,e,i){var o=e[0],a=e[1];return t[0]=i[0]*o+i[3]*a+i[6],t[1]=i[1]*o+i[4]*a+i[7],t},Pi.transformMat4=function(t,e,i){var o=e[0],a=e[1];return t[0]=i[0]*o+i[4]*a+i[12],t[1]=i[1]*o+i[5]*a+i[13],t},Pi.rotate=function(t,e,i,o){var a=e[0]-i[0],h=e[1]-i[1],f=Math.sin(o),x=Math.cos(o);return t[0]=a*x-h*f+i[0],t[1]=a*f+h*x+i[1],t},Pi.angle=function(t,e){var i=t[0],o=t[1],a=e[0],h=e[1],f=Math.sqrt(i*i+o*o)*Math.sqrt(a*a+h*h);return Math.acos(Math.min(Math.max(f&&(i*a+o*h)/f,-1),1))},Pi.zero=function(t){return t[0]=0,t[1]=0,t},Pi.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Pi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Pi.equals=function(t,e){var i=t[0],o=t[1],a=e[0],h=e[1];return Math.abs(i-a)<=Rn.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(o-h)<=Rn.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))},Pi.forEach=Pi.sqrLen=Pi.sqrDist=Pi.dist=Pi.div=Pi.mul=Pi.sub=Pi.len=void 0;var Rn=function(t,e){if(t&&t.__esModule)return t;if(t===null||zo(t)!=="object"&&typeof t!="function")return{default:t};var i=Zr(void 0);if(i&&i.has(t))return i.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var f=a?Object.getOwnPropertyDescriptor(t,h):null;f&&(f.get||f.set)?Object.defineProperty(o,h,f):o[h]=t[h]}return o.default=t,i&&i.set(t,o),o}(ee);function Zr(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Zr=function(o){return o?i:e})(t)}function Ct(){var t=new Rn.ARRAY_TYPE(2);return Rn.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function We(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function ki(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function dr(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function jr(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function So(t,e){var i=e[0]-t[0],o=e[1]-t[1];return i*i+o*o}function gr(t){return Math.hypot(t[0],t[1])}function _o(t){var e=t[0],i=t[1];return e*e+i*i}Pi.len=gr,Pi.sub=We,Pi.mul=ki,Pi.div=dr,Pi.dist=jr,Pi.sqrDist=So,Pi.sqrLen=_o;var Wi=function(){var t=Ct();return function(e,i,o,a,h,f){var x,w;for(i||(i=2),o||(o=0),w=a?Math.min(a*i+o,e.length):e.length,x=o;x<w;x+=i)t[0]=e[x],t[1]=e[x+1],h(t,t,f),e[x]=t[0],e[x+1]=t[1];return e}}();function lr(t){return lr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lr(t)}Pi.forEach=Wi,Object.defineProperty(Q,"__esModule",{value:!0}),r.aA=Q.vec4=r._=Q.vec3=Q.vec2=Q.quat2=r.av=Q.quat=r.ad=Q.mat4=r.bC=Q.mat3=Q.mat2d=r.aC=Q.mat2=Q.glMatrix=void 0;var Vs=hn(ee);Q.glMatrix=Vs;var ks=hn(nt);r.aC=Q.mat2=ks;var pa=hn(_i);Q.mat2d=pa;var Bs=hn(Oi);r.bC=Q.mat3=Bs;var Us=hn(si);r.ad=Q.mat4=Us;var ms=hn(ti);r.av=Q.quat=ms;var Bi=hn(Gt);Q.quat2=Bi;var Zo=hn(Pi);Q.vec2=Zo;var Xo=hn(Ii);r._=Q.vec3=Xo;var en=hn(xi);function ma(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(ma=function(o){return o?i:e})(t)}function hn(t,e){if(t&&t.__esModule)return t;if(t===null||lr(t)!=="object"&&typeof t!="function")return{default:t};var i=ma(e);if(i&&i.has(t))return i.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var f=a?Object.getOwnPropertyDescriptor(t,h):null;f&&(f.get||f.set)?Object.defineProperty(o,h,f):o[h]=t[h]}return o.default=t,i&&i.set(t,o),o}r.aA=Q.vec4=en;var io=Qs;function Qs(t,e,i,o){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=o}Qs.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,o=0;o<8;o++){var a=this.sampleCurveX(i)-t;if(Math.abs(a)<e)return i;var h=this.sampleCurveDerivativeX(i);if(Math.abs(h)<1e-6)break;i-=a/h}var f=0,x=1;for(i=t,o=0;o<20&&(a=this.sampleCurveX(i),!(Math.abs(a-t)<e));o++)t>a?f=i:x=i,i=.5*(x-f)+f;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Ns=G(io),ga=Yo;function Yo(t,e){this.x=t,this.y=e}Yo.prototype={clone:function(){return new Yo(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),o=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=o,this},_rotateAround:function(t,e){var i=Math.cos(t),o=Math.sin(t),a=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Yo.convert=function(t){return t instanceof Yo?t:Array.isArray(t)?new Yo(t[0],t[1]):t};var Yt=G(ga);const Js=Math.PI/180,ts=180/Math.PI;function nn(t){return t*Js}function ho(t){return t*ts}const _a=[[0,0],[1,0],[1,1],[0,1]];function js(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function fo(t,e,i,o){const a=new Ns(t,e,i,o);return function(h){return a.solve(h)}}const eu=fo(.25,.1,.25,1);function Ki(t,e,i){return Math.min(i,Math.max(e,t))}function il(t,e,i){return(i=Ki((i-t)/(e-t),0,1))*i*(3-2*i)}function Na(t,e,i){const o=i-e,a=((t-e)%o+o)%o+e;return a===e?i:a}function ls(t,e,i){if(!t.length)return i(null,[]);let o=t.length;const a=new Array(t.length);let h=null;t.forEach((f,x)=>{e(f,(w,S)=>{w&&(h=w),a[x]=S,--o==0&&i(h,a)})})}function ya(t){const e=[];for(const i in t)e.push(t[i]);return e}function An(t,...e){for(const i of e)for(const o in i)t[o]=i[o];return t}let Zl=1;function va(){return Zl++}function Fs(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Tc(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Nt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function On(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Xr(t,e){return t.indexOf(e,t.length-e.length)!==-1}function zs(t,e,i){const o={};for(const a in t)o[a]=e.call(this,t[a],a,t);return o}function Xl(t,e,i){const o={};for(const a in t)e.call(this,t[a],a,t)&&(o[a]=t[a]);return o}function is(t){return Array.isArray(t)?t.map(is):typeof t=="object"&&t?zs(t,is):t}const Sc={};function Dr(t){Sc[t]||(typeof console<"u"&&console.warn(t),Sc[t]=!0)}function Ir(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function Rr(t){let e=0;for(let i,o,a=0,h=t.length,f=h-1;a<h;f=a++)i=t[a],o=t[f],e+=(o.x-i.x)*(i.y+o.y);return e}function kr([t,e,i]){const o=nn(e+90),a=nn(i);return{x:t*Math.cos(o)*Math.sin(a),y:t*Math.sin(o)*Math.sin(a),z:t*Math.cos(a),azimuthal:e,polar:i}}function Mr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Fa(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,a,h)=>{const f=a||h;return e[o]=!f||f.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let gs,rr,ln,nl,cr,Vo,_s=null;function Ac(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function cs(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Yl(t,e,i,o){for(;e<i;){const a=e+i>>1;t[a]<o?e=a+1:i=a}return e}function bl(t,e,i,o){for(;e<i;){const a=e+i>>1;t[a]<=o?e=a+1:i=a}return e}function rl(t){return t>0?1/(1.001-t):1+t}function za(t){return t>0?1-1/(1.001-t):-t}function Cl(){return gs==null&&(gs=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),gs}const Ao={now:()=>nl!==void 0?nl:performance.now(),setNow(t){nl=t},restoreNow(){nl=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:o}=t;cr||(cr=document.createElement("canvas"));const a=cr.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(i>cr.width||o>cr.height)&&(cr.width=i,cr.height=o),a.clearRect(-e,-e,i+2*e,o+2*e),a.drawImage(t,0,0,i,o),a.getImageData(-e,-e,i+2*e,o+2*e)},resolveURL:t=>(rr||(rr=document.createElement("a")),rr.href=t,rr.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(ln==null&&(ln=window.matchMedia("(prefers-reduced-motion: reduce)")),ln.matches)},hasCanvasFingerprintNoise(){if(Vo!==void 0)return Vo;if(!Cl())return Vo=!1,!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let i=0;for(let a=0;a<t.width;++a)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(a,0,1,1);const o=e.getImageData(0,0,t.width,t.height);i=0;for(let a=0;a<o.data.length;++a)if(a%4!=3&&i++!==o.data[a])return Vo=!0,!0;return Vo=!1,!1}};function Va(t,e){const i=t.indexOf("?");if(i<0)return`${t}?${new URLSearchParams(e).toString()}`;const o=new URLSearchParams(t.slice(i));for(const a in e)o.set(a,e[a]);return`${t.slice(0,i)}?${o.toString()}`}function xa(t,e={persistentParams:[]}){const i=t.indexOf("?");if(i<0)return t;const o=new URLSearchParams,a=new URLSearchParams(t.slice(i));for(const f of e.persistentParams){const x=a.get(f);x&&o.set(f,x)}const h=o.toString();return`${t.slice(0,i)}${h.length>0?`?${h}`:""}`}const Kl="mapbox-tiles";let qs=500,tu=50,Ko,Ua;function ns(){try{return caches}catch{}}function ol(){const t=ns();t&&!Ko&&(Ko=t.open(Kl))}let us=1/0;const sl={supported:!1,testSupport:function(t){!Ca&&ba&&(Ts?El(t):wa=t)}};let wa,ba,Ca=!1,Ts=!1;const Ic=typeof self<"u"?self:{};function El(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ba),t.isContextLost())return;sl.supported=!0}catch{}t.deleteTexture(e),Ca=!0}Ic.document&&(ba=Ic.document.createElement("img"),ba.onload=function(){wa&&El(wa),wa=null,Ts=!0},ba.onerror=function(){Ca=!0,wa=null},ba.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ea={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ea);class Zn extends Error{constructor(e,i,o){i===401&&se(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ja=Mr()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Te=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(ja())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,a){const h=new AbortController,f=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:ja(),referrerPolicy:o.referrerPolicy,signal:h.signal});let x=!1,w=!1;const S=(P=f.url).indexOf("sku=")>0&&se(P);var P;o.type==="json"&&f.headers.set("Accept","application/json");const R=(H,$,te)=>{if(w)return;if(H&&H.message!=="SecurityError"&&Dr(H.toString()),$&&te)return B($);const ne=Date.now();fetch(f).then(de=>{if(de.ok){const Se=S?de.clone():null;return B(de,Se,ne)}return a(new Zn(de.statusText,de.status,o.url))}).catch(de=>{de.name!=="AbortError"&&a(new Error(`${de.message} ${o.url}`))})},B=(H,$,te)=>{(o.type==="arrayBuffer"?H.arrayBuffer():o.type==="json"?H.json():H.text()).then(ne=>{w||($&&te&&function(de,Se,Me){if(ol(),!Ko)return;const Le=Fa(Se.headers.get("Cache-Control")||"");if(Le["no-store"])return;const ze={status:Se.status,statusText:Se.statusText,headers:new Headers};Se.headers.forEach((et,st)=>ze.headers.set(st,et)),Le["max-age"]&&ze.headers.set("Expires",new Date(Me+1e3*Le["max-age"]).toUTCString());const Fe=ze.headers.get("Expires");if(!Fe||new Date(Fe).getTime()-Me<42e4)return;let Xe=xa(de.url,{persistentParams:["language","worldview"]});if(Se.status===206){const et=de.headers.get("Range");if(!et)return;ze.status=200,Xe=Va(Xe,{range:et})}(function(et,st){if(Ua===void 0)try{new Response(new ReadableStream),Ua=!0}catch{Ua=!1}Ua?st(et.body):et.blob().then(st)})(Se,et=>{const st=new Response((_t=Se.status)!==200&&_t!==404&&[101,103,204,205,304].includes(_t)?null:et,ze);var _t;ol(),Ko&&Ko.then(dt=>dt.put(Xe,st)).catch(dt=>Dr(dt.message))})}(f,$,te),x=!0,a(null,ne,H.headers.get("Cache-Control"),H.headers.get("Expires")))}).catch(ne=>{w||a(new Error(ne.message))})};return S?function(H,$){if(ol(),!Ko)return $(null);Ko.then(te=>{let ne=xa(H.url,{persistentParams:["language","worldview"]});const de=H.headers.get("Range");de&&(ne=Va(ne,{range:de})),te.match(ne).then(Se=>{const Me=function(Le){if(!Le)return!1;const ze=new Date(Le.headers.get("Expires")||0),Fe=Fa(Le.headers.get("Cache-Control")||"");return ze>Date.now()&&!Fe["no-cache"]}(Se);te.delete(ne),Me&&te.put(ne,Se.clone()),$(null,Se,Me)}).catch($)}).catch($)}(f,R):R(null,null),{cancel:()=>{w=!0,x||h.abort()}}}(t,e);if(Mr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(o,a){const h=new XMLHttpRequest;h.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const f in o.headers)h.setRequestHeader(f,o.headers[f]);return o.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=o.credentials==="include",h.onerror=()=>{a(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let f=h.response;if(o.type==="json")try{f=JSON.parse(h.response)}catch(x){return a(x)}a(null,f,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else a(new Zn(h.statusText,h.status,o.url))},h.send(o.body),{cancel:()=>h.abort()}}(t,e)},c=function(t,e){return Te(An(t,{type:"arrayBuffer"}),e)};function m(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const v="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let C,I;C=[],I=0;const L=function(t,e){if(sl.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),I>=Y.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return C.push(h),h}I++;let i=!1;const o=()=>{if(!i)for(i=!0,I--;C.length&&I<Y.MAX_PARALLEL_IMAGE_REQUESTS;){const h=C.shift(),{requestParameters:f,callback:x,cancelled:w}=h;w||(h.cancel=L(f,x).cancel)}},a=c(t,(h,f,x,w)=>{o(),h?e(h):f&&(self.createImageBitmap?function(S,P){const R=new Blob([new Uint8Array(S)],{type:"image/png"});createImageBitmap(R).then(B=>{P(null,B)}).catch(B=>{P(new Error(`Could not load image because of ${B.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(S,P)=>e(S,P,x,w)):function(S,P){const R=new Image;R.onload=()=>{P(null,R),URL.revokeObjectURL(R.src),R.onload=null,requestAnimationFrame(()=>{R.src=v})},R.onerror=()=>P(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new Blob([new Uint8Array(S)],{type:"image/png"});R.src=S.byteLength?URL.createObjectURL(B):v}(f,(S,P)=>e(S,P,x,w)))});return{cancel:()=>{a.cancel(),o()}}},k="01",j="NO_ACCESS_TOKEN",J=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function pe(t){const e=t.match(J);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Ie(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const Ne="mapbox.eventData";function Ye(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class at{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=Ye(Y.ACCESS_TOKEN);let o="";return o=i&&i.u?btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(a,h)=>String.fromCharCode(+("0x"+h)))):Y.ACCESS_TOKEN||"",e?`${Ne}.${e}:${o}`:`${Ne}:${o}`}fetchEventData(){const e=Ac("localStorage"),i=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{const a=localStorage.getItem(i);a&&(this.eventData=JSON.parse(a));const h=localStorage.getItem(o);h&&(this.anonId=h)}catch{Dr("Unable to read from LocalStorage")}}saveEventData(){const e=Ac("localStorage"),i=this.getStorageKey(),o=this.getStorageKey("uuid"),a=this.anonId;if(e&&a)try{localStorage.setItem(o,a),Object.keys(this.eventData).length>=1&&localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Dr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,o,a){if(!Y.EVENTS_URL)return;const h=pe(Y.EVENTS_URL);h.params.push(`access_token=${a||Y.ACCESS_TOKEN||""}`);const f={event:this.type,created:new Date(e).toISOString()},x=i?An(f,i):f,w={url:Ie(h),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=function(S,P){return Te(An(S,{method:"POST"}),P)}(w,S=>{this.pendingRequest=null,o(S),this.saveEventData(),this.processRequests(a)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const ut=new class extends at{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){Y.EVENTS_URL&&Y.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>Ae(i)||se(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Ye(Y.ACCESS_TOKEN),i=e?e.u:Y.ACCESS_TOKEN;let o=i!==this.eventData.tokenU;Nt(this.anonId)||(this.anonId=Fs(),o=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const h=new Date(this.eventData.lastSuccess),f=new Date(a),x=(a-this.eventData.lastSuccess)/864e5;o=o||x>=1||x<-1||h.getDate()!==f.getDate()}else o=!0;o?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:U,skuId:k,"enabled.telemetry":!1,userId:this.anonId},h=>{h||(this.eventData.lastSuccess=a,this.eventData.tokenU=i)},t):this.processRequests()}},Et=ut.postTurnstileEvent.bind(ut),Rt=new class extends at{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,o){this.skuToken=e,this.errorCb=o,Y.EVENTS_URL&&(i||Y.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(j)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Nt(this.anonId)||(this.anonId=Fs()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:U,skuId:k,skuToken:this.skuToken,userId:this.anonId},o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},mi=Rt.postMapLoadEvent.bind(Rt),gi=new class extends at{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=Fs(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){const e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){const{map:i,style:o,importedStyles:a}=e;if(!Y.EVENTS_URL||!t&&!Y.ACCESS_TOKEN)return;const h=this.getMapInstanceId(i),f={mapInstanceId:h,eventId:this.getEventId(h),style:o};a.length&&(f.importedStyles=a),this.queueRequest({timestamp:Date.now(),payload:f},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,payload:i}=this.queue.shift();this.postEvent(e,i,()=>{},t)}},ai=gi.postStyleLoadEvent.bind(gi),Xn=new class extends at{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){Y.EVENTS_URL&&(t||Y.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),o=function(a){const h=performance.getEntriesByType("resource"),f=performance.getEntriesByType("mark"),x=function(H){const $={};if(H){for(const te in H)if(te!=="other")for(const ne of H[te]){const de=`${te}ResolveRangeMin`,Se=`${te}ResolveRangeMax`,Me=`${te}RequestCount`,Le=`${te}RequestCachedCount`;$[de]=Math.min($[de]||1/0,ne.startTime),$[Se]=Math.max($[Se]||-1/0,ne.responseEnd);const ze=Fe=>{$[Fe]===void 0&&($[Fe]=0),++$[Fe]};ne.transferSize!==void 0&&ne.transferSize===0&&ze(Le),ze(Me)}}return $}(function(H,$){const te={};if(H)for(const ne of H){const de=$(ne);te[de]===void 0&&(te[de]=[]),te[de].push(ne)}return te}(h,q)),w=window.devicePixelRatio,S=navigator.connection||navigator.mozConnection||navigator.webkitConnection,P=S?S.effectiveType:void 0,R={counters:[],metadata:[],attributes:[]},B=(H,$,te)=>{te!=null&&H.push({name:$,value:te.toString()})};for(const H in x)B(R.counters,H,x[H]);if(a.interactionRange[0]!==1/0&&a.interactionRange[1]!==-1/0&&(B(R.counters,"interactionRangeMin",a.interactionRange[0]),B(R.counters,"interactionRangeMax",a.interactionRange[1])),f)for(const H of Object.keys(N)){const $=N[H],te=f.find(ne=>ne.name===$);te&&B(R.counters,$,te.startTime)}return B(R.counters,"visibilityHidden",a.visibilityHidden),B(R.attributes,"style",function(H){if(H)for(const $ of H){const te=$.name.split("?")[0];if(K(te)){const ne=te.split("/").slice(-2);if(ne.length===2)return`mapbox://styles/${ne[0]}/${ne[1]}`}}}(h)),B(R.attributes,"terrainEnabled",a.terrainEnabled?"true":"false"),B(R.attributes,"fogEnabled",a.fogEnabled?"true":"false"),B(R.attributes,"projection",a.projection),B(R.attributes,"zoom",a.zoom),B(R.metadata,"devicePixelRatio",w),B(R.metadata,"connectionEffectiveType",P),B(R.metadata,"navigatorUserAgent",navigator.userAgent),B(R.metadata,"screenWidth",window.screen.width),B(R.metadata,"screenHeight",window.screen.height),B(R.metadata,"windowWidth",window.innerWidth),B(R.metadata,"windowHeight",window.innerHeight),B(R.metadata,"mapWidth",a.width/w),B(R.metadata,"mapHeight",a.height/w),B(R.metadata,"webglRenderer",a.renderer),B(R.metadata,"webglVendor",a.vendor),B(R.metadata,"sdkVersion",U),B(R.metadata,"sdkIdentifier","mapbox-gl-js"),R}(i);for(const a of o.metadata);for(const a of o.counters);for(const a of o.attributes);this.postEvent(e,o,()=>{},t)}},wn=Xn.postPerformanceEvent.bind(Xn),yo=new class extends at{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,o){if(!Y.API_URL||!Y.SESSION_PATH)return;const a=pe(Y.API_URL+Y.SESSION_PATH);a.params.push(`sku=${e||""}`),a.params.push(`access_token=${o||Y.ACCESS_TOKEN||""}`);const h={url:Ie(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(f,x){return Te(An(f,{method:"GET"}),x)}(h,f=>{this.pendingRequest=null,i(f),this.saveEventData(),this.processRequests(o)})}getSessionAPI(t,e,i,o){this.skuToken=e,this.errorCb=o,Y.SESSION_PATH&&Y.API_URL&&(i||Y.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(j)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},Ss=yo.getSessionAPI.bind(yo),Yr=new Set;var fr={exports:{}},Uo={exports:function(t,e){var i,o,a,h,f,x,w,S;for(o=t.length-(i=3&t.length),a=e,f=3432918353,x=461845907,S=0;S<o;)w=255&t.charCodeAt(S)|(255&t.charCodeAt(++S))<<8|(255&t.charCodeAt(++S))<<16|(255&t.charCodeAt(++S))<<24,++S,a=27492+(65535&(h=5*(65535&(a=(a^=w=(65535&(w=(w=(65535&w)*f+(((w>>>16)*f&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295)<<13|a>>>19))+((5*(a>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(w=0,i){case 3:w^=(255&t.charCodeAt(S+2))<<16;case 2:w^=(255&t.charCodeAt(S+1))<<8;case 1:a^=w=(65535&(w=(w=(65535&(w^=255&t.charCodeAt(S)))*f+(((w>>>16)*f&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295}return a^=t.length,a=2246822507*(65535&(a^=a>>>16))+((2246822507*(a>>>16)&65535)<<16)&4294967295,a=3266489909*(65535&(a^=a>>>13))+((3266489909*(a>>>16)&65535)<<16)&4294967295,(a^=a>>>16)>>>0}},ys={exports:function(t,e){for(var i,o=t.length,a=e^o,h=0;o>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(h)|(255&t.charCodeAt(++h))<<8|(255&t.charCodeAt(++h))<<16|(255&t.charCodeAt(++h))<<24))+((1540483477*(i>>>16)&65535)<<16),a=1540483477*(65535&a)+((1540483477*(a>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),o-=4,++h;switch(o){case 3:a^=(255&t.charCodeAt(h+2))<<16;case 2:a^=(255&t.charCodeAt(h+1))<<8;case 1:a=1540483477*(65535&(a^=255&t.charCodeAt(h)))+((1540483477*(a>>>16)&65535)<<16)}return a=1540483477*(65535&(a^=a>>>13))+((1540483477*(a>>>16)&65535)<<16),(a^=a>>>15)>>>0}},ta=Uo.exports,ia=ys.exports;fr.exports=ta,fr.exports.murmur3=ta,fr.exports.murmur2=ia;var Tl=G(fr.exports);class vs{constructor(e,...i){An(this,i[0]||{}),this.type=e}}class qa extends vs{constructor(e,i={}){super("error",An({error:e},i))}}function Bh(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function iu(t,e,i){if(i&&i[t]){const o=i[t].indexOf(e);o!==-1&&i[t].splice(o,1)}}class al{on(e,i){return this._listeners=this._listeners||{},Bh(e,i,this._listeners),this}off(e,i){return iu(e,i,this._listeners),iu(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Bh(e,i,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,i){const o=typeof e=="string"?new vs(e,i):e,a=o.type;if(this.listens(a)){o.target=this;const h=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const w of h)w.call(this,o);const f=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const w of f)iu(a,w,this._oneTimeListeners),w.call(this,o);const x=this._eventedParent;x&&(An(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(o))}else o instanceof qa&&console.error(o.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}r.F=void 0;var Nh={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function nu(t){return(t=Math.round(t))<0?0:t>255?255:t}function ru(t){return nu(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Sl(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Mc(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{r.F={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in Nh)return Nh[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var o=i.indexOf("("),a=i.indexOf(")");if(o!==-1&&a+1===i.length){var h=i.substr(0,o),f=i.substr(o+1,a-(o+1)).split(","),x=1;switch(h){case"rgba":if(f.length!==4)return null;x=Sl(f.pop());case"rgb":return f.length!==3?null:[ru(f[0]),ru(f[1]),ru(f[2]),x];case"hsla":if(f.length!==4)return null;x=Sl(f.pop());case"hsl":if(f.length!==3)return null;var w=(parseFloat(f[0])%360+360)%360/360,S=Sl(f[1]),P=Sl(f[2]),R=P<=.5?P*(S+1):P+S-P*S,B=2*P-R;return[nu(255*Mc(B,R,w+1/3)),nu(255*Mc(B,R,w)),nu(255*Mc(B,R,w-1/3)),x];default:return null}}return null}}catch{}class kn{constructor(e,i,o,a=1){this.r=e,this.g=i,this.b=o,this.a=a}static parse(e){if(!e)return;if(e instanceof kn)return e;if(typeof e!="string")return;const i=r.F(e);return i?new kn(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,o,a]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(o)},${a})`}toRenderColor(e){const{r:i,g:o,b:a,a:h}=this;return new $d(e,i,o,a,h)}}class $d{constructor(e,i,o,a,h){if(e){const f=e.image.height,x=f*f;i=h===0?0:i/h*(f-1),o=h===0?0:o/h*(f-1),a=h===0?0:a/h*(f-1);const w=Math.floor(i),S=Math.floor(o),P=Math.floor(a),R=Math.ceil(i),B=Math.ceil(o),H=Math.ceil(a),$=i-w,te=o-S,ne=a-P,de=e.image.data,Se=4*(w+S*x+P*f),Me=4*(w+S*x+H*f),Le=4*(w+B*x+P*f),ze=4*(w+B*x+H*f),Fe=4*(R+S*x+P*f),Xe=4*(R+S*x+H*f),et=4*(R+B*x+P*f),st=4*(R+B*x+H*f);if(Se<0||st>=de.length)throw new Error("out of range");this.r=Fi(Fi(Fi(de[Se],de[Me],ne),Fi(de[Le],de[ze],ne),te),Fi(Fi(de[Fe],de[Xe],ne),Fi(de[et],de[st],ne),te),$)/255*h,this.g=Fi(Fi(Fi(de[Se+1],de[Me+1],ne),Fi(de[Le+1],de[ze+1],ne),te),Fi(Fi(de[Fe+1],de[Xe+1],ne),Fi(de[et+1],de[st+1],ne),te),$)/255*h,this.b=Fi(Fi(Fi(de[Se+2],de[Me+2],ne),Fi(de[Le+2],de[ze+2],ne),te),Fi(Fi(de[Fe+2],de[Xe+2],ne),Fi(de[et+2],de[st+2],ne),te),$)/255*h,this.a=h}else this.r=i,this.g=o,this.b=a,this.a=h}toArray(){const{r:e,g:i,b:o,a}=this;return a===0?[0,0,0,0]:[255*e/a,255*i/a,255*o/a,a]}toArray01(){const{r:e,g:i,b:o,a}=this;return a===0?[0,0,0,0]:[e/a,i/a,o/a,a]}toArray01Scaled(e){const{r:i,g:o,b:a,a:h}=this;return h===0?[0,0,0]:[i/h*e,o/h*e,a/h*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:o,a}=this;return[e,i,o,a]}toArray01Linear(){const{r:e,g:i,b:o,a}=this;return a===0?[0,0,0,0]:[Math.pow(e/a,2.2),Math.pow(i/a,2.2),Math.pow(o/a,2.2),a]}}function Fi(t,e,i){return t*(1-i)+e*i}function Fh(t,e,i){return t.map((o,a)=>Fi(o,e[a],i))}kn.black=new kn(0,0,0,1),kn.white=new kn(1,1,1,1),kn.transparent=new kn(0,0,0,0),kn.red=new kn(1,0,0,1),kn.blue=new kn(0,0,1,1);var Lc=Object.freeze({__proto__:null,array:Fh,color:function(t,e,i){return new kn(Fi(t.r,e.r,i),Fi(t.g,e.g,i),Fi(t.b,e.b,i),Fi(t.a,e.a,i))},number:Fi});function Qu(t,...e){for(const i of e)for(const o in i)t[o]=i[o];return t}class Ea extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Ju{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,a]of i)this.bindings[o]=a}concat(e){return new Ju(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const na={kind:"null"},ci={kind:"number"},Bn={kind:"string"},In={kind:"boolean"},Hs={kind:"color"},Ql={kind:"object"},sn={kind:"value"},Jl={kind:"collator"},Ta={kind:"formatted"},ec={kind:"resolvedImage"};function As(t,e){return{kind:"array",itemType:t,N:e}}function no(t){if(t.kind==="array"){const e=no(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const Zd=[na,ci,Bn,In,Hs,Ta,Ql,As(sn),ec];function tc(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!tc(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const i of Zd)if(!tc(i,e))return null}}return`Expected ${no(t)} but found ${no(e)} instead.`}function ou(t,e){return e.some(i=>i.kind===t.kind)}function Al(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}class ic{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Is{constructor(e,i,o,a,h){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=o,this.fontStack=a,this.textColor=h}}class vo{constructor(e){this.sections=e}static fromString(e){return new vo([new Is(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof vo?e:vo.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);const o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toRenderColor(null).toArray())),e.push(o)}return e}}class pr{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,i){return e?new pr({namePrimary:e,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function ra(t,e,i,o){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[t,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[t,e,i,o]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function nc(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof kn||t instanceof ic||t instanceof vo||t instanceof pr)return!0;if(Array.isArray(t)){for(const e of t)if(!nc(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!nc(t[e]))return!1;return!0}return!1}function lo(t){if(t===null)return na;if(typeof t=="string")return Bn;if(typeof t=="boolean")return In;if(typeof t=="number")return ci;if(t instanceof kn)return Hs;if(t instanceof ic)return Jl;if(t instanceof vo)return Ta;if(t instanceof pr)return ec;if(Array.isArray(t)){const e=t.length;let i;for(const o of t){const a=lo(o);if(i){if(i===a)continue;i=sn;break}i=a}return As(i||sn,e)}return Ql}function oa(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof kn||t instanceof vo||t instanceof pr?t.toString():JSON.stringify(t)}class Ha{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!nc(e[1]))return i.error("invalid value");const o=e[1];let a=lo(o);const h=i.expectedType;return a.kind!=="array"||a.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(a=h),new Ha(a,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof kn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof vo?this.value.serialize():this.value}}class Io{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const eh={string:Bn,number:ci,boolean:In,object:Ql};class sa{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,a=1;const h=e[0];if(h==="array"){let x,w;if(e.length>2){const S=e[1];if(typeof S!="string"||!(S in eh)||S==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=eh[S],a++}else x=sn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);w=e[2],a++}o=As(x,w)}else o=eh[h];const f=[];for(;a<e.length;a++){const x=i.parse(e[a],a,sn);if(!x)return null;f.push(x)}return new sa(o,f)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!tc(this.type,lo(o)))return o;if(i===this.args.length-1)throw new Io(`Expected value to be of type ${no(this.type)}, but found ${no(lo(o))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);const a=e.N;(typeof a=="number"||this.args.length>1)&&i.push(a)}}return i.concat(this.args.map(o=>o.serialize()))}}class rc{constructor(e){this.type=Ta,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const a=[];let h=!1;for(let f=1;f<=e.length-1;++f){const x=e[f];if(h&&typeof x=="object"&&!Array.isArray(x)){h=!1;let w=null;if(x["font-scale"]&&(w=i.parse(x["font-scale"],1,ci),!w))return null;let S=null;if(x["text-font"]&&(S=i.parse(x["text-font"],1,As(Bn)),!S))return null;let P=null;if(x["text-color"]&&(P=i.parse(x["text-color"],1,Hs),!P))return null;const R=a[a.length-1];R.scale=w,R.font=S,R.textColor=P}else{const w=i.parse(e[f],1,sn);if(!w)return null;const S=w.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,a.push({content:w,scale:null,font:null,textColor:null})}}return new rc(a)}evaluate(e){return new vo(this.sections.map(i=>{const o=i.content.evaluate(e);return lo(o)===ec?new Is("",o,null,null,null):new Is(oa(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),e.push(o)}return e}}class oc{constructor(e,i){this.type=ec,this.inputPrimary=e,this.inputSecondary=i}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");const o=i.parse(e[1],1,Bn);if(!o)return i.error("No image name provided.");if(e.length===2)return new oc(o);const a=i.parse(e[2],1,Bn);return a?new oc(o,a):i.error("Secondary image variant is not a string.")}evaluate(e){const i=pr.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Sa(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}const be={"to-boolean":In,"to-color":Hs,"to-number":ci,"to-string":Bn};class Z{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0],a=[];let h=na;if(o==="to-array"){if(!Array.isArray(e[1]))return null;const f=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);h=As(i.expectedType.itemType,f)}else{if(!(f>0&&nc(e[1][0])))return null;h=As(lo(e[1][0]),f)}for(let x=0;x<f;x++){const w=e[1][x];let S;if(Sa(w)==="array")S=i.parse(w,void 0,h.itemType);else{const P=Sa(w);if(P!==h.itemType.kind)return i.error(`Expected ${h.itemType.kind} but found ${P}.`);S=i.registry.literal.parse(["literal",w===void 0?null:w],i)}if(!S)return null;a.push(S)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");h=be[o];for(let f=1;f<e.length;f++){const x=i.parse(e[f],f,sn);if(!x)return null;a.push(x)}}return new Z(h,a)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,o;for(const a of this.args){if(i=a.evaluate(e),o=null,i instanceof kn)return i;if(typeof i=="string"){const h=e.parseColor(i);if(h)return h}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:ra(i[0],i[1],i[2],i[3]),!o))return new kn(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Io(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const a=Number(i);if(!isNaN(a))return a}throw new Io(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?vo.fromString(oa(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?pr.fromString(oa(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):oa(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new rc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new oc(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const oe=["Unknown","Point","LineString","Polygon"];class we{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?oe[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:o,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*i-e[0])+this.featureDistanceData.bearing[1]*(a*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=kn.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class tt{constructor(e,i,o,a,h){this.name=e,this.type=i,this._evaluate=o,this.args=a,this._overloadIndex=h}evaluate(e){if(!this._evaluate){const i=tt.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const o=e[0],a=tt.definitions[o];if(!a)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(a)?a[0]:a.type,f=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,x=[];let w=null,S=-1;for(const[P,R]of f){if(Array.isArray(P)&&P.length!==e.length-1)continue;x.push(P),S++,w=new Gh(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const B=[];let H=!1;for(let $=1;$<e.length;$++){const te=e[$],ne=Array.isArray(P)?P[$-1]:P.type,de=w.parse(te,1+B.length,ne);if(!de){H=!0;break}B.push(de)}if(!H)if(Array.isArray(P)&&P.length!==B.length)w.error(`Expected ${P.length} arguments, but found ${B.length} instead.`);else{for(let $=0;$<B.length;$++){const te=Array.isArray(P)?P[$]:P.type,ne=B[$];w.concat($+1).checkSubtype(te,ne.type)}if(w.errors.length===0)return new tt(o,h,R,B,S)}}if(x.length===1)i.errors.push(...w.errors);else{const P=(x.length?x:f.map(([B])=>B)).map(Ft).join(" | "),R=[];for(let B=1;B<e.length;B++){const H=i.parse(e[B],1+R.length);if(!H)return null;R.push(no(H.type))}i.error(`Expected arguments of type ${P}, but found (${R.join(", ")}) instead.`)}return null}static register(e,i){tt.definitions=i;for(const o in i)e[o]=tt}}function Ft(t){return Array.isArray(t)?`(${t.map(no).join(", ")})`:`(${no(t.type)}...)`}class Li{constructor(e,i,o){this.type=Jl,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const a=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,In);if(!a)return null;const h=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,In);if(!h)return null;let f=null;return o.locale&&(f=i.parse(o.locale,1,Bn),!f)?null:new Li(a,h,f)}evaluate(e){return new ic(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function zn(t,e,i=0,o=t.length-1,a=po){for(;o>i;){if(o-i>600){const w=o-i+1,S=e-i+1,P=Math.log(w),R=.5*Math.exp(2*P/3),B=.5*Math.sqrt(P*R*(w-R)/w)*(S-w/2<0?-1:1);zn(t,e,Math.max(i,Math.floor(e-S*R/w+B)),Math.min(o,Math.floor(e+(w-S)*R/w+B)),a)}const h=t[e];let f=i,x=o;for(bn(t,i,e),a(t[o],h)>0&&bn(t,i,o);f<x;){for(bn(t,f,x),f++,x--;a(t[f],h)<0;)f++;for(;a(t[x],h)>0;)x--}a(t[i],h)===0?bn(t,i,x):(x++,bn(t,x,o)),x<=e&&(i=x+1),e<=x&&(o=x-1)}}function bn(t,e,i){const o=t[e];t[e]=t[i],t[i]=o}function po(t,e){return t<e?-1:t>e?1:0}function sc(t){let e=0;for(let i,o,a=0,h=t.length,f=h-1;a<h;f=a++)i=t[a],o=t[f],e+=(o.x-i.x)*(i.y+o.y);return e}function th(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function ih(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Np(t,e,i){const o=t[0]-e[0],a=t[1]-e[1],h=t[0]-i[0],f=t[1]-i[1];return o*f-h*a==0&&o*h<=0&&a*f<=0}function Mn(t,e,i=!1){let o=!1;for(let x=0,w=e.length;x<w;x++){const S=e[x];for(let P=0,R=S.length,B=R-1;P<R;B=P++){const H=S[B],$=S[P];if(Np(t,H,$))return i;(h=H)[1]>(a=t)[1]!=(f=$)[1]>a[1]&&a[0]<(f[0]-h[0])*(a[1]-h[1])/(f[1]-h[1])+h[0]&&(o=!o)}}var a,h,f;return o}function Xd(t,e,i,o){const a=o[0]-i[0],h=o[1]-i[1],f=(t[0]-i[0])*h-a*(t[1]-i[1]),x=(e[0]-i[0])*h-a*(e[1]-i[1]);return f>0&&x<0||f<0&&x>0}function nh(t,e,i,o){return(a=[o[0]-i[0],o[1]-i[1]])[0]*(h=[e[0]-t[0],e[1]-t[1]])[1]-a[1]*h[0]!=0&&!(!Xd(t,e,i,o)||!Xd(i,o,t,e));var a,h}const ac=8192;function a0(t,e){const i=(180+t[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(i*a*ac),Math.round(o*a*ac)]}function zh(t,e){for(let i=0;i<e.length;i++)if(Mn(t,e[i]))return!0;return!1}function Vh(t,e,i){for(const o of i)for(let a=0,h=o.length,f=h-1;a<h;f=a++)if(nh(t,e,o[f],o[a]))return!0;return!1}function rh(t,e){for(let i=0;i<t.length;++i)if(!Mn(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Vh(t[i],t[i+1],e))return!1;return!0}function l0(t,e){for(let i=0;i<e.length;i++)if(rh(t,e[i]))return!0;return!1}function Uh(t,e,i){const o=[];for(let a=0;a<t.length;a++){const h=[];for(let f=0;f<t[a].length;f++){const x=a0(t[a][f],i);th(e,x),h.push(x)}o.push(h)}return o}function Ga(t,e,i){const o=[];for(let a=0;a<t.length;a++){const h=Uh(t[a],e,i);o.push(h)}return o}function Fp(t,e,i,o){if(t[0]<i[0]||t[0]>i[2]){const a=.5*o;let h=t[0]-i[0]>a?-o:i[0]-t[0]>a?o:0;h===0&&(h=t[0]-i[2]>a?-o:i[2]-t[0]>a?o:0),t[0]+=h}th(e,t)}function Yd(t,e,i,o){const a=Math.pow(2,o.z)*ac,h=[o.x*ac,o.y*ac],f=[];if(!t)return f;for(const x of t)for(const w of x){const S=[w.x+h[0],w.y+h[1]];Fp(S,e,i,a),f.push(S)}return f}function su(t,e,i,o){const a=Math.pow(2,o.z)*ac,h=[o.x*ac,o.y*ac],f=[];if(!t)return f;for(const w of t){const S=[];for(const P of w){const R=[P.x+h[0],P.y+h[1]];th(e,R),S.push(R)}f.push(S)}if(e[2]-e[0]<=a/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const w of f)for(const S of w)Fp(S,e,i,a)}var x;return f}class Il{constructor(e,i){this.type=In,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(nc(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let a=0;a<o.features.length;++a){const h=o.features[a].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Il(o,o.features[a].geometry)}else if(o.type==="Feature"){const a=o.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new Il(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Il(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){const a=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const x=Uh(o.coordinates,h,f),w=Yd(i.geometry(),a,h,f);if(!ih(a,h))return!1;for(const S of w)if(!Mn(S,x))return!1}if(o.type==="MultiPolygon"){const x=Ga(o.coordinates,h,f),w=Yd(i.geometry(),a,h,f);if(!ih(a,h))return!1;for(const S of w)if(!zh(S,x))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){const a=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const x=Uh(o.coordinates,h,f),w=su(i.geometry(),a,h,f);if(!ih(a,h))return!1;for(const S of w)if(!rh(S,x))return!1}if(o.type==="MultiPolygon"){const x=Ga(o.coordinates,h,f),w=su(i.geometry(),a,h,f);if(!ih(a,h))return!1;for(const S of w)if(!l0(S,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const jh={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},zp=1/298.257223563,Vp=zp*(2-zp),au=Math.PI/180;class Oc{static fromTile(e,i,o){const a=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),h=Math.atan(.5*(Math.exp(a)-Math.exp(-a)))/au;return new Oc(h,o)}static get units(){return jh}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!jh[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(jh).join(", ")}`);const o=6378.137*au*(i?jh[i]:1),a=Math.cos(e*au),h=1/(1-Vp*(1-a*a)),f=Math.sqrt(h);this.kx=o*f*a,this.ky=o*f*h*(1-Vp)}distance(e,i){const o=Aa(e[0]-i[0])*this.kx,a=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+a*a)}bearing(e,i){const o=Aa(i[0]-e[0])*this.kx;return Math.atan2(o,(i[1]-e[1])*this.ky)/au}destination(e,i,o){const a=o*au;return this.offset(e,Math.sin(a)*i,Math.cos(a)*i)}offset(e,i,o){return[e[0]+i/this.kx,e[1]+o/this.ky]}lineDistance(e){let i=0;for(let o=0;o<e.length-1;o++)i+=this.distance(e[o],e[o+1]);return i}area(e){let i=0;for(let o=0;o<e.length;o++){const a=e[o];for(let h=0,f=a.length,x=f-1;h<f;x=h++)i+=Aa(a[h][0]-a[x][0])*(a[h][1]+a[x][1])*(o?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let o=0;if(i<=0)return e[0];for(let a=0;a<e.length-1;a++){const h=e[a],f=e[a+1],x=this.distance(h,f);if(o+=x,o>i)return lu(h,f,(i-(o-x))/x)}return e[e.length-1]}pointToSegmentDistance(e,i,o){let[a,h]=i,f=Aa(o[0]-a)*this.kx,x=(o[1]-h)*this.ky;if(f!==0||x!==0){const w=(Aa(e[0]-a)*this.kx*f+(e[1]-h)*this.ky*x)/(f*f+x*x);w>1?(a=o[0],h=o[1]):w>0&&(a+=f/this.kx*w,h+=x/this.ky*w)}return f=Aa(e[0]-a)*this.kx,x=(e[1]-h)*this.ky,Math.sqrt(f*f+x*x)}pointOnLine(e,i){let o=1/0,a=e[0][0],h=e[0][1],f=0,x=0;for(let w=0;w<e.length-1;w++){let S=e[w][0],P=e[w][1],R=Aa(e[w+1][0]-S)*this.kx,B=(e[w+1][1]-P)*this.ky,H=0;R===0&&B===0||(H=(Aa(i[0]-S)*this.kx*R+(i[1]-P)*this.ky*B)/(R*R+B*B),H>1?(S=e[w+1][0],P=e[w+1][1]):H>0&&(S+=R/this.kx*H,P+=B/this.ky*H)),R=Aa(i[0]-S)*this.kx,B=(i[1]-P)*this.ky;const $=R*R+B*B;$<o&&(o=$,a=S,h=P,f=w,x=H)}return{point:[a,h],index:f,t:Math.max(0,Math.min(1,x))}}lineSlice(e,i,o){let a=this.pointOnLine(o,e),h=this.pointOnLine(o,i);if(a.index>h.index||a.index===h.index&&a.t>h.t){const S=a;a=h,h=S}const f=[a.point],x=a.index+1,w=h.index;!Up(o[x],f[0])&&x<=w&&f.push(o[x]);for(let S=x+1;S<=w;S++)f.push(o[S]);return Up(o[w],h.point)||f.push(h.point),f}lineSliceAlong(e,i,o){let a=0;const h=[];for(let f=0;f<o.length-1;f++){const x=o[f],w=o[f+1],S=this.distance(x,w);if(a+=S,a>e&&h.length===0&&h.push(lu(x,w,(e-(a-S))/S)),a>=i)return h.push(lu(x,w,(i-(a-S))/S)),h;a>e&&h.push(w)}return h}bufferPoint(e,i){const o=i/this.ky,a=i/this.kx;return[e[0]-a,e[1]-o,e[0]+a,e[1]+o]}bufferBBox(e,i){const o=i/this.ky,a=i/this.kx;return[e[0]-a,e[1]-o,e[2]+a,e[3]+o]}insideBBox(e,i){return Aa(e[0]-i[0])>=0&&Aa(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function Up(t,e){return t[0]===e[0]&&t[1]===e[1]}function lu(t,e,i){const o=Aa(e[0]-t[0]);return[t[0]+o*i,t[1]+(e[1]-t[1])*i]}function Aa(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}class Kd{constructor(e=[],i=(o,a)=>o<a?-1:o>a?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,a=i[e];for(;e>0;){const h=e-1>>1,f=i[h];if(o(a,f)>=0)break;i[e]=f,e=h}i[e]=a}_down(e){const{data:i,compare:o}=this,a=this.length>>1,h=i[e];for(;e<a;){let f=1+(e<<1);const x=f+1;if(x<this.length&&o(i[x],i[f])<0&&(f=x),o(i[f],h)>=0)break;i[e]=i[f],e=f}i[e]=h}}var Zt=8192;function jp(t,e){return e.dist-t.dist}const Qd=100,Jd=50;function qp(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function oh(t){return t[1]-t[0]+1}function Gs(t,e){const i=t[1]>=t[0]&&t[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function ef(t,e){if(t[0]>t[1])return[null,null];const i=oh(t);if(e){if(i===2)return[t,null];const o=Math.floor(i/2);return[[t[0],t[0]+o],[t[0]+o,t[1]]]}{if(i===1)return[t,null];const o=Math.floor(i/2)-1;return[[t[0],t[0]+o],[t[0]+o+1,t[1]]]}}function Pc(t,e){const i=[1/0,1/0,-1/0,-1/0];if(!Gs(e,t.length))return i;for(let o=e[0];o<=e[1];++o)th(i,t[o]);return i}function cu(t){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<t.length;++i)for(let o=0;o<t[i].length;++o)th(e,t[i][o]);return e}function uu(t,e,i){if(qp(t)||qp(e))return NaN;let o=0,a=0;return t[2]<e[0]&&(o=e[0]-t[2]),t[0]>e[2]&&(o=t[0]-e[2]),t[1]>e[3]&&(a=t[1]-e[3]),t[3]<e[1]&&(a=e[1]-t[3]),i.distance([0,0],[o,a])}function c0(t){return 360*t-180}function u0(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function tf(t,e){const i=Math.pow(2,e.z),o=(t.y/Zt+e.y)/i;return[c0((t.x/Zt+e.x)/i),u0(o)]}function h0(t,e){const i=[];for(let o=0;o<t.length;++o)i.push(tf(t[o],e));return i}function lc(t,e,i){const o=i.pointOnLine(e,t).point;return i.distance(t,o)}function Hp(t,e,i,o,a){const h=i.slice(o[0],o[1]+1);let f=1/0;for(let x=e[0];x<=e[1];++x)if((f=Math.min(f,lc(t[x],h,a)))===0)return 0;return f}function nf(t,e,i,o,a){const h=Math.min(a.pointToSegmentDistance(t,i,o),a.pointToSegmentDistance(e,i,o)),f=Math.min(a.pointToSegmentDistance(i,t,e),a.pointToSegmentDistance(o,t,e));return Math.min(h,f)}function Gp(t,e,i,o,a){if(!Gs(e,t.length)||!Gs(o,i.length))return NaN;let h=1/0;for(let f=e[0];f<e[1];++f)for(let x=o[0];x<o[1];++x){if(nh(t[f],t[f+1],i[x],i[x+1]))return 0;h=Math.min(h,nf(t[f],t[f+1],i[x],i[x+1],a))}return h}function Wp(t,e,i,o,a){if(!Gs(e,t.length)||!Gs(o,i.length))return NaN;let h=1/0;for(let f=e[0];f<=e[1];++f)for(let x=o[0];x<=o[1];++x)if((h=Math.min(h,a.distance(t[f],i[x])))===0)return h;return h}function Wa(t,e,i){if(Mn(t,e,!0))return 0;let o=1/0;for(const a of e){const h=a.length;if(h<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[h-1]&&(o=Math.min(o,i.pointToSegmentDistance(t,a[h-1],a[0])))===0||(o=Math.min(o,lc(t,a,i)))===0)return o}return o}function $p(t,e,i,o){if(!Gs(e,t.length))return NaN;for(let h=e[0];h<=e[1];++h)if(Mn(t[h],i,!0))return 0;let a=1/0;for(let h=e[0];h<e[1];++h)for(const f of i)for(let x=0,w=f.length,S=w-1;x<w;S=x++){if(nh(t[h],t[h+1],f[S],f[x]))return 0;a=Math.min(a,nf(t[h],t[h+1],f[S],f[x],o))}return a}function Zp(t,e){for(const i of t)for(let o=0;o<=i.length-1;++o)if(Mn(i[o],e,!0))return!0;return!1}function Xp(t,e,i,o=1/0){const a=cu(t),h=cu(e);if(o!==1/0&&uu(a,h,i)>=o)return o;if(ih(a,h)){if(Zp(t,e))return 0}else if(Zp(e,t))return 0;let f=o;for(const x of t)for(let w=0,S=x.length,P=S-1;w<S;P=w++)for(const R of e)for(let B=0,H=R.length,$=H-1;B<H;$=B++){if(nh(x[P],x[w],R[$],R[B]))return 0;f=Math.min(f,nf(x[P],x[w],R[$],R[B],i))}return f}function Dc(t,e,i,o,a,h,f){if(h===null||f===null)return;const x=uu(Pc(o,h),Pc(a,f),i);x<e&&t.push({dist:x,range1:h,range2:f})}function d0(t,e,i,o,a=1/0){let h=Math.min(o.distance(t[0],i[0][0]),a);if(h===0)return h;const f=new Kd([{dist:0,range1:[0,t.length-1],range2:[0,0]}],jp),x=e?Jd:Qd,w=cu(i);for(;f.length;){const S=f.pop();if(S.dist>=h)continue;const P=S.range1;if(oh(P)<=x){if(!Gs(P,t.length))return NaN;if(e){const R=$p(t,P,i,o);if((h=Math.min(h,R))===0)return h}else for(let R=P[0];R<=P[1];++R){const B=Wa(t[R],i,o);if((h=Math.min(h,B))===0)return h}}else{const R=ef(P,e);if(R[0]!==null){const B=uu(Pc(t,R[0]),w,o);B<h&&f.push({dist:B,range1:R[0],range2:[0,0]})}if(R[1]!==null){const B=uu(Pc(t,R[1]),w,o);B<h&&f.push({dist:B,range1:R[1],range2:[0,0]})}}}return h}function Yp(t,e,i,o,a,h=1/0){let f=Math.min(h,a.distance(t[0],i[0]));if(f===0)return f;const x=new Kd([{dist:0,range1:[0,t.length-1],range2:[0,i.length-1]}],jp),w=e?Jd:Qd,S=o?Jd:Qd;for(;x.length;){const P=x.pop();if(P.dist>=f)continue;const R=P.range1,B=P.range2;if(oh(R)<=w&&oh(B)<=S){if(!Gs(R,t.length)||!Gs(B,i.length))return NaN;if(e&&o?f=Math.min(f,Gp(t,R,i,B,a)):e||o?e&&!o?f=Math.min(f,Hp(i,B,t,R,a)):!e&&o&&(f=Math.min(f,Hp(t,R,i,B,a))):f=Math.min(f,Wp(t,R,i,B,a)),f===0)return f}else{const H=ef(R,e),$=ef(B,o);Dc(x,f,a,t,i,H[0],$[0]),Dc(x,f,a,t,i,H[0],$[1]),Dc(x,f,a,t,i,H[1],$[0]),Dc(x,f,a,t,i,H[1],$[1])}}return f}function rf(t,e,i,o,a=1/0){let h=a;const f=Pc(t,[0,t.length-1]);for(const x of i)if(!(h!==1/0&&uu(f,Pc(x,[0,x.length-1]),o)>=h)&&(h=Math.min(h,Yp(t,e,x,!0,o,h)),h===0))return h;return h}function qh(t,e,i,o,a=1/0){let h=a;const f=Pc(t,[0,t.length-1]);for(const x of i){if(h!==1/0&&uu(f,cu(x),o)>=h)continue;const w=d0(t,e,x,o,h);if(isNaN(w))return w;if((h=Math.min(h,w))===0)return h}return h}function of(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class ll{constructor(e,i){this.type=ci,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(nc(e[1])){const o=e[1];if(o.type==="FeatureCollection"){for(let a=0;a<o.features.length;++a)if(of(o.features[a].geometry.type))return new ll(o,o.features[a].geometry)}else if(o.type==="Feature"){if(of(o.geometry.type))return new ll(o,o.geometry)}else if(of(o.type))return new ll(o,o)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),o=e.canonicalID();if(i!=null&&o!=null){if(e.geometryType()==="Point")return function(a,h,f){const x=[];for(const S of a)for(const P of S)x.push(tf(P,h));const w=new Oc(x[0][1],"meters");return f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString"?Yp(x,!1,f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",w):f.type==="MultiLineString"?rf(x,!1,f.coordinates,w):f.type==="Polygon"||f.type==="MultiPolygon"?qh(x,!1,f.type==="Polygon"?[f.coordinates]:f.coordinates,w):null}(i,o,this.geometries);if(e.geometryType()==="LineString")return function(a,h,f){const x=[];for(const S of a){const P=[];for(const R of S)P.push(tf(R,h));x.push(P)}const w=new Oc(x[0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return rf(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",x,w);if(f.type==="MultiLineString"){let S=1/0;for(let P=0;P<f.coordinates.length;P++){const R=rf(f.coordinates[P],!0,x,w,S);if(isNaN(R))return R;if((S=Math.min(S,R))===0)return S}return S}if(f.type==="Polygon"||f.type==="MultiPolygon"){let S=1/0;for(let P=0;P<x.length;P++){const R=qh(x[P],!0,f.type==="Polygon"?[f.coordinates]:f.coordinates,w,S);if(isNaN(R))return R;if((S=Math.min(S,R))===0)return S}return S}return null}(i,o,this.geometries);if(e.geometryType()==="Polygon")return function(a,h,f){const x=[];for(const S of function(P,R){const B=P.length;if(B<=1)return[P];const H=[];let $,te;for(let ne=0;ne<B;ne++){const de=sc(P[ne]);de!==0&&(P[ne].area=Math.abs(de),te===void 0&&(te=de<0),te===de<0?($&&H.push($),$=[P[ne]]):$.push(P[ne]))}return $&&H.push($),H}(a)){const P=[];for(let R=0;R<S.length;++R)P.push(h0(S[R],h));x.push(P)}const w=new Oc(x[0][0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return qh(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",x,w);if(f.type==="MultiLineString"){let S=1/0;for(let P=0;P<f.coordinates.length;P++){const R=qh(f.coordinates[P],!0,x,w,S);if(isNaN(R))return R;if((S=Math.min(S,R))===0)return S}return S}return f.type==="Polygon"||f.type==="MultiPolygon"?function(S,P,R){let B=1/0;for(const H of S)for(const $ of P){const te=Xp(H,$,R,B);if(isNaN(te))return te;if((B=Math.min(B,te))===0)return B}return B}(f.type==="Polygon"?[f.coordinates]:f.coordinates,x,w):null}(i,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function hu(t,e){switch(t){case"string":return oa(e);case"number":return+e;case"boolean":return!!e;case"color":return kn.parse(e);case"formatted":return vo.fromString(oa(e));case"resolvedImage":return pr.fromString(oa(e))}return e}function Ws(t,e,i,o){return o!==void 0&&(t=o*Math.round(t/o)),e!==void 0&&t<e&&(t=e),i!==void 0&&t>i&&(t=i),t}class Ml{constructor(e,i,o){this.type=e,this.key=i,this.scope=o}static parse(e,i){let o=i.expectedType;if(o==null&&(o=sn),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const a=i.parse(e[1],1);if(!(a instanceof Ha))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const h=i.parse(e[2],2);return h instanceof Ha?new Ml(o,oa(a.value),oa(h.value)):i.error("Scope of 'config' expression must be a string literal.")}return new Ml(o,oa(a.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),o=e.getConfig(i);if(!o)return null;const{type:a,value:h,values:f,minValue:x,maxValue:w,stepValue:S}=o,P=o.default.evaluate(e);let R=P;if(h){const B=e.scope;e.scope=(B||"").split("").slice(1).join(""),R=h.evaluate(e),e.scope=B}return a&&(R=hu(a,R)),R===void 0||x===void 0&&w===void 0&&S===void 0||(typeof R=="number"?R=Ws(R,x,w,S):Array.isArray(R)&&(R=R.map(B=>typeof B=="number"?Ws(B,x,w,S):B))),h!==void 0&&R!==void 0&&f&&!f.includes(R)&&(R=P,a&&(R=hu(a,R))),(a&&a!==this.type||R!==void 0&&lo(R)!==this.type)&&(R=hu(this.type.kind,R)),R}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function sh(t){if(t instanceof tt&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Il||t instanceof ll)return!1;let e=!0;return t.eachChild(i=>{e&&!sh(i)&&(e=!1)}),e}function Hh(t){if(t instanceof tt&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!Hh(i)&&(e=!1)}),e}function sf(t){if(t instanceof Ml)return!1;let e=!0;return t.eachChild(i=>{e&&!sf(i)&&(e=!1)}),e}function ah(t,e){if(t instanceof tt&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(o=>{i&&!ah(o,e)&&(i=!1)}),i}class du{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new du(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class af{constructor(e,i=[],o,a=new Ju,h=[],f,x){this.registry=e,this.path=i,this.key=i.map(w=>`[${w}]`).join(""),this.scope=a,this.errors=h,this.expectedType=o,this._scope=f,this.options=x}parse(e,i,o,a,h={}){return i||o?this.concat(i,o,a)._parse(e,h):this._parse(e,h)}_parse(e,i){function o(a,h,f){return f==="assert"?new sa(h,[a]):f==="coerce"?new Z(h,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(a){let h=a.parse(e,this);if(!h)return null;if(this.expectedType){const f=this.expectedType,x=h.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||x.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(f,x))return null}else h=o(h,f,i.typeAnnotation||"coerce");else h=o(h,f,i.typeAnnotation||"assert")}if(!(h instanceof Ha)&&h.type.kind!=="resolvedImage"&&lf(h)){const f=new we(this._scope,this.options);try{h=new Ha(h.type,h.evaluate(f))}catch(x){return this.error(x.message),null}}return h}return Z.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o){const a=typeof e=="number"?this.path.concat(e):this.path,h=o?this.scope.concat(o):this.scope;return new af(this.registry,a,i||null,h,this.errors,this._scope,this.options)}error(e,...i){const o=`${this.key}${i.map(a=>`[${a}]`).join("")}`;this.errors.push(new Ea(o,e))}checkSubtype(e,i){const o=tc(e,i);return o&&this.error(o),o}}var Gh=af;function lf(t){if(t instanceof du)return lf(t.boundExpression);if(t instanceof tt&&t.name==="error"||t instanceof Li||t instanceof Il||t instanceof ll||t instanceof Ml)return!1;const e=t instanceof Z||t instanceof sa;let i=!0;return t.eachChild(o=>{i=e?i&&lf(o):i&&o instanceof Ha}),!!i&&sh(t)&&ah(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Wh(t,e){const i=t.length-1;let o,a,h=0,f=i,x=0;for(;h<=f;)if(x=Math.floor((h+f)/2),o=t[x],a=t[x+1],o<=e){if(x===i||e<a)return x;h=x+1}else{if(!(o>e))throw new Io("Input is not a number.");f=x-1}return 0}class Rc{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[a,h]of o)this.labels.push(a),this.outputs.push(h)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,ci);if(!o)return null;const a=[];let h=null;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);for(let f=1;f<e.length;f+=2){const x=f===1?-1/0:e[f],w=e[f+1],S=f,P=f+1;if(typeof x!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(a.length&&a[a.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const R=i.parse(w,P,h);if(!R)return null;h=h||R.type,a.push([x,R])}return new Rc(h,o,a)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return o[0].evaluate(e);const h=i.length;return a>=i[h-1]?o[h-1].evaluate(e):o[Wh(i,a)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const Kp=.95047,cf=1.08883,uf=4/29,fu=6/29,$h=3*fu*fu,Zh=fu*fu*fu,Qp=Math.PI/180,f0=180/Math.PI;function Xh(t){return t>Zh?Math.pow(t,1/3):t/$h+uf}function hf(t){return t>fu?t*t*t:$h*(t-uf)}function lh(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function df(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Jp(t){const e=df(t.r),i=df(t.g),o=df(t.b),a=Xh((.4124564*e+.3575761*i+.1804375*o)/Kp),h=Xh((.2126729*e+.7151522*i+.072175*o)/1);return{l:116*h-16,a:500*(a-h),b:200*(h-Xh((.0193339*e+.119192*i+.9503041*o)/cf)),alpha:t.a}}function em(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,o=isNaN(t.b)?e:e-t.b/200;return e=1*hf(e),i=Kp*hf(i),o=cf*hf(o),new kn(lh(3.2404542*i-1.5371385*e-.4985314*o),lh(-.969266*i+1.8760108*e+.041556*o),lh(.0556434*i-.2040259*e+1.0572252*o),t.alpha)}function p0(t,e,i){const o=e-t;return t+i*(o>180||o<-180?o-360*Math.round(o/360):o)}const pu={forward:Jp,reverse:em,interpolate:function(t,e,i){return{l:Fi(t.l,e.l,i),a:Fi(t.a,e.a,i),b:Fi(t.b,e.b,i),alpha:Fi(t.alpha,e.alpha,i)}}},ch={forward:function(t){const{l:e,a:i,b:o}=Jp(t),a=Math.atan2(o,i)*f0;return{h:a<0?a+360:a,c:Math.sqrt(i*i+o*o),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Qp,i=t.c;return em({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:p0(t.h,e.h,i),c:Fi(t.c,e.c,i),l:Fi(t.l,e.l,i),alpha:Fi(t.alpha,e.alpha,i)}}};var tm=Object.freeze({__proto__:null,hcl:ch,lab:pu});class aa{constructor(e,i,o,a,h){this.type=e,this.operator=i,this.interpolation=o,this.input=a,this.labels=[],this.outputs=[];for(const[f,x]of h)this.labels.push(f),this.outputs.push(x)}static interpolationFactor(e,i,o,a){let h=0;if(e.name==="exponential")h=ff(i,e.base,o,a);else if(e.name==="linear")h=ff(i,1,o,a);else if(e.name==="cubic-bezier"){const f=e.controlPoints;h=new Ns(f[0],f[1],f[2],f[3]).solve(ff(i,1,o,a))}return h}static parse(e,i){let[o,a,h,...f]=e;if(!Array.isArray(a)||a.length===0)return i.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const S=a[1];if(typeof S!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:S}}else{if(a[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const S=a.slice(1);if(S.length!==4||S.some(P=>typeof P!="number"||P<0||P>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(h=i.parse(h,2,ci),!h)return null;const x=[];let w=null;o==="interpolate-hcl"||o==="interpolate-lab"?w=Hs:i.expectedType&&i.expectedType.kind!=="value"&&(w=i.expectedType);for(let S=0;S<f.length;S+=2){const P=f[S],R=f[S+1],B=S+3,H=S+4;if(typeof P!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(x.length&&x[x.length-1][0]>=P)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const $=i.parse(R,H,w);if(!$)return null;w=w||$.type,x.push([P,$])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new aa(w,o,a,h,x):i.error(`Type ${no(w)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return o[0].evaluate(e);const h=i.length;if(a>=i[h-1])return o[h-1].evaluate(e);const f=Wh(i,a),x=aa.interpolationFactor(this.interpolation,a,i[f],i[f+1]),w=o[f].evaluate(e),S=o[f+1].evaluate(e);return this.operator==="interpolate"?Lc[this.type.kind.toLowerCase()](w,S,x):this.operator==="interpolate-hcl"?ch.reverse(ch.interpolate(ch.forward(w),ch.forward(S),x)):pu.reverse(pu.interpolate(pu.forward(w),pu.forward(S),x))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function ff(t,e,i,o){const a=o-i,h=t-i;return a===0?0:e===1?h/a:(Math.pow(e,h)-1)/(Math.pow(e,a)-1)}class Yh{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null;const a=i.expectedType;a&&a.kind!=="value"&&(o=a);const h=[];for(const x of e.slice(1)){const w=i.parse(x,1+h.length,o,void 0,{typeAnnotation:"omit"});if(!w)return null;o=o||w.type,h.push(w)}const f=a&&h.some(x=>tc(a,x.type));return new Yh(f?sn:o,h)}evaluate(e){let i,o=null,a=0;for(const h of this.args){if(a++,o=h.evaluate(e),o&&o instanceof pr&&!o.available&&(i||(i=o),o=null,a===this.args.length))return i;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Kh{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let h=1;h<e.length-1;h+=2){const f=e[h];if(typeof f!="string")return i.error(`Expected string, but found ${typeof f} instead.`,h);if(/[^a-zA-Z0-9_]/.test(f))return i.error("Variable names must contain only alphanumeric characters or '_'.",h);const x=i.parse(e[h+1],h+1);if(!x)return null;o.push([f,x])}const a=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return a?new Kh(o,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,o]of this.bindings)e.push(i,o.serialize());return e.push(this.result.serialize()),e}}class pf{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,ci),a=i.parse(e[2],2,As(i.expectedType||sn));return o&&a?new pf(a.type.itemType,o,a):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new Io(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new Io(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new Io(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class mf{constructor(e,i){this.type=In,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,sn),a=i.parse(e[2],2,sn);return o&&a?ou(o.type,[In,Bn,ci,na,sn])?new mf(o,a):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${no(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!Al(i,["boolean","string","number","null"]))throw new Io(`Expected first argument to be of type boolean, string, number or null, but found ${no(lo(i))} instead.`);if(!Al(o,["string","array"]))throw new Io(`Expected second argument to be of type array or string, but found ${no(lo(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class kc{constructor(e,i,o){this.type=ci,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,sn),a=i.parse(e[2],2,sn);if(!o||!a)return null;if(!ou(o.type,[In,Bn,ci,na,sn]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${no(o.type)} instead`);if(e.length===4){const h=i.parse(e[3],3,ci);return h?new kc(o,a,h):null}return new kc(o,a)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Al(i,["boolean","string","number","null"]))throw new Io(`Expected first argument to be of type boolean, string, number or null, but found ${no(lo(i))} instead.`);if(!Al(o,["string","array"]))throw new Io(`Expected second argument to be of type array or string, but found ${no(lo(o))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return o.indexOf(i,a)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class gf{constructor(e,i,o,a,h,f){this.inputType=e,this.type=i,this.input=o,this.cases=a,this.outputs=h,this.otherwise=f}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const h={},f=[];for(let S=2;S<e.length-1;S+=2){let P=e[S];const R=e[S+1];Array.isArray(P)||(P=[P]);const B=i.concat(S);if(P.length===0)return B.error("Expected at least one branch label.");for(const $ of P){if(typeof $!="number"&&typeof $!="string")return B.error("Branch labels must be numbers or strings.");if(typeof $=="number"&&Math.abs($)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof $=="number"&&Math.floor($)!==$)return B.error("Numeric branch labels must be integer values.");if(o){if(B.checkSubtype(o,lo($)))return null}else o=lo($);if(h[String($)]!==void 0)return B.error("Branch labels must be unique.");h[String($)]=f.length}const H=i.parse(R,S,a);if(!H)return null;a=a||H.type,f.push(H)}const x=i.parse(e[1],1,sn);if(!x)return null;const w=i.parse(e[e.length-1],e.length-1,a);return w?x.type.kind!=="value"&&i.concat(1).checkSubtype(o,x.type)?null:new gf(o,a,x,h,f,w):null}evaluate(e){const i=this.input.evaluate(e);return(lo(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],a={};for(const f of i){const x=a[this.cases[f]];x===void 0?(a[this.cases[f]]=o.length,o.push([this.cases[f],[f]])):o[x][1].push(f)}const h=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,x]of o)e.push(x.length===1?h(x[0]):x.map(h)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}class _f{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const a=[];for(let f=1;f<e.length-1;f+=2){const x=i.parse(e[f],f,In);if(!x)return null;const w=i.parse(e[f+1],f+1,o);if(!w)return null;a.push([x,w]),o=o||w.type}const h=i.parse(e[e.length-1],e.length-1,o);return h?new _f(o,a,h):null}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Bc{constructor(e,i,o,a){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,sn),a=i.parse(e[2],2,ci);if(!o||!a)return null;if(!ou(o.type,[As(sn),Bn,sn]))return i.error(`Expected first argument to be of type array or string, but found ${no(o.type)} instead`);if(e.length===4){const h=i.parse(e[3],3,ci);return h?new Bc(o.type,o,a,h):null}return new Bc(o.type,o,a)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!Al(i,["string","array"]))throw new Io(`Expected first argument to be of type array or string, but found ${no(lo(i))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return i.slice(o,a)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function im(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function yf(t,e,i,o){return o.compare(e,i)===0}function mu(t,e,i){const o=t!=="=="&&t!=="!=";return class V2{constructor(h,f,x){this.type=In,this.lhs=h,this.rhs=f,this.collator=x,this.hasUntypedArgument=h.type.kind==="value"||f.type.kind==="value"}static parse(h,f){if(h.length!==3&&h.length!==4)return f.error("Expected two or three arguments.");const x=h[0];let w=f.parse(h[1],1,sn);if(!w)return null;if(!im(x,w.type))return f.concat(1).error(`"${x}" comparisons are not supported for type '${no(w.type)}'.`);let S=f.parse(h[2],2,sn);if(!S)return null;if(!im(x,S.type))return f.concat(2).error(`"${x}" comparisons are not supported for type '${no(S.type)}'.`);if(w.type.kind!==S.type.kind&&w.type.kind!=="value"&&S.type.kind!=="value")return f.error(`Cannot compare types '${no(w.type)}' and '${no(S.type)}'.`);o&&(w.type.kind==="value"&&S.type.kind!=="value"?w=new sa(S.type,[w]):w.type.kind!=="value"&&S.type.kind==="value"&&(S=new sa(w.type,[S])));let P=null;if(h.length===4){if(w.type.kind!=="string"&&S.type.kind!=="string"&&w.type.kind!=="value"&&S.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(P=f.parse(h[3],3,Jl),!P)return null}return new V2(w,S,P)}evaluate(h){const f=this.lhs.evaluate(h),x=this.rhs.evaluate(h);if(o&&this.hasUntypedArgument){const w=lo(f),S=lo(x);if(w.kind!==S.kind||w.kind!=="string"&&w.kind!=="number")throw new Io(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${w.kind}, ${S.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const w=lo(f),S=lo(x);if(w.kind!=="string"||S.kind!=="string")return e(h,f,x)}return this.collator?i(h,f,x,this.collator.evaluate(h)):e(h,f,x)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[t];return this.eachChild(f=>{h.push(f.serialize())}),h}}}const nm=mu("==",function(t,e,i){return e===i},yf),rm=mu("!=",function(t,e,i){return e!==i},function(t,e,i,o){return!yf(0,e,i,o)}),om=mu("<",function(t,e,i){return e<i},function(t,e,i,o){return o.compare(e,i)<0}),sm=mu(">",function(t,e,i){return e>i},function(t,e,i,o){return o.compare(e,i)>0}),vf=mu("<=",function(t,e,i){return e<=i},function(t,e,i,o){return o.compare(e,i)<=0}),xf=mu(">=",function(t,e,i){return e>=i},function(t,e,i,o){return o.compare(e,i)>=0});class wf{constructor(e,i,o,a,h,f){this.type=Bn,this.number=e,this.locale=i,this.currency=o,this.unit=a,this.minFractionDigits=h,this.maxFractionDigits=f}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,ci);if(!o)return null;const a=e[2];if(typeof a!="object"||Array.isArray(a))return i.error("NumberFormat options argument must be an object.");let h=null;if(a.locale&&(h=i.parse(a.locale,1,Bn),!h))return null;let f=null;if(a.currency&&(f=i.parse(a.currency,1,Bn),!f))return null;let x=null;if(a.unit&&(x=i.parse(a.unit,1,Bn),!x))return null;let w=null;if(a["min-fraction-digits"]&&(w=i.parse(a["min-fraction-digits"],1,ci),!w))return null;let S=null;return a["max-fraction-digits"]&&(S=i.parse(a["max-fraction-digits"],1,ci),!S)?null:new wf(o,h,f,x,w,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class bf{constructor(e){this.type=ci,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${no(o.type)} instead.`):new bf(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Io(`Expected value to be of type string or array, but found ${no(lo(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function Cf(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const gu={"==":nm,"!=":rm,">":sm,"<":om,">=":xf,"<=":vf,array:sa,at:pf,boolean:sa,case:_f,coalesce:Yh,collator:Li,format:rc,image:oc,in:mf,"index-of":kc,interpolate:aa,"interpolate-hcl":aa,"interpolate-lab":aa,length:bf,let:Kh,literal:Ha,match:gf,number:sa,"number-format":wf,object:sa,slice:Bc,step:Rc,string:sa,"to-boolean":Z,"to-color":Z,"to-number":Z,"to-string":Z,var:du,within:Il,distance:ll,config:Ml};function am(t,[e,i,o,a]){e=e.evaluate(t),i=i.evaluate(t),o=o.evaluate(t);const h=a?a.evaluate(t):1,f=ra(e,i,o,h);if(f)throw new Io(f);return new kn(e/255*h,i/255*h,o/255*h,h)}function lm(t,[e,i,o,a]){e=e.evaluate(t),i=i.evaluate(t),o=o.evaluate(t);const h=a?a.evaluate(t):1,f=function(S,P,R,B){return typeof S=="number"&&S>=0&&S<=360?typeof P=="number"&&P>=0&&P<=100&&typeof R=="number"&&R>=0&&R<=100?B===void 0||typeof B=="number"&&B>=0&&B<=1?null:`Invalid hsla value [${[S,P,R,B].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof B=="number"?[S,P,R,B]:[S,P,R]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof B=="number"?[S,P,R,B]:[S,P,R]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,o,h);if(f)throw new Io(f);const x=`hsla(${e}, ${i}%, ${o}%, ${h})`,w=kn.parse(x);if(!w)throw new Io(`Failed to parse HSLA color: ${x}`);return w}function cm(t,e){return t in e}function Ef(t,e){const i=e[t];return i===void 0?null:i}function Nc(t){return{type:t}}function um(t){return{result:"success",value:t}}function Fc(t){return{result:"error",value:t}}function hm(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function Tf(t){return t["property-type"]==="data-driven"}function p(t){return hm(t.expression,"measure-light")}function n(t){return hm(t.expression,"zoom")}function l(t){return!!t.expression&&t.expression.interpolated}function y(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function b(t){return t}function T(t,e){const i=e.type==="color",o=t.stops&&typeof t.stops[0][0]=="object",a=o||!(o||t.property!==void 0),h=t.type||(l(e)?"exponential":"interval");if(i&&((t=Qu({},t)).stops&&(t.stops=t.stops.map(S=>[S[0],kn.parse(S[1])])),t.default=kn.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!tm[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let f,x,w;if(h==="exponential")f=V;else if(h==="interval")f=F;else if(h==="categorical"){f=D,x=Object.create(null);for(const S of t.stops)x[S[0]]=S[1];w=typeof t.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);f=X}if(o){const S={},P=[];for(let H=0;H<t.stops.length;H++){const $=t.stops[H],te=$[0].zoom;S[te]===void 0&&(S[te]={zoom:te,type:t.type,property:t.property,default:t.default,stops:[]},P.push(te)),S[te].stops.push([$[0].value,$[1]])}const R=[];for(const H of P)R.push([S[H].zoom,T(S[H],e)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:aa.interpolationFactor.bind(void 0,B),zoomStops:R.map(H=>H[0]),evaluate:({zoom:H},$)=>V({stops:R,base:t.base},e,H).evaluate(H,$)}}if(a){const S=h==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:aa.interpolationFactor.bind(void 0,S),zoomStops:t.stops.map(P=>P[0]),evaluate:({zoom:P})=>f(t,e,P,x,w)}}return{kind:"source",evaluate(S,P){const R=P&&P.properties?P.properties[t.property]:void 0;return R===void 0?M(t.default,e.default):f(t,e,R,x,w)}}}function M(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function D(t,e,i,o,a){return M(typeof i===a?o[i]:void 0,t.default,e.default)}function F(t,e,i){if(Sa(i)!=="number")return M(t.default,e.default);const o=t.stops.length;if(o===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[o-1][0])return t.stops[o-1][1];const a=Wh(t.stops.map(h=>h[0]),i);return t.stops[a][1]}function V(t,e,i){const o=t.base!==void 0?t.base:1;if(Sa(i)!=="number")return M(t.default,e.default);const a=t.stops.length;if(a===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[a-1][0])return t.stops[a-1][1];const h=Wh(t.stops.map(P=>P[0]),i),f=function(P,R,B,H){const $=H-B,te=P-B;return $===0?0:R===1?te/$:(Math.pow(R,te)-1)/(Math.pow(R,$)-1)}(i,o,t.stops[h][0],t.stops[h+1][0]),x=t.stops[h][1],w=t.stops[h+1][1];let S=Lc[e.type]||b;if(t.colorSpace&&t.colorSpace!=="rgb"){const P=tm[t.colorSpace];S=(R,B)=>P.reverse(P.interpolate(P.forward(R),P.forward(B),f))}return typeof x.evaluate=="function"?{evaluate(...P){const R=x.evaluate.apply(void 0,P),B=w.evaluate.apply(void 0,P);if(R!==void 0&&B!==void 0)return S(R,B,f)}}:S(x,w,f)}function X(t,e,i){return e.type==="color"?i=kn.parse(i):e.type==="formatted"?i=vo.fromString(i.toString()):e.type==="resolvedImage"?i=pr.fromString(i.toString()):Sa(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),M(i,t.default,e.default)}tt.register(gu,{error:[{kind:"error"},[Bn],(t,[e])=>{throw new Io(e.evaluate(t))}],typeof:[Bn,[sn],(t,[e])=>no(lo(e.evaluate(t)))],"to-rgba":[As(ci,4),[Hs],(t,[e])=>e.evaluate(t).toRenderColor(null).toArray()],rgb:[Hs,[ci,ci,ci],am],rgba:[Hs,[ci,ci,ci,ci],am],hsl:[Hs,[ci,ci,ci],lm],hsla:[Hs,[ci,ci,ci,ci],lm],has:{type:In,overloads:[[[Bn],(t,[e])=>cm(e.evaluate(t),t.properties())],[[Bn,Ql],(t,[e,i])=>cm(e.evaluate(t),i.evaluate(t))]]},get:{type:sn,overloads:[[[Bn],(t,[e])=>Ef(e.evaluate(t),t.properties())],[[Bn,Ql],(t,[e,i])=>Ef(e.evaluate(t),i.evaluate(t))]]},"feature-state":[sn,[Bn],(t,[e])=>Ef(e.evaluate(t),t.featureState||{})],properties:[Ql,[],t=>t.properties()],"geometry-type":[Bn,[],t=>t.geometryType()],id:[sn,[],t=>t.id()],zoom:[ci,[],t=>t.globals.zoom],pitch:[ci,[],t=>t.globals.pitch||0],"distance-from-center":[ci,[],t=>t.distanceFromCenter()],"measure-light":[ci,[Bn],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[ci,[],t=>t.globals.heatmapDensity||0],"line-progress":[ci,[],t=>t.globals.lineProgress||0],"raster-value":[ci,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[ci,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[ci,[],t=>t.globals.skyRadialProgress||0],accumulated:[sn,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[ci,Nc(ci),(t,e)=>{let i=0;for(const o of e)i+=o.evaluate(t);return i}],"*":[ci,Nc(ci),(t,e)=>{let i=1;for(const o of e)i*=o.evaluate(t);return i}],"-":{type:ci,overloads:[[[ci,ci],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[ci],(t,[e])=>-e.evaluate(t)]]},"/":[ci,[ci,ci],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[ci,[ci,ci],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[ci,[],()=>Math.LN2],pi:[ci,[],()=>Math.PI],e:[ci,[],()=>Math.E],"^":[ci,[ci,ci],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[ci,[ci],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[ci,[ci],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[ci,[ci],(t,[e])=>Math.log(e.evaluate(t))],log2:[ci,[ci],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[ci,[ci],(t,[e])=>Math.sin(e.evaluate(t))],cos:[ci,[ci],(t,[e])=>Math.cos(e.evaluate(t))],tan:[ci,[ci],(t,[e])=>Math.tan(e.evaluate(t))],asin:[ci,[ci],(t,[e])=>Math.asin(e.evaluate(t))],acos:[ci,[ci],(t,[e])=>Math.acos(e.evaluate(t))],atan:[ci,[ci],(t,[e])=>Math.atan(e.evaluate(t))],min:[ci,Nc(ci),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[ci,Nc(ci),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[ci,[ci],(t,[e])=>Math.abs(e.evaluate(t))],round:[ci,[ci],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[ci,[ci],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[ci,[ci],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[In,[Bn,sn],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[In,[sn],(t,[e])=>t.id()===e.value],"filter-type-==":[In,[Bn],(t,[e])=>t.geometryType()===e.value],"filter-<":[In,[Bn,sn],(t,[e,i])=>{const o=t.properties()[e.value],a=i.value;return typeof o==typeof a&&o<a}],"filter-id-<":[In,[sn],(t,[e])=>{const i=t.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[In,[Bn,sn],(t,[e,i])=>{const o=t.properties()[e.value],a=i.value;return typeof o==typeof a&&o>a}],"filter-id->":[In,[sn],(t,[e])=>{const i=t.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[In,[Bn,sn],(t,[e,i])=>{const o=t.properties()[e.value],a=i.value;return typeof o==typeof a&&o<=a}],"filter-id-<=":[In,[sn],(t,[e])=>{const i=t.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[In,[Bn,sn],(t,[e,i])=>{const o=t.properties()[e.value],a=i.value;return typeof o==typeof a&&o>=a}],"filter-id->=":[In,[sn],(t,[e])=>{const i=t.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[In,[sn],(t,[e])=>e.value in t.properties()],"filter-has-id":[In,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[In,[As(Bn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[In,[As(sn)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[In,[Bn,As(sn)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[In,[Bn,As(sn)],(t,[e,i])=>function(o,a,h,f){for(;h<=f;){const x=h+f>>1;if(a[x]===o)return!0;a[x]>o?f=x-1:h=x+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:In,overloads:[[[In,In],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Nc(In),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:In,overloads:[[[In,In],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Nc(In),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[In,[In],(t,[e])=>!e.evaluate(t)],"is-supported-script":[In,[Bn],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Bn,[Bn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Bn,[Bn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Bn,Nc(sn),(t,e)=>e.map(i=>oa(i.evaluate(t))).join("")],"resolved-locale":[Bn,[Jl],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[ci,[ci,ci,sn],(t,e)=>{const[i,o,a]=e.map(f=>f.evaluate(t));if(i>o||i===o)return i;let h;if(typeof a=="string")h=function(f){let x=0;if(f.length===0)return x;for(let w=0;w<f.length;w++)x=(x<<5)-x+f.charCodeAt(w),x|=0;return x}(a);else{if(typeof a!="number")throw new Io(`Invalid seed input: ${a}`);h=a}return i+Cf(h)()*(o-i)}]});class ie{constructor(e,i,o,a){this.expression=e,this._warningHistory={},this._evaluator=new we(o,a),this._defaultValue=i?function(h){return h.type==="color"&&(y(h.default)||Array.isArray(h.default))?new kn(0,0,0,0):h.type==="color"?kn.parse(h.default)||null:h.default===void 0?null:h.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,o,a,h,f,x,w){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=a||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,a,h,f,x,w){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Io(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function le(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in gu}function ue(t,e,i,o){const a=new Gh(gu,[],e?function(f){const x={color:Hs,string:Bn,number:ci,enum:Bn,boolean:In,formatted:Ta,resolvedImage:ec};return f.type==="array"?As(x[f.value]||sn,f.length):x[f.type]}(e):void 0,void 0,void 0,i,o),h=a.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?um(new ie(h,e,i,o)):Fc(a.errors)}class me{constructor(e,i,o){this.kind=e,this._styleExpression=i,this.isLightConstant=o,this.isStateDependent=e!=="constant"&&!Hh(i.expression),this.isConfigDependent=!sf(i.expression)}evaluateWithoutErrorHandling(e,i,o,a,h,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,a,h,f)}evaluate(e,i,o,a,h,f){return this._styleExpression.evaluate(e,i,o,a,h,f)}}class ge{constructor(e,i,o,a,h){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Hh(i.expression),this.isLightConstant=h,this.isConfigDependent=!sf(i.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,i,o,a,h,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,a,h,f)}evaluate(e,i,o,a,h,f){return this._styleExpression.evaluate(e,i,o,a,h,f)}interpolationFactor(e,i,o){return this.interpolationType?aa.interpolationFactor(this.interpolationType,e,i,o):0}}function _e(t,e,i,o){if((t=ue(t,e,i,o)).result==="error")return t;const a=t.value.expression,h=sh(a);if(!h&&!Tf(e))return Fc([new Ea("","data expressions not supported")]);const f=ah(a,["zoom","pitch","distance-from-center"]);if(!f&&!n(e))return Fc([new Ea("","zoom expressions not supported")]);const x=ah(a,["measure-light"]);if(!x&&!p(e))return Fc([new Ea("","measure-light expression not supported")]);const w=e.expression&&e.expression.relaxZoomRestriction,S=Pe(a);return S||f||w?S instanceof Ea?Fc([S]):S instanceof aa&&!l(e)?Fc([new Ea("",'"interpolate" expressions cannot be used with this property')]):um(S?new ge(h?"camera":"composite",t.value,S.labels,S instanceof aa?S.interpolation:void 0,x):new me(h?"constant":"source",t.value,x)):Fc([new Ea("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ye{constructor(e,i){this._parameters=e,this._specification=i,Qu(this,T(this._parameters,this._specification))}static deserialize(e){return new ye(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Pe(t){let e=null;if(t instanceof Kh)e=Pe(t.result);else if(t instanceof Yh){for(const i of t.args)if(e=Pe(i),e)break}else(t instanceof Rc||t instanceof aa)&&t.input instanceof tt&&t.input.name==="zoom"&&(e=t);return e instanceof Ea||t.eachChild(i=>{const o=Pe(i);o instanceof Ea?e=o:e&&o&&e!==o&&(e=new Ea("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var De=qe,ke=3;function qe(t,e,i){var o=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var a=new Int32Array(this.arrayBuffer);t=a[0],this.d=(e=a[1])+2*(i=a[2]);for(var h=0;h<this.d*this.d;h++){var f=a[ke+h],x=a[ke+h+1];o.push(f===x?null:a.subarray(f,x))}var w=a[ke+o.length+1];this.keys=a.subarray(a[ke+o.length],w),this.bboxes=a.subarray(w),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var S=0;S<this.d*this.d;S++)o.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var P=i/e*t;this.min=-P,this.max=t+P}qe.prototype.insert=function(t,e,i,o,a){this._forEachCell(e,i,o,a,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(a)},qe.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},qe.prototype._insertCell=function(t,e,i,o,a,h){this.cells[a].push(h)},qe.prototype.query=function(t,e,i,o,a){var h=this.min,f=this.max;if(t<=h&&e<=h&&f<=i&&f<=o&&!a)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(t,e,i,o,this._queryCell,x,{},a),x},qe.prototype._queryCell=function(t,e,i,o,a,h,f,x){var w=this.cells[a];if(w!==null)for(var S=this.keys,P=this.bboxes,R=0;R<w.length;R++){var B=w[R];if(f[B]===void 0){var H=4*B;(x?x(P[H+0],P[H+1],P[H+2],P[H+3]):t<=P[H+2]&&e<=P[H+3]&&i>=P[H+0]&&o>=P[H+1])?(f[B]=!0,h.push(S[B])):f[B]=!1}}},qe.prototype._forEachCell=function(t,e,i,o,a,h,f,x){for(var w=this._convertToCellCoord(t),S=this._convertToCellCoord(e),P=this._convertToCellCoord(i),R=this._convertToCellCoord(o),B=w;B<=P;B++)for(var H=S;H<=R;H++){var $=this.d*H+B;if((!x||x(this._convertFromCellCoord(B),this._convertFromCellCoord(H),this._convertFromCellCoord(B+1),this._convertFromCellCoord(H+1)))&&a.call(this,t,e,i,o,$,h,f,x))return}},qe.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},qe.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},qe.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=ke+this.cells.length+1+1,i=0,o=0;o<this.cells.length;o++)i+=this.cells[o].length;var a=new Int32Array(e+i+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var h=e,f=0;f<t.length;f++){var x=t[f];a[ke+f]=h,a.set(x,h),h+=x.length}return a[ke+t.length]=h,a.set(this.keys,h),a[ke+t.length+1]=h+=this.keys.length,a.set(this.bboxes,h),h+=this.bboxes.length,a.buffer};var Ve=G(De);const Ze={};function xe(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writable:!1}),Ze[e]={klass:t,omit:i.omit||[]}}xe(Object,"Object"),Ve.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.add(i),{buffer:i}},Ve.deserialize=function(t){return new Ve(t.buffer)},Object.defineProperty(Ve,"name",{value:"Grid"}),xe(Ve,"Grid"),xe(kn,"Color"),xe(Error,"Error"),xe(vo,"Formatted"),xe(Is,"FormattedSection"),xe(Zn,"AJAXError"),xe(pr,"ResolvedImage"),xe(ye,"StylePropertyFunction"),xe(ie,"StyleExpression",{omit:["_evaluator"]}),xe(ge,"ZoomDependentExpression"),xe(me,"ZoomConstantExpression"),xe(tt,"CompoundExpression",{omit:["_evaluate"]});for(const t in gu)Ze[gu[t]._classRegistryKey]||xe(gu[t],`Expression${t}`);function Be(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Qe(t){return self.ImageBitmap&&t instanceof ImageBitmap}function ct(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Be(t)||Qe(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.add(i.buffer),i}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const o of t)i.push(ct(o,e));return i}if(t instanceof Map){const i={$name:"Map"};for(const[o,a]of t.entries())i[o]=ct(a);return i}if(typeof t=="object"){const i=t.constructor,o=i._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);const a=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const h in t)t.hasOwnProperty(h)&&(Ze[o].omit.indexOf(h)>=0||(a[h]=ct(t[h],e)));t instanceof Error&&(a.message=t.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(a.$name=o),a}throw new Error("can't serialize object of type "+typeof t)}function it(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Be(t)||Qe(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(it);if(typeof t=="object"){const e=t.$name||"Object";if(e==="Map"){const a=new Map;for(const h of Object.keys(t))h!=="$name"&&a.set(h,it(t[h]));return a}const{klass:i}=Ze[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const o=Object.create(i.prototype);for(const a of Object.keys(t))a!=="$name"&&(o[a]=it(t[a]));return o}throw new Error("can't deserialize object of type "+typeof t)}const $e={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function ft(t){for(const e of t)if(Lt(e.charCodeAt(0)))return!0;return!1}function Pt(t){for(const e of t)if(!Dt(e.charCodeAt(0)))return!1;return!0}function Dt(t){return!($e.Arabic(t)||$e["Arabic Supplement"](t)||$e["Arabic Extended-A"](t)||$e["Arabic Presentation Forms-A"](t)||$e["Arabic Presentation Forms-B"](t))}function Lt(t){return!(t!==746&&t!==747&&(t<4352||!($e["Bopomofo Extended"](t)||$e.Bopomofo(t)||$e["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||$e["CJK Compatibility Ideographs"](t)||$e["CJK Compatibility"](t)||$e["CJK Radicals Supplement"](t)||$e["CJK Strokes"](t)||!(!$e["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||$e["CJK Unified Ideographs Extension A"](t)||$e["CJK Unified Ideographs"](t)||$e["Enclosed CJK Letters and Months"](t)||$e["Hangul Compatibility Jamo"](t)||$e["Hangul Jamo Extended-A"](t)||$e["Hangul Jamo Extended-B"](t)||$e["Hangul Jamo"](t)||$e["Hangul Syllables"](t)||$e.Hiragana(t)||$e["Ideographic Description Characters"](t)||$e.Kanbun(t)||$e["Kangxi Radicals"](t)||$e["Katakana Phonetic Extensions"](t)||$e.Katakana(t)&&t!==12540||!(!$e["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!$e["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||$e["Unified Canadian Aboriginal Syllabics"](t)||$e["Unified Canadian Aboriginal Syllabics Extended"](t)||$e["Vertical Forms"](t)||$e["Yijing Hexagram Symbols"](t)||$e["Yi Syllables"](t)||$e["Yi Radicals"](t))))}function ot(t){return!(Lt(t)||function(e){return!!($e["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||$e["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||$e["Letterlike Symbols"](e)||$e["Number Forms"](e)||$e["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||$e["Control Pictures"](e)&&e!==9251||$e["Optical Character Recognition"](e)||$e["Enclosed Alphanumerics"](e)||$e["Geometric Shapes"](e)||$e["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||$e["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||$e["CJK Symbols and Punctuation"](e)||$e.Katakana(e)||$e["Private Use Area"](e)||$e["CJK Compatibility Forms"](e)||$e["Small Form Variants"](e)||$e["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function gt(t){return t>=1424&&t<=2303||$e["Arabic Presentation Forms-A"](t)||$e["Arabic Presentation Forms-B"](t)}function Tt(t,e){return!(!e&&gt(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||$e.Khmer(t))}function Kt(t){for(const e of t)if(gt(e.charCodeAt(0)))return!0;return!1}const Qt="deferred",ni="loading",Jt="loaded";let Wt=null,wt="unavailable",hi=null;const dn=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(wt="error"),Wt&&Wt(t)};function ji(){Ji.fire(new vs("pluginStateChange",{pluginStatus:wt,pluginURL:hi}))}const Ji=new al,Cn=function(){return wt},Sr=function(){if(wt!==Qt||!hi)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");wt=ni,ji(),hi&&c({url:hi},t=>{t?dn(t):(wt=Jt,ji())})},vn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>wt===Jt||vn.applyArabicShaping!=null,isLoading:()=>wt===ni,setState(t){wt=t.pluginStatus,hi=t.pluginURL},isParsed:()=>vn.applyArabicShaping!=null&&vn.processBidirectionalText!=null&&vn.processStyledBidirectionalText!=null,getPluginURL:()=>hi};class $i{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,o){for(const a of i)if(!Tt(a.charCodeAt(0),o))return!1;return!0}(e,vn.isLoaded())}}class mr{constructor(e,i,o,a){this.property=e,this.value=i,this.expression=function(h,f,x,w){if(y(h))return new ye(h,f);if(le(h)||Array.isArray(h)&&h.length>0){const S=_e(h,f,x,w);if(S.result==="error")throw new Error(S.value.map(P=>`${P.key}: ${P.message}`).join(", "));return S.value}{let S=h;return typeof h=="string"&&f.type==="color"&&(S=kn.parse(h)),{kind:"constant",isConfigDependent:!1,evaluate:()=>S}}}(i===void 0?e.specification.default:i,e.specification,o,a)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class Qn{constructor(e,i,o){this.property=e,this.value=new mr(e,void 0,i,o)}transitioned(e,i){return new rn(this.property,this.value,i,An({},e.transition,this.transition),e.now)}untransitioned(){return new rn(this.property,this.value,null,{},0)}}class En{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=o,this.isConfigDependent=!1}getValue(e){return is(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Qn(this._values[e].property,this._scope,this._options)),this._values[e].value=new mr(this._values[e].property,i===null?void 0:is(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,i){i&&(this._options=i);const o=this._properties.properties;if(e)for(const a in e){const h=e[a];if(Xr(a,"-transition")){const f=a.slice(0,-11);o[f]&&this.setTransition(f,h)}else o.hasOwnProperty(a)&&this.setValue(a,h)}}getTransition(e){return is(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Qn(this._values[e].property)),this._values[e].transition=is(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const a=this.getTransition(i);a!==void 0&&(e[`${i}-transition`]=a)}return e}transitioned(e,i){const o=new vr(this._properties);for(const a of Object.keys(this._values))o._values[a]=this._values[a].transitioned(e,i._values[a]);return o}untransitioned(){const e=new vr(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class rn{constructor(e,i,o,a,h){const f=a.delay||0,x=a.duration||0;h=h||0,this.property=e,this.value=i,this.begin=h+f,this.end=this.begin+x,e.specification.transition&&(a.delay||a.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const a=e.now||0,h=this.value.possiblyEvaluate(e,i,o),f=this.prior;if(f){if(a>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(a<this.begin)return f.possiblyEvaluate(e,i,o);{const x=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,i,o),h,js(x))}}return h}}class vr{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const a=new xr(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].possiblyEvaluate(e,i,o);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ro{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=o,this.isConfigDependent=!1}getValue(e){return is(this._values[e].value)}setValue(e,i){this._values[e]=new mr(this._values[e].property,i===null?void 0:is(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const a=new xr(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].possiblyEvaluate(e,i,o);return a}}class or{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,a){return this.property.evaluate(this.value,this.parameters,e,i,o,a)}}class xr{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class It{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,o){const a=Lc[this.specification.type];return a?a(e,i,o):e}}class li{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,a){return new or(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,a)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new or(this,{kind:"constant",value:void 0},e.parameters);const a=Lc[this.specification.type];return a?new or(this,{kind:"constant",value:a(e.value.value,i.value.value,o)},e.parameters):e}evaluate(e,i,o,a,h,f){return e.kind==="constant"?e.value:e.evaluate(i,o,a,h,f)}}class rs{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,a){return!!e.expression.evaluate(i,null,{},o,a)}interpolate(){return!1}}class Wn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new $i(0,{});for(const o in e){const a=e[o];a.specification.overridable&&this.overridableProperties.push(o);const h=this.defaultPropertyValues[o]=new mr(a,void 0),f=this.defaultTransitionablePropertyValues[o]=new Qn(a);this.defaultTransitioningPropertyValues[o]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=h.possiblyEvaluate(i)}}}xe(li,"DataDrivenProperty"),xe(It,"DataConstantProperty"),xe(rs,"ColorRampProperty");var lt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ms(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function xs(t){if(Array.isArray(t))return t.map(xs);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=xs(t[i]);return e}return Ms(t)}function os(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!os(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function ws(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};os(t)||(t=cl(t));const i=t;let o=!0;try{o=function(S){if(!la(S))return S;let P=xs(S);return Ll(P),P=$a(P),P}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const a=lt[`filter_${e}`],h=ue(o,a);let f=null;if(h.result==="error")throw new Error(h.value.map(S=>`${S.key}: ${S.message}`).join(", "));f=(S,P,R)=>h.value.evaluate(S,P,{},R);let x=null,w=null;if(o!==i){const S=ue(i,a);if(S.result==="error")throw new Error(S.value.map(P=>`${P.key}: ${P.message}`).join(", "));x=(P,R,B,H,$)=>S.value.evaluate(P,R,{},B,void 0,void 0,H,$),w=!sh(S.value.expression)}return{filter:f,dynamicFilter:x||void 0,needGeometry:hc(o),needFeature:!!w}}function $a(t){if(!Array.isArray(t))return t;const e=function(i){if(cc.has(i[0])){for(let o=1;o<i.length;o++)if(la(i[o]))return!0}return i}(t);return e===!0?e:e.map(i=>$a(i))}function Ll(t){let e=!1;const i=[];if(t[0]==="case"){for(let o=1;o<t.length-1;o+=2)e=e||la(t[o]),i.push(t[o+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||la(t[1]);for(let o=2;o<t.length-1;o+=2)i.push(t[o+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||la(t[1]);for(let o=1;o<t.length-1;o+=2)i.push(t[o+1])}e&&(t.length=0,t.push("any",...i));for(let o=1;o<t.length;o++)Ll(t[o])}function la(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if(la(t[i]))return!0;return!1}const cc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function uc(t,e){return t<e?-1:t>e?1:0}function hc(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(hc(t[e]))return!0;return!1}function cl(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?zc(t[1],t[2],"=="):e==="!="?yu(zc(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?zc(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map(cl))):e==="all"?["all"].concat(t.slice(1).map(cl)):e==="none"?["all"].concat(t.slice(1).map(cl).map(yu)):e==="in"?_u(t[1],t.slice(2)):e==="!in"?yu(_u(t[1],t.slice(2))):e==="has"?uh(t[1]):e!=="!has"||yu(uh(t[1]));var i}function zc(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function _u(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(uc)]]:["filter-in-small",t,["literal",e]]}}function uh(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function yu(t){return["!",t]}const vu="";function Qh(t,e){return e?`${t}${vu}${e}`:t}const Jh="-transition",Vc=new Set(["fill","line","background","hillshade","raster"]);class bs extends al{constructor(e,i,o,a,h){if(super(),this.id=e.id,this.fqid=Qh(this.id,o),this.type=e.type,this.scope=o,this.lut=a,this.options=h,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new ro(i.layout,this.scope,h),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),i.paint)){this._transitionablePaint=new En(i.paint,this.scope,h);for(const f in e.paint)this.setPaintProperty(f,e.paint[f]);for(const f in e.layout)this.setLayoutProperty(f,e.layout[f]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xr(i.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return Vc.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,i),this.isConfigDependent=this.isConfigDependent||o.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Xr(e,Jh)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const o=this._transitionablePaint,a=o._properties.properties;if(Xr(e,Jh)){const R=e.slice(0,-11);return a[R]&&o.setTransition(R,i||void 0),!1}if(!a[e])return!1;const h=o._values[e],f=h.value.isDataDriven(),x=h.value;o.setValue(e,i),this.isConfigDependent=this.isConfigDependent||o.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const w=o._values[e].value,S=w.isDataDriven(),P=Xr(e,"pattern")||e==="line-dasharray";return S||f||P||this._handleOverridablePaintPropertyUpdate(e,x,w)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,o){return null}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return Xl({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof or&&Tf(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ws(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,o,a,h,f,x,w,S){}queryIntersectsMatchingFeature(e,i,o,a){}}const Sf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class dm{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Br{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Yn(t,e=1){let i=0,o=0;return{members:t.map(a=>{const h=Sf[a.type].BYTES_PER_ELEMENT,f=i=vy(i,Math.max(e,h)),x=a.components||1;return o=Math.max(o,h),i+=h*x,{name:a.name,type:a.type,components:x,offset:f}}),size:vy(i,Math.max(o,e)),alignment:e}}function vy(t,e){return Math.ceil(t/e)*e}class Ol extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const a=2*e;return this.int16[a+0]=i,this.int16[a+1]=o,e}}Ol.prototype.bytesPerElement=4,xe(Ol,"StructArrayLayout2i4");class fm extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,o)}emplace(e,i,o,a){const h=3*e;return this.int16[h+0]=i,this.int16[h+1]=o,this.int16[h+2]=a,e}}fm.prototype.bytesPerElement=6,xe(fm,"StructArrayLayout3i6");class xu extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,a)}emplace(e,i,o,a,h){const f=4*e;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=a,this.int16[f+3]=h,e}}xu.prototype.bytesPerElement=8,xe(xu,"StructArrayLayout4i8");class m0 extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,a,h)}emplace(e,i,o,a,h,f){const x=5*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=a,this.int16[x+3]=h,this.int16[x+4]=f,e}}m0.prototype.bytesPerElement=10,xe(m0,"StructArrayLayout5i10");class g0 extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,f,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,a,h,f,x)}emplace(e,i,o,a,h,f,x,w){const S=6*e,P=12*e,R=3*e;return this.int16[S+0]=i,this.int16[S+1]=o,this.uint8[P+4]=a,this.uint8[P+5]=h,this.uint8[P+6]=f,this.uint8[P+7]=x,this.float32[R+2]=w,e}}g0.prototype.bytesPerElement=12,xe(g0,"StructArrayLayout2i4ub1f12");class wu extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,a)}emplace(e,i,o,a,h){const f=4*e;return this.float32[f+0]=i,this.float32[f+1]=o,this.float32[f+2]=a,this.float32[f+3]=h,e}}wu.prototype.bytesPerElement=16,xe(wu,"StructArrayLayout4f16");class bu extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,o)}emplace(e,i,o,a){const h=3*e;return this.float32[h+0]=i,this.float32[h+1]=o,this.float32[h+2]=a,e}}bu.prototype.bytesPerElement=12,xe(bu,"StructArrayLayout3f12");class Cu extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,a,h)}emplace(e,i,o,a,h,f){const x=6*e,w=3*e;return this.uint16[x+0]=i,this.uint16[x+1]=o,this.uint16[x+2]=a,this.uint16[x+3]=h,this.float32[w+2]=f,e}}Cu.prototype.bytesPerElement=12,xe(Cu,"StructArrayLayout4ui1f12");class pm extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,a)}emplace(e,i,o,a,h){const f=4*e;return this.uint16[f+0]=i,this.uint16[f+1]=o,this.uint16[f+2]=a,this.uint16[f+3]=h,e}}pm.prototype.bytesPerElement=8,xe(pm,"StructArrayLayout4ui8");class mm extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,a,h,f)}emplace(e,i,o,a,h,f,x){const w=6*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.int16[w+2]=a,this.int16[w+3]=h,this.int16[w+4]=f,this.int16[w+5]=x,e}}mm.prototype.bytesPerElement=12,xe(mm,"StructArrayLayout6i12");class _0 extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,f,x,w,S,P,R,B){const H=this.length;return this.resize(H+1),this.emplace(H,e,i,o,a,h,f,x,w,S,P,R,B)}emplace(e,i,o,a,h,f,x,w,S,P,R,B,H){const $=12*e;return this.int16[$+0]=i,this.int16[$+1]=o,this.int16[$+2]=a,this.int16[$+3]=h,this.uint16[$+4]=f,this.uint16[$+5]=x,this.uint16[$+6]=w,this.uint16[$+7]=S,this.int16[$+8]=P,this.int16[$+9]=R,this.int16[$+10]=B,this.int16[$+11]=H,e}}_0.prototype.bytesPerElement=24,xe(_0,"StructArrayLayout4i4ui4i24");class y0 extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,a,h,f)}emplace(e,i,o,a,h,f,x){const w=10*e,S=5*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.int16[w+2]=a,this.float32[S+2]=h,this.float32[S+3]=f,this.float32[S+4]=x,e}}y0.prototype.bytesPerElement=20,xe(y0,"StructArrayLayout3i3f20");class v0 extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}v0.prototype.bytesPerElement=4,xe(v0,"StructArrayLayout1ul4");class hh extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}hh.prototype.bytesPerElement=4,xe(hh,"StructArrayLayout1f4");class Eu extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const a=2*e;return this.uint16[a+0]=i,this.uint16[a+1]=o,e}}Eu.prototype.bytesPerElement=4,xe(Eu,"StructArrayLayout2ui4");class x0 extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,f,x,w,S,P,R,B,H){const $=this.length;return this.resize($+1),this.emplace($,e,i,o,a,h,f,x,w,S,P,R,B,H)}emplace(e,i,o,a,h,f,x,w,S,P,R,B,H,$){const te=20*e,ne=10*e;return this.int16[te+0]=i,this.int16[te+1]=o,this.int16[te+2]=a,this.int16[te+3]=h,this.int16[te+4]=f,this.float32[ne+3]=x,this.float32[ne+4]=w,this.float32[ne+5]=S,this.float32[ne+6]=P,this.int16[te+14]=R,this.uint32[ne+8]=B,this.uint16[te+18]=H,this.uint16[te+19]=$,e}}x0.prototype.bytesPerElement=40,xe(x0,"StructArrayLayout5i4f1i1ul2ui40");class gm extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,f,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,a,h,f,x)}emplace(e,i,o,a,h,f,x,w){const S=8*e;return this.int16[S+0]=i,this.int16[S+1]=o,this.int16[S+2]=a,this.int16[S+4]=h,this.int16[S+5]=f,this.int16[S+6]=x,this.int16[S+7]=w,e}}gm.prototype.bytesPerElement=16,xe(gm,"StructArrayLayout3i2i2i16");class w0 extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,a,h)}emplace(e,i,o,a,h,f){const x=4*e,w=8*e;return this.float32[x+0]=i,this.float32[x+1]=o,this.float32[x+2]=a,this.int16[w+6]=h,this.int16[w+7]=f,e}}w0.prototype.bytesPerElement=16,xe(w0,"StructArrayLayout2f1f2i16");class b0 extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,a)}emplace(e,i,o,a,h){const f=12*e,x=3*e;return this.uint8[f+0]=i,this.uint8[f+1]=o,this.float32[x+1]=a,this.float32[x+2]=h,e}}b0.prototype.bytesPerElement=12,xe(b0,"StructArrayLayout2ub2f12");class ss extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,o)}emplace(e,i,o,a){const h=3*e;return this.uint16[h+0]=i,this.uint16[h+1]=o,this.uint16[h+2]=a,e}}ss.prototype.bytesPerElement=6,xe(ss,"StructArrayLayout3ui6");class C0 extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,f,x,w,S,P,R,B,H,$,te,ne,de,Se,Me,Le,ze){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,e,i,o,a,h,f,x,w,S,P,R,B,H,$,te,ne,de,Se,Me,Le,ze)}emplace(e,i,o,a,h,f,x,w,S,P,R,B,H,$,te,ne,de,Se,Me,Le,ze,Fe){const Xe=30*e,et=15*e,st=60*e;return this.int16[Xe+0]=i,this.int16[Xe+1]=o,this.int16[Xe+2]=a,this.float32[et+2]=h,this.float32[et+3]=f,this.uint16[Xe+8]=x,this.uint16[Xe+9]=w,this.uint32[et+5]=S,this.uint32[et+6]=P,this.uint32[et+7]=R,this.uint16[Xe+16]=B,this.uint16[Xe+17]=H,this.uint16[Xe+18]=$,this.float32[et+10]=te,this.float32[et+11]=ne,this.uint8[st+48]=de,this.uint8[st+49]=Se,this.uint8[st+50]=Me,this.uint32[et+13]=Le,this.int16[Xe+28]=ze,this.uint8[st+58]=Fe,e}}C0.prototype.bytesPerElement=60,xe(C0,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class E0 extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,f,x,w,S,P,R,B,H,$,te,ne,de,Se,Me,Le,ze,Fe,Xe,et,st,_t,dt,St,Vt,bt,kt,yt,Bt,jt){const zt=this.length;return this.resize(zt+1),this.emplace(zt,e,i,o,a,h,f,x,w,S,P,R,B,H,$,te,ne,de,Se,Me,Le,ze,Fe,Xe,et,st,_t,dt,St,Vt,bt,kt,yt,Bt,jt)}emplace(e,i,o,a,h,f,x,w,S,P,R,B,H,$,te,ne,de,Se,Me,Le,ze,Fe,Xe,et,st,_t,dt,St,Vt,bt,kt,yt,Bt,jt,zt){const ri=22*e,Ut=44*e,Ht=88*e;return this.float32[ri+0]=i,this.float32[ri+1]=o,this.int16[Ut+4]=a,this.int16[Ut+5]=h,this.int16[Ut+6]=f,this.int16[Ut+7]=x,this.int16[Ut+8]=w,this.int16[Ut+9]=S,this.int16[Ut+10]=P,this.int16[Ut+11]=R,this.int16[Ut+12]=B,this.uint16[Ut+13]=H,this.uint16[Ut+14]=$,this.uint16[Ut+15]=te,this.uint16[Ut+16]=ne,this.uint16[Ut+17]=de,this.uint16[Ut+18]=Se,this.uint16[Ut+19]=Me,this.uint16[Ut+20]=Le,this.uint16[Ut+21]=ze,this.uint16[Ut+22]=Fe,this.uint16[Ut+23]=Xe,this.uint16[Ut+24]=et,this.uint16[Ut+25]=st,this.uint16[Ut+26]=_t,this.uint16[Ut+27]=dt,this.uint32[ri+14]=St,this.float32[ri+15]=Vt,this.float32[ri+16]=bt,this.float32[ri+17]=kt,this.float32[ri+18]=yt,this.float32[ri+19]=Bt,this.float32[ri+20]=jt,this.uint8[Ht+84]=zt,e}}E0.prototype.bytesPerElement=88,xe(E0,"StructArrayLayout2f9i15ui1ul6f1ub88");class dh extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,a,h)}emplace(e,i,o,a,h,f){const x=5*e;return this.float32[x+0]=i,this.float32[x+1]=o,this.float32[x+2]=a,this.float32[x+3]=h,this.float32[x+4]=f,e}}dh.prototype.bytesPerElement=20,xe(dh,"StructArrayLayout5f20");class T0 extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,f,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,a,h,f,x)}emplace(e,i,o,a,h,f,x,w){const S=7*e;return this.float32[S+0]=i,this.float32[S+1]=o,this.float32[S+2]=a,this.float32[S+3]=h,this.float32[S+4]=f,this.float32[S+5]=x,this.float32[S+6]=w,e}}T0.prototype.bytesPerElement=28,xe(T0,"StructArrayLayout7f28");class ed extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const a=2*e;return this.float32[a+0]=i,this.float32[a+1]=o,e}}ed.prototype.bytesPerElement=8,xe(ed,"StructArrayLayout2f8");class S0 extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,a)}emplace(e,i,o,a,h){const f=6*e;return this.uint32[3*e+0]=i,this.uint16[f+2]=o,this.uint16[f+3]=a,this.uint16[f+4]=h,e}}S0.prototype.bytesPerElement=12,xe(S0,"StructArrayLayout1ul3ui12");class Af extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Af.prototype.bytesPerElement=2,xe(Af,"StructArrayLayout1ui2");class A0 extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,f,x,w,S,P,R,B,H,$,te,ne){const de=this.length;return this.resize(de+1),this.emplace(de,e,i,o,a,h,f,x,w,S,P,R,B,H,$,te,ne)}emplace(e,i,o,a,h,f,x,w,S,P,R,B,H,$,te,ne,de){const Se=16*e;return this.float32[Se+0]=i,this.float32[Se+1]=o,this.float32[Se+2]=a,this.float32[Se+3]=h,this.float32[Se+4]=f,this.float32[Se+5]=x,this.float32[Se+6]=w,this.float32[Se+7]=S,this.float32[Se+8]=P,this.float32[Se+9]=R,this.float32[Se+10]=B,this.float32[Se+11]=H,this.float32[Se+12]=$,this.float32[Se+13]=te,this.float32[Se+14]=ne,this.float32[Se+15]=de,e}}A0.prototype.bytesPerElement=64,xe(A0,"StructArrayLayout16f64");class _m extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,f,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,a,h,f,x)}emplace(e,i,o,a,h,f,x,w){const S=10*e,P=5*e;return this.uint16[S+0]=i,this.uint16[S+1]=o,this.uint16[S+2]=a,this.uint16[S+3]=h,this.float32[P+2]=f,this.float32[P+3]=x,this.float32[P+4]=w,e}}_m.prototype.bytesPerElement=20,xe(_m,"StructArrayLayout4ui3f20");class I0 extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}I0.prototype.bytesPerElement=2,xe(I0,"StructArrayLayout1i2");class M0 extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}M0.prototype.bytesPerElement=1,xe(M0,"StructArrayLayout1ub1");class xy extends dm{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}xy.prototype.size=40;class L0 extends x0{get(e){return new xy(this,e)}}xe(L0,"CollisionBoxArray");class wy extends dm{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}wy.prototype.size=60;class by extends C0{get(e){return new wy(this,e)}}xe(by,"PlacedSymbolArray");class Cy extends dm{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get occlusionState(){return this._structArray.float32[this._pos4+19]}set occlusionState(e){this._structArray.float32[this._pos4+19]=e}get occlusionOpacity(){return this._structArray.float32[this._pos4+20]}set occlusionOpacity(e){this._structArray.float32[this._pos4+20]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+84]}}Cy.prototype.size=88;class Ey extends E0{get(e){return new Cy(this,e)}}xe(Ey,"SymbolInstanceArray");class Ty extends hh{getoffsetX(e){return this.float32[1*e+0]}}xe(Ty,"GlyphOffsetArray");class Sy extends Ol{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}xe(Sy,"SymbolLineVertexArray");class Ay extends dm{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ay.prototype.size=12;class Iy extends S0{get(e){return new Ay(this,e)}}xe(Iy,"FeatureIndexArray");class My extends Eu{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}xe(My,"FillExtrusionCentroidArray");const hE=Yn([{name:"a_pos",components:2,type:"Int16"}],4),dE=Yn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class qr{constructor(e=[]){this.segments=e}_prepareSegment(e,i,o,a){let h=this.segments[this.segments.length-1];return e>qr.MAX_VERTEX_ARRAY_LENGTH&&Dr(`Max vertices per segment is ${qr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>qr.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==a)&&(h={vertexOffset:i,primitiveOffset:o,vertexLength:0,primitiveLength:0},a!==void 0&&(h.sortKey=a),this.segments.push(h)),h}prepareSegment(e,i,o,a){return this._prepareSegment(e,i.length,o.length,a)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,a){return new qr([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:a,vaos:{},sortKey:0}])}}function Ly(t,e){return 256*(t=Ki(Math.floor(t),0,255))+Ki(Math.floor(e),0,255)}qr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,xe(qr,"SegmentVector");const fE=Yn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),pE=Yn([{name:"a_dash",components:4,type:"Uint16"}]);class If{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,o,a){this.ids.push(Oy(e)),this.positions.push(i,o,a)}eachPosition(e,i){const o=Oy(e);let a=0,h=this.ids.length-1;for(;a<h;){const f=a+h>>1;this.ids[f]>=o?h=f:a=f+1}for(;this.ids[a]===o;)i(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(e,i){const o=new Float64Array(e.ids),a=new Uint32Array(e.positions);return O0(o,a,0,o.length-1),i&&(i.add(o.buffer),i.add(a.buffer)),{ids:o,positions:a}}static deserialize(e){const i=new If;let o;i.ids=e.ids,i.positions=e.positions;for(const a of i.ids)a!==o&&i.uniqueIds.push(a),o=a;return i.indexed=!0,i}}function Oy(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Tl(String(t))}function O0(t,e,i,o){for(;i<o;){const a=t[i+o>>1];let h=i-1,f=o+1;for(;;){do h++;while(t[h]<a);do f--;while(t[f]>a);if(h>=f)break;ym(t,h,f),ym(e,3*h,3*f),ym(e,3*h+1,3*f+1),ym(e,3*h+2,3*f+2)}f-i<o-f?(O0(t,e,i,f),i=f+1):(O0(t,e,f+1,o),o=f)}}function ym(t,e,i){const o=t[e];t[e]=t[i],t[i]=o}xe(If,"FeaturePositionMap");class Uc{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class vm extends Uc{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class $s extends Uc{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class jc extends Uc{constructor(e){super(e),this.current=[0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class P0 extends Uc{constructor(e){super(e),this.current=[0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class D0 extends Uc{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class Py extends Uc{constructor(e){super(e),this.current=kn.transparent.toRenderColor(null)}set(e,i,o){this.fetchUniformLocation(e,i)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const mE=new Float32Array(16);class Mf extends Uc{constructor(e){super(e),this.current=mE}set(e,i,o){if(this.fetchUniformLocation(e,i)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let a=1;a<16;a++)if(o[a]!==this.current[a]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}const gE=new Float32Array(9),_E=new Float32Array(4);class R0 extends Uc{constructor(e){super(e),this.current=_E}set(e,i,o){if(this.fetchUniformLocation(e,i)){for(let a=0;a<4;a++)if(o[a]!==this.current[a]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function k0(t){return[Ly(255*t.r,255*t.g),Ly(255*t.b,255*t.a)]}class Lf{constructor(e,i,o,a){this.value=e,this.uniformNames=i.map(h=>`u_${h}`),this.type=o,this.context=a}setUniform(e,i,o,a,h){const f=a.constantOr(this.value);i.set(e,h,f instanceof kn?f.toRenderColor(this.context.lut):f)}getBinding(e,i){return this.type==="color"?new Py(e):new $s(e)}}class td{constructor(e,i){this.uniformNames=i.map(o=>`u_${o}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,o,a,h){const f=h==="u_pattern"||h==="u_dash"?this.pattern:h==="u_pixel_ratio"?this.pixelRatio:null;f&&i.set(e,h,f)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new D0(e):new $s(e)}}class qc{constructor(e,i,o,a){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(h=>({name:`a_${h}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,i,o,a,h,f,x){const w=this.paintVertexArray.length,S=this.expression.evaluate(new $i(0,{brightness:f}),i,{},h,a,x);this.paintVertexArray.resize(e),this._setPaintValue(w,e,S,this.context)}updatePaintArray(e,i,o,a,h,f,x){const w=this.expression.evaluate({zoom:0,brightness:x},o,a,void 0,h);this._setPaintValue(e,i,w,this.context)}_setPaintValue(e,i,o,a){if(this.type==="color"){const h=k0(o.toRenderColor(a.lut));for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,h[0],h[1])}else{for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Pl{constructor(e,i,o,a,h,f){this.expression=e,this.uniformNames=i.map(x=>`u_${x}_t`),this.type=o,this.useIntegerZoom=a,this.context=h,this.maxValue=0,this.paintVertexAttributes=i.map(x=>({name:`a_${x}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,i,o,a,h,f,x){const w=this.expression.evaluate(new $i(this.context.zoom,{brightness:f}),i,{},h,a,x),S=this.expression.evaluate(new $i(this.context.zoom+1,{brightness:f}),i,{},h,a,x),P=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(P,e,w,S,this.context)}updatePaintArray(e,i,o,a,h,f,x){const w=this.expression.evaluate({zoom:this.context.zoom,brightness:x},o,a,void 0,h),S=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x},o,a,void 0,h);this._setPaintValue(e,i,w,S,this.context)}_setPaintValue(e,i,o,a,h){if(this.type==="color"){const f=k0(o.toRenderColor(h.lut)),x=k0(o.toRenderColor(h.lut));for(let w=e;w<i;w++)this.paintVertexArray.emplace(w,f[0],f[1],x[0],x[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,o,a);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,o,a,h){const f=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,x=Ki(this.expression.interpolationFactor(f,this.context.zoom,this.context.zoom+1),0,1);i.set(e,h,x)}getBinding(e,i){return new $s(e)}}class Tu{constructor(e,i,o,a,h){this.expression=e,this.layerId=h,this.paintVertexAttributes=(o==="array"?pE:fE).members;for(let f=0;f<i.length;++f);this.paintVertexArray=new a}populatePaintArray(e,i,o,a){const h=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(h,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,a,h,f,x){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],f)}_setPaintValues(e,i,o,a){if(!a||!o)return;const h=a[o];if(!h)return;const{tl:f,br:x,pixelRatio:w}=h;for(let S=e;S<i;S++)this.paintVertexArray.emplace(S,f[0],f[1],x[0],x[1],w)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fh{constructor(e,i,o=()=>!0){this.binders={},this._buffers=[],this.context=i;const a=[];for(const h in e.paint._values){const f=e.paint.get(h);if(!o(h)||!(f instanceof or&&Tf(f.property.specification)))continue;const x=vE(h,e.type),w=f.value,S=f.property.specification.type,P=!!f.property.useIntegerZoom,R=h==="line-dasharray"||h.endsWith("pattern"),B=h==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(w.kind!=="constant"||B)if(w.kind==="source"||B||R){const H=Dy(h,S,"source");this.binders[h]=R?new Tu(w,x,S,H,e.id):new qc(w,x,S,H),a.push(`/a_${h}`)}else{const H=Dy(h,S,"composite");this.binders[h]=new Pl(w,x,S,P,i,H),a.push(`/z_${h}`)}else this.binders[h]=R?new td(w.value,x):new Lf(w.value,x,S,i),a.push(`/u_${h}`)}this.cacheKey=a.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof qc||i instanceof Pl?i.maxValue:0}populatePaintArrays(e,i,o,a,h,f,x){for(const w in this.binders){const S=this.binders[w];S.context=this.context,(S instanceof qc||S instanceof Pl||S instanceof Tu)&&S.populatePaintArray(e,i,o,a,h,f,x)}}setConstantPatternPositions(e){for(const i in this.binders){const o=this.binders[i];o instanceof td&&o.setConstantPatternPositions(e)}}updatePaintArrays(e,i,o,a,h,f,x,w){let S=!1;const P=Object.keys(e),R=P.length!==0,B=R?P:i.uniqueIds;this.context.lut=h.lut;for(const H in this.binders){const $=this.binders[H];if($.context=this.context,($ instanceof qc||$ instanceof Pl||$ instanceof Tu)&&($.expression.isStateDependent===!0||$.expression.isLightConstant===!1)){const te=h.paint.get(H);$.expression=te.value;for(const ne of B){const de=e[ne.toString()];i.eachPosition(ne,(Se,Me,Le)=>{const ze=a.feature(Se);$.updatePaintArray(Me,Le,ze,de,f,x,w)})}if(!R)for(const ne of o.uniqueIds){const de=e[ne.toString()];o.eachPosition(ne,(Se,Me,Le)=>{const ze=a.feature(Se);$.updatePaintArray(Me,Le,ze,de,f,x,w)})}S=!0}}return S}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof Lf||o instanceof td)&&e.push(...o.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof qc||o instanceof Pl||o instanceof Tu)for(let a=0;a<o.paintVertexAttributes.length;a++)e.push(o.paintVertexAttributes[a].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Lf||o instanceof td||o instanceof Pl)for(const a of o.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const o in this.binders){const a=this.binders[o];if(a instanceof Lf||a instanceof td||a instanceof Pl)for(const h of a.uniformNames)i.push({name:h,property:o,binding:a.getBinding(e,h)})}return i}setUniforms(e,i,o,a,h){for(const{name:f,property:x,binding:w}of o)this.binders[x].setUniform(e,w,h,a.get(x),f)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof qc||i instanceof Pl||i instanceof Tu)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof qc||o instanceof Pl||o instanceof Tu)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof qc||i instanceof Pl||i instanceof Tu)&&i.destroy()}}}class Su{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new fh(a,i,o);this.needsUpload=!1,this._featureMap=new If,this._featureMapWithoutIds=new If,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,o,a,h,f,x,w){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(e,i,a,h,f,x,w);i.id!==void 0?this._featureMap.add(i.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,a,h,f){for(const x of o)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,x,a,h,f||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const yE={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function vE(t,e){return yE[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const xE={"line-pattern":{source:Cu,composite:Cu},"fill-pattern":{source:Cu,composite:Cu},"fill-extrusion-pattern":{source:Cu,composite:Cu},"line-dasharray":{source:pm,composite:pm}},wE={color:{source:ed,composite:wu},number:{source:hh,composite:ed}};function Dy(t,e,i){const o=xE[t];return o&&o[i]||wE[e][i]}xe(Lf,"ConstantBinder"),xe(td,"PatternConstantBinder"),xe(qc,"SourceExpressionBinder"),xe(Tu,"PatternCompositeBinder"),xe(Pl,"CompositeExpressionBinder"),xe(fh,"ProgramConfiguration",{omit:["_buffers"]}),xe(Su,"ProgramConfigurationSet");const Zs=Zt/Math.PI/2,B0=5,Ry=6,bE=16383,id=64,N0=[id,32,16],ul=-Zs,hl=Zs;function nd(t,e,i,o=Zs){return i=nn(i),[t*Math.sin(i)*o,-e*o,t*Math.cos(i)*o]}function ph(t,e,i){return nd(Math.cos(nn(t)),Math.sin(nn(t)),e,i)}const rd=63710088e-1,F0=2*Math.PI*rd;class Vn{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Vn(Na(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,a=e.lat*i,h=Math.sin(o)*Math.sin(a)+Math.cos(o)*Math.cos(a)*Math.cos((e.lng-this.lng)*i);return rd*Math.acos(Math.min(h,1))}toBounds(e=0){const i=360*e/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new Au({lng:this.lng-o,lat:this.lat-i},{lng:this.lng+o,lat:this.lat+i})}toEcef(e){return ph(this.lat,this.lng,Zs+e*Zs/rd)}static convert(e){if(e instanceof Vn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Vn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Vn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Au{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const o=e;this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]])}else{const o=e;this.setSouthWest(o[0]).setNorthEast(o[1])}}setNorthEast(e){return this._ne=e instanceof Vn?new Vn(e.lng,e.lat):Vn.convert(e),this}setSouthWest(e){return this._sw=e instanceof Vn?new Vn(e.lng,e.lat):Vn.convert(e),this}extend(e){const i=this._sw,o=this._ne;let a,h;if(e instanceof Vn)a=e,h=e;else{if(!(e instanceof Au))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Au.convert(e)):this.extend(Vn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Vn.convert(e)):this;if(a=e._sw,h=e._ne,!a||!h)return this}return i||o?(i.lng=Math.min(a.lng,i.lng),i.lat=Math.min(a.lat,i.lat),o.lng=Math.max(h.lng,o.lng),o.lat=Math.max(h.lat,o.lat)):(this._sw=new Vn(a.lng,a.lat),this._ne=new Vn(h.lng,h.lat)),this}getCenter(){return new Vn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Vn(this.getWest(),this.getNorth())}getSouthEast(){return new Vn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:o}=Vn.convert(e);let a=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&a}static convert(e){return!e||e instanceof Au?e:new Au(e)}}var ky={};(function(t,e){(function(i){function o(h,f,x){var w=a(256*h,256*(f=Math.pow(2,x)-f-1),x),S=a(256*(h+1),256*(f+1),x);return w[0]+","+w[1]+","+S[0]+","+S[1]}function a(h,f,x){var w=2*Math.PI*6378137/256/Math.pow(2,x);return[h*w-2*Math.PI*6378137/2,f*w-2*Math.PI*6378137/2]}i.getURL=function(h,f,x,w,S,P){return P=P||{},h+"?"+["bbox="+o(x,w,S),"format="+(P.format||"image/png"),"service="+(P.service||"WMS"),"version="+(P.version||"1.1.1"),"request="+(P.request||"GetMap"),"srs="+(P.srs||"EPSG:3857"),"width="+(P.width||256),"height="+(P.height||256),"layers="+f].join("&")},i.getTileBBox=o,i.getMercCoords=a,Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,ky);var CE=ky;class mh{constructor(e,i,o){this.z=e,this.x=i,this.y=o,this.key=Of(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const o=CE.getTileBBox(this.x,this.y,this.z),a=function(h,f,x){let w,S="";for(let P=h;P>0;P--)w=1<<P-1,S+=(f&w?1:0)+(x&w?2:0);return S}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class By{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Of(e,i.z,i.z,i.x,i.y)}}class jo{constructor(e,i,o,a,h){this.overscaledZ=e,this.wrap=i,this.canonical=new mh(o,+a,+h),this.key=i===0&&e===o?this.canonical.key:Of(i,e,o,a,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new jo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new jo(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Of(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return Of(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new jo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,a=2*this.canonical.y;return[new jo(i,this.wrap,i,o,a),new jo(i,this.wrap,i,o+1,a),new jo(i,this.wrap,i,o,a+1),new jo(i,this.wrap,i,o+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new jo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new jo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new By(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Of(t,e,i,o,a){const h=1<<Math.min(i,22);let f=h*(a%h)+o%h;return t&&i<22&&(f+=h*h*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*f+i)+(e-i)}const EE=[t=>{let e=t.canonical.x-1,i=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,i--),new jo(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,i=t.wrap;return e===1<<t.canonical.z&&(e=0,i++),new jo(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>new jo(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new jo(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];xe(mh,"CanonicalTileID"),xe(jo,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const TE=0,SE=25.5;function z0(t){return F0*Math.cos(t*Math.PI/180)}function dc(t){return(180+t)/360}function fc(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Xs(t,e){return t/z0(e)}function ca(t){return 360*t-180}function hs(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Ny(t,e){return t*z0(hs(e))}const mo=85.051129;function Fy(t){return Math.cos(nn(Ki(t,-mo,mo)))}function gh(t,e){const i=Ki(e,TE,SE),o=Math.pow(2,i);return Fy(t)*F0/(512*o)}function zy(t){return 1/Math.cos(t*Math.PI/180)}function xm(t,e=0){const i=Math.exp(Math.PI*(1-(t.y+e/Zt)/(1<<t.z)*2));return 80150034*i/(i*i+1)/Zt/(1<<t.z)}class Ls{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=Vn.convert(e);return new Ls(dc(o.lng),fc(o.lat),Xs(i,o.lat))}toLngLat(){return new Vn(ca(this.x),hs(this.y))}toAltitude(){return Ny(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/F0*zy(hs(this.y))}}function V0(t,e,i,o,a,h,f,x,w){const S=(e+o)/2,P=(i+a)/2,R=new Yt(S,P);x(R),function(B,H,$,te,ne,de){const Se=$-ne,Me=te-de;return Math.abs((te-H)*Se-($-B)*Me)/Math.hypot(Se,Me)}(R.x,R.y,h.x,h.y,f.x,f.y)>=w?(V0(t,e,i,S,P,h,R,x,w),V0(t,S,P,o,a,R,f,x,w)):t.push(f)}function Vy(t,e,i){let o=t[0],a=o.x,h=o.y;e(o);const f=[o];for(let x=1;x<t.length;x++){const w=t[x],{x:S,y:P}=w;e(w),V0(f,a,h,S,P,o,w,e,i),a=S,h=P,o=w}return f}function U0(t,e,i,o){if(o(e,i)){const a=e.add(i)._mult(.5);U0(t,e,a,o),U0(t,a,i,o)}else t.push(i)}function AE(t,e){let i=t[0];const o=[i];for(let a=1;a<t.length;a++){const h=t[a];U0(o,i,h,e),i=h}return o}const j0=Math.pow(2,14)-1,Uy=-j0-1;function IE(t,e){const i=Math.round(t.x*e),o=Math.round(t.y*e);return t.x=Ki(i,Uy,j0),t.y=Ki(o,Uy,j0),(i<t.x||i>t.x+1||o<t.y||o>t.y+1)&&Dr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Dl(t,e,i){const o=t.loadGeometry(),a=t.extent,h=Zt/a;if(e&&i&&i.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:x,x:w,y:S,projection:P}=i,R=B=>{const H=ca((e.x+B.x/a)/f),$=hs((e.y+B.y/a)/f),te=P.project(H,$);B.x=(te.x*x-w)*a,B.y=(te.y*x-S)*a};for(let B=0;B<o.length;B++)if(t.type!==1)o[B]=Vy(o[B],R,1);else{const H=[];for(const $ of o[B])$.x<0||$.x>=a||$.y<0||$.y>=a||(R($),H.push($));o[B]=H}}for(const f of o)for(const x of f)IE(x,h);return o}function Hc(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Dl(t):[]}}function wm(t,e,i,o,a){t.emplaceBack(2*e+(o+1)/2,2*i+(a+1)/2)}function bm(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class q0{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ol,this.indexArray=new ss,this.segments=new qr,this.programConfigurations=new Su(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}updateFootprints(e,i){}populate(e,i,o,a){const h=this.layers[0],f=[];let x=null;h.type==="circle"&&(x=h.layout.get("circle-sort-key"));for(const{feature:S,id:P,index:R,sourceLayerIndex:B}of e){const H=this.layers[0]._featureFilter.needGeometry,$=Hc(S,H);if(!this.layers[0]._featureFilter.filter(new $i(this.zoom),$,o))continue;const te=x?x.evaluate($,{},o):void 0,ne={id:P,properties:S.properties,type:S.type,sourceLayerIndex:B,index:R,geometry:H?$.geometry:Dl(S,o,a),patterns:{},sortKey:te};f.push(ne)}x&&f.sort((S,P)=>S.sortKey-P.sortKey);let w=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new mm,w=a.projection);for(const S of f){const{geometry:P,index:R,sourceLayerIndex:B}=S,H=e[R].feature;this.addFeature(S,P,R,i.availableImages,o,w,i.brightness),i.featureIndex.insert(H,P,R,B,this.index)}}update(e,i,o,a,h){const f=Object.keys(e).length!==0;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,f?this.stateDependentLayers:this.layers,o,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,dE.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,o,a,h,f,x){for(const w of i)for(const S of w){const P=S.x,R=S.y;if(P<0||P>=Zt||R<0||R>=Zt)continue;if(f){const $=f.projectTilePoint(P,R,h),te=f.upVector(h,P,R),ne=this.globeExtVertexArray;bm(ne,$,te),bm(ne,$,te),bm(ne,$,te),bm(ne,$,te)}const B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),H=B.vertexLength;wm(this.layoutVertexArray,P,R,-1,-1),wm(this.layoutVertexArray,P,R,1,-1),wm(this.layoutVertexArray,P,R,1,1),wm(this.layoutVertexArray,P,R,-1,1),this.indexArray.emplaceBack(H,H+1,H+2),this.indexArray.emplaceBack(H,H+2,H+3),B.vertexLength+=4,B.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},a,h,x)}}function H0(t,e){for(let i=0;i<t.length;i++)if(Iu(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Iu(t,e[i]))return!0;return!!G0(t,e)}function ME(t,e,i){return!!Iu(t,e)||!!W0(e,t,i)}function jy(t,e){if(t.length===1)return Hy(e,t[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let a=0;a<o.length;a++)if(Iu(t,o[a]))return!0}for(let i=0;i<t.length;i++)if(Hy(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(G0(t,e[i]))return!0;return!1}function LE(t,e,i){if(t.length>1){if(G0(t,e))return!0;for(let o=0;o<e.length;o++)if(W0(e[o],t,i))return!0}for(let o=0;o<t.length;o++)if(W0(t[o],e,i))return!0;return!1}function G0(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){const o=t[i],a=t[i+1];for(let h=0;h<e.length-1;h++)if(OE(o,a,e[h],e[h+1]))return!0}return!1}function OE(t,e,i,o){return Ir(t,i,o)!==Ir(e,i,o)&&Ir(t,e,i)!==Ir(t,e,o)}function W0(t,e,i){const o=i*i;if(e.length===1)return t.distSqr(e[0])<o;for(let a=1;a<e.length;a++)if(qy(t,e[a-1],e[a])<o)return!0;return!1}function qy(t,e,i){const o=e.distSqr(i);if(o===0)return t.distSqr(e);const a=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/o;return t.distSqr(a<0?e:a>1?i:i.sub(e)._mult(a)._add(e))}function Hy(t,e){let i,o,a,h=!1;for(let f=0;f<t.length;f++){i=t[f];for(let x=0,w=i.length-1;x<i.length;w=x++)o=i[x],a=i[w],o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(h=!h)}return h}function Iu(t,e){let i=!1;for(let o=0,a=t.length-1;o<t.length;a=o++){const h=t[o],f=t[a];h.y>e.y!=f.y>e.y&&e.x<(f.x-h.x)*(e.y-h.y)/(f.y-h.y)+h.x&&(i=!i)}return i}function Gy(t,e,i,o,a){for(const f of t)if(e<=f.x&&i<=f.y&&o>=f.x&&a>=f.y)return!0;const h=[new Yt(e,i),new Yt(e,a),new Yt(o,a),new Yt(o,i)];if(t.length>2){for(const f of h)if(Iu(t,f))return!0}for(let f=0;f<t.length-1;f++)if(PE(t[f],t[f+1],h))return!0;return!1}function PE(t,e,i){const o=i[0],a=i[2];if(t.x<o.x&&e.x<o.x||t.x>a.x&&e.x>a.x||t.y<o.y&&e.y<o.y||t.y>a.y&&e.y>a.y)return!1;const h=Ir(t,e,i[0]);return h!==Ir(t,e,i[1])||h!==Ir(t,e,i[2])||h!==Ir(t,e,i[3])}function od(t,e,i,o,a,h){let f=e.y-t.y,x=t.x-e.x;if(h=h||0){const w=f*f+x*x;if(w===0)return!0;const S=Math.sqrt(w);f/=S,x/=S}return!((i.x-t.x)*f+(i.y-t.y)*x-h<0||(o.x-t.x)*f+(o.y-t.y)*x-h<0||(a.x-t.x)*f+(a.y-t.y)*x-h<0)}function $0(t,e,i,o,a,h,f){return!(od(t,e,o,a,h,f)||od(e,i,o,a,h,f)||od(i,t,o,a,h,f)||od(o,a,t,e,i,f)||od(a,h,t,e,i,f)||od(h,o,t,e,i,f))}function sd(t,e,i){const o=e.paint.get(t).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(t)}function Cm(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Wy(t,e,i,o,a){if(!e[0]&&!e[1])return t;const h=Yt.convert(e)._mult(a);i==="viewport"&&h._rotate(-o);const f=[];for(let x=0;x<t.length;x++)f.push(t[x].sub(h));return f}function $y(t,e,i,o){const a=Yt.convert(t)._mult(o);return e==="viewport"&&a._rotate(-i),a}xe(q0,"CircleBucket",{omit:["layers"]});const DE=new Wn({"circle-sort-key":new li(lt.layout_circle["circle-sort-key"]),visibility:new It(lt.layout_circle.visibility)});var RE={paint:new Wn({"circle-radius":new li(lt.paint_circle["circle-radius"]),"circle-color":new li(lt.paint_circle["circle-color"]),"circle-blur":new li(lt.paint_circle["circle-blur"]),"circle-opacity":new li(lt.paint_circle["circle-opacity"]),"circle-translate":new It(lt.paint_circle["circle-translate"]),"circle-translate-anchor":new It(lt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new It(lt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new It(lt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new li(lt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new li(lt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new li(lt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new It(lt.paint_circle["circle-emissive-strength"])}),layout:DE};class Z0{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const a=r._.dot(i,this.dir);if(Math.abs(a)<1e-6)return!1;const h=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/a;return o[0]=this.pos[0]+this.dir[0]*h,o[1]=this.pos[1]+this.dir[1]*h,o[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(e,i,o){if(r._.equals(this.pos,e)||i===0)return o[0]=o[1]=o[2]=0,!1;const[a,h,f]=this.dir,x=this.pos[0]-e[0],w=this.pos[1]-e[1],S=this.pos[2]-e[2],P=a*a+h*h+f*f,R=2*(x*a+w*h+S*f),B=R*R-4*P*(x*x+w*w+S*S-i*i);if(B<0){const H=Math.max(-R/2,0),$=x+a*H,te=w+h*H,ne=S+f*H,de=Math.hypot($,te,ne);return o[0]=$*i/de,o[1]=te*i/de,o[2]=ne*i/de,!1}{const H=(-R-Math.sqrt(B))/(2*P);if(H<0){const $=Math.hypot(x,w,S);return o[0]=x*i/$,o[1]=w*i/$,o[2]=S*i/$,!1}return o[0]=x+a*H,o[1]=w+h*H,o[2]=S+f*H,!0}}}class X0{constructor(e,i,o,a,h){this.TL=e,this.TR=i,this.BR=o,this.BL=a,this.horizon=h}static fromInvProjectionMatrix(e,i,o){const a=[-1,1,1],h=[1,1,1],f=[1,-1,1],x=[-1,-1,1],w=r._.transformMat4(a,a,e),S=r._.transformMat4(h,h,e),P=r._.transformMat4(f,f,e),R=r._.transformMat4(x,x,e);return new X0(w,S,P,R,i/o)}}function Pf(t,e,i){let o=1/0,a=-1/0;const h=[];for(const f of t){r._.sub(h,f,e);const x=r._.dot(h,i);o=Math.min(o,x),a=Math.max(a,x)}return[o,a]}function Zy(t,e){let i=!0;for(let o=0;o<t.planes.length;o++){const a=t.planes[o];let h=0;for(let f=0;f<e.length;f++)h+=r._.dot(a,e[f])+a[3]>=0;if(h===0)return 0;h!==e.length&&(i=!1)}return i?2:1}function Xy(t,e){for(const i of t.projections){const o=Pf(e,t.points[0],i.axis);if(i.projection[1]<o[0]||i.projection[0]>o[1])return 0}return 1}function Yy(t,e){let i=0;const o=[0,0,0,0];for(let a=0;a<t.length;a++)o[0]=t[a][0],o[1]=t[a][1],o[2]=t[a][2],o[3]=1,r.aA.dot(o,e)>=0&&i++;return i}class Y0{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Nr.fromPoints(this.points),this.projections=[],this.frustumEdges=[r._.sub([],this.points[2],this.points[3]),r._.sub([],this.points[0],this.points[3]),r._.sub([],this.points[4],this.points[0]),r._.sub([],this.points[5],this.points[1]),r._.sub([],this.points[6],this.points[2]),r._.sub([],this.points[7],this.points[3])];for(const o of this.frustumEdges){const a=[0,-o[2],o[1]],h=[o[2],0,-o[0]];this.projections.push({axis:a,projection:Pf(this.points,this.points[0],a)}),this.projections.push({axis:h,projection:Pf(this.points,this.points[0],h)})}}static fromInvProjectionMatrix(e,i,o,a){const h=Math.pow(2,o),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const P=r.aA.transformMat4([],S,e),R=1/P[3]/i*h;return r.aA.mul(P,P,[R,R,a?1/P[3]:R,R])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const P=r._.sub([],f[S[0]],f[S[1]]),R=r._.sub([],f[S[2]],f[S[1]]),B=r._.normalize([],r._.cross([],P,R)),H=-r._.dot(B,f[S[1]]);return B.concat(H)}),w=[];for(let S=0;S<f.length;S++)w.push([f[S][0],f[S][1],f[S][2]]);return new Y0(w,x)}intersectsPrecise(e,i,o){for(let a=0;a<i.length;a++)if(!Yy(e,i[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!Yy(e,this.planes[a]))return 0;for(const a of o)for(const h of this.frustumEdges){const f=r._.cross([],a,h),x=r._.length(f);if(x===0)continue;r._.scale(f,f,1/x);const w=Pf(this.points,this.points[0],f),S=Pf(e,this.points[0],f);if(w[0]>S[1]||S[0]>w[1])return 0}return 1}}class Nr{static fromPoints(e){const i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(const a of e)r._.min(i,i,a),r._.max(o,o,a);return new Nr(i,o)}static fromTileIdAndHeight(e,i,o){const a=1<<e.canonical.z,h=e.canonical.x,f=e.canonical.y;return new Nr([h/a,f/a,i],[(h+1)/a,(f+1)/a,o])}static applyTransform(e,i){const o=e.getCorners();for(let a=0;a<o.length;++a)r._.transformMat4(o[a],o[a],i);return Nr.fromPoints(o)}static applyTransformFast(e,i){const o=[i[12],i[13],i[14]],a=[...o];for(let h=0;h<3;h++)for(let f=0;f<3;f++){const x=i[4*f+h],w=x*e.min[f],S=x*e.max[f];o[h]+=Math.min(w,S),a[h]+=Math.max(w,S)}return new Nr(o,a)}static projectAabbCorners(e,i){const o=e.getCorners();for(let a=0;a<o.length;++a)r._.transformMat4(o[a],o[a],i);return o}constructor(e,i){this.min=e,this.max=i,this.center=r._.scale([],r._.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],o=r._.clone(this.min),a=r._.clone(this.max);for(let h=0;h<i.length;h++)o[h]=i[h]?this.min[h]:this.center[h],a[h]=i[h]?this.center[h]:this.max[h];return a[2]=this.max[2],new Nr(o,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Zy(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Zy(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Xy(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Xy(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}xe(Nr,"Aabb");const kE=Yn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Em}=kE,Ky=Yn([{name:"a_pos_3",components:3,type:"Int16"}]);var Df=Yn([{name:"a_pos",type:"Int16",components:2}]);function Tm(t){return t*Zs/rd}const BE=[new Nr([ul,ul,ul],[hl,hl,hl]),new Nr([ul,ul,ul],[0,0,hl]),new Nr([0,ul,ul],[hl,0,hl]),new Nr([ul,0,ul],[0,hl,hl]),new Nr([0,0,ul],[hl,hl,hl])];function Qy(t,e,i,o=!0){const a=r._.scale([],t._camera.position,t.worldSize),h=[e,i,1,1];r.aA.transformMat4(h,h,t.pixelMatrixInverse),r.aA.scale(h,h,1/h[3]);const f=r._.sub([],h,a),x=r._.normalize([],f),w=t.globeMatrix,S=[w[12],w[13],w[14]],P=r._.sub([],S,a),R=r._.length(P),B=r._.normalize([],P),H=t.worldSize/(2*Math.PI),$=r._.dot(B,x),te=Math.asin(H/R);if(te<Math.acos($)){if(!o)return null;const dt=[],St=[];r._.scale(dt,x,R/$),r._.normalize(St,r._.sub(St,dt,P)),r._.normalize(x,r._.add(x,P,r._.scale(x,St,Math.tan(te)*R)))}const ne=[];new Z0(a,x).closestPointOnSphere(S,H,ne);const de=r._.normalize([],cs(w,0)),Se=r._.normalize([],cs(w,1)),Me=r._.normalize([],cs(w,2)),Le=r._.dot(de,ne),ze=r._.dot(Se,ne),Fe=r._.dot(Me,ne),Xe=ho(Math.asin(-ze/H));let et=ho(Math.atan2(Le,Fe));et=t.center.lng+function(dt,St){const Vt=(St-dt+180)%360-180;return Vt<-180?Vt+360:Vt}(t.center.lng,et);const st=dc(et),_t=Ki(fc(Xe),0,1);return new Ls(st,_t)}class NE{constructor(e,i,o){this.a=r._.sub([],e,o),this.b=r._.sub([],i,o),this.center=o;const a=r._.normalize([],this.a),h=r._.normalize([],this.b);this.angle=Math.acos(r._.dot(a,h))}}function K0(t,e){if(t.angle===0)return null;let i;return i=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(o,a,h,f){const x=Math.sin(h);return o*(Math.sin((1-f)*h)/x)+a*(Math.sin(f*h)/x)}(t.a[e],t.b[e],t.angle,Ki(i,0,1))+t.center[e]}function pc(t){if(t.z<=1)return BE[t.z+2*t.y+t.x];const e=Q0(Sm(t));return Nr.fromPoints(e)}function Gc(t,e,i){return r._.scale(t,t,1-i),r._.scaleAndAdd(t,t,e,i)}function Jy(t,e){const i=Wc(e.zoom);if(i===0)return pc(t);const o=Sm(t),a=Q0(o),h=dc(o.getWest())*e.worldSize,f=dc(o.getEast())*e.worldSize,x=fc(o.getNorth())*e.worldSize,w=fc(o.getSouth())*e.worldSize,S=[h,x,0],P=[f,x,0],R=[h,w,0],B=[f,w,0],H=r.ad.invert([],e.globeMatrix);return r._.transformMat4(S,S,H),r._.transformMat4(P,P,H),r._.transformMat4(R,R,H),r._.transformMat4(B,B,H),a[0]=Gc(a[0],R,i),a[1]=Gc(a[1],B,i),a[2]=Gc(a[2],P,i),a[3]=Gc(a[3],S,i),Nr.fromPoints(a)}function ev(t,e,i){for(const o of t)r._.transformMat4(o,o,e),r._.scale(o,o,i)}function tv(t,e,i,o){const a=e/t.worldSize,h=t.globeMatrix;if(i.z<=1){const st=pc(i).getCorners();return ev(st,h,a),Nr.fromPoints(st)}const f=Sm(i,o),x=Q0(f,Zs+Tm(t._tileCoverLift));ev(x,h,a);const w=Number.MAX_VALUE,S=[-w,-w,-w],P=[w,w,w];if(f.contains(t.center)){for(const dt of x)r._.min(P,P,dt),r._.max(S,S,dt);S[2]=0;const st=t.point,_t=[st.x*a,st.y*a,0];return r._.min(P,P,_t),r._.max(S,S,_t),new Nr(P,S)}if(t._tileCoverLift>0){for(const st of x)r._.min(P,P,st),r._.max(S,S,st);return new Nr(P,S)}const R=[h[12]*a,h[13]*a,h[14]*a],B=f.getCenter(),H=Ki(t.center.lat,-mo,mo),$=Ki(B.lat,-mo,mo),te=dc(t.center.lng),ne=fc(H);let de=te-dc(B.lng);const Se=ne-fc($);de>.5?de-=1:de<-.5&&(de+=1);let Me=0;if(Math.abs(de)>Math.abs(Se))Me=de>=0?1:3;else{Me=Se>=0?0:2;const st=[h[4]*a,h[5]*a,h[6]*a],_t=-Math.sin(nn(Se>=0?f.getSouth():f.getNorth()))*Zs;r._.scaleAndAdd(R,R,st,_t)}const Le=x[Me],ze=x[(Me+1)%4],Fe=new NE(Le,ze,R),Xe=[K0(Fe,0)||Le[0],K0(Fe,1)||Le[1],K0(Fe,2)||Le[2]],et=Wc(t.zoom);if(et>0){const st=function({x:dt,y:St,z:Vt},bt,kt,yt,Bt){const jt=1/(1<<Vt);let zt=dt*jt,ri=zt+jt,Ut=St*jt,Ht=Ut+jt,Di=0;const Si=(zt+ri)/2-yt;return Si>.5?Di=-1:Si<-.5&&(Di=1),zt=((zt+Di)*bt-(yt*=bt))*kt+yt,ri=((ri+Di)*bt-yt)*kt+yt,Ut=(Ut*bt-(Bt*=bt))*kt+Bt,Ht=(Ht*bt-Bt)*kt+Bt,[[zt,Ht,0],[ri,Ht,0],[ri,Ut,0],[zt,Ut,0]]}(i,e,t._pixelsPerMercatorPixel,te,ne);for(let dt=0;dt<x.length;dt++)Gc(x[dt],st[dt],et);const _t=r._.add([],st[Me],st[(Me+1)%4]);r._.scale(_t,_t,.5),Gc(Xe,_t,et)}for(const st of x)r._.min(P,P,st),r._.max(S,S,st);return P[2]=Math.min(Le[2],ze[2]),r._.min(P,P,Xe),r._.max(S,S,Xe),new Nr(P,S)}function Sm({x:t,y:e,z:i},o=!1){const a=1/(1<<i),h=new Vn(ca(t*a),e===(1<<i)-1&&o?-90:hs((e+1)*a)),f=new Vn(ca((t+1)*a),e===0&&o?90:hs(e*a));return new Au(h,f)}function Q0(t,e=Zs){const i=nn(t.getNorth()),o=nn(t.getSouth()),a=Math.cos(i),h=Math.cos(o),f=Math.sin(i),x=Math.sin(o),w=t.getWest(),S=t.getEast();return[nd(h,x,w,e),nd(h,x,S,e),nd(a,f,S,e),nd(a,f,w,e)]}function Rf(t,e,i,o){const a=1<<i.z,h=(t/Zt+i.x)/a;return ph(hs((e/Zt+i.y)/a),ca(h),o)}function Am({min:t,max:e}){return bE/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const iv=new Float64Array(16);function kf(t){const e=Am(t),i=r.ad.fromScaling(iv,[e,e,e]);return r.ad.translate(i,i,r._.negate([],t.min))}function J0(t){const e=r.ad.fromTranslation(iv,t.min),i=1/Am(t);return r.ad.scale(e,e,[i,i,i])}function e1(t){const e=Zt/(2*Math.PI);return t/(2*Math.PI)/e}function nv(t,e){return Zt/(512*Math.pow(2,t))*Am(pc(e))}function rv(t,e,i,o,a){const h=e1(i),f=[t,e,-i/(2*Math.PI)],x=r.ad.identity(new Float64Array(16));return r.ad.translate(x,x,f),r.ad.scale(x,x,[h,h,h]),r.ad.rotateX(x,x,nn(-a)),r.ad.rotateY(x,x,nn(-o)),x}function Wc(t){return il(B0,Ry,t)}function ov(t,e){const i=ph(e.lat,e.lng),o=function(h){const f=ph(h._center.lat,h._center.lng),x=r._.fromValues(0,1,0);let w=r._.cross([],x,f);const S=r.ad.fromRotation([],-h.angle,f);w=r._.transformMat4(w,w,S),r.ad.fromRotation(S,-h._pitch,w);const P=r._.normalize([],f);return r._.scale(P,P,Tm(h.cameraToCenterDistance/h.pixelsPerMeter)),r._.transformMat4(P,P,S),r._.add([],f,P)}(t),a=r._.subtract([],o,i);return r._.angle(a,i)}function t1(t,e){return ov(t,e)>Math.PI/2*1.01}const sv=nn(85),FE=Math.cos(sv),zE=Math.sin(sv),VE=r.ad.create(),av=t=>{const e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function lv(t,e,i,o,a,h,f,x,w){if(h&&t.queryGeometry.isAboveHorizon)return!1;h&&(w*=t.pixelToTileUnitsFactor);const S=t.tileID.canonical,P=i.projection.upVectorScale(S,i.center.lat,i.worldSize).metersToTile;for(const R of e)for(const B of R){const H=B.add(x),$=a&&i.elevation?i.elevation.exaggeration()*a.getElevationAt(H.x,H.y,!0):0,te=i.projection.projectTilePoint(H.x,H.y,S);if($>0){const Me=i.projection.upVector(S,H.x,H.y);te.x+=Me[0]*P*$,te.y+=Me[1]*P*$,te.z+=Me[2]*P*$}const ne=h?H:UE(te.x,te.y,te.z,o),de=h?t.tilespaceRays.map(Me=>qE(Me,$)):t.queryGeometry.screenGeometry,Se=r.aA.transformMat4([],[te.x,te.y,te.z,1],o);if(!f&&h?w*=Se[3]/i.cameraToCenterDistance:f&&!h&&(w*=i.cameraToCenterDistance/Se[3]),h){const Me=hs((B.y/Zt+S.y)/(1<<S.z));w/=i.projection.pixelsPerMeter(Me,1)/Xs(1,Me)}if(ME(de,ne,w))return!0}return!1}function UE(t,e,i,o){const a=r.aA.transformMat4([],[t,e,i,1],o);return new Yt(a[0]/a[3],a[1]/a[3])}const cv=r._.fromValues(0,0,0),jE=r._.fromValues(0,0,1);function qE(t,e){const i=r._.create();return cv[2]=e,t.intersectsPlane(cv,jE,i),new Yt(i[0],i[1])}class uv extends q0{}function hv(t,{width:e,height:i},o,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*i*o)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*i*o);return t.width=e,t.height=i,t.data=a,t}function dv(t,e,i){const{width:o,height:a}=e;o===t.width&&a===t.height||(i1(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,o),height:Math.min(t.height,a)},i,null),t.width=o,t.height=a,t.data=e.data)}function i1(t,e,i,o,a,h,f,x){if(a.width===0||a.height===0)return e;if(a.width>t.width||a.height>t.height||i.x>t.width-a.width||i.y>t.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||o.x>e.width-a.width||o.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const w=t.data,S=e.data,P=h===4&&x;for(let R=0;R<a.height;R++){const B=((i.y+R)*t.width+i.x)*h,H=((o.y+R)*e.width+o.x)*h;if(P)for(let $=0;$<a.width;$++){const te=B+$*h+3,ne=H+$*h;S[ne+0]=255,S[ne+1]=255,S[ne+2]=255,S[ne+3]=w[te]}else if(f)for(let $=0;$<a.width;$++){const te=B+$*h,ne=H+$*h,de=w[te+3],Se=new kn(w[te+0]/255*de,w[te+1]/255*de,w[te+2]/255*de,de).toRenderColor(f).toArray();S[ne+0]=Se[0],S[ne+1]=Se[1],S[ne+2]=Se[2],S[ne+3]=Se[3]}else for(let $=0;$<a.width*h;$++)S[H+$]=w[B+$]}return e}xe(uv,"HeatmapBucket",{omit:["layers"]});class Mu{constructor(e,i){hv(this,e,1,i)}resize(e){dv(this,new Mu(e),1)}clone(){return new Mu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,a,h){i1(e,i,o,a,h,1,null)}}class Za{constructor(e,i){hv(this,e,4,i)}resize(e){dv(this,new Za(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Za({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,a,h,f,x){i1(e,i,o,a,h,4,f,x)}}class fv{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}xe(Mu,"AlphaImage"),xe(Za,"RGBAImage");const HE=new Wn({visibility:new It(lt.layout_heatmap.visibility)});var GE={paint:new Wn({"heatmap-radius":new li(lt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new li(lt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new It(lt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new rs(lt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new It(lt.paint_heatmap["heatmap-opacity"])}),layout:HE};function Bf(t){const e={},i=t.resolution||256,o=t.clips?t.clips.length:1,a=t.image||new Za({width:i,height:o}),h=(f,x,w)=>{e[t.evaluationKey]=w;const S=t.expression.evaluate(e);S&&(a.data[f+x+0]=Math.floor(255*S.r/S.a),a.data[f+x+1]=Math.floor(255*S.g/S.a),a.data[f+x+2]=Math.floor(255*S.b/S.a),a.data[f+x+3]=Math.floor(255*S.a))};if(t.clips)for(let f=0,x=0;f<o;++f,x+=4*i)for(let w=0,S=0;w<i;w++,S+=4){const P=w/(i-1),{start:R,end:B}=t.clips[f];h(x,S,R*(1-P)+B*P)}else for(let f=0,x=0;f<i;f++,x+=4)h(0,x,f/(i-1));return a}const WE=new Wn({visibility:new It(lt.layout_hillshade.visibility)});var $E={paint:new Wn({"hillshade-illumination-direction":new It(lt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new It(lt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new It(lt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new It(lt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new It(lt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new It(lt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new It(lt.paint_hillshade["hillshade-emissive-strength"])}),layout:WE};const ZE=Yn([{name:"a_pos",components:2,type:"Int16"}],4),{members:XE}=ZE;function Nf(t,e,i=2){const o=e&&e.length,a=o?e[0]*i:t.length;let h=pv(t,0,a,i,!0);const f=[];if(!h||h.next===h.prev)return f;let x,w,S;if(o&&(h=function(P,R,B,H){const $=[];for(let te=0,ne=R.length;te<ne;te++){const de=pv(P,R[te]*H,te<ne-1?R[te+1]*H:P.length,H,!1);de===de.next&&(de.steiner=!0),$.push(nT(de))}$.sort(eT);for(let te=0;te<$.length;te++)B=tT($[te],B);return B}(t,e,h,i)),t.length>80*i){x=1/0,w=1/0;let P=-1/0,R=-1/0;for(let B=i;B<a;B+=i){const H=t[B],$=t[B+1];H<x&&(x=H),$<w&&(w=$),H>P&&(P=H),$>R&&(R=$)}S=Math.max(P-x,R-w),S=S!==0?32767/S:0}return Ff(h,f,i,x,w,S,0),f}function pv(t,e,i,o,a){let h;if(a===function(f,x,w,S){let P=0;for(let R=x,B=w-S;R<w;R+=S)P+=(f[B]-f[R])*(f[R+1]+f[B+1]),B=R;return P}(t,e,i,o)>0)for(let f=e;f<i;f+=o)h=_v(f/o|0,t[f],t[f+1],h);else for(let f=i-o;f>=e;f-=o)h=_v(f/o|0,t[f],t[f+1],h);return h&&Im(h,h.next)&&(Vf(h),h=h.next),h}function _h(t,e){if(!t)return t;e||(e=t);let i,o=t;do if(i=!1,o.steiner||!Im(o,o.next)&&qo(o.prev,o,o.next)!==0)o=o.next;else{if(Vf(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function Ff(t,e,i,o,a,h,f){if(!t)return;!f&&h&&function(w,S,P,R){let B=w;do B.z===0&&(B.z=n1(B.x,B.y,S,P,R)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==w);B.prevZ.nextZ=null,B.prevZ=null,function(H){let $,te=1;do{let ne,de=H;H=null;let Se=null;for($=0;de;){$++;let Me=de,Le=0;for(let Fe=0;Fe<te&&(Le++,Me=Me.nextZ,Me);Fe++);let ze=te;for(;Le>0||ze>0&&Me;)Le!==0&&(ze===0||!Me||de.z<=Me.z)?(ne=de,de=de.nextZ,Le--):(ne=Me,Me=Me.nextZ,ze--),Se?Se.nextZ=ne:H=ne,ne.prevZ=Se,Se=ne;de=Me}Se.nextZ=null,te*=2}while($>1)}(B)}(t,o,a,h);let x=t;for(;t.prev!==t.next;){const w=t.prev,S=t.next;if(h?KE(t,o,a,h):YE(t))e.push(w.i,t.i,S.i),Vf(t),t=S.next,x=S.next;else if((t=S)===x){f?f===1?Ff(t=QE(_h(t),e),e,i,o,a,h,2):f===2&&JE(t,e,i,o,a,h):Ff(_h(t),e,i,o,a,h,1);break}}}function YE(t){const e=t.prev,i=t,o=t.next;if(qo(e,i,o)>=0)return!1;const a=e.x,h=i.x,f=o.x,x=e.y,w=i.y,S=o.y,P=a<h?a<f?a:f:h<f?h:f,R=x<w?x<S?x:S:w<S?w:S,B=a>h?a>f?a:f:h>f?h:f,H=x>w?x>S?x:S:w>S?w:S;let $=o.next;for(;$!==e;){if($.x>=P&&$.x<=B&&$.y>=R&&$.y<=H&&ad(a,x,h,w,f,S,$.x,$.y)&&qo($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function KE(t,e,i,o){const a=t.prev,h=t,f=t.next;if(qo(a,h,f)>=0)return!1;const x=a.x,w=h.x,S=f.x,P=a.y,R=h.y,B=f.y,H=x<w?x<S?x:S:w<S?w:S,$=P<R?P<B?P:B:R<B?R:B,te=x>w?x>S?x:S:w>S?w:S,ne=P>R?P>B?P:B:R>B?R:B,de=n1(H,$,e,i,o),Se=n1(te,ne,e,i,o);let Me=t.prevZ,Le=t.nextZ;for(;Me&&Me.z>=de&&Le&&Le.z<=Se;){if(Me.x>=H&&Me.x<=te&&Me.y>=$&&Me.y<=ne&&Me!==a&&Me!==f&&ad(x,P,w,R,S,B,Me.x,Me.y)&&qo(Me.prev,Me,Me.next)>=0||(Me=Me.prevZ,Le.x>=H&&Le.x<=te&&Le.y>=$&&Le.y<=ne&&Le!==a&&Le!==f&&ad(x,P,w,R,S,B,Le.x,Le.y)&&qo(Le.prev,Le,Le.next)>=0))return!1;Le=Le.nextZ}for(;Me&&Me.z>=de;){if(Me.x>=H&&Me.x<=te&&Me.y>=$&&Me.y<=ne&&Me!==a&&Me!==f&&ad(x,P,w,R,S,B,Me.x,Me.y)&&qo(Me.prev,Me,Me.next)>=0)return!1;Me=Me.prevZ}for(;Le&&Le.z<=Se;){if(Le.x>=H&&Le.x<=te&&Le.y>=$&&Le.y<=ne&&Le!==a&&Le!==f&&ad(x,P,w,R,S,B,Le.x,Le.y)&&qo(Le.prev,Le,Le.next)>=0)return!1;Le=Le.nextZ}return!0}function QE(t,e){let i=t;do{const o=i.prev,a=i.next.next;!Im(o,a)&&mv(o,i,i.next,a)&&zf(o,a)&&zf(a,o)&&(e.push(o.i,i.i,a.i),Vf(i),Vf(i.next),i=t=a),i=i.next}while(i!==t);return _h(i)}function JE(t,e,i,o,a,h){let f=t;do{let x=f.next.next;for(;x!==f.prev;){if(f.i!==x.i&&rT(f,x)){let w=gv(f,x);return f=_h(f,f.next),w=_h(w,w.next),Ff(f,e,i,o,a,h,0),void Ff(w,e,i,o,a,h,0)}x=x.next}f=f.next}while(f!==t)}function eT(t,e){return t.x-e.x}function tT(t,e){const i=function(a,h){let f=h;const x=a.x,w=a.y;let S,P=-1/0;do{if(w<=f.y&&w>=f.next.y&&f.next.y!==f.y){const te=f.x+(w-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(te<=x&&te>P&&(P=te,S=f.x<f.next.x?f:f.next,te===x))return S}f=f.next}while(f!==h);if(!S)return null;const R=S,B=S.x,H=S.y;let $=1/0;f=S;do{if(x>=f.x&&f.x>=B&&x!==f.x&&ad(w<H?x:P,w,B,H,w<H?P:x,w,f.x,f.y)){const te=Math.abs(w-f.y)/(x-f.x);zf(f,a)&&(te<$||te===$&&(f.x>S.x||f.x===S.x&&iT(S,f)))&&(S=f,$=te)}f=f.next}while(f!==R);return S}(t,e);if(!i)return e;const o=gv(i,t);return _h(o,o.next),_h(i,i.next)}function iT(t,e){return qo(t.prev,t,e.prev)<0&&qo(e.next,t,t.next)<0}function n1(t,e,i,o,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function nT(t){let e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function ad(t,e,i,o,a,h,f,x){return(a-f)*(e-x)>=(t-f)*(h-x)&&(t-f)*(o-x)>=(i-f)*(e-x)&&(i-f)*(h-x)>=(a-f)*(o-x)}function rT(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,o){let a=i;do{if(a.i!==i.i&&a.next.i!==i.i&&a.i!==o.i&&a.next.i!==o.i&&mv(a,a.next,i,o))return!0;a=a.next}while(a!==i);return!1}(t,e)&&(zf(t,e)&&zf(e,t)&&function(i,o){let a=i,h=!1;const f=(i.x+o.x)/2,x=(i.y+o.y)/2;do a.y>x!=a.next.y>x&&a.next.y!==a.y&&f<(a.next.x-a.x)*(x-a.y)/(a.next.y-a.y)+a.x&&(h=!h),a=a.next;while(a!==i);return h}(t,e)&&(qo(t.prev,t,e.prev)||qo(t,e.prev,e))||Im(t,e)&&qo(t.prev,t,t.next)>0&&qo(e.prev,e,e.next)>0)}function qo(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Im(t,e){return t.x===e.x&&t.y===e.y}function mv(t,e,i,o){const a=Lm(qo(t,e,i)),h=Lm(qo(t,e,o)),f=Lm(qo(i,o,t)),x=Lm(qo(i,o,e));return a!==h&&f!==x||!(a!==0||!Mm(t,i,e))||!(h!==0||!Mm(t,o,e))||!(f!==0||!Mm(i,t,o))||!(x!==0||!Mm(i,e,o))}function Mm(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Lm(t){return t>0?1:t<0?-1:0}function zf(t,e){return qo(t.prev,t,t.next)<0?qo(t,e,t.next)>=0&&qo(t,t.prev,e)>=0:qo(t,e,t.prev)<0||qo(t,t.next,e)<0}function gv(t,e){const i=r1(t.i,t.x,t.y),o=r1(e.i,e.x,e.y),a=t.next,h=e.prev;return t.next=e,e.prev=t,i.next=a,a.prev=i,o.next=i,i.prev=o,h.next=o,o.prev=h,o}function _v(t,e,i,o){const a=r1(t,e,i);return o?(a.next=o.next,a.prev=o,o.next.prev=a,o.next=a):(a.prev=a,a.next=a),a}function Vf(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function r1(t,e,i){return{i:t,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Om(t,e){const i=t.length;if(i<=1)return[t];const o=[];let a,h;for(let f=0;f<i;f++){const x=Rr(t[f]);x!==0&&(t[f].area=Math.abs(x),h===void 0&&(h=x<0),h===x<0?(a&&o.push(a),a=[t[f]]):a.push(t[f]))}if(a&&o.push(a),e>1)for(let f=0;f<o.length;f++)o[f].length<=e||(zn(o[f],e,1,o[f].length-1,oT),o[f]=o[f].slice(0,e));return o}function oT(t,e){return e.area-t.area}function o1(t,e,i){const o=i.patternDependencies;let a=!1;for(const h of e){const f=h.paint.get(`${t}-pattern`);f.isConstant()||(a=!0);const x=f.constantOr(null);x&&(a=!0,o[x]=!0)}return a}function s1(t,e,i,o,a){const h=a.patternDependencies;for(const f of e){const x=f.paint.get(`${t}-pattern`).value;if(x.kind!=="constant"){let w=x.evaluate({zoom:o},i,{},a.availableImages);w=w&&w.name?w.name:w,h[w]=!0,i.patterns[f.id]=w}}return i}class Pm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ol,this.indexArray=new ss,this.indexArray2=new Eu,this.programConfigurations=new Su(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new qr,this.segments2=new qr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}updateFootprints(e,i){}populate(e,i,o,a){this.hasPattern=o1("fill",this.layers,i);const h=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:x,id:w,index:S,sourceLayerIndex:P}of e){const R=this.layers[0]._featureFilter.needGeometry,B=Hc(x,R);if(!this.layers[0]._featureFilter.filter(new $i(this.zoom),B,o))continue;const H=h?h.evaluate(B,{},o,i.availableImages):void 0,$={id:w,properties:x.properties,type:x.type,sourceLayerIndex:P,index:S,geometry:R?B.geometry:Dl(x,o,a),patterns:{},sortKey:H};f.push($)}h&&f.sort((x,w)=>x.sortKey-w.sortKey);for(const x of f){const{geometry:w,index:S,sourceLayerIndex:P}=x;if(this.hasPattern){const R=s1("fill",this.layers,x,this.zoom,i);this.patternFeatures.push(R)}else this.addFeature(x,w,S,o,{},i.availableImages,i.brightness);i.featureIndex.insert(e[S].feature,w,S,P,this.index)}}update(e,i,o,a,h){const f=Object.keys(e).length!==0;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,f?this.stateDependentLayers:this.layers,o,a,h)}addFeatures(e,i,o,a,h,f){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,i,o,a,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,XE),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,a,h,f=[],x){for(const w of Om(i,500)){let S=0;for(const te of w)S+=te.length;const P=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray),R=P.vertexLength,B=[],H=[];for(const te of w){if(te.length===0)continue;te!==w[0]&&H.push(B.length/2);const ne=this.segments2.prepareSegment(te.length,this.layoutVertexArray,this.indexArray2),de=ne.vertexLength;this.layoutVertexArray.emplaceBack(te[0].x,te[0].y),this.indexArray2.emplaceBack(de+te.length-1,de),B.push(te[0].x),B.push(te[0].y);for(let Se=1;Se<te.length;Se++)this.layoutVertexArray.emplaceBack(te[Se].x,te[Se].y),this.indexArray2.emplaceBack(de+Se-1,de+Se),B.push(te[Se].x),B.push(te[Se].y);ne.vertexLength+=te.length,ne.primitiveLength+=te.length}const $=Nf(B,H);for(let te=0;te<$.length;te+=3)this.indexArray.emplaceBack(R+$[te],R+$[te+1],R+$[te+2]);P.vertexLength+=S,P.primitiveLength+=$.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,h,f,a,x)}}xe(Pm,"FillBucket",{omit:["layers","patternFeatures"]});const sT=new Wn({"fill-sort-key":new li(lt.layout_fill["fill-sort-key"]),visibility:new It(lt.layout_fill.visibility)});var aT={paint:new Wn({"fill-antialias":new It(lt.paint_fill["fill-antialias"]),"fill-opacity":new li(lt.paint_fill["fill-opacity"]),"fill-color":new li(lt.paint_fill["fill-color"]),"fill-outline-color":new li(lt.paint_fill["fill-outline-color"]),"fill-translate":new It(lt.paint_fill["fill-translate"]),"fill-translate-anchor":new It(lt.paint_fill["fill-translate-anchor"]),"fill-pattern":new li(lt.paint_fill["fill-pattern"]),"fill-emissive-strength":new It(lt.paint_fill["fill-emissive-strength"])}),layout:sT};class a1{constructor(e,i,o,a){if(this.triangleCount=i.length/3,this.min=new Yt(0,0),this.max=new Yt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[h,f]=[e[0].clone(),e[0].clone()];for(let R=1;R<e.length;++R){const B=e[R];h.x=Math.min(h.x,B.x),h.y=Math.min(h.y,B.y),f.x=Math.max(f.x,B.x),f.y=Math.max(f.y,B.y)}if(a){const R=Math.ceil(Math.max(f.x-h.x,f.y-h.y)/a);o=Math.max(o,R)}if(o===0)return;this.min=h,this.max=f;const x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);const w=Math.max(x.x,x.y)/o;this.cellsX=Math.max(1,Math.ceil(x.x/w)),this.cellsY=Math.max(1,Math.ceil(x.y/w)),this.xScale=1/w,this.yScale=1/w;const S=[];for(let R=0;R<this.triangleCount;R++){const B=e[i[3*R+0]].sub(this.min),H=e[i[3*R+1]].sub(this.min),$=e[i[3*R+2]].sub(this.min),te=mc(Math.floor(Math.min(B.x,H.x,$.x)),this.xScale,this.cellsX),ne=mc(Math.floor(Math.max(B.x,H.x,$.x)),this.xScale,this.cellsX),de=mc(Math.floor(Math.min(B.y,H.y,$.y)),this.yScale,this.cellsY),Se=mc(Math.floor(Math.max(B.y,H.y,$.y)),this.yScale,this.cellsY),Me=new Yt(0,0),Le=new Yt(0,0),ze=new Yt(0,0),Fe=new Yt(0,0);for(let Xe=de;Xe<=Se;++Xe){Me.y=Le.y=Xe*w,ze.y=Fe.y=(Xe+1)*w;for(let et=te;et<=ne;++et)Me.x=ze.x=et*w,Le.x=Fe.x=(et+1)*w,($0(B,H,$,Me,Le,Fe)||$0(B,H,$,Me,Fe,ze))&&S.push({cellIdx:Xe*this.cellsX+et,triIdx:R})}}if(S.length===0)return;S.sort((R,B)=>R.cellIdx-B.cellIdx||R.triIdx-B.triIdx);let P=0;for(;P<S.length;){const R=S[P].cellIdx,B={start:this.payload.length,len:0};for(;P<S.length&&S[P].cellIdx===R;)++B.len,this.payload.push(S[P++].triIdx);this.cells[R]=B}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const o=mc(e.x-this.min.x,this.xScale,this.cellsX),a=mc(e.y-this.min.y,this.yScale,this.cellsY),h=this.cells[a*this.cellsX+o];if(h){this._lazyInitLookup();for(let f=0;f<h.len;f++){const x=this.payload[h.start+f],w=Math.floor(x/8),S=1<<x%8;if(!(this.lookup[w]&S)&&(this.lookup[w]|=S,i.push(x),i.length===this.triangleCount))return}}}query(e,i,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const a=mc(e.x-this.min.x,this.xScale,this.cellsX),h=mc(i.x-this.min.x,this.xScale,this.cellsX),f=mc(e.y-this.min.y,this.yScale,this.cellsY),x=mc(i.y-this.min.y,this.yScale,this.cellsY);for(let w=f;w<=x;w++)for(let S=a;S<=h;S++){const P=this.cells[w*this.cellsX+S];if(P)for(let R=0;R<P.len;R++){const B=this.payload[P.start+R],H=Math.floor(B/8),$=1<<B%8;if(!(this.lookup[H]&$)&&(this.lookup[H]|=$,o.push(B),o.length===this.triangleCount))return}}}}function mc(t,e,i){return Math.max(0,Math.min(i-1,Math.floor(t*e)))}xe(a1,"TriangleGridIndex");class yv{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[]}updateFootprints(e,i){for(const o of this.footprints)i.push({footprint:o,id:e})}populate(e,i,o,a){const h=[];for(const{feature:f,id:x,index:w,sourceLayerIndex:S}of e){const P=this.layers[0]._featureFilter.needGeometry,R=Hc(f,P);if(!this.layers[0]._featureFilter.filter(new $i(this.zoom),R,o))continue;const B={id:x,properties:f.properties,type:f.type,sourceLayerIndex:S,index:w,geometry:P?R.geometry:Dl(f,o,a),patterns:{}};h.push(B)}for(const f of h){const{geometry:x,index:w,sourceLayerIndex:S}=f;this.addFeature(f,x,w,o,{},i.availableImages,i.brightness),i.featureIndex.insert(e[w].feature,x,w,S,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,o,a,h){}destroy(){}addFeature(e,i,o,a,h,f=[],x){for(const w of Om(i,2)){const S=[],P=[],R=[],B=new Yt(1/0,1/0),H=new Yt(-1/0,-1/0);for(const ne of w)if(ne.length!==0){ne!==w[0]&&R.push(P.length/2);for(let de=0;de<ne.length;de++)P.push(ne[de].x),P.push(ne[de].y),S.push(ne[de]),B.x=Math.min(B.x,ne[de].x),B.y=Math.min(B.y,ne[de].y),H.x=Math.max(H.x,ne[de].x),H.y=Math.max(H.y,ne[de].y)}const $=Nf(P,R),te=new a1(S,$,8,256);this.footprints.push({vertices:S,indices:$,grid:te,min:B,max:H})}}}xe(yv,"ClipBucket",{omit:["layers"]});const lT=new Wn({"clip-layer-types":new It(lt.layout_clip["clip-layer-types"])});var cT={paint:new Wn({}),layout:lT};const uT=Yn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),hT=Yn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),dT=Yn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),fT=Yn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),pT=Yn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:mT}=uT;var Dm={},gT=ga,vv=ld;function ld(t,e,i,o,a){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=o,this._values=a,t.readFields(_T,this,e)}function _T(t,e,i){t==1?e.id=i.readVarint():t==2?function(o,a){for(var h=o.readVarint()+o.pos;o.pos<h;){var f=a._keys[o.readVarint()],x=a._values[o.readVarint()];a.properties[f]=x}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function yT(t){for(var e,i,o=0,a=0,h=t.length,f=h-1;a<h;f=a++)o+=((i=t[f]).x-(e=t[a]).x)*(e.y+i.y);return o}ld.types=["Unknown","Point","LineString","Polygon"],ld.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,o=1,a=0,h=0,f=0,x=[];t.pos<i;){if(a<=0){var w=t.readVarint();o=7&w,a=w>>3}if(a--,o===1||o===2)h+=t.readSVarint(),f+=t.readSVarint(),o===1&&(e&&x.push(e),e=[]),e.push(new gT(h,f));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&x.push(e),x},ld.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,o=0,a=0,h=0,f=1/0,x=-1/0,w=1/0,S=-1/0;t.pos<e;){if(o<=0){var P=t.readVarint();i=7&P,o=P>>3}if(o--,i===1||i===2)(a+=t.readSVarint())<f&&(f=a),a>x&&(x=a),(h+=t.readSVarint())<w&&(w=h),h>S&&(S=h);else if(i!==7)throw new Error("unknown command "+i)}return[f,w,x,S]},ld.prototype.toGeoJSON=function(t,e,i){var o,a,h=this.extent*Math.pow(2,i),f=this.extent*t,x=this.extent*e,w=this.loadGeometry(),S=ld.types[this.type];function P(H){for(var $=0;$<H.length;$++){var te=H[$];H[$]=[360*(te.x+f)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(te.y+x)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(o=0;o<w.length;o++)R[o]=w[o][0];P(w=R);break;case 2:for(o=0;o<w.length;o++)P(w[o]);break;case 3:for(w=function(H){var $=H.length;if($<=1)return[H];for(var te,ne,de=[],Se=0;Se<$;Se++){var Me=yT(H[Se]);Me!==0&&(ne===void 0&&(ne=Me<0),ne===Me<0?(te&&de.push(te),te=[H[Se]]):te.push(H[Se]))}return te&&de.push(te),de}(w),o=0;o<w.length;o++)for(a=0;a<w[o].length;a++)P(w[o][a])}w.length===1?w=w[0]:S="Multi"+S;var B={type:"Feature",geometry:{type:S,coordinates:w},properties:this.properties};return"id"in this&&(B.id=this.id),B};var vT=vv,xv=wv;function wv(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(xT,this,e),this.length=this._features.length}function xT(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(o){for(var a=null,h=o.readVarint()+o.pos;o.pos<h;){var f=o.readVarint()>>3;a=f===1?o.readString():f===2?o.readFloat():f===3?o.readDouble():f===4?o.readVarint64():f===5?o.readVarint():f===6?o.readSVarint():f===7?o.readBoolean():null}return a}(i))}wv.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new vT(this._pbf,e,this.extent,this._keys,this._values)};var wT=xv;function bT(t,e,i){if(t===3){var o=new wT(i,i.readVarint()+i.pos);o.length&&(e[o.name]=o)}}var l1=Dm.VectorTile=function(t,e){this.layers=t.readFields(bT,{},e)},Rm=Dm.VectorTileFeature=vv;Dm.VectorTileLayer=xv;class yh extends Yt{constructor(e,i,o){super(e,i),this.z=o}}class bv extends yh{constructor(e,i,o,a){super(e,i,o),this.w=a}}function km(t,e,i,o){const a=[],h=o===0?(f,x,w,S,P,R)=>{f.push(new Yt(R,w+(R-x)/(S-x)*(P-w)))}:(f,x,w,S,P,R)=>{f.push(new Yt(x+(R-w)/(P-w)*(S-x),R))};for(const f of t){const x=[];for(const w of f){if(w.length<=2)continue;const S=[];for(let B=0;B<w.length-1;B++){const H=w[B].x,$=w[B].y,te=w[B+1].x,ne=w[B+1].y,de=o===0?H:$,Se=o===0?te:ne;de<e?Se>e&&h(S,H,$,te,ne,e):de>i?Se<i&&h(S,H,$,te,ne,i):S.push(w[B]),Se<e&&de>=e&&h(S,H,$,te,ne,e),Se>i&&de<=i&&h(S,H,$,te,ne,i)}let P=w[w.length-1];const R=o===0?P.x:P.y;R>=e&&R<=i&&S.push(P),S.length&&(P=S[S.length-1],S[0].x===P.x&&S[0].y===P.y||S.push(S[0]),x.push(S))}x.length&&a.push(x)}return a}function Cv(t,e,i,o){const a=i==="x"?"y":"x",h=(o-t[i])/(e[i]-t[i]);t[a]=t[a]+(e[a]-t[a])*h,t[i]=o,t.hasOwnProperty("z")&&(t.z=Fi(t.z,e.z,h)),t.hasOwnProperty("w")&&(t.w=Fi(t.w,e.w,h))}function Ev(t,e,i,o){const a=i,h=o;for(const f of["x","y"]){let x=t,w=e;x[f]>=w[f]&&(x=e,w=t),x[f]<a&&w[f]>a&&Cv(x,w,f,a),x[f]<h&&w[f]>h&&Cv(w,x,f,h)}}function Bm(t,e){return t.x-e.x||t.y-e.y}function Tv(t,e){return Bm(t.min,e.min)===0&&Bm(t.max,e.max)===0}function c1(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function u1(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i].sourceId!==e[i].sourceId||!Tv(t[i],e[i])||t[i].order!==e[i].order||t[i].clipMask!==e[i].clipMask)return!1;return!0}function Sv(t,e,i){const o=1/Zt,a=1/(1<<i.canonical.z),h=(e.x*o+i.canonical.x)*a+i.wrap,f=(e.y*o+i.canonical.y)*a;return{min:new Yt((t.x*o+i.canonical.x)*a+i.wrap,(t.y*o+i.canonical.y)*a),max:new Yt(h,f)}}function CT(t,e,i){const o=1<<i.canonical.z,a=((e.x-i.wrap)*o-i.canonical.x)*Zt,h=(e.y*o-i.canonical.y)*Zt;return{min:new Yt(((t.x-i.wrap)*o-i.canonical.x)*Zt,(t.y*o-i.canonical.y)*Zt),max:new Yt(a,h)}}function Av(t,e,i,o,a,h,f){const x=t.indices,w=t.vertices,S=[];for(let P=o;P<o+a;P+=3){const R=e[i[P+0]+h],B=e[i[P+1]+h],H=e[i[P+2]+h],$=Math.min(R.x,B.x,H.x),te=Math.max(R.x,B.x,H.x),ne=Math.min(R.y,B.y,H.y),de=Math.max(R.y,B.y,H.y);S.length=0,t.grid.query(new Yt($,ne),new Yt(te,de),S);for(let Se=0;Se<S.length;Se++){const Me=S[Se];if($0(w[x[3*Me+0]],w[x[3*Me+1]],w[x[3*Me+2]],R,B,H,f))return!0}}return!1}function Iv(t,e,i,o){if(!t||!i)return!1;let a=t.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(i.vertices.length<t.vertices.length)return Iv(i,o,t,e);const h=e.canonical,f=o.canonical,x=Math.pow(2,f.z-h.z);a=t.vertices.map(w=>new Yt((w.x+h.x*Zt)*x-f.x*Zt,(w.y+h.y*Zt)*x-f.y*Zt))}return Av(i,a,t.indices,0,t.indices.length,0,0)}function Mv(t,e,i,o){const a=Math.pow(2,o.z-i.z);return new Yt((t+i.x*Zt)*a-o.x*Zt,(e+i.y*Zt)*a-o.y*Zt)}function Lv(t,e){const i=[];e.footprint.grid.queryPoint(t,i);const o=e.footprint.indices,a=e.footprint.vertices;for(let h=0;h<i.length;h++){const f=i[h];if(Iu([a[o[3*f+0]],a[o[3*f+1]],a[o[3*f+2]]],t))return!0}return!1}class Ov{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const o=this.toIdx(e,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function Pv(t,e,i,o){let a=0,h=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(o[f])<1e-15){if(i[f]<t[f]||i[f]>e[f])return null}else{const x=1/o[f];let w=(t[f]-i[f])*x,S=(e[f]-i[f])*x;if(w>S){const P=w;w=S,S=P}if(w>a&&(a=w),S<h&&(h=S),a>h)return null}return a}function Dv(t,e,i,o,a,h,f,x,w,S,P){const R=o-t,B=a-e,H=h-i,$=f-t,te=x-e,ne=w-i,de=P[1]*ne-P[2]*te,Se=P[2]*$-P[0]*ne,Me=P[0]*te-P[1]*$,Le=R*de+B*Se+H*Me;if(Math.abs(Le)<1e-15)return null;const ze=1/Le,Fe=S[0]-t,Xe=S[1]-e,et=S[2]-i,st=(Fe*de+Xe*Se+et*Me)*ze;if(st<0||st>1)return null;const _t=Xe*H-et*B,dt=et*R-Fe*H,St=Fe*B-Xe*R,Vt=(P[0]*_t+P[1]*dt+P[2]*St)*ze;return Vt<0||st+Vt>1?null:($*_t+te*dt+ne*St)*ze}function Rv(t,e,i){return(t-e)/(i-e)}function kv(t,e,i,o,a,h,f,x,w){const S=1<<i,P=h-o,R=f-a,B=(t+1)/S*P+o,H=(e+0)/S*R+a,$=(e+1)/S*R+a;x[0]=(t+0)/S*P+o,x[1]=H,w[0]=B,w[1]=$}class Bv{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(h){const f=Math.ceil(Math.log2(h.dim/8)),x=[];let w=Math.ceil(Math.pow(2,f));const S=1/w,P=(H,$,te,ne,de)=>{const Se=ne?1:0,Me=(H+1)*te-Se,Le=$*te,ze=($+1)*te-Se;de[0]=H*te,de[1]=Le,de[2]=Me,de[3]=ze};let R=new Ov(w);const B=[];for(let H=0;H<w*w;H++){P(H%w,Math.floor(H/w),S,!1,B);const $=Lu(B[0],B[1],h),te=Lu(B[2],B[1],h),ne=Lu(B[2],B[3],h),de=Lu(B[0],B[3],h);R.minimums.push(Math.min($,te,ne,de)),R.maximums.push(Math.max($,te,ne,de)),R.leaves.push(1)}for(x.push(R),w/=2;w>=1;w/=2){const H=x[x.length-1];R=new Ov(w);for(let $=0;$<w*w;$++){P($%w,Math.floor($/w),2,!0,B);const te=H.getElevation(B[0],B[1]),ne=H.getElevation(B[2],B[1]),de=H.getElevation(B[2],B[3]),Se=H.getElevation(B[0],B[3]),Me=H.isLeaf(B[0],B[1]),Le=H.isLeaf(B[2],B[1]),ze=H.isLeaf(B[2],B[3]),Fe=H.isLeaf(B[0],B[3]),Xe=Math.min(te.min,ne.min,de.min,Se.min),et=Math.max(te.max,ne.max,de.max,Se.max),st=Me&&Le&&ze&&Fe;R.maximums.push(et),R.minimums.push(Xe),R.leaves.push(et-Xe<=5&&st?1:0)}x.push(R)}return x}(this.dem),o=i.length-1,a=i[o];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(e,i,o,a,h,f,x=1){return Pv([e,i,-100],[o,a,this.maximums[0]*x],h,f)}raycast(e,i,o,a,h,f,x=1){if(!this.nodeCount)return null;const w=this.raycastRoot(e,i,o,a,h,f,x);if(w==null)return null;const S=[],P=[],R=[],B=[],H=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;H.length>0;){const{idx:$,t:te,nodex:ne,nodey:de,depth:Se}=H.pop();if(this.leaves[$]){kv(ne,de,Se,e,i,o,a,R,B);const Le=1<<Se,ze=(ne+0)/Le,Fe=(ne+1)/Le,Xe=(de+0)/Le,et=(de+1)/Le,st=Lu(ze,Xe,this.dem)*x,_t=Lu(Fe,Xe,this.dem)*x,dt=Lu(Fe,et,this.dem)*x,St=Lu(ze,et,this.dem)*x,Vt=Dv(R[0],R[1],st,B[0],R[1],_t,B[0],B[1],dt,h,f),bt=Dv(B[0],B[1],dt,R[0],B[1],St,R[0],R[1],st,h,f),kt=Math.min(Vt!==null?Vt:Number.MAX_VALUE,bt!==null?bt:Number.MAX_VALUE);if(kt!==Number.MAX_VALUE)return kt;{const yt=r._.scaleAndAdd([],h,f,te);if(Nv(st,_t,St,dt,Rv(yt[0],R[0],B[0]),Rv(yt[1],R[1],B[1]))>=yt[2])return te}continue}let Me=0;for(let Le=0;Le<this._siblingOffset.length;Le++){kv((ne<<1)+this._siblingOffset[Le][0],(de<<1)+this._siblingOffset[Le][1],Se+1,e,i,o,a,R,B),R[2]=-100,B[2]=this.maximums[this.childOffsets[$]+Le]*x;const ze=Pv(R,B,h,f);if(ze!=null){const Fe=ze;S[Le]=Fe;let Xe=!1;for(let et=0;et<Me&&!Xe;et++)Fe>=S[P[et]]&&(P.splice(et,0,Le),Xe=!0);Xe||(P[Me]=Le),Me++}}for(let Le=0;Le<Me;Le++){const ze=P[Le];H.push({idx:this.childOffsets[$]+ze,t:S[ze],nodex:(ne<<1)+this._siblingOffset[ze][0],nodey:(de<<1)+this._siblingOffset[ze][1],depth:Se+1})}}return null}_addNode(e,i,o){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,o,a,h){if(e[a].isLeaf(i,o)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const f=a-1,x=e[f];let w=0,S=0;for(let P=0;P<this._siblingOffset.length;P++){const R=2*i+this._siblingOffset[P][0],B=2*o+this._siblingOffset[P][1],H=x.getElevation(R,B),$=x.isLeaf(R,B),te=this._addNode(H.min,H.max,$);$&&(w|=1<<P),S||(S=te)}for(let P=0;P<this._siblingOffset.length;P++)w&1<<P||this._construct(e,2*i+this._siblingOffset[P][0],2*o+this._siblingOffset[P][1],f,S+P)}}function Nv(t,e,i,o,a,h){return Fi(Fi(t,i,h),Fi(e,o,h),a)}function Lu(t,e,i){const o=i.dim,a=Ki(t*o-.5,0,o-1),h=Ki(e*o-.5,0,o-1),f=Math.floor(a),x=Math.floor(h),w=Math.min(f+1,o-1),S=Math.min(x+1,o-1);return Nv(i.get(f,x),i.get(w,x),i.get(f,S),i.get(w,S),a-f,h-x)}const ET={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function TT(t,e,i){return(256*t*256+256*e+i)/10-1e4}function ST(t,e,i){return 256*t+e+i/256-32768}class Nm{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,o,a=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return Dr(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const h=this.dim=i.height-2,f=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=a,this._modifiedForSources={},!a){for(let w=0;w<h;w++)f[this._idx(-1,w)]=f[this._idx(0,w)],f[this._idx(h,w)]=f[this._idx(h-1,w)],f[this._idx(w,-1)]=f[this._idx(w,0)],f[this._idx(w,h)]=f[this._idx(w,h-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(h,-1)]=f[this._idx(h-1,0)],f[this._idx(-1,h)]=f[this._idx(0,h-1)],f[this._idx(h,h)]=f[this._idx(h-1,h-1)]}const x=o==="terrarium"?ST:TT;for(let w=0;w<f.length;++w){const S=4*w;this.floatView[w]=x(this.pixels[S],this.pixels[S+1],this.pixels[S+2])}this._timestamp=Ao.now()}_buildQuadTree(){this._tree=new Bv(this)}get(e,i,o=!1){o&&(e=Ki(e,-1,this.dim),i=Ki(i,-1,this.dim));const a=this._idx(e,i);return this.floatView[a]}set(e,i,o){const a=this._idx(e,i),h=this.floatView[a];return this.floatView[a]=o,o-h}static getUnpackVector(e){return ET[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const o=[0,0,0,0],a=Nm.getUnpackVector(i);let h=Math.floor((e+a[3])/a[2]);return o[2]=h%256,h=Math.floor(h/256),o[1]=h%256,h=Math.floor(h/256),o[0]=h,o}getPixels(){return new fv({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=i*this.dim,h=i*this.dim+this.dim,f=o*this.dim,x=o*this.dim+this.dim;switch(i){case-1:a=h-1;break;case 1:h=a+1}switch(o){case-1:f=x-1;break;case 1:x=f+1}const w=-i*this.dim,S=-o*this.dim;for(let P=f;P<x;P++)for(let R=a;R<h;R++){const B=4*this._idx(R,P),H=4*this._idx(R+w,P+S);this.pixels[B+0]=e.pixels[H+0],this.pixels[B+1]=e.pixels[H+1],this.pixels[B+2]=e.pixels[H+2],this.pixels[B+3]=e.pixels[H+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}xe(Nm,"DEMData"),xe(Bv,"DemMinMaxQuadTree",{omit:["dem"]});class cd{constructor(e,i,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(e,i,o){const a=o||e.findDEMTileFor(i);if(!a||!a.dem)return;const h=a.dem,f=a.tileID,x=1<<i.canonical.z-f.canonical.z;return new cd(a,h.dim/Zt/x,[(i.canonical.x/x-f.canonical.x)*h.dim,(i.canonical.y/x-f.canonical.y)*h.dim])}tileCoordToPixel(e,i){const o=i*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),h=Math.floor(o);return new Yt(a,h)}getElevationAt(e,i,o,a){const h=e*this._scale+this._offset[0],f=i*this._scale+this._offset[1],x=Math.floor(h),w=Math.floor(f),S=this._dem;return a=!!a,o?Fi(Fi(S.get(x,w,a),S.get(x,w+1,a),f-w),Fi(S.get(x+1,w,a),S.get(x+1,w+1,a),f-w),h-x):S.get(x,w,a)}getElevationAtPixel(e,i,o){return this._dem.get(e,i,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Xs(1,e)*this._dem.stride}}const Fv={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},AT=Rm.types,IT=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],MT=["fill-extrusion-flood-light-ground-radius"],LT=Math.pow(2,13),OT=Math.pow(2,15)-1,zv=new Yt(0,1),Ou=2147483648;function Uf(t,e,i,o,a,h,f,x){t.emplaceBack((e<<1)+f,(i<<1)+h,(Math.floor(o*LT)<<1)+a,Math.round(x))}function Fm(t,e,i,o,a,h){t.emplaceBack(e.x,e.y,(i.x<<1)+o,(i.y<<1)+a,h)}function jf(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Vv{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Uv{constructor(){this.centroidXY=new Yt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Yt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Yt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Yt(this.max.x-this.min.x,this.max.y-this.min.y)}}class jv{constructor(){this.acc=new Yt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,o){this.accCount++,this.acc._add(i);let a=!!this.borders;i.x<e.min.x?(e.min.x=i.x,a=!0):i.x>e.max.x&&(e.max.x=i.x,a=!0),i.y<e.min.y?(e.min.y=i.y,a=!0):i.y>e.max.y&&(e.max.y=i.y,a=!0),((i.x===0||i.x===Zt)&&i.x===o.x)!=((i.y===0||i.y===Zt)&&i.y===o.y)&&this.processBorderOverlap(i,o),a&&this.checkBorderIntersection(i,o)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Fi(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Zt!=e.x>Zt&&this.addBorderIntersection(1,Fi(i.y,e.y,(Zt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Fi(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Zt!=e.y>Zt&&this.addBorderIntersection(3,Fi(i.x,e.x,(Zt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new Yt(0,0):new Yt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function qv(t,e){const i=t.add(e)._unit(),o=Ki(t.x*i.x+t.y*i.y,-1,1);var a,h,f;return a=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(a)))/4*OT*((h=t).x*(f=e).y-h.y*f.x<0?-1:1)}const PT=[t=>t.x<0,t=>t.x>Zt,t=>t.y<0,t=>t.y>Zt];function DT(t,e,i,o){const a=[4];if(o===0)return a;i._mult(o);const h=t.sub(i),f=e.sub(i),x=[t,e,h,f];for(let w=0;w<4;w++)for(const S of x)if(PT[w](S)){a.push(w);break}return a}class Hv{constructor(e){this.vertexArray=new m0,this.indexArray=new ss,this.programConfigurations=new Su(e.layers,{zoom:e.zoom,lut:e.lut},i=>MT.includes(i)),this._segments=new qr,this.hiddenByLandmarkVertexArray=new M0,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new qr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,o,a=!1){const h=e.length;if(h>2){let f=Math.max(0,this._segments.get().length-1);const x=this._segments._prepareSegment(4*h,this.vertexArray.length,2*this._segmentToGroundQuads[f].length);let w;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{const S=e[0],P=e[1];w=qv(S.sub(e[h-1])._perp()._unit(),P.sub(S)._perp()._unit())}for(let S=0;S<h;S++){const P=S===h-1?0:S+1,R=e[S],B=e[P],H=e[P===h-1?0:P+1],$=B.sub(R)._perp()._unit(),te=qv($,H.sub(B)._perp()._unit()),ne=w,de=te;if(h1(R,B,i)||a&&$v(R,i)&&$v(B,i)){w=te;continue}const Se=x.vertexLength;Fm(this.vertexArray,R,B,1,1,ne),Fm(this.vertexArray,R,B,1,0,ne),Fm(this.vertexArray,R,B,0,1,de),Fm(this.vertexArray,R,B,0,0,de),x.vertexLength+=4;const Me=DT(R,B,$,o);for(const Le of Me)this._segmentToGroundQuads[f].push({id:Se,region:Le}),this._segmentToRegionTriCounts[f][Le]+=2,x.primitiveLength+=2;w=te}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let o=0;o<i;o++)this._segmentToGroundQuads[o].sort((a,h)=>a.region-h.region);for(let o=0;o<i;o++){const a=this._segmentToGroundQuads[o],h=e[o],f=this._segmentToRegionTriCounts[o];f.reduce((w,S)=>w+S,0);let x=0;for(let w=0;w<=4;w++){const S=f[w];if(S!==0){let P=this.regionSegments[w];P||(P=this.regionSegments[w]=new qr);const R={vertexOffset:h.vertexOffset,primitiveOffset:h.primitiveOffset+x,vertexLength:h.vertexLength,primitiveLength:S};P.get().push(R)}x+=S}for(let w=0;w<a.length;w++){const S=a[w].id;this.indexArray.emplaceBack(S,S+1,S+3),this.indexArray.emplaceBack(S,S+3,S+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,o,a,h,f){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,o,a,h,f)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,hT.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,o,a,h,f){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,o,a,h,f)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const o=e.flags&Ou?1:0;for(let a=e.groundVertexArrayOffset;a<i;++a)this.hiddenByLandmarkVertexArray.emplace(a,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,fT.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class zm{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ss,this.footprintVertices=new Ol,this.footprintSegments=[],this.layoutVertexArray=new xu,this.centroidVertexArray=new My,this.indexArray=new ss,this.programConfigurations=new Su(e.layers,{zoom:e.zoom,lut:e.lut},i=>IT.includes(i)),this.segments=new qr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new Hv(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,i){}populate(e,i,o,a){this.features=[],this.hasPattern=o1("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=xm(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:h,id:f,index:x,sourceLayerIndex:w}of e){const S=this.layers[0]._featureFilter.needGeometry,P=Hc(h,S);if(!this.layers[0]._featureFilter.filter(new $i(this.zoom),P,o))continue;const R={id:f,sourceLayerIndex:w,index:x,geometry:S?P.geometry:Dl(h,o,a),properties:h.properties,type:h.type,patterns:{}},B=this.layoutVertexArray.length;this.hasPattern?this.features.push(s1("fill-extrusion",this.layers,R,this.zoom,i)):this.addFeature(R,R.geometry,x,o,{},i.availableImages,a,i.brightness),i.featureIndex.insert(h,R.geometry,x,w,this.index,B)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,o,a,h,f){for(const x of this.features){const{geometry:w}=x;this.addFeature(x,w,x.index,i,o,a,h,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,o,a,h){const f=Object.keys(e).length!==0;if(f&&!this.stateDependentLayers.length)return;const x=f?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,i,x,o,a,h),this.groundEffect.update(e,i,x,o,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mT),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,pT.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,dT.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,a,h,f,x,w){const S=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,P=[new Yt(0,0),new Yt(Zt,Zt)],R=x.projection,B=R.name==="globe",H=AT[e.type]==="Polygon",$=new jv;$.centroidDataIndex=this.centroidData.length;const te=new Uv,ne=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},a)<=0,de=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},a);te.height=de,te.vertexArrayOffset=this.layoutVertexArray.length,te.groundVertexArrayOffset=this.groundEffect.vertexArray.length,B&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new mm);const Se=Om(i,500);for(let et=Se.length-1;et>=0;et--){const st=Se[et];(st.length===0||(Me=st[0]).every(_t=>_t.x<=0)||Me.every(_t=>_t.x>=Zt)||Me.every(_t=>_t.y<=0)||Me.every(_t=>_t.y>=Zt))&&Se.splice(et,1)}var Me;let Le;if(B)Le=Kv(Se,P,a);else{Le=[];for(const et of Se)Le.push({polygon:et,bounds:P})}const ze=H?this.edgeRadius:0,Fe=ze>0&&this.zoom<17,Xe=(et,st)=>{if(et.length===0)return!1;const _t=et[et.length-1];return st.x===_t.x&&st.y===_t.y};for(const{polygon:et,bounds:st}of Le){let _t=0,dt=0;for(const kt of et)H&&!kt[0].equals(kt[kt.length-1])&&kt.push(kt[0]),dt+=H?kt.length-1:kt.length;const St=this.segments.prepareSegment((H?5:4)*dt,this.layoutVertexArray,this.indexArray);te.footprintSegIdx<0&&(te.footprintSegIdx=this.footprintSegments.length),te.polygonSegIdx<0&&(te.polygonSegIdx=this.polygonSegments.length);const Vt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},bt=new Vv;if(bt.vertexOffset=this.footprintVertices.length,bt.indexOffset=3*this.footprintIndices.length,bt.ringIndices=[],H){const kt=[],yt=[];_t=St.vertexLength;for(let jt=0;jt<et.length;jt++){const zt=et[jt];zt.length&&jt!==0&&yt.push(kt.length/2);const ri=[];let Ut,Ht;Ut=zt[1].sub(zt[0])._perp()._unit(),bt.ringIndices.push(zt.length-1);for(let Di=1;Di<zt.length;Di++){const Si=zt[Di],Ci=zt[Di===zt.length-1?1:Di+1],qt=Si.clone();if(ze){Ht=Ci.sub(Si)._perp()._unit();const Ni=Ut.add(Ht)._unit(),cn=ze*Math.min(4,1/(Ut.x*Ni.x+Ut.y*Ni.y));qt.x+=cn*Ni.x,qt.y+=cn*Ni.y,qt.x=Math.round(qt.x),qt.y=Math.round(qt.y),Ut=Ht}!ne||ze!==0&&!Fe||Xe(ri,qt)||ri.push(qt),Uf(this.layoutVertexArray,qt.x,qt.y,0,0,1,1,0),St.vertexLength++,this.footprintVertices.emplaceBack(Si.x,Si.y),kt.push(Si.x,Si.y),B&&jf(this.layoutVertexExtArray,R.projectTilePoint(qt.x,qt.y,a),R.upVector(a,qt.x,qt.y))}ne&&(ze===0||Fe)&&(ri.length!==0&&Xe(ri,ri[0])&&ri.pop(),this.groundEffect.addData(ri,st,S))}const Bt=Nf(kt,yt);for(let jt=0;jt<Bt.length;jt+=3)this.footprintIndices.emplaceBack(bt.vertexOffset+Bt[jt+0],bt.vertexOffset+Bt[jt+1],bt.vertexOffset+Bt[jt+2]),this.indexArray.emplaceBack(_t+Bt[jt],_t+Bt[jt+2],_t+Bt[jt+1]),St.primitiveLength++;bt.indexCount+=Bt.length,bt.vertexCount+=this.footprintVertices.length-bt.vertexOffset}for(let kt=0;kt<et.length;kt++){const yt=et[kt];$.startRing(te,yt[0]);let Bt=yt.length>4&&Zv(yt[yt.length-2],yt[0],yt[1]),jt=ze?RT(yt[yt.length-2],yt[0],yt[1],ze):0;const zt=[];let ri,Ut,Ht;Ut=yt[1].sub(yt[0])._perp()._unit();let Di=!0;for(let Si=1,Ci=0;Si<yt.length;Si++){let qt=yt[Si-1],Ni=yt[Si];const cn=yt[Si===yt.length-1?1:Si+1];if($.appendEdge(te,Ni,qt),h1(Ni,qt,st)){ze&&(Ut=cn.sub(Ni)._perp()._unit(),Di=!Di);continue}const Gi=Ni.sub(qt)._perp(),mn=Gi.x/(Math.abs(Gi.x)+Math.abs(Gi.y)),un=Gi.y>0?1:0,xn=qt.dist(Ni);if(Ci+xn>32768&&(Ci=0),ze){Ht=cn.sub(Ni)._perp()._unit();let jn=Wv(qt,Ni,cn,Gv(Ut,Ht),ze);isNaN(jn)&&(jn=0);const Pn=Ni.sub(qt)._unit();qt=qt.add(Pn.mult(jt))._round(),Ni=Ni.add(Pn.mult(-jn))._round(),jt=jn,Ut=Ht,ne&&this.zoom>=17&&(Xe(zt,qt)||zt.push(qt),Xe(zt,Ni)||zt.push(Ni))}const qi=St.vertexLength,ur=yt.length>4&&Zv(qt,Ni,cn);let sr=Xv(Ci,Bt,Di);if(Uf(this.layoutVertexArray,qt.x,qt.y,mn,un,0,0,sr),Uf(this.layoutVertexArray,qt.x,qt.y,mn,un,0,1,sr),Ci+=xn,sr=Xv(Ci,ur,!Di),Bt=ur,Uf(this.layoutVertexArray,Ni.x,Ni.y,mn,un,0,0,sr),Uf(this.layoutVertexArray,Ni.x,Ni.y,mn,un,0,1,sr),St.vertexLength+=4,this.indexArray.emplaceBack(qi+0,qi+1,qi+2),this.indexArray.emplaceBack(qi+1,qi+3,qi+2),St.primitiveLength+=2,ze){const jn=_t+(Si===1?yt.length-2:Si-2),Pn=Si===1?_t:jn+1;if(this.indexArray.emplaceBack(qi+1,jn,qi+3),this.indexArray.emplaceBack(jn,Pn,qi+3),St.primitiveLength+=2,ri===void 0&&(ri=qi),!h1(cn,yt[Si],st)){const qn=Si===yt.length-1?ri:St.vertexLength;this.indexArray.emplaceBack(qi+2,qi+3,qn),this.indexArray.emplaceBack(qi+3,qn+1,qn),this.indexArray.emplaceBack(qi+3,Pn,qn+1),St.primitiveLength+=3}Di=!Di}if(B){const jn=this.layoutVertexExtArray,Pn=R.projectTilePoint(qt.x,qt.y,a),qn=R.projectTilePoint(Ni.x,Ni.y,a),Er=R.upVector(a,qt.x,qt.y),_r=R.upVector(a,Ni.x,Ni.y);jf(jn,Pn,Er),jf(jn,Pn,Er),jf(jn,qn,_r),jf(jn,qn,_r)}}H&&(_t+=yt.length-1),ne&&ze&&this.zoom>=17&&(zt.length!==0&&Xe(zt,zt[0])&&zt.pop(),this.groundEffect.addData(zt,st,S,ze>0))}this.footprintSegments.push(bt),Vt.triangleCount=this.indexArray.length-Vt.triangleArrayOffset,this.polygonSegments.push(Vt),++te.footprintSegLen,++te.polygonSegLen}if(te.vertexCount=this.layoutVertexArray.length-te.vertexArrayOffset,te.groundVertexCount=this.groundEffect.vertexArray.length-te.groundVertexArrayOffset,te.vertexCount!==0){if(te.centroidXY=$.borders?zv:this.encodeCentroid($,te),this.centroidData.push(te),$.borders){this.featuresOnBorder.push($);const et=this.featuresOnBorder.length-1;for(let st=0;st<$.borders.length;st++)$.borders[st][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[st].push(et)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,h,f,a,w),this.groundEffect.addPaintPropertiesData(e,o,h,f,a,w),this.maxHeight=Math.max(this.maxHeight,de)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,o)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){const e=[];for(let x=0;x<this.centroidData.length;x++){const w=this.centroidData[x],S=+(w.min.y+w.max.y>Zt),P=2*S+(+(w.min.x+w.max.x>Zt)^S);for(let R=0;R<w.polygonSegLen;R++){const B=w.polygonSegIdx+R;e.push({centroidIdx:x,subtile:P,polygonSegmentIdx:B,triangleSegmentIdx:this.polygonSegments[B].triangleSegIdx})}}const i=new ss;e.sort((x,w)=>x.triangleSegmentIdx===w.triangleSegmentIdx?x.subtile-w.subtile:x.triangleSegmentIdx-w.triangleSegmentIdx);let o=0,a=0,h=0;for(const x of e){if(x.triangleSegmentIdx!==o)break;h++}const f=e.length;for(;a!==e.length;){o=e[a].triangleSegmentIdx;let x=0,w=a,S=a;for(let P=w;P<h&&e[P].subtile===x;P++)S++;for(;w!==h;){const P=e[w];x=P.subtile;const R=this.centroidData[P.centroidIdx].min.clone(),B=this.centroidData[P.centroidIdx].max.clone(),H={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let $=w;$<S;$++){const te=e[$],ne=this.polygonSegments[te.polygonSegmentIdx],de=this.centroidData[te.centroidIdx].min,Se=this.centroidData[te.centroidIdx].max,Me=this.indexArray.uint16;for(let Le=ne.triangleArrayOffset;Le<ne.triangleArrayOffset+ne.triangleCount;Le++)i.emplaceBack(Me[3*Le],Me[3*Le+1],Me[3*Le+2]);H.primitiveLength+=ne.triangleCount,R.x=Math.min(R.x,de.x),R.y=Math.min(R.y,de.y),B.x=Math.max(B.x,Se.x),B.y=Math.max(B.y,Se.y)}H.primitiveLength>0&&this.triangleSubSegments.push({segment:H,min:R,max:B}),w=S;for(let $=w;$<h&&e[$].subtile===e[w].subtile;$++)S++}a=h;for(let P=a;P<f&&e[P].triangleSegmentIdx===e[a].triangleSegmentIdx;P++)h++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,o){let a=0,h=0;const f=1<<e.canonical.z;if(i){const te=i.getMinMaxForTile(e);te&&(a=te.min,h=te.max)}h+=this.maxHeight;const x=e.toUnwrapped();let w;const S=[x.canonical.x/f+x.wrap,x.canonical.y/f],P=[(x.canonical.x+1)/f+x.wrap,(x.canonical.y+1)/f],R=new qr,B=(te,ne,de)=>[te[0]*(1-de[0])+ne[0]*de[0],te[1]*(1-de[1])+ne[1]*de[1]],H=[],$=[];for(const te of this.triangleSubSegments){H[0]=te.min.x/Zt,H[1]=te.min.y/Zt,$[0]=te.max.x/Zt,$[1]=te.max.y/Zt;const ne=B(S,P,H),de=B(S,P,$);if(new Nr([ne[0],ne[1],a],[de[0],de[1],h]).intersectsPrecise(o)===0){w&&(R.segments.push(w),w=void 0);continue}const Se=te.segment;w&&w.vertexOffset!==Se.vertexOffset&&(R.segments.push(w),w=void 0),w?(w.vertexLength+=Se.vertexLength,w.primitiveLength+=Se.primitiveLength):w={vertexOffset:Se.vertexOffset,primitiveLength:Se.primitiveLength,vertexLength:Se.vertexLength,primitiveOffset:Se.primitiveOffset,sortKey:void 0,vaos:{}}}return w&&R.segments.push(w),R}encodeCentroid(e,i){const o=e.centroid(),a=i.span(),h=Math.min(7,Math.round(a.x*this.tileToMeter/10)),f=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new Yt(Ki(o.x,1,Zt-1)<<3|h,Ki(o.y,1,Zt-1)<<3|f)}encodeBorderCentroid(e){if(!e.borders)return new Yt(0,0);const i=e.borders,o=Number.MAX_VALUE;if(i[0][0]!==o||i[1][0]!==o){const a=i[0][0]!==o?0:1;return new Yt(6|(i[0][0]!==o?0:65528),(i[a][0]+i[a][1])/2<<3|6)}{const a=i[2][0]!==o?2:3;return new Yt((i[a][0]+i[a][1])/2<<3|6,6|(i[2][0]!==o?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=Ou,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,a=e.flags&Ou?zv:e.centroidXY,h=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==a.y||h!==a.x){for(let f=i;f<o;++f)this.centroidVertexArray.emplace(f,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,o){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped());if(u1(this.activeReplacements,a))return;if(this.activeReplacements=a,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const f of this.centroidData)f.flags&=2147483647;const h=[];for(const f of this.activeReplacements){if(f.order<o)continue;const x=Math.pow(2,f.footprintTileId.canonical.z-e.canonical.z);for(const w of this.centroidData)if(!(w.flags&Ou||f.min.x>w.max.x||w.min.x>f.max.x||f.min.y>w.max.y||w.min.y>f.max.y))for(let S=0;S<w.footprintSegLen;S++){const P=this.footprintSegments[w.footprintSegIdx+S];if(h.length=0,kT(this.footprintVertices,P.vertexOffset,P.vertexCount,f.footprintTileId.canonical,e.canonical,h),Av(f.footprint,h,this.footprintIndices.uint16,P.indexOffset,P.indexCount,-P.vertexOffset,-x)){w.flags|=Ou;break}}}for(const f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,o){let a=!1;for(let h=0;h<o.footprintSegLen;h++){const f=this.footprintSegments[o.footprintSegIdx+h];let x=0;for(const w of f.ringIndices){for(let S=x,P=w+x-1;S<w+x;P=S++){const R=this.footprintVertices.int16[2*(S+f.vertexOffset)+0],B=this.footprintVertices.int16[2*(S+f.vertexOffset)+1],H=this.footprintVertices.int16[2*(P+f.vertexOffset)+1];B>i!=H>i&&e<(this.footprintVertices.int16[2*(P+f.vertexOffset)+0]-R)*(i-B)/(H-B)+R&&(a=!a)}x=w}}return a}getHeightAtTileCoord(e,i){let o=Number.NEGATIVE_INFINITY,a=!0;const h=4*(e+Zt)*Zt+(i+Zt);if(this.partLookup.hasOwnProperty(h)){const f=this.partLookup[h];return f?{height:f.height,hidden:!!(f.flags&Ou)}:void 0}for(const f of this.centroidData)e>f.max.x||f.min.x>e||i>f.max.y||f.min.y>i||this.footprintContainsPoint(e,i,f)&&f&&f.height>o&&(o=f.height,this.partLookup[h]=f,a=!!(f.flags&Ou));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:a};this.partLookup[h]=void 0}}function Gv(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function RT(t,e,i,o){const a=e.sub(t)._perp()._unit(),h=i.sub(e)._perp()._unit();return Wv(t,e,i,Gv(a,h),o)}function Wv(t,e,i,o,a){const h=Math.sqrt(1-o*o);return Math.min(t.dist(e)/3,e.dist(i)/3,a*h/o)}function h1(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function $v(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function Zv(t,e,i){if(t.x<0||t.x>=Zt||e.x<0||e.x>=Zt||i.x<0||i.x>=Zt)return!1;const o=i.sub(e),a=o.perp(),h=t.sub(e);return(o.x*h.x+o.y*h.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(h.x*h.x+h.y*h.y))>-.866&&a.x*h.x+a.y*h.y<0}function Xv(t,e,i){const o=e?2|t:-3&t;return i?1|o:-2&o}function Yv(){const t=Math.PI/32,e=Math.tan(t),i=rd;return i*Math.sqrt(1+2*e*e)-i}function Kv(t,e,i){const o=1<<i.z,a=ca(i.x/o),h=ca((i.x+1)/o),f=hs(i.y/o),x=hs((i.y+1)/o);return function(w,S,P,R,B=0,H){const $=[];if(!w.length||!P||!R)return $;const te=(Fe,Xe)=>{for(const et of Fe)$.push({polygon:et,bounds:Xe})},ne=Math.ceil(Math.log2(P)),de=Math.ceil(Math.log2(R)),Se=ne-de,Me=[];for(let Fe=0;Fe<Math.abs(Se);Fe++)Me.push(Se>0?0:1);for(let Fe=0;Fe<Math.min(ne,de);Fe++)Me.push(0),Me.push(1);let Le=w;if(Le=km(Le,S[0].y-B,S[1].y+B,1),Le=km(Le,S[0].x-B,S[1].x+B,0),!Le.length)return $;const ze=[];for(Me.length?ze.push({polygons:Le,bounds:S,depth:0}):te(Le,S);ze.length;){const Fe=ze.pop(),Xe=Fe.depth,et=Me[Xe],st=Fe.bounds[0],_t=Fe.bounds[1],dt=et===0?st.x:st.y,St=et===0?_t.x:_t.y,Vt=H?H(et,dt,St):.5*(dt+St),bt=km(Fe.polygons,dt-B,Vt+B,et),kt=km(Fe.polygons,Vt-B,St+B,et);if(bt.length){const yt=[st,new Yt(et===0?Vt:_t.x,et===1?Vt:_t.y)];Me.length>Xe+1?ze.push({polygons:bt,bounds:yt,depth:Xe+1}):te(bt,yt)}if(kt.length){const yt=[new Yt(et===0?Vt:st.x,et===1?Vt:st.y),_t];Me.length>Xe+1?ze.push({polygons:kt,bounds:yt,depth:Xe+1}):te(kt,yt)}}return $}(t,e,Math.ceil((h-a)/11.25),Math.ceil((f-x)/11.25),1,(w,S,P)=>{if(w===0)return .5*(S+P);{const R=hs((i.y+S/Zt)/o);return(fc(.5*(hs((i.y+P/Zt)/o)+R))*o-i.y)*Zt}})}function kT(t,e,i,o,a,h){const f=Math.pow(2,o.z-a.z);for(let x=0;x<i;x++){let w=t.int16[2*(x+e)+0],S=t.int16[2*(x+e)+1];w=(w+a.x*Zt)*f-o.x*Zt,S=(S+a.y*Zt)*f-o.y*Zt,h.push(new Yt(w,S))}}xe(zm,"FillExtrusionBucket",{omit:["layers","features"]}),xe(Uv,"PartData"),xe(Vv,"FootprintSegment"),xe(jv,"BorderCentroidData"),xe(Hv,"GroundEffect");const BT=new Wn({visibility:new It(lt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new It(lt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var NT={paint:new Wn({"fill-extrusion-opacity":new It(lt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new li(lt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new It(lt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new It(lt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new li(lt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new li(lt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new li(lt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new It(lt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new It(lt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new It(lt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new It(lt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new It(lt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new It(lt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new It(lt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new It(lt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new li(lt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new li(lt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new It(lt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new It(lt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new It(lt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new It(lt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new It(lt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:BT};function qf(t,e){return t.x*e.x+t.y*e.y}function Qv(t,e){if(t.length===1){let i=0;const o=e[i++];let a;for(;!a||o.equals(a);)if(a=e[i++],!a)return 1/0;for(;i<e.length;i++){const h=e[i],f=t[0],x=a.sub(o),w=h.sub(o),S=f.sub(o),P=qf(x,x),R=qf(x,w),B=qf(w,w),H=qf(S,x),$=qf(S,w),te=P*B-R*R,ne=(B*H-R*$)/te,de=(P*$-R*H)/te,Se=o.z*(1-ne-de)+a.z*ne+h.z*de;if(isFinite(Se))return Se}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}function Jv(t,e,i,o,a,h,f,x){const w=f*a.getElevationAt(t,e,!0,!0),S=h[0]!==0,P=S?h[1]===0?f*(h[0]/7-450):f*function(R,B,H){const $=Math.floor(B[0]/8),te=Math.floor(B[1]/8),ne=10*(B[0]-8*$),de=10*(B[1]-8*te),Se=R.getElevationAt($,te,!0,!0),Me=R.getMeterToDEM(H),Le=Math.floor(.5*(ne*Me-1)),ze=Math.floor(.5*(de*Me-1)),Fe=R.tileCoordToPixel($,te),Xe=2*Le+1,et=2*ze+1,st=function(kt,yt,Bt,jt,zt){return[kt.getElevationAtPixel(yt,Bt,!0),kt.getElevationAtPixel(yt+zt,Bt,!0),kt.getElevationAtPixel(yt,Bt+zt,!0),kt.getElevationAtPixel(yt+jt,Bt+zt,!0)]}(R,Fe.x-Le,Fe.y-ze,Xe,et),_t=Math.abs(st[0]-st[1]),dt=Math.abs(st[2]-st[3]),St=Math.abs(st[0]-st[2])+Math.abs(st[1]-st[3]),Vt=Math.min(.25,.5*Me*(_t+dt)/Xe),bt=Math.min(.25,.5*Me*St/et);return Se+Math.max(Vt*ne,bt*de)}(a,h,x):w;return{base:w+(i===0)?-1:i,top:S?Math.max(P+o,w+i+2):w+o}}const FT=Yn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:zT}=FT,VT=Yn([{name:"a_packed",components:4,type:"Float32"}]),{members:UT}=VT,jT=Yn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:qT}=jT,HT=Yn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),GT=Yn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),WT=Yn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Yn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const d1=Yn([{name:"a_occlusion_query_opacity",components:1,type:"Float32"}],4),ex=Yn([{name:"a_z_offset",components:1,type:"Float32"}],4),$T=Yn([{name:"a_texb",components:2,type:"Uint16"}]),ZT=Yn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),XT=Yn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Yn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const tx=Yn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),YT=Yn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Yn([{name:"triangle",components:3,type:"Uint16"}]),Yn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Yn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Float32",name:"occlusionState"},{type:"Float32",name:"occlusionOpacity"},{type:"Uint8",name:"hasIconTextFit"}]),Yn([{type:"Float32",name:"offsetX"}]),Yn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class ix{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Mu({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const o=this.getKey(e,i);return this.positions[o]}trim(){const e=this.width,i=this.height=Tc(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,o){const a=[];let h=e.length%2==1?-e[e.length-1]*o:0,f=e[0]*o,x=!0;a.push({left:h,right:f,isDash:x,zeroLength:e[0]===0});let w=e[0];for(let S=1;S<e.length;S++){x=!x;const P=e[S];h=w*o,w+=P,f=w*o,a.push({left:h,right:f,isDash:x,zeroLength:P===0})}return a}addRoundDash(e,i,o){const a=i/2;for(let h=-o;h<=o;h++){const f=this.width*(this.nextRow+o+h);let x=0,w=e[x];for(let S=0;S<this.width;S++){S/w.right>1&&(w=e[++x]);const P=Math.abs(S-w.left),R=Math.abs(S-w.right),B=Math.min(P,R);let H;const $=h/o*(a+1);if(w.isDash){const te=a-Math.abs($);H=Math.sqrt(B*B+te*te)}else H=a-Math.sqrt(B*B+$*$);this.image.data[f+S]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(e,i){for(let w=e.length-1;w>=0;--w){const S=e[w],P=e[w+1];S.zeroLength?e.splice(w,1):P&&P.isDash===S.isDash&&(P.left=S.left,e.splice(w,1))}const o=e[0],a=e[e.length-1];o.isDash===a.isDash&&(o.left=a.left-this.width,a.right=o.right+this.width);const h=this.width*this.nextRow;let f=0,x=e[f];for(let w=0;w<this.width;w++){w/x.right>1&&(x=e[++f]);const S=Math.abs(w-x.left),P=Math.abs(w-x.right),R=Math.min(S,P);this.image.data[h+w]=Math.max(0,Math.min(255,(x.isDash?R:-R)+i+128))}}addDash(e,i){const o=this.getKey(e,i);if(this.positions[o])return this.positions[o];const a=i==="round",h=a?7:0,f=2*h+1;if(this.nextRow+f>this.height)return Dr("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let P=0;P<e.length;P++)e[P]<0&&(Dr("Negative value is found in line dasharray, replacing values with 0"),e[P]=0),x+=e[P];if(x!==0){const P=this.width/x,R=this.getDashRanges(e,this.width,P);a?this.addRoundDash(R,P,h):this.addRegularDash(R,i==="square"?.5*P:0)}const w=this.nextRow+h;this.nextRow+=f;const S={tl:[w,h],br:[x,0]};return this.positions[o]=S,S}}xe(ix,"LineAtlas");const KT=Rm.types,QT=Math.cos(Math.PI/180*37.5),JT=Math.cos(Math.PI/180*5);class Vm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new g0,this.layoutVertexArray2=new wu,this.patternVertexArray=new bu,this.indexArray=new ss,this.programConfigurations=new Su(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new qr,this.maxLineLength=0,this.zOffsetVertexArray=new hh,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Zt/64}updateFootprints(e,i){}populate(e,i,o,a){this.hasPattern=o1("line",this.layers,i);const h=this.layers[0].layout.get("line-sort-key"),f=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!f.isConstant()||!!f.constantOr(0);const x=[];for(const{feature:R,id:B,index:H,sourceLayerIndex:$}of e){const te=this.layers[0]._featureFilter.needGeometry,ne=Hc(R,te);if(!this.layers[0]._featureFilter.filter(new $i(this.zoom),ne,o))continue;const de=h?h.evaluate(ne,{},o):void 0,Se={id:B,properties:R.properties,type:R.type,sourceLayerIndex:$,index:H,geometry:te?ne.geometry:Dl(R,o,a),patterns:{},sortKey:de};x.push(Se)}h&&x.sort((R,B)=>R.sortKey-B.sortKey);const{lineAtlas:w,featureIndex:S}=i,P=this.addConstantDashes(w);for(const R of x){const{geometry:B,index:H,sourceLayerIndex:$}=R;if(P&&this.addFeatureDashes(R,w),this.hasPattern){const te=s1("line",this.layers,R,this.zoom,i);this.patternFeatures.push(te)}else this.addFeature(R,B,H,o,w.positions,i.availableImages,i.brightness);S.insert(e[H].feature,B,H,$,this.index)}}addConstantDashes(e){let i=!1;for(const o of this.layers){const a=o.paint.get("line-dasharray").value,h=o.layout.get("line-cap").value;if(a.kind!=="constant"||h.kind!=="constant")i=!0;else{const f=h.value,x=a.value;if(!x)continue;e.addDash(x,f)}}return i}addFeatureDashes(e,i){const o=this.zoom;for(const a of this.layers){const h=a.paint.get("line-dasharray").value,f=a.layout.get("line-cap").value;if(h.kind==="constant"&&f.kind==="constant")continue;let x,w;if(h.kind==="constant"){if(x=h.value,!x)continue}else x=h.evaluate({zoom:o},e);w=f.kind==="constant"?f.value:f.evaluate({zoom:o},e),i.addDash(x,w),e.patterns[a.id]=i.getKey(x,w)}}update(e,i,o,a,h){const f=Object.keys(e).length!==0;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,f?this.stateDependentLayers:this.layers,o,a,h)}addFeatures(e,i,o,a,h,f){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,i,o,a,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,UT)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,qT)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,ex.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zT),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,a,h,f,x){const w=this.layers[0].layout,S=w.get("line-join").evaluate(e,{}),P=w.get("line-cap").evaluate(e,{}),R=w.get("line-miter-limit"),B=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const H of i)this.addLine(H,e,a,S,P,R,B);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,h,f,a,x)}addLine(e,i,o,a,h,f,x){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const w={zoom:this.zoom,lineProgress:void 0},S=this.layers[0].layout,P=a==="none";if(this.patternJoinNone=this.hasPattern&&P,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Fe=0;Fe<e.length-1;Fe++)this.totalDistance+=e[Fe].dist(e[Fe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const R=KT[i.type]==="Polygon";let B=e.length;for(;B>=2&&e[B-1].equals(e[B-2]);)B--;let H=0;for(;H<B-1&&e[H].equals(e[H+1]);)H++;if(B<(R?3:2))return;a==="bevel"&&(f=1.05);const $=this.overscaling<=16?15*Zt/(512*this.overscaling):0,te=this.segments.prepareSegment(10*B,this.layoutVertexArray,this.indexArray);let ne,de,Se,Me,Le,ze;this.e1=this.e2=-1,R&&(ne=e[B-2],Le=e[H].sub(ne)._unit()._perp());for(let Fe=H;Fe<B;Fe++){if(Se=Fe===B-1?R?e[H+1]:void 0:e[Fe+1],Se&&e[Fe].equals(Se))continue;if(Le&&(Me=Le),ne&&(de=ne),ne=e[Fe],this.hasZOffset){const yt=S.get("line-z-offset").value;if(yt.kind==="constant")ze=yt.value;else{if(this.lineClips){const Bt=this.totalDistance/(this.lineClips.end-this.lineClips.start);w.lineProgress=(Bt*this.lineClips.start+this.distance+(de?de.dist(ne):0))/Bt}else Dr(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),w.lineProgress=0;ze=yt.evaluate(w,i)}ze=ze||0}Le=Se?Se.sub(ne)._unit()._perp():Me,Me=Me||Le;const Xe=de&&Se;let et=Xe?a:R||P?"butt":h;const st=Me.x*Le.x+Me.y*Le.y;if(P){const yt=function(Bt){if(Bt.patternJoinNone){const jt=Bt.segmentPoints.length/2,zt=Bt.lineSoFar-Bt.segmentStart;for(let ri=0;ri<jt;++ri){const Ut=Bt.segmentPoints[2*ri+1],Ht=Math.round(Bt.segmentPoints[2*ri])+.5+.25*Ut;Bt.patternVertexArray.emplaceBack(Ht,zt,Bt.segmentStart),Bt.patternVertexArray.emplaceBack(Ht,zt,Bt.segmentStart)}Bt.segmentPoints.length=0}Bt.e1=Bt.e2=-1};if(Xe&&st<JT){this.updateDistance(de,ne),this.addCurrentVertex(ne,Me,1,1,te,ze),yt(this),this.addCurrentVertex(ne,Le,-1,-1,te,ze);continue}if(de){if(!Se){this.updateDistance(de,ne),this.addCurrentVertex(ne,Me,1,1,te,ze),yt(this);continue}et="miter"}}let _t=Me.add(Le);_t.x===0&&_t.y===0||_t._unit();const dt=_t.x*Le.x+_t.y*Le.y,St=dt!==0?1/dt:1/0,Vt=2*Math.sqrt(2-2*dt),bt=dt<QT&&de&&Se,kt=Me.x*Le.y-Me.y*Le.x>0;if(bt&&Fe>H){const yt=ne.dist(de);if(yt>2*$){const Bt=ne.sub(ne.sub(de)._mult($/yt)._round());this.updateDistance(de,Bt),this.addCurrentVertex(Bt,Me,0,0,te,ze),de=Bt}}if(Xe&&et==="round"&&(St<x?et="miter":St<=2&&(et="fakeround")),et==="miter"&&St>f&&(et="bevel"),et==="bevel"&&(St>2&&(et="flipbevel"),St<f&&(et="miter")),de&&this.updateDistance(de,ne),et==="miter")_t._mult(St),this.addCurrentVertex(ne,_t,0,0,te,ze);else if(et==="flipbevel"){if(St>100)_t=Le.mult(-1);else{const yt=St*Me.add(Le).mag()/Me.sub(Le).mag();_t._perp()._mult(yt*(kt?-1:1))}this.addCurrentVertex(ne,_t,0,0,te,ze),this.addCurrentVertex(ne,_t.mult(-1),0,0,te,ze)}else if(et==="bevel"||et==="fakeround"){const yt=-Math.sqrt(St*St-1),Bt=kt?yt:0,jt=kt?0:yt;if(de&&this.addCurrentVertex(ne,Me,Bt,jt,te,ze),et==="fakeround"){const zt=Math.round(180*Vt/Math.PI/20);for(let ri=1;ri<zt;ri++){let Ut=ri/zt;if(Ut!==.5){const Di=Ut-.5;Ut+=Ut*Di*(Ut-1)*((1.0904+st*(st*(3.55645-1.43519*st)-3.2452))*Di*Di+(.848013+st*(.215638*st-1.06021)))}const Ht=Le.sub(Me)._mult(Ut)._add(Me)._unit()._mult(kt?-1:1);this.addHalfVertex(ne,Ht.x,Ht.y,!1,kt,0,te,ze)}}Se&&this.addCurrentVertex(ne,Le,-Bt,-jt,te,ze)}else et==="butt"?this.addCurrentVertex(ne,_t,0,0,te,ze):et==="square"?(de||this.addCurrentVertex(ne,_t,-1,-1,te,ze),this.addCurrentVertex(ne,_t,0,0,te,ze),de&&this.addCurrentVertex(ne,_t,1,1,te,ze)):et==="round"&&(de&&(this.addCurrentVertex(ne,Me,0,0,te,ze),this.addCurrentVertex(ne,Me,1,1,te,ze,!0)),Se&&(this.addCurrentVertex(ne,Le,-1,-1,te,ze,!0),this.addCurrentVertex(ne,Le,0,0,te,ze)));if(bt&&Fe<B-1){const yt=ne.dist(Se);if(yt>2*$){const Bt=ne.add(Se.sub(ne)._mult($/yt)._round());this.updateDistance(ne,Bt),this.addCurrentVertex(Bt,Le,0,0,te,ze),ne=Bt}}}}addVerticesTo(e,i,o,a,h,f,x,w,S,P){const R=(i.w-e.w)/this.tessellationStep|0;if(R>1){this.lineSoFar=e.w;const B=(i.x-e.x)/R,H=(i.y-e.y)/R,$=(i.z-e.z)/R,te=(i.w-e.w)/R;for(let ne=1;ne<R;++ne)e.x+=B,e.y+=H,e.z+=$,this.lineSoFar+=te,this.addHalfVertex(e,o,a,P,!1,x,S,e.z),this.addHalfVertex(e,h,f,P,!0,-w,S,e.z)}this.lineSoFar=i.w,this.addHalfVertex(i,o,a,P,!1,x,S,i.z),this.addHalfVertex(i,h,f,P,!0,-w,S,i.z)}addCurrentVertex(e,i,o,a,h,f,x=!1){const w=i.x+i.y*o,S=i.y-i.x*o,P=i.y*a-i.x,R=-i.y-i.x*a;if(f!=null){const H=Zt+10,$=f,te=new bv(e.x,e.y,$,this.lineSoFar),ne=nx(e,-10,H),de=this.lineSoFar;if(this.currentVertex)if(ne){const Se=this.currentVertexIsOutside,Me=this.currentVertex,Le=new bv(e.x,e.y,$,this.lineSoFar);Ev(Me,Le,-10,H),nx(Le,-10,H)||(Se&&(this.e1=this.e2=-1,this.lineSoFar=Me.w,this.addHalfVertex(Me,w,S,x,!1,o,h,Me.z),this.addHalfVertex(Me,P,R,x,!0,-a,h,Me.z)),this.addVerticesTo(Me,Le,w,S,P,R,o,a,h,x))}else{const Se=this.currentVertex;this.currentVertexIsOutside&&(Ev(Se,te,-10,H),this.e1=this.e2=-1,this.lineSoFar=Se.w,this.addHalfVertex(Se,w,S,x,!1,o,h,Se.z),this.addHalfVertex(Se,P,R,x,!0,-a,h,Se.z)),this.addVerticesTo(Se,te,w,S,P,R,o,a,h,x)}else ne||(this.addHalfVertex(e,w,S,x,!1,o,h,f),this.addHalfVertex(e,P,R,x,!0,-a,h,f));this.currentVertex=te,this.currentVertexIsOutside=ne,this.lineSoFar=de}else this.addHalfVertex(e,w,S,x,!1,o,h,f),this.addHalfVertex(e,P,R,x,!0,-a,h,f)}addHalfVertex({x:e,y:i},o,a,h,f,x,w,S){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),f||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(i<<1)+(f?1:0),Math.round(63*o)+128,Math.round(63*a)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const P=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),w.primitiveLength++),f?this.e2=P:this.e1=P,S!=null&&this.zOffsetVertexArray.emplaceBack(S)}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}function nx(t,e,i){return t.x<e||t.x>i||t.y<e||t.y>i}xe(Vm,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const eS=new Wn({"line-cap":new li(lt.layout_line["line-cap"]),"line-join":new li(lt.layout_line["line-join"]),"line-miter-limit":new It(lt.layout_line["line-miter-limit"]),"line-round-limit":new It(lt.layout_line["line-round-limit"]),"line-sort-key":new li(lt.layout_line["line-sort-key"]),"line-z-offset":new li(lt.layout_line["line-z-offset"]),visibility:new It(lt.layout_line.visibility)});var Um={paint:new Wn({"line-opacity":new li(lt.paint_line["line-opacity"]),"line-color":new li(lt.paint_line["line-color"]),"line-translate":new It(lt.paint_line["line-translate"]),"line-translate-anchor":new It(lt.paint_line["line-translate-anchor"]),"line-width":new li(lt.paint_line["line-width"]),"line-gap-width":new li(lt.paint_line["line-gap-width"]),"line-offset":new li(lt.paint_line["line-offset"]),"line-blur":new li(lt.paint_line["line-blur"]),"line-dasharray":new li(lt.paint_line["line-dasharray"]),"line-pattern":new li(lt.paint_line["line-pattern"]),"line-gradient":new rs(lt.paint_line["line-gradient"]),"line-trim-offset":new It(lt.paint_line["line-trim-offset"]),"line-trim-fade-range":new It(lt.paint_line["line-trim-fade-range"]),"line-trim-color":new It(lt.paint_line["line-trim-color"]),"line-emissive-strength":new It(lt.paint_line["line-emissive-strength"]),"line-border-width":new li(lt.paint_line["line-border-width"]),"line-border-color":new li(lt.paint_line["line-border-color"]),"line-occlusion-opacity":new It(lt.paint_line["line-occlusion-opacity"])}),layout:eS};function rx(t,e,i){return e*(Zt/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}function ox(t,e){return 1/rx(t,1,e.tileZoom)}function sx(t,e,i,o){return t.translatePosMatrix(o||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const ax=t=>{const e=[];lx(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=t.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const o=t.layout.get("line-join").constantOr("miter")==="none",a=!!t.paint.get("line-pattern").constantOr(1);return o&&a&&e.push("LINE_JOIN_NONE"),e};function lx(t){const e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}class cx{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var tS={read:function(t,e,i,o,a){var h,f,x=8*a-o-1,w=(1<<x)-1,S=w>>1,P=-7,R=i?a-1:0,B=i?-1:1,H=t[e+R];for(R+=B,h=H&(1<<-P)-1,H>>=-P,P+=x;P>0;h=256*h+t[e+R],R+=B,P-=8);for(f=h&(1<<-P)-1,h>>=-P,P+=o;P>0;f=256*f+t[e+R],R+=B,P-=8);if(h===0)h=1-S;else{if(h===w)return f?NaN:1/0*(H?-1:1);f+=Math.pow(2,o),h-=S}return(H?-1:1)*f*Math.pow(2,h-o)},write:function(t,e,i,o,a,h){var f,x,w,S=8*h-a-1,P=(1<<S)-1,R=P>>1,B=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,H=o?0:h-1,$=o?1:-1,te=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,f=P):(f=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-f))<1&&(f--,w*=2),(e+=f+R>=1?B/w:B*Math.pow(2,1-R))*w>=2&&(f++,w/=2),f+R>=P?(x=0,f=P):f+R>=1?(x=(e*w-1)*Math.pow(2,a),f+=R):(x=e*Math.pow(2,R-1)*Math.pow(2,a),f=0));a>=8;t[i+H]=255&x,H+=$,x/=256,a-=8);for(f=f<<a|x,S+=a;S>0;t[i+H]=255&f,H+=$,f/=256,S-=8);t[i+H-$]|=128*te}},ux=Fr,jm=tS;function Fr(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Fr.Varint=0,Fr.Fixed64=1,Fr.Bytes=2,Fr.Fixed32=5;var f1=4294967296,hx=1/f1,dx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function $c(t){return t.type===Fr.Bytes?t.readVarint()+t.pos:t.pos+1}function ud(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function fx(t,e,i){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(var a=i.pos-1;a>=t;a--)i.buf[a+o]=i.buf[a]}function iS(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function nS(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function rS(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function oS(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function sS(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function aS(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function lS(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function cS(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function uS(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function qm(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function hd(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function px(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Fr.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var o=this.readVarint(),a=o>>3,h=this.pos;this.type=7&o,t(a,e,this),this.pos===h&&this.skip(o)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=qm(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=px(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=qm(this.buf,this.pos)+qm(this.buf,this.pos+4)*f1;return this.pos+=8,t},readSFixed64:function(){var t=qm(this.buf,this.pos)+px(this.buf,this.pos+4)*f1;return this.pos+=8,t},readFloat:function(){var t=jm.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=jm.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,o=this.buf;return e=127&(i=o[this.pos++]),i<128?e:(e|=(127&(i=o[this.pos++]))<<7,i<128?e:(e|=(127&(i=o[this.pos++]))<<14,i<128?e:(e|=(127&(i=o[this.pos++]))<<21,i<128?e:function(a,h,f){var x,w,S=f.buf;if(x=(112&(w=S[f.pos++]))>>4,w<128||(x|=(127&(w=S[f.pos++]))<<3,w<128)||(x|=(127&(w=S[f.pos++]))<<10,w<128)||(x|=(127&(w=S[f.pos++]))<<17,w<128)||(x|=(127&(w=S[f.pos++]))<<24,w<128)||(x|=(1&(w=S[f.pos++]))<<31,w<128))return ud(a,x,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=o[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&dx?function(i,o,a){return dx.decode(i.subarray(o,a))}(this.buf,e,t):function(i,o,a){for(var h="",f=o;f<a;){var x,w,S,P=i[f],R=null,B=P>239?4:P>223?3:P>191?2:1;if(f+B>a)break;B===1?P<128&&(R=P):B===2?(192&(x=i[f+1]))==128&&(R=(31&P)<<6|63&x)<=127&&(R=null):B===3?(w=i[f+2],(192&(x=i[f+1]))==128&&(192&w)==128&&((R=(15&P)<<12|(63&x)<<6|63&w)<=2047||R>=55296&&R<=57343)&&(R=null)):B===4&&(w=i[f+2],S=i[f+3],(192&(x=i[f+1]))==128&&(192&w)==128&&(192&S)==128&&((R=(15&P)<<18|(63&x)<<12|(63&w)<<6|63&S)<=65535||R>=1114112)&&(R=null)),R===null?(R=65533,B=1):R>65535&&(R-=65536,h+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),h+=String.fromCharCode(R),f+=B}return h}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Fr.Bytes)return t.push(this.readVarint(e));var i=$c(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Fr.Bytes)return t.push(this.readSVarint());var e=$c(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Fr.Bytes)return t.push(this.readBoolean());var e=$c(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Fr.Bytes)return t.push(this.readFloat());var e=$c(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Fr.Bytes)return t.push(this.readDouble());var e=$c(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Fr.Bytes)return t.push(this.readFixed32());var e=$c(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Fr.Bytes)return t.push(this.readSFixed32());var e=$c(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Fr.Bytes)return t.push(this.readFixed64());var e=$c(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Fr.Bytes)return t.push(this.readSFixed64());var e=$c(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Fr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Fr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Fr.Fixed32)this.pos+=4;else{if(e!==Fr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),hd(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),hd(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),hd(this.buf,-1&t,this.pos),hd(this.buf,Math.floor(t*hx),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),hd(this.buf,-1&t,this.pos),hd(this.buf,Math.floor(t*hx),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var o,a;if(e>=0?(o=e%4294967296|0,a=e/4294967296|0):(a=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,a=a+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(h,f,x){x.buf[x.pos++]=127&h|128,h>>>=7,x.buf[x.pos++]=127&h|128,h>>>=7,x.buf[x.pos++]=127&h|128,h>>>=7,x.buf[x.pos++]=127&h|128,x.buf[x.pos]=127&(h>>>=7)}(o,0,i),function(h,f){var x=(7&h)<<4;f.buf[f.pos++]|=x|((h>>>=3)?128:0),h&&(f.buf[f.pos++]=127&h|((h>>>=7)?128:0),h&&(f.buf[f.pos++]=127&h|((h>>>=7)?128:0),h&&(f.buf[f.pos++]=127&h|((h>>>=7)?128:0),h&&(f.buf[f.pos++]=127&h|((h>>>=7)?128:0),h&&(f.buf[f.pos++]=127&h)))))}(a,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(o,a,h){for(var f,x,w=0;w<a.length;w++){if((f=a.charCodeAt(w))>55295&&f<57344){if(!x){f>56319||w+1===a.length?(o[h++]=239,o[h++]=191,o[h++]=189):x=f;continue}if(f<56320){o[h++]=239,o[h++]=191,o[h++]=189,x=f;continue}f=x-55296<<10|f-56320|65536,x=null}else x&&(o[h++]=239,o[h++]=191,o[h++]=189,x=null);f<128?o[h++]=f:(f<2048?o[h++]=f>>6|192:(f<65536?o[h++]=f>>12|224:(o[h++]=f>>18|240,o[h++]=f>>12&63|128),o[h++]=f>>6&63|128),o[h++]=63&f|128)}return h}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&fx(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),jm.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),jm.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var o=this.pos-i;o>=128&&fx(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o},writeMessage:function(t,e,i){this.writeTag(t,Fr.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,iS,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,nS,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,sS,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,rS,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,oS,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,aS,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,lS,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,cS,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,uS,e)},writeBytesField:function(t,e){this.writeTag(t,Fr.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Fr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Fr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Fr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Fr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Fr.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Fr.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Fr.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Fr.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Fr.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var dd=G(ux);const hS=["id","tile","layer","source","sourceLayer","state"];class mx{constructor(e,i,o,a,h){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=o,this._y=a,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of hS)this[i]!==void 0&&(e[i]=this[i]);return e}}class dS{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,o){const a=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][a]=this.stateChanges[e][a]||{},An(this.stateChanges[e][a],o),this.deletedStates[e]===null){this.deletedStates[e]={};for(const h in this.state[e])h!==a&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][a]===null){this.deletedStates[e][a]={};for(const h in this.state[e][a])o[h]||(this.deletedStates[e][a][h]=null)}else for(const h in o)this.deletedStates[e]&&this.deletedStates[e][a]&&this.deletedStates[e][a][h]===null&&delete this.deletedStates[e][a][h]}removeFeatureState(e,i,o){if(this.deletedStates[e]===null)return;const a=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},o&&i!==void 0)this.deletedStates[e][a]!==null&&(this.deletedStates[e][a]=this.deletedStates[e][a]||{},this.deletedStates[e][a][o]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][a])for(o in this.deletedStates[e][a]={},this.stateChanges[e][a])this.deletedStates[e][a][o]=null;else this.deletedStates[e][a]=null;else this.deletedStates[e]=null}getState(e,i){const o=String(i),a=An({},(this.state[e]||{})[o],(this.stateChanges[e]||{})[o]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const h=this.deletedStates[e][i];if(h===null)return{};for(const f in h)delete a[f]}return a}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const o={};for(const a in this.stateChanges){this.state[a]=this.state[a]||{};const h={};for(const f in this.stateChanges[a])this.state[a][f]||(this.state[a][f]={}),An(this.state[a][f],this.stateChanges[a][f]),h[f]=this.state[a][f];o[a]=h}for(const a in this.deletedStates){this.state[a]=this.state[a]||{};const h={};if(this.deletedStates[a]===null)for(const f in this.state[a])h[f]={},this.state[a][f]={};else for(const f in this.deletedStates[a]){if(this.deletedStates[a][f]===null)this.state[a][f]={};else if(this.state[a][f])for(const x of Object.keys(this.deletedStates[a][f]))delete this.state[a][f][x];h[f]=this.state[a][f]}o[a]=o[a]||{},An(o[a],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(const a in e)e[a].setFeatureState(o,i)}}class gx{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ve(Zt,16,0),this.featureIndexArray=new Iy,this.promoteId=i,this.is3DTile=!1}insert(e,i,o,a,h,f=0,x=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,a,h,f);const S=this.grid;for(let P=0;P<i.length;P++){const R=i[P],B=[1/0,1/0,-1/0,-1/0];for(let H=0;H<R.length;H++){const $=R[H];B[0]=Math.min(B[0],$.x),B[1]=Math.min(B[1],$.y),B[2]=Math.max(B[2],$.x),B[3]=Math.max(B[3],$.y)}x!==0&&(B[0]-=x,B[1]-=x,B[2]+=x,B[3]+=x),B[0]<Zt&&B[1]<Zt&&B[2]>=0&&B[3]>=0&&S.insert(w,B[0],B[1],B[2],B[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new l1(new dd(this.rawTileData)).layers,this.sourceLayerCoder=new cx(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,o,a){this.loadVTLayers();const h=e.params||{},f=ws(h.filter),x=e.tileResult,w=e.transform,S=x.bufferedTilespaceBounds,P=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,($,te,ne,de)=>Gy(x.bufferedTilespaceGeometry,$,te,ne,de));P.sort(fS);let R=null;w.elevation&&P.length>0&&(R=cd.create(w.elevation,this.tileID));const B={};let H;for(let $=0;$<P.length;$++){const te=P[$];if(te===H)continue;H=te;const ne=this.featureIndexArray.get(te);let de=null;if(this.is3DTile){const Se=this.bucketLayerIDs[0][0],Me=i[Se];if(Me.type!=="model")continue;const{queryFeature:Le,intersectionZ:ze}=Me.queryIntersectsMatchingFeature(x,ne.featureIndex,f,w);Le&&this.appendToResult(B,Se,ne.featureIndex,Le,ze)}else this.loadMatchingFeature(B,ne,f,h.layers,h.availableImages,i,o,a,(Se,Me,Le,ze=0)=>(de||(de=Dl(Se,this.tileID.canonical,e.tileTransform)),Me.queryIntersectsFeature(x,Se,Le,de,this.z,e.transform,e.pixelPosMatrix,R,ze)))}return B}loadMatchingFeature(e,i,o,a,h,f,x,w,S){const{featureIndex:P,bucketIndex:R,sourceLayerIndex:B,layoutVertexArrayOffset:H}=i,$=this.bucketLayerIDs[R];if(a&&!function(Se,Me){for(let Le=0;Le<Se.length;Le++)if(Me.indexOf(Se[Le])>=0)return!0;return!1}(a,$))return;const te=this.sourceLayerCoder.decode(B),ne=this.vtLayers[te].feature(P);if(o.needGeometry){const Se=Hc(ne,!0);if(!o.filter(new $i(this.tileID.overscaledZ),Se,this.tileID.canonical))return}else if(!o.filter(new $i(this.tileID.overscaledZ),ne))return;const de=this.getId(ne,te);for(let Se=0;Se<$.length;Se++){const Me=$[Se];if(a&&a.indexOf(Me)<0)continue;const Le=f[Me];if(!Le)continue;let ze={};de!==void 0&&w&&(ze=w.getState(Le.sourceLayer||"_geojsonTileLayer",de));const Fe=!S||S(ne,Le,ze,H);if(!Fe)continue;const Xe=new mx(ne,this.z,this.x,this.y,de),et=An({},x[Me]);et.paint=_x(et.paint,Le.paint,ne,ze,h),et.layout=_x(et.layout,Le.layout,ne,ze,h),Xe.layer=et,this.appendToResult(e,Me,P,Xe,Fe)}}appendToResult(e,i,o,a,h){let f=e[i];f===void 0&&(f=e[i]=[]),f.push({featureIndex:o,feature:a,intersectionZ:h})}lookupSymbolFeatures(e,i,o,a,h,f,x,w){const S={};this.loadVTLayers();const P=ws(h);for(const R of e)this.loadMatchingFeature(S,{bucketIndex:o,sourceLayerIndex:a,featureIndex:R,layoutVertexArrayOffset:0},P,f,x,w,i);return S}loadFeature(e){const{featureIndex:i,sourceLayerIndex:o}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(o),h=this.vtFeatures[a];if(h[i])return h[i];const f=this.vtLayers[a].feature(i);return h[i]=f,f}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;if(this.promoteId){const a=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];a!=null&&(o=e.properties[a]),typeof o=="boolean"&&(o=Number(o))}return o}}function _x(t,e,i,o,a){return zs(t,(h,f)=>{const x=e instanceof xr?e.get(f):null;return x&&x.evaluate?x.evaluate(i,o,a):x})}function fS(t,e){return e-t}xe(gx,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var Cs=24;const Rl=128;function p1(t,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new $i(t+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:a}=i;let h=0;for(;h<o.length&&o[h]<=t;)h++;h=Math.max(0,h-1);let f=h;for(;f<o.length&&o[f]<t+1;)f++;f=Math.min(o.length-1,f);const x=o[h],w=o[f];return i.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:w,interpolationType:a}:{kind:"camera",minZoom:x,maxZoom:w,minSize:i.evaluate(new $i(x)),maxSize:i.evaluate(new $i(w)),interpolationType:a}}}function Hm(t,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:a}){return t.kind==="source"?o/Rl:t.kind==="composite"?Fi(o/Rl,a/Rl,i):e}function fd(t,e){let i=0,o=0;if(t.kind==="constant")o=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:a,minZoom:h,maxZoom:f}=t,x=a?Ki(aa.interpolationFactor(a,e,h,f),0,1):0;t.kind==="camera"?o=Fi(t.minSize,t.maxSize,x):i=x}return{uSizeT:i,uSize:o}}var pS=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Rl,evaluateSizeForFeature:Hm,evaluateSizeForZoom:fd,getSizeData:p1});function mS(t,e,i){return t.sections.forEach(o=>{o.text=function(a,h,f){const x=h.layout.get("text-transform").evaluate(f,{});return x==="uppercase"?a=a.toLocaleUpperCase():x==="lowercase"&&(a=a.toLocaleLowerCase()),vn.applyArabicShaping&&(a=vn.applyArabicShaping(a)),a}(o.text,e,i)}),t}const Hf={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function gS(t){return t==="︶"||t==="﹈"||t==="︸"||t==="﹄"||t==="﹂"||t==="︾"||t==="︼"||t==="︺"||t==="︘"||t==="﹀"||t==="︐"||t==="︓"||t==="︔"||t==="｀"||t==="￣"||t==="︑"||t==="︒"}function _S(t){return t==="︵"||t==="﹇"||t==="︷"||t==="﹃"||t==="﹁"||t==="︽"||t==="︻"||t==="︹"||t==="︗"||t==="︿"}const m1=3;function yS(t,e,i){e.glyphs=[],t===1&&i.readMessage(vS,e)}function vS(t,e,i){if(t===3){const{id:o,bitmap:a,width:h,height:f,left:x,top:w,advance:S}=i.readMessage(xS,{});e.glyphs.push({id:o,bitmap:new Mu({width:h+2*m1,height:f+2*m1},a),metrics:{width:h,height:f,left:x,top:w,advance:S}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function xS(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}const yx=m1,Xa={horizontal:1,vertical:2,horizontalOnly:3};class Gf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const o=new Gf;return o.scale=e||1,o.fontStack=i,o}static forImage(e){const i=new Gf;return i.imageName=e,i}}class pd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const o=new pd;for(let a=0;a<e.sections.length;a++){const h=e.sections[a];h.image?o.addImageSection(h):o.addTextSection(h,i)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,o){let a="";for(let h=0;h<i.length;h++){const f=i.charCodeAt(h+1)||null,x=i.charCodeAt(h-1)||null;a+=!o&&(f&&ot(f)&&!Hf[i[h+1]]||x&&ot(x)&&!Hf[i[h-1]])||!Hf[i[h]]?i[h]:Hf[i[h]]}return a}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&Gm[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&Gm[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const o=new pd;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Gf.forText(e.scale,e.fontStack||i));const o=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(o)}addImageSection(e){const i=e.image?e.image.namePrimary:"";if(i.length===0)return void Dr("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCodePoint(o),this.sections.push(Gf.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Dr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function g1(t,e,i,o,a,h,f,x,w,S,P,R,B,H,$){const te=pd.fromFeature(t,a);R===Xa.vertical&&te.verticalizePunctuation(B);let ne=[];const de=function(Fe,Xe,et,st,_t,dt){if(!Fe)return[];const St=[],Vt=function(Bt,jt,zt,ri,Ut,Ht){let Di=0;for(let Si=0;Si<Bt.length();Si++){const Ci=Bt.getSection(Si);Di+=vx(Bt.getCodePoint(Si),Ci,ri,Ut,jt,Ht)}return Di/Math.max(1,Math.ceil(Di/zt))}(Fe,Xe,et,st,_t,dt),bt=Fe.text.indexOf("​")>=0;let kt=0;for(let Bt=0;Bt<Fe.length();Bt++){const jt=Fe.getSection(Bt),zt=Fe.getCodePoint(Bt);if(Gm[zt]||(kt+=vx(zt,jt,st,_t,Xe,dt)),Bt<Fe.length()-1){const ri=!((yt=zt)<11904||!($e["Bopomofo Extended"](yt)||$e.Bopomofo(yt)||$e["CJK Compatibility Forms"](yt)||$e["CJK Compatibility Ideographs"](yt)||$e["CJK Compatibility"](yt)||$e["CJK Radicals Supplement"](yt)||$e["CJK Strokes"](yt)||$e["CJK Symbols and Punctuation"](yt)||$e["CJK Unified Ideographs Extension A"](yt)||$e["CJK Unified Ideographs"](yt)||$e["Enclosed CJK Letters and Months"](yt)||$e["Halfwidth and Fullwidth Forms"](yt)||$e.Hiragana(yt)||$e["Ideographic Description Characters"](yt)||$e["Kangxi Radicals"](yt)||$e["Katakana Phonetic Extensions"](yt)||$e.Katakana(yt)||$e["Vertical Forms"](yt)||$e["Yi Radicals"](yt)||$e["Yi Syllables"](yt)));(wS[zt]||ri||jt.imageName)&&St.push(wx(Bt+1,kt,Vt,St,bS(zt,Fe.getCodePoint(Bt+1),ri&&bt),!1))}}var yt;return bx(wx(Fe.length(),kt,Vt,St,0,!0))}(te,S,h,e,o,H),{processBidirectionalText:Se,processStyledBidirectionalText:Me}=vn;if(Se&&te.sections.length===1){const Fe=Se(te.toString(),de);for(const Xe of Fe){const et=new pd;et.text=Xe,et.sections=te.sections;for(let st=0;st<Xe.length;st++)et.sectionIndex.push(0);ne.push(et)}}else if(Me){const Fe=Me(te.text,te.sectionIndex,de);for(const Xe of Fe){const et=new pd;et.text=Xe[0],et.sectionIndex=Xe[1],et.sections=te.sections,ne.push(et)}}else ne=function(Fe,Xe){const et=[],st=Fe.text;let _t=0;for(const dt of Xe)et.push(Fe.substring(_t,dt)),_t=dt;return _t<st.length&&et.push(Fe.substring(_t,st.length)),et}(te,de);const Le=[],ze={positionedLines:Le,text:te.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:R,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Fe,Xe,et,st,_t,dt,St,Vt,bt,kt,yt,Bt){let jt=0,zt=0,ri=0;const Ut=Vt==="right"?1:Vt==="left"?0:.5;let Ht=!1;for(const cn of _t){const Gi=cn.getSections();for(const mn of Gi){if(mn.imageName)continue;const un=Xe[mn.fontStack];if(un&&(Ht=un.ascender!==void 0&&un.descender!==void 0,!Ht))break}if(!Ht)break}let Di=0;for(const cn of _t){cn.trim();const Gi=cn.getMaxScale(),mn=(Gi-1)*Cs,un={positionedGlyphs:[],lineOffset:0};Fe.positionedLines[Di]=un;const xn=un.positionedGlyphs;let qi=0;if(!cn.length()){zt+=dt,++Di;continue}let ur=0,sr=0;for(let Pn=0;Pn<cn.length();Pn++){const qn=cn.getSection(Pn),Er=cn.getSectionIndex(Pn),_r=cn.getCodePoint(Pn);let Kr=qn.scale,Hr=null,Os=null,co=null,zr=Cs,Mo=0;const ds=!(bt===Xa.horizontal||!yt&&!Lt(_r)||yt&&(Gm[_r]||(Si=_r,$e.Arabic(Si)||$e["Arabic Supplement"](Si)||$e["Arabic Extended-A"](Si)||$e["Arabic Presentation Forms-A"](Si)||$e["Arabic Presentation Forms-B"](Si))));if(qn.imageName){const fs=st[qn.imageName];if(!fs)continue;co=qn.imageName,Fe.iconsInText=Fe.iconsInText||!0,Os=fs.paddedRect;const wr=fs.displaySize;Kr=Kr*Cs/Bt,Hr={width:wr[0],height:wr[1],left:0,top:-yx,advance:ds?wr[1]:wr[0],localGlyph:!1},Mo=Ht?-Hr.height*Kr:Gi*Cs-17-wr[1]*Kr,zr=Hr.advance;const Ys=(ds?wr[0]:wr[1])*Kr-Cs*Gi;Ys>0&&Ys>qi&&(qi=Ys)}else{const fs=et[qn.fontStack];if(!fs)continue;fs[_r]&&(Os=fs[_r]);const wr=Xe[qn.fontStack];if(!wr)continue;const Ys=wr.glyphs[_r];if(!Ys)continue;if(Hr=Ys.metrics,zr=_r!==8203?Cs:0,Ht){const Xc=wr.ascender!==void 0?Math.abs(wr.ascender):0,pl=wr.descender!==void 0?Math.abs(wr.descender):0,Vl=(Xc+pl)*Kr;ur<Vl&&(ur=Vl,sr=(Xc-pl)/2*Kr),Mo=-Xc*Kr}else Mo=(Gi-Kr)*Cs-17}ds?(Fe.verticalizable=!0,xn.push({glyph:_r,imageName:co,x:jt,y:zt+Mo,vertical:ds,scale:Kr,localGlyph:Hr.localGlyph,fontStack:qn.fontStack,sectionIndex:Er,metrics:Hr,rect:Os}),jt+=zr*Kr+kt):(xn.push({glyph:_r,imageName:co,x:jt,y:zt+Mo,vertical:ds,scale:Kr,localGlyph:Hr.localGlyph,fontStack:qn.fontStack,sectionIndex:Er,metrics:Hr,rect:Os}),jt+=Hr.advance*Kr+kt)}xn.length!==0&&(ri=Math.max(jt-kt,ri),Ht?Cx(xn,Ut,qi,sr,dt*Gi/2):Cx(xn,Ut,qi,0,dt/2)),jt=0;const jn=dt*Gi+qi;un.lineOffset=Math.max(qi,mn),zt+=jn,++Di}var Si;const Ci=zt,{horizontalAlign:qt,verticalAlign:Ni}=_1(St);(function(cn,Gi,mn,un,xn,qi){const ur=(Gi-mn)*xn,sr=-qi*un;for(const jn of cn)for(const Pn of jn.positionedGlyphs)Pn.x+=ur,Pn.y+=sr})(Fe.positionedLines,Ut,qt,Ni,ri,Ci),Fe.top+=-Ni*Ci,Fe.bottom=Fe.top+Ci,Fe.left+=-qt*ri,Fe.right=Fe.left+ri,Fe.hasBaseline=Ht}(ze,e,i,o,ne,f,x,w,R,S,B,$),!function(Fe){for(const Xe of Fe)if(Xe.positionedGlyphs.length!==0)return!1;return!0}(Le)&&ze}const Gm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},wS={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function vx(t,e,i,o,a,h){if(e.imageName){const f=o[e.imageName];return f?f.displaySize[0]*e.scale*Cs/h+a:0}{const f=i[e.fontStack],x=f&&f.glyphs[t];return x?x.metrics.advance*e.scale+a:0}}function xx(t,e,i,o){const a=Math.pow(t-e,2);return o?t<e?a/2:2*a:a+Math.abs(i)*i}function bS(t,e,i){let o=0;return t===10&&(o-=1e4),i&&(o+=150),t!==40&&t!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function wx(t,e,i,o,a,h){let f=null,x=xx(e,i,a,h);for(const w of o){const S=xx(e-w.x,i,a,h)+w.badness;S<=x&&(f=w,x=S)}return{index:t,x:e,priorBreak:f,badness:x}}function bx(t){return t?bx(t.priorBreak).concat(t.index):[]}function _1(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Cx(t,e,i,o,a){if(!(e||i||o||a))return;const h=t.length-1,f=t[h],x=(f.x+f.metrics.advance*f.scale)*e;for(let w=0;w<=h;w++)t[w].x-=x,t[w].y+=i+o+a}function CS(t,e,i,o){const{horizontalAlign:a,verticalAlign:h}=_1(o),f=i[0]-t.displaySize[0]*a,x=i[1]-t.displaySize[1]*h;return{imagePrimary:t,imageSecondary:e,top:x,bottom:x+t.displaySize[1],left:f,right:f+t.displaySize[0]}}function Ex(t,e,i,o,a,h){const f=t.imagePrimary;let x;if(f.content){const ne=f.content,de=f.pixelRatio||1;x=[ne[0]/de,ne[1]/de,f.displaySize[0]-ne[2]/de,f.displaySize[1]-ne[3]/de]}const w=e.left*h,S=e.right*h;let P,R,B,H;i==="width"||i==="both"?(H=a[0]+w-o[3],R=a[0]+S+o[1]):(H=a[0]+(w+S-f.displaySize[0])/2,R=H+f.displaySize[0]);const $=e.top*h,te=e.bottom*h;return i==="height"||i==="both"?(P=a[1]+$-o[0],B=a[1]+te+o[2]):(P=a[1]+($+te-f.displaySize[1])/2,B=P+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:P,right:R,bottom:B,left:H,collisionPadding:x}}class Zc extends Yt{constructor(e,i,o,a,h){super(e,i),this.angle=a,this.z=o,h!==void 0&&(this.segment=h)}clone(){return new Zc(this.x,this.y,this.z,this.angle,this.segment)}}function Tx(t,e,i,o,a){if(e.segment===void 0)return!0;let h=e,f=e.segment+1,x=0;for(;x>-i/2;){if(f--,f<0)return!1;x-=t[f].dist(h),h=t[f]}x+=t[f].dist(t[f+1]),f++;const w=[];let S=0;for(;x<i/2;){const P=t[f],R=t[f+1];if(!R)return!1;let B=t[f-1].angleTo(P)-P.angleTo(R);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:x,angleDelta:B}),S+=B;x-w[0].distance>o;)S-=w.shift().angleDelta;if(S>a)return!1;f++,x+=P.dist(R)}return!0}function Sx(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function Ax(t,e,i){return t?.6*e*i:0}function Ix(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function ES(t,e,i,o,a,h){const f=Ax(i,a,h),x=Ix(i,o)*h;let w=0;const S=Sx(t)/2;for(let P=0;P<t.length-1;P++){const R=t[P],B=t[P+1],H=R.dist(B);if(w+H>S){const $=(S-w)/H,te=Fi(R.x,B.x,$),ne=Fi(R.y,B.y,$),de=new Zc(te,ne,0,B.angleTo(R),P);return!f||Tx(t,de,x,f,e)?de:void 0}w+=H}}function TS(t,e,i,o,a,h,f,x,w){const S=Ax(o,h,f),P=Ix(o,a),R=P*f,B=t[0].x===0||t[0].x===w||t[0].y===0||t[0].y===w;return e-R<e/4&&(e=R+e/4),Mx(t,B?e/2*x%e:(P/2+2*h)*f*x%e,e,S,i,R,B,!1,w)}function Mx(t,e,i,o,a,h,f,x,w){const S=h/2,P=Sx(t);let R=0,B=e-i,H=[];for(let $=0;$<t.length-1;$++){const te=t[$],ne=t[$+1],de=te.dist(ne),Se=ne.angleTo(te);for(;B+i<R+de;){B+=i;const Me=(B-R)/de,Le=Fi(te.x,ne.x,Me),ze=Fi(te.y,ne.y,Me);if(Le>=0&&Le<w&&ze>=0&&ze<w&&B-S>=0&&B+S<=P){const Fe=new Zc(Le,ze,0,Se,$);o&&!Tx(t,Fe,h,o,a)||H.push(Fe)}}R+=de}return x||H.length||f||(H=Mx(t,R/2,i,o,a,h,f,!0,w)),H}function Lx(t,e,i,o,a){const h=[];for(let f=0;f<t.length;f++){const x=t[f];let w;for(let S=0;S<x.length-1;S++){let P=x[S],R=x[S+1];P.x<e&&R.x<e||(P.x<e?P=new Yt(e,P.y+(e-P.x)/(R.x-P.x)*(R.y-P.y))._round():R.x<e&&(R=new Yt(e,P.y+(e-P.x)/(R.x-P.x)*(R.y-P.y))._round()),P.y<i&&R.y<i||(P.y<i?P=new Yt(P.x+(i-P.y)/(R.y-P.y)*(R.x-P.x),i)._round():R.y<i&&(R=new Yt(P.x+(i-P.y)/(R.y-P.y)*(R.x-P.x),i)._round()),P.x>=o&&R.x>=o||(P.x>=o?P=new Yt(o,P.y+(o-P.x)/(R.x-P.x)*(R.y-P.y))._round():R.x>=o&&(R=new Yt(o,P.y+(o-P.x)/(R.x-P.x)*(R.y-P.y))._round()),P.y>=a&&R.y>=a||(P.y>=a?P=new Yt(P.x+(a-P.y)/(R.y-P.y)*(R.x-P.x),a)._round():R.y>=a&&(R=new Yt(P.x+(a-P.y)/(R.y-P.y)*(R.x-P.x),a)._round()),w&&P.equals(w[w.length-1])||(w=[P],h.push(w)),w.push(R)))))}}return h}function Ox(t){let e=0,i=0;for(const f of t)e+=f.w*f.h,i=Math.max(i,f.w);t.sort((f,x)=>x.h-f.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let a=0,h=0;for(const f of t)for(let x=o.length-1;x>=0;x--){const w=o[x];if(!(f.w>w.w||f.h>w.h)){if(f.x=w.x,f.y=w.y,h=Math.max(h,f.y+f.h),a=Math.max(a,f.x+f.w),f.w===w.w&&f.h===w.h){const S=o.pop();x<o.length&&(o[x]=S)}else f.h===w.h?(w.x+=f.w,w.w-=f.w):f.w===w.w?(w.y+=f.h,w.h-=f.h):(o.push({x:w.x+f.w,y:w.y,w:w.w-f.w,h:f.h}),w.y+=f.h,w.h-=f.h);break}}return{w:a,h,fill:e/(a*h)||0}}xe(Zc,"Anchor");const Ia=1;class y1{constructor(e,{pixelRatio:i,version:o,stretchX:a,stretchY:h,content:f}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=a,this.stretchY=h,this.content=f,this.version=o}get tl(){return[this.paddedRect.x+Ia,this.paddedRect.y+Ia]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ia,this.paddedRect.y+this.paddedRect.h-Ia]}get displaySize(){return[(this.paddedRect.w-2*Ia)/this.pixelRatio,(this.paddedRect.h-2*Ia)/this.pixelRatio]}}class Px{constructor(e,i,o){const a={},h={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,a,f),this.addImages(i,h,f);const{w:x,h:w}=Ox(f),S=new Za({width:x||1,height:w||1});for(const P in e){const R=e[P],B=a[P].paddedRect;Za.copy(R.data,S,{x:0,y:0},{x:B.x+Ia,y:B.y+Ia},R.data,o,R.sdf)}for(const P in i){const R=i[P],B=h[P].paddedRect,H=B.x+Ia,$=B.y+Ia,te=R.data.width,ne=R.data.height;Za.copy(R.data,S,{x:0,y:0},{x:H,y:$},R.data,o),Za.copy(R.data,S,{x:0,y:ne-1},{x:H,y:$-1},{width:te,height:1},o),Za.copy(R.data,S,{x:0,y:0},{x:H,y:$+ne},{width:te,height:1},o),Za.copy(R.data,S,{x:te-1,y:0},{x:H-1,y:$},{width:1,height:ne},o),Za.copy(R.data,S,{x:0,y:0},{x:H+te,y:$},{width:1,height:ne},o)}this.image=S,this.iconPositions=a,this.patternPositions=h}addImages(e,i,o){for(const a in e){const h=e[a],f={x:0,y:0,w:h.data.width+2*Ia,h:h.data.height+2*Ia};o.push(f),i[a]=new y1(f,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,i,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(const a in e.getUpdatedImages(o))this.patchUpdatedImage(this.iconPositions[a],e.getImage(a,o),i),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a,o),i)}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[a,h]=e.tl,f=!!Object.keys(this.patternPositions).length;o.update(i.data,{useMipmap:f},{x:a,y:h})}}xe(y1,"ImagePosition"),xe(Px,"ImageAtlas");const Wf=1e20;function Dx(t,e,i,o,a,h,f,x,w){for(let S=e;S<e+o;S++)Rx(t,i*h+S,h,a,f,x,w);for(let S=i;S<i+a;S++)Rx(t,S*h+e,1,o,f,x,w)}function Rx(t,e,i,o,a,h,f){h[0]=0,f[0]=-Wf,f[1]=Wf,a[0]=t[e];for(let x=1,w=0,S=0;x<o;x++){a[x]=t[e+x*i];const P=x*x;do{const R=h[w];S=(a[x]-a[R]+P-R*R)/(x-R)/2}while(S<=f[w]&&--w>-1);w++,h[w]=x,f[w]=S,f[w+1]=Wf}for(let x=0,w=0;x<o;x++){for(;f[w+1]<x;)w++;const S=h[w],P=x-S;t[e+x*i]=a[S]+P*P}}const kl=2,v1={none:0,ideographs:1,all:2};class md{constructor(e,i,o){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,o){const a=[],h=this.urls[i]||Y.GLYPHS_URL;for(const f in e)for(const x of e[f])a.push({stack:f,id:x});ls(a,({stack:f,id:x},w)=>{let S=this.entries[f];S||(S=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let P=S.glyphs[x];if(P!==void 0)return void w(null,{stack:f,id:x,glyph:P});if(P=this._tinySDF(S,f,x),P)return S.glyphs[x]=P,void w(null,{stack:f,id:x,glyph:P});const R=Math.floor(x/256);if(256*R>65535)return void w(new Error("glyphs > 65535 not supported"));if(S.ranges[R])return void w(null,{stack:f,id:x,glyph:P});let B=S.requests[R];B||(B=S.requests[R]=[],md.loadGlyphRange(f,R,h,this.requestManager,(H,$)=>{if($){S.ascender=$.ascender,S.descender=$.descender;for(const te in $.glyphs)this._doesCharSupportLocalGlyph(+te)||(S.glyphs[+te]=$.glyphs[+te]);S.ranges[R]=!0}for(const te of B)te(H,$);delete S.requests[R]})),B.push((H,$)=>{H?w(H):$&&w(null,{stack:f,id:x,glyph:$.glyphs[x]||null})})},(f,x)=>{if(f)o(f);else if(x){const w={};for(const{stack:S,id:P,glyph:R}of x)w[S]===void 0&&(w[S]={}),w[S].glyphs===void 0&&(w[S].glyphs={}),w[S].glyphs[P]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics},w[S].ascender=this.entries[S].ascender,w[S].descender=this.entries[S].descender;o(null,w)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==v1.none&&(this.localGlyphMode===v1.all?!!this.localFontFamily:!!this.localFontFamily&&($e["CJK Unified Ideographs"](e)||$e["Hangul Syllables"](e)||$e.Hiragana(e)||$e.Katakana(e)||$e["CJK Symbols and Punctuation"](e)||$e["CJK Unified Ideographs Extension A"](e)||$e["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,i,o){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(o))return;let h=e.tinySDF;if(!h){let te="400";/bold/i.test(i)?te="900":/medium/i.test(i)?te="500":/light/i.test(i)&&(te="200"),h=e.tinySDF=new md.TinySDF({fontFamily:a,fontWeight:te,fontSize:24*kl,buffer:3*kl,radius:8*kl}),h.fontWeight=te}if(this.localGlyphs[h.fontWeight][o])return this.localGlyphs[h.fontWeight][o];const f=String.fromCodePoint(o),{data:x,width:w,height:S,glyphWidth:P,glyphHeight:R,glyphLeft:B,glyphTop:H,glyphAdvance:$}=h.draw(f);return this.localGlyphs[h.fontWeight][o]={id:o,bitmap:new Mu({width:w,height:S},x),metrics:{width:P/kl,height:R/kl,left:B/kl,top:H/kl-27,advance:$/kl,localGlyph:!0}}}}md.loadGlyphRange=function(t,e,i,o,a){const h=256*e,f=h+255,x=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${h}-${f}`),ea.Glyphs);c(x,(w,S)=>{if(w)a(w);else if(S){const P={},R=function(B){return new dd(B).readFields(yS,{})}(S);for(const B of R.glyphs)P[B.id]=B;a(null,{glyphs:P,ascender:R.ascender,descender:R.descender})}})},md.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:o=.25,fontFamily:a="sans-serif",fontWeight:h="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=i;const x=this.size=t+4*e,w=this._createCanvas(x),S=this.ctx=w.getContext("2d",{willReadFrequently:!0});S.font=`${f} ${h} ${t}px ${a}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:a,actualBoundingBoxRight:h}=this.ctx.measureText(t),f=Math.ceil(i),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-a))),w=Math.min(this.size-this.buffer,f+Math.ceil(o)),S=x+2*this.buffer,P=w+2*this.buffer,R=Math.max(S*P,0),B=new Uint8ClampedArray(R),H={data:B,width:S,height:P,glyphWidth:x,glyphHeight:w,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(x===0||w===0)return H;const{ctx:$,buffer:te,gridInner:ne,gridOuter:de}=this;$.clearRect(te,te,x,w),$.fillText(t,te,te+f);const Se=$.getImageData(te,te,x,w);de.fill(Wf,0,R),ne.fill(0,0,R);for(let Me=0;Me<w;Me++)for(let Le=0;Le<x;Le++){const ze=Se.data[4*(Me*x+Le)+3]/255;if(ze===0)continue;const Fe=(Me+te)*S+Le+te;if(ze===1)de[Fe]=0,ne[Fe]=Wf;else{const Xe=.5-ze;de[Fe]=Xe>0?Xe*Xe:0,ne[Fe]=Xe<0?Xe*Xe:0}}Dx(de,0,0,S,P,S,this.f,this.v,this.z),Dx(ne,te,te,x,w,S,this.f,this.v,this.z);for(let Me=0;Me<R;Me++){const Le=Math.sqrt(de[Me])-Math.sqrt(ne[Me]);B[Me]=Math.round(255-255*(Le/this.radius+this.cutoff))}return H}};const Pu=Ia;function kx(t,e,i,o){const a=[],h=t.imagePrimary,f=h.pixelRatio,x=h.paddedRect.w-2*Pu,w=h.paddedRect.h-2*Pu,S=t.right-t.left,P=t.bottom-t.top,R=h.stretchX||[[0,x]],B=h.stretchY||[[0,w]],H=(dt,St)=>dt+St[1]-St[0],$=R.reduce(H,0),te=B.reduce(H,0),ne=x-$,de=w-te;let Se=0,Me=$,Le=0,ze=te,Fe=0,Xe=ne,et=0,st=de;if(h.content&&o){const dt=h.content;Se=Wm(R,0,dt[0]),Le=Wm(B,0,dt[1]),Me=Wm(R,dt[0],dt[2]),ze=Wm(B,dt[1],dt[3]),Fe=dt[0]-Se,et=dt[1]-Le,Xe=dt[2]-dt[0]-Me,st=dt[3]-dt[1]-ze}const _t=(dt,St,Vt,bt)=>{const kt=$m(dt.stretch-Se,Me,S,t.left),yt=Zm(dt.fixed-Fe,Xe,dt.stretch,$),Bt=$m(St.stretch-Le,ze,P,t.top),jt=Zm(St.fixed-et,st,St.stretch,te),zt=$m(Vt.stretch-Se,Me,S,t.left),ri=Zm(Vt.fixed-Fe,Xe,Vt.stretch,$),Ut=$m(bt.stretch-Le,ze,P,t.top),Ht=Zm(bt.fixed-et,st,bt.stretch,te),Di=new Yt(kt,Bt),Si=new Yt(zt,Bt),Ci=new Yt(zt,Ut),qt=new Yt(kt,Ut),Ni=new Yt(yt/f,jt/f),cn=new Yt(ri/f,Ht/f),Gi=e*Math.PI/180;if(Gi){const sr=Math.sin(Gi),jn=Math.cos(Gi),Pn=[jn,-sr,sr,jn];Di._matMult(Pn),Si._matMult(Pn),qt._matMult(Pn),Ci._matMult(Pn)}const mn=dt.stretch+dt.fixed,un=Vt.stretch+Vt.fixed,xn=St.stretch+St.fixed,qi=bt.stretch+bt.fixed,ur=t.imageSecondary;return{tl:Di,tr:Si,bl:qt,br:Ci,texPrimary:{x:h.paddedRect.x+Pu+mn,y:h.paddedRect.y+Pu+xn,w:un-mn,h:qi-xn},texSecondary:ur?{x:ur.paddedRect.x+Pu+mn,y:ur.paddedRect.y+Pu+xn,w:un-mn,h:qi-xn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ni,pixelOffsetBR:cn,minFontScaleX:Xe/f/S,minFontScaleY:st/f/P,isSDF:i}};if(o&&(h.stretchX||h.stretchY)){const dt=Bx(R,ne,$),St=Bx(B,de,te);for(let Vt=0;Vt<dt.length-1;Vt++){const bt=dt[Vt],kt=dt[Vt+1];for(let yt=0;yt<St.length-1;yt++)a.push(_t(bt,St[yt],kt,St[yt+1]))}}else a.push(_t({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:w+1}));return a}function Wm(t,e,i){let o=0;for(const a of t)o+=Math.max(e,Math.min(i,a[1]))-Math.max(e,Math.min(i,a[0]));return o}function Bx(t,e,i){const o=[{fixed:-Pu,stretch:0}];for(const[a,h]of t){const f=o[o.length-1];o.push({fixed:a-f.stretch,stretch:f.stretch}),o.push({fixed:a-f.stretch,stretch:f.stretch+(h-a)})}return o.push({fixed:e+Pu,stretch:i}),o}function $m(t,e,i,o){return t/e*i+o}function Zm(t,e,i,o){return t-e*i/o}function SS(t,e,i,o){const a=e+t.positionedLines[o].lineOffset;return o===0?i+a/2:i+(a+(e+t.positionedLines[o-1].lineOffset))/2}function AS(t,e=1,i=!1){let o=1/0,a=1/0,h=-1/0,f=-1/0;const x=t[0];for(let H=0;H<x.length;H++){const $=x[H];(!H||$.x<o)&&(o=$.x),(!H||$.y<a)&&(a=$.y),(!H||$.x>h)&&(h=$.x),(!H||$.y>f)&&(f=$.y)}const w=Math.min(h-o,f-a);let S=w/2;const P=new Kd([],IS);if(w===0)return new Yt(o,a);for(let H=o;H<h;H+=w)for(let $=a;$<f;$+=w)P.push(new gd(H+S,$+S,S,t));let R=function(H){let $=0,te=0,ne=0;const de=H[0];for(let Se=0,Me=de.length,Le=Me-1;Se<Me;Le=Se++){const ze=de[Se],Fe=de[Le],Xe=ze.x*Fe.y-Fe.x*ze.y;te+=(ze.x+Fe.x)*Xe,ne+=(ze.y+Fe.y)*Xe,$+=3*Xe}return new gd(te/$,ne/$,0,H)}(t),B=P.length;for(;P.length;){const H=P.pop();(H.d>R.d||!R.d)&&(R=H,i&&console.log("found best %d after %d probes",Math.round(1e4*H.d)/1e4,B)),H.max-R.d<=e||(S=H.h/2,P.push(new gd(H.p.x-S,H.p.y-S,S,t)),P.push(new gd(H.p.x+S,H.p.y-S,S,t)),P.push(new gd(H.p.x-S,H.p.y+S,S,t)),P.push(new gd(H.p.x+S,H.p.y+S,S,t)),B+=4)}return i&&(console.log(`num probes: ${B}`),console.log(`best distance: ${R.d}`)),R.p}function IS(t,e){return e.max-t.max}class gd{constructor(e,i,o,a){this.p=new Yt(e,i),this.h=o,this.d=function(h,f){let x=!1,w=1/0;for(let S=0;S<f.length;S++){const P=f[S];for(let R=0,B=P.length,H=B-1;R<B;H=R++){const $=P[R],te=P[H];$.y>h.y!=te.y>h.y&&h.x<(te.x-$.x)*(h.y-$.y)/(te.y-$.y)+$.x&&(x=!x),w=Math.min(w,qy(h,$,te))}}return(x?1:-1)*Math.sqrt(w)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}}const x1=Number.POSITIVE_INFINITY,MS=Math.sqrt(2);function Nx(t,[e,i]){let o=0,a=0;if(i===x1){e<0&&(e=0);const h=e/MS;switch(t){case"top-right":case"top-left":a=h-7;break;case"bottom-right":case"bottom-left":a=7-h;break;case"bottom":a=7-e;break;case"top":a=e-7}switch(t){case"top-right":case"bottom-right":o=-h;break;case"top-left":case"bottom-left":o=h;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":a=i-7;break;case"bottom-right":case"bottom-left":case"bottom":a=7-i}switch(t){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,a]}function w1(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function LS(t,e,i,o,a,h,f,x,w,S,P,R,B,H,$){let te=h.textMaxSize.evaluate(e,{},R);te===void 0&&(te=f);const ne=t.layers[0].layout,de=ne.get("icon-offset").evaluate(e,{},R),Se=zx(i.horizontal)||i.vertical,Me=B.name==="globe",Le=Cs,ze=f/Le,Fe=t.tilePixelRatio*te/Le,Xe=(kt=t.overscaling,t.zoom>18&&kt>2&&(kt>>=1),Math.max(Zt/(512*kt),1)*ne.get("symbol-spacing")),et=ne.get("text-padding")*t.tilePixelRatio,st=ne.get("icon-padding")*t.tilePixelRatio,_t=nn(ne.get("text-max-angle")),dt=ne.get("text-rotation-alignment")==="map"&&ne.get("symbol-placement")!=="point",St=ne.get("icon-rotation-alignment")==="map"&&ne.get("symbol-placement")!=="point",Vt=ne.get("symbol-placement"),bt=Xe/2;var kt;const yt=ne.get("icon-text-fit").evaluate(e,{},R),Bt=ne.get("icon-text-fit-padding").evaluate(e,{},R),jt=yt!=="none";let zt;t.hasAnyIconTextFit===!1&&jt&&(t.hasAnyIconTextFit=!0),o&&jt&&(t.allowVerticalPlacement&&i.vertical&&(zt=Ex(o,i.vertical,yt,Bt,de,ze)),Se&&(o=Ex(o,Se,yt,Bt,de,ze)));const ri=(Ut,Ht,Di)=>{if(Ht.x<0||Ht.x>=Zt||Ht.y<0||Ht.y>=Zt)return;let Si=null;if(Me){const{x:Ci,y:qt,z:Ni}=B.projectTilePoint(Ht.x,Ht.y,Di);Si={anchor:new Zc(Ci,qt,Ni,0,void 0),up:B.upVector(Di,Ht.x,Ht.y)}}(function(Ci,qt,Ni,cn,Gi,mn,un,xn,qi,ur,sr,jn,Pn,qn,Er,_r,Kr,Hr,Os,co,zr,Mo,ds,fs,wr,Ys,Xc){const pl=Ci.addToLineVertexArray(qt,cn);let Vl,zu,Vu,Th,Vw,Uw,jw,qw=0,Hw=0,Gw=0,Ww=0,X1=-1,Y1=-1;const yc={};let $w=Tl("");const Sh=Ni?Ni.anchor:qt,K1=qi.layout.get("icon-text-fit").evaluate(zr,{},wr)!=="none";let Q1=0,J1=0;if(qi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Q1,J1]=qi.layout.get("text-offset").evaluate(zr,{},wr).map(La=>La*Cs):(Q1=qi.layout.get("text-radial-offset").evaluate(zr,{},wr)*Cs,J1=x1),Ci.allowVerticalPlacement&&Gi.vertical){const La=Gi.vertical;if(Er)Uw=b1(La),xn&&(jw=b1(xn));else{const Oa=qi.layout.get("text-rotate").evaluate(zr,{},wr)+90;Vu=Xm(ur,Sh,qt,sr,jn,Pn,La,qn,Oa,_r),xn&&(Th=Xm(ur,Sh,qt,sr,jn,Pn,xn,Hr,Oa))}}if(mn){const La=qi.layout.get("icon-rotate").evaluate(zr,{},wr),Oa=kx(mn,La,ds,K1),Sd=xn?kx(xn,La,ds,K1):void 0;zu=Xm(ur,Sh,qt,sr,jn,Pn,mn,Hr,La),qw=4*Oa.length;const Zw=Ci.iconSizeData;let Ah=null;Zw.kind==="source"?(Ah=[Rl*qi.layout.get("icon-size").evaluate(zr,{},wr)],Ah[0]>Du&&Dr(`${Ci.layerIds[0]}: Value for "icon-size" is >= ${$f}. Reduce your "icon-size".`)):Zw.kind==="composite"&&(Ah=[Rl*Mo.compositeIconSizes[0].evaluate(zr,{},wr),Rl*Mo.compositeIconSizes[1].evaluate(zr,{},wr)],(Ah[0]>Du||Ah[1]>Du)&&Dr(`${Ci.layerIds[0]}: Value for "icon-size" is >= ${$f}. Reduce your "icon-size".`)),Ci.addSymbols(Ci.icon,Oa,Ah,co,Os,zr,!1,Ni,qt,pl.lineStartIndex,pl.lineLength,-1,fs,wr,Ys,Xc),X1=Ci.icon.placedSymbolArray.length-1,Sd&&(Hw=4*Sd.length,Ci.addSymbols(Ci.icon,Sd,Ah,co,Os,zr,Xa.vertical,Ni,qt,pl.lineStartIndex,pl.lineLength,-1,fs,wr,Ys,Xc),Y1=Ci.icon.placedSymbolArray.length-1)}for(const La in Gi.horizontal){const Oa=Gi.horizontal[La];Vl||($w=Tl(Oa.text),Er?Vw=b1(Oa):Vl=Xm(ur,Sh,qt,sr,jn,Pn,Oa,qn,qi.layout.get("text-rotate").evaluate(zr,{},wr),_r));const Sd=Oa.positionedLines.length===1;if(Gw+=Fx(Ci,Ni,qt,Oa,un,qi,Er,zr,_r,pl,Gi.vertical?Xa.horizontal:Xa.horizontalOnly,Sd?Object.keys(Gi.horizontal):[La],yc,X1,Mo,fs,wr,Ys),Sd)break}Gi.vertical&&(Ww+=Fx(Ci,Ni,qt,Gi.vertical,un,qi,Er,zr,_r,pl,Xa.vertical,["vertical"],yc,Y1,Mo,fs,wr,Ys));let Uu=-1;const e_=(La,Oa)=>La?Math.max(La,Oa):Oa;Uu=e_(Vw,Uu),Uu=e_(Uw,Uu),Uu=e_(jw,Uu);const iI=Uu>-1?1:0;Ci.glyphOffsetArray.length>=65535&&Dr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),zr.sortKey!==void 0&&Ci.addToSortKeyRanges(Ci.symbolInstances.length,zr.sortKey),Ci.symbolInstances.emplaceBack(qt.x,qt.y,Sh.x,Sh.y,Sh.z,yc.right>=0?yc.right:-1,yc.center>=0?yc.center:-1,yc.left>=0?yc.left:-1,yc.vertical>=0?yc.vertical:-1,X1,Y1,$w,Vl!==void 0?Vl:Ci.collisionBoxArray.length,Vl!==void 0?Vl+1:Ci.collisionBoxArray.length,Vu!==void 0?Vu:Ci.collisionBoxArray.length,Vu!==void 0?Vu+1:Ci.collisionBoxArray.length,zu!==void 0?zu:Ci.collisionBoxArray.length,zu!==void 0?zu+1:Ci.collisionBoxArray.length,Th||Ci.collisionBoxArray.length,Th?Th+1:Ci.collisionBoxArray.length,sr,Gw,Ww,qw,Hw,iI,0,Q1,J1,Uu,0,1,1,K1?1:0)})(t,Ht,Si,Ut,i,o,a,zt,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,et,dt,w,0,st,St,de,e,h,S,P,R,H,$)};if(Vt==="line")for(const Ut of Lx(e.geometry,0,0,Zt,Zt)){const Ht=TS(Ut,Xe,_t,i.vertical||Se,o,Le,Fe,t.overscaling,Zt);for(const Di of Ht)Se&&OS(t,Se.text,bt,Di)||ri(Ut,Di,R)}else if(Vt==="line-center"){for(const Ut of e.geometry)if(Ut.length>1){const Ht=ES(Ut,_t,i.vertical||Se,o,Le,Fe);Ht&&ri(Ut,Ht,R)}}else if(e.type==="Polygon")for(const Ut of Om(e.geometry,0)){const Ht=AS(Ut,16);ri(Ut[0],new Zc(Ht.x,Ht.y,0,0,void 0),R)}else if(e.type==="LineString")for(const Ut of e.geometry)ri(Ut,new Zc(Ut[0].x,Ut[0].y,0,0,void 0),R);else if(e.type==="Point")for(const Ut of e.geometry)for(const Ht of Ut)ri([Ht],new Zc(Ht.x,Ht.y,0,0,void 0),R)}const $f=255,Du=$f*Rl;function Fx(t,e,i,o,a,h,f,x,w,S,P,R,B,H,$,te,ne,de){const Se=function(ze,Fe,Xe,et,st,_t,dt,St){const Vt=[];if(Fe.positionedLines.length===0)return Vt;const bt=et.layout.get("text-rotate").evaluate(_t,{})*Math.PI/180,kt=function(ri){const Ut=ri[0],Ht=ri[1],Di=Ut*Ht;return Di>0?[Ut,-Ht]:Di<0?[-Ut,Ht]:Ut===0?[Ht,Ut]:[Ht,-Ut]}(Xe);let yt=Math.abs(Fe.top-Fe.bottom);for(const ri of Fe.positionedLines)yt-=ri.lineOffset;const Bt=Fe.positionedLines.length,jt=yt/Bt;let zt=Fe.top-Xe[1];for(let ri=0;ri<Bt;++ri){const Ut=Fe.positionedLines[ri];zt=SS(Fe,jt,zt,ri);for(const Ht of Ut.positionedGlyphs){if(!Ht.rect)continue;const Di=Ht.rect||{};let Si=yx+1,Ci=!0,qt=1,Ni=0;if(Ht.imageName){const co=dt[Ht.imageName];if(!co)continue;if(co.sdf){Dr("SDF images are not supported in formatted text and will be ignored.");continue}Ci=!1,qt=co.pixelRatio,Si=Ia/qt}const cn=(st||St)&&Ht.vertical,Gi=Ht.metrics.advance*Ht.scale/2,mn=Ht.metrics,un=Ht.rect;if(un===null)continue;St&&Fe.verticalizable&&(Ni=Ht.imageName?Gi-Ht.metrics.width*Ht.scale/2:0);const xn=st?[Ht.x+Gi,Ht.y]:[0,0];let qi=[0,0],ur=[0,0],sr=!1;st||(cn?(ur=[Ht.x+Gi+kt[0],Ht.y+kt[1]-Ni],sr=!0):qi=[Ht.x+Gi+Xe[0],Ht.y+Xe[1]-Ni]);const jn=un.w*Ht.scale/(qt*(Ht.localGlyph?kl:1)),Pn=un.h*Ht.scale/(qt*(Ht.localGlyph?kl:1));let qn,Er,_r,Kr;if(cn){const co=Ht.y-zt,zr=new Yt(-Gi,Gi-co),Mo=-Math.PI/2,ds=new Yt(...ur);qn=new Yt(-Gi+qi[0],qi[1]),qn._rotateAround(Mo,zr)._add(ds),qn.x+=-co+Gi,qn.y-=(mn.left-Si)*Ht.scale;const fs=Ht.imageName?mn.advance*Ht.scale:Cs*Ht.scale,wr=String.fromCodePoint(Ht.glyph);gS(wr)?qn.x+=(1-Si)*Ht.scale:_S(wr)?qn.x+=fs-mn.height*Ht.scale+(-Si-1)*Ht.scale:qn.x+=Ht.imageName||mn.width+2*Si===un.w&&mn.height+2*Si===un.h?(fs-Pn)/2:(fs-(mn.height+2*Si)*Ht.scale)/2,Er=new Yt(qn.x,qn.y-jn),_r=new Yt(qn.x+Pn,qn.y),Kr=new Yt(qn.x+Pn,qn.y-jn)}else{const co=(mn.left-Si)*Ht.scale-Gi+qi[0],zr=(-mn.top-Si)*Ht.scale+qi[1],Mo=co+jn,ds=zr+Pn;qn=new Yt(co,zr),Er=new Yt(Mo,zr),_r=new Yt(co,ds),Kr=new Yt(Mo,ds)}if(bt){let co;co=st?new Yt(0,0):sr?new Yt(kt[0],kt[1]):new Yt(Xe[0],Xe[1]),qn._rotateAround(bt,co),Er._rotateAround(bt,co),_r._rotateAround(bt,co),Kr._rotateAround(bt,co)}const Hr=new Yt(0,0),Os=new Yt(0,0);Vt.push({tl:qn,tr:Er,bl:_r,br:Kr,texPrimary:Di,texSecondary:void 0,writingMode:Fe.writingMode,glyphOffset:xn,sectionIndex:Ht.sectionIndex,isSDF:Ci,pixelOffsetTL:Hr,pixelOffsetBR:Os,minFontScaleX:0,minFontScaleY:0})}}return Vt}(0,o,w,h,f,x,a,t.allowVerticalPlacement),Me=t.textSizeData;let Le=null;Me.kind==="source"?(Le=[Rl*h.layout.get("text-size").evaluate(x,{},ne)],Le[0]>Du&&Dr(`${t.layerIds[0]}: Value for "text-size" is >= ${$f}. Reduce your "text-size".`)):Me.kind==="composite"&&(Le=[Rl*$.compositeTextSizes[0].evaluate(x,{},ne),Rl*$.compositeTextSizes[1].evaluate(x,{},ne)],(Le[0]>Du||Le[1]>Du)&&Dr(`${t.layerIds[0]}: Value for "text-size" is >= ${$f}. Reduce your "text-size".`)),t.addSymbols(t.text,Se,Le,w,f,x,P,e,i,S.lineStartIndex,S.lineLength,H,te,ne,de,!1);for(const ze of R)B[ze]=t.text.placedSymbolArray.length-1;return 4*Se.length}function zx(t){for(const e in t)return t[e];return null}function Xm(t,e,i,o,a,h,f,x,w,S){let P=f.top,R=f.bottom,B=f.left,H=f.right;const $=f.collisionPadding;if($&&(B-=$[0],P-=$[1],H+=$[2],R+=$[3]),w){const te=new Yt(B,P),ne=new Yt(H,P),de=new Yt(B,R),Se=new Yt(H,R),Me=nn(w);let Le=new Yt(0,0);S&&(Le=new Yt(S[0],S[1])),te._rotateAround(Me,Le),ne._rotateAround(Me,Le),de._rotateAround(Me,Le),Se._rotateAround(Me,Le),B=Math.min(te.x,ne.x,de.x,Se.x),H=Math.max(te.x,ne.x,de.x,Se.x),P=Math.min(te.y,ne.y,de.y,Se.y),R=Math.max(te.y,ne.y,de.y,Se.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,B,P,H,R,x,o,a,h),t.length-1}function b1(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function OS(t,e,i,o){const a=t.compareText;if(e in a){const h=a[e];for(let f=h.length-1;f>=0;f--)if(o.dist(h[f])<i)return!0}else a[e]=[];return a[e].push(o),!1}function Vx(t,e){const i=t.fovAboveCenter,o=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,a=(t._camera.position[2]*t.worldSize-o)/Math.cos(t._pitch),h=Math.sin(i)*a/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),f=Math.sin(t._pitch)*h+a;return Math.min(1.01*f,a*(1/t._horizonShift))}function vh(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),o=t.x*i,a=(t.x+1)*i,h=t.y*i,f=(t.y+1)*i,x=ca(o),w=ca(a),S=hs(h),P=hs(f),R=e.project(x,S),B=e.project(w,S),H=e.project(w,P),$=e.project(x,P);let te=Math.min(R.x,B.x,H.x,$.x),ne=Math.min(R.y,B.y,H.y,$.y),de=Math.max(R.x,B.x,H.x,$.x),Se=Math.max(R.y,B.y,H.y,$.y);const Me=i/16;function Le(Fe,Xe,et,st,_t,dt){const St=(et+_t)/2,Vt=(st+dt)/2,bt=e.project(ca(St),hs(Vt)),kt=Math.max(0,te-bt.x,ne-bt.y,bt.x-de,bt.y-Se);te=Math.min(te,bt.x),de=Math.max(de,bt.x),ne=Math.min(ne,bt.y),Se=Math.max(Se,bt.y),kt>Me&&(Le(Fe,bt,et,st,St,Vt),Le(bt,Xe,St,Vt,_t,dt))}Le(R,B,o,h,a,h),Le(B,H,a,h,a,f),Le(H,$,a,f,o,f),Le($,R,o,f,o,h),te-=Me,ne-=Me,de+=Me,Se+=Me;const ze=1/Math.max(de-te,Se-ne);return{scale:ze,x:te*ze,y:ne*ze,x2:de*ze,y2:Se*ze,projection:e}}function Ux(t,{x:e,y:i},o=0){return new Yt(((e-o)*t.scale-t.x)*Zt,(i*t.scale-t.y)*Zt)}const PS=r.ad.identity(new Float32Array(16));class Ru{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new Vn(0,0)}projectTilePoint(e,i,o){return{x:e,y:i,z:0}}locationPoint(e,i,o=!0){return e._coordinatePoint(e.locationCoordinate(i),o)}pixelsPerMeter(e,i){return Xs(1,e)*i}pixelSpaceConversion(e,i,o){return 1}farthestPixelDistance(e){return Vx(e,e.pixelsPerMeter)}pointCoordinate(e,i,o,a){const h=e.horizonLineFromTop(!1),f=new Yt(i,Math.max(h,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,a))}pointCoordinate3D(e,i,o){const a=new Yt(i,o);if(e.elevation)return e.elevation.pointCoordinate(a);{const h=this.pointCoordinate(e,a.x,a.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const o=e.horizonLineFromTop();return i.y<o}createInversionMatrix(e,i){return PS}createTileMatrix(e,i,o){let a,h,f;const x=o.canonical,w=r.ad.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=vh(x,this);a=1,h=S.x+o.wrap*S.scale,f=S.y,r.ad.scale(w,w,[a/S.scale,a/S.scale,e.pixelsPerMeter/i])}else a=i/e.zoomScale(x.z),h=(x.x+Math.pow(2,x.z)*o.wrap)*a,f=x.y*a;return r.ad.translate(w,w,[h,f,0]),r.ad.scale(w,w,[a/Zt,a/Zt,1]),w}upVector(e,i,o){return[0,0,1]}upVectorScale(e,i,o){return{metersToTile:1}}}class DS extends Ru{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,o]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(nn(i));this.n=(a+Math.sin(nn(o)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:o,c:a,r0:h}=this,f=nn(e-this.center[0]),x=nn(i),w=Math.sqrt(a-2*o*Math.sin(x))/o;return{x:w*Math.sin(f*o),y:w*Math.cos(f*o)-h,z:0}}unproject(e,i){const{n:o,c:a,r0:h}=this,f=h+i;let x=Math.atan2(e,Math.abs(f))*Math.sign(f);f*o<0&&(x-=Math.PI*Math.sign(e)*Math.sign(f));const w=nn(this.center[0])*o;x=Na(x,-Math.PI-w,Math.PI-w);const S=Ki(ho(x/o)+this.center[0],-180,180),P=Math.asin(Ki((a-(e*e+f*f)*o*o)/(2*o),-1,1)),R=Ki(ho(P),-mo,mo);return new Vn(S,R)}}const Zf=1.340264,Xf=-.081106,Yf=893e-6,Kf=.003796,Ym=Math.sqrt(3)/2;class RS extends Ru{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(Ym*Math.sin(i)),a=o*o,h=a*a*a;return{x:.5*(e*Math.cos(o)/(Ym*(Zf+3*Xf*a+h*(7*Yf+9*Kf*a)))/Math.PI+.5),y:1-.5*(o*(Zf+Xf*a+h*(Yf+Kf*a))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,a=o*o,h=a*a*a;for(let P,R,B,H=0;H<12&&(R=o*(Zf+Xf*a+h*(Yf+Kf*a))-i,B=Zf+3*Xf*a+h*(7*Yf+9*Kf*a),P=R/B,o=Ki(o-P,-Math.PI/3,Math.PI/3),a=o*o,h=a*a*a,!(Math.abs(P)<1e-12));++H);const f=Ym*e*(Zf+3*Xf*a+h*(7*Yf+9*Kf*a))/Math.cos(o),x=Math.asin(Math.sin(o)/Ym),w=Ki(180*f/Math.PI,-180,180),S=Ki(180*x/Math.PI,-mo,mo);return new Vn(w,S)}}class kS extends Ru{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const o=360*(e-.5),a=Ki(360*(.5-i),-mo,mo);return new Vn(o,a)}}const _d=Math.PI/2;function Km(t){return Math.tan((_d+t)/2)}class BS extends Ru{constructor(e){super(e),this.center=e.center||[0,30];const[i,o]=this.parallels=e.parallels||[30,30];let a=nn(i),h=nn(o);this.southernCenter=a+h<0,this.southernCenter&&(a=-a,h=-h);const f=Math.cos(a),x=Km(a);this.n=a===h?Math.sin(a):Math.log(f/Math.cos(h))/Math.log(Km(h)/x),this.f=f*Math.pow(Km(a),this.n)/this.n}project(e,i){i=nn(i),this.southernCenter&&(i=-i),e=nn(e-this.center[0]);const o=1e-6,{n:a,f:h}=this;h>0?i<-_d+o&&(i=-_d+o):i>_d-o&&(i=_d-o);const f=h/Math.pow(Km(i),a);let x=f*Math.sin(a*e),w=h-f*Math.cos(a*e);return x=.5*(x/Math.PI+.5),w=.5*(w/Math.PI+.5),{x,y:this.southernCenter?w:1-w,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:o,f:a}=this,h=a-i,f=Math.sign(h),x=Math.sign(o)*Math.sqrt(e*e+h*h);let w=Math.atan2(e,Math.abs(h))*f;h*o<0&&(w-=Math.PI*Math.sign(e)*f);const S=Ki(ho(w/o)+this.center[0],-180,180),P=Ki(ho(2*Math.atan(Math.pow(a/x,1/o))-_d),-mo,mo);return new Vn(S,this.southernCenter?-P:P)}}class jx extends Ru{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:dc(e),y:fc(i),z:0}}unproject(e,i){const o=ca(e),a=hs(i);return new Vn(o,a)}}const qx=nn(mo);class NS extends Ru{project(e,i){const o=(i=nn(i))*i,a=o*o;return{x:.5*((e=nn(e))*(.8707-.131979*o+a*(a*(.003971*o-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+o*(.015085+a*(.028874*o-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,a=25,h=0,f=o*o;do{f=o*o;const S=f*f;h=(o*(1.007226+f*(.015085+S*(.028874*f-.044475-.005916*S)))-i)/(1.007226+f*(.045255+S*(.259866*f-.311325-.005916*11*S))),o=Ki(o-h,-qx,qx)}while(Math.abs(h)>1e-6&&--a>0);f=o*o;const x=Ki(ho(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),w=ho(o);return new Vn(x,w)}}const Hx=nn(mo);class FS extends Ru{project(e,i){i=nn(i),e=nn(e);const o=Math.cos(i),a=2/Math.PI,h=Math.acos(o*Math.cos(e/2)),f=Math.sin(h)/h,x=.5*(e*a+2*o*Math.sin(e/2)/f)||0,w=.5*(i+Math.sin(i)/f)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(e,i){let o=e=(2*e-.5)*Math.PI,a=i=(2*(1-i)-1)*Math.PI,h=25;const f=1e-6;let x=0,w=0;do{const S=Math.cos(a),P=Math.sin(a),R=2*P*S,B=P*P,H=S*S,$=Math.cos(o/2),te=Math.sin(o/2),ne=2*$*te,de=te*te,Se=1-H*$*$,Me=Se?1/Se:0,Le=Se?Math.acos(S*$)*Math.sqrt(1/Se):0,ze=.5*(2*Le*S*te+2*o/Math.PI)-e,Fe=.5*(Le*P+a)-i,Xe=.5*Me*(H*de+Le*S*$*B)+1/Math.PI,et=Me*(ne*R/4-Le*P*te),st=.125*Me*(R*te-Le*P*H*ne),_t=.5*Me*(B*$+Le*de*S)+.5,dt=et*st-_t*Xe;x=(Fe*et-ze*_t)/dt,w=(ze*st-Fe*Xe)/dt,o=Ki(o-x,-Math.PI,Math.PI),a=Ki(a-w,-Hx,Hx)}while((Math.abs(x)>f||Math.abs(w)>f)&&--h>0);return new Vn(ho(o),ho(a))}}class Gx extends Ru{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(nn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:o,cosPhi:a}=this;return{x:nn(e)*a*o+.5,y:-Math.sin(nn(i))/a*o+.5,z:0}}unproject(e,i){const{scale:o,cosPhi:a}=this,h=-(i-.5)/o,f=Ki(ho((e-.5)/o)/a,-180,180),x=Math.asin(Ki(h*a,-1,1)),w=Ki(ho(x),-mo,mo);return new Vn(f,w)}}class zS extends jx{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,o){const a=Rf(e,i,o),h=kf(pc(o));return r._.transformMat4(a,a,h),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,i){const o=ph(i.lat,i.lng),a=r._.normalize([],o),h=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,f=Xs(1,0)*Zt*h;r._.scaleAndAdd(o,o,a,f);const x=r.ad.identity(new Float64Array(16));return r.ad.multiply(x,e.pixelMatrix,e.globeMatrix),r._.transformMat4(o,o,x),new Yt(o[0],o[1])}pixelsPerMeter(e,i){return Xs(1,0)*i}pixelSpaceConversion(e,i,o){const a=Xs(1,e)*i,h=Fi(Xs(1,45)*i,a,o);return this.pixelsPerMeter(e,i)/h}createTileMatrix(e,i,o){const a=J0(pc(o.canonical));return r.ad.multiply(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,i){const{center:o}=e,a=kf(pc(i));return r.ad.rotateY(a,a,nn(o.lng)),r.ad.rotateX(a,a,nn(o.lat)),r.ad.scale(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,i,o,a){return Qy(e,i,o,!0)||new Ls(0,0)}pointCoordinate3D(e,i,o){const a=this.pointCoordinate(e,i,o,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,i){return!Qy(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(a,h){const f=a.cameraToCenterDistance,x=a._centerAltitude*h,w=a._camera,S=a._camera.forward(),P=r._.add([],r._.scale([],S,-f),[0,0,x]),R=a.worldSize/(2*Math.PI),B=[0,0,-R],H=a.width/a.height,$=Math.tan(a.fovAboveCenter),te=r._.scale([],w.up(),$),ne=r._.scale([],w.right(),$*H),de=r._.normalize([],r._.add([],r._.add([],S,te),ne)),Se=[];let Me;if(new Z0(P,de).closestPointOnSphere(B,R,Se)){const Le=r._.add([],Se,B),ze=r._.sub([],Le,P);Me=Math.cos(a.fovAboveCenter)*r._.length(ze)}else{const Le=r._.sub([],P,B),ze=r._.sub([],B,P);r._.normalize(ze,ze);const Fe=r._.length(Le)-R;Me=Math.sqrt(Fe*(Fe+2*R));const Xe=Math.acos(Me/(R+Fe))-Math.acos(r._.dot(S,ze));Me*=Math.cos(Xe)}return 1.01*Me}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=Wc(e.zoom);if(o>0){const a=Vx(e,Xs(1,e.center.lat)*e.worldSize),h=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Fi(i,a+h*(1-Math.cos(f)),Math.pow(o,10))}return i}upVector(e,i,o){return Rf(i,o,e,1)}upVectorScale(e){return{metersToTile:Tm(Am(pc(e)))}}}function Wx(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new jx(t);case"equirectangular":return new kS(t);case"naturalEarth":return new NS(t);case"equalEarth":return new RS(t);case"winkelTripel":return new FS(t);case"albers":return i?new Gx(t):new DS(t);case"lambertConformalConic":return i?new Gx(t):new BS(t);case"globe":return new zS(t)}throw new Error(`Invalid projection name: ${t.name}`)}class xh{constructor(e,i,o,a){this.id=xh.uniqueIdxCounter,xh.uniqueIdxCounter++,this.context=e;const h=e.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!o,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||a||i.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=xh.uniqueIdxCounter,xh.uniqueIdxCounter++;const i=this.context.gl;this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}xh.uniqueIdxCounter=0;class yd{constructor(e,i,o){this.func=e,this.mask=i,this.range=o}}yd.ReadOnly=!1,yd.ReadWrite=!0,yd.disabled=new yd(519,yd.ReadOnly,[0,1]);const C1=7680;class E1{constructor(e,i,o,a,h,f){this.test=e,this.ref=i,this.mask=o,this.fail=a,this.depthFail=h,this.pass=f}}E1.disabled=new E1({func:519,mask:0},0,0,C1,C1,C1);const Qf=771;class Ma{constructor(e,i,o,a){this.blendFunction=e,this.blendColor=i,this.mask=o,this.blendEquation=a}}Ma.Replace=[1,0,1,0],Ma.disabled=new Ma(Ma.Replace,kn.transparent,[!1,!1,!1,!1]),Ma.unblended=new Ma(Ma.Replace,kn.transparent,[!0,!0,!0,!0]),Ma.alphaBlended=new Ma([1,Qf,1,Qf],kn.transparent,[!0,!0,!0,!0]),Ma.alphaBlendedNonPremultiplied=new Ma([770,Qf,770,Qf],kn.transparent,[!0,!0,!0,!0]),Ma.multiply=new Ma([774,0,774,0],kn.transparent,[!0,!0,!0,!0]);const T1=1029,S1=2305;class Bl{constructor(e,i,o){this.enable=e,this.mode=i,this.frontFace=o}}Bl.disabled=new Bl(!1,T1,S1),Bl.backCCW=new Bl(!0,T1,S1),Bl.backCW=new Bl(!0,T1,2304),Bl.frontCW=new Bl(!0,1028,2304),Bl.frontCCW=new Bl(!0,1028,S1);const VS=Rm.types,US=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Qm(t,e,i,o,a,h,f,x,w,S,P,R,B){const H=x?Math.min(Du,Math.round(x[0])):0,$=x?Math.min(Du,Math.round(x[1])):0;t.emplaceBack(e,i,Math.round(32*o),Math.round(32*a),h,f,(H<<1)+(w?1:0),$,16*S,16*P,256*R,256*B)}function Jm(t,e,i){t.emplaceBack(e,i)}function eg(t,e,i,o,a,h,f){t.emplaceBack(e,i,o,a,h,f)}function tg(t,e,i,o,a){t.emplaceBack(e,i,o,a),t.emplaceBack(e,i,o,a),t.emplaceBack(e,i,o,a),t.emplaceBack(e,i,o,a)}function jS(t){for(const e of t.sections)if(Kt(e.text))return!0;return!1}class A1{constructor(e){this.layoutVertexArray=new _0,this.indexArray=new ss,this.programConfigurations=e,this.segments=new qr,this.dynamicLayoutVertexArray=new wu,this.opacityVertexArray=new v0,this.occlusionQueryOpacityVertexArray=new hh,this.placedSymbolArray=new by,this.iconTransitioningVertexArray=new Eu,this.globeExtVertexArray=new y0,this.zOffsetVertexArray=new hh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,o,a,h){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,HT.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,WT.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,US,!0),this.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(this.occlusionQueryOpacityVertexArray,d1.members,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,$T.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,GT.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||h)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,ex.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.occlusionQueryOpacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}xe(A1,"SymbolBuffers");class I1{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new qr,this.collisionVertexArray=new b0,this.collisionVertexArrayExt=new wu}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,ZT.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,XT.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}xe(I1,"CollisionBuffers");class vd{constructor(e){this.queries=new Map,this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=r.ad.identity([]),this.placementViewportMatrix=r.ad.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=p1(this.zoom,i["text-size"]),this.iconSizeData=p1(this.zoom,i["icon-size"]);const o=this.layers[0].layout,a=o.get("symbol-sort-key"),h=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(f=>Xa[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=o.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new A1(new Su(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^text/.test(e))),this.icon=new A1(new Su(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^icon/.test(e))),this.glyphOffsetArray=new Ty,this.lineVertexArray=new Sy,this.symbolInstances=new Ey}calculateGlyphDependencies(e,i,o,a,h){for(let f=0;f<e.length;f++){const x=e.codePointAt(f);if(x===void 0)break;if(i[x]=!0,a&&h&&x<=65535){const w=Hf[e.charAt(f)];w&&(i[w.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!u1(this.activeReplacements,o)&&(this.activeReplacements=o,!0)}populate(e,i,o,a){const h=this.layers[0],f=h.layout,x=this.projection.name==="globe",w=f.get("text-font"),S=f.get("text-field"),P=f.get("icon-image"),R=(S.value.kind!=="constant"||S.value.value instanceof vo&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),B=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,H=f.get("symbol-sort-key");if(this.features=[],!R&&!B)return;const $=i.iconDependencies,te=i.glyphDependencies,ne=i.availableImages,de=new $i(this.zoom);for(const{feature:Se,id:Me,index:Le,sourceLayerIndex:ze}of e){const Fe=h._featureFilter.needGeometry,Xe=Hc(Se,Fe);if(!h._featureFilter.filter(de,Xe,o))continue;if(Fe||(Xe.geometry=Dl(Se,o,a)),x&&Se.type!==1&&o.z<=5){const dt=Xe.geometry,St=.98078528056,Vt=(bt,kt)=>{const yt=Rf(bt.x,bt.y,o,1),Bt=Rf(kt.x,kt.y,o,1);return r._.dot(yt,Bt)<St};for(let bt=0;bt<dt.length;bt++)dt[bt]=AE(dt[bt],Vt)}let et,st;if(R){const dt=h.getValueAndResolveTokens("text-field",Xe,o,ne),St=vo.factory(dt);jS(St)&&(this.hasRTLText=!0),(!this.hasRTLText||Cn()==="unavailable"||this.hasRTLText&&vn.isParsed())&&(et=mS(St,h,Xe))}if(B){const dt=h.getValueAndResolveTokens("icon-image",Xe,o,ne);st=dt instanceof pr?dt:pr.fromString(dt)}if(!et&&!st)continue;const _t=this.sortFeaturesByKey?H.evaluate(Xe,{},o):void 0;if(this.features.push({id:Me,text:et,icon:st,index:Le,sourceLayerIndex:ze,geometry:Xe.geometry,properties:Se.properties,type:VS[Se.type],sortKey:_t}),st&&($[st.namePrimary]=!0,st.nameSecondary&&($[st.nameSecondary]=!0)),et){const dt=w.evaluate(Xe,{},o).join(","),St=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Xa.vertical)>=0;for(const Vt of et.sections)if(Vt.image)$[Vt.image.namePrimary]=!0;else{const bt=ft(et.toString()),kt=Vt.fontStack||dt,yt=te[kt]=te[kt]||{};this.calculateGlyphDependencies(Vt.text,yt,St,this.allowVerticalPlacement,bt)}}}f.get("symbol-placement")==="line"&&(this.features=function(Se){const Me={},Le={},ze=[];let Fe=0;function Xe(dt){ze.push(Se[dt]),Fe++}function et(dt,St,Vt){const bt=Le[dt];return delete Le[dt],Le[St]=bt,ze[bt].geometry[0].pop(),ze[bt].geometry[0]=ze[bt].geometry[0].concat(Vt[0]),bt}function st(dt,St,Vt){const bt=Me[St];return delete Me[St],Me[dt]=bt,ze[bt].geometry[0].shift(),ze[bt].geometry[0]=Vt[0].concat(ze[bt].geometry[0]),bt}function _t(dt,St,Vt){const bt=Vt?St[0][St[0].length-1]:St[0][0];return`${dt}:${bt.x}:${bt.y}`}for(let dt=0;dt<Se.length;dt++){const St=Se[dt],Vt=St.geometry,bt=St.text?St.text.toString():null;if(!bt){Xe(dt);continue}const kt=_t(bt,Vt),yt=_t(bt,Vt,!0);if(kt in Le&&yt in Me&&Le[kt]!==Me[yt]){const Bt=st(kt,yt,Vt),jt=et(kt,yt,ze[Bt].geometry);delete Me[kt],delete Le[yt],Le[_t(bt,ze[jt].geometry,!0)]=jt,ze[Bt].geometry=null}else kt in Le?et(kt,yt,Vt):yt in Me?st(kt,yt,Vt):(Xe(dt),Me[kt]=Fe-1,Le[yt]=Fe-1)}return ze.filter(dt=>dt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Se,Me)=>Se.sortKey-Me.sortKey)}update(e,i,o,a,h){const f=Object.keys(e).length!==0;if(f&&!this.stateDependentLayers.length)return;const x=f?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,i,x,o,a,h),this.icon.programConfigurations.updatePaintArrays(e,i,x,o,a,h)}updateOcclusionOpacities(e,i,o){if(!i.useOcclusionQueries)return!1;const a=this;if(a.projection.name==="globe")return!1;let h=!1;a.hasTextData()&&(h=h||a.text.occlusionQueryOpacityVertexArray.length!==0),a.hasIconData()&&(h=h||a.icon.occlusionQueryOpacityVertexArray.length!==0);const f=a.layers[0].paint,x=f.get("icon-occlusion-opacity").constantOr(0),w=f.get("text-occlusion-opacity").constantOr(0);if(!a.layers[0].hasInitialOcclusionOpacityProperties||x===1&&w===1)return!1;let S=!h;for(let H=0;H<a.symbolInstances.length;H++){const $=a.symbolInstances.get(H),te=$.occlusionOpacity;$.occlusionOpacity+=($.occlusionState>.5?1:-1)*i.fadeSpeed*o*.001,$.occlusionOpacity=Ki($.occlusionOpacity,0,1),S=S||$.occlusionOpacity!==te}if(!S)return!1;let P=0,R=0;const B=(H,$,te,ne)=>{let de=0,Se=0;te?(de=R,R+=ne,Se=R):(de=P,P+=ne,Se=P),Se>$.occlusionQueryOpacityVertexArray.length&&$.occlusionQueryOpacityVertexArray.resize(Se);const Me=H.occlusionOpacity;for(let Le=0;Le<ne;Le++)$.occlusionQueryOpacityVertexArray.emplace(Le+de,Me)};for(let H=0;H<a.symbolInstances.length;H++){const $=a.symbolInstances.get(H),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:ne,numIconVertices:de}=$,Se=de>0;if((te>0||ne>0)&&(B($,a.text,!1,te),B($,a.text,!1,ne)),Se){const{placedIconSymbolIndex:Me,verticalPlacedIconSymbolIndex:Le}=$;Me>=0&&B($,a.icon,!0,de),Le>=0&&B($,a.icon,!0,$.numVerticalIconVertices)}}return a.hasTextData()&&a.text.occlusionQueryOpacityVertexBuffer&&(a.text.occlusionQueryOpacityVertexBuffer.length<a.text.occlusionQueryOpacityVertexArray.length?a.text.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(a.text.occlusionQueryOpacityVertexArray,d1.members,!0):a.text.occlusionQueryOpacityVertexBuffer.updateData(a.text.occlusionQueryOpacityVertexArray)),a.hasIconData()&&a.icon.occlusionQueryOpacityVertexBuffer&&(a.icon.occlusionQueryOpacityVertexBuffer.length<a.icon.occlusionQueryOpacityVertexArray.length?a.icon.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(a.icon.occlusionQueryOpacityVertexArray,d1.members,!0):a.icon.occlusionQueryOpacityVertexBuffer.updateData(a.icon.occlusionQueryOpacityVertexArray)),!0}updateZOffset(){const e=(h,f,x)=>{o+=f,o>h.length&&h.resize(o);for(let w=-f;w<0;w++)h.emplace(w+o,x)},i=(h,f,x)=>{a+=f,a>h.length&&h.resize(a);for(let w=-f;w<0;w++)h.emplace(w+a,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,a=0;for(let h=0;h<this.symbolInstances.length;h++){const f=this.symbolInstances.get(h),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:w,numIconVertices:S}=f,P=f.zOffset,R=S>0;if((x>0||w>0)&&(e(this.text.zOffsetVertexArray,x,P),e(this.text.zOffsetVertexArray,w,P)),R){const{placedIconSymbolIndex:B,verticalPlacedIconSymbolIndex:H}=f;B>=0&&i(this.icon.zOffsetVertexArray,S,P),H>=0&&i(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,P)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Wx(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData();for(const e of this.queries.values())e.destroy()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:a,y:h}of i)this.lineVertexArray.emplaceBack(a,h);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,a,h,f,x,w,S,P,R,B,H,$,te,ne){const de=e.indexArray,Se=e.layoutVertexArray,Me=e.globeExtVertexArray,Le=e.segments.prepareSegment(4*i.length,Se,de,this.canOverlap?f.sortKey:void 0),ze=this.glyphOffsetArray.length,Fe=Le.vertexLength,Xe=this.allowVerticalPlacement&&x===Xa.vertical?Math.PI/2:0,et=f.text&&f.text.sections;for(let _t=0;_t<i.length;_t++){const{tl:dt,tr:St,bl:Vt,br:bt,texPrimary:kt,texSecondary:yt,pixelOffsetTL:Bt,pixelOffsetBR:jt,minFontScaleX:zt,minFontScaleY:ri,glyphOffset:Ut,isSDF:Ht,sectionIndex:Di}=i[_t],Si=Le.vertexLength,Ci=Ut[1];if(Qm(Se,S.x,S.y,dt.x,Ci+dt.y,kt.x,kt.y,o,Ht,Bt.x,Bt.y,zt,ri),Qm(Se,S.x,S.y,St.x,Ci+St.y,kt.x+kt.w,kt.y,o,Ht,jt.x,Bt.y,zt,ri),Qm(Se,S.x,S.y,Vt.x,Ci+Vt.y,kt.x,kt.y+kt.h,o,Ht,Bt.x,jt.y,zt,ri),Qm(Se,S.x,S.y,bt.x,Ci+bt.y,kt.x+kt.w,kt.y+kt.h,o,Ht,jt.x,jt.y,zt,ri),w){const{x:qt,y:Ni,z:cn}=w.anchor,[Gi,mn,un]=w.up;eg(Me,qt,Ni,cn,Gi,mn,un),eg(Me,qt,Ni,cn,Gi,mn,un),eg(Me,qt,Ni,cn,Gi,mn,un),eg(Me,qt,Ni,cn,Gi,mn,un),tg(e.dynamicLayoutVertexArray,qt,Ni,cn,Xe)}else tg(e.dynamicLayoutVertexArray,S.x,S.y,S.z,Xe);if(ne){const qt=yt||kt;Jm(e.iconTransitioningVertexArray,qt.x,qt.y),Jm(e.iconTransitioningVertexArray,qt.x+qt.w,qt.y),Jm(e.iconTransitioningVertexArray,qt.x,qt.y+qt.h),Jm(e.iconTransitioningVertexArray,qt.x+qt.w,qt.y+qt.h)}de.emplaceBack(Si,Si+1,Si+2),de.emplaceBack(Si+1,Si+2,Si+3),Le.vertexLength+=4,Le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ut[0]),_t!==i.length-1&&Di===i[_t+1].sectionIndex||e.programConfigurations.populatePaintArrays(Se.length,f,f.index,{},H,$,te,et&&et[Di])}const st=w?w.anchor:S;e.placedSymbolArray.emplaceBack(st.x,st.y,st.z,S.x,S.y,ze,this.glyphOffsetArray.length-ze,Fe,P,R,S.segment,o?o[0]:0,o?o[1]:0,a[0],a[1],x,0,!1,0,B,0)}_commitLayoutVertex(e,i,o,a,h,f,x){e.emplaceBack(i,o,a,h,f,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,i,o,a,h,f,x){const w=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),S=w.vertexLength,P=x.tileAnchorX,R=x.tileAnchorY;for(let H=0;H<4;H++)o.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,i,e.padding,x.zOffset),this._commitLayoutVertex(o.layoutVertexArray,a,h,f,P,R,new Yt(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,a,h,f,P,R,new Yt(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,a,h,f,P,R,new Yt(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,a,h,f,P,R,new Yt(e.x1,e.y2)),w.vertexLength+=4;const B=o.indexArray;B.emplaceBack(S,S+1),B.emplaceBack(S+1,S+2),B.emplaceBack(S+2,S+3),B.emplaceBack(S+3,S),w.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,a,h,f){for(let x=a;x<h;x++){const w=o.get(x),S=this.getSymbolInstanceTextSize(e,f,i,x);this._addCollisionDebugVertices(w,S,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,i,o,a,h,f){for(let x=a;x<h;x++){const w=o.get(x),S=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._addCollisionDebugVertices(w,S,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new I1(gm,tx.members,Eu),this.iconCollisionBox=new I1(gm,tx.members,Eu);const o=fd(this.iconSizeData,e),a=fd(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const f=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(a,e,i,f.textBoxStartIndex,f.textBoxEndIndex,f),this._addTextDebugCollisionBoxes(a,e,i,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._addIconDebugCollisionBoxes(o,e,i,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._addIconDebugCollisionBoxes(o,e,i,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}}getSymbolInstanceTextSize(e,i,o,a){const h=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:a),f=Hm(this.textSizeData,e,h)/Cs;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,i,o){const a=this.icon.placedSymbolArray.get(o),h=Hm(this.iconSizeData,e,a);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(e,i,o,a){e.emplaceBack(i,-o,-o,a),e.emplaceBack(i,o,-o,a),e.emplaceBack(i,o,o,a),e.emplaceBack(i,-o,o,a)}_updateTextDebugCollisionBoxes(e,i,o,a,h,f){for(let x=a;x<h;x++){const w=o.get(x),S=this.getSymbolInstanceTextSize(e,f,i,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,w.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(e,i,o,a,h,f){for(let x=a;x<h;x++){const w=o.get(x),S=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,w.padding,f.zOffset)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const o=fd(this.iconSizeData,e),a=fd(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const f=this.symbolInstances.get(h);this._updateTextDebugCollisionBoxes(a,e,i,f.textBoxStartIndex,f.textBoxEndIndex,f),this._updateTextDebugCollisionBoxes(a,e,i,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._updateIconDebugCollisionBoxes(o,e,i,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._updateIconDebugCollisionBoxes(o,e,i,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,o,a,h,f,x,w,S){const P={};if(i<o){const{x1:R,y1:B,x2:H,y2:$,padding:te,projectedAnchorX:ne,projectedAnchorY:de,projectedAnchorZ:Se,tileAnchorX:Me,tileAnchorY:Le,featureIndex:ze}=e.get(i);P.textBox={x1:R,y1:B,x2:H,y2:$,padding:te,projectedAnchorX:ne,projectedAnchorY:de,projectedAnchorZ:Se,tileAnchorX:Me,tileAnchorY:Le},P.textFeatureIndex=ze}if(a<h){const{x1:R,y1:B,x2:H,y2:$,padding:te,projectedAnchorX:ne,projectedAnchorY:de,projectedAnchorZ:Se,tileAnchorX:Me,tileAnchorY:Le,featureIndex:ze}=e.get(a);P.verticalTextBox={x1:R,y1:B,x2:H,y2:$,padding:te,projectedAnchorX:ne,projectedAnchorY:de,projectedAnchorZ:Se,tileAnchorX:Me,tileAnchorY:Le},P.verticalTextFeatureIndex=ze}if(f<x){const{x1:R,y1:B,x2:H,y2:$,padding:te,projectedAnchorX:ne,projectedAnchorY:de,projectedAnchorZ:Se,tileAnchorX:Me,tileAnchorY:Le,featureIndex:ze}=e.get(f);P.iconBox={x1:R,y1:B,x2:H,y2:$,padding:te,projectedAnchorX:ne,projectedAnchorY:de,projectedAnchorZ:Se,tileAnchorX:Me,tileAnchorY:Le},P.iconFeatureIndex=ze}if(w<S){const{x1:R,y1:B,x2:H,y2:$,padding:te,projectedAnchorX:ne,projectedAnchorY:de,projectedAnchorZ:Se,tileAnchorX:Me,tileAnchorY:Le,featureIndex:ze}=e.get(w);P.verticalIconBox={x1:R,y1:B,x2:H,y2:$,padding:te,projectedAnchorX:ne,projectedAnchorY:de,projectedAnchorZ:Se,tileAnchorX:Me,tileAnchorY:Le},P.verticalIconFeatureIndex=ze}return P}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),a=o.vertexStartIndex+4*o.numGlyphs;for(let h=o.vertexStartIndex;h<a;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),a=[],h=[],f=[];for(let x=0;x<this.symbolInstances.length;++x){f.push(x);const w=this.symbolInstances.get(x);a.push(0|Math.round(i*w.tileAnchorX+o*w.tileAnchorY)),h.push(w.featureIndex)}return f.sort((x,w)=>a[x]-a[w]||h[w]-h[x]),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:S}=o;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),h>=0&&h!==a&&this.addIndicesForPlacedSymbol(this.text,h),f>=0&&f!==h&&f!==a&&this.addIndicesForPlacedSymbol(this.text,f),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}xe(vd,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),vd.addDynamicAttributes=tg;class dl{constructor(e,i,o,a){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(i,a)}update(e,i,o){const{width:a,height:h}=e,{context:f}=this,{gl:x}=f;if(x.bindTexture(x.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||i.premultiply!==!1)),this.useMipmap=!!(i&&i.useMipmap),o||this.size&&this.size[0]===a&&this.size[1]===h){const{x:w,y:S}=o||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)x.texSubImage2D(x.TEXTURE_2D,0,w,S,x.RGBA,x.UNSIGNED_BYTE,e);else{let P=this.format,R=x.UNSIGNED_BYTE;this.format===x.R32F&&(P=x.RED,R=x.FLOAT),x.texSubImage2D(x.TEXTURE_2D,0,w,S,a,h,P,R,e.data)}}else if(this.size=[a,h],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let w=this.format;this.format===x.R8&&(w=x.RED),x.texImage2D(x.TEXTURE_2D,0,this.format,w,x.UNSIGNED_BYTE,e)}else{let w=this.format,S=this.format,P=x.UNSIGNED_BYTE,R=!1;this.format===x.DEPTH_COMPONENT&&(w=x.DEPTH_COMPONENT16,P=x.UNSIGNED_SHORT),this.format===x.DEPTH_STENCIL&&(w=x.DEPTH24_STENCIL8,P=x.UNSIGNED_INT_24_8,R=!0),this.format===x.R8&&(S=x.RED),this.format===x.R32F&&(P=x.FLOAT,S=x.RED),!this.useMipmap&&R?x.texStorage2D(x.TEXTURE_2D,1,w,a,h):x.texImage2D(x.TEXTURE_2D,0,w,a,h,0,S,P,e.data)}this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(e,i,o=!1){const{context:a}=this,{gl:h}=a;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,o,a){const{context:h}=this,{gl:f}=h;f.bindTexture(f.TEXTURE_2D,this.texture),i!==this.magFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,o),this.wrapS=o),a!==this.wrapT&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,a),this.wrapT=a)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class ig{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:o}=this,{gl:a}=o;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),this.wrapS=i)}}const fl=32,gc=33,ku=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,o=0,a=0,h=0,f=0,x=0;for(1&e?a=h=f=fl:i=o=x=fl;(e>>=1)>1;){const S=i+a>>1,P=o+h>>1;1&e?(a=i,h=o,i=f,o=x):(i=a,o=h,a=f,h=x),f=S,x=P}const w=4*t;ku[w+0]=i,ku[w+1]=o,ku[w+2]=a,ku[w+3]=h}const _c=new Uint16Array(2178),Bu=new Uint8Array(1089),ng=new Uint16Array(1089);function $x(t){return t===0?-.03125:t===32?.03125:0}var rg=Yn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),qS=Yn([{name:"a_index",type:"Int16",components:1}]);const Zx=(()=>({type:2,extent:Zt,loadGeometry:()=>[[new Yt(0,0),new Yt(Zt+1,0),new Yt(Zt+1,Zt+1),new Yt(0,Zt+1),new Yt(0,0)]]}))();class og{constructor(e,i,o,a,h){this.tileID=e,this.uid=va(),this.uses=0,this.tileSize=i,this.tileZoom=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=h,a&&a.style&&(this._lastUpdatedBrightness=a.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",a&&a.transform&&(this.projection=a.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<Ao.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=vh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,o){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(a,h){const f={};if(!h)return f;for(const x of a){const w=x.layerIds.map(S=>h.getLayer(S)).filter(Boolean);if(w.length!==0){x.layers=w,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(S=>w.filter(P=>P.id===S)[0]));for(const S of w)f[S.fqid]=x}}return f}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const a in this.buckets){const h=this.buckets[a];if(h instanceof vd){if(this.hasSymbolBuckets=!0,!o)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const a in this.buckets){const h=this.buckets[a];if(h instanceof vd&&h.hasRTLText){this.hasRTLText=!0,vn.isLoading()||vn.isLoaded()||Cn()!=="deferred"||Sr();break}}this.queryPadding=0;for(const a in this.buckets){const h=this.buckets[a],f=i.style.getOwnLayer(a);if(!f)continue;const x=f.queryRadius(h);this.queryPadding=Math.max(this.queryPadding,x)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new L0}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const a in this.buckets){const h=this.buckets[a];h.uploadPending()&&h.upload(e)}const i=e.gl,o=this.imageAtlas;if(o&&!o.uploaded){const a=!!Object.keys(o.patternPositions).length;this.imageAtlasTexture=new dl(e,o.image,i.RGBA,{useMipmap:a}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new dl(e,this.glyphAtlasImage,i.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new dl(e,this.lineAtlas.image,i.R8),this.lineAtlas.uploaded=!0)}prepare(e,i,o){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,o),!i||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const a=i.style.getBrightness();(this._lastUpdatedBrightness||a)&&(this._lastUpdatedBrightness&&a&&Math.abs(this._lastUpdatedBrightness-a)<.001||(this._lastUpdatedBrightness=a,this.updateBuckets(void 0,i)))}queryRenderedFeatures(e,i,o,a,h,f,x,w){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:a,pixelPosMatrix:x,transform:f,params:h,tileTransform:this.tileTransform},e,i,o):{}}querySourceFeatures(e,i){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const a=o.loadVTLayers(),h=i?i.sourceLayer:"",f=a._geojsonTileLayer||a[h];if(!f)return;const x=ws(i&&i.filter),{z:w,x:S,y:P}=this.tileID.canonical,R={z:w,x:S,y:P};for(let B=0;B<f.length;B++){const H=f.feature(B);if(x.needGeometry){const ne=Hc(H,!0);if(!x.filter(new $i(this.tileID.overscaledZ),ne,this.tileID.canonical))continue}else if(!x.filter(new $i(this.tileID.overscaledZ),H))continue;const $=o.getId(H,h),te=new mx(H,w,S,P,$);te.tile=R,e.push(te)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const o=Fa(e.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const o=Date.now();let a=!1;if(this.expirationTime>o)a=!1;else if(i)if(this.expirationTime<i)a=!0;else{const h=this.expirationTime-i;h?this.expirationTime=o+Math.max(h,3e4):a=!0}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&i&&this.updateBuckets(e,i)}updateBuckets(e,i){if(!this.latestFeatureIndex)return;const o=this.latestFeatureIndex.loadVTLayers(),a=i.style.listImages(),h=i.style.getBrightness();for(const f in this.buckets){if(!i.style.hasLayer(f))continue;const x=this.buckets[f],w=x.layers[0].sourceLayer||"_geojsonTileLayer",S=o[w];let P={};if(e&&(P=e[w],!S||!P||Object.keys(P).length===0))continue;if(x.update(P,S,a,this.imageAtlas&&this.imageAtlas.patternPositions||{},h),x instanceof Vm||x instanceof Pm){const B=i.style.getOwnSourceCache(x.layers[0].source);i._terrain&&i._terrain.enabled&&B&&x.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(B.id,this.tileID)}const R=i&&i.style&&i.style.getOwnLayer(f);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ao.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Ao.now()+e}setTexture(e,i){const o=i.context,a=o.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture&&this.texture instanceof dl?this.texture.update(e,{useMipmap:!0}):(this.texture=new dl(o,e,a.RGBA,{useMipmap:!0}),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE))}setDependencies(e,i){const o={};for(const a of i)o[a]=!0;this.dependencies[e]=o}hasDependency(e,i){for(const o of e){const a=this.dependencies[o];if(a){for(const h of i)if(a[h])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const o=Dl(Zx,this.tileID.canonical,this.tileTransform)[0],a=new Ol,h=new Af;for(let f=0;f<o.length;f++){const{x,y:w}=o[f];a.emplaceBack(x,w),h.emplaceBack(f)}h.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(h),this._tileDebugBuffer=e.createVertexBuffer(a,Df.members),this._tileDebugSegments=qr.simpleSegment(0,0,a.length,h.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const o=Dl(Zx,this.tileID.canonical,this.tileTransform)[0];let a,h;if(this.isRaster){const f=function(x,w){const S=vh(x,w),P=Math.pow(2,x.z);for(let ne=0;ne<gc;ne++)for(let de=0;de<gc;de++){const Se=ca((x.x+(de+$x(de))/fl)/P),Me=hs((x.y+(ne+$x(ne))/fl)/P),Le=w.project(Se,Me),ze=ne*gc+de;_c[2*ze+0]=Math.round((Le.x*S.scale-S.x)*Zt),_c[2*ze+1]=Math.round((Le.y*S.scale-S.y)*Zt)}Bu.fill(0),ng.fill(0);for(let ne=2045;ne>=0;ne--){const de=4*ne,Se=ku[de+0],Me=ku[de+1],Le=ku[de+2],ze=ku[de+3],Fe=Se+Le>>1,Xe=Me+ze>>1,et=Fe+Xe-Me,st=Xe+Se-Fe,_t=Me*gc+Se,dt=ze*gc+Le,St=Xe*gc+Fe,Vt=Math.hypot((_c[2*_t+0]+_c[2*dt+0])/2-_c[2*St+0],(_c[2*_t+1]+_c[2*dt+1])/2-_c[2*St+1])>=16;Bu[St]=Bu[St]||(Vt?1:0),ne<1022&&(Bu[St]=Bu[St]||Bu[(Me+st>>1)*gc+(Se+et>>1)]||Bu[(ze+st>>1)*gc+(Le+et>>1)])}const R=new xu,B=new ss;let H=0;function $(ne,de){const Se=de*gc+ne;return ng[Se]===0&&(R.emplaceBack(_c[2*Se+0],_c[2*Se+1],ne*Zt/fl,de*Zt/fl),ng[Se]=++H),ng[Se]-1}function te(ne,de,Se,Me,Le,ze){const Fe=ne+Se>>1,Xe=de+Me>>1;if(Math.abs(ne-Le)+Math.abs(de-ze)>1&&Bu[Xe*gc+Fe])te(Le,ze,ne,de,Fe,Xe),te(Se,Me,Le,ze,Fe,Xe);else{const et=$(ne,de),st=$(Se,Me),_t=$(Le,ze);B.emplaceBack(et,st,_t)}}return te(0,0,fl,fl,fl,0),te(fl,fl,0,0,0,fl),{vertices:R,indices:B}}(this.tileID.canonical,i);a=f.vertices,h=f.indices}else{a=new xu,h=new ss;for(const{x,y:w}of o)a.emplaceBack(x,w,0,0);const f=Nf(a.int16,void 0,4);for(let x=0;x<f.length;x+=3)h.emplaceBack(f[x],f[x+1],f[x+2])}this._tileBoundsBuffer=e.createVertexBuffer(a,rg.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(h),this._tileBoundsSegments=qr.simpleSegment(0,0,a.length,h.length)}_makeGlobeTileDebugBuffers(e,i){const o=i.projection;if(!o||o.name!=="globe"||i.freezeTileCoverage)return;const a=this.tileID.canonical,h=kf(Jy(a,i)),f=Wc(i.zoom);let x;f>0&&(x=r.ad.invert(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,a,i,h,x,f),this._makeGlobeTileDebugTextBuffer(e,a,i,h,x,f)}_globePoint(e,i,o,a,h,f,x){let w=Rf(e,i,o);if(f){const S=1<<o.z,P=dc(a.center.lng),R=fc(a.center.lat),B=(o.x+.5)/S-P;let H=0;B>.5?H=-1:B<-.5&&(H=1);let $=(e/Zt+o.x)/S+H,te=(i/Zt+o.y)/S;$=($-P)*a._pixelsPerMercatorPixel+P,te=(te-R)*a._pixelsPerMercatorPixel+R;const ne=[$*a.worldSize,te*a.worldSize,0];r._.transformMat4(ne,ne,f),w=Gc(w,ne,x)}return r._.transformMat4(w,w,h)}_makeGlobeTileDebugBorderBuffer(e,i,o,a,h,f){const x=new Ol,w=new Af,S=new fm,P=(B,H,$,te,ne)=>{const de=($-B)/(ne-1),Se=(te-H)/(ne-1),Me=x.length;for(let Le=0;Le<ne;Le++){const ze=B+Le*de,Fe=H+Le*Se;x.emplaceBack(ze,Fe);const Xe=this._globePoint(ze,Fe,i,o,a,h,f);S.emplaceBack(Xe[0],Xe[1],Xe[2]),w.emplaceBack(Me+Le)}},R=Zt;P(0,0,R,0,16),P(R,0,R,R,16),P(R,R,0,R,16),P(0,R,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(w),this._tileDebugBuffer=e.createVertexBuffer(x,Df.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(S,Ky.members),this._tileDebugSegments=qr.simpleSegment(0,0,x.length,w.length)}_makeGlobeTileDebugTextBuffer(e,i,o,a,h,f){const x=Zt/4,w=new Ol,S=new ss,P=new fm,R=25;S.reserve(32),w.reserve(R),P.reserve(R);const B=(H,$)=>R*H+$;for(let H=0;H<R;H++){const $=H*x;for(let te=0;te<R;te++){const ne=te*x;w.emplaceBack(ne,$);const de=this._globePoint(ne,$,i,o,a,h,f);P.emplaceBack(de[0],de[1],de[2])}}for(let H=0;H<4;H++)for(let $=0;$<4;$++){const te=B(H,$),ne=B(H,$+1),de=B(H+1,$),Se=B(H+1,$+1);S.emplaceBack(te,ne,de),S.emplaceBack(de,ne,Se)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(S),this._tileDebugTextBuffer=e.createVertexBuffer(w,Df.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(P,Ky.members),this._tileDebugTextSegments=qr.simpleSegment(0,0,R,32)}destroy(e=!1){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof dl&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}function HS(t,e,i){t===1?e.header_length=i.readFixed32():t===2?e.x=i.readVarint():t===3?e.y=i.readVarint():t===4?e.z=i.readVarint():t===5&&e.layers.push(function(o,a){return o.readFields(XS,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},a)}(i,i.readVarint()+i.pos))}function GS(t,e,i){t===1?(e.delta_filter=function(o,a){return o.readFields(WS,{block_size:0},a)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):t===2?(i.readVarint(),e.filter="zigzag_filter"):t===3?(i.readVarint(),e.filter="bitshuffle_filter"):t===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function WS(t,e,i){t===1&&(e.block_size=i.readVarint())}function $S(t,e,i){t===1?(i.readVarint(),e.codec="gzip_data"):t===2?(i.readVarint(),e.codec="jpeg_image"):t===3?(i.readVarint(),e.codec="webp_image"):t===4&&(i.readVarint(),e.codec="png_image")}function ZS(t,e,i){t===1?e.first_byte=i.readFixed64():t===2?e.last_byte=i.readFixed64():t===3?e.filters.push(function(o,a){return o.readFields(GS,{},a)}(i,i.readVarint()+i.pos)):t===4?e.codec=function(o,a){return o.readFields($S,{},a)}(i,i.readVarint()+i.pos):t===5?e.offset=i.readFloat():t===6?e.scale=i.readFloat():t===7&&e.bands.push(i.readString())}function XS(t,e,i){t===1?e.version=i.readVarint():t===2?e.name=i.readString():t===3?e.units=i.readString():t===4?e.tilesize=i.readVarint():t===5?e.buffer=i.readVarint():t===6?e.pixel_format=i.readVarint():t===7&&e.data_index.push(function(o,a){return o.readFields(ZS,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},a)}(i,i.readVarint()+i.pos))}function YS(t,e,i){if(t===2)(function(o,a,h){o.readFields(KS,h,a)})(i,i.readVarint()+i.pos,e);else if(t===3)throw new Error("Not implemented")}function KS(t,e,i){if(t===1){let o=0;const a=i.readVarint()+i.pos;for(;i.pos<a;)e[o++]=i.readVarint()}}/**
 * tiny-lru
 *
 * @copyright 2024 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 11.2.11
 */class QS{constructor(e=0,i=0,o=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=o,this.size=0,this.ttl=i}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){const i=this.items[e];delete this.items[e],this.size--,i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.first===i&&(this.first=i.next),this.last===i&&(this.last=i.prev)}return this}entries(e=this.keys()){return e.map(i=>[i,this.get(i)])}evict(e=!1){if(e||this.size>0){const i=this.first;delete this.items[i.key],--this.size==0?(this.first=null,this.last=null):(this.first=i.next,this.first.prev=null)}return this}expiresAt(e){let i;return this.has(e)&&(i=this.items[e].expiry),i}get(e){let i;if(this.has(e)){const o=this.items[e];this.ttl>0&&o.expiry<=Date.now()?this.delete(e):(i=o.value,this.set(e,i,!0))}return i}has(e){return e in this.items}keys(){const e=[];let i=this.first;for(;i!==null;)e.push(i.key),i=i.next;return e}set(e,i,o=!1,a=this.resetTtl){let h;if(o||this.has(e)){if(h=this.items[e],h.value=i,o===!1&&a&&(h.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==h){const f=this.last,x=h.next,w=h.prev;this.first===h&&(this.first=h.next),h.next=null,h.prev=this.last,f.next=h,w!==null&&(w.next=x),x!==null&&(x.prev=w)}}else this.max>0&&this.size===this.max&&this.evict(!0),h=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:i},++this.size==1?this.first=h:this.last.next=h;return this.last=h,this}values(e=this.keys()){return e.map(i=>this.get(i))}}function JS(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let o=2;o>=1;o--){const a=o===1?1:0,h=o===2?1:0;for(let f=0;f<e[0];f++){const x=e[1]*f;for(let w=a;w<e[1];w++){const S=e[2]*(w+x);for(let P=h;P<e[2];P++){const R=e[3]*(P+S);for(let B=0;B<e[3];B++){const H=R+B;t[H]+=t[H-i]}}}}i*=e[o]}return t}function eA(t){for(let e=0,i=t.length;e<i;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function tA(t,e){switch(e){case"uint32":return t;case"uint16":for(let i=0;i<t.length;i+=2){const o=t[i],a=t[i+1];t[i]=(240&o)>>4|(61440&o)>>8|(240&a)<<4|61440&a,t[i+1]=15&o|(3840&o)>>4|(15&a)<<8|(3840&a)<<4}return t;case"uint8":for(let i=0;i<t.length;i+=4){const o=t[i],a=t[i+1],h=t[i+2],f=t[i+3];t[i+0]=(192&o)>>6|(192&a)>>4|(192&h)>>2|192&f,t[i+1]=(48&o)>>4|(48&a)>>2|48&h|(48&f)<<2,t[i+2]=(12&o)>>2|12&a|(12&h)<<2|(12&f)<<4,t[i+3]=3&o|(3&a)<<2|(3&h)<<4|(3&f)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class Nu extends Error{constructor(e){super(e),this.name="MRTError"}}var Ya=Uint8Array,xd=Uint16Array,iA=Int32Array,Xx=new Ya([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Yx=new Ya([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),nA=new Ya([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Kx=function(t,e){for(var i=new xd(31),o=0;o<31;++o)i[o]=e+=1<<t[o-1];var a=new iA(i[30]);for(o=1;o<30;++o)for(var h=i[o];h<i[o+1];++h)a[h]=h-i[o]<<5|o;return{b:i,r:a}},Qx=Kx(Xx,2),Jx=Qx.b,rA=Qx.r;Jx[28]=258,rA[258]=28;for(var oA=Kx(Yx,0).b,M1=new xd(32768),xo=0;xo<32768;++xo){var wd=(43690&xo)>>1|(21845&xo)<<1;M1[xo]=((65280&(wd=(61680&(wd=(52428&wd)>>2|(13107&wd)<<2))>>4|(3855&wd)<<4))>>8|(255&wd)<<8)>>1}var Jf=function(t,e,i){for(var o=t.length,a=0,h=new xd(e);a<o;++a)t[a]&&++h[t[a]-1];var f,x=new xd(e);for(a=1;a<e;++a)x[a]=x[a-1]+h[a-1]<<1;if(i){f=new xd(1<<e);var w=15-e;for(a=0;a<o;++a)if(t[a])for(var S=a<<4|t[a],P=e-t[a],R=x[t[a]-1]++<<P,B=R|(1<<P)-1;R<=B;++R)f[M1[R]>>w]=S}else for(f=new xd(o),a=0;a<o;++a)t[a]&&(f[a]=M1[x[t[a]-1]++]>>15-t[a]);return f},ep=new Ya(288);for(xo=0;xo<144;++xo)ep[xo]=8;for(xo=144;xo<256;++xo)ep[xo]=9;for(xo=256;xo<280;++xo)ep[xo]=7;for(xo=280;xo<288;++xo)ep[xo]=8;var ew=new Ya(32);for(xo=0;xo<32;++xo)ew[xo]=5;var sA=Jf(ep,9,1),aA=Jf(ew,5,1),L1=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},Nl=function(t,e,i){var o=e/8|0;return(t[o]|t[o+1]<<8)>>(7&e)&i},O1=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},lA=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Fl=function(t,e,i){var o=new Error(e||lA[t]);if(o.code=t,Error.captureStackTrace&&Error.captureStackTrace(o,Fl),!i)throw o;return o},cA=new Ya(0),uA=typeof TextDecoder<"u"&&new TextDecoder;try{uA.decode(cA,{stream:!0})}catch{}const hA={gzip_data:"gzip"},dA={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},fA={uint32:1,uint16:2,uint8:4},pA={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class P1{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){const i=new Uint8Array(e),o=new DataView(e);if(i[0]!==13)throw new Nu("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),o=this.getHeaderLength(e);if(i.length<o)throw new Nu(`Expected header with length >= ${o} but got buffer of length ${i.length}`);const a=function(h,f){return h.readFields(HS,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new dd(i.subarray(0,o)));if(!isNaN(this.x)&&(this.x!==a.x||this.y!==a.y||this.z!==a.z))throw new Nu(`Invalid attempt to parse header ${a.z}/${a.x}/${a.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=a.x,this.y=a.y,this.z=a.z;for(const h of a.layers)this.layers[h.name]=new mA(h,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],o=this.getLayer(e.layerName);for(let a=0;a<o.dataIndex.length;a++){const h=o.dataIndex[a],f=h.first_byte-e.firstByte,x=h.last_byte+1-e.firstByte;if(a<e.firstBlock||a>e.lastBlock||o._blocksInProgress.has(a))continue;const w={layerName:o.name,firstByte:f,lastByte:x,pixelFormat:o.pixelFormat,blockIndex:a,blockShape:[h.bands.length].concat(o.bandShape),buffer:o.buffer,codec:h.codec.codec,filters:h.filters.map(S=>S.filter)};o._blocksInProgress.add(a),i.push(w)}return new tw(i,()=>{i.forEach(a=>o._blocksInProgress.delete(a.blockIndex))},(a,h)=>{if(i.forEach(f=>o._blocksInProgress.delete(f.blockIndex)),a)throw a;h.forEach(f=>{this.getLayer(f.layerName).processDecodedData(f)})})}}class mA{constructor({version:e,name:i,units:o,tilesize:a,pixel_format:h,buffer:f,data_index:x},w){if(this.version=e,this.version!==1)throw new Nu(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=o,this.tileSize=a,this.buffer=f,this.pixelFormat=dA[h],this.dataIndex=x,this.bandShape=[a+2*f,a+2*f,fA[this.pixelFormat]],this._decodedBlocks=function(S=1e3,P=0,R=!1){if(isNaN(S)||S<0)throw new TypeError("Invalid max value");if(isNaN(P)||P<0)throw new TypeError("Invalid ttl value");if(typeof R!="boolean")throw new TypeError("Invalid resetTtl value");return new QS(S,P,R)}(w?w.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.set(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[o,a]of this.dataIndex.entries()){for(const[h,f]of a.bands.entries())if(f===e)return{bandIndex:i+h,blockIndex:o,blockBandIndex:h};i+=a.bands.length}break;case"number":for(const[o,a]of this.dataIndex.entries()){if(e>=i&&e<i+a.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-i};i+=a.bands.length}break;default:throw new Nu(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Nu(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,o=-1/0,a=1/0,h=-1/0;for(const f of e){const{blockIndex:x}=this.getBlockForBand(f);if(x<0)throw new Nu(`Invalid band: ${JSON.stringify(f)}`);const w=this.dataIndex[x];a=Math.min(a,x),h=Math.max(h,x),i=Math.min(i,w.first_byte),o=Math.max(o,w.last_byte)}return{layerName:this.name,firstByte:i,lastByte:o,firstBlock:a,lastBlock:h}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:o}=this.getBlockForBand(e),a=this._decodedBlocks.get(i.toString());if(!a)throw new Nu(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const h=this.dataIndex[i],f=this.bandShape.reduce((S,P)=>S*P,1),x=o*f,w=a.subarray(x,x+f);return{data:w,bytes:new Uint8Array(w.buffer).subarray(w.byteOffset,w.byteOffset+w.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:h.offset,scale:h.scale}}}class tw{constructor(e,i,o){this.tasks=e,this._onCancel=i,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}P1.performDecoding=function(t,e){return Promise.all(e.tasks.map(i=>{const{layerName:o,firstByte:a,lastByte:h,pixelFormat:f,blockShape:x,blockIndex:w,filters:S,codec:P}=i,R=new Uint8Array(t).subarray(a,h+1),B=new Uint32Array(x[0]*x[1]*x[2]);let H;if(P!=="gzip_data")throw new Error(`Unhandled codec: ${P}`);return H=function($,te){if(!globalThis.DecompressionStream&&te==="gzip_data")return Promise.resolve(((Me=function(Fe){Fe[0]==31&&Fe[1]==139&&Fe[2]==8||Fl(6,"invalid gzip data");var Xe=Fe[3],et=10;4&Xe&&(et+=2+(Fe[10]|Fe[11]<<8));for(var st=(Xe>>3&1)+(Xe>>4&1);st>0;st-=!Fe[et++]);return et+(2&Xe)}(Se=$))+8>Se.length&&Fl(6,"invalid gzip data"),function(Fe,Xe,et,st){var _t=Fe.length;if(!_t||Xe.f&&!Xe.l)return et||new Ya(0);var dt=!et,St=dt||Xe.i!=2,Vt=Xe.i;dt&&(et=new Ya(3*_t));var bt,kt,yt=function(zu){var Vu=et.length;if(zu>Vu){var Th=new Ya(Math.max(2*Vu,zu));Th.set(et),et=Th}},Bt=Xe.f||0,jt=Xe.p||0,zt=Xe.b||0,ri=Xe.l,Ut=Xe.d,Ht=Xe.m,Di=Xe.n,Si=8*_t;do{if(!ri){Bt=Nl(Fe,jt,1);var Ci=Nl(Fe,jt+1,3);if(jt+=3,!Ci){var qt=Fe[(Pn=4+((jt+7)/8|0))-4]|Fe[Pn-3]<<8,Ni=Pn+qt;if(Ni>_t){Vt&&Fl(0);break}St&&yt(zt+qt),et.set(Fe.subarray(Pn,Ni),zt),Xe.b=zt+=qt,Xe.p=jt=8*Ni,Xe.f=Bt;continue}if(Ci==1)ri=sA,Ut=aA,Ht=9,Di=5;else if(Ci==2){var cn=Nl(Fe,jt,31)+257,Gi=Nl(Fe,jt+10,15)+4,mn=cn+Nl(Fe,jt+5,31)+1;jt+=14;for(var un=new Ya(mn),xn=new Ya(19),qi=0;qi<Gi;++qi)xn[nA[qi]]=Nl(Fe,jt+3*qi,7);jt+=3*Gi;var ur=L1(xn),sr=(1<<ur)-1,jn=Jf(xn,ur,1);for(qi=0;qi<mn;){var Pn,qn=jn[Nl(Fe,jt,sr)];if(jt+=15&qn,(Pn=qn>>4)<16)un[qi++]=Pn;else{var Er=0,_r=0;for(Pn==16?(_r=3+Nl(Fe,jt,3),jt+=2,Er=un[qi-1]):Pn==17?(_r=3+Nl(Fe,jt,7),jt+=3):Pn==18&&(_r=11+Nl(Fe,jt,127),jt+=7);_r--;)un[qi++]=Er}}var Kr=un.subarray(0,cn),Hr=un.subarray(cn);Ht=L1(Kr),Di=L1(Hr),ri=Jf(Kr,Ht,1),Ut=Jf(Hr,Di,1)}else Fl(1);if(jt>Si){Vt&&Fl(0);break}}St&&yt(zt+131072);for(var Os=(1<<Ht)-1,co=(1<<Di)-1,zr=jt;;zr=jt){var Mo=(Er=ri[O1(Fe,jt)&Os])>>4;if((jt+=15&Er)>Si){Vt&&Fl(0);break}if(Er||Fl(2),Mo<256)et[zt++]=Mo;else{if(Mo==256){zr=jt,ri=null;break}var ds=Mo-254;Mo>264&&(ds=Nl(Fe,jt,(1<<(Ys=Xx[qi=Mo-257]))-1)+Jx[qi],jt+=Ys);var fs=Ut[O1(Fe,jt)&co],wr=fs>>4;if(fs||Fl(3),jt+=15&fs,Hr=oA[wr],wr>3){var Ys=Yx[wr];Hr+=O1(Fe,jt)&(1<<Ys)-1,jt+=Ys}if(jt>Si){Vt&&Fl(0);break}St&&yt(zt+131072);var Xc=zt+ds;if(zt<Hr){var pl=0-Hr,Vl=Math.min(Hr,Xc);for(pl+zt<0&&Fl(3);zt<Vl;++zt)et[zt]=(void 0)[pl+zt]}for(;zt<Xc;++zt)et[zt]=et[zt-Hr]}}Xe.l=ri,Xe.p=zr,Xe.b=zt,Xe.f=Bt,ri&&(Bt=1,Xe.m=Ht,Xe.d=Ut,Xe.n=Di)}while(!Bt);return zt!=et.length&&dt?(bt=et,((kt=zt)==null||kt>bt.length)&&(kt=bt.length),new Ya(bt.subarray(0,kt))):et.subarray(0,zt)}(Se.subarray(Me,-8),{i:2},new Ya(((ne=Se)[(de=ne.length)-4]|ne[de-3]<<8|ne[de-2]<<16|ne[de-1]<<24)>>>0))));var ne,de,Se,Me;const Le=hA[te];if(!Le)throw new Error(`Unhandled codec: ${te}`);const ze=new globalThis.DecompressionStream(Le);return new Response(new Blob([$]).stream().pipeThrough(ze)).arrayBuffer().then(Fe=>new Uint8Array(Fe))}(R,P).then($=>(function(te,ne){te.readFields(YS,ne)}(new dd($),B),new pA[f](B.buffer))),H.then($=>{for(let te=S.length-1;te>=0;te--)switch(S[te]){case"delta_filter":JS($,x);break;case"zigzag_filter":eA($);break;case"bitshuffle_filter":tA($,f);break;default:throw new Error(`Unhandled filter "${S[te]}"`)}return{layerName:o,blockIndex:w,data:$}}).catch($=>{throw $})}))};class iw extends og{constructor(e,i,o,a,h){super(e,i,o,a,h),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,i){const o=i.context,a=o.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture&&this.texture instanceof dl?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new dl(o,e,a.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,i){const o=this._mrt=new P1(30),a=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=c(a,(h,f,x,w)=>{if(h)i(h);else try{const S=o.getHeaderLength(f);if(S>e)return void(this.request=this.fetchHeader(S,i));o.parseHeader(f),this._isHeaderLoaded=!0;let P=0;for(const R of Object.values(o.layers))P=Math.max(P,R.dataIndex[R.dataIndex.length-1].last_byte);f.byteLength>=P&&(this.entireBuffer=f),i(null,this.entireBuffer||f,x,w)}catch(S){i(S)}}),this.request}fetchBand(e,i,o){const a=this._mrt;if(!this._isHeaderLoaded||!a)return void o(new Error("Tile header is not ready"));const h=this.actor;if(!h)return void o(new Error("Can't fetch tile band without an actor"));let f;const x=(R,B)=>{f.complete(R,B),R?o(R):(this.updateTextureDescriptor(e,i),o(null,this.textureDescriptor&&this.textureDescriptor.img))},w=(R,B)=>{if(R)return o(R);const H=h.send("decodeRasterArray",{buffer:B,task:f},x,void 0,!0);this._workQueue.push(()=>{H&&H.cancel(),f.cancel()})},S=a.getLayer(e);if(!S)return void o(new Error(`Unknown sourceLayer "${e}"`));if(S.hasDataForBand(i))return this.updateTextureDescriptor(e,i),void o(null,this.textureDescriptor?this.textureDescriptor.img:null);const P=S.getDataRange([i]);if(f=a.createDecodingTask(P),!f||f.tasks.length)if(this.flushQueues(),this.entireBuffer)w(null,this.entireBuffer.slice(P.firstByte,P.lastByte+1));else{const R=Object.assign({},this.requestParams,{headers:{Range:`bytes=${P.firstByte}-${P.lastByte}`}}),B=c(R,w);this._fetchQueue.push(()=>{B.cancel(),f.cancel()})}else o(null)}updateNeeded(e,i){return(!this.textureDescriptor||this.textureDescriptor.band!==i||this.textureDescriptor.layer!==e)&&this.state!=="errored"}updateTextureDescriptor(e,i){if(!this._mrt)return;const o=this._mrt.getLayer(e);if(!o||!o.hasBand(i)||!o.hasDataForBand(i))return;const{bytes:a,tileSize:h,buffer:f,offset:x,scale:w}=o.getBandView(i),S=h+2*f,P={data:a,width:S,height:S},R=this.texture;R&&R instanceof dl&&R.update(P,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:i,img:P,buffer:f,offset:x,tileSize:h,format:o.pixelFormat,mix:[w,256*w,65536*w,16777216*w]}}}class gA{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,o){const a=e.wrapped().key;this.data[a]===void 0&&(this.data[a]=[]);const h={value:i,timeout:void 0};if(o!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},o)),this.data[a].push(h),this.order.push(a),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const o=e.wrapped().key,a=i===void 0?0:this.data[o].indexOf(i),h=this.data[o][a];return this.data[o].splice(a,1),h.timeout&&clearTimeout(h.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(h.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const o in this.data)for(const a of this.data[o])e(a.value)||i.push(a);for(const o of i)this.remove(o.value.tileID,o)}}class wh extends al{constructor(e,i,o){super(),this.id=e,this._onlySymbols=o,i.on("data",a=>{a.dataType==="source"&&a.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&a.dataType==="source"&&a.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new gA(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new dS,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="errored"&&(i.state!=="loaded"||!i.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const o=this._tiles[i];o.upload(e),o.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return ya(this._tiles).map(e=>e.tileID).sort(nw).map(e=>e.key)}getRenderableIds(e,i){const o=[];for(const a in this._tiles)this._isIdRenderable(+a,e,i)&&o.push(this._tiles[a]);return e?o.sort((a,h)=>{const f=a.tileID,x=h.tileID,w=new Yt(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),S=new Yt(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-x.overscaledZ||S.y-w.y||S.x-w.x}).map(a=>a.tileID.key):o.map(a=>a.tileID).sort(nw).map(a=>a.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i,o){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())&&(o||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const o=this._tiles[e];o&&(o.state!=="loading"&&(o.state=i),this._loadTile(o,this._tileLoaded.bind(this,o,e,i)))}_tileLoaded(e,i,o,a){if(a)if(e.state="errored",a.status!==404)this._source.fire(new qa(a,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new vs("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const h=this.map.painter.terrain;this.update(this.transform,h.getScaledDemTileSize(),!0),h.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=Ao.now(),o==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new vs("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let a=0;a<i.length;a++){const h=i[a];if(e.neighboringTiles&&e.neighboringTiles[h]){const f=this.getTileByID(h);o(e,f),o(f,e)}}function o(a,h){if(!a.dem||a.dem.borderReady)return;a.needsHillshadePrepare=!0,a.needsDEMTextureUpload=!0;let f=h.tileID.canonical.x-a.tileID.canonical.x;const x=h.tileID.canonical.y-a.tileID.canonical.y,w=Math.pow(2,a.tileID.canonical.z),S=h.tileID.key;f===0&&x===0||Math.abs(x)>1||(Math.abs(f)>1&&(Math.abs(f+w)===1?f+=w:Math.abs(f-w)===1&&(f-=w)),h.dem&&a.dem&&(a.dem.backfillBorder(h.dem,f,x),a.neighboringTiles&&a.neighboringTiles[S]&&(a.neighboringTiles[S].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,o,a){for(const h in this._tiles){let f=this._tiles[h];if(a[h]||!f.hasData()||f.tileID.overscaledZ<=i||f.tileID.overscaledZ>o)continue;let x=f.tileID;for(;f&&f.tileID.overscaledZ>i+1;){const S=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[S.key],f&&f.hasData()&&(x=S)}let w=x;for(;w.overscaledZ>i;)if(w=w.scaledTo(w.overscaledZ-1),e[w.key]){a[x.key]=x;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const o=this._loadedParentTiles[e.key];return o&&o.tileID.overscaledZ>=i?o:null}for(let o=e.overscaledZ-1;o>=i;o--){const a=e.scaledTo(o),h=this._getLoadedTile(a);if(h)return h}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const o=Math.ceil(e.width/i)+1,a=Math.ceil(e.height/i)+1,h=Math.floor(o*a*5),f=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,h):h,x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(x)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const o={};for(const a in this._tiles){const h=this._tiles[a];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+i),o[h.tileID.key]=h}this._tiles=o;for(const a in this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(const a in this._tiles)this._setTileReloadTimer(+a,this._tiles[a])}}update(e,i,o,a){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!o)return;let h;if(this.updateCacheSize(e,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain){if(this._source.tileID)h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(w=>new jo(w.canonical.z,w.wrap,w.canonical.z,w.canonical.x,w.canonical.y));else if(this.tileCoverLift!==0){const w=e.clone();w.tileCoverLift=this.tileCoverLift,h=w.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&e.projection.name==="globe"&&(h.push(new jo(1,0,1,0,0)),h.push(new jo(1,0,1,1,0)),h.push(new jo(1,0,1,0,1)),h.push(new jo(1,0,1,1,1)))}else if(h=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile){const w=this._source.hasTile.bind(this._source);h=h.filter(S=>w(S))}}else h=[];if(h.length>0&&this.castsShadows&&a&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!D1(this._source.type)){const w=e.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!o}),S=Math.min(w,this._source.maxzoom),P=e.extendTileCoverForShadows(h,a,S);for(const R of P)this._shadowCasterTiles[R.key]=!0,h.push(R)}const f=this._updateRetainedTiles(h);if(D1(this._source.type)&&h.length!==0){const w={},S={},P=Object.keys(f);for(const B of P){const H=f[B],$=this._tiles[B];if(!$||$.fadeEndTime&&$.fadeEndTime<=Ao.now())continue;const te=this.findLoadedParent(H,Math.max(H.overscaledZ-wh.maxOverzooming,this._source.minzoom));te&&(this._addTile(te.tileID),w[te.tileID.key]=te.tileID),S[B]=H}const R=h[h.length-1].overscaledZ;for(const B in this._tiles){const H=this._tiles[B];if(f[B]||!H.hasData())continue;let $=H.tileID;for(;$.overscaledZ>R;){$=$.scaledTo($.overscaledZ-1);const te=this._tiles[$.key];if(te&&te.hasData()&&S[$.key]){f[B]=H.tileID;break}}}for(const B in w)f[B]||(this._coveredTiles[B]=!0,f[B]=w[B])}for(const w in f)this._tiles[w].clearFadeHold();const x=function(w,S){const P=[];for(const R in w)R in S||P.push(R);return P}(this._tiles,f);for(const w of x){const S=this._tiles[w];S.hasSymbolBuckets&&!S.holdingForFade()?S.setHoldDuration(this.map._fadeDuration):S.hasSymbolBuckets&&!S.symbolFadeFinished()||this._removeTile(+w)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(e.length===0)return i;const o={},a=e.reduce((S,P)=>Math.min(S,P.overscaledZ),1/0),h=e[0].overscaledZ,f=Math.max(h-wh.maxOverzooming,this._source.minzoom),x=Math.max(h+wh.maxUnderzooming,this._source.minzoom),w={};for(const S of e){const P=this._addTile(S);i[S.key]=S,P.hasData()||a<this._source.maxzoom&&(w[S.key]=S)}this._retainLoadedChildren(w,a,x,i);for(const S of e){let P=this._tiles[S.key];if(P.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const B=S.children(this._source.maxzoom)[0],H=this.getTile(B);if(H&&H.hasData()){i[B.key]=B;continue}}else{const B=S.children(this._source.maxzoom);if(i[B[0].key]&&i[B[1].key]&&i[B[2].key]&&i[B[3].key])continue}let R=P.wasRequested();for(let B=S.overscaledZ-1;B>=f;--B){const H=S.scaledTo(B);if(o[H.key]||(o[H.key]=!0,P=this.getTile(H),!P&&R&&(P=this._addTile(H)),P&&(i[H.key]=H,R=P.wasRequested(),P.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let o,a=this._tiles[e].tileID;for(;a.overscaledZ>0;){if(a.key in this._loadedParentTiles){o=this._loadedParentTiles[a.key];break}i.push(a.key);const h=a.scaledTo(a.overscaledZ-1);if(o=this._getLoadedTile(h),o)break;a=h}for(const h of i)this._loadedParentTiles[h]=o}}_addTile(e){let i=this._tiles[e.key];if(i)return i.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const o=!!i;if(!o){const a=this.map?this.map.painter:null,h=this._source.tileSize*e.overscaleFactor();i=this._source.type==="raster-array"?new iw(e,h,this.transform.tileZoom,a,this._isRaster):new og(e,h,this.transform.tileZoom,a,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,o||this._source.fire(new vs("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const o=i.getExpiryTimeout();o&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},o))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"||i.state==="empty"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,o){const a=[],h=this.transform;if(!h)return a;const f=h.projection.name==="globe",x=dc(h.center.lng);for(const w in this._tiles){const S=this._tiles[w];if(o&&S.clearQueryDebugViz(),S.holdingForFade())continue;let P;if(f){const R=S.tileID.canonical;if(R.z===0){const B=[Math.abs(Ki(x,...tp(R,-1))-x),Math.abs(Ki(x,...tp(R,1))-x)];P=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(Ki(x,...tp(R,-1))-x),Math.abs(Ki(x,...tp(R,0))-x),Math.abs(Ki(x,...tp(R,1))-x)];P=[B.indexOf(Math.min(...B))-1]}}else P=[0];for(const R of P){const B=e.containsTile(S,h,i,R);B&&a.push(B)}}return a}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,i){const o=this.getRenderableIds(e,i).map(h=>this._tiles[h].tileID),a=this.transform.projection.name==="globe";for(const h of o)h.projMatrix=this.transform.calculateProjMatrix(h.toUnwrapped()),h.expandedProjMatrix=a?this.transform.calculateProjMatrix(h.toUnwrapped(),!1,!0):h.projMatrix;return o}sortCoordinatesByDistance(e){const i=e.slice(),o=this.transform._camera.position,a=this.transform._camera.forward(),h={};for(const f of i){const x=1/(1<<f.canonical.z);h[f.key]=((f.canonical.x+.5)*x+f.wrap-o[0])*a[0]+((f.canonical.y+.5)*x-o[1])*a[1]-o[2]*a[2]}return i.sort((f,x)=>h[f.key]-h[x.key]),i}hasTransition(){if(this._source.hasTransition())return!0;if(D1(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=Ao.now())return!0}return!1}setFeatureState(e,i,o){this._state.updateState(e=e||"_geojsonTileLayer",i,o)}removeFeatureState(e,i,o){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,o)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,o){const a=this._tiles[e];a&&a.setDependencies(i,o)}reloadTilesForDependencies(e,i){for(const o in this._tiles)this._tiles[o].hasDependency(e,i)&&this._reloadTile(+o,"reloading");this._cache.filter(o=>!o.hasDependency(e,i))}_preloadTiles(e,i){if(!this._sourceLoaded){const x=()=>{this._sourceLoaded&&(this._source.off("data",x),this._preloadTiles(e,i))};return void this._source.on("data",x)}const o=new Map,a=Array.isArray(e)?e:[e],h=this.map.painter.terrain,f=this.usedForTerrain&&h?h.getScaledDemTileSize():this._source.tileSize;for(const x of a){const w=x.coveringTiles({tileSize:f,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const S of w)o.set(S.key,S);this.usedForTerrain&&x.updateElevation(!1)}ls(Array.from(o.values()),(x,w)=>{const S=new og(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(S,P=>{this._source.type==="raster-dem"&&S.dem&&this._backfillDEM(S),w(P,S)})},i)}}function nw(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||o-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function D1(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function tp(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}wh.maxOverzooming=10,wh.maxUnderzooming=3;const rw=new class extends li{possiblyEvaluate(t,e){return e=new $i(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,o){return e=An({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,o)}}(Um.paint.properties["line-width"].specification);function ow(t,e){return e>0?e+2*t:t}rw.useIntegerZoom=!0;const _A=new Wn({"symbol-placement":new It(lt.layout_symbol["symbol-placement"]),"symbol-spacing":new It(lt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new It(lt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new li(lt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new It(lt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new It(lt.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new It(lt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new It(lt.layout_symbol["icon-ignore-placement"]),"icon-optional":new It(lt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new It(lt.layout_symbol["icon-rotation-alignment"]),"icon-size":new li(lt.layout_symbol["icon-size"]),"icon-text-fit":new li(lt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new li(lt.layout_symbol["icon-text-fit-padding"]),"icon-image":new li(lt.layout_symbol["icon-image"]),"icon-rotate":new li(lt.layout_symbol["icon-rotate"]),"icon-padding":new It(lt.layout_symbol["icon-padding"]),"icon-keep-upright":new It(lt.layout_symbol["icon-keep-upright"]),"icon-offset":new li(lt.layout_symbol["icon-offset"]),"icon-anchor":new li(lt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new It(lt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new It(lt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new It(lt.layout_symbol["text-rotation-alignment"]),"text-field":new li(lt.layout_symbol["text-field"]),"text-font":new li(lt.layout_symbol["text-font"]),"text-size":new li(lt.layout_symbol["text-size"]),"text-max-width":new li(lt.layout_symbol["text-max-width"]),"text-line-height":new li(lt.layout_symbol["text-line-height"]),"text-letter-spacing":new li(lt.layout_symbol["text-letter-spacing"]),"text-justify":new li(lt.layout_symbol["text-justify"]),"text-radial-offset":new li(lt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new It(lt.layout_symbol["text-variable-anchor"]),"text-anchor":new li(lt.layout_symbol["text-anchor"]),"text-max-angle":new It(lt.layout_symbol["text-max-angle"]),"text-writing-mode":new It(lt.layout_symbol["text-writing-mode"]),"text-rotate":new li(lt.layout_symbol["text-rotate"]),"text-padding":new It(lt.layout_symbol["text-padding"]),"text-keep-upright":new It(lt.layout_symbol["text-keep-upright"]),"text-transform":new li(lt.layout_symbol["text-transform"]),"text-offset":new li(lt.layout_symbol["text-offset"]),"text-allow-overlap":new It(lt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new It(lt.layout_symbol["text-ignore-placement"]),"text-optional":new It(lt.layout_symbol["text-optional"]),visibility:new It(lt.layout_symbol.visibility)});var R1={paint:new Wn({"icon-opacity":new li(lt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new li(lt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new li(lt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new li(lt.paint_symbol["text-emissive-strength"]),"icon-color":new li(lt.paint_symbol["icon-color"]),"icon-halo-color":new li(lt.paint_symbol["icon-halo-color"]),"icon-halo-width":new li(lt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new li(lt.paint_symbol["icon-halo-blur"]),"icon-translate":new It(lt.paint_symbol["icon-translate"]),"icon-translate-anchor":new It(lt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new li(lt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new li(lt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new li(lt.paint_symbol["text-occlusion-opacity"]),"text-color":new li(lt.paint_symbol["text-color"],{runtimeType:Hs,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new li(lt.paint_symbol["text-halo-color"]),"text-halo-width":new li(lt.paint_symbol["text-halo-width"]),"text-halo-blur":new li(lt.paint_symbol["text-halo-blur"]),"text-translate":new It(lt.paint_symbol["text-translate"]),"text-translate-anchor":new It(lt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new It(lt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new It(lt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new It(lt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new It(lt.paint_symbol["icon-color-brightness-max"])}),layout:_A};class sw{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:na,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}xe(sw,"FormatSectionOverride",{omit:["defaultValue"]});class sg extends bs{constructor(e,i,o,a){super(e,R1,i,o,a),this._colorAdjustmentMatrix=r.ad.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const a=[];for(const h of o)a.indexOf(h)<0&&a.push(h);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,o,a){return this._saturation===e&&this._contrast===i&&this._brightnessMin===o&&this._brightnessMax===a||(this._colorAdjustmentMatrix=function(h,f,x,w){h=za(h),f=rl(f);const S=r.ad.create(),P=h/3,R=1-2*P,B=[R,P,P,0,P,R,P,0,P,P,R,0,0,0,0,1],H=.5-.5*f,$=w-x;return r.ad.multiply(S,[$,0,0,0,0,$,0,0,0,0,$,0,x,x,x,1],[f,0,0,0,0,f,0,0,0,0,f,0,H,H,H,1]),r.ad.multiply(S,S,B),S}(e,i,o,a),this._saturation=e,this._contrast=i,this._brightnessMin=o,this._brightnessMax=a),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,o,a){const h=this.layout.get(e).evaluate(i,{},o,a),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||le(f.value)||!h?h:function(x,w){return w.replace(/{([^{}]+)}/g,(S,P)=>P in x?String(x[P]):"")}(i.properties,h)}createBucket(e){return new vd(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of R1.paint.overridableProperties){if(!sg.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new sw(i),a=new ie(o,i.property.specification,this.scope,this.options);let h=null;h=i.value.kind==="constant"||i.value.kind==="source"?new me("source",a):new ge("composite",a,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new or(i.property,h,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&sg.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),a=R1.paint.properties[i];let h=!1;const f=x=>{for(const w of x)if(a.overrides&&a.overrides.hasOverride(w))return void(h=!0)};if(o.value.kind==="constant"&&o.value.value instanceof vo)f(o.value.value.sections);else if(o.value.kind==="source"){const x=S=>{h||(S instanceof Ha&&lo(S.value)===Ta?f(S.value.sections):S instanceof rc?f(S.sections):S.eachChild(x))},w=o.value;w._styleExpression&&x(w._styleExpression.expression)}return h}getProgramIds(){const e=this.paint.get("icon-opacity").constantOr(1)!==0,i=this.paint.get("text-opacity").constantOr(1)!==0,o=[];return e&&o.push("symbolIcon"),i&&o.push("symbolSDF"),o}getDefaultProgramParams(e,i,o){return{config:new fh(this,{zoom:i,lut:o}),overrideFog:!1}}}const yA=new Wn({visibility:new It(lt.layout_background.visibility)});var vA={paint:new Wn({"background-color":new It(lt.paint_background["background-color"]),"background-pattern":new It(lt.paint_background["background-pattern"]),"background-opacity":new It(lt.paint_background["background-opacity"]),"background-emissive-strength":new It(lt.paint_background["background-emissive-strength"])}),layout:yA};const xA=new Wn({visibility:new It(lt.layout_raster.visibility)});var wA={paint:new Wn({"raster-opacity":new It(lt.paint_raster["raster-opacity"]),"raster-color":new rs(lt.paint_raster["raster-color"]),"raster-color-mix":new It(lt.paint_raster["raster-color-mix"]),"raster-color-range":new It(lt.paint_raster["raster-color-range"]),"raster-hue-rotate":new It(lt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new It(lt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new It(lt.paint_raster["raster-brightness-max"]),"raster-saturation":new It(lt.paint_raster["raster-saturation"]),"raster-contrast":new It(lt.paint_raster["raster-contrast"]),"raster-resampling":new It(lt.paint_raster["raster-resampling"]),"raster-fade-duration":new It(lt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new It(lt.paint_raster["raster-emissive-strength"]),"raster-array-band":new It(lt.paint_raster["raster-array-band"]),"raster-elevation":new It(lt.paint_raster["raster-elevation"])}),layout:xA};function ag(t,e,i,o,a,h,f,x){const w=[t,e,1,i,o,1,a,h,1],S=[f,x,1],P=r.bC.adjoint([],w),[R,B,H]=r._.transformMat3(S,S,P);return r.bC.multiply(w,w,[R,0,0,0,B,0,0,0,H])}function aw(t,e,i,o,a,h,f,x){const w=function(S,P,R,B,H,$,te,ne){const de=ag(0,0,1,0,1,1,0,1),Se=ag(S,P,R,B,H,$,te,ne),Me=r.bC.adjoint([],de);return r.bC.multiply(Se,Se,Me)}(t,e,i,o,a,h,f,x);return[w[2]/w[8]/Zt,w[5]/w[8]/Zt]}function lg(t){return[t[0],Math.min(Math.max(t[1],-mo),mo)]}class lw extends al{constructor(e,i,o,a){super(),this.id=e,this.dispatcher=o,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new vs("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=L(this.map._requestManager.transformRequest(this.url,ea.Image),(o,a)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new qa(o)):a&&(this.image=a instanceof HTMLImageElement?Ao.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new ig(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new vs("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof ig||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],o=e[0][1];for(const h of e)h[1]>o&&(o=h[1]),h[1]<i&&(i=h[1]);const a=(o+i)/2;if(a>mo?this.onNorthPole=!0:a<-mo&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const h=e.map(Ls.fromLngLat);this.tileID=function(f){let x=1/0,w=1/0,S=-1/0,P=-1/0;for(const te of f)x=Math.min(x,te.x),w=Math.min(w,te.y),S=Math.max(S,te.x),P=Math.max(P,te.y);const R=Math.max(S-x,P-w),B=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),H=Math.pow(2,B);let $=Math.floor((x+S)/2*H);return $>1&&($-=1),new mh(B,$,Math.floor((w+P)/2*H))}(h),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new vs("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const ne in this.tiles){const de=this.tiles[ne];de.state!=="loaded"&&(de.state="loaded",de.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=vh(new mh(0,0,0),this.map.transform.projection),o=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(ne){const de=ne[1].x-ne[0].x,Se=ne[1].y-ne[0].y,Me=ne[2].x-ne[1].x,Le=ne[2].y-ne[1].y,ze=ne[3].x-ne[2].x,Fe=ne[3].y-ne[2].y,Xe=ne[0].x-ne[3].x,et=ne[0].y-ne[3].y,st=de*Le-Me*Se,_t=Me*Fe-ze*Le,dt=ze*et-Xe*Fe,St=Xe*Se-de*et;return st>0&&_t>0&&dt>0&&St>0||st<0&&_t<0&&dt<0&&St<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const a=vh(this.tileID,this.map.transform.projection),[h,f,x,w]=this.coordinates.map(ne=>{const de=a.projection.project(ne[0],ne[1]);return Ux(a,de)._round()});this.perspectiveTransform=aw(h.x,h.y,f.x,f.y,x.x,x.y,w.x,w.y);const S=this._boundsArray=new xu;S.emplaceBack(h.x,h.y,0,0),S.emplaceBack(f.x,f.y,Zt,0),S.emplaceBack(w.x,w.y,0,Zt),S.emplaceBack(x.x,x.y,Zt,Zt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(S,rg.members),this.boundsSegments=qr.simpleSegment(0,0,4,2);const P=[],R=function(ne){return[lg(ne[0]),lg(ne[1]),lg(ne[2]),lg(ne[3])]}(this.coordinates),[B,H,$,te]=function(ne){let de=ne[0][0],Se=de,Me=ne[0][1],Le=Me;for(let ze=1;ze<ne.length;ze++)ne[ze][0]<de?de=ne[ze][0]:ne[ze][0]>Se&&(Se=ne[ze][0]),ne[ze][1]<Me?Me=ne[ze][1]:ne[ze][1]>Le&&(Le=ne[ze][1]);return[de,Me,Se-de,Le-Me]}(R);{const ne=new xu,[de,Se,Me,Le]=function(yt){let Bt=yt[0].x,jt=Bt,zt=yt[0].y,ri=zt;for(let Ut=1;Ut<yt.length;Ut++)yt[Ut].x<Bt?Bt=yt[Ut].x:yt[Ut].x>jt&&(jt=yt[Ut].x),yt[Ut].y<zt?zt=yt[Ut].y:yt[Ut].y>ri&&(ri=yt[Ut].y);return[Bt,zt,jt-Bt,ri-zt]}(o),ze=yt=>[(yt.x-de)/Me,(yt.y-Se)/Le],[Fe,Xe,et,st]=o.map(ze),_t=function(yt,Bt,jt,zt,ri,Ut,Ht,Di){const Si=ag(0,0,1,0,1,1,0,1),Ci=ag(yt,Bt,jt,zt,ri,Ut,Ht,Di),qt=r.bC.adjoint([],Ci);return r.bC.multiply(Si,Si,qt)}(Fe[0],Fe[1],Xe[0],Xe[1],et[0],et[1],st[0],st[1]);this.elevatedGlobePerspectiveTransform=aw(Fe[0],Fe[1],Xe[0],Xe[1],et[0],et[1],st[0],st[1]);const dt=(yt,Bt)=>{P.push(yt.lng);const jt=Math.round((yt.lng-B)/$*Zt),zt=Math.round((yt.lat-H)/te*Zt),ri=ze(Bt),Ut=r._.transformMat3([],[ri[0],ri[1],1],_t),Ht=Math.round(Ut[0]/Ut[2]*Zt),Di=Math.round(Ut[1]/Ut[2]*Zt);ne.emplaceBack(jt,zt,Ht,Di)},St=o[3].x-o[0].x,Vt=o[3].y-o[0].y,bt=o[2].x-o[1].x,kt=o[2].y-o[1].y;for(let yt=0;yt<65;yt++){const Bt=yt/64,jt=[o[0].x+Bt*St,o[0].y+Bt*Vt],zt=[o[1].x+Bt*bt,o[1].y+Bt*kt],ri=zt[0]-jt[0],Ut=zt[1]-jt[1];for(let Ht=0;Ht<65;Ht++){const Di=Ht/64,Si={x:jt[0]+ri*Di,y:jt[1]+Ut*Di,z:0};dt(i.projection.unproject(Si.x,Si.y),Si)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(ne,rg.members)}{this.maxLongitudeTriangleSize=0;let ne=[],de=new ss;const Se=(Me,Le,ze)=>{de.emplaceBack(Me,Le,ze);const Fe=P[Me],Xe=P[Le],et=P[ze],st=Math.min(Math.min(Fe,Xe),et),_t=Math.max(Math.max(Fe,Xe),et)-st;_t>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=_t),ne.push(st+_t/2)};for(let Me=0;Me<64;Me++)for(let Le=0;Le<64;Le++){const ze=65*Me+Le,Fe=ze+1,Xe=ze+65,et=Xe+1;Se(ze,Xe,Fe),Se(Fe,Xe,et)}[ne,de]=function(Me,Le){const ze=Array.from({length:Me.length},(et,st)=>st);ze.sort((et,st)=>Me[et]-Me[st]);const Fe=[],Xe=new ss;for(let et=0;et<ze.length;et++){const st=ze[et];Fe.push(Me[st]);const _t=3*st,dt=_t+1;Xe.emplaceBack(Le.uint16[_t],Le.uint16[dt],Le.uint16[dt+1])}return[Fe,Xe]}(ne,de),this.elevatedGlobeTrianglesCenterLongitudes=ne,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(de)}this.elevatedGlobeSegments=qr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,$/Zt,0,te/Zt,0,0,H,B,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,o=i.gl;!this._dirty||this.texture instanceof ig||(this.texture?this.texture.update(this.image):(this.texture=new dl(i,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const o=this.elevatedGlobeTrianglesCenterLongitudes;let a=(h=e+180)+360*Math.round((o[0]-h)/360);var h;const f=new qr,x=(R,B)=>{f.segments.push({vertexOffset:0,primitiveOffset:R,vertexLength:i.segments[0].vertexLength,primitiveLength:B,sortKey:void 0,vaos:{}})},w=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-a)<=w){const R=bl(o,0,o.length,a+w);return R===o.length||x(R,Yl(o,R+1,o.length,a+360-w)-R),f}a<o[0]&&(a+=360);const S=Yl(o,0,o.length,a-w);if(S===o.length)return x(0,o.length),f;x(0,S-0);const P=bl(o,S+1,o.length,a+w);return P!==o.length&&x(P,o.length-P),f}}const bA=(Math.pow(256,2)-1)/16907520;class cw extends bs{constructor(e,i,o,a){super(e,wA,i,o,a),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof lw&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[o,a]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(a)||o===this._curRampRange[0]&&a===this._curRampRange[1]||(this.colorRamp=Bf({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:a}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,a])}}const CA=new Wn({visibility:new It(lt["layout_raster-particle"].visibility)});var EA={paint:new Wn({"raster-particle-array-band":new It(lt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new It(lt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new rs(lt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new It(lt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new It(lt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new It(lt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new It(lt["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:CA};class uw extends bs{constructor(e,i,o,a){super(e,EA,i,o,a),this._updateColorRamp(),this.lastInvalidatedAt=Ao.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Bf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ao.now()}}class TA extends bs{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const SA=new Wn({visibility:new It(lt.layout_sky.visibility)});var AA={paint:new Wn({"sky-type":new It(lt.paint_sky["sky-type"]),"sky-atmosphere-sun":new It(lt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new It(lt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new It(lt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new It(lt.paint_sky["sky-gradient-radius"]),"sky-gradient":new rs(lt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new It(lt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new It(lt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new It(lt.paint_sky["sky-opacity"])}),layout:SA};function k1(t,e,i){const o=[0,0,1],a=r.av.identity([]);return r.av.rotateY(a,a,i?-nn(t)+Math.PI:nn(t)),r.av.rotateX(a,a,-nn(e)),r._.transformQuat(o,o,a),r._.normalize(o,o)}var IA={paint:new Wn({})};function hw(t,e){const i=cg(t.projection,t.zoom,t.width,t.height),o=function(h,f,x,w,S){const P=new Vn(x.lng-180*Fu,x.lat),R=new Vn(x.lng+180*Fu,x.lat),B=h.project(P.lng,P.lat),H=h.project(R.lng,R.lat),$=-Math.atan2(H.y-B.y,H.x-B.x),te=Ls.fromLngLat(x);te.y=Ki(te.y,-1+Fu,1-Fu);const ne=te.toLngLat(),de=h.project(ne.lng,ne.lat),Se=Ls.fromLngLat(ne);Se.x+=Fu;const Me=Se.toLngLat(),Le=h.project(Me.lng,Me.lat),ze=pw(Le.x-de.x,Le.y-de.y,$),Fe=Ls.fromLngLat(ne);Fe.y+=Fu;const Xe=Fe.toLngLat(),et=h.project(Xe.lng,Xe.lat),st=pw(et.x-de.x,et.y-de.y,$),_t=Math.abs(ze.x)/Math.abs(st.y),dt=r.ad.identity([]);r.ad.rotateZ(dt,dt,-$*(1-(S?0:w)));const St=r.ad.identity([]);return r.ad.scale(St,St,[1,1-(1-_t)*w,1]),St[4]=-st.x/st.y*w,r.ad.rotateZ(St,St,$),r.ad.multiply(St,dt,St),St}(t.projection,0,t.center,i,e),a=dw(t);return r.ad.scale(o,o,[a,a,1]),o}function dw(t){const e=t.projection,i=cg(t.projection,t.zoom,t.width,t.height),o=fw(e,t.center),a=fw(e,Vn.convert(e.center));return Math.pow(2,o*i+(1-i)*a)}function cg(t,e,i,o,a=1/0){const h=t.range;if(!h)return 0;const f=Math.min(a,Math.max(i,o)),x=Math.log(f/1024)/Math.LN2;return il(h[0]+x,h[1]+x,e)}const Fu=1/4e4;function fw(t,e){const i=Ki(e.lat,-mo,mo),o=new Vn(e.lng-180*Fu,i),a=new Vn(e.lng+180*Fu,i),h=t.project(o.lng,i),f=t.project(a.lng,i),x=Ls.fromLngLat(o),w=Ls.fromLngLat(a),S=f.x-h.x,P=f.y-h.y,R=w.x-x.x,B=w.y-x.y,H=Math.sqrt((R*R+B*B)/(S*S+P*P));return Math.log(H)/Math.LN2}function pw(t,e,i){const o=Math.cos(i),a=Math.sin(i);return{x:t*o-e*a,y:t*a+e*o}}function mw(t,e,i){r.ad.identity(t),r.ad.rotateZ(t,t,nn(e[2])),r.ad.rotateX(t,t,nn(e[0])),r.ad.rotateY(t,t,nn(e[1])),r.ad.scale(t,t,i),r.ad.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function ug(t,e,i,o,a,h,f,x){const w=[i[0]-e[0],i[1]-e[1],0],S=[o[0]-e[0],o[1]-e[1],0];if(r._.length(w)<1e-12||r._.length(S)<1e-12)return r.av.identity(t);const P=r._.cross([],w,S);r._.normalize(P,P),r._.subtract(S,o,e),w[2]=(h-a)*x,S[2]=(f-a)*x;const R=w;return r._.cross(R,w,S),r._.normalize(R,R),r.av.rotationTo(t,P,R)}function B1(t,e,i=!1){const o=Wc(e.zoom),a=function(h,f,x){const w=f.worldSize,S=[h[12],h[13],h[14]],P=hs(S[1]/w),R=ca(S[0]/w),B=r.ad.identity([]),H=Xs(1,P)*w,$=Xs(1,0)*w*gh(P,f.zoom),te=1/e1(w);let ne=$*te;if(x){const Le=cg(f.projection,f.zoom,f.width,f.height,1024);ne=te*f.projection.pixelSpaceConversion(f.center.lat,w,Le)}const de=ph(P,R);r._.add(de,de,r._.scale([],r._.normalize([],de),H*ne*S[2]));const Se=function(Le){const ze=[Le[0],Le[1],Le[2]];let Fe=[0,1,0];const Xe=r._.cross([],Fe,ze);return r._.cross(Fe,ze,Xe),r._.squaredLength(Fe)===0&&(Fe=[0,1,0],r._.cross(Xe,ze,Fe)),r._.normalize(Xe,Xe),r._.normalize(Fe,Fe),r._.normalize(ze,ze),[Xe[0],Xe[1],Xe[2],0,Fe[0],Fe[1],Fe[2],0,ze[0],ze[1],ze[2],0,Le[0],Le[1],Le[2],1]}(de);r.ad.scale(B,B,[ne,ne,ne*H]),r.ad.translate(B,B,[-S[0],-S[1],-S[2]]);const Me=r.ad.multiply([],f.globeMatrix,Se);return r.ad.multiply(Me,Me,B),r.ad.multiply(Me,Me,h),Me}(t,e,i);if(o>0){const h=function(f,x){const w=x.worldSize,S=Xs(1,0)*w*gh(x.center.lat,x.zoom)/e1(w),P=Xs(1,x.center.lat)*w,R=r.ad.identity([]);return r.ad.rotateY(R,R,nn(x.center.lng)),r.ad.rotateX(R,R,nn(x.center.lat)),r.ad.translate(R,R,[0,0,Zs]),r.ad.scale(R,R,[S,S,S*P]),r.ad.translate(R,R,[x.point.x-.5*w,x.point.y-.5*w,0]),r.ad.multiply(R,R,f),r.ad.multiply(R,x.globeMatrix,R)}(t,e);return function(f,x,w){const S=($,te,ne)=>{const de=r._.length($),Se=r._.length(te),Me=Gc($,te,ne);return r._.scale(Me,Me,1/r._.length(Me)*Fi(de,Se,ne))},P=S([f[0],f[1],f[2]],[x[0],x[1],x[2]],w),R=S([f[4],f[5],f[6]],[x[4],x[5],x[6]],w),B=S([f[8],f[9],f[10]],[x[8],x[9],x[10]],w),H=Gc([f[12],f[13],f[14]],[x[12],x[13],x[14]],w);return[P[0],P[1],P[2],0,R[0],R[1],R[2],0,B[0],B[1],B[2],0,H[0],H[1],H[2],1]}(a,h,o)}return a}function gw(t,e,i,o){const a=Nr.projectAabbCorners(o,i);let h=Number.MAX_VALUE,f=-1;for(let S=0;S<a.length;++S){const P=a[S];P[0]=(.5*P[0]+.5)*e.width,P[1]=(.5-.5*P[1])*e.height,P[2]<h&&(f=S,h=P[2])}const x=S=>new Yt(a[S][0],a[S][1]);let w;switch(f){case 0:case 6:w=[x(1),x(5),x(4),x(7),x(3),x(2),x(1)];break;case 1:case 7:w=[x(0),x(4),x(5),x(6),x(2),x(3),x(0)];break;case 3:case 5:w=[x(1),x(0),x(4),x(7),x(6),x(2),x(1)];break;default:w=[x(1),x(5),x(6),x(7),x(3),x(0),x(1)]}if(H0(t,w))return h}const MA=Yn([{name:"a_pos_3f",components:3,type:"Float32"}]),LA=Yn([{name:"a_color_3f",components:3,type:"Float32"}]),OA=Yn([{name:"a_color_4f",components:4,type:"Float32"}]),PA=Yn([{name:"a_uv_2f",components:2,type:"Float32"}]),DA=Yn([{name:"a_normal_3f",components:3,type:"Float32"}]),RA=Yn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),kA=Yn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class hg{constructor(e,i,o,a){this.message=(e?`${e}: `:"")+o,a&&(this.identifier=a),i!=null&&i.__line__&&(this.line=i.__line__)}}function _w(t,e){const i=t.indexOf("://")===-1;try{return new URL(t,i&&e?"http://example.com":void 0),!0}catch{return!1}}class yw{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class vw{constructor(){this.instancedDataArray=new A0,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class N1{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,i){}populate(e,i,o,a){this.tileToMeter=xm(o);const h=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:f,id:x,index:w,sourceLayerIndex:S}of e){const P=x??(f.properties&&f.properties.hasOwnProperty("id")?f.properties.id:void 0),R=Hc(f,h);if(!this.layers[0]._featureFilter.filter(new $i(this.zoom),R,o))continue;const B={id:P,sourceLayerIndex:S,index:w,geometry:h?R.geometry:Dl(f,o,a),properties:f.properties,type:f.type,patterns:{}},H=this.addFeature(B,B.geometry,R);H&&i.featureIndex.insert(f,B.geometry,w,S,this.index,this.instancesPerModel[H].instancedDataArray.length,Zt/32)}this.lookup=null}update(e,i,o,a){for(const h in this.instancesPerModel){const f=this.instancesPerModel[h];for(const x in e)f.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(f.features[f.idToFeaturesIndex[x]],e[x],f,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];for(const a of o.features){const h=this.layers[0],f=a.feature,x=this.canonical,w=h.paint.get("model-rotation").evaluate(f,{},x),S=h.paint.get("model-scale").evaluate(f,{},x),P=h.paint.get("model-translation").evaluate(f,{},x);r._.exactEquals(a.rotation,w)&&r._.exactEquals(a.scale,S)&&r._.exactEquals(a.translation,P)||(this.evaluate(a,a.featureStates,o,!0),e=!0)}}return e}updateReplacement(e,i,o){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(u1(this.activeReplacements,a))return!1;this.activeReplacements=a;let h=!1;for(const f in this.instancesPerModel){const x=this.instancesPerModel[f],w=x.instancedDataArray;for(const S of x.features){const P=S.instancedDataOffset,R=S.instancedDataCount;for(let B=0;B<R;B++){const H=16*(B+P);let $=w.float32[H+0];$=$>Zt?$-Zt:$;const te=Math.floor($),ne=w.float32[H+1];let de=!1;for(const Se of this.activeReplacements)if(!(Se.order<o||Se.order===1/0)&&Se.clipMask&Fv.Model&&!(Se.min.x>te||te>Se.max.x||Se.min.y>ne||ne>Se.max.y)&&(de=Lv(Mv(te,ne,e.canonical,Se.footprintTileId.canonical),Se),de))break;w.float32[H]=de?$+Zt:$,h=h||de}}}return h}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,RA.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const i of this.modelUris)e.removeModel(i,"")}addFeature(e,i,o){const a=this.layers[0],h=a.layout.get("model-id").evaluate(o,{},this.canonical);if(!h)return Dr(`modelId is not evaluated for layer ${a.id} and it is not going to get rendered.`),h;_w(h,!1)&&(this.modelUris.includes(h)||this.modelUris.push(h)),this.instancesPerModel[h]||(this.instancesPerModel[h]=new vw);const f=this.instancesPerModel[h],x=f.instancedDataArray,w=new yw(o,x.length);for(const S of i)for(const P of S){if(P.x<0||P.x>=Zt||P.y<0||P.y>=Zt)continue;const R=(this.lookupDim-1)/Zt,B=this.lookupDim*(P.y*R|0)+P.x*R|0;if(this.lookup){if(this.lookup[B]!==0)continue;this.lookup[B]=1}this.instanceCount++;const H=x.length;x.resize(H+1),f.instancesEvaluatedElevation.push(0),x.float32[16*H]=P.x,x.float32[16*H+1]=P.y}return w.instancedDataCount=f.instancedDataArray.length-w.instancedDataOffset,w.instancedDataCount>0&&(e.id&&(f.idToFeaturesIndex[e.id]=f.features.length),f.features.push(w),this.evaluate(w,{},f,!1)),h}getModelUris(){return this.modelUris}evaluate(e,i,o,a){const h=this.layers[0],f=e.feature,x=this.canonical,w=e.rotation=h.paint.get("model-rotation").evaluate(f,i,x),S=e.scale=h.paint.get("model-scale").evaluate(f,i,x),P=e.translation=h.paint.get("model-translation").evaluate(f,i,x),R=h.paint.get("model-color").evaluate(f,i,x);R.a=h.paint.get("model-color-mix-intensity").evaluate(f,i,x);const B=[];this.maxVerticalOffset<P[2]&&(this.maxVerticalOffset=P[2]),this.maxScale=Math.max(Math.max(this.maxScale,S[0]),Math.max(S[1],S[2])),mw(B,w,S);const H=Math.round(100*R.a)+R.b/1.05;for(let $=0;$<e.instancedDataCount;++$){const te=e.instancedDataOffset+$,ne=16*te,de=o.instancedDataArray.float32;let Se=0;a&&(Se=de[ne+6]-o.instancesEvaluatedElevation[te]);const Me=0|de[ne+1];de[ne]=(0|de[ne])+R.r/1.05,de[ne+1]=Me+R.g/1.05,de[ne+2]=H,de[ne+3]=1/(x.z>10?this.tileToMeter:xm(x,Me)),de[ne+4]=P[0],de[ne+5]=P[1],de[ne+6]=P[2]+Se,de[ne+7]=B[0],de[ne+8]=B[1],de[ne+9]=B[2],de[ne+10]=B[4],de[ne+11]=B[5],de[ne+12]=B[6],de[ne+13]=B[8],de[ne+14]=B[9],de[ne+15]=B[10],o.instancesEvaluatedElevation[te]=P[2]}}}xe(N1,"ModelBucket",{omit:["layers"]}),xe(vw,"PerModelAttributes"),xe(yw,"ModelFeature");const BA=new Wn({visibility:new It(lt.layout_model.visibility),"model-id":new li(lt.layout_model["model-id"])});var NA={paint:new Wn({"model-opacity":new It(lt.paint_model["model-opacity"]),"model-rotation":new li(lt.paint_model["model-rotation"]),"model-scale":new li(lt.paint_model["model-scale"]),"model-translation":new li(lt.paint_model["model-translation"]),"model-color":new li(lt.paint_model["model-color"]),"model-color-mix-intensity":new li(lt.paint_model["model-color-mix-intensity"]),"model-type":new It(lt.paint_model["model-type"]),"model-cast-shadows":new It(lt.paint_model["model-cast-shadows"]),"model-receive-shadows":new It(lt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new It(lt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new li(lt.paint_model["model-emissive-strength"]),"model-roughness":new li(lt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new li(lt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new It(lt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new It(lt.paint_model["model-front-cutoff"])}),layout:BA};const bh=64,bd={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function xw(t,e,i,o,a,h,f,x,w,S=!1){const P=i.zoom,R=i.project(o),B=gh(o.lat,P),H=1/B;r.ad.identity(t),r.ad.translate(t,t,[R.x+f[0]*H,R.y+f[1]*H,f[2]]);let $=1,te=1;const ne=i.worldSize;if(S){if(i.projection.name==="mercator"){let Le=0;i.elevation&&(Le=i.elevation.getAtPointOrZero(new Ls(R.x/ne,R.y/ne),0));const ze=r.aA.transformMat4([],[R.x,R.y,Le,1],i.projMatrix)[3]/i.cameraToCenterDistance;$=ze,te=ze*gh(i.center.lat,P)}else if(i.projection.name==="globe"){const Le=B1(t,i),ze=r.ad.multiply([],i.projMatrix,Le),Fe=[0,0,0,1];r.aA.transformMat4(Fe,Fe,ze);const Xe=Fe[3]/i.cameraToCenterDistance,et=Wc(P),st=i.projection.pixelsPerMeter(o.lat,ne)*gh(o.lat,P),_t=i.projection.pixelsPerMeter(i.center.lat,ne)*gh(i.center.lat,P);$=Xe/Fi(st,Fy(i.center.lat),et),te=Xe*B/st,$*=_t,te*=_t}}else $=H;r.ad.scale(t,t,[$,$,te]);const de=[...t],Se=e.orientation,Me=[];if(mw(Me,[Se[0]+a[0],Se[1]+a[1],Se[2]+a[2]],h),r.ad.multiply(t,de,Me),x&&i.elevation){let Le=0;const ze=[];if(w&&i.elevation){Le=function(et,st,_t,dt,St){const Vt=st.elevation;if(!Vt)return 0;const bt=Nr.projectAabbCorners(_t,dt),kt=Xs(1,St.lat)*st.worldSize,yt=function(Ni,cn){const Gi=[0,0,1],mn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const un of mn){const xn=Ni[un.corners[0]],qi=Ni[un.corners[1]],ur=Ni[un.corners[2]],sr=[qi[0]-xn[0],qi[1]-xn[1],cn*(qi[2]-xn[2])],jn=r._.cross(sr,sr,[ur[0]-xn[0],ur[1]-xn[1],cn*(ur[2]-xn[2])]);r._.normalize(jn,jn),un.dotProductWithUp=r._.dot(jn,Gi)}return mn.sort((un,xn)=>un.dotProductWithUp-xn.dotProductWithUp),mn[0].corners}(bt,kt),Bt=bt[yt[0]],jt=bt[yt[1]],zt=bt[yt[2]],ri=bt[yt[3]],Ut=Vt.getAtPointOrZero(new Ls(Bt[0]/st.worldSize,Bt[1]/st.worldSize),0),Ht=Vt.getAtPointOrZero(new Ls(jt[0]/st.worldSize,jt[1]/st.worldSize),0),Di=Vt.getAtPointOrZero(new Ls(zt[0]/st.worldSize,zt[1]/st.worldSize),0),Si=Vt.getAtPointOrZero(new Ls(ri[0]/st.worldSize,ri[1]/st.worldSize),0),Ci=(Ut+Si)/2,qt=(Ht+Di)/2;return Ci>qt?Ht<Di?ug(et,jt,ri,Bt,Ht,Si,Ut,kt):ug(et,zt,Bt,ri,Di,Ut,Si,kt):Ut<Si?ug(et,Bt,jt,zt,Ut,Ht,Di,kt):ug(et,ri,zt,jt,Si,Di,Ht,kt),Math.max(Ci,qt)}(ze,i,e.aabb,t,o);const Fe=r.ad.fromQuat([],ze),Xe=r.ad.multiply([],Fe,Me);r.ad.multiply(t,de,Xe)}else Le=i.elevation.getAtPointOrZero(new Ls(R.x/ne,R.y/ne),0);Le!==0&&(t[14]+=Le)}}function ip(t,e,i=!1){t.uploaded||(t.gfxTexture=new dl(e,t.image,i?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function FA(t,e,i){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,MA.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,DA.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,PA.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?LA:OA).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,kA.members,!0)),t.segments=qr.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const o=t.material;o.pbrMetallicRoughness.baseColorTexture&&ip(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&ip(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&ip(o.normalTexture,e),o.occlusionTexture&&ip(o.occlusionTexture,e,i),o.emissionTexture&&ip(o.emissionTexture,e)}function F1(t,e,i){if(t.meshes)for(const o of t.meshes)FA(o,e,i);if(t.children)for(const o of t.children)F1(o,e,i)}function dg(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)dg(e)}function z1(t){if(t.meshes)for(const i of t.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const i of t.children)z1(i)}class zA{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class VA{constructor(){this.tasks={},this.taskQueue=[],On(["process"],this),this.invoker=new zA(this.process),this.nextId=0}add(e,i){const o=this.nextId++,a=function({type:h,isSymbolTile:f,zoom:x}){return x=x||0,h==="message"?0:h!=="maybePrepare"||f?h!=="parseTile"||f?h==="parseTile"&&f?300-x:h==="maybePrepare"&&f?400-x:500:200-x:100-x}(i);if(a===0){try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:i,priority:a,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let a=0;a<this.taskQueue.length;a++){const h=this.tasks[this.taskQueue[a]];h.priority<i&&(i=h.priority,e=a)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class ww{constructor(e,i,o){this.target=e,this.parent=i,this.mapId=o,this.callbacks={},this.cancelCallbacks={},On(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new VA}send(e,i,o,a,h=!1,f){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=f,this.callbacks[x]=o);const w=new Set;return this.target.postMessage({id:x,type:e,hasCallback:!!o,targetMapId:a,mustQueue:h,sourceMapId:this.mapId,data:ct(i,w)},w),{cancel:()=>{o&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(e){const i=e.data,o=i.id;if(o&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const a=this.cancelCallbacks[o];delete this.cancelCallbacks[o],a&&a.cancel()}else if(i.mustQueue||Mr()){const a=this.callbacks[o],h=this.scheduler.add(()=>this.processTask(o,i),a&&a.metadata||{type:"message"});h&&(this.cancelCallbacks[o]=h)}else this.processTask(o,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const o=this.callbacks[e];delete this.callbacks[e],o&&(i.error?o(it(i.error)):o(null,it(i.data)))}else{const o=new Set,a=i.hasCallback?(f,x)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?ct(f):null,data:ct(x,o)},o)}:f=>{},h=it(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,h,a);else if(this.parent.getWorkerSource){const f=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,f[0],h.source,h.scope)[f[1]](h,a)}else a(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Cd{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=va();const o=this.workerPool.acquire(this.id);for(let a=0;a<o.length;a++){const h=new Cd.Actor(o[a],i,this.id);h.name=`Worker ${a}`,this.actors.push(h)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,o){ls(this.actors,(a,h)=>{a.send(e,i,h)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}Cd.Actor=ww;var np={workerUrl:"",workerClass:null,workerParams:void 0};function UA(){return np.workerClass!=null?new np.workerClass:new self.Worker(np.workerUrl,np.workerParams)}const V1="mapboxgl_preloaded_worker_pool";class rp{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<rp.workerCount;)this.workers.push(new UA);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[V1]}numActive(){return Object.keys(this.active).length}}let op;function fg(){return op||(op=new rp),op}rp.workerCount=2;let pg,U1,zl,Ed,j1,Td=null;function bw(){return Mr()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:U1||Y.DRACO_URL}function Cw(){if(Mr()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Ed)return Ed;const t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Ed=WebAssembly.validate(t)?Y.MESHOPT_SIMD_URL:Y.MESHOPT_URL,Ed}const mg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},jA={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},sp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Ew(t,e,i){const o=i.json.bufferViews.length,a=i.buffers.length;e.bufferView=o,i.json.bufferViews[o]={buffer:a,byteLength:t.byteLength},i.buffers[a]=t}const q1="KHR_draco_mesh_compression";function qA(t,e){const i=t.extensions&&t.extensions[q1];if(!i)return;const o=new zl.Decoder,a=Iw(e,i.bufferView),h=new zl.Mesh;if(!o.DecodeArrayToMesh(a,a.byteLength,h))throw new Error("Failed to decode Draco mesh");const f=e.json.accessors[t.indices],x=mg[f.componentType],w=f.count*x.BYTES_PER_ELEMENT,S=zl._malloc(w);x===Uint16Array?o.GetTrianglesUInt16Array(h,w,S):o.GetTrianglesUInt32Array(h,w,S),Ew(zl.memory.buffer.slice(S,S+w),f,e),zl._free(S);for(const P of Object.keys(i.attributes)){const R=o.GetAttributeByUniqueId(h,i.attributes[P]),B=e.json.accessors[t.attributes[P]],H=jA[B.componentType],$=B.count*sp[B.type]*mg[B.componentType].BYTES_PER_ELEMENT,te=zl._malloc($);o.GetAttributeDataArrayForAllPoints(h,R,zl[H],$,te),Ew(zl.memory.buffer.slice(te,te+$),B,e),zl._free(te)}o.destroy(),h.destroy(),delete t.extensions[q1]}const gg="EXT_meshopt_compression";function HA(t,e){if(!t.extensions||!t.extensions[gg])return;const i=t.extensions[gg],o=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),a=new Uint8Array(i.count*i.byteStride);j1.decodeGltfBuffer(a,i.count,i.byteStride,o,i.mode,i.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=a.buffer,delete t.extensions[gg]}const Tw=1179937895,Sw=new TextDecoder("utf8");function Aw(t,e){return new URL(t,e).href}function GA(t,e,i,o){return fetch(Aw(t.uri,o)).then(a=>a.arrayBuffer()).then(a=>{e.buffers[i]=a})}function Iw(t,e){const i=t.json.bufferViews[e];return new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function WA(t,e,i,o){if(t.uri){const a=Aw(t.uri,o);return fetch(a).then(h=>h.blob()).then(h=>createImageBitmap(h)).then(h=>{e.images[i]=h})}if(t.bufferView!==void 0){const a=Iw(e,t.bufferView),h=new Blob([a],{type:t.mimeType});return createImageBitmap(h).then(f=>{e.images[i]=f})}}function Mw(t,e=0,i){const o={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===Tw){const P=new Uint32Array(t,e);let R=2;const B=(P[R++]>>2)-3,H=P[R++]>>2;if(R++,o.json=JSON.parse(Sw.decode(P.subarray(R,R+H))),R+=H,R<B){const $=P[R++];R++;const te=e+(R<<2);o.buffers[0]=t.slice(te,te+$)}}else o.json=JSON.parse(Sw.decode(new Uint8Array(t,e)));const{buffers:a,images:h,meshes:f,extensionsUsed:x,bufferViews:w}=o.json;let S=Promise.resolve();if(a){const P=[];for(let R=0;R<a.length;R++){const B=a[R];B.uri?P.push(GA(B,o,R,i)):o.buffers[R]||(o.buffers[R]=null)}S=Promise.all(P)}return S.then(()=>{const P=[],R=x&&x.includes(q1),B=x&&x.includes(gg);if(R&&P.push(function(){if(!zl)return pg||(pg=function(H){let $,te=null;function ne(){$=new Uint8Array(te.buffer)}function de(){throw new Error("Unexpected Draco error.")}const Se={a:{a:de,d:function(Me,Le,ze){return $.copyWithin(Me,Le,Le+ze)},c:function(Me){const Le=$.length,ze=Math.max(Me>>>0,Math.ceil(1.2*Le)),Fe=Math.ceil((ze-Le)/65536);try{return te.grow(Fe),ne(),!0}catch{return!1}},b:de}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(H,Se):H.then(Me=>Me.arrayBuffer()).then(Me=>WebAssembly.instantiate(Me,Se))).then(Me=>{const{Rb:Le,Qb:ze,P:Fe,T:Xe,X:et,Ja:st,La:_t,Qa:dt,Va:St,Wa:Vt,eb:bt,jb:kt,f:yt,e:Bt,yb:jt,zb:zt,Ab:ri,Bb:Ut,Db:Ht,Gb:Di}=Me.instance.exports;te=Bt;const Si=(()=>{let Ci=0,qt=0,Ni=0,cn=0;return Gi=>{Ni&&(Le(cn),Le(Ci),qt+=Ni,Ni=Ci=0),Ci||(qt+=128,Ci=ze(qt));const mn=Gi.length+7&-8;let un=Ci;mn>=qt&&(Ni=mn,un=cn=ze(mn));for(let xn=0;xn<Gi.length;xn++)$[un+xn]=Gi[xn];return un}})();return ne(),yt(),{memory:Bt,_free:Le,_malloc:ze,Mesh:class{constructor(){this.ptr=Fe()}destroy(){Xe(this.ptr)}},Decoder:class{constructor(){this.ptr=st()}destroy(){kt(this.ptr)}DecodeArrayToMesh(Ci,qt,Ni){const cn=Si(Ci),Gi=_t(this.ptr,cn,qt,Ni.ptr);return!!et(Gi)}GetAttributeByUniqueId(Ci,qt){return{ptr:dt(this.ptr,Ci.ptr,qt)}}GetTrianglesUInt16Array(Ci,qt,Ni){St(this.ptr,Ci.ptr,qt,Ni)}GetTrianglesUInt32Array(Ci,qt,Ni){Vt(this.ptr,Ci.ptr,qt,Ni)}GetAttributeDataArrayForAllPoints(Ci,qt,Ni,cn,Gi){bt(this.ptr,Ci.ptr,qt.ptr,Ni,cn,Gi)}},DT_INT8:jt(),DT_UINT8:zt(),DT_INT16:ri(),DT_UINT16:Ut(),DT_UINT32:Ht(),DT_FLOAT32:Di()}})}(fetch(bw())),pg.then(H=>{zl=H,pg=void 0}))}()),B&&P.push(function(){if(j1)return;const H=function($){let te;const ne=WebAssembly.instantiateStreaming($,{}).then(Me=>{te=Me.instance,te.exports.__wasm_call_ctors()}),de={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Se={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:ne,supported:!0,decodeGltfBuffer(Me,Le,ze,Fe,Xe,et){(function(st,_t,dt,St,Vt,bt,kt){const yt=st.exports.sbrk,Bt=St+3&-4,jt=yt(Bt*Vt),zt=yt(bt.length),ri=new Uint8Array(st.exports.memory.buffer);ri.set(bt,zt);const Ut=_t(jt,St,Vt,zt,bt.length);if(Ut===0&&kt&&kt(jt,Bt,Vt),dt.set(ri.subarray(jt,jt+St*Vt)),yt(jt-yt(0)),Ut!==0)throw new Error(`Malformed buffer data: ${Ut}`)})(te,te.exports[Se[Xe]],Me,Le,ze,Fe,te.exports[de[et]])}}}(fetch(Cw()));return H.ready.then(()=>{j1=H})}()),h)for(let H=0;H<h.length;H++)P.push(WA(h[H],o,H,i));return(P.length?Promise.all(P):Promise.resolve()).then(()=>{if(R&&f)for(const{primitives:H}of f)for(const $ of H)qA($,o);if(B&&f&&w)for(const H of w)HA(H,o);return o})})}function Ch(t,e){const i=t.json.bufferViews[e.bufferView],o=mg[e.componentType];return new o(t.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==sp[e.type]*o.BYTES_PER_ELEMENT?i.byteStride/o.BYTES_PER_ELEMENT:sp[e.type]))}function H1(t,e,i,o){const a=mg[e.componentType],h=function(P){switch(P){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(a),f=t.json.bufferViews[e.bufferView],x=f.byteStride?f.byteStride/a.BYTES_PER_ELEMENT:sp[e.type],w=i.float32,S=w.length/i.capacity;for(let P=0,R=0;P<e.count*x;P+=x,R+=S)for(let B=0;B<S;B++)w[R+B]=o[P+B]*h;i._trim()}function $A(t,e,i){const o=t.indices,a=t.attributes,h={};h.indexArray=new ss;const f=e.json.accessors[o],x=f.count/3;h.indexArray.reserve(x);const w=Ch(e,f);for(let B=0;B<x;B++)h.indexArray.emplaceBack(w[3*B],w[3*B+1],w[3*B+2]);h.indexArray._trim(),h.vertexArray=new bu;const S=e.json.accessors[a.POSITION];h.vertexArray.reserve(S.count);const P=Ch(e,S);for(let B=0;B<S.count;B++)h.vertexArray.emplaceBack(P[3*B],P[3*B+1],P[3*B+2]);if(h.vertexArray._trim(),h.aabb=new Nr(S.min,S.max),h.centroid=function(B,H){const $=[0,0,0],te=B.length;if(te>0){for(let ne=0;ne<te;ne++){const de=3*B[ne];$[0]+=H[de],$[1]+=H[de+1],$[2]+=H[de+2]}$[0]/=te,$[1]/=te,$[2]/=te}return $}(w,P),a.COLOR_0!==void 0){const B=e.json.accessors[a.COLOR_0],H=sp[B.type],$=Ch(e,B);h.colorArray=H===3?new bu:new wu,h.colorArray.resize(B.count),H1(e,B,h.colorArray,$)}if(a.NORMAL!==void 0){h.normalArray=new bu;const B=e.json.accessors[a.NORMAL];h.normalArray.resize(B.count);const H=Ch(e,B);H1(e,B,h.normalArray,H)}if(a.TEXCOORD_0!==void 0&&i.length>0){h.texcoordArray=new ed;const B=e.json.accessors[a.TEXCOORD_0];h.texcoordArray.resize(B.count);const H=Ch(e,B);H1(e,B,h.texcoordArray,H)}if(a._FEATURE_ID_RGBA4444!==void 0){const B=e.json.accessors[a._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(h.featureData=Ch(e,B))}a._FEATURE_RGBA4444!==void 0&&(h.featureData=new Uint32Array(Ch(e,e.json.accessors[a._FEATURE_RGBA4444]).buffer));const R=t.material;return h.material=function(B,H){const{emissiveFactor:$=[0,0,0],alphaMode:te="OPAQUE",alphaCutoff:ne=.5,normalTexture:de,occlusionTexture:Se,emissiveTexture:Me,doubleSided:Le}=B,{baseColorFactor:ze=[1,1,1,1],metallicFactor:Fe=1,roughnessFactor:Xe=1,baseColorTexture:et,metallicRoughnessTexture:st}=B.pbrMetallicRoughness||{},_t=Se?H[Se.index]:void 0;if(Se&&Se.extensions&&Se.extensions.KHR_texture_transform&&_t){const dt=Se.extensions.KHR_texture_transform;_t.offsetScale=[dt.offset[0],dt.offset[1],dt.scale[0],dt.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new kn(...ze),metallicFactor:Fe,roughnessFactor:Xe,baseColorTexture:et?H[et.index]:void 0,metallicRoughnessTexture:st?H[st.index]:void 0},doubleSided:Le,emissiveFactor:$,alphaMode:te,alphaCutoff:ne,normalTexture:de?H[de.index]:void 0,occlusionTexture:_t,emissionTexture:Me?H[Me.index]:void 0,defined:B.defined===void 0}}(R!==void 0?e.json.materials[R]:{defined:!1},i),h}function Lw(t,e,i){const{matrix:o,rotation:a,translation:h,scale:f,mesh:x,extras:w,children:S}=t,P={};if(P.matrix=o||r.ad.fromRotationTranslationScale([],a||[0,0,0,1],h||[0,0,0],f||[1,1,1]),x!==void 0){P.meshes=i[x];const R=P.anchor=[0,0];for(const B of P.meshes){const{min:H,max:$}=B.aabb;R[0]+=H[0]+$[0],R[1]+=H[1]+$[1]}R[0]=Math.floor(R[0]/P.meshes.length/2),R[1]=Math.floor(R[1]/P.meshes.length/2)}if(w&&(w.id&&(P.id=w.id),w.lights&&(P.lights=function(R){if(!R.length)return[];const B=function(de){const Se=atob(de),Me=new Uint8Array(Se.length);for(let Le=0;Le<Se.length;Le++)Me[Le]=Se.codePointAt(Le);return Me}(R),H=[],$=B.length/24,te=new Uint16Array(B.buffer),ne=new Float32Array(B.buffer);for(let de=0;de<$;de++){const Se=te[2*de*6]/30,Me=te[2*de*6+1]/30,Le=te[2*de*6+10]/100,ze=ne[6*de+1],Fe=ne[6*de+2],Xe=ne[6*de+3],et=ne[6*de+4],st=Xe-ze,_t=et-Fe,dt=Math.hypot(st,_t);H.push({pos:[ze+.5*st,Fe+.5*_t,Me],normal:[_t/dt,-st/dt,0],width:dt,height:Se,depth:Le,points:[ze,Fe,Xe,et]})}return H}(w.lights))),S){const R=[];for(const B of S)R.push(Lw(e.json.nodes[B],e,i));P.children=R}return P}function ZA(t){if(t.vertices.length===0||t.indices.length===0)return null;const e=new a1(t.vertices,t.indices,8,256),[i,o]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:i,max:o}}function XA(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const o=[];for(const f of i){if(!Array.isArray(f)||f.length!==2)continue;const x=f[0],w=f[1];typeof x=="number"&&typeof w=="number"&&o.push(new Yt(x,w))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let a=0;for(let f=0;f<o.length;f++){const x=o[f],w=o[(f+1)%o.length],S=o[(f+2)%o.length];a+=(x.x-w.x)*(S.y-w.y)-(S.x-w.x)*(x.y-w.y)}a>0&&o.reverse();const h=Nf(o.flatMap(f=>[f.x,f.y]),[]);return h.length===0?null:{vertices:o,indices:h}}function YA(t,e){const i=[],o=[];let a=0;const h=[];for(const f of t){a=i.length;const x=f.vertexArray.float32,w=f.indexArray.uint16;for(let S=0;S<f.vertexArray.length;S++)h[0]=x[3*S+0],h[1]=x[3*S+1],h[2]=x[3*S+2],r._.transformMat4(h,h,e),i.push(new Yt(h[0],h[1]));for(let S=0;S<3*f.indexArray.length;S++)o.push(w[S]+a)}if(o.length%3!=0)return null;for(let f=0;f<o.length;f+=3){const x=i[o[f+0]],w=i[o[f+1]],S=i[o[f+2]];(x.x-w.x)*(S.y-w.y)-(S.x-w.x)*(x.y-w.y)>0&&([o[f+1],o[f+2]]=[o[f+2],o[f+1]])}return{vertices:i,indices:o}}function Ow(t){const e=function(w,S){const P=[],R=WebGL2RenderingContext;if(w.json.textures)for(const B of w.json.textures){const H={magFilter:R.LINEAR,minFilter:R.NEAREST,wrapS:R.REPEAT,wrapT:R.REPEAT};B.sampler!==void 0&&Object.assign(H,w.json.samplers[B.sampler]),P.push({image:S[B.source],sampler:H,uploaded:!1})}return P}(t,t.images),i=function(w,S){const P=[];for(const R of w.json.meshes){const B=[];for(const H of R.primitives)B.push($A(H,w,S));P.push(B)}return P}(t,e),{scenes:o,scene:a,nodes:h}=t.json,f=o?o[a||0].nodes:h,x=[];for(const w of f)x.push(Lw(h[w],t,i));return function(w,S,P){const R={},B=new Set;for(let H=0;H<w.length;H++){const $=P[S[H]];if(!$.extras)continue;const te=$.extras["mapbox:footprint:version"],ne=$.extras["mapbox:footprint:id"];(te||ne)&&B.add(H),te==="1.0.0"&&ne&&(R[ne]=H)}for(let H=0;H<w.length;H++){if(B.has(H))continue;const $=w[H],te=P[S[H]];if(!te.extras)continue;let ne=null;$.id in R&&(ne=YA(w[R[$.id]].meshes,$.matrix)),ne||(ne=XA(te)),ne&&($.footprint=ZA(ne))}if(B.size>0){const H=Array.from(B.values()).sort(($,te)=>$-te);for(let $=H.length-1;$>=0;$--)w.splice(H[$],1)}}(x,f,t.json.nodes),x}function KA(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,i=t.aabb.min[0]-1,o=t.aabb.min[1]-1,a=bh/(t.aabb.max[0]-i+2),h=bh/(t.aabb.max[1]-o+2);for(let f=0;f<e.length;f+=3){const x=e[f+2],w=(e[f+0]-i)*a|0,S=(e[f+1]-o)*h|0;x>t.heightmap[S*bh+w]&&(t.heightmap[S*bh+w]=x)}}function QA(t,e){const i={};i.indexArray=new ss,i.indexArray.reserve(4*t.length),i.vertexArray=new bu,i.vertexArray.reserve(10*t.length),i.colorArray=new wu,i.vertexArray.reserve(10*t.length);let o=0;for(const f of t){const x=Math.min(10,Math.max(4,1.3*f.height))*e,w=[-f.normal[1],f.normal[0],0],S=Math.min(.29,.1*f.width/f.depth),P=f.width-2*f.depth*e*(S+.01),R=r._.scaleAndAdd([],f.pos,w,P/2),B=r._.scaleAndAdd([],f.pos,w,-P/2),H=[R[0],R[1],R[2]+f.height],$=[B[0],B[1],B[2]+f.height],te=r._.scaleAndAdd([],f.normal,w,S);r._.scale(te,te,x);const ne=r._.scaleAndAdd([],f.normal,w,-S);r._.scale(ne,ne,x),r._.add(te,R,te),r._.add(ne,B,ne),R[2]+=.1,B[2]+=.1,i.vertexArray.emplaceBack(te[0],te[1],te[2]),i.vertexArray.emplaceBack(ne[0],ne[1],ne[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack(B[0],B[1],B[2]),i.vertexArray.emplaceBack(H[0],H[1],H[2]),i.vertexArray.emplaceBack($[0],$[1],$[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack(B[0],B[1],B[2]),i.vertexArray.emplaceBack(te[0],te[1],te[2]),i.vertexArray.emplaceBack(ne[0],ne[1],ne[2]);const de=P/x/2;i.colorArray.emplaceBack(-de-S,-1,de,.8),i.colorArray.emplaceBack(de+S,-1,de,.8),i.colorArray.emplaceBack(-de,0,de,1.3),i.colorArray.emplaceBack(de,0,de,1.3),i.colorArray.emplaceBack(de+S,-.8,de,.7),i.colorArray.emplaceBack(de+S,-.8,de,.7),i.colorArray.emplaceBack(0,0,de,1.3),i.colorArray.emplaceBack(0,0,de,1.3),i.colorArray.emplaceBack(de+S,-1.2,de,.8),i.colorArray.emplaceBack(de+S,-1.2,de,.8),i.indexArray.emplaceBack(6+o,4+o,8+o),i.indexArray.emplaceBack(7+o,9+o,5+o),i.indexArray.emplaceBack(0+o,1+o,2+o),i.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}const a={defined:!0,emissiveFactor:[0,0,0]},h={};return h.baseColorFactor=kn.white,a.pbrMetallicRoughness=h,i.material=a,i.aabb=new Nr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const G1=new Float32Array(262144),Eh=new Uint8Array(262144);function Pw(t){let e=0;if(t.meshes)for(const i of t.meshes)e=Math.max(e,i.aabb.max[2]);if(t.children)for(const i of t.children)e=Math.max(e,Pw(i));return e}function Dw(t,e,i){if(t.meshes)for(const o of t.meshes)o.aabb.min[0]!==1/0&&i.insert(e,o.aabb.min[0],o.aabb.min[1],o.aabb.max[0],o.aabb.max[1]);if(t.children)for(const o of t.children)Dw(o,e,i)}const Rw=["","wall","door","roof","window","lamp","logo"];class kw{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Pw(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Nr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Nr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const o of this.node.meshes)this.node.lightMeshIndex!==e&&(o.transformedAabb=Nr.applyTransformFast(o.aabb,this.node.matrix),i.encapsulate(o.transformedAabb)),e++;this.aabb=i}return this.aabb}}class _g{constructor(e,i,o,a,h,f){this.id=i,this.modelTraits|=bd.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,o&&(this.modelTraits|=bd.HasMapboxMeshFeatures),a&&(this.modelTraits|=bd.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=h,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const x of e)this.nodesInfo.push(new kw(x)),Dw(x,f.featureIndexArray.length,f.grid),f.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,f.bucketLayerIDs.length-1,0)}updateFootprints(e,i){for(const o of this.getNodesInfo()){const a=o.node;a.footprint&&i.push({footprint:a.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const o of i){const a=o.node;this.uploaded?this.updatePbrBuffer(a):F1(a,e,!0)}for(const o of i)dg(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),i=!0);return i}needsReEvaluation(e,i,o){const a=e.transform.projectionOptions,h=e.style.getBrightness(),f=this.brightness!==h;return!!(!this.uploaded||this.dirty||a.name!==this.projection.name||ap(o.paint.get("model-color").value,f)||ap(o.paint.get("model-color-mix-intensity").value,f)||ap(o.paint.get("model-roughness").value,f)||ap(o.paint.get("model-emissive-strength").value,f)||ap(o.paint.get("model-height-based-emissive-strength-multiplier").value,f))&&(this.projection=a,this.brightness=h,!0)}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const o=this.getNodesInfo(),a=this.id.canonical;for(const h of o){const f=h.feature;h.evaluatedScale=i.paint.get("model-scale").evaluate(f,{},a)}}evaluate(e){const i=this.getNodesInfo();for(const o of i){if(!o.node.meshes)continue;const a=o.feature,h=o.node.meshes&&o.node.meshes[0].featureData,f=o.evaluatedColor[2],x=o.evaluatedRMEA[2],w=this.id.canonical;if(o.hasTranslucentParts=!1,h){for(let S=0;S<Rw.length;S++){const P=Rw[S];P.length&&(a.properties.part=P);const R=e.paint.get("model-color").evaluate(a,{},w).toRenderColor(null),B=e.paint.get("model-color-mix-intensity").evaluate(a,{},w);o.evaluatedColor[S]=[R.r,R.g,R.b,B],o.evaluatedRMEA[S][0]=e.paint.get("model-roughness").evaluate(a,{},w),o.evaluatedRMEA[S][2]=e.paint.get("model-emissive-strength").evaluate(a,{},w),o.evaluatedRMEA[S][3]=R.a,o.emissionHeightBasedParams[S]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(a,{},w),!o.hasTranslucentParts&&R.a<1&&(o.hasTranslucentParts=!0)}delete a.properties.part,eI(o,f!==o.evaluatedColor[2]||x!==o.evaluatedRMEA[2],this.modelTraits)}else o.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(a,{},w);o.evaluatedScale=e.paint.get("model-scale").evaluate(a,{},w),this.updatePbrBuffer(o.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,o,a){const h=e.findDEMTileFor(o);if(h&&(h.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(h.dem&&h.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=h.tileID.overscaledZ;const f=cd.create(e,o,h);if(!f)return;this.modelTraits&bd.HasMapboxMeshFeatures&&this.updateDEM(e,f,o,a);for(const x of this.getNodesInfo()){const w=x.node;if(!w.footprint||!w.footprint.vertices||!w.footprint.vertices.length)continue;const S=w.footprint.vertices;let P=f.getElevationAt(S[0].x,S[0].y,!0,!0);for(let R=1;R<S.length;R++)P=Math.min(P,f.getElevationAt(S[R].x,S[R].y,!0,!0));w.elevation=P}}this.terrainTile=h.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,o,a){let h=i._dem._modifiedForSources[a];if(h===void 0&&(i._dem._modifiedForSources[a]=[],h=i._dem._modifiedForSources[a]),h.includes(o.canonical))return;const f=i._dem.dim;h.push(o.canonical);let x=!1;for(const w of this.getNodesInfo()){const S=w.node;if(!S.footprint||!S.footprint.grid)continue;const P=S.footprint.grid,R=i.tileCoordToPixel(P.min.x,P.min.y),B=i.tileCoordToPixel(P.max.x,P.max.y),H=Math.min(Math.min(f-B.y,R.x),Math.min(R.y,f-B.x));if(H<0)continue;const $=Ki(H,2,5);let te=Math.max(0,R.x-$),ne=Math.max(0,R.y-$),de=Math.min(B.x+$,f-1),Se=Math.min(B.y+$,f-1);for(let Fe=ne;Fe<=Se;++Fe)for(let Xe=te;Xe<=de;++Xe)Eh[Fe*f+Xe]=255;let Me=0,Le=0;for(let Fe=0;Fe<P.cellsY;++Fe)for(let Xe=0;Xe<P.cellsX;++Xe){if(!P.cells[Fe*P.cellsX+Xe])continue;const et=i.tileCoordToPixel(P.min.x+Xe/P.xScale,P.min.y+Fe/P.yScale),st=i.tileCoordToPixel(P.min.x+(Xe+1)/P.xScale,P.min.y+(Fe+1)/P.yScale);for(let _t=et.y;_t<=Math.min(st.y+1,f-1);++_t)for(let dt=et.x;dt<=Math.min(st.x+1,f-1);++dt)Eh[_t*f+dt]===255&&(Eh[_t*f+dt]=0,Me+=i.getElevationAtPixel(dt,_t),Le++)}const ze=Me/Le;te=Math.max(1,R.x-$),ne=Math.max(1,R.y-$),de=Math.min(B.x+$,f-2),Se=Math.min(B.y+$,f-2),x=!0;for(let Fe=ne;Fe<=Se;++Fe)for(let Xe=te;Xe<=de;++Xe)Eh[Fe*f+Xe]===0&&(G1[Fe*f+Xe]=i._dem.set(Xe,Fe,ze));for(let Fe=1;Fe<$;++Fe){te=Math.max(1,R.x-Fe),ne=Math.max(1,R.y-Fe),de=Math.min(B.x+Fe,f-2),Se=Math.min(B.y+Fe,f-2);for(let Xe=ne;Xe<=Se;++Xe)for(let et=te;et<=de;++et){const st=Xe*f+et;if(Eh[st]===255){let _t=0,dt=0,St=-1,Vt=-1;for(let bt=-1;bt<=1;++bt)for(let kt=-1;kt<=1;++kt){const yt=(Xe+bt)*f+et+kt;if(Eh[yt]>=Fe)continue;const Bt=G1[yt],jt=Math.abs(Bt);jt>dt&&(_t=Bt,dt=jt,St=kt,Vt=bt)}if(dt>.1){const bt=1-(Fe+.5*Math.abs(St*Vt))/$;let kt=i._dem.get(et,Xe)+_t*bt;const yt=i._dem.get(et+St,Xe+Vt),Bt=i._dem.get(et-St,Xe-Vt,!0);(kt-yt)*(kt-Bt)>0&&(kt=(yt+Bt)/2),G1[st]=i._dem.set(et,Xe,kt),Eh[st]=Fe}}}}}x&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Ao.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)dg(i.node),z1(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped()),a=this.getNodesInfo();for(let h=0;h<this.nodesInfo.length;h++){const f=a[h].node;a[h].hiddenByReplacement=!!f.footprint&&!o.find(x=>x.footprint===f.footprint)}}getHeightAtTileCoord(e,i){const o=this.getNodesInfo(),a=[],h=[0,0,0],f=r.ad.identity([]);for(let x=0;x<this.nodesInfo.length;x++){const w=o[x],S=w.node.meshes[0],P=S.transformedAabb;if(e<P.min[0]||i<P.min[1]||e>P.max[0]||i>P.max[1])continue;if(w.node.hidden===!0)return{height:0,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};r.ad.invert(f,w.node.matrix),h[0]=e,h[1]=i,r._.transformMat4(h,h,f);const R=(h[0]-S.aabb.min[0])/(S.aabb.max[0]-S.aabb.min[0])*bh|0,B=Math.min(63,(h[1]-S.aabb.min[1])/(S.aabb.max[1]-S.aabb.min[1])*bh|0)*bh+Math.min(63,R),H=S.heightmap[B];if(!(H<0&&w.node.footprint))return w.hiddenByReplacement?void 0:{height:H,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};if(w.node.footprint.grid.query(new Yt(e,i),new Yt(e,i),a),a.length>0)return{height:void 0,maxHeight:w.feature.properties.height,hidden:w.hiddenByReplacement,verticalScale:w.evaluatedScale[2]}}}}function ap(t,e){return!t.isLightConstant&&e}function JA(t,e,i,o,a,h,f,x){let w=(61440&e|(61440&e)>>4)>>8,S=(3840&e|(3840&e)>>4)>>4,P=240&e|(240&e)>>4;i[3]>0&&(w=Fi(w,255*i[0],i[3]),S=Fi(S,255*i[1],i[3]),P=Fi(P,255*i[2],i[3]));const R=w<<8|S,B=P<<8|Math.floor(255*o[3]),H=function(Fe){const Xe=Ki(Fe,0,2);return Math.min(Math.round(.5*Xe*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],$=Ki(a[0],0,1),te=Ki(a[1],0,1),ne=Ki(a[2],0,1),de=Ki(a[3],0,1);let Se,Me,Le,ze;if($!==te&&f!==h&&te!==$){const Fe=f-h;Me=1/(Fe*(te-$)),Le=-(h+Fe*$)/(Fe*(te-$));const Xe=Ki(a[4],-1,1);ze=Math.pow(10,Xe),Se=255*ne<<8|255*de}else Se=65535,Me=0,Le=1,ze=1;if(t.emplaceBack(R,B,H,Se,Me,Le,ze),x){const Fe=x.length;x.clear();for(let Xe=0;Xe<Fe;Xe++)x.emplaceBack(R,B,H,Se,Me,Le,ze)}}function eI(t,e,i){const o=t.node;let a=0;const h=i&bd.HasMeshoptCompression;for(const f of o.meshes){if(o.lights&&o.lightMeshIndex===a||!f.featureData)continue;f.featureArray=new _m,f.featureArray.reserve(f.featureData.length);let x=e;for(const w of f.featureData){const S=h?65535&w:w>>16&65535,P=h?w>>16&65535:65535&w,R=(15&P)<8?15&P:0,B=t.evaluatedRMEA[R],H=t.evaluatedColor[R],$=t.emissionHeightBasedParams[R];let te;if(x&&R===2&&o.lights&&(te=new _m,te.resize(10*o.lights.length)),JA(f.featureArray,S,H,B,$,f.aabb.min[2],f.aabb.max[2],te),te&&x){x=!1;const ne=o.meshes[o.lightMeshIndex];ne.featureArray=te,ne.featureArray._trim()}}f.featureArray._trim(),a++}}function Bw(t,e,i,o){const a=1<<t.z;e.lat=hs((o/Zt+t.y)/a),e.lng=ca((i/Zt+t.x)/a)}xe(_g,"Tiled3dModelBucket",{omit:["layers"]}),xe(kw,"Tiled3dModelFeature");const tI={circle:class extends bs{constructor(t,e,i,o){super(t,RE,e,i,o)}createBucket(t){return new q0(t)}queryRadius(t){const e=t;return sd("circle-radius",this,e)+sd("circle-stroke-width",this,e)+Cm(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,o,a,h,f,x){const w=$y(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return lv(t,o,h,f,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,S)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e,i){const o=av(this);return{config:new fh(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}},heatmap:class extends bs{createBucket(t){return new uv(t)}constructor(t,e,i,o){super(t,GE,e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Bf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return sd("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,o,a,h,f,x){const w=this.paint.get("heatmap-radius").evaluate(e,i);return lv(t,o,h,f,x,!0,!0,new Yt(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e,i){return t==="heatmap"?{config:new fh(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends bs{constructor(t,e,i,o){super(t,$E,e,i,o)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e,i){return{overrideFog:!1}}},fill:class extends bs{constructor(t,e,i,o){super(t,aT,e,i,o)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(t,e,i){return{config:new fh(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Pm(t)}queryRadius(){return Cm(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,o,a,h){return!t.queryGeometry.isAboveHorizon&&jy(Wy(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends bs{constructor(t,e,i,o){super(t,NT,e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new zm(t)}queryRadius(){return Cm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,i,o,a,h,f,x,w){const S=$y(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),P=this.paint.get("fill-extrusion-height").evaluate(e,i),R=this.paint.get("fill-extrusion-base").evaluate(e,i),B=[0,0],H=x&&h.elevation,$=h.elevation?h.elevation.exaggeration():1,te=t.tile.getBucket(this);if(H&&te instanceof zm){const Le=te.centroidVertexArray,ze=w+1;ze<Le.length&&(B[0]=Le.geta_centroid_pos0(ze),B[1]=Le.geta_centroid_pos1(ze))}if(B[0]===0&&B[1]===1)return!1;h.projection.name==="globe"&&(o=Kv([o],[new Yt(0,0),new Yt(Zt,Zt)],t.tileID.canonical).map(Le=>Le.polygon).flat());const ne=H?x:null,[de,Se]=function(Le,ze,Fe,Xe,et,st,_t,dt,St,Vt,bt){return Le.projection.name==="globe"?function(kt,yt,Bt,jt,zt,ri,Ut,Ht,Di,Si,Ci){const qt=[],Ni=[],cn=kt.projection.upVectorScale(Ci,kt.center.lat,kt.worldSize).metersToTile,Gi=[0,0,0,1],mn=[0,0,0,1],un=(qi,ur,sr,jn)=>{qi[0]=ur,qi[1]=sr,qi[2]=jn,qi[3]=1},xn=Yv();Bt>0&&(Bt+=xn),jt+=xn;for(const qi of yt){const ur=[],sr=[];for(const jn of qi){const Pn=jn.x+zt.x,qn=jn.y+zt.y,Er=kt.projection.projectTilePoint(Pn,qn,Ci),_r=kt.projection.upVector(Ci,jn.x,jn.y);let Kr=Bt,Hr=jt;if(Ut){const Os=Jv(Pn,qn,Bt,jt,Ut,Ht,Di,Si);Kr+=Os.base,Hr+=Os.top}Bt!==0?un(Gi,Er.x+_r[0]*cn*Kr,Er.y+_r[1]*cn*Kr,Er.z+_r[2]*cn*Kr):un(Gi,Er.x,Er.y,Er.z),un(mn,Er.x+_r[0]*cn*Hr,Er.y+_r[1]*cn*Hr,Er.z+_r[2]*cn*Hr),r._.transformMat4(Gi,Gi,ri),r._.transformMat4(mn,mn,ri),ur.push(new yh(Gi[0],Gi[1],Gi[2])),sr.push(new yh(mn[0],mn[1],mn[2]))}qt.push(ur),Ni.push(sr)}return[qt,Ni]}(Le,ze,Fe,Xe,et,st,_t,dt,St,Vt,bt):_t?function(kt,yt,Bt,jt,zt,ri,Ut,Ht,Di){const Si=[],Ci=[],qt=[0,0,0,1];for(const Ni of kt){const cn=[],Gi=[];for(const mn of Ni){const un=mn.x+jt.x,xn=mn.y+jt.y,qi=Jv(un,xn,yt,Bt,ri,Ut,Ht,Di);qt[0]=un,qt[1]=xn,qt[2]=qi.base,qt[3]=1,r.aA.transformMat4(qt,qt,zt),qt[3]=Math.max(qt[3],1e-5);const ur=new yh(qt[0]/qt[3],qt[1]/qt[3],qt[2]/qt[3]);qt[0]=un,qt[1]=xn,qt[2]=qi.top,qt[3]=1,r.aA.transformMat4(qt,qt,zt),qt[3]=Math.max(qt[3],1e-5);const sr=new yh(qt[0]/qt[3],qt[1]/qt[3],qt[2]/qt[3]);cn.push(ur),Gi.push(sr)}Si.push(cn),Ci.push(Gi)}return[Si,Ci]}(ze,Fe,Xe,et,st,_t,dt,St,Vt):function(kt,yt,Bt,jt,zt){const ri=[],Ut=[],Ht=zt[8]*yt,Di=zt[9]*yt,Si=zt[10]*yt,Ci=zt[11]*yt,qt=zt[8]*Bt,Ni=zt[9]*Bt,cn=zt[10]*Bt,Gi=zt[11]*Bt;for(const mn of kt){const un=[],xn=[];for(const qi of mn){const ur=qi.x+jt.x,sr=qi.y+jt.y,jn=zt[0]*ur+zt[4]*sr+zt[12],Pn=zt[1]*ur+zt[5]*sr+zt[13],qn=zt[2]*ur+zt[6]*sr+zt[14],Er=zt[3]*ur+zt[7]*sr+zt[15],_r=jn+Ht,Kr=Pn+Di,Hr=qn+Si,Os=Math.max(Er+Ci,1e-5),co=jn+qt,zr=Pn+Ni,Mo=qn+cn,ds=Math.max(Er+Gi,1e-5);un.push(new yh(_r/Os,Kr/Os,Hr/Os)),xn.push(new yh(co/ds,zr/ds,Mo/ds))}ri.push(un),Ut.push(xn)}return[ri,Ut]}(ze,Fe,Xe,et,st)}(h,o,R,P,S,f,ne,B,$,h.center.lat,t.tileID.canonical),Me=t.queryGeometry;return function(Le,ze,Fe){let Xe=1/0;jy(Fe,ze)&&(Xe=Qv(Fe,ze[0]));for(let et=0;et<ze.length;et++){const st=ze[et],_t=Le[et];for(let dt=0;dt<st.length-1;dt++){const St=st[dt],Vt=[St,st[dt+1],_t[dt+1],_t[dt],St];H0(Fe,Vt)&&(Xe=Math.min(Xe,Qv(Fe,Vt)))}}return Xe!==1/0&&Xe}(de,Se,Me.isPointQuery()?Me.screenBounds:Me.screenGeometry)}},line:class extends bs{constructor(t,e,i,o){super(t,Um,e,i,o),Um.layout&&(this.layout=new xr(Um.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Rc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=rw.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Vm(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e,i){const o=ax(this);return{config:new fh(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}queryRadius(t){const e=t,i=ow(sd("line-width",this,e),sd("line-gap-width",this,e)),o=sd("line-offset",this,e);return i/2+Math.abs(o)+Cm(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,o,a,h){if(t.queryGeometry.isAboveHorizon)return!1;const f=Wy(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),x=t.pixelToTileUnitsFactor/2*ow(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),w=this.paint.get("line-offset").evaluate(e,i);return w&&(o=function(S,P){const R=[],B=new Yt(0,0);for(let H=0;H<S.length;H++){const $=S[H],te=[];for(let ne=0;ne<$.length;ne++){const de=$[ne],Se=$[ne+1],Me=ne===0?B:de.sub($[ne-1])._unit()._perp(),Le=ne===$.length-1?B:Se.sub(de)._unit()._perp(),ze=Me._add(Le)._unit();ze._mult(1/(ze.x*Le.x+ze.y*Le.y)),te.push(ze._mult(P)._add(de))}R.push(te)}return R}(o,w*t.pixelToTileUnitsFactor)),function(S,P,R){for(let B=0;B<P.length;B++){const H=P[B];if(S.length>=3){for(let $=0;$<H.length;$++)if(Iu(S,H[$]))return!0}if(LE(S,H,R))return!0}return!1}(f,o,x)}isTileClipped(){return!0}isDraped(t){const e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:sg,background:class extends bs{constructor(t,e,i,o){super(t,vA,e,i,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e,i){return{overrideFog:!1}}},raster:cw,"raster-particle":uw,sky:class extends bs{constructor(t,e,i,o){super(t,AA,e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Bf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),a=!o,h=t.style.light,f=h.properties.get("position");return a&&h.properties.get("anchor")==="viewport"&&Dr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?k1(f.azimuthal,90-f.polar,e):k1(o[0],90-o[1],e)}const i=this.paint.get("sky-gradient-center");return k1(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends bs{constructor(t,e,i,o){super(t,IA,e,null)}},model:class extends bs{constructor(t,e,i,o){super(t,NA,e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new N1(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof _g?Zt-1:0}queryIntersectsFeature(t,e,i,o,a,h){if(!this.modelManager)return!1;const f=this.modelManager,x=t.tile.getBucket(this);if(!(x&&x instanceof N1))return!1;const w=x;for(const S in w.instancesPerModel){const P=w.instancesPerModel[S],R=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(P.idToFeaturesIndex.hasOwnProperty(R)){const B=P.features[P.idToFeaturesIndex[R]],H=f.getModel(S,this.scope);if(!H)return!1;let $=r.ad.create();const te=new Vn(0,0),ne=w.canonical;let de=Number.MAX_VALUE;for(let Se=0;Se<B.instancedDataCount;++Se){const Me=16*(B.instancedDataOffset+Se),Le=P.instancedDataArray.float32,ze=[Le[Me+4],Le[Me+5],Le[Me+6]];Bw(ne,te,Le[Me],0|Le[Me+1]),xw($,H,h,te,B.rotation,B.scale,ze,!1,!1,!1),h.projection.name==="globe"&&($=B1($,h));const Fe=r.ad.multiply([],h.projMatrix,$),Xe=t.queryGeometry,et=gw(Xe.isPointQuery()?Xe.screenBounds:Xe.screenGeometry,h,Fe,H.aabb);et!=null&&(de=Math.min(et,de))}return de!==Number.MAX_VALUE&&de}}return!1}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof ge}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,i,o){const a=t.tile,h=a.getBucket(this);let f=null,x=Number.MAX_VALUE;if(!(h&&h instanceof _g))return{queryFeature:f,intersectionZ:x};const w=h.getNodesInfo()[e];if(w.hiddenByReplacement||!w.node.meshes||!i.filter(new $i(a.tileID.overscaledZ),w.feature,a.tileID.canonical))return{queryFeature:f,intersectionZ:x};const S=w.node,P=o.calculatePosMatrix(a.tileID.toUnwrapped(),o.worldSize),R=w.evaluatedScale;let B=0;o.elevation&&S.elevation&&(B=S.elevation*o.elevation.exaggeration()),r.ad.translate(P,P,[(S.anchor?S.anchor[0]:0)*(R[0]-1),(S.anchor?S.anchor[1]:0)*(R[1]-1),B]),r.ad.scale(P,P,R),r.ad.multiply(P,P,S.matrix);const H=t.queryGeometry,$=H.isPointQuery()?H.screenBounds:H.screenGeometry,te=function(de){const Se=r.ad.multiply([],P,de.matrix),Me=r.ad.multiply(Se,o.expandedFarZProjMatrix,Se);for(let Le=0;Le<de.meshes.length;++Le){const ze=de.meshes[Le];if(Le===de.lightMeshIndex)continue;const Fe=gw($,o,Me,ze.aabb);Fe!=null&&(x=Math.min(Fe,x))}if(de.children)for(const Le of de.children)te(Le)};if(te(S),x===Number.MAX_VALUE)return{queryFeature:f,intersectionZ:x};const ne=new Vn(0,0);return Bw(a.tileID.canonical,ne,w.node.anchor[0],w.node.anchor[1]),f={type:"Feature",geometry:{type:"Point",coordinates:[ne.lng,ne.lat]},properties:w.feature.properties,id:w.feature.id,state:{},layer:this.serialize()},{queryFeature:f,intersectionZ:x}}},clip:class extends bs{constructor(t,e,i,o){super(t,cT,e,i,o)}recalculate(t,e){super.recalculate(t,e)}createBucket(t){return new yv(t)}isTileClipped(){return!0}is3D(){return!0}}};xe(tw,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const Nw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class W1{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const a=o>>4;if(a!==1)throw new Error(`Got v${a} data when expected v1.`);const h=Nw[15&o];if(!h)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new W1(x,f,h,e)}constructor(e,i=64,o=Float64Array,a){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const h=Nw.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-x%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${o}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+x+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return $1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:f,nodeSize:x}=this,w=[0,h.length-1,0],S=[];for(;w.length;){const P=w.pop()||0,R=w.pop()||0,B=w.pop()||0;if(R-B<=x){for(let ne=B;ne<=R;ne++){const de=f[2*ne],Se=f[2*ne+1];de>=e&&de<=o&&Se>=i&&Se<=a&&S.push(h[ne])}continue}const H=B+R>>1,$=f[2*H],te=f[2*H+1];$>=e&&$<=o&&te>=i&&te<=a&&S.push(h[H]),(P===0?e<=$:i<=te)&&(w.push(B),w.push(H-1),w.push(1-P)),(P===0?o>=$:a>=te)&&(w.push(H+1),w.push(R),w.push(1-P))}return S}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:h,nodeSize:f}=this,x=[0,a.length-1,0],w=[],S=o*o;for(;x.length;){const P=x.pop()||0,R=x.pop()||0,B=x.pop()||0;if(R-B<=f){for(let ne=B;ne<=R;ne++)zw(h[2*ne],h[2*ne+1],e,i)<=S&&w.push(a[ne]);continue}const H=B+R>>1,$=h[2*H],te=h[2*H+1];zw($,te,e,i)<=S&&w.push(a[H]),(P===0?e-o<=$:i-o<=te)&&(x.push(B),x.push(H-1),x.push(1-P)),(P===0?e+o>=$:i+o>=te)&&(x.push(H+1),x.push(R),x.push(1-P))}return w}}function $1(t,e,i,o,a,h){if(a-o<=i)return;const f=o+a>>1;Fw(t,e,f,o,a,h),$1(t,e,i,o,f-1,1-h),$1(t,e,i,f+1,a,1-h)}function Fw(t,e,i,o,a,h){for(;a>o;){if(a-o>600){const S=a-o+1,P=i-o+1,R=Math.log(S),B=.5*Math.exp(2*R/3),H=.5*Math.sqrt(R*B*(S-B)/S)*(P-S/2<0?-1:1);Fw(t,e,i,Math.max(o,Math.floor(i-P*B/S+H)),Math.min(a,Math.floor(i+(S-P)*B/S+H)),h)}const f=e[2*i+h];let x=o,w=a;for(lp(t,e,o,i),e[2*a+h]>f&&lp(t,e,o,a);x<w;){for(lp(t,e,x,w),x++,w--;e[2*x+h]<f;)x++;for(;e[2*w+h]>f;)w--}e[2*o+h]===f?lp(t,e,o,w):(w++,lp(t,e,w,a)),w<=i&&(o=w+1),i<=w&&(a=w-1)}}function lp(t,e,i,o){Z1(t,i,o),Z1(e,2*i,2*o),Z1(e,2*i+1,2*o+1)}function Z1(t,e,i){const o=t[e];t[e]=t[i],t[i]=o}function zw(t,e,i,o){const a=t-i,h=e-o;return a*a+h*h}r.$=il,r.A=ah,r.B=sh,r.C=kn,r.D=tt,r.E=al,r.G=os,r.H=y,r.I=xh,r.J=p,r.K=function(t){const e=t.value;let i=[];if(!e)return i;const o=Sa(e);return o!=="string"?(i=i.concat([new hg(t.key,e,`string expected, "${o}" found`)]),i):(_w(e,!0)||(i=i.concat([new hg(t.key,e,`invalid url "${e}"`)])),i)},r.L=lt,r.M=class{constructor(t,e,i,o){this.id=t,this.position=e!=null?new Vn(e[0],e[1]):new Vn(0,0),this.orientation=i??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new Nr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(r.ad.multiply(t.matrix,e,t.matrix),t.meshes)for(const i of t.meshes){const o=Nr.applyTransformFast(i.aabb,t.matrix);this.aabb.encapsulate(o)}if(t.children)for(const i of t.children)this._applyTransformations(i,t.matrix)}computeBoundsAndApplyParent(){const t=r.ad.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,i,o,a,h,f=!1){xw(this.matrix,this,t.transform,this.position,e,i,o,a,h,f)}upload(t){if(!this.uploaded){for(const e of this.nodes)F1(e,t);for(const e of this.nodes)dg(e);this.uploaded=!0}}destroy(){for(const t of this.nodes)z1(t)}},r.N=Wn,r.O=It,r.P=Yt,r.Q=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return kr(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Fi(t.x,e.x,i),y:Fi(t.y,e.y,i),z:Fi(t.z,e.z,i),azimuthal:Fi(t.azimuthal,e.azimuthal,i),polar:Fi(t.polar,e.polar,i)}}},r.R=ea,r.S=I0,r.T=dl,r.U=En,r.V=hg,r.W=An,r.X=$i,r.Y=Ls,r.Z=ge,r.a=Ma,r.a$=function(t){const{x:e,y:i}=t.point,{lng:o,lat:a}=t._center;return rv(e,i,t.worldSize,o,a)},r.a0=xr,r.a1=Wc,r.a2=Fi,r.a3=Zt,r.a4=Fh,r.a5=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([i,o]){const a=kr([1,i,o]);return{x:a.x,y:a.y,z:a.z}}(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Fi(t.x,e.x,i),y:Fi(t.y,e.y,i),z:Fi(t.z,e.z,i)}}},r.a6=Mf,r.a7=vm,r.a8=jc,r.a9=Py,r.aB=function(t,e){const{x:i,y:o}=t.point,a=rv(i,o,t.worldSize/t._pixelsPerMercatorPixel,0,0);return r.ad.multiply(a,a,J0(pc(e)))},r.aD=fd,r.aE=Xa,r.aF=Hm,r.aG=function(t,e,i,o,a){const h=5*e+2;t.float32[h+0]=i,t.float32[h+1]=o,t.float32[h+2]=a},r.aH=tg,r.aI=Vn,r.aJ=Wx,r.aK=By,r.aL=jo,r.aM=Y0,r.aN=dw,r.aO=mh,r.aP=tv,r.aQ=function(t,e,i,o,a,h,f,x,w){if(w.name==="globe")return tv(t,e,new mh(i,o,a),!1);const S=vh({z:i,x:o,y:a},w);return new Nr([(h+S.x/S.scale)*e,e*(S.y/S.scale),f],[(h+S.x2/S.scale)*e,e*(S.y2/S.scale),x])},r.aR=function(t,e,i){let o=0;for(let a=0;a<2;++a)t[a]>0&&(o+=(t[a]-0)*(t[a]-0)),e[a]<0&&(o+=(0-e[a])*(0-e[a]));return o},r.aS=mo,r.aT=Z0,r.aU=Ry,r.aV=function(t){const e=r.ad.identity(new Float64Array(16));r.ad.multiply(e,t.pixelMatrix,t.globeMatrix);const i=[0,ul,0],o=[0,hl,0];return r._.transformMat4(i,i,e),r._.transformMat4(o,o,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!t1(t,new Vn(t.center.lat,90)),o[0]>0&&o[0]<=t.width&&o[1]>0&&o[1]<=t.height&&!t1(t,new Vn(t.center.lat,-90))]},r.aW=function(t,e){const{scale:i}=t.tileTransform,o=i*Zt/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return r.aC.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},r.aX=cg,r.aY=hw,r.aZ=function(t){const e=hw(t,!0);return r.aC.invert([],[e[0],e[1],e[4],e[5]])},r.a_=X0,r.aa=$s,r.ab=nn,r.ac=function(t,e,i){const o=Math.sqrt(t*t+e*e+i*i),a=o>0?Math.acos(i/o)*ts:0;let h=t!==0||e!==0?Math.atan2(-e,-t)*ts+90:0;return h<0&&(h+=360),[o,h,a]},r.ae=yd,r.af=Bl,r.ag=E1,r.ah=function(t,e){const i={};for(let o=0;o<e.length;o++){const a=e[o];a in t&&(i[a]=t[a])}return i},r.ai=Au,r.aj=dc,r.ak=fc,r.al=Qh,r.am=function(t){us++,us>tu&&(t.getActor().send("enforceCacheSizeLimit",qs),us=0)},r.an=Et,r.ao=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,i,o){const a=this.entries[t]=this.entries[t]||{callbacks:[]};if(a.result){const[h,f]=a.result;return this.scheduler?this.scheduler.add(()=>{o(h,f)},e):o(h,f),()=>{}}return a.callbacks.push(o),a.cancel||(a.cancel=i((h,f)=>{a.result=[h,f];for(const x of a.callbacks)this.scheduler?this.scheduler.add(()=>{x(h,f)},e):x(h,f);setTimeout(()=>delete this.entries[t],3e3)})),()=>{a.result||(a.callbacks=a.callbacks.filter(h=>h!==o),a.callbacks.length||(a.cancel(),delete this.entries[t]))}}},r.ap=function(t,e,i){const o=JSON.stringify(t.request);return t.data&&(this.deduped.entries[o]={result:[null,t.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},a=>{const h=c(t.request,(f,x,w,S)=>{f?a(f):x&&a(null,{vectorTile:i?void 0:new l1(new dd(x)),rawData:x,cacheControl:w,expires:S})});return()=>{h.cancel(),a()}},e)},r.aq=P0,r.ar=class extends Uc{constructor(t){super(t),this.current=gE}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let o=0;o<9;o++)if(i[o]!==this.current[o]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.as=D0,r.at=Ki,r.au=Na,r.aw=cs,r.ax=Xs,r.ay=hs,r.az=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},r.b=qr,r.b$=Ou,r.b0=ho,r.b1=B0,r.b2=function(t){const e=Math.round((t+45+360)%360/90)%4;return _a[e]},r.b3=45,r.b4=z0,r.b5=xm,r.b6=Nr,r.b7=kr,r.b8=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},r.b9=js,r.bA=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},r.bB=rx,r.bD=nv,r.bE=za,r.bF=rl,r.bG=256,r.bH=function(t,e){const i=[0,0,0],o=kf(pc(e.canonical));return r._.transformMat4(i,i,o),r._.transformMat4(i,i,t),i},r.bI=t=>({u_camera_to_center_distance:new $s(t),u_extrude_scale:new R0(t),u_device_pixel_ratio:new $s(t),u_matrix:new Mf(t),u_inv_rot_matrix:new Mf(t),u_merc_center:new jc(t),u_tile_id:new P0(t),u_zoom_transition:new $s(t),u_up_dir:new P0(t),u_emissive_strength:new $s(t)}),r.bJ=t=>({u_matrix:new Mf(t),u_pixels_to_tile_units:new R0(t),u_device_pixel_ratio:new $s(t),u_units_to_pixels:new jc(t),u_dash_image:new vm(t),u_gradient_image:new vm(t),u_image_height:new $s(t),u_texsize:new jc(t),u_tile_units_to_pixels:new $s(t),u_alpha_discard_threshold:new $s(t),u_trim_offset:new jc(t),u_trim_fade_range:new jc(t),u_trim_color:new D0(t),u_emissive_strength:new $s(t)}),r.bK=t=>({u_matrix:new Mf(t),u_texsize:new jc(t),u_pixels_to_tile_units:new R0(t),u_device_pixel_ratio:new $s(t),u_image:new vm(t),u_units_to_pixels:new jc(t),u_tile_units_to_pixels:new $s(t),u_alpha_discard_threshold:new $s(t),u_trim_offset:new jc(t)}),r.bL=w0,r.bM=YT,r.bN=Cs,r.bO=pS,r.bP=Nx,r.bQ=_1,r.bR=av,r.bS=(t,e,i,o,a,h)=>{const f=t.transform,x=f.projection.name==="globe";let w;if(h.paint.get("circle-pitch-alignment")==="map")if(x){const P=nv(f.zoom,e.canonical)*f._pixelsPerMercatorPixel;w=Float32Array.from([P,0,0,P])}else w=f.calculatePixelsToTileUnitsMatrix(i);else w=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);const S={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(f.projection),u_matrix:t.translatePosMatrix(e.projMatrix,i,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ao.devicePixelRatio,u_extrude_scale:w,u_inv_rot_matrix:VE,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:h.paint.get("circle-emissive-strength")};if(x){S.u_inv_rot_matrix=o,S.u_merc_center=a,S.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],S.u_zoom_transition=Wc(f.zoom);const P=a[0]*Zt,R=a[1]*Zt;S.u_up_dir=f.projection.upVector(new mh(0,0,0),P,R)}return S},r.bT=ax,r.bU=(t,e,i,o,a,h)=>{const f=t.transform;return{u_matrix:sx(t,e,i,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:f.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:a,u_image:0,u_tile_units_to_pixels:ox(e,f),u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:h}},r.bV=(t,e,i,o,a,h,f)=>{const x=t.transform,w=x.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:sx(t,e,i,o),u_pixels_to_tile_units:w,u_device_pixel_ratio:h,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:lx(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ox(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:f,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength")}},r.bW=Tc,r.bX=Bf,r.bY=Yv,r.bZ=EE,r.b_=zm,r.ba=function(t,e,i){const o=Wc(i.zoom),a=t.style.map._antialias,h=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return o===0&&!a&&!h},r.bb=function(t){const e=t.pixelsPerMeter,i=e/Xs(1,t.center.lat),o=r.ad.identity(new Float64Array(16));return r.ad.translate(o,o,[t.point.x,t.point.y,0]),r.ad.scale(o,o,[i,i,e]),Float32Array.from(o)},r.bc=Sm,r.bd=function(t){const e=mo-5;t=Ki(t,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(nn(t))),3);return Math.round(i*(N0.length-1))},r.be=function(t,e,i,o){const a=e.getNorth(),h=e.getSouth(),f=e.getWest(),x=e.getEast(),w=1<<t.z,S=x-f,P=a-h,R=S/id,B=-P/N0[i],H=[0,R,0,B,0,0,a,f,0];if(t.z>0){const $=180/o;r.bC.multiply(H,H,[$/S+1,0,0,0,$/P+1,0,-.5*$/R,.5*$/B,1])}return H[2]=w,H[5]=t.x,H[8]=t.y,H},r.bf=kf,r.bg=pc,r.bh=function(t,e,i){const o=r.ad.identity(new Float64Array(16)),a=(e/(1<<t)-.5)*Math.PI*2;return r.ad.rotateY(o,i.globeMatrix,a),Float32Array.from(o)},r.bi=Cl,r.bj=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},r.bk=cw,r.bl=uw,r.bm=lw,r.bn=function(t,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<t.length;o++){const a=document.createElement("source");m(t[o])||(i.crossOrigin="Anonymous"),a.src=t[o],i.appendChild(a)}return{cancel:()=>{}}},r.bo=ig,r.bp=On,r.bq=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,o=1<<i,a=Math.floor(t.x),h=Math.floor((t.x-a)*o),f=Math.floor(t.y*o),x=this.findDEMTileFor(new jo(i,a,i,h,f));return!(!x||!x.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const o=this._source();if(!o||t.y<0||t.y>1)return e;const a=o.getSource().maxzoom,h=1<<a,f=Math.floor(t.x),x=t.x-f,w=new jo(a,f,a,Math.floor(x*h),Math.floor(t.y*h)),S=this.findDEMTileFor(w);if(!S||!S.dem)return e;const P=S.dem,R=1<<S.tileID.canonical.z,B=(x*R-S.tileID.canonical.x)*P.dim,H=(t.y*R-S.tileID.canonical.y)*P.dim,$=Math.floor(B),te=Math.floor(H);return(i?this.exaggeration():1)*Fi(Fi(P.get($,te),P.get($,te+1),H-te),Fi(P.get($+1,te),P.get($+1,te+1),H-te),B-$)}getAtTileOffset(t,e,i){const o=1<<t.canonical.z;return this.getAtPointOrZero(new Ls(t.wrap+(t.canonical.x+e/Zt)/o,(t.canonical.y+i/Zt)/o))}getAtTileOffsetFunc(t,e,i,o){return a=>{const h=this.getAtTileOffset(t,a.x,a.y),f=o.upVector(t.canonical,a.x,a.y),x=o.upVectorScale(t.canonical,e,i).metersToTile;return r._.scale(f,f,h*x),f}}getForTilePoints(t,e,i,o){if(this.isUsingMockSource())return!1;const a=cd.create(this,t,o);return!!a&&(e.forEach(h=>{h[2]=this.exaggeration()*a.getElevationAt(h[0],h[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,o=e.tileID,a=1<<t.canonical.z-o.canonical.z;let h=t.canonical.x/a-o.canonical.x,f=t.canonical.y/a-o.canonical.y,x=0;for(let w=0;w<t.canonical.z-o.canonical.z&&!i.leaves[x];w++){h*=2,f*=2;const S=2*Math.floor(f)+Math.floor(h);x=i.childOffsets[x]+S,h%=1,f%=1}return{min:this.exaggeration()*i.minimums[x],max:this.exaggeration()*i.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const a of t){const h=this.getMinMaxForTile(a.tileID);h&&(i=Math.min(i,h.min),o=Math.max(o,h.max),e=!0)}return e?{min:i,max:o}:null}},r.br=Df,r.bs=Tm,r.bt=Ol,r.bu=ss,r.bv=wh,r.bw=Cd,r.bx=fg,r.by=og,r.bz=fv,r.c=Ow,r.c$=Te,r.c0=450,r.c1=7,r.c2=bA,r.c3=iw,r.c4=256,r.c5=Jy,r.c6=J0,r.c7=Yn,r.c8=bu,r.c9=dh,r.cA=function(t){let e=1/0,i=1/0,o=-1/0,a=-1/0;for(const h of t)e=Math.min(e,h.x),i=Math.min(i,h.y),o=Math.max(o,h.x),a=Math.max(a,h.y);return{min:new Yt(e,i),max:new Yt(o,a)}},r.cB=Iu,r.cC=Vy,r.cD=Zs,r.cE=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.cF=Lx,r.cG=H0,r.cH=Mv,r.cI=Lv,r.cJ=w1,r.cK=W1,r.cL=function(t){return t({pluginStatus:wt,pluginURL:hi}),Ji.on("pluginStateChange",t),t},r.cM=md,r.cN=v1,r.cO=ja,r.cP=dn,r.cQ=Ae,r.cR=xa,r.cS=Tl,r.cT=is,r.cU=function(t){const e=t.indexOf(vu);return e>=0?t.slice(0,e):t},r.cV=function(t){return t.indexOf(vu)>=0},r.cW=function(t){const e=t.indexOf(vu);return e>=0?t.slice(e+1):""},r.cX=function(t){const e=[],i=t.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.cY=function(t,e,i,o){return t.type==="custom"?new TA(t,e):new tI[t.type](t,e,i,o)},r.cZ=Xl,r.c_=Ji,r.ca=1,r.cb=Qf,r.cc=0,r.cd=T0,r.ce=function(t,e,i,o,a){return Ki((t-e)/(i-e)*(a-o)+o,o,a)},r.cf=Cf,r.cg=gh,r.ch=class{constructor(t,e,i,o){this.context=t,this.format=o,this.size=i,this.texture=t.gl.createTexture();const[a,h,f]=this.size,{gl:x}=t;x.bindTexture(x.TEXTURE_3D,this.texture),t.pixelStoreUnpackFlipY.set(!1),t.pixelStoreUnpack.set(1),t.pixelStoreUnpackPremultiplyAlpha.set(!1);let w=this.format,S=x.UNSIGNED_BYTE;this.format===x.DEPTH_COMPONENT&&(w=x.DEPTH_COMPONENT16,S=x.UNSIGNED_SHORT),this.format===x.R8&&(o=x.RED),this.format===x.R32F&&(S=x.FLOAT,o=x.RED),x.texImage3D(x.TEXTURE_3D,0,w,a,h,f,0,o,S,e.data)}bind(t,e){const{context:i}=this,{gl:o}=i;o.bindTexture(o.TEXTURE_3D,this.texture),t!==this.minFilter&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,t),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}},r.ci=B1,r.cj=[1,1,1],r.ck=cd,r.cl=bd,r.cm=Eu,r.cn=ed,r.co=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Yt(1/0,1/0),max:new Yt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t,e=!1){const i=Sv(new Yt(0,0),new Yt(Zt,Zt),t),o=[];if(e&&!c1(i,this._globalClipBounds))return o;for(const a of this._activeRegions){if(a.hiddenByOverlap||!c1(i,a))continue;const h=CT(a.min,a.max,t);o.push({min:h.min,max:h.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId,order:a.order,clipMask:a.clipMask})}return o}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const o of e.cache.getVisibleCoordinates()){const a=e.cache.getTile(o).buckets[e.layer];a&&a.updateFootprints(o.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask})))}_addSource(t){const e=t.getFootprints();if(e.length===0)return;const i=t.getOrder(),o=t.getClipMask();for(const a of e){if(!a.footprint)continue;const h=Sv(a.footprint.min,a.footprint.max,a.id);this._activeRegions.push({min:h.min,max:h.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:a.id,footprint:a.footprint,order:i,clipMask:o})}this._sourceIds.push(t.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||Bm(e.min,i.min)||Bm(e.max,i.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0;for(;!t&&e!==this._activeRegions.length;){const i=this._activeRegions[e],o=this._prevRegions[e];t=i.priority!==o.priority||!Tv(i,o)||i.order!==o.order||i.clipMask!==o.clipMask,++e}}if(t){++this._updateTime;for(const i of this._activeRegions)i.order!==1/0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const o=this._activeRegions;if(i>=o.length)return i;const a=o[i].priority;for(;i<o.length&&o[i].priority===a;)++i;return i};if(this._sourceIds.length>1){let i=0,o=e(i);for(;i!==o;){let a=i;const h=i;for(;a!==o;){const f=this._activeRegions[a];f.hiddenByOverlap=!1;for(let x=0;x<h;x++){const w=this._activeRegions[x];if(!w.hiddenByOverlap&&f.order===1/0&&c1(f,w)&&(f.hiddenByOverlap=Iv(f.footprint,f.tileId,w.footprint,w.tileId),f.hiddenByOverlap))break}++a}i=o,o=e(i)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},r.cp=xu,r.cq=rg,r.cr=Af,r.cs=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const i=new Ol,o=new ss,a=[],h=t+1+2,f=e[0]+1,x=e[0]+1+(1+e.length),w=(S,P,R)=>{let B=S===h-1?S-2:S===0?S:S-1;return B+=R?24575:0,[B,P]};for(let S=0;S<h;++S)i.emplaceBack(...w(S,0,!0));for(let S=0;S<f;++S)for(let P=0;P<h;++P)i.emplaceBack(...w(P,S,(P===0||P===h-1)&&!0));for(let S=0;S<e.length;++S){const P=e[S];for(let R=0;R<h;++R)i.emplaceBack(...w(R,P,!0))}for(let S=0;S<e.length;++S){const P=o.length,R=e[S]+1+2,B=new ss;for(let te=0;te<R-1;te++){const ne=te===R-2,de=ne?h*(x-e.length+S-te):h;for(let Se=0;Se<h-1;Se++){const Me=te*h+Se;te===0||ne||Se===0||Se===h-2?(B.emplaceBack(Me+1,Me,Me+de),B.emplaceBack(Me+de,Me+de+1,Me+1)):(o.emplaceBack(Me+1,Me,Me+de),o.emplaceBack(Me+de,Me+de+1,Me+1))}}const H=qr.simpleSegment(0,P,i.length,o.length-P);for(let te=0;te<B.uint16.length;te+=3)o.emplaceBack(B.uint16[te],B.uint16[te+1],B.uint16[te+2]);const $=qr.simpleSegment(0,P,i.length,o.length-P);a.push({withoutSkirts:H,withSkirts:$})}return{vertices:i,indices:o,segments:a}}_createGrid(t){const e=this._fillGridMeshWithLods(id,N0);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Df.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new ss;for(let f=0;f<=id;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new dh,o=new dh,a=new dh,h=new dh;this._poleSegments=[];for(let f=0,x=0;f<B0;f++){const w=360/(1<<f);i.emplaceBack(0,-Zs,0,.5,0),o.emplaceBack(0,-Zs,0,.5,1),a.emplaceBack(0,-Zs,0,.5,.5),h.emplaceBack(0,-Zs,0,.5,.5);for(let S=0;S<=id;S++){let P=S/id,R=0;const B=Fi(0,w,P),[H,$,te]=nd(FE,zE,B,Zs);i.emplaceBack(H,$,te,P,R),o.emplaceBack(H,$,te,P,1-R);const ne=nn(B);P=.5+.5*Math.sin(ne),R=.5+.5*Math.cos(ne),a.emplaceBack(H,$,te,P,R),h.emplaceBack(H,$,te,P,1-R)}this._poleSegments.push(qr.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,Em,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(o,Em,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(a,Em,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(h,Em,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},r.ct=function(t){return Yr.has(t)},r.cu=Fv,r.cv=function(t,e,i=0,o=!0){const a=new Yt(i,i),h=t.sub(a),f=e.add(a),x=[h,new Yt(f.x,h.y),f,new Yt(h.x,f.y)];return o&&x.push(h.clone()),x},r.cw=function(t,e){const i=[];for(let o=0;o<t.length;o++){const a=Na(o-1,-1,t.length-1),h=Na(o+1,-1,t.length-1),f=t[o],x=t[h],w=t[a].sub(f).unit(),S=x.sub(f).unit(),P=S.angleWithSep(w.x,w.y),R=w.add(S).unit().mult(-1*e/Math.sin(P/2));i.push(f.add(R))}return i},r.cx=Ux,r.cy=Gy,r.cz=function(t,e,i=0){return r._.fromValues(((e.x-i)*t.scale-t.x)*Zt,(e.y*t.scale-t.y)*Zt,Ny(e.z,e.y))},r.d=qa,r.d$=ga,r.d0=fo,r.d1=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.d2=eu,r.d3=zy,r.d4=ph,r.d5=function([t,e,i]){const o=Math.hypot(t,e,i),a=Math.atan2(t,i),h=.5*Math.PI-Math.acos(-e/o);return new Vn(ho(a),ho(h))},r.d6=ca,r.d7=rd,r.d8=Y,r.d9=t1,r.dA=function(t){const e=ns();if(!e)return;const i=e.delete(Kl);t&&i.catch(t).then(()=>t())},r.dB=np,r.dC=bw,r.dD=function(t){U1=Ao.resolveURL(t),Td||(Td=new Cd(fg(),new al)),Td.broadcast("setDracoUrl",U1)},r.dE=Cw,r.dF=function(t){Ed=Ao.resolveURL(t),Td||(Td=new Cd(fg(),new al)),Td.broadcast("setMeshoptUrl",Ed)},r.dG=ya,r.dH=xe,r.dI=Mu,r.dJ=kl,r.dK=vh,r.dL=L0,r.dM=cx,r.dN=gx,r.dO=ix,r.dP=zs,r.dQ=Px,r.dR=vd,r.dS=function(t,e,i,o,a,h,f,x,w,S,P){t.createArrays(),t.tilePixelRatio=Zt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const R=t.layers[0].layout,B=t.layers[0]._unevaluatedLayout._values,H={};if(t.textSizeData.kind==="composite"){const{minZoom:de,maxZoom:Se}=t.textSizeData;H.compositeTextSizes=[B["text-size"].possiblyEvaluate(new $i(de),x),B["text-size"].possiblyEvaluate(new $i(Se),x)]}if(t.iconSizeData.kind==="composite"){const{minZoom:de,maxZoom:Se}=t.iconSizeData;H.compositeIconSizes=[B["icon-size"].possiblyEvaluate(new $i(de),x),B["icon-size"].possiblyEvaluate(new $i(Se),x)]}H.layoutTextSize=B["text-size"].possiblyEvaluate(new $i(w+1),x),H.layoutIconSize=B["icon-size"].possiblyEvaluate(new $i(w+1),x),H.textMaxSize=B["text-size"].possiblyEvaluate(new $i(18),x);const $=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",te=R.get("text-size");let ne=!1;for(const de of t.features)if(de.icon&&de.icon.nameSecondary){ne=!0;break}for(const de of t.features){const Se=R.get("text-font").evaluate(de,{},x).join(","),Me=te.evaluate(de,{},x),Le=H.layoutTextSize.evaluate(de,{},x),ze=(H.layoutIconSize.evaluate(de,{},x),{horizontal:{},vertical:void 0}),Fe=de.text;let Xe,et=[0,0];if(Fe){const dt=Fe.toString(),St=R.get("text-letter-spacing").evaluate(de,{},x)*Cs,Vt=R.get("text-line-height").evaluate(de,{},x)*Cs,bt=Pt(dt)?St:0,kt=R.get("text-anchor").evaluate(de,{},x),yt=R.get("text-variable-anchor");if(!yt){const Ut=R.get("text-radial-offset").evaluate(de,{},x);et=Ut?Nx(kt,[Ut*Cs,x1]):R.get("text-offset").evaluate(de,{},x).map(Ht=>Ht*Cs)}let Bt=$?"center":R.get("text-justify").evaluate(de,{},x);const jt=R.get("symbol-placement")==="point",zt=jt?R.get("text-max-width").evaluate(de,{},x)*Cs:1/0,ri=Ut=>{t.allowVerticalPlacement&&ft(dt)&&(ze.vertical=g1(Fe,e,i,a,Se,zt,Vt,kt,Ut,bt,et,Xa.vertical,!0,Le,Me))};if(!$&&yt){const Ut=Bt==="auto"?yt.map(Di=>w1(Di)):[Bt];let Ht=!1;for(let Di=0;Di<Ut.length;Di++){const Si=Ut[Di];if(!ze.horizontal[Si])if(Ht)ze.horizontal[Si]=ze.horizontal[0];else{const Ci=g1(Fe,e,i,a,Se,zt,Vt,"center",Si,bt,et,Xa.horizontal,!1,Le,Me);Ci&&(ze.horizontal[Si]=Ci,Ht=Ci.positionedLines.length===1)}}ri("left")}else{if(Bt==="auto"&&(Bt=w1(kt)),jt||R.get("text-writing-mode").indexOf("horizontal")>=0||!ft(dt)){const Ut=g1(Fe,e,i,a,Se,zt,Vt,kt,Bt,bt,et,Xa.horizontal,!1,Le,Me);Ut&&(ze.horizontal[Bt]=Ut)}ri(jt?"left":Bt)}}let st=!1;if(de.icon&&de.icon.namePrimary){const dt=o[de.icon.namePrimary];dt&&(Xe=CS(a[de.icon.namePrimary],de.icon.nameSecondary?a[de.icon.nameSecondary]:void 0,R.get("icon-offset").evaluate(de,{},x),R.get("icon-anchor").evaluate(de,{},x)),st=dt.sdf,t.sdfIcons===void 0?t.sdfIcons=dt.sdf:t.sdfIcons!==dt.sdf&&Dr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(dt.pixelRatio!==t.pixelRatio||R.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const _t=zx(ze.horizontal)||ze.vertical;t.iconsInText||(t.iconsInText=!!_t&&_t.iconsInText),(_t||Xe)&&LS(t,de,ze,Xe,o,H,Le,0,et,st,f,x,S,P,ne)}h&&t.generateCollisionDebugBuffers(w,t.collisionBoxArray)},r.dT=Vm,r.dU=Pm,r.dV=l1,r.dW=dd,r.dX=Nm,r.dY=P1,r.dZ=Rm,r.d_=Dm,r.da=ov,r.db=function(t){const e=[0,0,0],i=r.ad.identity(new Float64Array(16));return r.ad.multiply(i,t.pixelMatrix,t.globeMatrix),r._.transformMat4(e,e,i),new Yt(e[0],e[1])},r.dc=z,r.dd=N,r.de=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(i){if(_s==null){const o=i.navigator?i.navigator.userAgent:null;_s=!!i.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return _s}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.df=va,r.dg=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",k,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Ae(t))return t;const i=pe(t);return i.params.push(`sdk=js-${U}`),i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Ae(t))return t;const i=pe(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeModelURL(t,e){if(!Ae(t))return t;const i=pe(t);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,o){if(!Ae(t))return t;const a=pe(t);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),i&&a.params.push(`language=${i}`),o&&a.params.push(`worldview=${o}`),this._makeAPIURL(a,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,o){const a=pe(t);return Ae(t)?(a.path=`/styles/v1${a.path}/sprite${e}${i}`,this._makeAPIURL(a,this._customAccessToken||o)):(a.path+=`${e}${i}`,Ie(a))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ae(t))return t;const o=pe(t);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&o.authority!=="raster"&&i===512?"@2x":""}${sl.supported?".webp":"$1"}`),o.authority==="raster"?o.path=`/${Y.RASTER_URL_PREFIX}${o.path}`:o.authority==="rasterarrays"?o.path=`/${Y.RASTERARRAYS_URL_PREFIX}${o.path}`:o.authority==="3dtiles"?o.path=`/${Y.TILES3D_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${Y.TILE_URL_VERSION}${o.path}`);const a=this._customAccessToken||function(h){for(const f of h){const x=f.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(o.params)||Y.ACCESS_TOKEN;return Y.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,a)}canonicalizeTileURL(t,e){const i=pe(t);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let o="mapbox://";i.path.match(/^\/raster\/v1\//)?o+=`raster/${i.path.replace(`/${Y.RASTER_URL_PREFIX}/`,"")}`:i.path.match(/^\/rasterarrays\/v1\//)?o+=`rasterarrays/${i.path.replace(`/${Y.RASTERARRAYS_URL_PREFIX}/`,"")}`:o+=`tiles/${i.path.replace(`/${Y.TILE_URL_VERSION}/`,"")}`;let a=i.params;return e&&(a=a.filter(h=>!h.match(/^access_token=/))),a.length&&(o+=`?${a.join("&")}`),o}canonicalizeTileset(t,e){const i=!!e&&Ae(e),o=[];for(const a of t.tiles||[])se(a)?o.push(this.canonicalizeTileURL(a,i)):o.push(a);return o}_makeAPIURL(t,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",o=pe(Y.API_URL);if(t.protocol=o.protocol,t.authority=o.authority,t.protocol==="http"){const a=t.params.indexOf("secure");a>=0&&t.params.splice(a,1)}if(o.path!=="/"&&(t.path=`${o.path}${t.path}`),!Y.REQUIRE_ACCESS_TOKEN)return Ie(t);if(e=e||Y.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(a=>a.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Ie(t)}},r.dh=function(t,e){e?Yr.add(t):Yr.delete(t)},r.di=sl,r.dj=wn,r.dk=Ss,r.dl=j,r.dm=mi,r.dn=ai,r.dp=function(t){Yr.delete(t)},r.dq=yo,r.dr=Rt,r.ds=ls,r.dt=U,r.du=function(t,e){qs=t,tu=e},r.dv=function(t,e,i=!1){if(wt===Qt||wt===ni||wt===Jt)throw new Error("setRTLTextPlugin cannot be called multiple times.");hi=Ao.resolveURL(t),wt=Qt,Wt=e,ji(),i||Sr()},r.dw=Cn,r.dx=function(){fg().acquire(V1)},r.dy=function(){const t=op;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(V1),op=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.dz=rp,r.e=Ao,r.e0=ux,r.e1=G,r.e2=c,r.e3=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==Tw){const i=new Uint32Array(t,0,7),[,,o,a,h,f]=i;e=i.byteLength+a+h+f+h,(o!==t.byteLength||e>=t.byteLength)&&Dr("Invalid b3dm header information.")}return Mw(t,e)},r.e4=function(t,e){const i=Ow(t);for(const o of i){for(const a of o.meshes)KA(a);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(QA(o.lights,e)))}return i},r.e5=_g,r.e6=ww,r.e7=vn,r.e8=function(t){ol(),Ko&&Ko.then(e=>{e.keys().then(i=>{for(let o=0;o<i.length-t;o++)e.delete(i[o])})})},r.f=vs,r.g=function(t,e){return Te(An(t,{type:"json"}),e)},r.h=L,r.i=Za,r.j=Ox,r.k=y1,r.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>Mw(e,0,t))},r.m=class extends hg{},r.n=Sa,r.o=Qu,r.p=qS,r.q=Tf,r.r=n,r.s=l,r.t=le,r.u=Ms,r.v=xs,r.w=Dr,r.x=_e,r.y=ue,r.z=Hh}),E(["./shared"],function(r){function U(ve){const re=ve?ve.url.toString():void 0;return re?performance.getEntriesByName(re):[]}function W(ve){if(typeof ve=="number"||typeof ve=="boolean"||typeof ve=="string"||ve==null)return JSON.stringify(ve);if(Array.isArray(ve)){let ae="[";for(const Ee of ve)ae+=`${W(Ee)},`;return`${ae}]`}let re="{";for(const ae of Object.keys(ve).sort())re+=`${ae}:${W(ve[ae])},`;return`${re}}`}function Y(ve){let re="";for(const ae of r.cE)re+=`/${W(ve[ae])}`;return re}class se{constructor(re){this.keyCache={},this._layers={},this._layerConfigs={},re&&this.replace(re)}replace(re,ae){this._layerConfigs={},this._layers={},this.update(re,[],ae)}update(re,ae,Ee){this._options=Ee;for(const Re of re)this._layerConfigs[Re.id]=Re,(this._layers[Re.id]=r.cY(Re,this.scope,null,this._options)).compileFilter(),this.keyCache[Re.id]&&delete this.keyCache[Re.id];for(const Re of ae)delete this.keyCache[Re],delete this._layerConfigs[Re],delete this._layers[Re];this.familiesBySource={};const Oe=function(Re,je){const Je={};for(let rt=0;rt<Re.length;rt++){const ht=je&&je[Re[rt].id]||Y(Re[rt]);je&&(je[Re[rt].id]=ht);let pt=Je[ht];pt||(pt=Je[ht]=[]),pt.push(Re[rt])}const Ge=[];for(const rt in Je)Ge.push(Je[rt]);return Ge}(r.dG(this._layerConfigs),this.keyCache);for(const Re of Oe){const je=Re.map($t=>this._layers[$t.id]),Je=je[0];if(Je.visibility==="none")continue;const Ge=Je.source||"";let rt=this.familiesBySource[Ge];rt||(rt=this.familiesBySource[Ge]={});const ht=Je.sourceLayer||"_geojsonTileLayer";let pt=rt[ht];pt||(pt=rt[ht]=[]),pt.push(je)}}}const Ae=1*r.dJ;class Ce{constructor(re){const ae={},Ee=[];for(const Je in re){const Ge=re[Je],rt=ae[Je]={};for(const ht in Ge.glyphs){const pt=Ge.glyphs[+ht];if(!pt||pt.bitmap.width===0||pt.bitmap.height===0)continue;const $t=pt.metrics.localGlyph?Ae:1,oi={x:0,y:0,w:pt.bitmap.width+2*$t,h:pt.bitmap.height+2*$t};Ee.push(oi),rt[ht]=oi}}const{w:Oe,h:Re}=r.j(Ee),je=new r.dI({width:Oe||1,height:Re||1});for(const Je in re){const Ge=re[Je];for(const rt in Ge.glyphs){const ht=Ge.glyphs[+rt];if(!ht||ht.bitmap.width===0||ht.bitmap.height===0)continue;const pt=ae[Je][rt],$t=ht.metrics.localGlyph?Ae:1;r.dI.copy(ht.bitmap,je,{x:0,y:0},{x:pt.x+$t,y:pt.y+$t},ht.bitmap)}}this.image=je,this.positions=ae}}r.dH(Ce,"GlyphAtlas");class he{constructor(re){this.tileID=new r.aL(re.tileID.overscaledZ,re.tileID.wrap,re.tileID.canonical.z,re.tileID.canonical.x,re.tileID.canonical.y),this.tileZoom=re.tileZoom,this.uid=re.uid,this.zoom=re.zoom,this.lut=re.lut,this.canonical=re.tileID.canonical,this.pixelRatio=re.pixelRatio,this.tileSize=re.tileSize,this.source=re.source,this.scope=re.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=re.showCollisionBoxes,this.collectResourceTiming=!!re.collectResourceTiming,this.promoteId=re.promoteId,this.isSymbolTile=re.isSymbolTile,this.tileTransform=r.dK(re.tileID.canonical,re.projection),this.projection=re.projection,this.brightness=re.brightness,this.extraShadowCaster=!!re.extraShadowCaster,this.tessellationStep=re.tessellationStep}parse(re,ae,Ee,Oe,Re){this.status="parsing",this.data=re,this.collisionBoxArray=new r.dL;const je=new r.dM(Object.keys(re.layers).sort()),Je=new r.dN(this.tileID,this.promoteId);Je.bucketLayerIDs=[];const Ge={},rt=new r.dO(256,256),ht={featureIndex:Je,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:rt,availableImages:Ee,brightness:this.brightness},pt=ae.familiesBySource[this.source];for(const Gt in pt){const Yi=re.layers[Gt];if(!Yi)continue;let ei=!1,ii=!1,yi=!1;for(const Dn of pt[Gt])Dn[0].type==="symbol"?ei=!0:ii=!0,Dn[0].is3D()&&Dn[0].type!=="model"&&(yi=!0);if(this.extraShadowCaster&&!yi||this.isSymbolTile===!0&&!ei||this.isSymbolTile===!1&&!ii)continue;Yi.version===1&&r.w(`Vector tile source "${this.source}" layer "${Gt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Xi=je.encode(Gt),tn=[];for(let Dn=0;Dn<Yi.length;Dn++){const pn=Yi.feature(Dn),Ar=Je.getId(pn,Gt);tn.push({feature:pn,id:Ar,index:Dn,sourceLayerIndex:Xi})}for(const Dn of pt[Gt]){const pn=Dn[0];(!this.extraShadowCaster||pn.is3D()&&pn.type!=="model")&&(this.isSymbolTile!==void 0&&pn.type==="symbol"!==this.isSymbolTile||pn.minzoom&&this.zoom<Math.floor(pn.minzoom)||pn.maxzoom&&this.zoom>=pn.maxzoom||pn.visibility!=="none"&&(K(Dn,this.zoom,ht.brightness,Ee),(Ge[pn.id]=pn.createBucket({index:Je.bucketLayerIDs.length,layers:Dn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Xi,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(tn,ht,this.tileID.canonical,this.tileTransform),Je.bucketLayerIDs.push(Dn.map(Ar=>Ar.id))))}}let $t,oi,bi,mt;rt.trim();const Ti={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ui=()=>{if($t)return this.status="done",Re($t);if(this.extraShadowCaster)this.status="done",Re(null,{buckets:r.dG(Ge).filter(Gt=>!Gt.isEmpty()),featureIndex:Je,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ht.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(oi&&bi&&mt){const Gt=new Ce(oi),Yi=new r.dQ(bi,mt,this.lut);for(const ei in Ge){const ii=Ge[ei];ii instanceof r.dR?(K(ii.layers,this.zoom,ht.brightness,Ee),r.dS(ii,oi,Gt.positions,bi,Yi.iconPositions,this.showCollisionBoxes,Ee,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):ii.hasPattern&&(ii instanceof r.dT||ii instanceof r.dU||ii instanceof r.b_)&&(K(ii.layers,this.zoom,ht.brightness,Ee),ii.addFeatures(ht,this.tileID.canonical,Yi.patternPositions,Ee,this.tileTransform,this.brightness))}this.status="done",Re(null,{buckets:r.dG(Ge).filter(ei=>!ei.isEmpty()),featureIndex:Je,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Gt.image,lineAtlas:rt,imageAtlas:Yi,brightness:ht.brightness})}};if(!this.extraShadowCaster){const Gt=r.dP(ht.glyphDependencies,ii=>Object.keys(ii).map(Number));Object.keys(Gt).length?Oe.send("getGlyphs",{uid:this.uid,stacks:Gt,scope:this.scope},(ii,yi)=>{$t||($t=ii,oi=yi,ui())},void 0,!1,Ti):oi={};const Yi=Object.keys(ht.iconDependencies);Yi.length?Oe.send("getImages",{icons:Yi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(ii,yi)=>{$t||($t=ii,bi=yi,ui())},void 0,!1,Ti):bi={};const ei=Object.keys(ht.patternDependencies);ei.length?Oe.send("getImages",{icons:ei,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(ii,yi)=>{$t||($t=ii,mt=yi,ui())},void 0,!1,Ti):mt={}}ui()}}function K(ve,re,ae,Ee){const Oe=new r.X(re,{brightness:ae});for(const Re of ve)Re.recalculate(Oe,Ee)}class N extends r.E{constructor(re,ae,Ee,Oe,Re,je){super(),this.actor=re,this.layerIndex=ae,this.availableImages=Ee,this.loadVectorData=Re||r.ap,this.loading={},this.loaded={},this.deduped=new r.ao(re.scheduler),this.isSpriteLoaded=Oe,this.scheduler=re.scheduler,this.brightness=je}loadTile(re,ae){const Ee=re.uid,Oe=re&&re.request,Re=Oe&&Oe.collectResourceTiming,je=this.loading[Ee]=new he(re);je.abort=this.loadVectorData(re,(Je,Ge)=>{const rt=!this.loading[Ee];if(delete this.loading[Ee],rt||Je||!Ge)return je.status="done",rt||(this.loaded[Ee]=je),ae(Je);const ht=Ge.rawData,pt={};Ge.expires&&(pt.expires=Ge.expires),Ge.cacheControl&&(pt.cacheControl=Ge.cacheControl),je.vectorTile=Ge.vectorTile||new r.dV(new r.dW(ht));const $t=()=>{je.parse(je.vectorTile,this.layerIndex,this.availableImages,this.actor,(oi,bi)=>{if(oi||!bi)return ae(oi);const mt={};if(Re){const Ti=U(Oe);Ti.length>0&&(mt.resourceTiming=JSON.parse(JSON.stringify(Ti)))}ae(null,r.W({rawTileData:ht.slice(0)},bi,pt,mt))})};this.isSpriteLoaded?$t():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add($t,{type:"parseTile",isSymbolTile:re.isSymbolTile,zoom:re.tileZoom}):$t()}),this.loaded=this.loaded||{},this.loaded[Ee]=je})}reloadTile(re,ae){const Ee=this.loaded,Oe=re.uid;if(Ee&&Ee[Oe]){const Re=Ee[Oe];Re.showCollisionBoxes=re.showCollisionBoxes,Re.projection=re.projection,Re.brightness=re.brightness,Re.tileTransform=r.dK(re.tileID.canonical,re.projection),Re.extraShadowCaster=re.extraShadowCaster,Re.lut=re.lut;const je=(Je,Ge)=>{const rt=Re.reloadCallback;rt&&(delete Re.reloadCallback,Re.parse(Re.vectorTile,this.layerIndex,this.availableImages,this.actor,rt)),ae(Je,Ge)};Re.status==="parsing"?Re.reloadCallback=je:Re.status==="done"&&(Re.vectorTile?Re.parse(Re.vectorTile,this.layerIndex,this.availableImages,this.actor,je):je())}else ae(null,void 0)}abortTile(re,ae){const Ee=re.uid,Oe=this.loading[Ee];Oe&&(Oe.abort&&Oe.abort(),delete this.loading[Ee]),ae()}removeTile(re,ae){const Ee=this.loaded,Oe=re.uid;Ee&&Ee[Oe]&&delete Ee[Oe],ae()}}class z{loadTile(re,ae){const{uid:Ee,encoding:Oe,rawImageData:Re,padding:je}=re,Je=ImageBitmap&&Re instanceof ImageBitmap?this.getImageData(Re,je):Re;ae(null,new r.dX(Ee,Je,Oe,je<1))}getImageData(re,ae){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(re.width,re.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=re.width,this.offscreenCanvas.height=re.height,this.offscreenCanvasContext.drawImage(re,0,0,re.width,re.height);const Ee=this.offscreenCanvasContext.getImageData(-ae,-ae,re.width+2*ae,re.height+2*ae);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Ee}}class q{decodeRasterArray({task:re,buffer:ae},Ee){r.dY.performDecoding(ae,re).then(Oe=>{Ee(null,Oe)},Oe=>{Ee(Oe)})}}const G=r.dZ.prototype.toGeoJSON;let Q=class{constructor(ve){this._feature=ve,this.extent=r.a3,this.type=ve.type,this.properties=ve.tags,"id"in ve&&!isNaN(ve.id)&&(this.id=parseInt(ve.id,10))}loadGeometry(){if(this._feature.type===1){const ve=[];for(const re of this._feature.geometry)ve.push([new r.P(re[0],re[1])]);return ve}{const ve=[];for(const re of this._feature.geometry){const ae=[];for(const Ee of re)ae.push(new r.P(Ee[0],Ee[1]));ve.push(ae)}return ve}}toGeoJSON(ve,re,ae){return G.call(this,ve,re,ae)}},ee=class{constructor(ve){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.a3,this.length=ve.length,this._features=ve}feature(ve){return new Q(this._features[ve])}};const fe=64/4096;class ce{constructor(){this.features=new Map}clear(){this.features.clear()}load(re=[],ae){for(const Ee of re){const Oe=Ee.id;if(Oe==null)continue;let Re=this.features.get(Oe);Re&&this.updateCache(Re,ae),Ee.geometry?(Re=He(Ee),this.updateCache(Re,ae),this.features.set(Oe,Re)):this.features.delete(Oe),this.updateCache(Re,ae)}}updateCache(re,ae){for(const{canonical:Ee,uid:Oe}of Object.values(ae)){const{z:Re,x:je,y:Je}=Ee;Ue(re,Math.pow(2,Re),je,Je)&&delete ae[Oe]}}getTile(re,ae,Ee){const Oe=Math.pow(2,re),Re=[];for(const je of this.features.values())Ue(je,Oe,ae,Ee)&&Re.push(Ot(je,Oe,ae,Ee));return{features:Re}}getFeatures(){return[...this.features.values()]}}function Ue({minX:ve,minY:re,maxX:ae,maxY:Ee},Oe,Re,je){return ve<(Re+1+fe)/Oe&&re<(je+1+fe)/Oe&&ae>(Re-fe)/Oe&&Ee>(je-fe)/Oe}function He(ve){const{id:re,geometry:ae,properties:Ee}=ve;if(!ae)return;if(ae.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Oe,coordinates:Re}=ae,je={id:re,type:1,geometry:[],tags:Ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Je=je.geometry;if(Oe==="Point")nt(Re,Je,je);else if(Oe==="MultiPoint")for(const Ge of Re)nt(Ge,Je,je);else if(Oe==="LineString")je.type=2,vt(Re,Je,je);else if(Oe==="MultiLineString")je.type=2,xt(Re,Je,je);else if(Oe==="Polygon")je.type=3,xt(Re,Je,je,!0);else{if(Oe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");je.type=3;for(const Ge of Re)xt(Ge,Je,je,!0)}return je}function nt([ve,re],ae,Ee){const Oe=r.aj(ve);let Re=r.ak(re);Re=Re<0?0:Re>1?1:Re,ae.push(Oe,Re),Ee.minX=Math.min(Ee.minX,Oe),Ee.minY=Math.min(Ee.minY,Re),Ee.maxX=Math.max(Ee.maxX,Oe),Ee.maxY=Math.max(Ee.maxY,Re)}function vt(ve,re,ae,Ee=!1,Oe=!1){const Re=[];for(const je of ve)nt(je,Re,ae);re.push(Re),Ee&&function(je,Je){let Ge=0;for(let rt=0,ht=je.length,pt=ht-2;rt<ht;pt=rt,rt+=2)Ge+=(je[rt]-je[pt])*(je[rt+1]+je[pt+1]);if(Ge>0===Je)for(let rt=0,ht=je.length;rt<ht/2;rt+=2){const pt=je[rt],$t=je[rt+1];je[rt]=je[ht-2-rt],je[rt+1]=je[ht-1-rt],je[ht-2-rt]=pt,je[ht-1-rt]=$t}}(Re,Oe)}function xt(ve,re,ae,Ee=!1){for(let Oe=0;Oe<ve.length;Oe++)vt(ve[Oe],re,ae,Ee,Oe===0)}function Ot(ve,re,ae,Ee){const{id:Oe,type:Re,geometry:je,tags:Je}=ve,Ge=[];if(Re===1)Ui(je,re,ae,Ee,Ge);else for(const rt of je)Ge.push(Ui(rt,re,ae,Ee));return{id:Oe,type:Re,geometry:Ge,tags:Je}}function Ui(ve,re,ae,Ee,Oe=[]){for(let Re=0;Re<ve.length;Re+=2)Oe.push(Mt(ve[Re],ve[Re+1],re,ae,Ee));return Oe}function Mt(ve,re,ae,Ee,Oe){return[Math.round(r.a3*(ve*ae-Ee)),Math.round(r.a3*(re*ae-Oe))]}var _i={exports:{}},di=r.d$,Un=r.d_.VectorTileFeature,Nn=Vi;function Vi(ve,re){this.options=re||{},this.features=ve,this.length=ve.length}function Vr(ve,re){this.id=typeof ve.id=="number"?ve.id:void 0,this.type=ve.type,this.rawGeometry=ve.type===1?[ve.geometry]:ve.geometry,this.properties=ve.tags,this.extent=re||4096}Vi.prototype.feature=function(ve){return new Vr(this.features[ve],this.options.extent)},Vr.prototype.loadGeometry=function(){var ve=this.rawGeometry;this.geometry=[];for(var re=0;re<ve.length;re++){for(var ae=ve[re],Ee=[],Oe=0;Oe<ae.length;Oe++)Ee.push(new di(ae[Oe][0],ae[Oe][1]));this.geometry.push(Ee)}return this.geometry},Vr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ve=this.geometry,re=1/0,ae=-1/0,Ee=1/0,Oe=-1/0,Re=0;Re<ve.length;Re++)for(var je=ve[Re],Je=0;Je<je.length;Je++){var Ge=je[Je];re=Math.min(re,Ge.x),ae=Math.max(ae,Ge.x),Ee=Math.min(Ee,Ge.y),Oe=Math.max(Oe,Ge.y)}return[re,Ee,ae,Oe]},Vr.prototype.toGeoJSON=Un.prototype.toGeoJSON;var Oi=r.e0,ir=Nn;function fn(ve){var re=new Oi;return function(ae,Ee){for(var Oe in ae.layers)Ee.writeMessage(3,At,ae.layers[Oe])}(ve,re),re.finish()}function At(ve,re){var ae;re.writeVarintField(15,ve.version||1),re.writeStringField(1,ve.name||""),re.writeVarintField(5,ve.extent||4096);var Ee={keys:[],values:[],keycache:{},valuecache:{}};for(ae=0;ae<ve.length;ae++)Ee.feature=ve.feature(ae),re.writeMessage(2,Ri,Ee);var Oe=Ee.keys;for(ae=0;ae<Oe.length;ae++)re.writeStringField(3,Oe[ae]);var Re=Ee.values;for(ae=0;ae<Re.length;ae++)re.writeMessage(4,Sn,Re[ae])}function Ri(ve,re){var ae=ve.feature;ae.id!==void 0&&re.writeVarintField(1,ae.id),re.writeMessage(2,Lr,ve),re.writeVarintField(3,ae.type),re.writeMessage(4,Qi,ae)}function Lr(ve,re){var ae=ve.feature,Ee=ve.keys,Oe=ve.values,Re=ve.keycache,je=ve.valuecache;for(var Je in ae.properties){var Ge=ae.properties[Je],rt=Re[Je];if(Ge!==null){rt===void 0&&(Ee.push(Je),Re[Je]=rt=Ee.length-1),re.writeVarint(rt);var ht=typeof Ge;ht!=="string"&&ht!=="boolean"&&ht!=="number"&&(Ge=JSON.stringify(Ge));var pt=ht+":"+Ge,$t=je[pt];$t===void 0&&(Oe.push(Ge),je[pt]=$t=Oe.length-1),re.writeVarint($t)}}}function si(ve,re){return(re<<3)+(7&ve)}function zi(ve){return ve<<1^ve>>31}function Qi(ve,re){for(var ae=ve.loadGeometry(),Ee=ve.type,Oe=0,Re=0,je=ae.length,Je=0;Je<je;Je++){var Ge=ae[Je],rt=1;Ee===1&&(rt=Ge.length),re.writeVarint(si(1,rt));for(var ht=Ee===3?Ge.length-1:Ge.length,pt=0;pt<ht;pt++){pt===1&&Ee!==1&&re.writeVarint(si(2,ht-1));var $t=Ge[pt].x-Oe,oi=Ge[pt].y-Re;re.writeVarint(zi($t)),re.writeVarint(zi(oi)),Oe+=$t,Re+=oi}Ee===3&&re.writeVarint(si(7,1))}}function Sn(ve,re){var ae=typeof ve;ae==="string"?re.writeStringField(1,ve):ae==="boolean"?re.writeBooleanField(7,ve):ae==="number"&&(ve%1!=0?re.writeDoubleField(3,ve):ve<0?re.writeSVarintField(6,ve):re.writeVarintField(5,ve))}_i.exports=fn,_i.exports.fromVectorTileJs=fn,_i.exports.fromGeojsonVt=function(ve,re){re=re||{};var ae={};for(var Ee in ve)ae[Ee]=new ir(ve[Ee].features,re),ae[Ee].name=Ee,ae[Ee].version=re.version,ae[Ee].extent=re.extent;return fn({layers:ae})},_i.exports.GeoJSONWrapper=ir;var Co=r.e1(_i.exports);const fi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ve=>ve},$r=Math.fround||(Or=new Float32Array(1),ve=>(Or[0]=+ve,Or[0]));var Or;const Hi=3,Hn=5,Fn=6;class ti{constructor(re){this.options=Object.assign(Object.create(fi),re),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(re){const{log:ae,minZoom:Ee,maxZoom:Oe}=this.options;ae&&console.time("total time");const Re=`prepare ${re.length} points`;ae&&console.time(Re),this.points=re;const je=[];for(let Ge=0;Ge<re.length;Ge++){const rt=re[Ge];if(!rt.geometry)continue;const[ht,pt]=rt.geometry.coordinates,$t=$r(on(ht)),oi=$r(Do(pt));je.push($t,oi,1/0,Ge,-1,1),this.options.reduce&&je.push(0)}let Je=this.trees[Oe+1]=this._createTree(je);ae&&console.timeEnd(Re);for(let Ge=Oe;Ge>=Ee;Ge--){const rt=+Date.now();Je=this.trees[Ge]=this._createTree(this._cluster(Je,Ge)),ae&&console.log("z%d: %d clusters in %dms",Ge,Je.numItems,+Date.now()-rt)}return ae&&console.timeEnd("total time"),this}getClusters(re,ae){let Ee=((re[0]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,re[1]));let Re=re[2]===180?180:((re[2]+180)%360+360)%360-180;const je=Math.max(-90,Math.min(90,re[3]));if(re[2]-re[0]>=360)Ee=-180,Re=180;else if(Ee>Re){const pt=this.getClusters([Ee,Oe,180,je],ae),$t=this.getClusters([-180,Oe,Re,je],ae);return pt.concat($t)}const Je=this.trees[this._limitZoom(ae)],Ge=Je.range(on(Ee),Do(je),on(Re),Do(Oe)),rt=Je.data,ht=[];for(const pt of Ge){const $t=this.stride*pt;ht.push(rt[$t+Hn]>1?Ii(rt,$t,this.clusterProps):this.points[rt[$t+Hi]])}return ht}getChildren(re){const ae=this._getOriginId(re),Ee=this._getOriginZoom(re),Oe="No cluster with the specified id.",Re=this.trees[Ee];if(!Re)throw new Error(Oe);const je=Re.data;if(ae*this.stride>=je.length)throw new Error(Oe);const Je=this.options.radius/(this.options.extent*Math.pow(2,Ee-1)),Ge=Re.within(je[ae*this.stride],je[ae*this.stride+1],Je),rt=[];for(const ht of Ge){const pt=ht*this.stride;je[pt+4]===re&&rt.push(je[pt+Hn]>1?Ii(je,pt,this.clusterProps):this.points[je[pt+Hi]])}if(rt.length===0)throw new Error(Oe);return rt}getLeaves(re,ae,Ee){const Oe=[];return this._appendLeaves(Oe,re,ae=ae||10,Ee=Ee||0,0),Oe}getTile(re,ae,Ee){const Oe=this.trees[this._limitZoom(re)],Re=Math.pow(2,re),{extent:je,radius:Je}=this.options,Ge=Je/je,rt=(Ee-Ge)/Re,ht=(Ee+1+Ge)/Re,pt={features:[]};return this._addTileFeatures(Oe.range((ae-Ge)/Re,rt,(ae+1+Ge)/Re,ht),Oe.data,ae,Ee,Re,pt),ae===0&&this._addTileFeatures(Oe.range(1-Ge/Re,rt,1,ht),Oe.data,Re,Ee,Re,pt),ae===Re-1&&this._addTileFeatures(Oe.range(0,rt,Ge/Re,ht),Oe.data,-1,Ee,Re,pt),pt.features.length?pt:null}getClusterExpansionZoom(re){let ae=this._getOriginZoom(re)-1;for(;ae<=this.options.maxZoom;){const Ee=this.getChildren(re);if(ae++,Ee.length!==1)break;re=Ee[0].properties.cluster_id}return ae}_appendLeaves(re,ae,Ee,Oe,Re){const je=this.getChildren(ae);for(const Je of je){const Ge=Je.properties;if(Ge&&Ge.cluster?Re+Ge.point_count<=Oe?Re+=Ge.point_count:Re=this._appendLeaves(re,Ge.cluster_id,Ee,Oe,Re):Re<Oe?Re++:re.push(Je),re.length===Ee)break}return Re}_createTree(re){const ae=new r.cK(re.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ee=0;Ee<re.length;Ee+=this.stride)ae.add(re[Ee],re[Ee+1]);return ae.finish(),ae.data=re,ae}_addTileFeatures(re,ae,Ee,Oe,Re,je){for(const Je of re){const Ge=Je*this.stride,rt=ae[Ge+Hn]>1;let ht,pt,$t;if(rt)ht=wi(ae,Ge,this.clusterProps),pt=ae[Ge],$t=ae[Ge+1];else{const mt=this.points[ae[Ge+Hi]];ht=mt.properties;const[Ti,ui]=mt.geometry.coordinates;pt=on(Ti),$t=Do(ui)}const oi={type:1,geometry:[[Math.round(this.options.extent*(pt*Re-Ee)),Math.round(this.options.extent*($t*Re-Oe))]],tags:ht};let bi;bi=rt||this.options.generateId?ae[Ge+Hi]:this.points[ae[Ge+Hi]].id,bi!==void 0&&(oi.id=bi),je.features.push(oi)}}_limitZoom(re){return Math.max(this.options.minZoom,Math.min(Math.floor(+re),this.options.maxZoom+1))}_cluster(re,ae){const{radius:Ee,extent:Oe,reduce:Re,minPoints:je}=this.options,Je=Ee/(Oe*Math.pow(2,ae)),Ge=re.data,rt=[],ht=this.stride;for(let pt=0;pt<Ge.length;pt+=ht){if(Ge[pt+2]<=ae)continue;Ge[pt+2]=ae;const $t=Ge[pt],oi=Ge[pt+1],bi=re.within(Ge[pt],Ge[pt+1],Je),mt=Ge[pt+Hn];let Ti=mt;for(const ui of bi){const Gt=ui*ht;Ge[Gt+2]>ae&&(Ti+=Ge[Gt+Hn])}if(Ti>mt&&Ti>=je){let ui,Gt=$t*mt,Yi=oi*mt,ei=-1;const ii=(pt/ht<<5)+(ae+1)+this.points.length;for(const yi of bi){const Xi=yi*ht;if(Ge[Xi+2]<=ae)continue;Ge[Xi+2]=ae;const tn=Ge[Xi+Hn];Gt+=Ge[Xi]*tn,Yi+=Ge[Xi+1]*tn,Ge[Xi+4]=ii,Re&&(ui||(ui=this._map(Ge,pt,!0),ei=this.clusterProps.length,this.clusterProps.push(ui)),Re(ui,this._map(Ge,Xi)))}Ge[pt+4]=ii,rt.push(Gt/Ti,Yi/Ti,1/0,ii,-1,Ti),Re&&rt.push(ei)}else{for(let ui=0;ui<ht;ui++)rt.push(Ge[pt+ui]);if(Ti>1)for(const ui of bi){const Gt=ui*ht;if(!(Ge[Gt+2]<=ae)){Ge[Gt+2]=ae;for(let Yi=0;Yi<ht;Yi++)rt.push(Ge[Gt+Yi])}}}}return rt}_getOriginId(re){return re-this.points.length>>5}_getOriginZoom(re){return(re-this.points.length)%32}_map(re,ae,Ee){if(re[ae+Hn]>1){const je=this.clusterProps[re[ae+Fn]];return Ee?Object.assign({},je):je}const Oe=this.points[re[ae+Hi]].properties,Re=this.options.map(Oe);return Ee&&Re===Oe?Object.assign({},Re):Re}}function Ii(ve,re,ae){return{type:"Feature",id:ve[re+Hi],properties:wi(ve,re,ae),geometry:{type:"Point",coordinates:[(Ee=ve[re],360*(Ee-.5)),so(ve[re+1])]}};var Ee}function wi(ve,re,ae){const Ee=ve[re+Hn],Oe=Ee>=1e4?`${Math.round(Ee/1e3)}k`:Ee>=1e3?Math.round(Ee/100)/10+"k":Ee,Re=ve[re+Fn],je=Re===-1?{}:Object.assign({},ae[Re]);return Object.assign(je,{cluster:!0,cluster_id:ve[re+Hi],point_count:Ee,point_count_abbreviated:Oe})}function on(ve){return ve/360+.5}function Do(ve){const re=Math.sin(ve*Math.PI/180),ae=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return ae<0?0:ae>1?1:ae}function so(ve){const re=(180-360*ve)*Math.PI/180;return 360*Math.atan(Math.exp(re))/Math.PI-90}function Go(ve,re,ae,Ee){let Oe=Ee;const Re=re+(ae-re>>1);let je,Je=ae-re;const Ge=ve[re],rt=ve[re+1],ht=ve[ae],pt=ve[ae+1];for(let $t=re+3;$t<ae;$t+=3){const oi=Pr(ve[$t],ve[$t+1],Ge,rt,ht,pt);if(oi>Oe)je=$t,Oe=oi;else if(oi===Oe){const bi=Math.abs($t-Re);bi<Je&&(je=$t,Je=bi)}}Oe>Ee&&(je-re>3&&Go(ve,re,je,Ee),ve[je+2]=Oe,ae-je>3&&Go(ve,je,ae,Ee))}function Pr(ve,re,ae,Ee,Oe,Re){let je=Oe-ae,Je=Re-Ee;if(je!==0||Je!==0){const Ge=((ve-ae)*je+(re-Ee)*Je)/(je*je+Je*Je);Ge>1?(ae=Oe,Ee=Re):Ge>0&&(ae+=je*Ge,Ee+=Je*Ge)}return je=ve-ae,Je=re-Ee,je*je+Je*Je}function Ro(ve,re,ae,Ee){const Oe={id:ve??null,type:re,geometry:ae,tags:Ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(re==="Point"||re==="MultiPoint"||re==="LineString")ao(Oe,ae);else if(re==="Polygon")ao(Oe,ae[0]);else if(re==="MultiLineString")for(const Re of ae)ao(Oe,Re);else if(re==="MultiPolygon")for(const Re of ae)ao(Oe,Re[0]);return Oe}function ao(ve,re){for(let ae=0;ae<re.length;ae+=3)ve.minX=Math.min(ve.minX,re[ae]),ve.minY=Math.min(ve.minY,re[ae+1]),ve.maxX=Math.max(ve.maxX,re[ae]),ve.maxY=Math.max(ve.maxY,re[ae+1])}function yr(ve,re,ae,Ee){if(!re.geometry)return;const Oe=re.geometry.coordinates;if(Oe&&Oe.length===0)return;const Re=re.geometry.type,je=Math.pow(ae.tolerance/((1<<ae.maxZoom)*ae.extent),2);let Je=[],Ge=re.id;if(ae.promoteId?Ge=re.properties[ae.promoteId]:ae.generateId&&(Ge=Ee||0),Re==="Point")ko(Oe,Je);else if(Re==="MultiPoint")for(const rt of Oe)ko(rt,Je);else if(Re==="LineString")Bo(Oe,Je,je,!1);else if(Re==="MultiLineString"){if(ae.lineMetrics){for(const rt of Oe)Je=[],Bo(rt,Je,je,!1),ve.push(Ro(Ge,"LineString",Je,re.properties));return}Wo(Oe,Je,je,!1)}else if(Re==="Polygon")Wo(Oe,Je,je,!0);else{if(Re!=="MultiPolygon"){if(Re==="GeometryCollection"){for(const rt of re.geometry.geometries)yr(ve,{id:Ge,geometry:rt,properties:re.properties},ae,Ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const rt of Oe){const ht=[];Wo(rt,ht,je,!0),Je.push(ht)}}ve.push(Ro(Ge,Re,Je,re.properties))}function ko(ve,re){re.push(er(ve[0]),pi(ve[1]),0)}function Bo(ve,re,ae,Ee){let Oe,Re,je=0;for(let Ge=0;Ge<ve.length;Ge++){const rt=er(ve[Ge][0]),ht=pi(ve[Ge][1]);re.push(rt,ht,0),Ge>0&&(je+=Ee?(Oe*ht-rt*Re)/2:Math.sqrt(Math.pow(rt-Oe,2)+Math.pow(ht-Re,2))),Oe=rt,Re=ht}const Je=re.length-3;re[2]=1,Go(re,0,Je,ae),re[Je+2]=1,re.size=Math.abs(je),re.start=0,re.end=re.size}function Wo(ve,re,ae,Ee){for(let Oe=0;Oe<ve.length;Oe++){const Re=[];Bo(ve[Oe],Re,ae,Ee),re.push(Re)}}function er(ve){return ve/360+.5}function pi(ve){const re=Math.sin(ve*Math.PI/180),ae=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return ae<0?0:ae>1?1:ae}function xi(ve,re,ae,Ee,Oe,Re,je,Je){if(Ee/=re,Re>=(ae/=re)&&je<Ee)return ve;if(je<ae||Re>=Ee)return null;const Ge=[];for(const rt of ve){const ht=rt.geometry;let pt=rt.type;const $t=Oe===0?rt.minX:rt.minY,oi=Oe===0?rt.maxX:rt.maxY;if($t>=ae&&oi<Ee){Ge.push(rt);continue}if(oi<ae||$t>=Ee)continue;let bi=[];if(pt==="Point"||pt==="MultiPoint")Gn(ht,bi,ae,Ee,Oe);else if(pt==="LineString")an(ht,bi,ae,Ee,Oe,!1,Je.lineMetrics);else if(pt==="MultiLineString")Ds(ht,bi,ae,Ee,Oe,!1);else if(pt==="Polygon")Ds(ht,bi,ae,Ee,Oe,!0);else if(pt==="MultiPolygon")for(const mt of ht){const Ti=[];Ds(mt,Ti,ae,Ee,Oe,!0),Ti.length&&bi.push(Ti)}if(bi.length){if(Je.lineMetrics&&pt==="LineString"){for(const mt of bi)Ge.push(Ro(rt.id,pt,mt,rt.tags));continue}pt!=="LineString"&&pt!=="MultiLineString"||(bi.length===1?(pt="LineString",bi=bi[0]):pt="MultiLineString"),pt!=="Point"&&pt!=="MultiPoint"||(pt=bi.length===3?"Point":"MultiPoint"),Ge.push(Ro(rt.id,pt,bi,rt.tags))}}return Ge.length?Ge:null}function Gn(ve,re,ae,Ee,Oe){for(let Re=0;Re<ve.length;Re+=3){const je=ve[Re+Oe];je>=ae&&je<=Ee&&$o(re,ve[Re],ve[Re+1],ve[Re+2])}}function an(ve,re,ae,Ee,Oe,Re,je){let Je=Jo(ve);const Ge=Oe===0?gn:No;let rt,ht,pt=ve.start;for(let Ti=0;Ti<ve.length-3;Ti+=3){const ui=ve[Ti],Gt=ve[Ti+1],Yi=ve[Ti+2],ei=ve[Ti+3],ii=ve[Ti+4],yi=Oe===0?ui:Gt,Xi=Oe===0?ei:ii;let tn=!1;je&&(rt=Math.sqrt(Math.pow(ui-ei,2)+Math.pow(Gt-ii,2))),yi<ae?Xi>ae&&(ht=Ge(Je,ui,Gt,ei,ii,ae),je&&(Je.start=pt+rt*ht)):yi>Ee?Xi<Ee&&(ht=Ge(Je,ui,Gt,ei,ii,Ee),je&&(Je.start=pt+rt*ht)):$o(Je,ui,Gt,Yi),Xi<ae&&yi>=ae&&(ht=Ge(Je,ui,Gt,ei,ii,ae),tn=!0),Xi>Ee&&yi<=Ee&&(ht=Ge(Je,ui,Gt,ei,ii,Ee),tn=!0),!Re&&tn&&(je&&(Je.end=pt+rt*ht),re.push(Je),Je=Jo(ve)),je&&(pt+=rt)}let $t=ve.length-3;const oi=ve[$t],bi=ve[$t+1],mt=Oe===0?oi:bi;mt>=ae&&mt<=Ee&&$o(Je,oi,bi,ve[$t+2]),$t=Je.length-3,Re&&$t>=3&&(Je[$t]!==Je[0]||Je[$t+1]!==Je[1])&&$o(Je,Je[0],Je[1],Je[2]),Je.length&&re.push(Je)}function Jo(ve){const re=[];return re.size=ve.size,re.start=ve.start,re.end=ve.end,re}function Ds(ve,re,ae,Ee,Oe,Re){for(const je of ve)an(je,re,ae,Ee,Oe,Re,!1)}function $o(ve,re,ae,Ee){ve.push(re,ae,Ee)}function gn(ve,re,ae,Ee,Oe,Re){const je=(Re-re)/(Ee-re);return $o(ve,Re,ae+(Oe-ae)*je,1),je}function No(ve,re,ae,Ee,Oe,Re){const je=(Re-ae)/(Oe-ae);return $o(ve,re+(Ee-re)*je,Re,1),je}function Es(ve,re){const ae=[];for(let Ee=0;Ee<ve.length;Ee++){const Oe=ve[Ee],Re=Oe.type;let je;if(Re==="Point"||Re==="MultiPoint"||Re==="LineString")je=Ur(Oe.geometry,re);else if(Re==="MultiLineString"||Re==="Polygon"){je=[];for(const Je of Oe.geometry)je.push(Ur(Je,re))}else if(Re==="MultiPolygon"){je=[];for(const Je of Oe.geometry){const Ge=[];for(const rt of Je)Ge.push(Ur(rt,re));je.push(Ge)}}ae.push(Ro(Oe.id,Re,je,Oe.tags))}return ae}function Ur(ve,re){const ae=[];ae.size=ve.size,ve.start!==void 0&&(ae.start=ve.start,ae.end=ve.end);for(let Ee=0;Ee<ve.length;Ee+=3)ae.push(ve[Ee]+re,ve[Ee+1],ve[Ee+2]);return ae}function Tr(ve,re){if(ve.transformed)return ve;const ae=1<<ve.z,Ee=ve.x,Oe=ve.y;for(const Re of ve.features){const je=Re.geometry,Je=Re.type;if(Re.geometry=[],Je===1)for(let Ge=0;Ge<je.length;Ge+=2)Re.geometry.push(Rs(je[Ge],je[Ge+1],re,ae,Ee,Oe));else for(let Ge=0;Ge<je.length;Ge++){const rt=[];for(let ht=0;ht<je[Ge].length;ht+=2)rt.push(Rs(je[Ge][ht],je[Ge][ht+1],re,ae,Ee,Oe));Re.geometry.push(rt)}}return ve.transformed=!0,ve}function Rs(ve,re,ae,Ee,Oe,Re){return[Math.round(ae*(ve*Ee-Oe)),Math.round(ae*(re*Ee-Re))]}function tr(ve,re,ae,Ee,Oe){const Re=re===Oe.maxZoom?0:Oe.tolerance/((1<<re)*Oe.extent),je={features:[],numPoints:0,numSimplified:0,numFeatures:ve.length,source:null,x:ae,y:Ee,z:re,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Je of ve)Fo(je,Je,Re,Oe);return je}function Fo(ve,re,ae,Ee){const Oe=re.geometry,Re=re.type,je=[];if(ve.minX=Math.min(ve.minX,re.minX),ve.minY=Math.min(ve.minY,re.minY),ve.maxX=Math.max(ve.maxX,re.maxX),ve.maxY=Math.max(ve.maxY,re.maxY),Re==="Point"||Re==="MultiPoint")for(let Je=0;Je<Oe.length;Je+=3)je.push(Oe[Je],Oe[Je+1]),ve.numPoints++,ve.numSimplified++;else if(Re==="LineString")Eo(je,Oe,ve,ae,!1,!1);else if(Re==="MultiLineString"||Re==="Polygon")for(let Je=0;Je<Oe.length;Je++)Eo(je,Oe[Je],ve,ae,Re==="Polygon",Je===0);else if(Re==="MultiPolygon")for(let Je=0;Je<Oe.length;Je++){const Ge=Oe[Je];for(let rt=0;rt<Ge.length;rt++)Eo(je,Ge[rt],ve,ae,!0,rt===0)}if(je.length){let Je=re.tags||null;if(Re==="LineString"&&Ee.lineMetrics){Je={};for(const rt in re.tags)Je[rt]=re.tags[rt];Je.mapbox_clip_start=Oe.start/Oe.size,Je.mapbox_clip_end=Oe.end/Oe.size}const Ge={geometry:je,type:Re==="Polygon"||Re==="MultiPolygon"?3:Re==="LineString"||Re==="MultiLineString"?2:1,tags:Je};re.id!==null&&(Ge.id=re.id),ve.features.push(Ge)}}function Eo(ve,re,ae,Ee,Oe,Re){const je=Ee*Ee;if(Ee>0&&re.size<(Oe?je:Ee))return void(ae.numPoints+=re.length/3);const Je=[];for(let Ge=0;Ge<re.length;Ge+=3)(Ee===0||re[Ge+2]>je)&&(ae.numSimplified++,Je.push(re[Ge],re[Ge+1])),ae.numPoints++;Oe&&function(Ge,rt){let ht=0;for(let pt=0,$t=Ge.length,oi=$t-2;pt<$t;oi=pt,pt+=2)ht+=(Ge[pt]-Ge[oi])*(Ge[pt+1]+Ge[oi+1]);if(ht>0===rt)for(let pt=0,$t=Ge.length;pt<$t/2;pt+=2){const oi=Ge[pt],bi=Ge[pt+1];Ge[pt]=Ge[$t-2-pt],Ge[pt+1]=Ge[$t-1-pt],Ge[$t-2-pt]=oi,Ge[$t-1-pt]=bi}}(Je,Re),ve.push(Je)}const uo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class yn{constructor(re,ae){const Ee=(ae=this.options=function(Re,je){for(const Je in je)Re[Je]=je[Je];return Re}(Object.create(uo),ae)).debug;if(Ee&&console.time("preprocess data"),ae.maxZoom<0||ae.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ae.promoteId&&ae.generateId)throw new Error("promoteId and generateId cannot be used together.");let Oe=function(Re,je){const Je=[];if(Re.type==="FeatureCollection")for(let Ge=0;Ge<Re.features.length;Ge++)yr(Je,Re.features[Ge],je,Ge);else yr(Je,Re.type==="Feature"?Re:{geometry:Re},je);return Je}(re,ae);this.tiles={},this.tileCoords=[],Ee&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ae.indexMaxZoom,ae.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Oe=function(Re,je){const Je=je.buffer/je.extent;let Ge=Re;const rt=xi(Re,1,-1-Je,Je,0,-1,2,je),ht=xi(Re,1,1-Je,2+Je,0,-1,2,je);return(rt||ht)&&(Ge=xi(Re,1,-Je,1+Je,0,-1,2,je)||[],rt&&(Ge=Es(rt,1).concat(Ge)),ht&&(Ge=Ge.concat(Es(ht,-1)))),Ge}(Oe,ae),Oe.length&&this.splitTile(Oe,0,0,0),Ee&&(Oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(re,ae,Ee,Oe,Re,je,Je){const Ge=[re,ae,Ee,Oe],rt=this.options,ht=rt.debug;for(;Ge.length;){Oe=Ge.pop(),Ee=Ge.pop(),ae=Ge.pop(),re=Ge.pop();const pt=1<<ae,$t=Kn(ae,Ee,Oe);let oi=this.tiles[$t];if(!oi&&(ht>1&&console.time("creation"),oi=this.tiles[$t]=tr(re,ae,Ee,Oe,rt),this.tileCoords.push({z:ae,x:Ee,y:Oe}),ht)){ht>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ae,Ee,Oe,oi.numFeatures,oi.numPoints,oi.numSimplified),console.timeEnd("creation"));const tn=`z${ae}`;this.stats[tn]=(this.stats[tn]||0)+1,this.total++}if(oi.source=re,Re==null){if(ae===rt.indexMaxZoom||oi.numPoints<=rt.indexMaxPoints)continue}else{if(ae===rt.maxZoom||ae===Re)continue;if(Re!=null){const tn=Re-ae;if(Ee!==je>>tn||Oe!==Je>>tn)continue}}if(oi.source=null,re.length===0)continue;ht>1&&console.time("clipping");const bi=.5*rt.buffer/rt.extent,mt=.5-bi,Ti=.5+bi,ui=1+bi;let Gt=null,Yi=null,ei=null,ii=null,yi=xi(re,pt,Ee-bi,Ee+Ti,0,oi.minX,oi.maxX,rt),Xi=xi(re,pt,Ee+mt,Ee+ui,0,oi.minX,oi.maxX,rt);re=null,yi&&(Gt=xi(yi,pt,Oe-bi,Oe+Ti,1,oi.minY,oi.maxY,rt),Yi=xi(yi,pt,Oe+mt,Oe+ui,1,oi.minY,oi.maxY,rt),yi=null),Xi&&(ei=xi(Xi,pt,Oe-bi,Oe+Ti,1,oi.minY,oi.maxY,rt),ii=xi(Xi,pt,Oe+mt,Oe+ui,1,oi.minY,oi.maxY,rt),Xi=null),ht>1&&console.timeEnd("clipping"),Ge.push(Gt||[],ae+1,2*Ee,2*Oe),Ge.push(Yi||[],ae+1,2*Ee,2*Oe+1),Ge.push(ei||[],ae+1,2*Ee+1,2*Oe),Ge.push(ii||[],ae+1,2*Ee+1,2*Oe+1)}}getTile(re,ae,Ee){re=+re,ae=+ae,Ee=+Ee;const Oe=this.options,{extent:Re,debug:je}=Oe;if(re<0||re>24)return null;const Je=1<<re,Ge=Kn(re,ae=ae+Je&Je-1,Ee);if(this.tiles[Ge])return Tr(this.tiles[Ge],Re);je>1&&console.log("drilling down to z%d-%d-%d",re,ae,Ee);let rt,ht=re,pt=ae,$t=Ee;for(;!rt&&ht>0;)ht--,pt>>=1,$t>>=1,rt=this.tiles[Kn(ht,pt,$t)];return rt&&rt.source?(je>1&&(console.log("found parent tile z%d-%d-%d",ht,pt,$t),console.time("drilling down")),this.splitTile(rt.source,ht,pt,$t,re,ae,Ee),je>1&&console.timeEnd("drilling down"),this.tiles[Ge]?Tr(this.tiles[Ge],Re):null):null}}function Kn(ve,re,ae){return 32*((1<<ve)*ae+re)+ve}function To(ve,re){const ae=ve.tileID.canonical;if(!this._geoJSONIndex)return re(null,null);const Ee=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!Ee)return re(null,null);const Oe=new ee(Ee.features);let Re=Co(Oe);Re.byteOffset===0&&Re.byteLength===Re.buffer.byteLength||(Re=new Uint8Array(Re)),re(null,{vectorTile:Oe,rawData:Re.buffer})}class Cr extends N{constructor(re,ae,Ee,Oe,Re,je){super(re,ae,Ee,Oe,To,je),Re&&(this.loadGeoJSON=Re),this._dynamicIndex=new ce}loadData(re,ae){const Ee=re&&re.request,Oe=Ee&&Ee.collectResourceTiming;this.loadGeoJSON(re,(Re,je)=>{if(Re||!je)return ae(Re);if(typeof je!="object")return ae(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`));{try{if(re.filter){const Ge=r.y(re.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ge.result==="error")throw new Error(Ge.value.map(rt=>`${rt.key}: ${rt.message}`).join(", "));je.features=je.features.filter(rt=>Ge.value.evaluate({zoom:0},rt))}re.dynamic?(je.type==="Feature"&&(je={type:"FeatureCollection",features:[je]}),re.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(je.features,this.loaded),re.cluster&&(je.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=re.cluster?new ti(function({superclusterOptions:Ge,clusterProperties:rt}){if(!rt||!Ge)return Ge;const ht={},pt={},$t={accumulated:null,zoom:0},oi={properties:null},bi=Object.keys(rt);for(const mt of bi){const[Ti,ui]=rt[mt],Gt=r.y(ui),Yi=r.y(typeof Ti=="string"?[Ti,["accumulated"],["get",mt]]:Ti);ht[mt]=Gt.value,pt[mt]=Yi.value}return Ge.map=mt=>{oi.properties=mt;const Ti={};for(const ui of bi)Ti[ui]=ht[ui].evaluate($t,oi);return Ti},Ge.reduce=(mt,Ti)=>{oi.properties=Ti;for(const ui of bi)$t.accumulated=mt[ui],mt[ui]=pt[ui].evaluate($t,oi)},Ge}(re)).load(je.features):re.dynamic?this._dynamicIndex:function(Ge,rt){return new yn(Ge,rt)}(je,re.geojsonVtOptions)}catch(Ge){return ae(Ge)}const Je={};if(Oe){const Ge=U(Ee);Ge&&(Je.resourceTiming={},Je.resourceTiming[re.source]=JSON.parse(JSON.stringify(Ge)))}ae(null,Je)}})}reloadTile(re,ae){const Ee=this.loaded;return Ee&&Ee[re.uid]?re.partial?ae(null,void 0):super.reloadTile(re,ae):this.loadTile(re,ae)}loadGeoJSON(re,ae){if(re.request)r.g(re.request,ae);else{if(typeof re.data!="string")return ae(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`));try{return ae(null,JSON.parse(re.data))}catch{return ae(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(re,ae){try{ae(null,this._geoJSONIndex.getClusterExpansionZoom(re.clusterId))}catch(Ee){ae(Ee)}}getClusterChildren(re,ae){try{ae(null,this._geoJSONIndex.getChildren(re.clusterId))}catch(Ee){ae(Ee)}}getClusterLeaves(re,ae){try{ae(null,this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset))}catch(Ee){ae(Ee)}}}class hr{constructor(re,ae){this.tileID=new r.aL(re.tileID.overscaledZ,re.tileID.wrap,re.tileID.canonical.z,re.tileID.canonical.x,re.tileID.canonical.y),this.tileZoom=re.tileZoom,this.uid=re.uid,this.zoom=re.zoom,this.canonical=re.tileID.canonical,this.pixelRatio=re.pixelRatio,this.tileSize=re.tileSize,this.source=re.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=re.projection,this.brightness=ae}parse(re,ae,Ee,Oe){this.status="parsing";const Re=new r.aL(Ee.tileID.overscaledZ,Ee.tileID.wrap,Ee.tileID.canonical.z,Ee.tileID.canonical.x,Ee.tileID.canonical.y),je={},Je=ae.familiesBySource[Ee.source],Ge=new r.dN(Re,Ee.promoteId);return Ge.bucketLayerIDs=[],Ge.is3DTile=!0,r.e3(re).then(rt=>{if(!rt)return Oe(new Error("Could not parse tile"));const ht=r.e4(rt,1/r.b5(Ee.tileID.canonical)),pt=rt.json.extensionsUsed&&rt.json.extensionsUsed.includes("MAPBOX_mesh_features")||rt.json.asset.extras&&rt.json.asset.extras.MAPBOX_mesh_features,$t=rt.json.extensionsUsed&&rt.json.extensionsUsed.includes("EXT_meshopt_compression"),oi=new r.X(this.zoom,{brightness:this.brightness});for(const bi in Je)for(const mt of Je[bi]){const Ti=mt[0];Ge.bucketLayerIDs.push(mt.map(Gt=>Gt.id)),Ti.recalculate(oi,[]);const ui=new r.e5(ht,Re,pt,$t,this.brightness,Ge);pt||(ui.needsUpload=!0),je[Ti.fqid]=ui,ui.evaluate(Ti)}this.status="done",Oe(null,{buckets:je,featureIndex:Ge})}).catch(rt=>Oe(new Error(rt.message)))}}class nr{constructor(re,ae,Ee,Oe,Re,je){this.actor=re,this.layerIndex=ae,this.brightness=je,this.loading={},this.loaded={}}loadTile(re,ae){const Ee=re.uid,Oe=this.loading[Ee]=new hr(re,this.brightness);r.e2(re.request,(Re,je)=>{const Je=!this.loading[Ee];return delete this.loading[Ee],Je||Re?(Oe.status="done",Je||(this.loaded[Ee]=Oe),ae(Re)):je&&je.byteLength!==0?void Oe.parse(je,this.layerIndex,re,(Ge,rt)=>{Oe.status="done",this.loaded=this.loaded||{},this.loaded[Ee]=Oe,Ge||!rt?ae(Ge):ae(null,rt)}):(Oe.status="done",this.loaded[Ee]=Oe,ae())})}reloadTile(re,ae){const Ee=this.loaded,Oe=re.uid;if(Ee&&Ee[Oe]){const Re=Ee[Oe];Re.projection=re.projection,Re.brightness=re.brightness;const je=(Je,Ge)=>{Re.reloadCallback&&(delete Re.reloadCallback,this.loadTile(re,ae)),ae(Je,Ge)};Re.status==="parsing"?Re.reloadCallback=je:Re.status==="done"&&this.loadTile(re,ae)}}abortTile(re,ae){const Ee=re.uid;this.loading[Ee]&&delete this.loading[Ee],ae()}removeTile(re,ae){const Ee=this.loaded,Oe=re.uid;Ee&&Ee[Oe]&&delete Ee[Oe],ae()}}class Ke{constructor(re){this.self=re,this.actor=new r.e6(re,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.aJ({name:"mercator"}),this.workerSourceTypes={vector:N,geojson:Cr,"batched-model":nr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ae,Ee)=>{if(this.workerSourceTypes[ae])throw new Error(`Worker source with name "${ae}" already registered.`);this.workerSourceTypes[ae]=Ee},this.self.registerRTLTextPlugin=ae=>{if(r.e7.isParsed())throw new Error("RTL text plugin already registered.");r.e7.applyArabicShaping=ae.applyArabicShaping,r.e7.processBidirectionalText=ae.processBidirectionalText,r.e7.processStyledBidirectionalText=ae.processStyledBidirectionalText}}clearCaches(re,ae,Ee){delete this.layerIndexes[re],delete this.availableImages[re],delete this.workerSources[re],delete this.demWorkerSources[re],delete this.rasterArrayWorkerSource,Ee()}checkIfReady(re,ae,Ee){Ee()}setReferrer(re,ae){this.referrer=ae}spriteLoaded(re,{scope:ae,isLoaded:Ee}){if(this.isSpriteLoaded[re]||(this.isSpriteLoaded[re]={}),this.isSpriteLoaded[re][ae]=Ee,this.workerSources[re]&&this.workerSources[re][ae])for(const Oe in this.workerSources[re][ae]){const Re=this.workerSources[re][ae][Oe];for(const je in Re){const Je=Re[je];Je instanceof N&&(Je.isSpriteLoaded=Ee,Je.fire(new r.f("isSpriteLoaded")))}}}setImages(re,{scope:ae,images:Ee},Oe){if(this.availableImages[re]||(this.availableImages[re]={}),this.availableImages[re][ae]=Ee,this.workerSources[re]&&this.workerSources[re][ae]){for(const Re in this.workerSources[re][ae]){const je=this.workerSources[re][ae][Re];for(const Je in je)je[Je].availableImages=Ee}Oe()}else Oe()}setProjection(re,ae){this.projections[re]=r.aJ(ae)}setBrightness(re,ae,Ee){this.brightness=ae,Ee()}setLayers(re,ae,Ee){this.getLayerIndex(re,ae.scope).replace(ae.layers,ae.options),Ee()}updateLayers(re,ae,Ee){this.getLayerIndex(re,ae.scope).update(ae.layers,ae.removedIds,ae.options),Ee()}loadTile(re,ae,Ee){ae.projection=this.projections[re]||this.defaultProjection,this.getWorkerSource(re,ae.type,ae.source,ae.scope).loadTile(ae,Ee)}loadDEMTile(re,ae,Ee){this.getDEMWorkerSource(re,ae.source,ae.scope).loadTile(ae,Ee)}decodeRasterArray(re,ae,Ee){this.getRasterArrayWorkerSource().decodeRasterArray(ae,Ee)}reloadTile(re,ae,Ee){ae.projection=this.projections[re]||this.defaultProjection,this.getWorkerSource(re,ae.type,ae.source,ae.scope).reloadTile(ae,Ee)}abortTile(re,ae,Ee){this.getWorkerSource(re,ae.type,ae.source,ae.scope).abortTile(ae,Ee)}removeTile(re,ae,Ee){this.getWorkerSource(re,ae.type,ae.source,ae.scope).removeTile(ae,Ee)}removeSource(re,ae,Ee){if(!(this.workerSources[re]&&this.workerSources[re][ae.scope]&&this.workerSources[re][ae.scope][ae.type]&&this.workerSources[re][ae.scope][ae.type][ae.source]))return;const Oe=this.workerSources[re][ae.scope][ae.type][ae.source];delete this.workerSources[re][ae.scope][ae.type][ae.source],Oe.removeSource!==void 0?Oe.removeSource(ae,Ee):Ee()}loadWorkerSource(re,ae,Ee){try{this.self.importScripts(ae.url),Ee()}catch(Oe){Ee(Oe.toString())}}syncRTLPluginState(re,ae,Ee){try{r.e7.setState(ae);const Oe=r.e7.getPluginURL();if(r.e7.isLoaded()&&!r.e7.isParsed()&&Oe!=null){this.self.importScripts(Oe);const Re=r.e7.isParsed();Ee(Re?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Oe}`),Re)}}catch(Oe){Ee(Oe.toString())}}setDracoUrl(re,ae){this.dracoUrl=ae}getAvailableImages(re,ae){this.availableImages[re]||(this.availableImages[re]={});let Ee=this.availableImages[re][ae];return Ee||(Ee=[]),Ee}getLayerIndex(re,ae){this.layerIndexes[re]||(this.layerIndexes[re]={});let Ee=this.layerIndexes[re][ae];return Ee||(Ee=this.layerIndexes[re][ae]=new se,Ee.scope=ae),Ee}getWorkerSource(re,ae,Ee,Oe){return this.workerSources[re]||(this.workerSources[re]={}),this.workerSources[re][Oe]||(this.workerSources[re][Oe]={}),this.workerSources[re][Oe][ae]||(this.workerSources[re][Oe][ae]={}),this.isSpriteLoaded[re]||(this.isSpriteLoaded[re]={}),this.workerSources[re][Oe][ae][Ee]||(this.workerSources[re][Oe][ae][Ee]=new this.workerSourceTypes[ae]({send:(Re,je,Je,Ge,rt,ht)=>{this.actor.send(Re,je,Je,re,rt,ht)},scheduler:this.actor.scheduler},this.getLayerIndex(re,Oe),this.getAvailableImages(re,Oe),this.isSpriteLoaded[re][Oe],void 0,this.brightness)),this.workerSources[re][Oe][ae][Ee]}getDEMWorkerSource(re,ae,Ee){return this.demWorkerSources[re]||(this.demWorkerSources[re]={}),this.demWorkerSources[re][Ee]||(this.demWorkerSources[re][Ee]={}),this.demWorkerSources[re][Ee][ae]||(this.demWorkerSources[re][Ee][ae]=new z),this.demWorkerSources[re][Ee][ae]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new q),this.rasterArrayWorkerSource}enforceCacheSizeLimit(re,ae){r.e8(ae)}getWorkerPerformanceMetrics(re,ae,Ee){Ee(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ke(self)),Ke}),E(["./shared"],function(r){function U(p,n){if(Array.isArray(p)){if(!Array.isArray(n)||p.length!==n.length)return!1;for(let l=0;l<p.length;l++)if(!U(p[l],n[l]))return!1;return!0}if(typeof p=="object"&&p!==null&&n!==null){if(typeof n!="object"||Object.keys(p).length!==Object.keys(n).length)return!1;for(const l in p)if(!U(p[l],n[l]))return!1;return!0}return p===n}var W=Y;function Y(p){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,b,T=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(T);try{b=new Worker(M),y=!0}catch{y=!1}return b&&b.terminate(),URL.revokeObjectURL(M),y}()?function(){var y=document.createElement("canvas");y.width=y.height=1;var b=y.getContext("2d");if(!b)return!1;var T=b.getImageData(0,0,1,1);return T&&T.width===y.width}()?(se[l=n&&n.failIfMajorPerformanceCaveat]===void 0&&(se[l]=function(y){var b,T=function(M){var D=document.createElement("canvas"),F=Object.create(Y.webGLContextAttributes);return F.failIfMajorPerformanceCaveat=M,D.getContext("webgl2",F)}(y);if(!T)return!1;try{b=T.createShader(T.VERTEX_SHADER)}catch{return!1}return!(!b||T.isContextLost())&&(T.shaderSource(b,"void main() {}"),T.compileShader(b),T.getShaderParameter(b,T.COMPILE_STATUS)===!0)}(l)),se[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var l}(p)}var se={};function Ae(p,n,l){const y=document.createElement(p);return n!=null&&(y.className=n),l&&l.appendChild(y),y}function Ce(p,n,l){const y=document.createElementNS("http://www.w3.org/2000/svg",p);for(const b of Object.keys(n))y.setAttributeNS(null,b,String(n[b]));return l&&l.appendChild(y),y}Y.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const he=typeof document<"u"?document.documentElement&&document.documentElement.style:null,K=he&&he.userSelect!==void 0?"userSelect":"WebkitUserSelect";let N;function z(){he&&K&&(N=he[K],he[K]="none")}function q(){he&&K&&(he[K]=N)}function G(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",G,!0)}function Q(){window.addEventListener("click",G,!0),window.setTimeout(()=>{window.removeEventListener("click",G,!0)},0)}function ee(p,n){const l=p.getBoundingClientRect();return Ue(p,l,n)}function fe(p,n){const l=p.getBoundingClientRect(),y=[];for(let b=0;b<n.length;b++)y.push(Ue(p,l,n[b]));return y}function ce(p){return window.InstallTrigger!==void 0&&p.button===2&&p.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function Ue(p,n,l){const y=p.offsetWidth===n.width?1:p.offsetWidth/n.width;return new r.P((l.clientX-n.left)*y,(l.clientY-n.top)*y)}class He{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,l){this._updatedSourceCaches[n]=l,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const l=n.scope;this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._updatedLayers[l].add(n.id),this.setDirty()}removeLayer(n){const l=n.scope;this._removedLayers[l]=this._removedLayers[l]||{},this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._removedLayers[l][n.id]=n,this._updatedLayers[l].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const l in this._updatedLayers)n[l]=n[l]||{},n[l].updatedIds=Array.from(this._updatedLayers[l].values());for(const l in this._removedLayers)n[l]=n[l]||{},n[l].removedIds=Object.keys(this._removedLayers[l]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(n){this._updatedImages.add(n),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const nt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class vt{constructor(n,l,y,b,T,M){this.length=l.length,this.attributes=y,this.itemSize=l.bytesPerElement,this.dynamicDraw=b,this.instanceCount=M,this.context=n;const D=n.gl;this.buffer=D.createBuffer(),n.bindVertexBuffer.set(this.buffer),D.bufferData(D.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?D.DYNAMIC_DRAW:D.STATIC_DRAW),this.dynamicDraw||T||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,l){for(let y=0;y<this.attributes.length;y++){const b=l.attributes[this.attributes[y].name];b!==void 0&&n.enableVertexAttribArray(b)}}setVertexAttribPointers(n,l,y){for(let b=0;b<this.attributes.length;b++){const T=this.attributes[b],M=l.attributes[T.name];M!==void 0&&n.vertexAttribPointer(M,T.components,n[nt[T.type]],!1,this.itemSize,T.offset+this.itemSize*(y||0))}}setVertexAttribDivisor(n,l,y){for(let b=0;b<this.attributes.length;b++){const T=l.attributes[this.attributes[b].name];T!==void 0&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(T,y)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class xt{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ot extends xt{getDefault(){return r.C.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Ui extends xt{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Mt extends xt{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class _i extends xt{getDefault(){return[!0,!0,!0,!0]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class di extends xt{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Un extends xt{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Nn extends xt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const l=this.current;(n.func!==l.func||n.ref!==l.ref||n.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Vi extends xt{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Vr extends xt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=n,this.dirty=!1}}class Oi extends xt{getDefault(){return[0,1]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class ir extends xt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=n,this.dirty=!1}}class fn extends xt{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class At extends xt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.BLEND):l.disable(l.BLEND),this.current=n,this.dirty=!1}}class Ri extends xt{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Lr extends xt{getDefault(){return r.C.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class si extends xt{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class zi extends xt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=n,this.dirty=!1}}class Qi extends xt{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Sn extends xt{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let Co=class extends xt{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class fi extends xt{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class $r extends xt{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Or extends xt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Hi extends xt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Hn extends xt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Fn extends xt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class ti extends xt{getDefault(){return null}set(n){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Ii extends xt{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class wi extends xt{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class on extends xt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Do extends xt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class so extends xt{constructor(n,l){super(n),this.context=n,this.parent=l}getDefault(){return null}}class Go extends so{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Pr extends so{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ro extends so{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,this.attachment(),l.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class ao extends Pr{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class yr{constructor(n,l,y,b,T){this.context=n,this.width=l,this.height=y;const M=this.framebuffer=n.gl.createFramebuffer();b&&(this.colorAttachment=new Go(n,M)),T&&(this.depthAttachmentType=T,this.depthAttachment=T==="renderbuffer"?new Pr(n,M):new Ro(n,M))}destroy(){const n=this.context.gl;if(this.colorAttachment){const l=this.colorAttachment.get();l&&n.deleteTexture(l)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const l=this.depthAttachment.get();l&&n.deleteRenderbuffer(l)}else{const l=this.depthAttachment.get();l&&n.deleteTexture(l)}n.deleteFramebuffer(this.framebuffer)}}class ko{constructor(n,l){this.gl=n,this.clearColor=new Ot(this),this.clearDepth=new Ui(this),this.clearStencil=new Mt(this),this.colorMask=new _i(this),this.depthMask=new di(this),this.stencilMask=new Un(this),this.stencilFunc=new Nn(this),this.stencilOp=new Vi(this),this.stencilTest=new Vr(this),this.depthRange=new Oi(this),this.depthTest=new ir(this),this.depthFunc=new fn(this),this.blend=new At(this),this.blendFunc=new Ri(this),this.blendColor=new Lr(this),this.blendEquation=new si(this),this.cullFace=new zi(this),this.cullFaceSide=new Qi(this),this.frontFace=new Sn(this),this.program=new Co(this),this.activeTexture=new fi(this),this.viewport=new $r(this),this.bindFramebuffer=new Or(this),this.bindRenderbuffer=new Hi(this),this.bindTexture=new Hn(this),this.bindVertexBuffer=new Fn(this),this.bindElementBuffer=new ti(this),this.bindVertexArrayOES=new Ii(this),this.pixelStoreUnpack=new wi(this),this.pixelStoreUnpackPremultiplyAlpha=new on(this),this.pixelStoreUnpackFlipY=new Do(this),this.options=l?{...l}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,l,y){return new r.I(this,n,l,y)}createVertexBuffer(n,l,y,b,T){return new vt(this,n,l,y,b,T)}createRenderbuffer(n,l,y){const b=this.gl,T=b.createRenderbuffer();return this.bindRenderbuffer.set(T),b.renderbufferStorage(b.RENDERBUFFER,n,l,y),this.bindRenderbuffer.set(null),T}createFramebuffer(n,l,y,b){return new yr(this,n,l,y,b)}clear({color:n,depth:l,stencil:y,colorMask:b}){const T=this.gl;let M=0;n&&(M|=T.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set(b||[!0,!0,!0,!0])),l!==void 0&&(M|=T.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),y!==void 0&&(M|=T.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),T.clear(M)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){U(n.blendFunction,r.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Bo{constructor(n){this._gl=n.gl,this._query=this._gl.createQuery(),this._isFree=!0}begin(){this._gl.beginQuery(this._gl.ANY_SAMPLES_PASSED,this._query),this._isFree=!1}end(){this._gl.endQuery(this._gl.ANY_SAMPLES_PASSED)}isResultAvailable(){return this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE)}consumeResult(){const n=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT);return this._isFree=!0,n}isFree(){return this._isFree}destroy(){this._gl.deleteQuery(this._query)}}class Wo{constructor(n){this.useOcclusionQueries=!0,this.visualizeOcclusions="none",this.occlusionQueryFrameWindow=5,this.occluderSize=32,this.fadeSpeed=7,this.depthOffset=-1e-4,n.registerParameter(this,["Symbols"],"useOcclusionQueries"),n.registerParameter(this,["Symbols"],"visualizeOcclusions",{options:{none:"none",zPass:"zPass",zTest:"zTest"}}),n.registerParameter(this,["Symbols"],"occlusionQueryFrameWindow",{min:1,max:30,step:1}),n.registerParameter(this,["Symbols"],"occluderSize",{min:1,max:100,step:1}),n.registerParameter(this,["Symbols"],"fadeSpeed",{min:.1,max:50,step:.1}),n.registerParameter(this,["Symbols"],"depthOffset",{min:-.001,max:0,step:1e-4})}}class er{constructor(n,l,y,b){const T={width:y[0],height:y[1],data:null},M=n.gl;this.targetColorTexture=new r.T(n,T,M.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new r.T(n,T,M.RGBA,{useMipmap:!1}),this.context=n,this.updateParticleTexture(l,b),this.lastInvalidatedAt=0}updateParticleTexture(n,l){if(this.particleTextureDimension===l.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const y=this.context.gl,b=l.width*l.height;this.particleTexture0=new r.T(this.context,l,y.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,l,y.RGBA,{premultiply:!1,useMipmap:!1});const T=new r.S;T.reserve(b);for(let M=0;M<b;M++)T.emplaceBack(M);this.particleIndexBuffer=this.context.createVertexBuffer(T,r.p.members,!0),this.particleSegment=r.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=l.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=r.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class pi extends r.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.numModelsLoading={}}loadModel(n,l){return r.l(this.requestManager.transformRequest(l,r.R.Model).url).then(y=>{if(!y)return;const b=r.c(y),T=new r.M(n,void 0,void 0,b);return T.computeBoundsAndApplyParent(),T}).catch(y=>{if(y&&y.status===404)return null;this.fire(new r.d(new Error(`Could not load model ${n} from ${l}: ${y.message}`)))})}load(n,l){this.models[l]||(this.models[l]={});const y=Object.keys(n);this.numModelsLoading[l]=(this.numModelsLoading[l]||0)+y.length;const b=[];for(const T of y)b.push(this.loadModel(T,n[T]));Promise.allSettled(b).then(T=>{for(let M=0;M<T.length;M++){const{status:D,value:F}=T[M];D==="fulfilled"&&F&&(this.models[l][y[M]]={model:F,numReferences:1})}this.numModelsLoading[l]-=y.length,this.fire(new r.f("data",{dataType:"style"}))}).catch(T=>{this.fire(new r.d(new Error(`Could not load models: ${T.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,l){return!!this.getModel(n,l)}getModel(n,l){return this.models[l]||(this.models[l]={}),this.models[l][n]?this.models[l][n].model:void 0}addModel(n,l,y){this.models[y]||(this.models[y]={}),this.hasModel(n,y)&&this.models[y][n].numReferences++,this.load({[n]:this.requestManager.normalizeModelURL(l)},y)}addModels(n,l){this.models[l]||(this.models[l]={});const y={};for(const b in n)this.models[l][b]={},y[b]=this.requestManager.normalizeModelURL(n[b]);this.load(y,l)}addModelsFromBucket(n,l){this.models[l]||(this.models[l]={});const y={};for(const b of n)this.hasModel(b,l)?this.models[l][b].numReferences++:y[b]=this.requestManager.normalizeModelURL(b);this.load(y,l)}removeModel(n,l){if(this.models[l]&&this.models[l][n]&&(this.models[l][n].numReferences--,this.models[l][n].numReferences===0)){const y=this.models[l][n].model;delete this.models[l][n],y.destroy()}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,l){this.models[l]||(this.models[l]={});for(const y in this.models[l])this.models[l][y].model&&this.models[l][y].model.upload(n.context)}}function xi(p){const{userImage:n}=p;return!!(n&&n.render&&n.render())&&(p.data.replace(new Uint8Array(n.data.buffer)),!0)}class Gn extends r.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(n){this.images[n]={},this.loaded[n]=!1,this.updatedImages[n]={},this.patterns[n]={},this.callbackDispatchedThisFrame[n]={},this.atlasImage[n]=new r.i({width:1,height:1})}isLoaded(){for(const n in this.loaded)if(!this.loaded[n])return!1;return!0}setLoaded(n,l){if(this.loaded[l]!==n&&(this.loaded[l]=n,n)){for(const{ids:y,callback:b}of this.requestors)this._notify(y,l,b);this.requestors=[]}}hasImage(n,l){return!!this.getImage(n,l)}getImage(n,l){return this.images[l][n]}addImage(n,l,y){this._validate(n,y)&&(this.images[l][n]=y)}_validate(n,l){let y=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new r.d(new Error(`Image "${n}" has invalid "stretchX" value`))),y=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new r.d(new Error(`Image "${n}" has invalid "stretchY" value`))),y=!1),this._validateContent(l.content,l)||(this.fire(new r.d(new Error(`Image "${n}" has invalid "content" value`))),y=!1),y}_validateStretch(n,l){if(!n)return!0;let y=0;for(const b of n){if(b[0]<y||b[1]<b[0]||l<b[1])return!1;y=b[1]}return!0}_validateContent(n,l){return!(n&&(n.length!==4||n[0]<0||l.data.width<n[0]||n[1]<0||l.data.height<n[1]||n[2]<0||l.data.width<n[2]||n[3]<0||l.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,l,y){y.version=this.images[l][n].version+1,this.images[l][n]=y,this.updatedImages[l][n]=!0}removeImage(n,l){const y=this.images[l][n];delete this.images[l][n],delete this.patterns[l][n],y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(n){return Object.keys(this.images[n])}getImages(n,l,y){let b=!0;const T=!!this.loaded[l];if(!T)for(const M of n)this.images[l][M]||(b=!1);T||b?this._notify(n,l,y):this.requestors.push({ids:n,scope:l,callback:y})}getUpdatedImages(n){return this.updatedImages[n]}_notify(n,l,y){const b={};for(const T of n){this.images[l][T]||this.fire(new r.f("styleimagemissing",{id:T}));const M=this.images[l][T];M?b[T]={data:M.data.clone(),pixelRatio:M.pixelRatio,sdf:M.sdf,version:M.version,stretchX:M.stretchX,stretchY:M.stretchY,content:M.content,hasRenderCallback:!!(M.userImage&&M.userImage.render)}:r.w(`Image "${T}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}y(null,b)}getPixelSize(n){const{width:l,height:y}=this.atlasImage[n];return{width:l,height:y}}getPattern(n,l,y){const b=this.patterns[l][n],T=this.getImage(n,l);if(!T)return null;if(b&&b.position.version===T.version)return b.position;if(b)b.position.version=T.version;else{const M={w:T.data.width+2,h:T.data.height+2,x:0,y:0},D=new r.k(M,T);this.patterns[l][n]={bin:M,position:D}}return this._updatePatternAtlas(l,y),this.patterns[l][n].position}bind(n,l){const y=n.gl;let b=this.atlasTexture[l];b?this.dirty&&(b.update(this.atlasImage[l]),this.dirty=!1):(b=new r.T(n,this.atlasImage[l],y.RGBA),this.atlasTexture[l]=b),b.bind(y.LINEAR,y.CLAMP_TO_EDGE)}_updatePatternAtlas(n,l){const y=[];for(const D in this.patterns[n])y.push(this.patterns[n][D].bin);const{w:b,h:T}=r.j(y),M=this.atlasImage[n];M.resize({width:b||1,height:T||1});for(const D in this.patterns[n]){const{bin:F}=this.patterns[n][D],V=F.x+1,X=F.y+1,ie=this.images[n][D].data,le=ie.width,ue=ie.height;r.i.copy(ie,M,{x:0,y:0},{x:V,y:X},{width:le,height:ue},l),r.i.copy(ie,M,{x:0,y:ue-1},{x:V,y:X-1},{width:le,height:1},l),r.i.copy(ie,M,{x:0,y:0},{x:V,y:X+ue},{width:le,height:1},l),r.i.copy(ie,M,{x:le-1,y:0},{x:V-1,y:X},{width:1,height:ue},l),r.i.copy(ie,M,{x:0,y:0},{x:V+le,y:X},{width:1,height:ue},l)}this.dirty=!0}beginFrame(){for(const n in this.images)this.callbackDispatchedThisFrame[n]={}}dispatchRenderCallbacks(n,l){for(const y of n){if(this.callbackDispatchedThisFrame[l][y])continue;this.callbackDispatchedThisFrame[l][y]=!0;const b=this.images[l][y];xi(b)&&this.updateImage(y,l,b)}}}function an(p){const n=p.key,l=p.value,y=p.valueSpec||{},b=p.objectElementValidators||{},T=p.style,M=p.styleSpec;let D=[];const F=r.n(l);if(F!=="object")return[new r.V(n,l,`object expected, ${F} found`)];for(const V in l){const X=V.split(".")[0];let ie;b[X]?ie=b[X]:y[X]?ie=re:b["*"]?ie=b["*"]:y["*"]&&(ie=re),ie?D=D.concat(ie({key:(n&&`${n}.`)+V,value:l[V],valueSpec:y[X]||y["*"],style:T,styleSpec:M,object:l,objectKey:V},l)):D.push(new r.m(n,l[V],`unknown property "${V}"`))}for(const V in y)b[V]||y[V].required&&y[V].default===void 0&&l[V]===void 0&&D.push(new r.V(n,l,`missing required property "${V}"`));return D}function Jo(p){const n=p.value,l=p.valueSpec,y=p.style,b=p.styleSpec,T=p.key,M=p.arrayElementValidator||re;if(r.n(n)!=="array")return[new r.V(T,n,`array expected, ${r.n(n)} found`)];if(l.length&&n.length!==l.length)return[new r.V(T,n,`array length ${l.length} expected, length ${n.length} found`)];if(l["min-length"]&&n.length<l["min-length"])return[new r.V(T,n,`array length at least ${l["min-length"]} expected, length ${n.length} found`)];let D={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};b.$version<7&&(D.function=l.function),r.n(l.value)==="object"&&(D=l.value);let F=[];for(let V=0;V<n.length;V++)F=F.concat(M({array:n,arrayIndex:V,value:n[V],valueSpec:D,style:y,styleSpec:b,key:`${T}[${V}]`},!0));return F}function Ds(p){const n=p.key,l=p.value,y=p.valueSpec;let b=r.n(l);if(b==="number"&&l!=l&&(b="NaN"),b!=="number")return[new r.V(n,l,`number expected, ${b} found`)];if("minimum"in y){let T=y.minimum;if(r.n(y.minimum)==="array"&&(T=y.minimum[p.arrayIndex]),l<T)return[new r.V(n,l,`${l} is less than the minimum value ${T}`)]}if("maximum"in y){let T=y.maximum;if(r.n(y.maximum)==="array"&&(T=y.maximum[p.arrayIndex]),l>T)return[new r.V(n,l,`${l} is greater than the maximum value ${T}`)]}return[]}function $o(p){const n=p.valueSpec,l=r.u(p.value.type);let y,b,T,M={};const D=l!=="categorical"&&p.value.property===void 0,F=!D,V=r.n(p.value.stops)==="array"&&r.n(p.value.stops[0])==="array"&&r.n(p.value.stops[0][0])==="object",X=an({key:p.key,value:p.value,valueSpec:p.styleSpec.function,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(ue){if(l==="identity")return[new r.V(ue.key,ue.value,'identity function may not have a "stops" property')];let me=[];const ge=ue.value;return me=me.concat(Jo({key:ue.key,value:ge,valueSpec:ue.valueSpec,style:ue.style,styleSpec:ue.styleSpec,arrayElementValidator:ie})),r.n(ge)==="array"&&ge.length===0&&me.push(new r.V(ue.key,ge,"array must have at least one stop")),me},default:function(ue){return re({key:ue.key,value:ue.value,valueSpec:n,style:ue.style,styleSpec:ue.styleSpec})}}});return l==="identity"&&D&&X.push(new r.V(p.key,p.value,'missing required property "property"')),l==="identity"||p.value.stops||X.push(new r.V(p.key,p.value,'missing required property "stops"')),l==="exponential"&&p.valueSpec.expression&&!r.s(p.valueSpec)&&X.push(new r.V(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(F&&!r.q(p.valueSpec)?X.push(new r.V(p.key,p.value,"property functions not supported")):D&&!r.r(p.valueSpec)&&X.push(new r.V(p.key,p.value,"zoom functions not supported"))),l!=="categorical"&&!V||p.value.property!==void 0||X.push(new r.V(p.key,p.value,'"property" property is required')),X;function ie(ue){let me=[];const ge=ue.value,_e=ue.key;if(r.n(ge)!=="array")return[new r.V(_e,ge,`array expected, ${r.n(ge)} found`)];if(ge.length!==2)return[new r.V(_e,ge,`array length 2 expected, length ${ge.length} found`)];if(V){if(r.n(ge[0])!=="object")return[new r.V(_e,ge,`object expected, ${r.n(ge[0])} found`)];if(ge[0].zoom===void 0)return[new r.V(_e,ge,"object stop key must have zoom")];if(ge[0].value===void 0)return[new r.V(_e,ge,"object stop key must have value")];const ye=r.u(ge[0].zoom);if(typeof ye!="number")return[new r.V(_e,ge[0].zoom,"stop zoom values must be numbers")];if(T&&T>ye)return[new r.V(_e,ge[0].zoom,"stop zoom values must appear in ascending order")];ye!==T&&(T=ye,b=void 0,M={}),me=me.concat(an({key:`${_e}[0]`,value:ge[0],valueSpec:{zoom:{}},style:ue.style,styleSpec:ue.styleSpec,objectElementValidators:{zoom:Ds,value:le}}))}else me=me.concat(le({key:`${_e}[0]`,value:ge[0],valueSpec:{},style:ue.style,styleSpec:ue.styleSpec},ge));return r.t(r.v(ge[1]))?me.concat([new r.V(`${_e}[1]`,ge[1],"expressions are not allowed in function stops.")]):me.concat(re({key:`${_e}[1]`,value:ge[1],valueSpec:n,style:ue.style,styleSpec:ue.styleSpec}))}function le(ue,me){const ge=r.n(ue.value),_e=r.u(ue.value),ye=ue.value!==null?ue.value:me;if(y){if(ge!==y)return[new r.V(ue.key,ye,`${ge} stop domain type must match previous stop domain type ${y}`)]}else y=ge;if(ge!=="number"&&ge!=="string"&&ge!=="boolean"&&typeof _e!="number"&&typeof _e!="string"&&typeof _e!="boolean")return[new r.V(ue.key,ye,"stop domain value must be a number, string, or boolean")];if(ge!=="number"&&l!=="categorical"){let Pe=`number expected, ${ge} found`;return r.q(n)&&l===void 0&&(Pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(ue.key,ye,Pe)]}return l!=="categorical"||ge!=="number"||typeof _e=="number"&&isFinite(_e)&&Math.floor(_e)===_e?l!=="categorical"&&ge==="number"&&typeof _e=="number"&&typeof b=="number"&&b!==void 0&&_e<b?[new r.V(ue.key,ye,"stop domain values must appear in ascending order")]:(b=_e,l==="categorical"&&_e in M?[new r.V(ue.key,ye,"stop domain values must be unique")]:(M[_e]=!0,[])):[new r.V(ue.key,ye,`integer expected, found ${String(_e)}`)]}}function gn(p){const n=(p.expressionContext==="property"?r.x:r.y)(r.v(p.value),p.valueSpec);if(n.result==="error")return n.value.map(y=>new r.V(`${p.key}${y.key}`,p.value,y.message));const l=n.value.expression||n.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!l.outputDefined())return[new r.V(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!r.z(l))return[new r.V(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter")return No(l,p);if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!r.A(l,["zoom","feature-state"]))return[new r.V(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!r.B(l))return[new r.V(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function No(p,n){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const b of n.valueSpec.expression.parameters)l.delete(b);if(l.size===0)return[];const y=[];return p instanceof r.D&&l.has(p.name)?[new r.V(n.key,n.value,`["${p.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(p.eachChild(b=>{y.push(...No(b,n))}),y)}function Es(p){const n=p.key,l=p.value,y=p.valueSpec,b=[];return Array.isArray(y.values)?y.values.indexOf(r.u(l))===-1&&b.push(new r.V(n,l,`expected one of [${y.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(y.values).indexOf(r.u(l))===-1&&b.push(new r.V(n,l,`expected one of [${Object.keys(y.values).join(", ")}], ${JSON.stringify(l)} found`)),b}function Ur(p){return r.G(r.v(p.value))?gn(r.o({},p,{expressionContext:"filter",valueSpec:p.styleSpec[`filter_${p.layerType||"fill"}`]})):Tr(p)}function Tr(p){const n=p.value,l=p.key;if(r.n(n)!=="array")return[new r.V(l,n,`array expected, ${r.n(n)} found`)];const y=p.styleSpec;let b,T=[];if(n.length<1)return[new r.V(l,n,"filter array must have at least 1 element")];switch(T=T.concat(Es({key:`${l}[0]`,value:n[0],valueSpec:y.filter_operator,style:p.style,styleSpec:p.styleSpec})),r.u(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&r.u(n[1])==="$type"&&T.push(new r.V(l,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&T.push(new r.V(l,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(b=r.n(n[1]),b!=="string"&&T.push(new r.V(`${l}[1]`,n[1],`string expected, ${b} found`)));for(let M=2;M<n.length;M++)b=r.n(n[M]),r.u(n[1])==="$type"?T=T.concat(Es({key:`${l}[${M}]`,value:n[M],valueSpec:y.geometry_type,style:p.style,styleSpec:p.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&T.push(new r.V(`${l}[${M}]`,n[M],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let M=1;M<n.length;M++)T=T.concat(Tr({key:`${l}[${M}]`,value:n[M],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":b=r.n(n[1]),n.length!==2?T.push(new r.V(l,n,`filter array for "${n[0]}" operator must have 2 elements`)):b!=="string"&&T.push(new r.V(`${l}[1]`,n[1],`string expected, ${b} found`))}return T}function Rs(p,n){const l=p.key,y=p.style,b=p.layer,T=p.styleSpec,M=p.value,D=p.objectKey,F=T[`${n}_${p.layerType}`];if(!F)return[];const V=D.match(/^(.*)-transition$/);if(n==="paint"&&V&&F[V[1]]&&F[V[1]].transition)return re({key:l,value:M,valueSpec:T.transition,style:y,styleSpec:T});const X=p.valueSpec||F[D];if(!X)return[new r.m(l,M,`unknown property "${D}"`)];let ie;if(r.n(M)==="string"&&r.q(X)&&!X.tokens&&(ie=/^{([^}]+)}$/.exec(M))){const ue=`\`{ "type": "identity", "property": ${ie?JSON.stringify(ie[1]):'"_"'} }\``;return[new r.V(l,M,`"${D}" does not support interpolation syntax
Use an identity property function instead: ${ue}.`)]}const le=[];if(p.layerType==="symbol")D!=="text-field"||!y||y.glyphs||y.imports||le.push(new r.V(l,M,'use of "text-field" requires a style "glyphs" property')),D==="text-font"&&r.H(r.v(M))&&r.u(M.type)==="identity"&&le.push(new r.V(l,M,'"text-font" does not support identity functions'));else if(p.layerType==="model"&&n==="paint"&&b&&b.layout&&b.layout.hasOwnProperty("model-id")&&r.q(X)&&(r.J(X)||r.r(X))){const ue=r.x(r.v(M),X),me=ue.value.expression||ue.value._styleExpression.expression;me&&!r.A(me,["measure-light"])&&(D==="model-emissive-strength"&&r.B(me)&&r.z(me)||le.push(new r.V(l,M,`${D} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return le.concat(re({key:p.key,value:M,valueSpec:X,style:y,styleSpec:T,expressionContext:"property",propertyType:n,propertyKey:D}))}function tr(p){return Rs(p,"paint")}function Fo(p){return Rs(p,"layout")}function Eo(p){let n=[];const l=p.value,y=p.key,b=p.style,T=p.styleSpec;l.type||l.ref||n.push(new r.V(y,l,'either "type" or "ref" is required'));let M=r.u(l.type);const D=r.u(l.ref);if(l.id){const F=r.u(l.id);for(let V=0;V<p.arrayIndex;V++){const X=b.layers[V];r.u(X.id)===F&&n.push(new r.V(y,l.id,`duplicate layer id "${l.id}", previously used at line ${X.id.__line__}`))}}if("ref"in l){let F;["type","source","source-layer","filter","layout"].forEach(V=>{V in l&&n.push(new r.V(y,l[V],`"${V}" is prohibited for ref layers`))}),b.layers.forEach(V=>{r.u(V.id)===D&&(F=V)}),F?F.ref?n.push(new r.V(y,l.ref,"ref cannot reference another ref layer")):M=r.u(F.type):typeof D=="string"&&n.push(new r.V(y,l.ref,`ref layer "${D}" not found`))}else if(M!=="background"&&M!=="sky"&&M!=="slot")if(l.source){const F=b.sources&&b.sources[l.source],V=F&&r.u(F.type);F?V==="vector"&&M==="raster"?n.push(new r.V(y,l.source,`layer "${l.id}" requires a raster source`)):V==="raster"&&M!=="raster"?n.push(new r.V(y,l.source,`layer "${l.id}" requires a vector source`)):V!=="vector"||l["source-layer"]?V==="raster-dem"&&M!=="hillshade"?n.push(new r.V(y,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):V!=="raster-array"||["raster","raster-particle"].includes(M)?M!=="line"||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||V==="geojson"&&F.lineMetrics?M==="raster-particle"&&V!=="raster-array"&&n.push(new r.V(y,l.source,`layer "${l.id}" requires a 'raster-array' source.`)):n.push(new r.V(y,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new r.V(y,l.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new r.V(y,l,`layer "${l.id}" must specify a "source-layer"`)):n.push(new r.V(y,l.source,`source "${l.source}" not found`))}else n.push(new r.V(y,l,'missing required property "source"'));return n=n.concat(an({key:y,value:l,valueSpec:T.layer,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":()=>[],type:()=>re({key:`${y}.type`,value:l.type,valueSpec:T.layer.type,style:p.style,styleSpec:p.styleSpec,object:l,objectKey:"type"}),filter:F=>Ur(r.o({layerType:M},F)),layout:F=>an({layer:l,key:F.key,value:F.value,valueSpec:{},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{"*":V=>Fo(r.o({layerType:M},V))}}),paint:F=>an({layer:l,key:F.key,value:F.value,valueSpec:{},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{"*":V=>tr(r.o({layerType:M,layer:l},V))}})}})),n}function uo(p){const n=p.value,l=p.key,y=r.n(n);return y!=="string"?[new r.V(l,n,`string expected, ${y} found`)]:[]}const yn={promoteId:function({key:p,value:n}){if(r.n(n)==="string")return uo({key:p,value:n});{const l=[];for(const y in n)l.push(...uo({key:`${p}.${y}`,value:n[y]}));return l}}};function Kn(p){const n=p.value,l=p.key,y=p.styleSpec,b=p.style;if(!n.type)return[new r.V(l,n,'"type" is required')];const T=r.u(n.type);let M=[];switch(["vector","raster","raster-dem","raster-array"].includes(T)&&(n.url||n.tiles||M.push(new r.m(l,n,'Either "url" or "tiles" is required.'))),T){case"vector":case"raster":case"raster-dem":case"raster-array":return M=M.concat(an({key:l,value:n,valueSpec:y[`source_${T.replace("-","_")}`],style:p.style,styleSpec:y,objectElementValidators:yn})),M;case"geojson":if(M=an({key:l,value:n,valueSpec:y.source_geojson,style:b,styleSpec:y,objectElementValidators:yn}),n.cluster)for(const D in n.clusterProperties){const[F,V]=n.clusterProperties[D],X=typeof F=="string"?[F,["accumulated"],["get",D]]:F;M.push(...gn({key:`${l}.${D}.map`,value:V,expressionContext:"cluster-map"})),M.push(...gn({key:`${l}.${D}.reduce`,value:X,expressionContext:"cluster-reduce"}))}return M;case"video":return an({key:l,value:n,valueSpec:y.source_video,style:b,styleSpec:y});case"image":return an({key:l,value:n,valueSpec:y.source_image,style:b,styleSpec:y});case"canvas":return[new r.V(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Es({key:`${l}.type`,value:n.type,valueSpec:{values:To(y)},style:b,styleSpec:y})}}function To(p){return p.source.reduce((n,l)=>{const y=p[l];return y.type.type==="enum"&&(n=n.concat(Object.keys(y.type.values))),n},[])}function Cr(p){const n=p.value,l=p.styleSpec,y=l.light,b=p.style;let T=[];const M=r.n(n);if(n===void 0)return T;if(M!=="object")return T=T.concat([new r.V("light",n,`object expected, ${M} found`)]),T;for(const D in n){const F=D.match(/^(.*)-transition$/);T=T.concat(F&&y[F[1]]&&y[F[1]].transition?re({key:D,value:n[D],valueSpec:l.transition,style:b,styleSpec:l}):y[D]?re({key:D,value:n[D],valueSpec:y[D],style:b,styleSpec:l}):[new r.V(D,n[D],`unknown property "${D}"`)])}return T}function hr(p){const n=p.value;let l=[];if(!n)return l;const y=r.n(n);if(y!=="object")return l=l.concat([new r.V("light-3d",n,`object expected, ${y} found`)]),l;const b=p.styleSpec,T=b["light-3d"],M=p.key,D=p.style,F=p.style.lights;for(const ie of["type","id"])if(!(ie in n))return l=l.concat([new r.V("light-3d",n,`missing property ${ie} on light`)]),l;if(n.type&&F)for(let ie=0;ie<p.arrayIndex;ie++){const le=r.u(n.type),ue=F[ie];r.u(ue.type)===le&&l.push(new r.V(M,n.id,`duplicate light type "${n.type}", previously defined at line ${ue.id.__line__}`))}const V=`properties_light_${n.type}`;if(!(V in b))return l=l.concat([new r.V("light-3d",n,`Invalid light type ${n.type}`)]),l;const X=b[V];for(const ie in n)if(ie==="properties"){const le=n[ie],ue=r.n(le);if(ue!=="object")return l=l.concat([new r.V("properties",le,`object expected, ${ue} found`)]),l;for(const me in le)l=l.concat(X[me]?re({key:me,value:le[me],valueSpec:X[me],style:D,styleSpec:b}):[new r.m(p.key,le[me],`unknown property "${me}"`)])}else{const le=ie.match(/^(.*)-transition$/);l=l.concat(le&&T[le[1]]&&T[le[1]].transition?re({key:ie,value:n[ie],valueSpec:b.transition,style:D,styleSpec:b}):T[ie]?re({key:ie,value:n[ie],valueSpec:T[ie],style:D,styleSpec:b}):[new r.m(ie,n[ie],`unknown property "${ie}"`)])}return l}function nr(p){const n=p.value,l=p.key,y=p.style,b=p.styleSpec,T=b.terrain;let M=[];const D=r.n(n);if(n===void 0||D==="null")return M;if(D!=="object")return M=M.concat([new r.V("terrain",n,`object expected, ${D} found`)]),M;for(const F in n){const V=F.match(/^(.*)-transition$/);M=M.concat(V&&T[V[1]]&&T[V[1]].transition?re({key:F,value:n[F],valueSpec:b.transition,style:y,styleSpec:b}):T[F]?re({key:F,value:n[F],valueSpec:T[F],style:y,styleSpec:b}):[new r.m(F,n[F],`unknown property "${F}"`)])}if(n.source){const F=y.sources&&y.sources[n.source],V=F&&r.u(F.type);F?V!=="raster-dem"&&M.push(new r.V(l,n.source,`terrain cannot be used with a source of type ${String(V)}, it only be used with a "raster-dem" source type`)):M.push(new r.V(l,n.source,`source "${n.source}" not found`))}else M.push(new r.V(l,n,'terrain is missing required property "source"'));return M}function Ke(p){const n=p.value,l=p.style,y=p.styleSpec,b=y.fog;let T=[];const M=r.n(n);if(n===void 0)return T;if(M!=="object")return T=T.concat([new r.V("fog",n,`object expected, ${M} found`)]),T;for(const D in n){const F=D.match(/^(.*)-transition$/);T=T.concat(F&&b[F[1]]&&b[F[1]].transition?re({key:D,value:n[D],valueSpec:y.transition,style:l,styleSpec:y}):b[D]?re({key:D,value:n[D],valueSpec:b[D],style:l,styleSpec:y}):[new r.m(D,n[D],`unknown property "${D}"`)])}return T}const ve={"*":()=>[],array:Jo,boolean:function(p){const n=p.value,l=p.key,y=r.n(n);return y!=="boolean"?[new r.V(l,n,`boolean expected, ${y} found`)]:[]},number:Ds,color:function(p){const n=p.key,l=p.value,y=r.n(l);return y!=="string"?[new r.V(n,l,`color expected, ${y} found`)]:r.F(l)===null?[new r.V(n,l,`color expected, "${l}" found`)]:[]},enum:Es,filter:Ur,function:$o,layer:Eo,object:an,source:Kn,model:r.K,light:Cr,"light-3d":hr,terrain:nr,fog:Ke,string:uo,formatted:function(p){return uo(p).length===0?[]:gn(p)},resolvedImage:function(p){return uo(p).length===0?[]:gn(p)},projection:function(p){const n=p.value,l=p.styleSpec,y=l.projection,b=p.style;let T=[];const M=r.n(n);if(M==="object")for(const D in n)T=T.concat(re({key:D,value:n[D],valueSpec:y[D],style:b,styleSpec:l}));else M!=="string"&&(T=T.concat([new r.V("projection",n,`object or string expected, ${M} found`)]));return T},import:function(p){const{value:n,styleSpec:l}=p,{data:y,...b}=n;Object.defineProperty(b,"__line__",{value:n.__line__,enumerable:!1});let T=an(r.o({},p,{value:b,valueSpec:l.import}));return r.u(b.id)===""&&T.push(new r.V(`${p.key}.id`,b,"import id can't be an empty string")),y&&(T=T.concat(Ee(y,l,{key:`${p.key}.data`}))),T}};function re(p,n=!1){const l=p.value,y=p.valueSpec,b=p.styleSpec;if(y.expression&&r.H(r.u(l)))return $o(p);if(y.expression&&r.t(r.v(l)))return gn(p);if(y.type&&ve[y.type]){const T=ve[y.type](p);return n===!0&&T.length>0&&r.n(p.value)==="array"?gn(p):T}return an(r.o({},p,{valueSpec:y.type?b[y.type]:y}))}function ae(p){const n=p.value,l=p.key,y=uo(p);return y.length||(n.indexOf("{fontstack}")===-1&&y.push(new r.V(l,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&y.push(new r.V(l,n,'"glyphs" url must include a "{range}" token'))),y}function Ee(p,n=r.L,l={}){return re({key:l.key||"",value:p,valueSpec:n.$root,styleSpec:n,style:p,objectElementValidators:{glyphs:ae,"*":()=>[]}})}function Oe(p,n=r.L){return mt(Ee(p,n))}const Re=p=>mt(Kn(p)),je=p=>mt(Cr(p)),Je=p=>mt(hr(p)),Ge=p=>mt(nr(p)),rt=p=>mt(Ke(p)),ht=p=>mt(Eo(p)),pt=p=>mt(Ur(p)),$t=p=>mt(tr(p)),oi=p=>mt(Fo(p)),bi=p=>mt(r.K(p));function mt(p){return p.slice().sort((n,l)=>n.line&&l.line?n.line-l.line:0)}function Ti(p,n){let l=!1;if(n&&n.length)for(const y of n)y instanceof r.m?r.w(y.message):(p.fire(new r.d(new Error(y.message))),l=!0);return l}const ui=new r.N({anchor:new r.O(r.L.light.anchor),position:new r.Q(r.L.light.position),color:new r.O(r.L.light.color),intensity:new r.O(r.L.light.intensity)});class Gt extends r.E{constructor(n,l="flat"){super(),this._transitionable=new r.U(ui),this.setLight(n,l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,l,y={}){this._validate(je,n,y)||(this._transitionable.setTransitionOrValue(n),this.id=l)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,y){return(!y||y.validate!==!1)&&Ti(this,n.call(Oe,r.W({value:l,style:{glyphs:!0,sprite:!0},styleSpec:r.L})))}}const Yi=new r.N({source:new r.O(r.L.terrain.source),exaggeration:new r.O(r.L.terrain.exaggeration)});let ei=class extends r.E{constructor(p,n,l,y){super(),this.scope=l,this._transitionable=new r.U(Yi,l,y),this._transitionable.setTransitionOrValue(p,y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(p,n){this._transitionable.setTransitionOrValue(p,n)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new r.X(p)).get("exaggeration")}isZoomDependent(){const p=this._transitionable._values.exaggeration;return p!=null&&p.value!=null&&p.value.expression!=null&&p.value.expression instanceof r.Z}};const ii=45,yi=65,Xi=.05;function tn(p,n,l,y){const b=r.$(ii,yi,l),[T,M]=Dn(p,y);let D=1-Math.min(1,Math.exp((n-T)/(M-T)*-6));return D*=D*D,D=Math.min(1,1.00747*D),D*b*p.alpha}function Dn(p,n){const l=.5/Math.tan(.5*n);return[p.range[0]+l,p.range[1]+l]}function pn(p,n,l,y,b){const T=r._.transformMat4([],[n,l,y],b.mercatorFogMatrix);return tn(p,r._.length(T),b.pitch,b._fov)}function Ar(p,n,l,y,b,T,M){const D=[[l,y,0],[b,y,0],[b,T,0],[l,T,0]];let F=Number.MAX_VALUE,V=-Number.MAX_VALUE;for(const X of D){const ie=r._.transformMat4([],X,n),le=r._.length(ie);F=Math.min(F,le),V=Math.max(V,le)}return[tn(p,F,M.pitch,M._fov),tn(p,V,M.pitch,M._fov)]}const es=new r.N({range:new r.O(r.L.fog.range),color:new r.O(r.L.fog.color),"high-color":new r.O(r.L.fog["high-color"]),"space-color":new r.O(r.L.fog["space-color"]),"horizon-blend":new r.O(r.L.fog["horizon-blend"]),"star-intensity":new r.O(r.L.fog["star-intensity"]),"vertical-range":new r.O(r.L.fog["vertical-range"])});class ar extends r.E{constructor(n,l,y,b){super(),this._transitionable=new r.U(es,y,new Map(b)),this.set(n,b),this._transitioning=this._transitionable.untransitioned(),this._transform=l,this.properties=new r.a0(es),this.scope=y}get state(){const n=this._transform,l=n.projection.name==="globe",y=r.a1(n.zoom),b=this.properties.get("range"),T=[.5,3];return{range:l?[r.a2(T[0],b[0],y),r.a2(T[1],b[1],y)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,l,y={}){if(this._validate(rt,n,y))return;const b=r.W({},n);for(const T of Object.keys(r.L.fog))b[T]===void 0&&(b[T]=r.L.fog[T].default);this._options=b,this._transitionable.setTransitionOrValue(this._options,l)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.$(ii,yi,n))*l.a}getOpacityAtLatLng(n,l){return this._transform.projection.supportsFog?function(y,b,T){const M=r.Y.fromLngLat(b),D=T.elevation?T.elevation.getAtPointOrZero(M):0;return pn(y,M.x,M.y,D,T)}(this.state,n,l):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const l=this._transform.calculateFogTileMatrix(n.toUnwrapped());return Ar(this.state,l,0,0,r.a3,r.a3,this._transform)}getOpacityForBounds(n,l,y,b,T){return this._transform.projection.supportsFog?Ar(this.state,n,l,y,b,T,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Dn(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const l=[4,5,6,7];for(const y of l){const b=n.points[y];let T;if(b[2]>=0)T=b;else{const M=n.points[y-4];T=r.a4(M,b,M[2]/(M[2]-b[2]))}if(pn(this.state,T[0],T[1],0,this._transform)>=Xi)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,y){return(!y||y.validate!==!1)&&Ti(this,n.call(Oe,r.W({value:l,style:{glyphs:!0,sprite:!0},styleSpec:r.L})))}}class _n extends r.E{constructor(n,l,y,b){super(),this.scope=y,this._options=n,this.properties=new r.a0(l),this._transitionable=new r.U(l,y,new Map(b)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,l){this._options=n,this._transitionable.setTransitionOrValue(n.properties,l)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const Pi=new r.N({color:new r.O(r.L.properties_light_ambient.color),intensity:new r.O(r.L.properties_light_ambient.intensity)}),zo=new r.N({direction:new r.a5(r.L.properties_light_directional.direction),color:new r.O(r.L.properties_light_directional.color),intensity:new r.O(r.L.properties_light_directional.intensity),"cast-shadows":new r.O(r.L.properties_light_directional["cast-shadows"]),"shadow-intensity":new r.O(r.L.properties_light_directional["shadow-intensity"])});var Rn=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Zr=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Ct=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,We="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ki=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform highp sampler2D u_depth;uniform vec2 u_depth_size_inv;uniform vec2 u_depth_range_unpack;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
#ifdef TERRAIN_DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef TERRAIN_DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;
#ifdef TERRAIN_DEPTH_D24
vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,dr=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,jr=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,So=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,gr=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,_o=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Wi=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const lr=[];ms(Rn,lr),ms(Ct,lr),ms(Zr,lr);const Vs={"_prelude_fog.vertex.glsl":dr,"_prelude_terrain.vertex.glsl":ki,"_prelude_shadow.vertex.glsl":_o,"_prelude_fog.fragment.glsl":jr,"_prelude_shadow.fragment.glsl":Wi,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":So,"_prelude_raster_particle.glsl":gr},ks={};Bi("",ki),Bi(jr,dr),Bi(Wi,_o),Bi(So,""),Bi(gr,"");const pa=Bi(Zr,Ct),Bs=Rn;var Us={background:Bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Bi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Bi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Bi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Bi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Bi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Bi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Bi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Bi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Bi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Bi(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform lowp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/clamp(u_trim_fade_range[0],1e-4,1.0)));float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/clamp(u_trim_fade_range[1],1e-4,1.0)));float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Bi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Bi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Bi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:Bi(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:Bi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Bi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Bi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Bi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,We),skyboxGradient:Bi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,We),skyboxCapture:Bi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Bi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;uniform vec2 u_depth_range_unpack;
#ifdef TERRAIN_DEPTH_D24
float unpack_depth(float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef TERRAIN_DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Bi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Bi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:Bi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function ms(p,n){const l=p.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let y of l)if(y=y.trim(),y[0]==="#"&&y.includes("if")&&!y.includes("endif")){y=y.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const b=y.split(" ");for(const T of b)n.includes(T)||n.push(T)}}function Bi(p,n){const l=/#include\s+"([^"]+)"/g,y=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let b=n.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);b&&(b=b.map(V=>{const X=V.split(" ");return X[X.length-1]}),b=[...new Set(b)]);const T={},M=[],D=[];if(p=p.replace(l,(V,X)=>(D.push(X),"")),(n=n.replace(l,(V,X)=>(M.push(X),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let F=[...lr];ms(p,F),ms(n,F);for(const V of[...M,...D])Vs[V]||console.error(`Undefined include: ${V}`),ks[V]||(ks[V]=[],ms(Vs[V],ks[V])),F=[...F,...ks[V]];return{fragmentSource:p=p.replace(y,(V,X,ie,le,ue)=>(T[ue]=!0,X==="define"?`
#ifndef HAS_UNIFORM_u_${ue}
in ${ie} ${le} ${ue};
#else
uniform ${ie} ${le} u_${ue};
#endif
`:X==="initialize"?`
#ifdef HAS_UNIFORM_u_${ue}
    ${ie} ${le} ${ue} = u_${ue};
#endif
`:X==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ue}
    in ${ie} ${le} ${ue};
#endif
`:X==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(y,(V,X,ie,le,ue)=>{const me=le==="float"?"vec2":le,ge=ue.match(/color/)?"color":me;return X==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${ue}
in ${ie} ${le} a_${ue};
#endif
`:T[ue]?X==="define"?`
#ifndef HAS_UNIFORM_u_${ue}
uniform lowp float u_${ue}_t;
in ${ie} ${me} a_${ue};
out ${ie} ${le} ${ue};
#else
uniform ${ie} ${le} u_${ue};
#endif
`:X==="initialize"?ge==="vec4"?`
#ifndef HAS_UNIFORM_u_${ue}
    ${ue} = a_${ue};
#else
    ${ie} ${le} ${ue} = u_${ue};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ue}
    ${ue} = unpack_mix_${ge}(a_${ue}, u_${ue}_t);
#else
    ${ie} ${le} ${ue} = u_${ue};
#endif
`:X==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ue}
    in ${ie} ${le} a_${ue};
    out ${ie} ${le} ${ue};
#endif
`:X==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ue}
    ${ue} = a_${ue};
#endif
`:void 0:X==="define"?`
#ifndef HAS_UNIFORM_u_${ue}
uniform lowp float u_${ue}_t;
in ${ie} ${me} a_${ue};
#else
uniform ${ie} ${le} u_${ue};
#endif
`:X==="define-instanced"?ge==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${ue}0;
in vec4 a_${ue}1;
in vec4 a_${ue}2;
in vec4 a_${ue}3;
#else
uniform ${ie} ${le} u_${ue};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${ie} ${me} a_${ue};
#else
uniform ${ie} ${le} u_${ue};
#endif
`:X==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${ue}
    ${ie} ${le} ${ue} = a_${ue};
#endif
`:ge==="vec4"?`
#ifndef HAS_UNIFORM_u_${ue}
    ${ie} ${le} ${ue} = a_${ue};
#else
    ${ie} ${le} ${ue} = u_${ue};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ue}
    ${ie} ${le} ${ue} = unpack_mix_${ge}(a_${ue}, u_${ue}_t);
#else
    ${ie} ${le} ${ue} = u_${ue};
#endif
`}),staticAttributes:b,usedDefines:F,vertexIncludes:M,fragmentIncludes:D}}class Zo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,l,y,b,T,M,D,F){this.context=n;let V=this.boundPaintVertexBuffers.length!==b.length;for(let ie=0;!V&&ie<b.length;ie++)this.boundPaintVertexBuffers[ie]!==b[ie]&&(V=!0);let X=this.boundDynamicVertexBuffers.length!==D.length;for(let ie=0;!X&&ie<D.length;ie++)this.boundDynamicVertexBuffers[ie]!==D[ie]&&(X=!0);if(!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==y||V||X||this.boundIndexBuffer!==T||this.boundVertexOffset!==M)this.freshBind(l,y,b,T,M,D,F);else{n.bindVertexArrayOES.set(this.vao);for(const ie of D)ie&&(ie.bind(),F&&ie.instanceCount&&ie.setVertexAttribDivisor(n.gl,l,F));T&&T.dynamicDraw&&T.bind()}}freshBind(n,l,y,b,T,M,D){const F=n.numAttributes,V=this.context,X=V.gl;this.vao&&this.destroy(),this.vao=V.gl.createVertexArray(),V.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=b,this.boundVertexOffset=T,this.boundDynamicVertexBuffers=M,l.enableAttributes(X,n),l.bind(),l.setVertexAttribPointers(X,n,T);for(const ie of y)ie.enableAttributes(X,n),ie.bind(),ie.setVertexAttribPointers(X,n,T);for(const ie of M)ie&&(ie.enableAttributes(X,n),ie.bind(),ie.setVertexAttribPointers(X,n,T),D&&ie.instanceCount&&ie.setVertexAttribDivisor(X,n,D));b&&b.bind(),V.currentNumAttributes=F}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Xo(p,n){const l=Math.pow(2,n.canonical.z),y=n.canonical.y;return[new r.Y(0,y/l).toLngLat().lat,new r.Y(0,(y+1)/l).toLngLat().lat]}function en(p,n,l,y,b,T,M){const D=p.context,F=D.gl,V=l.hillshadeFBO;if(!V)return;p.prepareDrawTile();const X=p.isTileAffectedByFog(n),ie=p.getOrCreateProgram("hillshade",{overrideFog:X});D.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,V.colorAttachment.get());const le=((_e,ye,Pe,De)=>{const ke=Pe.paint.get("hillshade-shadow-color"),qe=Pe.paint.get("hillshade-highlight-color"),Ve=Pe.paint.get("hillshade-accent-color"),Ze=Pe.paint.get("hillshade-emissive-strength");let xe=r.ab(Pe.paint.get("hillshade-illumination-direction"));if(Pe.paint.get("hillshade-illumination-anchor")==="viewport")xe-=_e.transform.angle;else if(_e.style&&_e.style.enable3dLights()&&_e.style.directionalLight){const Qe=_e.style.directionalLight.properties.get("direction"),ct=r.ac(Qe.x,Qe.y,Qe.z);xe=r.ab(ct[1])}const Be=!_e.options.moving;return{u_matrix:De||_e.transform.calculateProjMatrix(ye.tileID.toUnwrapped(),Be),u_image:0,u_latrange:Xo(0,ye.tileID),u_light:[Pe.paint.get("hillshade-exaggeration"),xe],u_shadow:ke.toRenderColor(Pe.lut),u_highlight:qe.toRenderColor(Pe.lut),u_emissive_strength:Ze,u_accent:Ve.toRenderColor(Pe.lut)}})(p,l,y,p.terrain?n.projMatrix:null);p.uploadCommonUniforms(D,ie,n.toUnwrapped());const{tileBoundsBuffer:ue,tileBoundsIndexBuffer:me,tileBoundsSegments:ge}=p.getTileBoundsBuffers(l);ie.draw(p,F.TRIANGLES,b,T,M,r.af.disabled,le,y.id,ue,me,ge)}function ma(p,n,l){if(!n.needsDEMTextureUpload)return;const y=p.context,b=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||p.getTileTexture(l.stride);const T=l.getPixels();n.demTexture?n.demTexture.update(T,{premultiply:!1}):n.demTexture=new r.T(y,T,b.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function hn(p,n,l){const y=p.context,b=y.gl;if(!n.dem)return;const T=n.dem;if(y.activeTexture.set(b.TEXTURE1),ma(p,n,T),!n.demTexture)return;n.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);const M=T.dim;y.activeTexture.set(b.TEXTURE0);let D=n.hillshadeFBO;if(!D){const le=new r.T(y,{width:M,height:M,data:null},b.RGBA);le.bind(b.LINEAR,b.CLAMP_TO_EDGE),D=n.hillshadeFBO=y.createFramebuffer(M,M,!0,"renderbuffer"),D.colorAttachment.set(le.texture)}y.bindFramebuffer.set(D.framebuffer),y.viewport.set([0,0,M,M]);const{tileBoundsBuffer:F,tileBoundsIndexBuffer:V,tileBoundsSegments:X}=p.getMercatorTileBoundsBuffers(),ie=[];p.linearFloatFilteringSupported()&&ie.push("TERRAIN_DEM_FLOAT_FORMAT"),p.getOrCreateProgram("hillshadePrepare",{defines:ie}).draw(p,b.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.unblended,r.af.disabled,((le,ue)=>{const me=ue.stride,ge=r.ad.create();return r.ad.ortho(ge,0,r.a3,-r.a3,0,0,1),r.ad.translate(ge,ge,[0,-r.a3,0]),{u_matrix:ge,u_image:1,u_dimension:[me,me],u_zoom:le.overscaledZ}})(n.tileID,T),l.id,F,V,X),n.needsHillshadePrepare=!1}function io(p,n,l,y,b){const T=function(M,D){if(M)return b(M);if(D){if(p.url&&D.tiles&&p.tiles&&delete p.tiles,D.variants){if(!Array.isArray(D.variants))return b(new Error("variants must be an array"));for(const V of D.variants){if(V==null||typeof V!="object"||V.constructor!==Object)return b(new Error("variant must be an object"));if(!Array.isArray(V.capabilities))return b(new Error("capabilities must be an array"));if(V.capabilities.length===1&&V.capabilities[0]==="meshopt"){D=r.W(D,V);break}}}const F=r.ah(r.W(D,p),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);D.vector_layers&&(F.vectorLayers=D.vector_layers,F.vectorLayerIds=F.vectorLayers.map(V=>V.id)),D.raster_layers&&(F.rasterLayers=D.raster_layers,F.rasterLayerIds=F.rasterLayers.map(V=>V.id)),F.tiles=n.canonicalizeTileset(F,p.url),b(null,F)}};return p.url?r.g(n.transformRequest(n.normalizeSourceURL(p.url,null,l,y),r.R.Source),T):r.e.frame(()=>T(null,p))}class Qs{constructor(n,l,y){this.bounds=r.ai.convert(this.validateBounds(n)),this.minzoom=l||0,this.maxzoom=y||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const l=Math.pow(2,n.z),y=Math.floor(r.aj(this.bounds.getWest())*l),b=Math.floor(r.ak(this.bounds.getNorth())*l),T=Math.ceil(r.aj(this.bounds.getEast())*l),M=Math.ceil(r.ak(this.bounds.getSouth())*l);return n.x>=y&&n.x<T&&n.y>=b&&n.y<M}}class Ns extends r.E{constructor(n,l,y,b){super(),this.id=n,this.dispatcher=y,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.W({type:"raster"},l),r.W(this,r.ah(l,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"})),this._tileJSONRequest=io(this._options,this.map._requestManager,null,null,(l,y)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new r.d(l)):y&&(r.W(this,y),y.bounds&&(this.tileBounds=new Qs(y.bounds,this.minzoom,this.maxzoom)),r.an(y.tiles),this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))),n&&n(l)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=r.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return r.W({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,l){const y=r.e.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);n.request=r.h(this.map._requestManager.transformRequest(b,r.R.Tile),(T,M,D,F)=>(delete n.request,n.aborted?(n.state="unloaded",l(null)):T?(n.state="errored",l(T)):M?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:D,expires:F}),n.setTexture(M,this.map.painter),n.state="loaded",r.am(this.dispatcher),void l(null)):l(null)))}abortTile(n,l){n.request&&(n.request.cancel(),delete n.request),l&&l()}unloadTile(n,l){n.texture&&n.texture instanceof r.T?(n.destroy(!0),n.texture&&n.texture instanceof r.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),l&&l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ga extends r.E{constructor(n,l,y,b){if(super(),this.id=n,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.W(this,r.ah(l,["url","scheme","tileSize","promoteId"])),this._options=r.W({type:"vector"},l),this._collectResourceTiming=!!l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new r.ao}load(n){this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,y=this.map._worldview;this._tileJSONRequest=io(this._options,this.map._requestManager,l,y,(b,T)=>{this._tileJSONRequest=null,this._loaded=!0,b?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),y&&y.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${y}`),this.fire(new r.d(b))):T&&(r.W(this,T),T.bounds&&(this.tileBounds=new Qs(T.bounds,this.minzoom,this.maxzoom)),r.an(T.tiles,this.map._requestManager._customAccessToken),this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))),n&&n(b)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=r.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return r.W({},this._options)}loadTile(n,l){const y=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),b=this.map._requestManager.transformRequest(y,r.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,M={request:b,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,lut:T?{image:T.image.clone()}:null,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(M.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=l:n.request=n.actor.send("reloadTile",M,D.bind(this));else if(n.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",M,D.bind(this),void 0,!0);else{const F=r.ap.call({deduped:this._deduped},M,(V,X)=>{V||!X?D.call(this,V):(M.data={cacheControl:X.cacheControl,expires:X.expires,rawData:X.rawData.slice(0)},n.actor&&n.actor.send("loadTile",M,D.bind(this),void 0,!0))},!0);n.request={cancel:F}}function D(F,V){return delete n.request,n.aborted?l(null):F&&F.status!==404?l(F):(V&&V.resourceTiming&&(n.resourceTiming=V.resourceTiming),this.map._refreshExpiredTiles&&V&&n.setExpiryData(V),n.loadVectorData(V,this.map.painter),r.am(this.dispatcher),l(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,l){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const Yo=(p,n,l)=>({u_matrix:p,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:l}),Yt=(p,n,l,y,b,T,M,D,F,V,X,ie,le,ue,me,ge)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(y),u_merc_matrix:l,u_zoom_transition:b,u_merc_center:T,u_image0:0,u_frustum_tl:M,u_frustum_tr:D,u_frustum_br:F,u_frustum_bl:V,u_globe_pos:X,u_globe_radius:ie,u_viewport:le,u_grid_matrix:ge?Float32Array.from(ge):new Float32Array(9),u_skirt_height:ue,u_far_z_cutoff:me});class Js{constructor(n=0,l=0,y=0,b=0){if(isNaN(n)||n<0||isNaN(l)||l<0||isNaN(y)||y<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=l,this.left=y,this.right=b}interpolate(n,l,y){return l.top!=null&&n.top!=null&&(this.top=r.a2(n.top,l.top,y)),l.bottom!=null&&n.bottom!=null&&(this.bottom=r.a2(n.bottom,l.bottom,y)),l.left!=null&&n.left!=null&&(this.left=r.a2(n.left,l.left,y)),l.right!=null&&n.right!=null&&(this.right=r.a2(n.right,l.right,y)),this}getCenter(n,l){const y=r.at((this.left+n-this.right)/2,0,n),b=r.at((this.top+l-this.bottom)/2,0,l);return new r.P(y,b)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Js(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ts(p,n){const l=r.aw(p,3);r.ad.fromQuat(p,n),r.az(p,3,l)}function nn(p,n){const l=r.av.identity([]);return r.av.rotateZ(l,l,-n),r.av.rotateX(l,l,-p),l}function ho(p,n){const l=[p[0],p[1],0],y=[n[0],n[1],0];if(r._.length(l)>=1e-15){const M=r._.normalize([],l);r._.scale(y,M,r._.dot(y,M)),n[0]=y[0],n[1]=y[1]}const b=r._.cross([],n,p);if(r._.len(b)<1e-15)return null;const T=Math.atan2(-b[1],b[0]);return nn(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),T)}class _a{constructor(n,l){this.position=n,this.orientation=l}get position(){return this._position}set position(n){if(n){const l=n instanceof r.Y?n:new r.Y(n[0],n[1],n[2]);this._renderWorldCopies&&(l.x=r.au(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(n,l){if(this.orientation=null,!this.position)return;const y=this.position,b=this._elevation?this._elevation.getAtPointOrZero(r.Y.fromLngLat(n)):0,T=r.Y.fromLngLat(n,b),M=[T.x-y.x,T.y-y.y,T.z-y.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=ho(M,l)}setPitchBearing(n,l){this.orientation=nn(r.ab(n),r.ab(-l))}}class js{constructor(n,l){this._transform=r.ad.identity([]),this.orientation=l,this.position=n}get mercatorPosition(){const n=this.position;return new r.Y(n[0],n[1],n[2])}get position(){const n=r.aw(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var l;n&&r.az(this._transform,3,[(l=n)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||r.av.identity([]),n&&ts(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,l){this._orientation=nn(n,l),ts(this._transform,this._orientation)}forward(){const n=r.aw(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=r.aw(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=r.aw(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,l){const y=new Float64Array(16);return r.ad.invert(y,this.getWorldToCamera(n,l)),y}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,l,y){const b=this.position;r._.scale(b,b,-n);const T=new Float64Array(16);return r.ad.fromScaling(T,[y,y,y]),r.ad.translate(T,T,b),T[10]*=l,T}getWorldToCamera(n,l){const y=new Float64Array(16),b=new Float64Array(4),T=this.position;return r.av.conjugate(b,this._orientation),r._.scale(T,T,-n),r.ad.fromQuat(y,b),r.ad.translate(y,y,T),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=l,y[9]*=l,y[10]*=l,y[11]*=l,y}getCameraToClipPerspective(n,l,y,b){const T=new Float64Array(16);return r.ad.perspective(T,n,l,y,b),T}getCameraToClipOrthographic(n,l,y,b,T,M){const D=new Float64Array(16);return r.ad.ortho(D,n,l,y,b,T,M),D}getDistanceToElevation(n,l=!1){const y=n===0?0:r.ax(n,l?r.ay(this.position[1]):this.position[1]),b=this.forward();return(y-this.position[2])/b[2]}clone(){return new js([...this.position],[...this.orientation])}}const fo={unknown:0,flipRequired:1,flipNotRequired:2},eu=Math.tan(85*Math.PI/180);function Ki(p,n,l,y,b,T,M){const D=r.ad.create();if(l)if(T.name==="globe"){const F=r.aB(b,n);r.ad.multiply(D,D,F)}else{const F=r.aC.invert([],M);D[0]=F[0],D[1]=F[1],D[4]=F[2],D[5]=F[3],y||r.ad.rotateZ(D,D,b.angle)}else r.ad.multiply(D,b.labelPlaneMatrix,p);return D}function il(p,n,l,y,b,T,M){const D=Ki(p,n,l,y,b,T,M);return T.name==="globe"&&l||(D[2]=D[6]=D[10]=D[14]=0),D}function Na(p,n,l,y,b,T,M){if(l){if(T.name==="globe"){const D=Ki(p,n,l,y,b,T,M);return r.ad.invert(D,D),r.ad.multiply(D,p,D),D}{const D=r.ad.clone(p),F=r.ad.identity([]);return F[0]=M[0],F[1]=M[1],F[4]=M[2],F[5]=M[3],r.ad.multiply(D,D,F),y||r.ad.rotateZ(D,D,-b.angle),D}}return b.glCoordMatrix}function ls(p,n,l,y){const b=[p,n,l,1];l?r.aA.transformMat4(b,b,y):Xl(b,b,y);const T=b[3];return b[0]/=T,b[1]/=T,b[2]/=T,b}function ya(p,n){return Math.min(.5+p/n*.5,1.5)}function An(p,n){const l=p[0]/p[3],y=p[1]/p[3];return l>=-n[0]&&l<=n[0]&&y>=-n[1]&&y<=n[1]}function Zl(p,n,l,y,b,T,M,D,F,V){const X=l.transform,ie=y?p.textSizeData:p.iconSizeData,le=r.aD(ie,l.transform.zoom),ue=X.projection.name==="globe",me=[256/l.width*2+1,256/l.height*2+1],ge=y?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;ge.clear();let _e=null;ue&&(_e=y?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const ye=p.lineVertexArray,Pe=y?p.text.placedSymbolArray:p.icon.placedSymbolArray,De=l.transform.width/l.transform.height;let ke,qe=!1;for(let Ve=0;Ve<Pe.length;Ve++){const Ze=Pe.get(Ve),{numGlyphs:xe,writingMode:Be}=Ze;if(Be!==r.aE.vertical||qe||ke===r.aE.horizontal||(qe=!0),ke=Be,(Ze.hidden||Be===r.aE.vertical)&&!qe){zs(xe,ge);continue}qe=!1;const Qe=new r.P(Ze.tileAnchorX,Ze.tileAnchorY);let{x:ct,y:it,z:$e}=X.projection.projectTilePoint(Qe.x,Qe.y,V.canonical);if(F){const[ni,Jt,Wt]=F(Qe);ct+=ni,it+=Jt,$e+=Wt}const ft=[ct,it,$e,1];if(r.aA.transformMat4(ft,ft,n),!An(ft,me)){zs(xe,ge);continue}const Pt=ft[3],Dt=ya(l.transform.getCameraToCenterDistance(X.projection),Pt),Lt=r.aF(ie,le,Ze),ot=M?Lt/Dt:Lt*Dt,gt=ls(ct,it,$e,b);if(gt[3]<=0){zs(xe,ge);continue}let Tt={};const Kt=M?null:F,Qt=Tc(Ze,ot,!1,D,n,b,T,p.glyphOffsetArray,ye,ge,_e,gt,Qe,Tt,De,Kt,X.projection,V,M);qe=Qt.useVertical,Kt&&Qt.needsFlipping&&(Tt={}),(Qt.notEnoughRoom||qe||Qt.needsFlipping&&Tc(Ze,ot,!0,D,n,b,T,p.glyphOffsetArray,ye,ge,_e,gt,Qe,Tt,De,Kt,X.projection,V,M).notEnoughRoom)&&zs(xe,ge)}y?(p.text.dynamicLayoutVertexBuffer.updateData(ge),_e&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData(_e)):(p.icon.dynamicLayoutVertexBuffer.updateData(ge),_e&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData(_e))}function va(p,n,l,y,b,T,M,D,F,V,X,ie,le,ue,me,ge){const{lineStartIndex:_e,glyphStartIndex:ye,segment:Pe}=D,De=ye+D.numGlyphs,ke=_e+D.lineLength,qe=n.getoffsetX(ye),Ve=n.getoffsetX(De-1),Ze=Xr(p*qe,l,y,b,T,M,Pe,_e,ke,F,V,X,ie,le,!0,ue,me,ge);if(!Ze)return null;const xe=Xr(p*Ve,l,y,b,T,M,Pe,_e,ke,F,V,X,ie,le,!0,ue,me,ge);return xe?{first:Ze,last:xe}:null}function Fs(p,n,l,y){return p===r.aE.horizontal&&Math.abs(y)>Math.abs(l)?{useVertical:!0}:p===r.aE.vertical?y>0?{needsFlipping:!0}:null:n!==fo.unknown&&function(b,T){return b===0||Math.abs(T/b)>eu}(l,y)?n===fo.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function Tc(p,n,l,y,b,T,M,D,F,V,X,ie,le,ue,me,ge,_e,ye,Pe){const De=n/24,ke=p.lineOffsetX*De,qe=p.lineOffsetY*De,{lineStartIndex:Ve,glyphStartIndex:Ze,numGlyphs:xe,segment:Be,writingMode:Qe,flipState:ct}=p,it=Ve+p.lineLength,$e=ft=>{if(X){const[ot,gt,Tt]=ft.up,Kt=V.length;r.aG(X,Kt+0,ot,gt,Tt),r.aG(X,Kt+1,ot,gt,Tt),r.aG(X,Kt+2,ot,gt,Tt),r.aG(X,Kt+3,ot,gt,Tt)}const[Pt,Dt,Lt]=ft.point;r.aH(V,Pt,Dt,Lt,ft.angle)};if(xe>1){const ft=va(De,D,ke,qe,l,ie,le,p,F,T,ue,ge,!1,_e,ye,Pe);if(!ft)return{notEnoughRoom:!0};if(y&&!l){let[Pt,Dt,Lt]=ft.first.point,[ot,gt,Tt]=ft.last.point;[Pt,Dt]=ls(Pt,Dt,Lt,M),[ot,gt]=ls(ot,gt,Tt,M);const Kt=Fs(Qe,ct,(ot-Pt)*me,gt-Dt);if(p.flipState=Kt&&Kt.needsFlipping?fo.flipRequired:fo.flipNotRequired,Kt)return Kt}$e(ft.first);for(let Pt=Ze+1;Pt<Ze+xe-1;Pt++){const Dt=Xr(De*D.getoffsetX(Pt),ke,qe,l,ie,le,Be,Ve,it,F,T,ue,ge,!1,!1,_e,ye,Pe);if(!Dt)return V.length-=4*(Pt-Ze),{notEnoughRoom:!0};$e(Dt)}$e(ft.last)}else{if(y&&!l){const Pt=ls(le.x,le.y,0,b),Dt=Ve+Be+1,Lt=new r.P(F.getx(Dt),F.gety(Dt)),ot=ls(Lt.x,Lt.y,0,b),gt=ot[3]>0?ot:On(le,Lt,Pt,1,b,void 0,_e,ye.canonical),Tt=Fs(Qe,ct,(gt[0]-Pt[0])*me,gt[1]-Pt[1]);if(p.flipState=Tt&&Tt.needsFlipping?fo.flipRequired:fo.flipNotRequired,Tt)return Tt}const ft=Xr(De*D.getoffsetX(Ze),ke,qe,l,ie,le,Be,Ve,it,F,T,ue,ge,!1,!1,_e,ye,Pe);if(!ft)return{notEnoughRoom:!0};$e(ft)}return{}}function Nt(p,n,l,y,b){const{x:T,y:M,z:D}=y.projectTilePoint(p.x,p.y,n);if(!b)return ls(T,M,D,l);const[F,V,X]=b(p);return ls(T+F,M+V,D+X,l)}function On(p,n,l,y,b,T,M,D){const F=Nt(p.sub(n)._unit()._add(p),D,b,M,T);return r._.sub(F,l,F),r._.normalize(F,F),r._.scaleAndAdd(F,l,F,y)}function Xr(p,n,l,y,b,T,M,D,F,V,X,ie,le,ue,me,ge,_e,ye){const Pe=y?p-n:p+n;let De=Pe>0?1:-1,ke=0;y&&(De*=-1,ke=Math.PI),De<0&&(ke+=Math.PI);let qe=D+M+(De>0?0:1)|0,Ve=b,Ze=b,xe=0,Be=0;const Qe=Math.abs(Pe),ct=[],it=[];let $e=T,ft=$e;const Pt=()=>On(ft,$e,Ze,Qe-xe+1,X,le,ge,_e.canonical);for(;xe+Be<=Qe;){if(qe+=De,qe<D||qe>=F)return null;if(Ze=Ve,ft=$e,ct.push(Ze),ue&&it.push(ft),$e=new r.P(V.getx(qe),V.gety(qe)),Ve=ie[qe],!Ve){const Jt=Nt($e,_e.canonical,X,ge,le);Ve=Jt[3]>0?ie[qe]=Jt:Pt()}xe+=Be,Be=r._.distance(Ze,Ve)}me&&le&&(ie[qe]&&(Ve=Pt(),Be=r._.distance(Ze,Ve)),ie[qe]=Ve);const Dt=(Qe-xe)/Be,Lt=$e.sub(ft)._mult(Dt)._add(ft),ot=r._.sub([],Ve,Ze),gt=r._.scaleAndAdd([],Ze,ot,Dt);let Tt=[0,0,1],Kt=ot[0],Qt=ot[1];if(ye&&(Tt=ge.upVector(_e.canonical,Lt.x,Lt.y),Tt[0]!==0||Tt[1]!==0||Tt[2]!==1)){const Jt=[Tt[2],0,-Tt[0]],Wt=r._.cross([],Tt,Jt);r._.normalize(Jt,Jt),r._.normalize(Wt,Wt),Kt=r._.dot(ot,Jt),Qt=r._.dot(ot,Wt)}if(l){const Jt=r._.cross([],Tt,ot);r._.normalize(Jt,Jt),r._.scaleAndAdd(gt,gt,Jt,l*De)}const ni=ke+Math.atan2(Qt,Kt);return ct.push(gt),ue&&it.push(Lt),{point:gt,angle:ni,path:ct,tilePath:it,up:Tt}}function zs(p,n){const l=n.length,y=l+4*p;n.resize(y),n.float32.fill(-1/0,4*l,4*y)}function Xl(p,n,l){const y=n[0],b=n[1];return p[0]=l[0]*y+l[4]*b+l[12],p[1]=l[1]*y+l[5]*b+l[13],p[3]=l[3]*y+l[7]*b+l[15],p}const is=(p,n,l)=>(1-l)*p+l*n,Sc=p=>p*p*p*p*p;class Dr{constructor(n,l,y,b,T,M,D){this.tileSize=512,this._renderWorldCopies=T===void 0||T,this._minZoom=n||0,this._maxZoom=l||22,this._minPitch=y??0,this._maxPitch=b??60,this.setProjection(M),this.setMaxBounds(D),this.width=0,this.height=0,this._center=new r.aI(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Js,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new js,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const n=new Dr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,l=!1){const y=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||y)&&this._updateCameraOnTerrain(),(n||y)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return r.ah(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=r.aJ(this.projectionOptions);const y=!U(l,this.getProjection());return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.aJ({name:"mercator"});const l=n!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.ax(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.au(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const l=-n*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=r.aC.create(),r.aC.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const l=r.at(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=r.ab(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const l=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,l=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!l||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const y=this._elevation;l||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&y.exaggeration()&&this._centerAltitudeValidForExaggeration!==y.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*y.exaggeration(),this._centerAltitudeValidForExaggeration=y.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=y.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let b=0,T=0;for(let M=0;M<l.length;M++){const D=new r.P(l[M][0]*this.width,y+l[M][1]*(this.height-y)),F=n.pointCoordinate(D);if(!F)continue;const V=1/Math.hypot(F[0]-this._camera.position[0],F[1]-this._camera.position[1]);b+=F[3]*V,T+=V}return T===0?NaN:b/T}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*l,b=this._mercatorZfromZoom(n),T=this._mercatorZfromZoom(this._maxZoom),M=Math.max(b-y,T);this._setZoom(this._zoomFromMercatorZ(M))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let y;y=n.z<this._camera.position[2]?[l.x,l.y,l.z]:[n.x,n.y,n.z];const b=r._.length(r._.sub([],this._camera.position,y));return r.at(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let l=!1;if(n.orientation&&!r.av.exactEquals(n.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(n.orientation)),n.position){const y=[n.position.x,n.position.y,n.position.z];r._.exactEquals(y,this._camera.position)||(this._setCameraPosition(y),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,l=new _a;return l.position=new r.Y(n[0],n[1],n[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(n){if(!r.av.length(n))return!1;r.av.normalize(n,n);const l=r._.transformQuat([],[0,0,-1],n),y=r._.transformQuat([],[0,-1,0],n);if(y[2]<0)return!1;const b=ho(l,y);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(n){const l=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;n[2]=r.at(n[2],b/y,b/l),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,l,y){this._unmodified=!1,this._edgeInsets.interpolate(n,l,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const l=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(n){const l=[new r.aK(0,n)];if(this.renderWorldCopies){const y=this.pointCoordinate(new r.P(0,0)),b=this.pointCoordinate(new r.P(this.width,0)),T=this.pointCoordinate(new r.P(this.width,this.height)),M=this.pointCoordinate(new r.P(0,this.height)),D=Math.floor(Math.min(y.x,b.x,T.x,M.x)),F=Math.floor(Math.max(y.x,b.x,T.x,M.x)),V=1;for(let X=D-V;X<=F+V;X++)X!==0&&l.push(new r.aK(X,n))}return l}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(n,l,y){let b=[];if(l[0]===0&&l[1]===0)return b;for(const M of n){const D=M.canonical,F=M.overscaledZ,V=M.wrap,X=1<<D.z,ie=D.x+1<X,le=D.x>0,ue=D.y+1<X,me=D.y>0,ge=M.wrap-(le?0:1),_e=M.wrap+(ie?0:1),ye=le?D.x-1:X-1,Pe=ie?D.x+1:0;l[0]<0?(b.push(new r.aL(F,_e,D.z,Pe,D.y)),l[1]<0&&ue&&(b.push(new r.aL(F,V,D.z,D.x,D.y+1)),b.push(new r.aL(F,_e,D.z,Pe,D.y+1))),l[1]>0&&me&&(b.push(new r.aL(F,V,D.z,D.x,D.y-1)),b.push(new r.aL(F,_e,D.z,Pe,D.y-1)))):l[0]>0?(b.push(new r.aL(F,ge,D.z,ye,D.y)),l[1]<0&&ue&&(b.push(new r.aL(F,V,D.z,D.x,D.y+1)),b.push(new r.aL(F,ge,D.z,ye,D.y+1))),l[1]>0&&me&&(b.push(new r.aL(F,V,D.z,D.x,D.y-1)),b.push(new r.aL(F,ge,D.z,ye,D.y-1)))):l[1]<0&&ue?b.push(new r.aL(F,V,D.z,D.x,D.y+1)):me&&b.push(new r.aL(F,V,D.z,D.x,D.y-1))}if(b.length>1){b.sort((F,V)=>F.overscaledZ-V.overscaledZ||F.wrap-V.wrap||F.canonical.z-V.canonical.z||F.canonical.x-V.canonical.x||F.canonical.y-V.canonical.y);let M=0,D=0;for(;D<b.length;)b[D].equals(b[M])?++D:b[++M]=b[D++];b.length=M+1}const T=[];for(const M of b)b.some(D=>M.isChildOf(D))||T.push(M);return b=T.filter(M=>!n.some(D=>!!(M.overscaledZ<y&&D.isChildOf(M))||M.equals(D)||M.isChildOf(D))),b}coveringTiles(n){let l=this.coveringZoomLevel(n);const y=l,b=this.elevation&&this.elevation.exaggeration(),T=b&&!n.isTerrainDEM,M=this.projection.name==="mercator";if(n.minzoom!==void 0&&l<n.minzoom)return[];n.maxzoom!==void 0&&l>n.maxzoom&&(l=n.maxzoom);const D=this.locationCoordinate(this.center),F=this.center.lat,V=1<<l,X=[V*D.x,V*D.y,0],ie=this.projection.name==="globe",le=!ie,ue=r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,le),me=ie?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ge=V*r.ax(1,this.center.lat),_e=this._camera.position[2]/r.ax(1,this.center.lat),ye=[V*me.x,V*me.y,_e*(le?1:ge)],Pe=ie||b,De=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),ke=this.isLODDisabled(!0)?l:0;let qe;if(this._elevation&&n.isTerrainDEM)qe=1e4*this._elevation.exaggeration();else if(this._elevation){const ot=this._elevation.getMinMaxForVisibleTiles();qe=ot?ot.max:this._centerAltitude}else qe=this._centerAltitude;const Ve=n.isTerrainDEM?-qe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ze=this.projection.isReprojectedInTileSpace?r.aN(this):1,xe=ot=>{const Tt=new r.Y(ot.x+25e-6,ot.y,ot.z),Kt=new r.Y(ot.x,ot.y+25e-6,ot.z),Qt=ot.toLngLat(),ni=Tt.toLngLat(),Jt=Kt.toLngLat(),Wt=this.locationCoordinate(Qt),wt=this.locationCoordinate(ni),hi=this.locationCoordinate(Jt),dn=Math.hypot(wt.x-Wt.x,wt.y-Wt.y),ji=Math.hypot(hi.x-Wt.x,hi.y-Wt.y);return Math.sqrt(dn*ji)*Ze/25e-6},Be=ot=>{const gt=qe,Tt=Ve;return{aabb:r.aQ(this,V,0,0,0,ot,Tt,gt,this.projection),zoom:0,x:0,y:0,minZ:Tt,maxZ:gt,wrap:ot,fullyVisible:!1}},Qe=[];let ct=[];const it=l,$e=n.reparseOverscaled?y:l,ft=(_e-this._centerAltitude)*ge,Pt=ot=>{if(!this._elevation||!ot.tileID||!M)return;const gt=this._elevation.getMinMaxForTile(ot.tileID),Tt=ot.aabb;gt?(Tt.min[2]=gt.min,Tt.max[2]=gt.max,Tt.center[2]=(Tt.min[2]+Tt.max[2])/2):(ot.shouldSplit=Lt(ot),ot.shouldSplit||(Tt.min[2]=Tt.max[2]=Tt.center[2]=this._centerAltitude))},Dt=(ot,gt)=>{if(.707*gt<ot)return 1;const Tt=gt/ot;return Tt/(1.4144271570014144+(Math.pow(1.1,Tt-1.4144271570014144+1)-1)/(1.1-1)-1)},Lt=ot=>{if(ot.zoom<ke)return!0;if(ot.zoom===it)return!1;if(ot.shouldSplit!=null)return ot.shouldSplit;const gt=ot.aabb.distanceX(ye),Tt=ot.aabb.distanceY(ye);let Kt=ft,Qt=1;if(ie){Kt=ot.aabb.distanceZ(ye);const ji=Math.pow(2,ot.zoom),Ji=r.ay((ot.y+1)/ji),Cn=r.ay(ot.y/ji),Sr=Math.min(Math.max(F,Ji),Cn),vn=r.b4(Sr)/r.b4(F);if(Qt=Sr===F?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,vn/this._mercatorScaleRatio),this.zoom<=r.b1&&ot.zoom===it-1&&vn>=.9)return!0}else if(T&&(Kt=ot.aabb.distanceZ(ye)*ge),this.projection.isReprojectedInTileSpace&&y<=5){const ji=Math.pow(2,ot.zoom),Ji=xe(new r.Y((ot.x+.5)/ji,(ot.y+.5)/ji));Qt=Ji>.85?1:Ji}if(!M){const ji=Math.sqrt(gt*gt+Tt*Tt+Kt*Kt);let Ji=(1<<it-ot.zoom)*De*Qt;return Ji*=Dt(Math.max(Kt,ft),ji),ji<Ji}let ni=Number.MAX_VALUE,Jt=0;const Wt=ot.aabb.getCorners(),wt=[];for(const ji of Wt){r._.sub(wt,ji,ye),ie||(T?wt[2]*=ge:wt[2]=ft);const Ji=r._.dot(wt,this._camera.forward());Ji<ni&&(ni=Ji,Jt=Math.abs(wt[2]))}let hi=(1<<it-ot.zoom)*De*Qt;if(hi*=Dt(Math.max(Jt,ft),ni),ni<hi)return!0;const dn=ot.aabb.closestPoint(X);return dn[0]===X[0]&&dn[1]===X[1]};if(this.renderWorldCopies)for(let ot=1;ot<=3;ot++)Qe.push(Be(-ot)),Qe.push(Be(ot));for(Qe.push(Be(0));Qe.length>0;){const ot=Qe.pop(),gt=ot.x,Tt=ot.y;let Kt=ot.fullyVisible;const Qt=()=>this.projection.name==="globe"&&(ot.y===0||ot.y===(1<<ot.zoom)-1);if(!Kt){let ni=Pe?ot.aabb.intersects(ue):ot.aabb.intersectsFlat(ue);if(ni===0&&Qt()){const Jt=new r.aO(ot.zoom,gt,Tt);ni=r.aP(this,V,Jt,!0).intersects(ue)}if(ni===0)continue;Kt=ni===2}if(ot.zoom!==it&&Lt(ot))for(let ni=0;ni<4;ni++){const Jt=(gt<<1)+ni%2,Wt=(Tt<<1)+(ni>>1),wt={aabb:M?ot.aabb.quadrant(ni):r.aQ(this,V,ot.zoom+1,Jt,Wt,ot.wrap,ot.minZ,ot.maxZ,this.projection),zoom:ot.zoom+1,x:Jt,y:Wt,wrap:ot.wrap,fullyVisible:Kt,tileID:void 0,shouldSplit:void 0,minZ:ot.minZ,maxZ:ot.maxZ};T&&!ie&&(wt.tileID=new r.aL(ot.zoom+1===it?$e:ot.zoom+1,ot.wrap,ot.zoom+1,Jt,Wt),Pt(wt)),Qe.push(wt)}else{const ni=ot.zoom===it?$e:ot.zoom;if(n.minzoom&&n.minzoom>ni)continue;if(!Kt){let hi=Pe?ot.aabb.intersectsPrecise(ue):ot.aabb.intersectsPreciseFlat(ue);if(hi===0&&Qt()){const dn=new r.aO(ot.zoom,gt,Tt);hi=r.aP(this,V,dn,!0).intersectsPrecise(ue)}if(hi===0)continue}const Jt=X[0]-(.5+gt+(ot.wrap<<ot.zoom))*(1<<l-ot.zoom),Wt=X[1]-.5-Tt,wt=ot.tileID?ot.tileID:new r.aL(ni,ot.wrap,ot.zoom,gt,Tt);ct.push({tileID:wt,distanceSq:Jt*Jt+Wt*Wt})}}if(this.fogCullDistSq){const ot=this.fogCullDistSq,gt=this.horizonLineFromTop();ct=ct.filter(Tt=>{const Kt=[0,0,0,1],Qt=[r.a3,r.a3,0,1],ni=this.calculateFogTileMatrix(Tt.tileID.toUnwrapped());r.aA.transformMat4(Kt,Kt,ni),r.aA.transformMat4(Qt,Qt,ni);const Jt=r.aA.min([],Kt,Qt),Wt=r.aA.max([],Kt,Qt),wt=r.aR(Jt,Wt);if(wt===0)return!0;let hi=!1;const dn=this._elevation;if(dn&&wt>ot&&gt!==0){const ji=this.calculateProjMatrix(Tt.tileID.toUnwrapped());let Ji;n.isTerrainDEM||(Ji=dn.getMinMaxForTile(Tt.tileID)),Ji||(Ji={min:Ve,max:qe});const Cn=r.b2(this.rotation),Sr=[Cn[0]*r.a3,Cn[1]*r.a3,Ji.max];r._.transformMat4(Sr,Sr,ji),hi=(1-Sr[1])*this.height*.5<gt}return wt<ot||hi})}return ct.sort((ot,gt)=>ot.distanceSq-gt.distanceSq).map(ot=>ot.tileID)}resize(n,l){this.width=n,this.height=l,this.pixelsToGLUnits=[2/n,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const l=r.at(n.lat,-r.aS,r.aS),y=this.projection.project(n.lng,l);return new r.P(y.x*this.worldSize,y.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.ax(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,l){let y,b;const T=this.centerPoint;if(this.projection.name==="globe"){const D=this.worldSize;y=(l.x-T.x)/D,b=(l.y-T.y)/D}else{const D=this.pointCoordinate(l),F=this.pointCoordinate(T);y=D.x-F.x,b=D.y-F.y}const M=this.locationCoordinate(n);this.setLocation(new r.Y(M.x-y,M.y-b))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,l){const y=l?r.ax(l,n.lat):void 0,b=this.projection.project(n.lng,n.lat);return new r.Y(b.x,b.y,y)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,l){const y=l??this._centerAltitude,b=[n.x,n.y,0,1],T=[n.x,n.y,1,1];r.aA.transformMat4(b,b,this.pixelMatrixInverse),r.aA.transformMat4(T,T,this.pixelMatrixInverse);const M=T[3];r.aA.scale(b,b,1/b[3]),r.aA.scale(T,T,1/M);const D=b[2],F=T[2];return{p0:b,p1:T,t:D===F?0:(y-D)/(F-D)}}screenPointToMercatorRay(n){const l=[n.x,n.y,0,1],y=[n.x,n.y,1,1];return r.aA.transformMat4(l,l,this.pixelMatrixInverse),r.aA.transformMat4(y,y,this.pixelMatrixInverse),r.aA.scale(l,l,1/l[3]),r.aA.scale(y,y,1/y[3]),l[2]=r.ax(l[2],this._center.lat)*this.worldSize,y[2]=r.ax(y[2],this._center.lat)*this.worldSize,r.aA.scale(l,l,1/this.worldSize),r.aA.scale(y,y,1/this.worldSize),new r.aT([l[0],l[1],l[2]],r._.normalize([],r._.sub([],y,l)))}rayIntersectionCoordinate(n){const{p0:l,p1:y,t:b}=n,T=r.ax(l[2],this._center.lat),M=r.ax(y[2],this._center.lat);return new r.Y(r.a2(l[0],y[0],b)/this.worldSize,r.a2(l[1],y[1],b)/this.worldSize,r.a2(T,M,b))}pointCoordinate(n,l=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,l)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let l=this.projection.pointCoordinate3D(this,n.x,n.y);if(l)return new r.Y(l[0],l[1],l[2]);let y=0,b=this.horizonLineFromTop();if(n.y>b)return this.pointCoordinate(n);const T=.02*b,M=n.clone();for(let D=0;D<10&&b-y>T;D++){M.y=r.a2(y,b,.66);const F=this.projection.pointCoordinate3D(this,M.x,M.y);F?(b=M.y,l=F):y=M.y}return l?new r.Y(l[0],l[1],l[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=r.aU)return!this.isPointAboveHorizon(n);const l=this.pointCoordinate(n);return l.y>=0&&l.y<=1}_coordinatePoint(n,l){const y=l&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,b=[n.x*this.worldSize,n.y*this.worldSize,y+n.toAltitude(),1];return r.aA.transformMat4(b,b,this.pixelMatrix),b[3]>0?new r.P(b[0]/b[3],b[1]/b[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:l}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,T=this.pointLocation3D(new r.P(l,n)),M=this.pointLocation3D(new r.P(b,n)),D=this.pointLocation3D(new r.P(b,y)),F=this.pointLocation3D(new r.P(l,y));let V=Math.min(T.lng,M.lng,D.lng,F.lng),X=Math.max(T.lng,M.lng,D.lng,F.lng),ie=Math.min(T.lat,M.lat,D.lat,F.lat),le=Math.max(T.lat,M.lat,D.lat,F.lat);const ue=Math.pow(2,-this.zoom)/16*270,me=this.projection.name==="globe"?1:4,ge=(_e,ye,Pe,De,ke)=>{const qe=(_e+Pe)/2,Ve=(ye+De)/2,Ze=new r.P(qe,Ve),{lng:xe,lat:Be}=this.pointLocation3D(Ze),Qe=Math.max(0,V-xe,ie-Be,xe-X,Be-le);V=Math.min(V,xe),X=Math.max(X,xe),ie=Math.min(ie,Be),le=Math.max(le,Be),(ke<me||Qe>ue)&&(ge(_e,ye,qe,Ve,ke+1),ge(qe,Ve,Pe,De,ke+1))};if(ge(l,n,b,n,1),ge(b,n,b,y,1),ge(b,y,l,y,1),ge(l,y,l,n,1),this.projection.name==="globe"){const[_e,ye]=r.aV(this);_e?(le=90,X=180,V=-180):ye&&(ie=-90,X=180,V=-180)}return new r.ai(new r.aI(V,ie),new r.aI(X,le))}_getBoundsRectangular(n,l){const{top:y,left:b}=this._edgeInsets,T=this.height-this._edgeInsets.bottom,M=this.width-this._edgeInsets.right,D=new r.P(b,y),F=new r.P(M,y),V=new r.P(M,T),X=new r.P(b,T);let ie=this.pointCoordinate(D,n),le=this.pointCoordinate(F,n);const ue=this.pointCoordinate(V,l),me=this.pointCoordinate(X,l),ge=(_e,ye)=>(ye.y-_e.y)/(ye.x-_e.x);return ie.y>1&&le.y>=0?ie=new r.Y((1-me.y)/ge(me,ie)+me.x,1):ie.y<0&&le.y<=1&&(ie=new r.Y(-me.y/ge(me,ie)+me.x,0)),le.y>1&&ie.y>=0?le=new r.Y((1-ue.y)/ge(ue,le)+ue.x,1):le.y<0&&ie.y<=1&&(le=new r.Y(-ue.y/ge(ue,le)+ue.x,0)),new r.ai().extend(this.coordinateLocation(ie)).extend(this.coordinateLocation(le)).extend(this.coordinateLocation(me)).extend(this.coordinateLocation(ue))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=n.visibleDemTiles.reduce((y,b)=>{if(b.dem){const T=b.dem.tree;y.min=Math.min(y.min,T.minimums[0]),y.max=Math.max(y.max,T.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*n.exaggeration(),l.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,y=this.height/2-l*(1-this._horizonShift);return n?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-r.aS,this.maxLat=r.aS,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.aj(this.minLng)*this.tileSize,this.worldMaxX=r.aj(this.maxLng)*this.tileSize,this.worldMinY=r.ak(this.maxLat)*this.tileSize,this.worldMaxY=r.ak(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,l){return this.projection.createTileMatrix(this,l,n)}calculateDistanceTileData(n){const l=n.key,y=this._distanceTileDataCache;if(y[l])return y[l];const b=n.canonical,T=1/this.height,M=this.cameraWorldSize,D=M/this.zoomScale(b.z),F=(b.x+Math.pow(2,b.z)*n.wrap)*D,V=b.y*D,X=this.point;X.x*=M/this.worldSize,X.y*=M/this.worldSize;const ie=this.angle,le=Math.sin(-ie),ue=-Math.cos(-ie);return y[l]={bearing:[le,ue],center:[(X.x-F)*T,(X.y-V)*T],scale:D/r.a3*T},y[l]}calculateFogTileMatrix(n){const l=n.key,y=this._fogTileMatrixCache;if(y[l])return y[l];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return r.ad.multiply(b,this.worldToFogMatrix,b),y[l]=new Float32Array(b),y[l]}calculateProjMatrix(n,l=!1,y=!1){const b=n.key;let T;if(T=y?this._expandedProjMatrixCache:l?this._alignedProjMatrixCache:this._projMatrixCache,T[b])return T[b];const M=this.calculatePosMatrix(n,this.worldSize);let D;return D=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:y?this.expandedFarZProjMatrix:l?this.alignedProjMatrix:this.projMatrix,r.ad.multiply(M,D,M),T[b]=new Float32Array(M),T[b]}calculatePixelsToTileUnitsMatrix(n){const l=n.tileID.key,y=this._pixelsToTileUnitsCache;if(y[l])return y[l];const b=r.aW(n,this);return y[l]=b,y[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,l=r.ad.fromScaling([],[n,n,n]);return r.ad.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const l=r.ax(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(l),b=this._camera.forward(),T=r.ax(1,this._center.lat);y[2]/=T,b[2]/=T,r._.normalize(b,b);const M=n.raycast(y,b,n.exaggeration());if(M){const D=r._.scaleAndAdd([],y,b,M),F=new r.Y(D[0],D[1],r.ax(D[2],r.ay(D[1]))),V=(F.z+r._.length([F.x-y[0],F.y-y[1],F.z-y[2]*T]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(V),this._centerAltitude=F.toAltitude(),this._center=this.coordinateLocation(F),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const l=this._elevation,y=r.ax(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(y),T=l.getAtPointOrZero(new r.Y(...b)),M=this.pixelsPerMeter/this.worldSize*T,D=this._minimumHeightOverTerrain(),F=b[2]-M;if(F<=D)if(F<0||n){const V=this.locationCoordinate(this._center,this._centerAltitude),X=[b[0],b[1],V.z-b[2]],ie=r._.length(X);X[2]-=(D-F)/this._pixelsPerMercatorPixel;const le=r._.length(X);if(le===0)return;r._.scale(X,X,ie/le*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],V.z*this._pixelsPerMercatorPixel-X[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const le=this.center;return le.lat=r.at(le.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(le.lng=r.at(le.lng,this.minLng,this.maxLng)),this.center=le,void(this._constraining=!1)}const l=this._unmodified,{x:y,y:b}=this.point;let T=0,M=y,D=b;const F=this.width/2,V=this.height/2,X=this.worldMinY*this.scale,ie=this.worldMaxY*this.scale;if(b-V<X&&(D=X+V),b+V>ie&&(D=ie-V),ie-X<this.height&&(T=Math.max(T,this.height/(ie-X)),D=(ie+X)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const le=this.worldMinX*this.scale,ue=this.worldMaxX*this.scale,me=this.worldSize/2-(le+ue)/2;M=(y+me+this.worldSize)%this.worldSize-me,M-F<le&&(M=le+F),M+F>ue&&(M=ue-F),ue-le<this.width&&(T=Math.max(T,this.width/(ue-le)),M=(ue+le)/2)}M===y&&D===b||(this.center=this.unproject(new r.P(M,D))),T&&(this.zoom+=this.scaleZoom(T)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,l=this.projection.name==="globe",y=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.ax(1,this.center.lat)/r.ax(1,r.b3));const b=r.aX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,b),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const T=this.projection.zAxisUnit==="meters"?y:1,M=this._camera.getWorldToCamera(this.worldSize,T);let D;const F=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(F[8]=2*-n.x/this.width,F[9]=2*n.y/this.height,this.isOrthographic){let Be=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Qe=Be*this.aspect,ct=-Qe,it=-Be;Qe-=n.x,ct-=n.x,Be+=n.y,it+=n.y,D=this._camera.getCameraToClipOrthographic(ct,Qe,it,Be,this._nearZ,this._farZ),(($e,ft,Pt,Dt)=>{for(let Lt=0;Lt<16;Lt++)$e[Lt]=is(ft[Lt],Pt[Lt],Dt)})(D,D,F,Sc(this.pitch>=15?1:this.pitch/15))}else D=F;const V=r.ad.mul([],F,M);let X=r.ad.mul([],D,M);if(this.projection.isReprojectedInTileSpace){const Be=this.locationCoordinate(this.center),Qe=r.ad.identity([]);r.ad.translate(Qe,Qe,[Be.x*this.worldSize,Be.y*this.worldSize,0]),r.ad.multiply(Qe,Qe,r.aY(this)),r.ad.translate(Qe,Qe,[-Be.x*this.worldSize,-Be.y*this.worldSize,0]),r.ad.multiply(X,X,Qe),r.ad.multiply(V,V,Qe),this.inverseAdjustmentMatrix=r.aZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.ad.scale([],X,[this.worldSize,this.worldSize,this.worldSize/T,1]),this.projMatrix=X,this.invProjMatrix=r.ad.invert(new Float64Array(16),this.projMatrix),l){const Be=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Be[8]=2*-n.x/this.width,Be[9]=2*n.y/this.height,this.expandedFarZProjMatrix=r.ad.mul([],Be,M)}else this.expandedFarZProjMatrix=this.projMatrix;const ie=r.ad.invert([],D);this.frustumCorners=r.a_.fromInvProjectionMatrix(ie,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!l);const le=new Float32Array(16);r.ad.identity(le),r.ad.scale(le,le,[1,-1,1]),r.ad.rotateX(le,le,this._pitch),r.ad.rotateZ(le,le,this.angle);const ue=r.ad.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.ad.clone(ue);const me=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;ue[8]=2*-n.x/this.width,ue[9]=2*(n.y+me)/this.height,this.skyboxMatrix=r.ad.multiply(le,ue,le);const ge=this.point,_e=ge.x,ye=ge.y,Pe=this.width%2/2,De=this.height%2/2,ke=Math.cos(this.angle),qe=Math.sin(this.angle),Ve=_e-Math.round(_e)+ke*Pe+qe*De,Ze=ye-Math.round(ye)+ke*De+qe*Pe,xe=new Float64Array(X);if(r.ad.translate(xe,xe,[Ve>.5?Ve-1:Ve,Ze>.5?Ze-1:Ze,0]),this.alignedProjMatrix=xe,X=r.ad.create(),r.ad.scale(X,X,[this.width/2,-this.height/2,1]),r.ad.translate(X,X,[1,-1,0]),this.labelPlaneMatrix=X,X=r.ad.create(),r.ad.scale(X,X,[1,-1,1]),r.ad.translate(X,X,[-1,-1,0]),r.ad.scale(X,X,[2/this.width,2/this.height,1]),this.glCoordMatrix=X,this.pixelMatrix=r.ad.multiply(new Float64Array(16),this.labelPlaneMatrix,V),this._calcFogMatrices(),this._distanceTileDataCache={},X=r.ad.invert(new Float64Array(16),this.pixelMatrix),!X)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=X,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.a$(this);const Be=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r._.transformMat4(Be,Be,M),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=X;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,y=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,T=[n,n,l];r._.scale(T,T,b),r._.scale(y,y,-1),r._.multiply(y,y,T);const M=r.ad.create();r.ad.translate(M,M,y),r.ad.scale(M,M,T),this.mercatorFogMatrix=M,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,l,b)}_computeCameraPosition(n){const l=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),b=this.point,T=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-n/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-y[0]*T,b.y/this.worldSize-y[1]*T,n/this.worldSize*this._centerAltitude-y[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=this._camera.position[2],b=n[2];let T=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(T=Math.min((l-y)/b,1)),this._camera.position=r._.scaleAndAdd([],this._camera.position,n,T),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,l=this._camera.forward(),{pitch:y,bearing:b}=this._camera.getPitchBearing(),T=r.ax(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,M=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.ab(this._maxPitch)),D=Math.max((n[2]-T)/Math.cos(y),M),F=this._zoomFromMercatorZ(D);r._.scaleAndAdd(n,n,l,D),this._pitch=r.at(y,r.ab(this.minPitch),r.ab(this.maxPitch)),this.angle=r.au(b,-Math.PI,Math.PI),this._setZoom(r.at(F,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.Y(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let l=0,y=r.aU,b=0,T=1/0;for(;y-l>1e-6&&y>l;){const M=l+.5*(y-l),D=this.tileSize*Math.pow(2,M),F=this.getCameraToCenterDistance(this.projection,M,D),V=this.scaleZoom(F/(n*this.tileSize)),X=Math.abs(M-V);X<T&&(T=X,b=M),M<V?l=M:y=M}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,l){const y=Math.min(n.x,l.x),b=Math.max(n.x,l.x),T=Math.min(n.y,l.y),M=Math.max(n.y,l.y);if(T<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const D=[new r.P(y,T),new r.P(b,M),new r.P(y,M),new r.P(b,T)],F=this.renderWorldCopies?-3:0,V=this.renderWorldCopies?4:1;for(const X of D){const ie=this.pointRayIntersection(X);if(ie.t<0)return!0;const le=this.rayIntersectionCoordinate(ie);if(le.x<F||le.y<0||le.x>V||le.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.b0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(n,l){const y=r._.length(r._.sub([],this._camera.position,n)),b=this._zoomFromMercatorZ(y)+l;return y-this._mercatorZfromZoom(b)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([l,y,b],T){const M=[l,y,b,1];r.aA.transformMat4(M,M,T);const D=M[3]=Math.max(M[3],1e-6);return M[0]/=D,M[1]/=D,M[2]/=D,M}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,n))}}getCameraToCenterDistance(n,l=this.zoom,y=this.worldSize){const b=r.aX(n,l,this.width,this.height,1024),T=n.pixelSpaceConversion(this.center.lat,y,b);let M=.5/Math.tan(.5*this._fov)*this.height*T;return this.isOrthographic&&(M=is(1,M,Sc(this.pitch>=15?1:this.pitch/15))),M}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.ad.multiply(n,n,this.globeMatrix),n}getFrustum(n){return r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const Ir={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},Rr=(p,n)=>{if(n>0&&p.terrain&&r.w("Cutoff is currently disabled on terrain"),n<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const l=p.transform,y=Math.max(Math.abs(l._zoom-(p.minCutoffZoom-1)),1),b=l.isLODDisabled(!1)?r.$(60,45,l.pitch):r.$(30,15,l.pitch),T=l._farZ-l._nearZ,M=n*l.height,D=((1-(F=b))*l.cameraToCenterDistance+F*(l._farZ+M))*y;var F;return{shouldRenderCutoff:b<1,uniformValues:{u_cutoff_params:[l._nearZ,l._farZ,(D-l._nearZ)/T,(D-M-l._nearZ)/T]}}},kr={cascadeCount:2,shadowMapResolution:2048};class Mr{constructor(n,l){this.aabb=n,this.lastCascade=l}}class Fa{add(n,l){const y=this.receivers[n.key];y!==void 0?(y.aabb.min[0]=Math.min(y.aabb.min[0],l.min[0]),y.aabb.min[1]=Math.min(y.aabb.min[1],l.min[1]),y.aabb.min[2]=Math.min(y.aabb.min[2],l.min[2]),y.aabb.max[0]=Math.max(y.aabb.max[0],l.max[0]),y.aabb.max[1]=Math.max(y.aabb.max[1],l.max[1]),y.aabb.max[2]=Math.max(y.aabb.max[2],l.max[2])):this.receivers[n.key]=new Mr(l,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,l,y){const b=r.b6.fromPoints(n.points);let T=0;for(const M in this.receivers){const D=this.receivers[M];if(!D||!b.intersectsAabb(D.aabb))continue;D.aabb.min=b.closestPoint(D.aabb.min),D.aabb.max=b.closestPoint(D.aabb.max);const F=D.aabb.getCorners();for(let V=0;V<y.length;V++){let X=!0;for(const ie of F){const le=[ie[0]*l,ie[1]*l,ie[2]];if(r._.transformMat4(le,le,y[V].matrix),le[0]<-1||le[0]>1||le[1]<-1||le[1]>1){X=!1;break}}if(D.lastCascade=V,T=Math.max(T,V),X)break}}return T+1}}class gs{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Fa,this._depthMode=new r.ae(n.context.gl.LEQUAL,r.ae.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,n.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),n.tp.registerParameter(kr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(kr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),n.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,l){const y=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!l||!l.properties)return;const b=l.properties.get("shadow-intensity");if(!l.shadowsEnabled()||b<=0||(this._shadowLayerCount=y.style.order.reduce((me,ge)=>{const _e=y.style._mergedLayers[ge];return me+(_e.hasShadowPass()&&!_e.isHidden(n.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const T=y.context,M=kr.shadowMapResolution,D=kr.shadowMapResolution;if(this._cascades.length===0||kr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let me=0;me<kr.cascadeCount;++me){const ge=y._shadowMapDebug,_e=T.gl,ye=T.createFramebuffer(M,D,ge,"texture"),Pe=new r.T(T,{width:M,height:D,data:null},_e.DEPTH_COMPONENT);if(ye.depthAttachment.set(Pe.texture),ge){const De=new r.T(T,{width:M,height:D,data:null},_e.RGBA);ye.colorAttachment.set(De.texture)}this._cascades.push({framebuffer:ye,texture:Pe,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.aM,scale:0})}}this.shadowDirection=ln(l);let F=0;if(n.elevation){const me=n.elevation,ge=[1e4,-1e4];me.visibleDemTiles.filter(_e=>_e.dem).forEach(_e=>{const ye=_e.dem.tree;ge[0]=Math.min(ge[0],ye.minimums[0]),ge[1]=Math.max(ge[1],ye.maximums[0])}),ge[0]!==1e4&&(F=(ge[1]-ge[0])*me.exaggeration())}const V=1.5*n.cameraToCenterDistance,X=3*V,ie=new Float64Array(16);for(let me=0;me<this._cascades.length;++me){const ge=this._cascades[me];let _e=n.height/50,ye=1;kr.cascadeCount===1?ye=X:me===0?ye=V:(_e=V,ye=X);const[Pe,De]=cr(n,this.shadowDirection,_e,ye,kr.shadowMapResolution,F);ge.scale=n.scale,ge.matrix=Pe,ge.boundingSphereRadius=De,r.ad.invert(ie,ge.matrix),ge.frustum=r.aM.fromInvProjectionMatrix(ie,1,0,!0),ge.far=ye}const le=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[le].far,this._cascades[le].far],this._uniformValues.u_shadow_intensity=b,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/kr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=kr.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ir.ShadowMap0,this._uniformValues.u_shadowmap_1=Ir.ShadowMap0+1,this._groundShadowTiles=y.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const ue=y.transform.elevation;for(const me of this._groundShadowTiles){let ge={min:0,max:0};if(ue){const _e=ue.getMinMaxForTile(me);_e&&(ge=_e)}this.addShadowReceiver(me.toUnwrapped(),ge.min,ge.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,l){if(!this.enabled)return;const y=this.painter,b=y.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(y.transform.getFrustum(0),y.transform.worldSize,this._cascades),b.viewport.set([0,0,kr.shadowMapResolution,kr.shadowMapResolution]);for(let T=0;T<this._numCascadesToRender;++T){y.currentShadowCascade=T,b.bindFramebuffer.set(this._cascades[T].framebuffer.framebuffer),b.clear({color:r.C.white,depth:1});for(const M of n.order){const D=n._mergedLayers[M];if(!D.hasShadowPass()||D.isHidden(y.transform.zoom))continue;const F=n.getLayerSourceCache(D),V=F?l[F.id]:void 0;(D.type==="model"||V&&V.length)&&y.renderLayer(y,F,D,V)}}y.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,l=n.style,y=n.context,b=l.directionalLight,T=l.ambientLight;if(!b||!T)return;const M=[],D=Rr(n,n.longestCutoffRange);D.shouldRenderCutoff&&M.push("RENDER_CUTOFF");const F=nl(l,b,T),V=new r.ae(y.gl.LEQUAL,r.ae.ReadOnly,n.depthRangeFor3D);for(const X of this._groundShadowTiles){const ie=X.toUnwrapped(),le=n.isTileAffectedByFog(X),ue=n.getOrCreateProgram("groundShadow",{defines:M,overrideFog:le});this.setupShadows(ie,ue),n.uploadCommonUniforms(y,ue,ie,null,D);const me={u_matrix:n.transform.calculateProjMatrix(ie),u_ground_shadow_factor:F};ue.draw(n,y.gl.TRIANGLES,V,r.ag.disabled,r.a.multiply,r.af.disabled,me,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,{},n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?r.a.unblended:r.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const l=this.painter.transform,y=l.calculatePosMatrix(n,l.worldSize);return r.ad.multiply(y,this._cascades[this.painter.currentShadowCascade].matrix,y),Float32Array.from(y)}calculateShadowPassMatrixFromMatrix(n){return r.ad.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,l,y,b=0){if(!this.enabled)return;const T=this.painter.transform,M=this.painter.context,D=M.gl,F=this._uniformValues,V=new Float64Array(16),X=T.calculatePosMatrix(n,T.worldSize);for(let ie=0;ie<this._cascades.length;ie++)r.ad.multiply(V,this._cascades[ie].matrix,X),F[ie===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(V),M.activeTexture.set(D.TEXTURE0+Ir.ShadowMap0+ie),this._cascades[ie].texture.bind(D.NEAREST,D.CLAMP_TO_EDGE);if(this.useNormalOffset=!!y,this.useNormalOffset){const ie=r.b5(n.canonical),le=2/T.tileSize*r.a3/kr.shadowMapResolution,ue=le*this._cascades[0].boundingSphereRadius,me=le*this._cascades[this._cascades.length-1].boundingSphereRadius,ge=(y==="vector-tile"?1:3)/Math.pow(2,b-n.canonical.z-(1-T.zoom+Math.floor(T.zoom)));F.u_shadow_normal_offset=[ie,ue*ge,me*ge],F.u_shadow_bias=[6e-5,.0012,.012]}else F.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(M,F)}setupShadowsFromMatrix(n,l,y=!1){if(!this.enabled)return;const b=this.painter.context,T=b.gl,M=this._uniformValues,D=new Float64Array(16);for(let F=0;F<kr.cascadeCount;F++)r.ad.multiply(D,this._cascades[F].matrix,n),M[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),b.activeTexture.set(T.TEXTURE0+Ir.ShadowMap0+F),this._cascades[F].texture.bind(T.NEAREST,T.CLAMP_TO_EDGE);this.useNormalOffset=y,y?(M.u_shadow_normal_offset=[1,5,5],M.u_shadow_bias=[6e-5,.0012,.012]):M.u_shadow_bias=[36e-5,.0012,.012],l.setShadowUniformValues(b,M)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,l,y,b){if(b[2]>=0)return{};const T=function(F,V,X){const ie=X/(1<<F.canonical.z);return new r.b6([F.canonical.x*ie+F.wrap*X,F.canonical.y*ie+F.wrap*X,0],[(F.canonical.x+1)*ie+F.wrap*X,(F.canonical.y+1)*ie+F.wrap*X,V])}(n,l,y).getCorners(),M=l/-b[2];b[0]<0?(r._.add(T[0],T[0],[b[0]*M,0,0]),r._.add(T[3],T[3],[b[0]*M,0,0])):b[0]>0&&(r._.add(T[1],T[1],[b[0]*M,0,0]),r._.add(T[2],T[2],[b[0]*M,0,0])),b[1]<0?(r._.add(T[0],T[0],[0,b[1]*M,0]),r._.add(T[1],T[1],[0,b[1]*M,0])):b[1]>0&&(r._.add(T[2],T[2],[0,b[1]*M,0]),r._.add(T[3],T[3],[0,b[1]*M,0]));const D={};return D.vertices=T,D.planes=[rr(T[1],T[0],T[4]),rr(T[2],T[1],T[5]),rr(T[3],T[2],T[6]),rr(T[0],T[3],T[7])],D}addShadowReceiver(n,l,y){this._receivers.add(n,r.b6.fromTileIdAndHeight(n,l,y))}getMaxCascadeForTile(n){const l=this._receivers.get(n);return l&&l.lastCascade?l.lastCascade:0}}function rr(p,n,l){const y=r._.sub([],l,n),b=r._.sub([],p,n),T=r._.cross([],y,b),M=r._.length(T);return M===0?[0,0,1,0]:(r._.scale(T,T,1/M),[T[0],T[1],T[2],-r._.dot(T,n)])}function ln(p){const n=p.properties.get("direction"),l=r.ac(n.x,n.y,n.z);l[2]=r.at(l[2],0,75);const y=r.b7([l[0],l[1],l[2]]);return r._.fromValues(y.x,y.y,y.z)}function nl(p,n,l){const y=n.properties.get("color"),b=n.properties.get("intensity"),T=n.properties.get("direction"),M=[T.x,T.y,T.z],D=l.properties.get("color"),F=l.properties.get("intensity"),V=Math.max(r._.dot([0,0,1],M),0),X=[0,0,0];r._.scale(X,D.toRenderColor(p.getLut(n.scope)).toArray01Linear().slice(0,3),F);const ie=[0,0,0];return r._.scale(ie,y.toRenderColor(p.getLut(l.scope)).toArray01Linear().slice(0,3),V*b),r.b8([X[0]>0?X[0]/(X[0]+ie[0]):0,X[1]>0?X[1]/(X[1]+ie[1]):0,X[2]>0?X[2]/(X[2]+ie[2]):0])}function cr(p,n,l,y,b,T){const M=p.zoom,D=p.scale,F=p.worldSize,V=1/F,X=p.aspect,ie=Math.sqrt(1+X*X)*Math.tan(.5*p.fovX),le=ie*ie,ue=y-l,me=y+l;let ge,_e;le>ue/me?(ge=y,_e=y*ie):(ge=.5*me*(1+le),_e=.5*Math.sqrt(ue*ue+2*(y*y+l*l)*le+me*me*le*le));const ye=p.projection.pixelsPerMeter(p.center.lat,F),Pe=p._camera.getCameraToWorldMercator(),De=[0,0,-ge*V];r._.transformMat4(De,De,Pe);let ke=_e*V;const qe=p._edgeInsets;if(!(qe.left===0&&qe.top===0&&qe.right===0&&qe.bottom===0||qe.left===qe.right&&qe.top===qe.bottom)){const Kt=p._camera.getWorldToCamera(p.worldSize,p.projection.zAxisUnit==="meters"?ye:1),Qt=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,l,y);Qt[8]=2*-p.centerOffset.x/p.width,Qt[9]=2*p.centerOffset.y/p.height;const ni=new Float64Array(16);r.ad.mul(ni,Qt,Kt);const Jt=new Float64Array(16);r.ad.invert(Jt,ni);const Wt=r.aM.fromInvProjectionMatrix(Jt,F,M,!0);for(const wt of Wt.points){const hi=((Ve=wt)[0]/=D,Ve[1]/=D,Ve[2]=r.ax(Ve[2],p._center.lat),Ve);ke=Math.max(ke,r._.len(r._.subtract([],De,hi)))}}var Ve;ke*=b/(b-1);const Ze=Math.acos(n[2]),xe=Math.atan2(-n[0],-n[1]),Be=new js;Be.position=De,Be.setPitchBearing(Ze,xe);const Qe=Be.getWorldToCamera(F,ye),ct=ke*F,it=Math.min(p._mercatorZfromZoom(17)*F*-2,-2*ct),$e=Be.getCameraToClipOrthographic(-ct,ct,-ct,ct,it,(ct+T*ye)/n[2]),ft=new Float64Array(16);r.ad.multiply(ft,$e,Qe);const Pt=r._.fromValues(Math.floor(1e6*De[0])/1e6*F,Math.floor(1e6*De[1])/1e6*F,0),Dt=.5*b,Lt=[0,0,0];r._.transformMat4(Lt,Pt,ft),r._.scale(Lt,Lt,Dt);const ot=[Math.floor(Lt[0]),Math.floor(Lt[1]),Math.floor(Lt[2])],gt=[0,0,0];r._.sub(gt,Lt,ot),r._.scale(gt,gt,-1/Dt);const Tt=new Float64Array(16);return r.ad.identity(Tt),r.ad.translate(Tt,Tt,gt),r.ad.multiply(ft,Tt,ft),[ft,ct]}function Vo(p,n){return p!=null&&n!=null&&!(!p.hasData()||!n.hasData())&&p.demTexture!=null&&n.demTexture!=null&&p.tileID.key!==n.tileID.key}const _s=new class{constructor(){this.operations={}}newMorphing(p,n,l,y,b){if(p in this.operations){const T=this.operations[p];T.to.tileID.key!==l.tileID.key&&(T.queued=l)}else this.operations[p]={startTime:y,phase:0,duration:b,from:n,to:l,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const n=this.operations[p];return{from:n.from,to:n.to,phase:n.phase}}update(p){for(const n in this.operations){const l=this.operations[n];for(l.phase=(p-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,p)){delete this.operations[n];break}}}_nextOp(p,n){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=n,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},Ac={0:null,1:"TERRAIN_VERTEX_MORPHING"};function cs(p,n,l){if(n===0)return 0;const y=n<1&&l===514?.25/n:1;return 6*Math.pow(1.5,22-p)*Math.max(n,1)*y}function Yl(p,n){const l=1<<p.z;return!n&&(p.x===0||p.x===l-1)||p.y===0||p.y===l-1}const bl=p=>({u_matrix:p});function rl(p,n,l,y,b){if(b>0){const T=r.e.now(),M=(T-p.timeAdded)/b,D=n?(T-n.timeAdded)/b:-1,F=l.getSource(),V=y.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),X=!n||Math.abs(n.tileID.overscaledZ-V)>Math.abs(p.tileID.overscaledZ-V),ie=X&&p.refreshedUponExpiration?1:r.at(X?M:1-D,0,1);return p.refreshedUponExpiration&&M>=1&&(p.refreshedUponExpiration=!1),n?{opacity:1,mix:1-ie}:{opacity:ie,mix:0}}return{opacity:1,mix:0}}class za extends Ns{constructor(n,l,y,b){super(n,l,y,b),this.type="raster-array",this.maxzoom=22,this._options=r.W({type:"raster-array"},l)}triggerRepaint(n){const l=this.map.painter._terrain,y=this.map.style.getSourceCache(this.id);l&&l.enabled&&y&&l._clearRenderCacheForTile(y.id,n.tileID),this.map.triggerRepaint()}loadTile(n,l){const y=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),b=this.map._requestManager.transformRequest(y,r.R.Tile);n.requestParams=b,n.actor||(n.actor=this.dispatcher.getActor()),n.request=n.fetchHeader(void 0,(T,M,D,F)=>{if(delete n.request,n.aborted)return n.state="unloaded",l(null);if(T)return T.code===20?void 0:(n.state="errored",l(T));this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:D,expires:F}),n.state="empty",l(null)})}unloadTile(n,l){const y=n.texture;y&&y instanceof r.T?(n.destroy(!0),this.map.painter.saveTileTexture(y)):(n.destroy(),n.flushQueues(),n._isHeaderLoaded=!1,delete n._mrt,delete n.textureDescriptor),n.fbo&&(n.fbo.destroy(),delete n.fbo),delete n.request,delete n.requestParams,delete n.neighboringTiles,n.state="unloaded"}prepareTile(n,l,y){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBand(l,y,(b,T)=>{if(b)return n.state="errored",this.fire(new r.d(b)),void this.triggerRepaint(n);T&&(n.setTexture(T,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const l=this.rasterLayers.find(({id:T})=>T===n),y=l&&l.fields,b=y&&y.bands&&y.bands;return b?b[0]:0}getTextureDescriptor(n,l,y){if(!n)return;const b=l.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!b)return;let T=null;l instanceof r.bk?T=l.paint.get("raster-array-band"):l instanceof r.bl&&(T=l.paint.get("raster-particle-array-band"));const M=T||this.getInitialBand(b);if(M!=null)if(n.textureDescriptor){if(!n.updateNeeded(b,M)||y)return Object.assign({},n.textureDescriptor,{texture:n.texture})}else this.prepareTile(n,b,M)}}const Cl={vector:ga,raster:Ns,"raster-dem":class extends Ns{constructor(p,n,l,y){super(p,n,l,y),this.type="raster-dem",this.maxzoom=22,this._options=r.W({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(p,n){const l=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(b,T){b&&(p.state="errored",n(b)),T&&(p.dem=T,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",n(null))}p.request=r.h(this.map._requestManager.transformRequest(l,r.R.Tile),(function(b,T,M,D){if(delete p.request,p.aborted)p.state="unloaded",n(null);else if(b)p.state="errored",n(b);else if(T){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:M,expires:D});const F=ImageBitmap&&T instanceof ImageBitmap&&r.bi(),V=1-(T.width-r.bj(T.width))/2;V<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const X=F?T:r.e.getImageData(T,V),ie={uid:p.uid,coord:p.tileID,source:this.id,scope:this.scope,rawImageData:X,encoding:this.encoding,padding:V};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",ie,y.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){const n=p.canonical,l=Math.pow(2,n.z),y=(n.x-1+l)%l,b=n.x===0?p.wrap-1:p.wrap,T=(n.x+1+l)%l,M=n.x+1===l?p.wrap+1:p.wrap,D={};return D[new r.aL(p.overscaledZ,b,n.z,y,n.y).key]={backfilled:!1},D[new r.aL(p.overscaledZ,M,n.z,T,n.y).key]={backfilled:!1},n.y>0&&(D[new r.aL(p.overscaledZ,b,n.z,y,n.y-1).key]={backfilled:!1},D[new r.aL(p.overscaledZ,p.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},D[new r.aL(p.overscaledZ,M,n.z,T,n.y-1).key]={backfilled:!1}),n.y+1<l&&(D[new r.aL(p.overscaledZ,b,n.z,y,n.y+1).key]={backfilled:!1},D[new r.aL(p.overscaledZ,p.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},D[new r.aL(p.overscaledZ,M,n.z,T,n.y+1).key]={backfilled:!1}),D}},"raster-array":za,geojson:class extends r.E{constructor(p,n,l,y){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(y),this._data=n.data,this._options=r.W({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const b=r.a3/this.tileSize;this.workerOptions=r.W({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*b,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*b,extent:r.a3,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:r.a3,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*b,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}updateData(p){return this._options.dynamic?typeof p!="string"&&(p.type==="Feature"&&(p={type:"FeatureCollection",features:[p]}),p.type!=="FeatureCollection")?this.fire(new r.d(new Error("Data to update should be a feature or a feature collection."))):(this._coalesce&&typeof p!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"?this._data.features.push(...p.features):this._data=p,this._updateWorkerData(!0),this):this.fire(new r.d(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(p,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},n),this}getClusterChildren(p,n){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},n),this}getClusterLeaves(p,n,l,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:n,offset:l},y),this}_updateWorkerData(p=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.f("dataloading",{dataType:"source"})),this._loaded=!1;const n=r.W({append:p},this.workerOptions);n.scope=this.scope;const l=this._data;typeof l=="string"?(n.request=this.map._requestManager.transformRequest(r.e.resolveURL(l),r.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(y,b)=>{if(this._loaded=!0,this._pendingLoad=null,y)this.fire(new r.d(y));else{const T={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&b&&b.resourceTiming&&b.resourceTiming[this.id]&&(T.resourceTiming=b.resourceTiming[this.id]),p&&(this._partialReload=!0),this.fire(new r.f("data",T)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(p),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,n){const l=p.actor?"reloadTile":"loadTile";p.actor=this.actor;const y=this.map.style?this.map.style.getLut(this.scope):null,b=this._partialReload,T={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y?{image:y.image.clone()}:null,scope:this.scope,pixelRatio:r.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:b};p.request=this.actor.send(l,T,(M,D)=>b&&!D?(p.state="loaded",n(null)):(delete p.request,p.destroy(),p.aborted?n(null):M?n(M):(p.loadVectorData(D,this.map.painter,l==="reloadTile"),n(null))),void 0,l==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p,n){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(p){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.W({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.bm{constructor(p,n,l,y){super(p,n,l,y),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const n of p.urls)this.urls.push(this.map._requestManager.transformRequest(n,r.R.Source).url);r.bn(this.urls,(n,l)=>{this._loaded=!0,n?this.fire(new r.d(n)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const n=this.video.seekable;p<n.start(0)||p>n.end(0)?this.fire(new r.d(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,n=p.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(p,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.bm,model:class extends r.E{constructor(p,n,l,y){super(),this.id=p,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){const p=[];for(const n in this._options.models){const l=this._options.models[n],y=r.l(this.map._requestManager.transformRequest(l.uri,r.R.Model).url).then(b=>{if(!b)return;const T=r.c(b),M=new r.M(n,l.position,l.orientation,T);M.computeBoundsAndApplyParent(),this.models.push(M)}).catch(b=>{this.fire(new r.d(new Error(`Could not load model ${n} from ${l.uri}: ${b.message}`)))});p.push(y)}return Promise.allSettled(p).then(()=>{this._loaded=!0,this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(n=>{this.fire(new r.d(new Error(`Could not load models: ${n.message}`)))})}onAdd(p){this.map=p,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(p,n){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(p,n,l,y){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=l,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(y)}onAdd(p){this.map=p,this.load()}load(p){this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map._worldview;this._tileJSONRequest=io(this._options,this.map._requestManager,n,l,(y,b)=>{this._tileJSONRequest=null,this._loaded=!0,y?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new r.d(y))):b&&(r.W(this,b),b.bounds&&(this.tileBounds=new Qs(b.bounds,this.minzoom,this.maxzoom)),r.an(b.tiles,this.map._requestManager._customAccessToken),this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))),p&&p(y)})}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,n){const l=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(l,r.R.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(p.actor&&p.state!=="expired")if(p.state==="loading")p.reloadCallback=n;else{if(p.buckets){const T=Object.values(p.buckets);for(const M of T)M.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",y,b.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",y,b.bind(this),void 0,!0);function b(T,M){return p.aborted?n(null):T&&T.status!==404?n(T):(M&&(M.resourceTiming&&(p.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&p.setExpiryData(M),p.buckets={...p.buckets,...M.buckets},M.featureIndex&&(p.latestFeatureIndex=M.featureIndex)),p.state="loaded",void n(null))}}serialize(){return r.W({},this._options)}},canvas:class extends r.bm{constructor(p,n,l,y){super(p,n,l,y),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(T=>typeof T!="number"))||this.fire(new r.d(new r.V(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.d(new r.V(`sources.${p}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new r.d(new r.V(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new r.d(new r.V(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.d(new r.V(`sources.${p}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.d(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(p){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof r.bo||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends r.E{constructor(p,n,l,y){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=n,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.d(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.d(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Qs(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),r.W(this,r.ah(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.ah(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this.map=p,this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:n,y:l,z:y}=p.canonical;return this._implementation.hasTile({x:n,y:l,z:y})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,n){const{x:l,y,z:b}=p.tileID.canonical,T=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:l,y,z:b},{signal:T.signal})).then((function(M){return delete p.request,p.aborted?(p.state="unloaded",n(null)):M===void 0?(p.state="errored",n(null)):M===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",n(null)):function(D){return D instanceof ImageData||D instanceof HTMLCanvasElement||D instanceof ImageBitmap||D instanceof HTMLImageElement}(M)?(this.loadTileData(p,M),p.state="loaded",void n(null)):(p.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(M=>{M.code!==20&&(p.state="errored",n(M))}),p.request.cancel=()=>T.abort()}loadTileData(p,n){p.setTexture(n,this.map.painter)}unloadTile(p,n){if(p.texture&&p.texture instanceof r.T?(p.destroy(!0),p.texture&&p.texture instanceof r.T&&this.map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){const{x:l,y,z:b}=p.tileID.canonical;this._implementation.unloadTile({x:l,y,z:b})}n&&n()}abortTile(p,n){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){const p=r.al(this.id,this.scope);this.map.style.clearSource(p)}_update(){this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))}}},Ao=function(p,n,l,y){const b=new Cl[n.type](p,n,l,y);if(b.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${b.id}`);return r.bp(["load","abort","unload","serialize","prepare"],b),b};class Va extends r.bv{constructor(n){const l={type:"raster-dem",maxzoom:n.transform.maxZoom},y=new r.bw(r.bx(),null),b=Ao("mock-dem",l,y,n.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,l){n.state="loaded",l(null)}}class xa extends r.bv{constructor(n){const l=Ao("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new r.bw(r.bx(),null),n.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,l,y){if(n.freezeTileCoverage)return;this.transform=n;const b=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((T,M)=>{if(T[M.key]="",!this._tiles[M.key]){const D=new r.by(M,this._source.tileSize*M.overscaleFactor(),n.tileZoom);D.state="loaded",this._tiles[M.key]=D}return T},{});for(const T in this._tiles)T in b||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(n){const l=this.proxyCachedFBO[n];if(l!==void 0){const y=Object.values(l);this.renderCachePool.push(...y),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Kl extends r.aL{constructor(n,l,y){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=l,this.projMatrix=y}}class qs extends r.bq{constructor(n,l){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,b,T]=function(F){const V=new r.bt,X=new r.bu,ie=131;V.reserve(17161),X.reserve(33800);const le=r.a3/128,ue=r.a3+le/2,me=ue+le;for(let _e=-le;_e<me;_e+=le)for(let ye=-le;ye<me;ye+=le){const Pe=ye<0||ye>ue||_e<0||_e>ue?24575:0,De=r.at(Math.round(ye),0,r.a3),ke=r.at(Math.round(_e),0,r.a3);V.emplaceBack(De+Pe,ke)}const ge=(_e,ye)=>{const Pe=ye*ie+_e;X.emplaceBack(Pe+1,Pe,Pe+ie),X.emplaceBack(Pe+ie,Pe+ie+1,Pe+1)};for(let _e=1;_e<129;_e++)for(let ye=1;ye<129;ye++)ge(ye,_e);return[0,129].forEach(_e=>{for(let ye=0;ye<130;ye++)ge(ye,_e),ge(_e,ye)}),[V,X,32768]}(),M=n.context;this.gridBuffer=M.createVertexBuffer(y,r.br.members),this.gridIndexBuffer=M.createIndexBuffer(b),this.gridSegments=r.b.simpleSegment(0,0,y.length,b.length),this.gridNoSkirtSegments=r.b.simpleSegment(0,0,y.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new xa(l.map),this.orthoMatrix=r.ad.create(),r.ad.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.a3,0,r.a3,0,1);const D=M.gl;this._overlapStencilMode=new r.ag({func:D.GEQUAL,mask:255},0,255,D.KEEP,D.KEEP,D.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Va(l.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,l,y){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const b=n.terrain.properties,T=n.terrain.drapeRenderMode===0,M=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.e.now();const D=n.terrain&&n.terrain.scope,F=b.get("source"),V=T?this._mockSourceCache:n.getSourceCache(F,D);if(!V)return void r.w(`Couldn't find terrain source "${F}".`);if(this.sourceCache=V,this._exaggeration=M?this.calculateExaggeration(l):b.get("exaggeration"),!l.projection.requiresDraping&&M&&this._exaggeration===0)return void this._disable();this.enabled=!0;const X=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const ie=this.getScaledDemTileSize();this.sourceCache.update(l,ie,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,X(),this._initializing=!0),X(),l.updateElevation(!0,y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0,this._previousZoom=l.zoom}else this._disable()}calculateExaggeration(n){const l=this._previousCameraAltitude,y=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=y;const b=l!=null?y-l:Number.MAX_VALUE;if(Math.abs(b)<2)return this._exaggeration;const T=n.zoom,M=this._style.terrain;if(!this._previousUpdateTimestamp)return M.getExaggeration(T);let D=T-this._previousZoom;const F=this._previousUpdateTimestamp;let V=T;this._evaluationZoom!=null&&(V=this._evaluationZoom,Math.abs(T-V)>.5&&(D=.5*(T-V+D)),D*b<0&&(V+=D)),this._evaluationZoom=V;const X=M.getExaggeration(V),ie=X===M.getExaggeration(Math.max(0,V-.1));if(ie&&Math.abs(X-this._exaggeration)<.01)return X;let le=Math.min(.1,.00375*(this._updateTimestamp-F));return(ie||X<.1||Math.abs(D)<1e-4)&&(le=Math.min(.2,4*le)),r.a2(this._exaggeration,X,le)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=y._centerAltitude===0&&this.getAtPointOrZero(r.Y.fromLngLat(y.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=l.getIds().map(F=>{const V=l.getTileByID(F).tileID;return V.projMatrix=y.calculateProjMatrix(V.toUnwrapped()),V});(function(F,V){const X=V.transform.pointCoordinate(V.transform.getCameraPoint()),ie=new r.P(X.x,X.y);F.sort((le,ue)=>{if(ue.overscaledZ-le.overscaledZ)return ue.overscaledZ-le.overscaledZ;const me=new r.P(le.canonical.x+(1<<le.canonical.z)*le.wrap,le.canonical.y),ge=new r.P(ue.canonical.x+(1<<ue.canonical.z)*ue.wrap,ue.canonical.y),_e=ie.mult(1<<le.canonical.z);return _e.x-=.5,_e.y-=.5,_e.distSqr(me)-_e.distSqr(ge)})})(b,this.painter);const T=this.proxyToSource||{};this.proxyToSource={},b.forEach(F=>{this.proxyToSource[F.key]={}}),this.terrainTileForTile={};const M=this._style._mergedSourceCaches;for(const F in M){const V=M[F];if(!V.used||(V!==this.sourceCache&&this.resetTileLookupCache(V.id),this._setupProxiedCoordsForOrtho(V,n[F],T),V.usedForTerrain))continue;const X=n[F];V.getSource().reparseOverscaled&&this._assignTerrainTiles(X)}this.proxiedCoords[l.id]=b.map(F=>new Kl(F,F.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1;const D={};this._visibleDemTiles=[];for(const F of this.proxyCoords){const V=this.terrainTileForTile[F.key];if(!V)continue;const X=V.tileID.key;X in D||(this._visibleDemTiles.push(V),D[X]=X)}}_assignTerrainTiles(n){this._initializing||n.forEach(l=>{if(this.terrainTileForTile[l.key])return;const y=this._findTileCoveringTileID(l,this.sourceCache);y&&(this.terrainTileForTile[l.key]=y)})}_prepareDEMTextures(){const n=this.painter.context,l=n.gl;for(const y in this.terrainTileForTile){const b=this.terrainTileForTile[y],T=b.dem;!T||b.demTexture&&!b.needsDEMTextureUpload||(n.activeTexture.set(l.TEXTURE1),ma(this.painter,b,T))}}_prepareDemTileUniforms(n,l,y,b){if(!l||l.demTexture==null)return!1;const T=n.tileID.canonical,M=Math.pow(2,l.tileID.canonical.z-T.z),D=b||"";return y[`u_dem_tl${D}`]=[T.x*M%1,T.y*M%1],y[`u_dem_scale${D}`]=M,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,l=n.gl;if(!this._emptyDepthBufferTexture){const y=new r.i({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new r.T(n,y,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const l=this._visibleDemTiles.reduce((y,b)=>{if(!b.dem)return y;const T=b.dem.tree.minimums[0];return T>0&&n++,y+T},0);return n?l/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,l=n.gl;n.activeTexture.set(l.TEXTURE2);const y=this._getLoadedAreaMinimum(),[b,T]=(()=>{const D=new r.bz({width:1,height:1},new Float32Array([y]));return[l.R32F,D]})();this._emptyDEMTextureDirty=!1;let M=this._emptyDEMTexture;return M?M.update(T,{premultiply:!1}):M=this._emptyDEMTexture=new r.T(n,T,b,{premultiply:!1}),M}setupElevationDraw(n,l,y){const b=this.painter.context,T=b.gl,M={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[2,0],u_exaggeration:0};M.u_exaggeration=this.exaggeration();let D=null,F=null,V=1;if(y&&y.morphing&&this._useVertexMorphing){const me=y.morphing.srcDemTile,ge=y.morphing.dstDemTile;V=y.morphing.phase,me&&ge&&(this._prepareDemTileUniforms(n,me,M,"_prev")&&(F=me),this._prepareDemTileUniforms(n,ge,M)&&(D=ge))}const X=me=>me&&me.demTexture&&this.painter.linearFloatFilteringSupported()?T.LINEAR:T.NEAREST;let ie=null;var le,ue;if(this.enabled?F&&D?(ie=D.demTexture,b.activeTexture.set(T.TEXTURE4),F.demTexture.bind(X(F),T.CLAMP_TO_EDGE),M.u_dem_lerp=V):(D=this.terrainTileForTile[n.tileID.key],ie=this._prepareDemTileUniforms(n,D,M)?D.demTexture:this.emptyDEMTexture):ie=this.emptyDEMTexture,b.activeTexture.set(T.TEXTURE2),ie&&(M.u_dem_size=(le=ie).size[0]===1?1:le.size[0]-2,ie.bind(X(D),T.CLAMP_TO_EDGE)),b.activeTexture.set(T.TEXTURE3),y&&y.useDepthForOcclusion&&this.painter.terrainDepthTexture&&this.painter.terrainDepthFBO?(this.painter.terrainDepthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),M.u_depth_size_inv=[1/this.painter.terrainDepthFBO.width,1/this.painter.terrainDepthFBO.height],M.u_depth_range_unpack=[2/((ue=this.painter.depthRangeFor3D)[1]-ue[0]),-1-2*ue[0]/(ue[1]-ue[0])]):(this.emptyDepthBufferTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),M.u_depth_range_unpack=[2,0]),b.activeTexture.set(T.TEXTURE0),y&&y.useMeterToDem&&D){const me=(1<<D.tileID.canonical.z)*r.ax(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;M.u_meter_to_dem=me}if(y&&y.labelPlaneMatrixInv&&(M.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),l.setTerrainUniformValues(b,M),this.painter.transform.projection.name==="globe"){const me=this.globeUniformValues(this.painter.transform,n.tileID.canonical,y&&y.useDenormalizedUpVectorScale);l.setGlobeUniformValues(b,me)}}globeUniformValues(n,l,y){const b=n.projection;return{u_tile_tl_up:b.upVector(l,0,0),u_tile_tr_up:b.upVector(l,r.a3,0),u_tile_br_up:b.upVector(l,r.a3,r.a3),u_tile_bl_up:b.upVector(l,0,r.a3),u_tile_up_scale:y?r.bs(1):b.upVectorScale(l,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const l=this.painter,y=this.painter.context;n.length!==0&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,T,M,D,F){if(b.transform.projection.name==="globe")(function(V,X,ie,le,ue){const me=V.context,ge=me.gl;let _e,ye;const Pe=V.transform,De=r.ba(V,me,Pe),ke=($e,ft)=>{if(ye===ft)return;const Pt=[Ac[ft],"PROJECTION_GLOBE_VIEW"];De&&Pt.push("CUSTOM_ANTIALIASING");const Dt=V.isTileAffectedByFog($e);_e=V.getOrCreateProgram("globeRaster",{defines:Pt,overrideFog:Dt}),ye=ft},qe=V.colorModeForRenderPass(),Ve=new r.ae(ge.LEQUAL,r.ae.ReadWrite,V.depthRangeFor3D);_s.update(ue);const Ze=r.bb(Pe),xe=[r.aj(Pe.center.lng),r.ak(Pe.center.lat)],Be=V.globeSharedBuffers,Qe=[Pe.width*r.e.devicePixelRatio,Pe.height*r.e.devicePixelRatio],ct=Float32Array.from(Pe.globeMatrix),it={useDenormalizedUpVectorScale:!0};{const $e=V.transform,ft=cs($e.zoom,X.exaggeration(),X.sourceCache._source.tileSize);ye=-1;const Pt=ge.TRIANGLES;for(const Dt of le){const Lt=ie.getTile(Dt),ot=r.ag.disabled,gt=X.prevTerrainTileForTile[Dt.key],Tt=X.terrainTileForTile[Dt.key];Vo(gt,Tt)&&_s.newMorphing(Dt.key,gt,Tt,ue,250),me.activeTexture.set(ge.TEXTURE0),Lt.texture&&Lt.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE);const Kt=_s.getMorphValuesForProxy(Dt.key),Qt=Kt?1:0;Kt&&r.o(it,{morphing:{srcDemTile:Kt.from,dstDemTile:Kt.to,phase:r.b9(Kt.phase)}});const ni=r.bc(Dt.canonical),Jt=r.bd(ni.getCenter().lat),Wt=r.be(Dt.canonical,ni,Jt,$e.worldSize/$e._pixelsPerMercatorPixel),wt=r.bf(r.bg(Dt.canonical)),hi=Yt($e.expandedFarZProjMatrix,ct,Ze,wt,r.a1($e.zoom),xe,$e.frustumCorners.TL,$e.frustumCorners.TR,$e.frustumCorners.BR,$e.frustumCorners.BL,$e.globeCenterInViewSpace,$e.globeRadius,Qe,ft,$e._farZ,Wt);if(ke(Dt,Qt),_e&&(X.setupElevationDraw(Lt,_e,it),V.uploadCommonUniforms(me,_e,Dt.toUnwrapped()),Be)){const[dn,ji,Ji]=Be.getGridBuffers(Jt,ft!==0);_e.draw(V,Pt,Ve,ot,qe,r.af.backCCW,hi,"globe_raster",dn,ji,Ji)}}}if(Be&&(V.renderDefaultNorthPole||V.renderDefaultSouthPole)){const $e=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];De&&$e.push("CUSTOM_ANTIALIASING"),_e=V.getOrCreateProgram("globeRaster",{defines:$e});for(const ft of le){const{x:Pt,y:Dt,z:Lt}=ft.canonical,ot=Dt===0,gt=Dt===(1<<Lt)-1,[Tt,Kt,Qt,ni]=Be.getPoleBuffers(Lt,!1);if(ni&&(ot||gt)){const Jt=ie.getTile(ft);me.activeTexture.set(ge.TEXTURE0),Jt.texture&&Jt.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE);let Wt=r.bh(Lt,Pt,Pe);const wt=r.bf(r.bg(ft.canonical)),hi=(dn,ji)=>dn.draw(V,ge.TRIANGLES,Ve,r.ag.disabled,qe,r.af.disabled,Yt(Pe.expandedFarZProjMatrix,Wt,Wt,wt,0,xe,Pe.frustumCorners.TL,Pe.frustumCorners.TR,Pe.frustumCorners.BR,Pe.frustumCorners.BL,Pe.globeCenterInViewSpace,Pe.globeRadius,Qe,0,Pe._farZ),"globe_pole_raster",ji,Qt,ni);X.setupElevationDraw(Jt,_e,it),V.uploadCommonUniforms(me,_e,ft.toUnwrapped()),ot&&V.renderDefaultNorthPole&&hi(_e,Tt),gt&&V.renderDefaultSouthPole&&(Wt=r.ad.scale(r.ad.create(),Wt,[1,-1,1]),hi(_e,Kt))}}}})(b,T,M,D,F);else{const V=b.context,X=V.gl;let ie,le;const ue=b.shadowRenderer,me=Rr(b,b.longestCutoffRange),ge=qe=>{if(le===qe)return;const Ve=[];Ve.push(Ac[qe]),me.shouldRenderCutoff&&Ve.push("RENDER_CUTOFF"),ie=b.getOrCreateProgram("terrainRaster",{defines:Ve}),le=qe},_e=b.colorModeForRenderPass(),ye=new r.ae(X.LEQUAL,r.ae.ReadWrite,b.depthRangeFor3D);_s.update(F);const Pe=b.transform,De=cs(Pe.zoom,T.exaggeration(),T.sourceCache._source.tileSize);let ke=[0,0,0];if(ue){const qe=b.style.directionalLight,Ve=b.style.ambientLight;qe&&Ve&&(ke=nl(b.style,qe,Ve))}{le=-1;const qe=X.TRIANGLES,[Ve,Ze]=[T.gridIndexBuffer,T.gridSegments];for(const xe of D){const Be=M.getTile(xe),Qe=r.ag.disabled,ct=T.prevTerrainTileForTile[xe.key],it=T.terrainTileForTile[xe.key];Vo(ct,it)&&_s.newMorphing(xe.key,ct,it,F,250),V.activeTexture.set(X.TEXTURE0),Be.texture&&Be.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const $e=_s.getMorphValuesForProxy(xe.key),ft=$e?1:0;let Pt;$e&&(Pt={morphing:{srcDemTile:$e.from,dstDemTile:$e.to,phase:r.b9($e.phase)}});const Dt=Yo(xe.projMatrix,Yl(xe.canonical,Pe.renderWorldCopies)?De/10:De,ke);if(ge(ft),!ie)continue;T.setupElevationDraw(Be,ie,Pt);const Lt=xe.toUnwrapped();ue&&ue.setupShadows(Lt,ie),b.uploadCommonUniforms(V,ie,Lt,null,me),ie.draw(b,qe,ye,Qe,_e,r.af.backCCW,Dt,"terrain_raster",T.gridBuffer,Ve,Ze)}}}}(l,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const l=this.painter,y=this.painter.context,b=this.proxySourceCache,T=this.proxiedCoords[b.id],M=this._drapedRenderBatches.shift(),D=l.style.order,F=[];let V=0;for(const X of T){const ie=b.getTileByID(X.proxyTileKey),le=b.proxyCachedFBO[X.key]?b.proxyCachedFBO[X.key][n]:void 0,ue=le!==void 0?b.renderCache[le]:this.pool[V++],me=le!==void 0;if(ie.texture=ue.tex,me&&!ue.dirty){F.push(ie.tileID);continue}let ge;y.bindFramebuffer.set(ue.fb.framebuffer),this.renderedToTile=!1,ue.dirty&&(y.clear({color:r.C.transparent,stencil:0}),ue.dirty=!1);for(let _e=M.start;_e<=M.end;++_e){const ye=l.style._mergedLayers[D[_e]];if(ye.isHidden(l.transform.zoom))continue;const Pe=l.style.getLayerSourceCache(ye),De=Pe?this.proxyToSource[X.key][Pe.id]:[X];if(!De)continue;const ke=De;y.viewport.set([0,0,ue.fb.width,ue.fb.height]),ge!==(Pe?Pe.id:null)&&(this._setupStencil(ue,De,ye,Pe),ge=Pe?Pe.id:null),l.renderLayer(l,Pe,ye,ke)}if(this._drapedRenderBatches.length===0)for(const _e of this._pendingGroundEffectLayers){const ye=l.style._mergedLayers[D[_e]];if(ye.isHidden(l.transform.zoom))continue;const Pe=l.style.getLayerSourceCache(ye),De=Pe?this.proxyToSource[X.key][Pe.id]:[X];if(!De)continue;const ke=De;y.viewport.set([0,0,ue.fb.width,ue.fb.height]),ge!==(Pe?Pe.id:null)&&(this._setupStencil(ue,De,ye,Pe),ge=Pe?Pe.id:null),l.renderLayer(l,Pe,ye,ke)}this.renderedToTile?(ue.dirty=!0,F.push(ie.tileID)):me||--V,V===5&&(V=0,this.renderToBackBuffer(F))}return this.renderToBackBuffer(F),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,l.width,l.height]),M.end+1}postRender(){}isLayerOrderingCorrect(n){const l=n.order.length;let y=-1,b=l;for(let T=0;T<l;++T)this._style.isLayerDraped(n._mergedLayers[n.order[T]])?y=Math.max(y,T):b=Math.min(b,T);return b>y}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{n=Math.min(n,l.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,l,y){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(T=>T.dem).map(T=>{const M=T.tileID,D=1<<M.overscaledZ,{x:F,y:V}=M.canonical,X=F/D,ie=(F+1)/D,le=V/D,ue=(V+1)/D;return{minx:X,miny:le,maxx:ie,maxy:ue,t:T.dem.tree.raycastRoot(X,le,ie,ue,n,l,y),tile:T}});b.sort((T,M)=>(T.t!==null?T.t:Number.MAX_VALUE)-(M.t!==null?M.t:Number.MAX_VALUE));for(const T of b){if(T.t==null)return null;const M=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,n,l,y);if(M!=null)return M}return null}_createFBO(){const n=this.painter.context,l=n.gl,y=this.drapeBufferSize;n.activeTexture.set(l.TEXTURE0);const b=new r.T(n,{width:y[0],height:y[1],data:null},l.RGBA);b.bind(l.LINEAR,l.CLAMP_TO_EDGE);const T=n.createFramebuffer(y[0],y[1],!0,null);return T.colorAttachment.set(b.texture),T.depthAttachment=new ao(n,T.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:T,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const l=this._style._mergedLayers[n],y=l.isHidden(this.painter.transform.zoom);return l.type==="custom"?!y&&l.shouldRedrape():!y&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const y of this._style.getSources())if(y instanceof ga){n=!0;break}if(!n)return;const l={};for(let y=0;y<this._style.order.length;++y){const b=this._style._mergedLayers[this._style.order[y]],T=this._style.getLayerSourceCache(b);if(T&&!l[T.id]&&!b.isHidden(this.painter.transform.zoom)&&b.type==="line"&&b.widthExpression()instanceof r.Z){l[T.id]=!0;for(const M of this.proxyCoords){const D=this.proxyToSource[M.key][T.id];if(D)for(const F of D)this._clearRenderCacheForTile(T.id,F)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const y in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[y]._source instanceof Ns){n=!0;break}if(!n)return;const l={};for(let y=0;y<this._style.order.length;++y){const b=this._style._mergedLayers[this._style.order[y]],T=this._style.getLayerSourceCache(b);if(!T||l[T.id]||b.isHidden(this.painter.transform.zoom)||b.type!=="raster")continue;const M=b.paint.get("raster-fade-duration");for(const D of this.proxyCoords){const F=this.proxyToSource[D.key][T.id];if(F)for(const V of F){const X=rl(T.getTile(V),T.findLoadedParent(V,0),T,this.painter.transform,M);(X.opacity!==1||X.mix!==0)&&this._clearRenderCacheForTile(T.id,V)}}}}_setupDrapedRenderBatches(){const n=this._style.order,l=n.length;if(l===0)return;const y=[];this._pendingGroundEffectLayers=[];let b,T=0,M=this._style._mergedLayers[n[T]];for(;!this._style.isLayerDraped(M)&&M.isHidden(this.painter.transform.zoom)&&++T<l;)M=this._style._mergedLayers[n[T]];for(;T<l;++T){const D=this._style._mergedLayers[n[T]];D.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(D)?b===void 0&&(b=T):(D.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(T),b!==void 0&&(y.push({start:b,end:T-1}),b=void 0)))}if(b!==void 0&&y.push({start:b,end:T-1}),y.length!==0){const D=y[y.length-1];this._pendingGroundEffectLayers.every(F=>F>D.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=y}_setupRenderCache(n){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const M=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let D=0;D<M.length;++D){const F=Object.values(M[D]);l.renderCachePool.push(...F)}}return}this._clearRasterLayersFromRenderCache();const y=this.proxyCoords,b=this._tilesDirty;for(let M=y.length-1;M>=0;M--){const D=y[M];if(l.getTileByID(D.key),l.proxyCachedFBO[D.key]!==void 0){const F=n[D.key],V=this.proxyToSource[D.key];let X=0;for(const ie in V){const le=V[ie],ue=F[ie];if(!ue||ue.length!==le.length||le.some((me,ge)=>me!==ue[ge]||b[ie]&&b[ie].hasOwnProperty(me.key))){X=-1;break}++X}for(const ie in l.proxyCachedFBO[D.key])l.renderCache[l.proxyCachedFBO[D.key][ie]].dirty=X<0||X!==Object.values(F).length}}const T=[...this._drapedRenderBatches];T.sort((M,D)=>D.end-D.start-(M.end-M.start));for(const M of T)for(const D of y){if(l.proxyCachedFBO[D.key])continue;let F=l.renderCachePool.pop();F===void 0&&l.renderCache.length<50&&(F=l.renderCache.length,l.renderCache.push(this._createFBO())),F!==void 0&&(l.proxyCachedFBO[D.key]={},l.proxyCachedFBO[D.key][M.start]=F,l.renderCache[F].dirty=!0)}this._tilesDirty={}}_setupStencil(n,l,y,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,M=T.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let D;if(y.isTileClipped())D=l.length,this._overlapStencilMode.test={func:M.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);D=1,this._overlapStencilMode.test={func:M.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+D>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=D,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):r.ag.disabled}_renderTileClippingMasks(n,l){const y=this.painter,b=this.painter.context,T=b.gl;y._tileClippingMaskIDs={},b.setColorMode(r.a.disabled),b.setDepthMode(r.ae.disabled);const M=y.getOrCreateProgram("clippingMask");for(const D of n){const F=y._tileClippingMaskIDs[D.key]=--l;M.draw(y,T.TRIANGLES,r.ae.disabled,new r.ag({func:T.ALWAYS,mask:0},F,255,T.KEEP,T.KEEP,T.REPLACE),r.a.disabled,r.af.disabled,bl(D.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(n){const l=this.painter.transform;if(n.x<0||n.x>l.width||n.y<0||n.y>l.height)return null;const y=[n.x,n.y,1,1];r.aA.transformMat4(y,y,l.pixelMatrixInverse),r.aA.scale(y,y,1/y[3]),y[0]/=l.worldSize,y[1]/=l.worldSize;const b=l._camera.position,T=r.ax(1,l.center.lat),M=[b[0],b[1],b[2]/T,0],D=r._.subtract([],y.slice(0,3),M);r._.normalize(D,D);const F=this.raycast(M,D,this._exaggeration);return F!==null&&F?(r._.scaleAndAdd(M,M,D,F),M[3]=M[2],M[2]*=T,M):null}_setupProxiedCoordsForOrtho(n,l,y){if(n.getSource()instanceof r.bm)return this._setupProxiedCoordsForImageSource(n,l,y);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const b=this.proxiedCoords[n.id]=[],T=this.proxyCoords;for(let F=0;F<T.length;F++){const V=T[F],X=this._findTileCoveringTileID(V,n);if(X){const ie=this._createProxiedId(V,X,y[V.key]&&y[V.key][n.id]);b.push(ie),this.proxyToSource[V.key][n.id]=[ie]}}let M=!1;const D=new Set;for(let F=0;F<l.length;F++){const V=n.getTile(l[F]);if(!V||!V.hasData())continue;const X=this._findTileCoveringTileID(V.tileID,this.proxySourceCache);if(X&&X.tileID.canonical.z!==V.tileID.canonical.z){const ie=this.proxyToSource[X.tileID.key][n.id],le=this._createProxiedId(X.tileID,V,y[X.tileID.key]&&y[X.tileID.key][n.id]);ie?ie.splice(ie.length-1,0,le):this.proxyToSource[X.tileID.key][n.id]=[le];const ue=this.proxyToSource[X.tileID.key][n.id];D.has(ue)||D.add(ue),b.push(le),M=!0}}if(this._sourceTilesOverlap[n.id]=M,M&&this._debugParams.sortTilesHiZFirst)for(const F of D)F.sort((V,X)=>X.overscaledZ-V.overscaledZ)}_setupProxiedCoordsForImageSource(n,l,y){if(!n.getSource().loaded())return;const b=this.proxiedCoords[n.id]=[],T=this.proxyCoords,M=n.getSource(),D=M.tileID;if(!D)return;const F=new r.P(D.x,D.y)._div(1<<D.z),V=M.coordinates.map(r.Y.fromLngLat).reduce((ie,le)=>(ie.min.x=Math.min(ie.min.x,le.x-F.x),ie.min.y=Math.min(ie.min.y,le.y-F.y),ie.max.x=Math.max(ie.max.x,le.x-F.x),ie.max.y=Math.max(ie.max.y,le.y-F.y),ie),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),X=(ie,le)=>{const ue=ie.wrap+ie.canonical.x/(1<<ie.canonical.z),me=ie.canonical.y/(1<<ie.canonical.z),ge=r.a3/(1<<ie.canonical.z),_e=le.wrap+le.canonical.x/(1<<le.canonical.z),ye=le.canonical.y/(1<<le.canonical.z);return ue+ge<_e+V.min.x||ue>_e+V.max.x||me+ge<ye+V.min.y||me>ye+V.max.y};for(let ie=0;ie<T.length;ie++){const le=T[ie];for(let ue=0;ue<l.length;ue++){const me=n.getTile(l[ue]);if(!me||!me.hasData()||X(le,me.tileID))continue;const ge=this._createProxiedId(le,me,y[le.key]&&y[le.key][n.id]),_e=this.proxyToSource[le.key][n.id];_e?_e.push(ge):this.proxyToSource[le.key][n.id]=[ge],b.push(ge)}}}_createProxiedId(n,l,y){let b=this.orthoMatrix;if(y){const T=y.find(M=>M.key===l.tileID.key);if(T)return T}if(l.tileID.key!==n.key){const T=n.canonical.z-l.tileID.canonical.z;let M,D,F;b=r.ad.create();const V=l.tileID.wrap-n.wrap<<n.overscaledZ;T>0?(M=r.a3>>T,D=M*((l.tileID.canonical.x<<T)-n.canonical.x+V),F=M*((l.tileID.canonical.y<<T)-n.canonical.y)):(M=r.a3<<-T,D=r.a3*(l.tileID.canonical.x-(n.canonical.x+V<<-T)),F=r.a3*(l.tileID.canonical.y-(n.canonical.y<<-T))),r.ad.ortho(b,0,M,0,M,0,1),r.ad.translate(b,b,[D,F,0])}return new Kl(l.tileID,n.key,b)}_findTileCoveringTileID(n,l){let y=l.getTile(n);if(y&&y.hasData())return y;const b=this._findCoveringTileCache[l.id],T=b[n.key];if(y=T?l.getTileByID(T):null,y&&y.hasData()||T===null)return y;let M=y?y.tileID:n,D=M.overscaledZ;const F=l.getSource().minzoom,V=[];if(!T){const ie=l.getSource().maxzoom;if(n.canonical.z>=ie){const le=n.canonical.z-ie;l.getSource().reparseOverscaled?(D=Math.max(n.canonical.z+2,l.transform.tileZoom),M=new r.aL(D,n.wrap,ie,n.canonical.x>>le,n.canonical.y>>le)):le!==0&&(D=ie,M=new r.aL(D,n.wrap,ie,n.canonical.x>>le,n.canonical.y>>le))}M.key!==n.key&&(V.push(M.key),y=l.getTile(M))}const X=ie=>{V.forEach(le=>{b[le]=ie}),V.length=0};for(D-=1;D>=F&&(!y||!y.hasData());D--){y&&X(y.tileID.key);const ie=M.calculateScaledKey(D);if(y=l.getTileByID(ie),y&&y.hasData())break;const le=b[ie];if(le===null)break;le===void 0?V.push(ie):y=l.getTileByID(le)}return X(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,l){let y=this._tilesDirty[n];y||(y=this._tilesDirty[n]={}),y[l.key]=!0}}function tu(p,n,l){const y=function(D,F,V){const X=r._.dot(F,D),ie=r._.dot(V,[.2126,.7152,.0722]),le=(me,ge,_e)=>(1-_e)*me+_e*ge,ue=le(1-.3*Math.min(ie,1),1,Math.min(X+1,1));return le(.92,1,Math.asin(r.at(F[2],-1,1))/Math.PI+.5)*ue}(p,[0,0,1],n),b=[0,0,0];r._.scale(b,l.slice(0,3),y);const T=[0,0,0];r._.scale(T,n.slice(0,3),p[2]);const M=[0,0,0];return r._.add(M,b,T),r.b8(M)}const Ko=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Ua=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class ns{static cacheKey(n,l,y,b){let T=`${l}${b?b.cacheKey:""}`;for(const M of y)n.usedDefines.includes(M)&&(T+=`/${M}`);return T}constructor(n,l,y,b,T,M){const D=n.gl;this.program=D.createProgram(),this.configuration=b,this.name=l,this.fixedDefines=[...M];const F=b?b.getBinderAttributes():[],V=(y.staticAttributes||[]).concat(F);let X=b?b.defines():[];X=X.concat(M.map(_e=>`#define ${_e}`));const ie=`#version 300 es
`;let le=ie+X.concat("precision mediump float;",Bs,pa.fragmentSource).join(`
`);for(const _e of y.fragmentIncludes)le+=`
${Vs[_e]}`;le+=`
${y.fragmentSource}`;let ue=ie+X.concat("precision highp float;",Bs,pa.vertexSource).join(`
`);for(const _e of y.vertexIncludes)ue+=`
${Vs[_e]}`;ue+=`
${y.vertexSource}`;const me=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(me,le),D.compileShader(me),D.attachShader(this.program,me);const ge=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())this.failedToCreate=!0;else{D.shaderSource(ge,ue),D.compileShader(ge),D.attachShader(this.program,ge),this.attributes={},this.numAttributes=V.length;for(let _e=0;_e<this.numAttributes;_e++)if(V[_e]){const ye=V[_e].startsWith("a_")?V[_e]:`a_${V[_e]}`;D.bindAttribLocation(this.program,_e,ye),this.attributes[ye]=_e}D.linkProgram(this.program),D.deleteShader(ge),D.deleteShader(me),this.fixedUniforms=T(n),this.binderUniforms=b?b.getUniforms(n):[],M.includes("TERRAIN")&&(this.terrainUniforms=(_e=>({u_dem:new r.a7(_e),u_dem_prev:new r.a7(_e),u_dem_tl:new r.a8(_e),u_dem_scale:new r.aa(_e),u_dem_tl_prev:new r.a8(_e),u_dem_scale_prev:new r.aa(_e),u_dem_size:new r.aa(_e),u_dem_lerp:new r.aa(_e),u_exaggeration:new r.aa(_e),u_depth:new r.a7(_e),u_depth_size_inv:new r.a8(_e),u_depth_range_unpack:new r.a8(_e),u_meter_to_dem:new r.aa(_e),u_label_plane_matrix_inv:new r.a6(_e)}))(n)),M.includes("GLOBE")&&(this.globeUniforms=(_e=>({u_tile_tl_up:new r.aq(_e),u_tile_tr_up:new r.aq(_e),u_tile_br_up:new r.aq(_e),u_tile_bl_up:new r.aq(_e),u_tile_up_scale:new r.aa(_e)}))(n)),M.includes("FOG")&&(this.fogUniforms=(_e=>({u_fog_matrix:new r.a6(_e),u_fog_range:new r.a8(_e),u_fog_color:new r.as(_e),u_fog_horizon_blend:new r.aa(_e),u_fog_vertical_limit:new r.a8(_e),u_fog_temporal_offset:new r.aa(_e),u_frustum_tl:new r.aq(_e),u_frustum_tr:new r.aq(_e),u_frustum_br:new r.aq(_e),u_frustum_bl:new r.aq(_e),u_globe_pos:new r.aq(_e),u_globe_radius:new r.aa(_e),u_globe_transition:new r.aa(_e),u_is_globe:new r.a7(_e),u_viewport:new r.a8(_e)}))(n)),M.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(_e=>({u_cutoff_params:new r.as(_e)}))(n)),M.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(_e=>({u_lighting_ambient_color:new r.aq(_e),u_lighting_directional_dir:new r.aq(_e),u_lighting_directional_color:new r.aq(_e),u_ground_radiance:new r.aq(_e)}))(n)),M.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(_e=>({u_light_matrix_0:new r.a6(_e),u_light_matrix_1:new r.a6(_e),u_fade_range:new r.a8(_e),u_shadow_normal_offset:new r.aq(_e),u_shadow_intensity:new r.aa(_e),u_shadow_texel_size:new r.aa(_e),u_shadow_map_resolution:new r.aa(_e),u_shadow_direction:new r.aq(_e),u_shadow_bias:new r.aq(_e),u_shadowmap_0:new r.a7(_e),u_shadowmap_1:new r.a7(_e)}))(n))}}setTerrainUniformValues(n,l){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const b in l)y[b]&&y[b].set(this.program,b,l[b])}}setGlobeUniformValues(n,l){if(!this.globeUniforms)return;const y=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const b in l)y[b]&&y[b].set(this.program,b,l[b])}}setFogUniformValues(n,l){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const b in l)y[b].set(this.program,b,l[b])}}setCutoffUniformValues(n,l){if(!this.cutoffUniforms)return;const y=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const b in l)y[b].set(this.program,b,l[b])}}setLightsUniformValues(n,l){if(!this.lightsUniforms)return;const y=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const b in l)y[b].set(this.program,b,l[b])}}setShadowUniformValues(n,l){if(this.failedToCreate||!this.shadowUniforms)return;const y=this.shadowUniforms;n.program.set(this.program);for(const b in l)y[b].set(this.program,b,l[b])}_drawDebugWireframe(n,l,y,b,T,M,D,F,V,X){const ie=n.options.wireframe;if(ie.terrain===!1&&ie.layers2D===!1&&ie.layers3D===!1)return;const le=n.context;if(!(()=>!(!ie.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!ie.layers2D||n._terrain&&n._terrain.renderingToTexture||!Ko.includes(this.name))||!(!ie.layers3D||!Ua.includes(this.name)))())return;const ue=le.gl,me=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,T,le);if(!me)return;const ge=[...this.fixedDefines];ge.push("DEBUG_WIREFRAME");const _e=n.getOrCreateProgram(this.name,{config:this.configuration,defines:ge});le.program.set(_e.program);const ye=(ke,qe,Ve)=>{if(qe[ke]&&Ve[ke])for(const Ze in qe[ke])Ve[ke][Ze]&&Ve[ke][Ze].set(Ve.program,Ze,qe[ke][Ze].current)};V&&V.setUniforms(_e.program,le,_e.binderUniforms,D,{zoom:F}),ye("fixedUniforms",this,_e),ye("terrainUniforms",this,_e),ye("globeUniforms",this,_e),ye("fogUniforms",this,_e),ye("lightsUniforms",this,_e),ye("shadowUniforms",this,_e),me.bind(),le.setColorMode(new r.a([ue.ONE,ue.ONE_MINUS_SRC_ALPHA,ue.ZERO,ue.ONE],r.C.transparent,[!0,!0,!0,!1])),le.setDepthMode(new r.ae(l.func===ue.LESS?ue.LEQUAL:l.func,r.ae.ReadOnly,l.range)),le.setStencilMode(r.ag.disabled);const Pe=3*M.primitiveLength*2,De=3*M.primitiveOffset*2*2;X&&X>1?ue.drawElementsInstanced(ue.LINES,Pe,ue.UNSIGNED_SHORT,De,X):ue.drawElements(ue.LINES,Pe,ue.UNSIGNED_SHORT,De),T.bind(),le.program.set(this.program),le.setDepthMode(l),le.setStencilMode(y),le.setColorMode(b)}draw(n,l,y,b,T,M,D,F,V,X,ie,le,ue,me,ge,_e){const ye=n.context,Pe=ye.gl;if(this.failedToCreate)return;ye.program.set(this.program),ye.setDepthMode(y),ye.setStencilMode(b),ye.setColorMode(T),ye.setCullFace(M);for(const qe of Object.keys(this.fixedUniforms))this.fixedUniforms[qe].set(this.program,qe,D[qe]);me&&me.setUniforms(this.program,ye,this.binderUniforms,le,{zoom:ue});const De={[Pe.POINTS]:1,[Pe.LINES]:2,[Pe.TRIANGLES]:3,[Pe.LINE_STRIP]:1}[l],ke=_e&&_e>0?1:void 0;for(const qe of ie.get()){const Ve=qe.vaos||(qe.vaos={});(Ve[F]||(Ve[F]=new Zo)).bind(ye,this,V,me?me.getPaintVertexBuffers():[],X,qe.vertexOffset,ge||[],ke),_e&&_e>1?Pe.drawElementsInstanced(l,qe.primitiveLength*De,Pe.UNSIGNED_SHORT,qe.primitiveOffset*De*2,_e):X?Pe.drawElements(l,qe.primitiveLength*De,Pe.UNSIGNED_SHORT,qe.primitiveOffset*De*2):Pe.drawArrays(l,qe.vertexOffset,qe.vertexLength),l===Pe.TRIANGLES&&X&&this._drawDebugWireframe(n,y,b,T,X,qe,le,ue,me,_e)}}}function ol(p,n){const l=Math.pow(2,n.tileID.overscaledZ),y=n.tileSize*Math.pow(2,p.transform.tileZoom)/l,b=y*(n.tileID.canonical.x+n.tileID.wrap*l),T=y*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.bB(n,1,p.transform.tileZoom),u_pixel_coord_upper:[b>>16,T>>16],u_pixel_coord_lower:[65535&b,65535&T]}}const us=r.ad.create(),sl=(p,n,l,y,b,T,M,D,F,V,X,ie,le,ue,me,ge)=>{const _e=n.style.light,ye=_e.properties.get("position"),Pe=[ye.x,ye.y,ye.z],De=r.bC.create();_e.properties.get("anchor")==="viewport"&&(r.bC.fromRotation(De,-n.transform.angle),r._.transformMat3(Pe,Pe,De));const ke=_e.properties.get("color"),qe=n.transform,Ve={u_matrix:p,u_lightpos:Pe,u_lightintensity:_e.properties.get("intensity"),u_lightcolor:[ke.r,ke.g,ke.b],u_vertical_gradient:+l,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:us,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:b,u_edge_radius:T,u_flood_light_color:ie,u_vertical_scale:le,u_flood_light_intensity:ue,u_ground_shadow_factor:me,u_emissive_strength:ge};return qe.projection.name==="globe"&&(Ve.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],Ve.u_zoom_transition=F,Ve.u_inv_rot_matrix=X,Ve.u_merc_center=V,Ve.u_up_dir=qe.projection.upVector(new r.aO(0,0,0),V[0]*r.a3,V[1]*r.a3),Ve.u_height_lift=D),Ve},wa=(p,n,l)=>({u_matrix:p,u_edge_radius:n,u_vertical_scale:l}),ba=(p,n,l,y,b,T,M,D,F,V,X,ie,le,ue)=>{const me=sl(p,n,l,y,b,T,M,F,V,X,ie,le,ue,1,[0,0,0],0),ge={u_height_factor:-Math.pow(2,M.overscaledZ)/D.tileSize/8};return r.W(me,ol(n,D),ge)},Ca=(p,n)=>({u_matrix:p,u_emissive_strength:n}),Ts=(p,n,l,y)=>r.W(Ca(p,n),ol(l,y)),Ic=(p,n,l)=>({u_matrix:p,u_world:l,u_emissive_strength:n}),El=(p,n,l,y,b)=>r.W(Ts(p,n,l,y),{u_world:b}),ea=(p,n,l,y)=>{const b=r.a3/l.tileSize;return{u_matrix:p,u_camera_to_center_distance:n.getCameraToCenterDistance(y),u_extrude_scale:[n.pixelsToGLUnits[0]/b,n.pixelsToGLUnits[1]/b]}},Zn=(p,n,l=1)=>({u_matrix:p,u_color:n.toRenderColor(null),u_overlay:0,u_overlay_scale:l}),ja=r.ad.create(),Te=(p,n,l,y,b,T,M)=>{const D=p.transform,F=D.projection.name==="globe",V=F?r.bD(D.zoom,n.canonical)*D._pixelsPerMercatorPixel:r.bB(l,1,T),X={u_matrix:n.projMatrix,u_extrude_scale:V,u_intensity:M,u_inv_rot_matrix:ja,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(F){X.u_inv_rot_matrix=y,X.u_merc_center=b,X.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],X.u_zoom_transition=r.a1(D.zoom);const ie=b[0]*r.a3,le=b[1]*r.a3;X.u_up_dir=D.projection.upVector(new r.aO(0,0,0),ie,le)}return X};function c(p,[n,l,y,b],[T,M]){if(T===M)return[0,0,0,0];const D=255*(p-1)/(p*(M-T));return[n*D,l*D,y*D,b*D]}function m(p,n,[l,y]){return l===y?0:.5/p+(n-l)*(p-1)/(p*(y-l))}const v=(p,n,l,y,b,T,M,D,F,V,X,ie,le,ue,me,ge,_e,ye,Pe,De,ke)=>({u_matrix:p,u_normalize_matrix:n,u_globe_matrix:l,u_merc_matrix:y,u_grid_matrix:b,u_tl_parent:T,u_scale_parent:V,u_fade_t:X.mix,u_opacity:X.opacity*ie.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:ie.paint.get("raster-brightness-min"),u_brightness_high:ie.paint.get("raster-brightness-max"),u_saturation_factor:r.bE(ie.paint.get("raster-saturation")),u_contrast_factor:r.bF(ie.paint.get("raster-contrast")),u_spin_weights:C(ie.paint.get("raster-hue-rotate")),u_perspective_transform:le,u_raster_elevation:ue,u_zoom_transition:M,u_merc_center:D,u_cutoff_params:F,u_colorization_mix:c(r.bG,ge,ye),u_colorization_offset:m(r.bG,_e,ye),u_color_ramp:me,u_texture_offset:[De/(Pe+2*De),Pe/(Pe+2*De)],u_texture_res:[Pe+2*De,Pe+2*De],u_emissive_strength:ke});function C(p){p*=Math.PI/180;const n=Math.sin(p),l=Math.cos(p);return[(2*l+1)/3,(-Math.sqrt(3)*n-l+1)/3,(Math.sqrt(3)*n-l+1)/3]}const I=.05,L=(p,n,l,y,b,T,M,D,F,V,X,ie)=>({u_matrix:p,u_normalize_matrix:n,u_globe_matrix:l,u_merc_matrix:y,u_grid_matrix:b,u_tl_parent:T,u_scale_parent:V,u_fade_t:X.mix,u_opacity:X.opacity,u_image0:0,u_image1:1,u_raster_elevation:ie,u_zoom_transition:M,u_merc_center:D,u_cutoff_params:F}),k=(p,n,l,y,b,T,M,D,F,V)=>({u_particle_texture:p,u_particle_texture_side_len:n,u_tile_offset:l,u_velocity:y,u_color_ramp:T,u_velocity_res:b,u_max_speed:M,u_uv_offset:D,u_data_scale:[255*F[0],255*F[1]],u_data_offset:V,u_particle_pos_scale:1.1,u_particle_pos_offset:[I,I]}),j=(p,n,l,y,b,T,M,D,F,V)=>({u_particle_texture:p,u_particle_texture_side_len:n,u_velocity:l,u_velocity_res:y,u_max_speed:b,u_speed_factor:T,u_reset_rate:M,u_rand_seed:Math.random(),u_uv_offset:D,u_data_scale:[255*F[0],255*F[1]],u_data_offset:V,u_particle_pos_scale:1.1,u_particle_pos_offset:[I,I]}),J=r.ad.create(),pe=(p,n,l,y,b,T,M,D,F,V,X,ie,le,ue,me,ge,_e,ye)=>{const Pe=b.transform,De={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:Pe.getCameraToCenterDistance(ge),u_rotate_symbol:+l,u_aspect_ratio:Pe.width/Pe.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:M,u_coord_matrix:D,u_is_text:+F,u_pitch_with_map:+y,u_texsize:V,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:J,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:J,u_up_vector:[0,-1,0],u_color_adj_mat:_e,u_icon_transition:ye||0};return ge.name==="globe"&&(De.u_tile_id=[X.canonical.x,X.canonical.y,1<<X.canonical.z],De.u_zoom_transition=ie,De.u_inv_rot_matrix=ue,De.u_merc_center=le,De.u_camera_forward=Pe._camera.forward(),De.u_ecef_origin=r.bH(Pe.globeMatrix,X.toUnwrapped()),De.u_tile_matrix=Float32Array.from(Pe.globeMatrix),De.u_up_vector=me),De},Ie=(p,n,l,y,b,T,M,D,F,V,X,ie,le,ue,me,ge,_e)=>r.W(pe(p,n,l,y,b,T,M,D,F,V,ie,le,ue,me,ge,_e),{u_gamma_scale:y?b.transform.getCameraToCenterDistance(_e)*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:r.e.devicePixelRatio,u_is_halo:+X,undefined:void 0}),Ne=(p,n,l,y,b,T,M,D,F,V,X,ie,le,ue,me,ge)=>r.W(Ie(p,n,l,y,b,T,M,D,!0,F,!0,X,ie,le,ue,me,ge),{u_texsize_icon:V,u_texture_icon:1}),Ye=(p,n,l,y)=>({u_matrix:p,u_emissive_strength:n,u_opacity:l,u_color:y}),at=(p,n,l,y,b,T,M,D)=>r.W(function(F,V,X,ie,le){const{width:ue,height:me}=ie.imageManager.getPixelSize(V),ge=Math.pow(2,le.tileID.overscaledZ),_e=le.tileSize*Math.pow(2,ie.transform.tileZoom)/ge,ye=_e*(le.tileID.canonical.x+le.tileID.wrap*ge),Pe=_e*le.tileID.canonical.y;return{u_image:0,u_pattern_tl:X.tl,u_pattern_br:X.br,u_texsize:[ue,me],u_pattern_size:X.displaySize,u_tile_units_to_pixels:1/r.bB(le,1,ie.transform.tileZoom),u_pixel_coord_upper:[ye>>16,Pe>>16],u_pixel_coord_lower:[65535&ye,65535&Pe]}}(0,T,M,y,D),{u_matrix:p,u_emissive_strength:n,u_opacity:l}),ut=new Float32Array(r.ad.identity([])),Et=(p,n,l,y,b,T,M,D,F,V,X,ie,le,ue=[0,0,0],me)=>{const ge=b.style.light,_e=ge.properties.get("position"),ye=[-_e.x,-_e.y,_e.z],Pe=r.bC.create();ge.properties.get("anchor")==="viewport"&&(r.bC.fromRotation(Pe,-b.transform.angle),r._.transformMat3(ye,ye,Pe));const De=X.alphaMode==="MASK",ke=ge.properties.get("color").toRenderColor(null),qe=le.paint.get("model-ambient-occlusion-intensity"),Ve=le.paint.get("model-color").constantOr(r.C.white).toRenderColor(null),Ze=le.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:p,u_lighting_matrix:n,u_normal_matrix:l,u_node_matrix:y||ut,u_lightpos:ye,u_lightintensity:ge.properties.get("intensity"),u_lightcolor:[ke.r,ke.g,ke.b],u_camera_pos:ue,u_opacity:T,u_baseTextureIsAlpha:0,u_alphaMask:+De,u_alphaCutoff:X.alphaCutoff,u_baseColorFactor:[M.r,M.g,M.b,M.a],u_emissiveFactor:[D[0],D[1],D[2],1],u_metallicFactor:F,u_roughnessFactor:V,u_baseColorTexture:Ir.BaseColor,u_metallicRoughnessTexture:Ir.MetallicRoughness,u_normalTexture:Ir.Normal,u_occlusionTexture:Ir.Occlusion,u_emissionTexture:Ir.Emission,u_lutTexture:Ir.LUT,u_color_mix:[Ve.r,Ve.g,Ve.b,Ze],u_aoIntensity:qe,u_emissive_strength:ie,u_occlusionTextureTransform:me||[0,0,0,0]}},Rt=(p,n=ut,l=ut)=>({u_matrix:p,u_instance:n,u_node_matrix:l}),mi=(p,n,l,y,b)=>({u_matrix:Float32Array.from(p),u_anchorPos:n,u_screenSizePx:l,u_occluderSizePx:y,u_color:b}),gi={fillExtrusion:p=>({u_matrix:new r.a6(p),u_lightpos:new r.aq(p),u_lightintensity:new r.aa(p),u_lightcolor:new r.aq(p),u_vertical_gradient:new r.aa(p),u_opacity:new r.aa(p),u_edge_radius:new r.aa(p),u_ao:new r.a8(p),u_tile_id:new r.aq(p),u_zoom_transition:new r.aa(p),u_inv_rot_matrix:new r.a6(p),u_merc_center:new r.a8(p),u_up_dir:new r.aq(p),u_height_lift:new r.aa(p),u_flood_light_color:new r.aq(p),u_vertical_scale:new r.aa(p),u_flood_light_intensity:new r.aa(p),u_ground_shadow_factor:new r.aq(p),u_emissive_strength:new r.aa(p)}),fillExtrusionDepth:p=>({u_matrix:new r.a6(p),u_edge_radius:new r.aa(p),u_vertical_scale:new r.aa(p)}),fillExtrusionPattern:p=>({u_matrix:new r.a6(p),u_lightpos:new r.aq(p),u_lightintensity:new r.aa(p),u_lightcolor:new r.aq(p),u_vertical_gradient:new r.aa(p),u_height_factor:new r.aa(p),u_edge_radius:new r.aa(p),u_ao:new r.a8(p),u_tile_id:new r.aq(p),u_zoom_transition:new r.aa(p),u_inv_rot_matrix:new r.a6(p),u_merc_center:new r.a8(p),u_up_dir:new r.aq(p),u_height_lift:new r.aa(p),u_image:new r.a7(p),u_texsize:new r.a8(p),u_pixel_coord_upper:new r.a8(p),u_pixel_coord_lower:new r.a8(p),u_tile_units_to_pixels:new r.aa(p),u_opacity:new r.aa(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new r.a6(p),u_opacity:new r.aa(p),u_ao_pass:new r.aa(p),u_meter_to_tile:new r.aa(p),u_ao:new r.a8(p),u_flood_light_intensity:new r.aa(p),u_flood_light_color:new r.aq(p),u_attenuation:new r.aa(p),u_edge_radius:new r.aa(p),u_fb:new r.a7(p),u_fb_size:new r.aa(p)}),fill:p=>({u_matrix:new r.a6(p),u_emissive_strength:new r.aa(p)}),fillPattern:p=>({u_matrix:new r.a6(p),u_emissive_strength:new r.aa(p),u_image:new r.a7(p),u_texsize:new r.a8(p),u_pixel_coord_upper:new r.a8(p),u_pixel_coord_lower:new r.a8(p),u_tile_units_to_pixels:new r.aa(p)}),fillOutline:p=>({u_matrix:new r.a6(p),u_emissive_strength:new r.aa(p),u_world:new r.a8(p)}),fillOutlinePattern:p=>({u_matrix:new r.a6(p),u_emissive_strength:new r.aa(p),u_world:new r.a8(p),u_image:new r.a7(p),u_texsize:new r.a8(p),u_pixel_coord_upper:new r.a8(p),u_pixel_coord_lower:new r.a8(p),u_tile_units_to_pixels:new r.aa(p)}),circle:r.bI,collisionBox:p=>({u_matrix:new r.a6(p),u_camera_to_center_distance:new r.aa(p),u_extrude_scale:new r.a8(p)}),collisionCircle:p=>({u_matrix:new r.a6(p),u_inv_matrix:new r.a6(p),u_camera_to_center_distance:new r.aa(p),u_viewport_size:new r.a8(p)}),debug:p=>({u_color:new r.a9(p),u_matrix:new r.a6(p),u_overlay:new r.a7(p),u_overlay_scale:new r.aa(p)}),clippingMask:p=>({u_matrix:new r.a6(p)}),heatmap:p=>({u_extrude_scale:new r.aa(p),u_intensity:new r.aa(p),u_matrix:new r.a6(p),u_inv_rot_matrix:new r.a6(p),u_merc_center:new r.a8(p),u_tile_id:new r.aq(p),u_zoom_transition:new r.aa(p),u_up_dir:new r.aq(p)}),heatmapTexture:p=>({u_image:new r.a7(p),u_color_ramp:new r.a7(p),u_opacity:new r.aa(p)}),hillshade:p=>({u_matrix:new r.a6(p),u_image:new r.a7(p),u_latrange:new r.a8(p),u_light:new r.a8(p),u_shadow:new r.a9(p),u_highlight:new r.a9(p),u_emissive_strength:new r.aa(p),u_accent:new r.a9(p)}),hillshadePrepare:p=>({u_matrix:new r.a6(p),u_image:new r.a7(p),u_dimension:new r.a8(p),u_zoom:new r.aa(p)}),line:r.bJ,linePattern:r.bK,raster:p=>({u_matrix:new r.a6(p),u_normalize_matrix:new r.a6(p),u_globe_matrix:new r.a6(p),u_merc_matrix:new r.a6(p),u_grid_matrix:new r.ar(p),u_tl_parent:new r.a8(p),u_scale_parent:new r.aa(p),u_fade_t:new r.aa(p),u_opacity:new r.aa(p),u_image0:new r.a7(p),u_image1:new r.a7(p),u_brightness_low:new r.aa(p),u_brightness_high:new r.aa(p),u_saturation_factor:new r.aa(p),u_contrast_factor:new r.aa(p),u_spin_weights:new r.aq(p),u_perspective_transform:new r.a8(p),u_raster_elevation:new r.aa(p),u_zoom_transition:new r.aa(p),u_merc_center:new r.a8(p),u_cutoff_params:new r.as(p),u_colorization_mix:new r.as(p),u_colorization_offset:new r.aa(p),u_color_ramp:new r.a7(p),u_texture_offset:new r.a8(p),u_texture_res:new r.a8(p),u_emissive_strength:new r.aa(p)}),rasterParticle:p=>({u_matrix:new r.a6(p),u_normalize_matrix:new r.a6(p),u_globe_matrix:new r.a6(p),u_merc_matrix:new r.a6(p),u_grid_matrix:new r.ar(p),u_tl_parent:new r.a8(p),u_scale_parent:new r.aa(p),u_fade_t:new r.aa(p),u_opacity:new r.aa(p),u_image0:new r.a7(p),u_image1:new r.a7(p),u_raster_elevation:new r.aa(p),u_zoom_transition:new r.aa(p),u_merc_center:new r.a8(p),u_cutoff_params:new r.as(p)}),rasterParticleTexture:p=>({u_texture:new r.a7(p),u_opacity:new r.aa(p)}),rasterParticleDraw:p=>({u_particle_texture:new r.a7(p),u_particle_texture_side_len:new r.aa(p),u_tile_offset:new r.a8(p),u_velocity:new r.a7(p),u_color_ramp:new r.a7(p),u_velocity_res:new r.a8(p),u_max_speed:new r.aa(p),u_uv_offset:new r.a8(p),u_data_scale:new r.a8(p),u_data_offset:new r.aa(p),u_particle_pos_scale:new r.aa(p),u_particle_pos_offset:new r.a8(p)}),rasterParticleUpdate:p=>({u_particle_texture:new r.a7(p),u_particle_texture_side_len:new r.aa(p),u_velocity:new r.a7(p),u_velocity_res:new r.a8(p),u_max_speed:new r.aa(p),u_speed_factor:new r.aa(p),u_reset_rate:new r.aa(p),u_rand_seed:new r.aa(p),u_uv_offset:new r.a8(p),u_data_scale:new r.a8(p),u_data_offset:new r.aa(p),u_particle_pos_scale:new r.aa(p),u_particle_pos_offset:new r.a8(p)}),symbolIcon:p=>({u_is_size_zoom_constant:new r.a7(p),u_is_size_feature_constant:new r.a7(p),u_size_t:new r.aa(p),u_size:new r.aa(p),u_camera_to_center_distance:new r.aa(p),u_rotate_symbol:new r.a7(p),u_aspect_ratio:new r.aa(p),u_fade_change:new r.aa(p),u_matrix:new r.a6(p),u_label_plane_matrix:new r.a6(p),u_coord_matrix:new r.a6(p),u_is_text:new r.a7(p),u_pitch_with_map:new r.a7(p),u_texsize:new r.a8(p),u_tile_id:new r.aq(p),u_zoom_transition:new r.aa(p),u_inv_rot_matrix:new r.a6(p),u_merc_center:new r.a8(p),u_camera_forward:new r.aq(p),u_tile_matrix:new r.a6(p),u_up_vector:new r.aq(p),u_ecef_origin:new r.aq(p),u_texture:new r.a7(p),u_icon_transition:new r.aa(p),u_color_adj_mat:new r.a6(p)}),symbolSDF:p=>({u_is_size_zoom_constant:new r.a7(p),u_is_size_feature_constant:new r.a7(p),u_size_t:new r.aa(p),u_size:new r.aa(p),u_camera_to_center_distance:new r.aa(p),u_rotate_symbol:new r.a7(p),u_aspect_ratio:new r.aa(p),u_fade_change:new r.aa(p),u_matrix:new r.a6(p),u_label_plane_matrix:new r.a6(p),u_coord_matrix:new r.a6(p),u_is_text:new r.a7(p),u_pitch_with_map:new r.a7(p),u_texsize:new r.a8(p),u_texture:new r.a7(p),u_gamma_scale:new r.aa(p),u_device_pixel_ratio:new r.aa(p),u_tile_id:new r.aq(p),u_zoom_transition:new r.aa(p),u_inv_rot_matrix:new r.a6(p),u_merc_center:new r.a8(p),u_camera_forward:new r.aq(p),u_tile_matrix:new r.a6(p),u_up_vector:new r.aq(p),u_ecef_origin:new r.aq(p),u_is_halo:new r.a7(p)}),symbolTextAndIcon:p=>({u_is_size_zoom_constant:new r.a7(p),u_is_size_feature_constant:new r.a7(p),u_size_t:new r.aa(p),u_size:new r.aa(p),u_camera_to_center_distance:new r.aa(p),u_rotate_symbol:new r.a7(p),u_aspect_ratio:new r.aa(p),u_fade_change:new r.aa(p),u_matrix:new r.a6(p),u_label_plane_matrix:new r.a6(p),u_coord_matrix:new r.a6(p),u_is_text:new r.a7(p),u_pitch_with_map:new r.a7(p),u_texsize:new r.a8(p),u_texsize_icon:new r.a8(p),u_texture:new r.a7(p),u_texture_icon:new r.a7(p),u_gamma_scale:new r.aa(p),u_device_pixel_ratio:new r.aa(p),u_is_halo:new r.a7(p)}),background:p=>({u_matrix:new r.a6(p),u_emissive_strength:new r.aa(p),u_opacity:new r.aa(p),u_color:new r.a9(p)}),backgroundPattern:p=>({u_matrix:new r.a6(p),u_emissive_strength:new r.aa(p),u_opacity:new r.aa(p),u_image:new r.a7(p),u_pattern_tl:new r.a8(p),u_pattern_br:new r.a8(p),u_texsize:new r.a8(p),u_pattern_size:new r.a8(p),u_pixel_coord_upper:new r.a8(p),u_pixel_coord_lower:new r.a8(p),u_tile_units_to_pixels:new r.aa(p)}),terrainRaster:p=>({u_matrix:new r.a6(p),u_image0:new r.a7(p),u_skirt_height:new r.aa(p),u_ground_shadow_factor:new r.aq(p)}),skybox:p=>({u_matrix:new r.a6(p),u_sun_direction:new r.aq(p),u_cubemap:new r.a7(p),u_opacity:new r.aa(p),u_temporal_offset:new r.aa(p)}),skyboxGradient:p=>({u_matrix:new r.a6(p),u_color_ramp:new r.a7(p),u_center_direction:new r.aq(p),u_radius:new r.aa(p),u_opacity:new r.aa(p),u_temporal_offset:new r.aa(p)}),skyboxCapture:p=>({u_matrix_3f:new r.ar(p),u_sun_direction:new r.aq(p),u_sun_intensity:new r.aa(p),u_color_tint_r:new r.as(p),u_color_tint_m:new r.as(p),u_luminance:new r.aa(p)}),globeRaster:p=>({u_proj_matrix:new r.a6(p),u_globe_matrix:new r.a6(p),u_normalize_matrix:new r.a6(p),u_merc_matrix:new r.a6(p),u_zoom_transition:new r.aa(p),u_merc_center:new r.a8(p),u_image0:new r.a7(p),u_grid_matrix:new r.ar(p),u_skirt_height:new r.aa(p),u_far_z_cutoff:new r.aa(p),u_frustum_tl:new r.aq(p),u_frustum_tr:new r.aq(p),u_frustum_br:new r.aq(p),u_frustum_bl:new r.aq(p),u_globe_pos:new r.aq(p),u_globe_radius:new r.aa(p),u_viewport:new r.a8(p)}),globeAtmosphere:p=>({u_frustum_tl:new r.aq(p),u_frustum_tr:new r.aq(p),u_frustum_br:new r.aq(p),u_frustum_bl:new r.aq(p),u_horizon:new r.aa(p),u_transition:new r.aa(p),u_fadeout_range:new r.aa(p),u_color:new r.as(p),u_high_color:new r.as(p),u_space_color:new r.as(p),u_temporal_offset:new r.aa(p),u_horizon_angle:new r.aa(p)}),model:p=>({u_matrix:new r.a6(p),u_lighting_matrix:new r.a6(p),u_normal_matrix:new r.a6(p),u_node_matrix:new r.a6(p),u_lightpos:new r.aq(p),u_lightintensity:new r.aa(p),u_lightcolor:new r.aq(p),u_camera_pos:new r.aq(p),u_opacity:new r.aa(p),u_baseColorFactor:new r.as(p),u_emissiveFactor:new r.as(p),u_metallicFactor:new r.aa(p),u_roughnessFactor:new r.aa(p),u_baseTextureIsAlpha:new r.a7(p),u_alphaMask:new r.a7(p),u_alphaCutoff:new r.aa(p),u_baseColorTexture:new r.a7(p),u_metallicRoughnessTexture:new r.a7(p),u_normalTexture:new r.a7(p),u_occlusionTexture:new r.a7(p),u_emissionTexture:new r.a7(p),u_lutTexture:new r.a7(p),u_color_mix:new r.as(p),u_aoIntensity:new r.aa(p),u_emissive_strength:new r.aa(p),u_occlusionTextureTransform:new r.as(p)}),modelDepth:p=>({u_matrix:new r.a6(p),u_instance:new r.a6(p),u_node_matrix:new r.a6(p)}),groundShadow:p=>({u_matrix:new r.a6(p),u_ground_shadow_factor:new r.aq(p)}),stars:p=>({u_matrix:new r.a6(p),u_up:new r.aq(p),u_right:new r.aq(p),u_intensity_multiplier:new r.aa(p)}),occlusion:p=>({u_matrix:new r.a6(p),u_anchorPos:new r.aq(p),u_screenSizePx:new r.a8(p),u_occluderSizePx:new r.a8(p),u_color:new r.as(p)})};function ai(p,n,l){const y=n.createTileMatrix(p,p.worldSize,l.toUnwrapped());return r.ad.multiply(new Float32Array(16),p.projMatrix,y)}function Xn(p,n,l){if(n.projection.name===l.projection.name)return p.projMatrix;const y=l.clone();return y.setProjection(n.projection),ai(y,n.getProjection(),p)}function wn(p,n,l){return n.name===l.projection.name?p.projMatrix:ai(l,n,p)}let yo;function Ss(p,n,l,y,b,T,M){const D=p.context,F=D.gl,V=p.transform,X=p.getOrCreateProgram("collisionBox"),ie=[];let le=0,ue=0;for(let ke=0;ke<y.length;ke++){const qe=y[ke],Ve=n.getTile(qe),Ze=Ve.getBucket(l);if(!Ze)continue;const xe=Xn(qe,Ze,V);let Be=xe;b[0]===0&&b[1]===0||(Be=p.translatePosMatrix(xe,Ve,b,T));const Qe=M?Ze.textCollisionBox:Ze.iconCollisionBox,ct=Ze.collisionCircleArray;if(ct.length>0){const it=r.ad.create(),$e=Be;r.ad.mul(it,Ze.placementInvProjMatrix,V.glCoordMatrix),r.ad.mul(it,it,Ze.placementViewportMatrix),ie.push({circleArray:ct,circleOffset:ue,transform:$e,invTransform:it,projection:Ze.getProjection()}),le+=ct.length/4,ue=le}Qe&&(p.terrain&&p.terrain.setupElevationDraw(Ve,X),X.draw(p,F.LINES,r.ae.disabled,r.ag.disabled,p.colorModeForRenderPass(),r.af.disabled,ea(Be,V,Ve,Ze.getProjection()),l.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,null,V.zoom,null,[Qe.collisionVertexBuffer,Qe.collisionVertexBufferExt]))}if(!M||!ie.length)return;const me=p.getOrCreateProgram("collisionCircle"),ge=new r.bL;ge.resize(4*le),ge._trim();let _e=0;for(const ke of ie)for(let qe=0;qe<ke.circleArray.length/4;qe++){const Ve=4*qe,Ze=ke.circleArray[Ve+0],xe=ke.circleArray[Ve+1],Be=ke.circleArray[Ve+2],Qe=ke.circleArray[Ve+3];ge.emplace(_e++,Ze,xe,Be,Qe,0),ge.emplace(_e++,Ze,xe,Be,Qe,1),ge.emplace(_e++,Ze,xe,Be,Qe,2),ge.emplace(_e++,Ze,xe,Be,Qe,3)}(!yo||yo.length<2*le)&&(yo=function(ke){const qe=2*ke,Ve=new r.bu;Ve.resize(qe),Ve._trim();for(let Ze=0;Ze<qe;Ze++){const xe=6*Ze;Ve.uint16[xe+0]=4*Ze+0,Ve.uint16[xe+1]=4*Ze+1,Ve.uint16[xe+2]=4*Ze+2,Ve.uint16[xe+3]=4*Ze+2,Ve.uint16[xe+4]=4*Ze+3,Ve.uint16[xe+5]=4*Ze+0}return Ve}(le));const ye=D.createIndexBuffer(yo,!0),Pe=D.createVertexBuffer(ge,r.bM.members,!0);for(const ke of ie){const qe={u_matrix:ke.transform,u_inv_matrix:ke.invTransform,u_camera_to_center_distance:(De=V).getCameraToCenterDistance(ke.projection),u_viewport_size:[De.width,De.height]};me.draw(p,F.TRIANGLES,r.ae.disabled,r.ag.disabled,p.colorModeForRenderPass(),r.af.disabled,qe,l.id,Pe,ye,r.b.simpleSegment(0,2*ke.circleOffset,ke.circleArray.length,ke.circleArray.length/2),null,V.zoom)}var De;Pe.destroy(),ye.destroy()}const Yr=r.ad.create();function fr(p){const n=p._camera.getWorldToCamera(p.worldSize,1),l=r.ad.multiply([],n,p.globeMatrix);r.ad.invert(l,l);const y=[0,0,0],b=[0,1,0,0];return r.aA.transformMat4(b,b,l),y[0]=b[0],y[1]=b[1],y[2]=b[2],r._.normalize(y,y),y}function Uo({width:p,height:n,anchor:l,textOffset:y,textScale:b},T){const{horizontalAlign:M,verticalAlign:D}=r.bQ(l),F=-(M-.5)*p,V=-(D-.5)*n,X=r.bP(l,y);return new r.P((F/b+X[0])*T,(V/b+X[1])*T)}function ys(p,n,l,y,b,T,M,D,F,V,X){const ie=p.text.placedSymbolArray,le=p.text.dynamicLayoutVertexArray,ue=p.icon.dynamicLayoutVertexArray,me={},ge=p.getProjection(),_e=wn(D,ge,T),ye=T.elevation,Pe=ge.upVectorScale(D.canonical,T.center.lat,T.worldSize).metersToTile;le.clear();for(let De=0;De<ie.length;De++){const ke=ie.get(De),{tileAnchorX:qe,tileAnchorY:Ve,numGlyphs:Ze}=ke,xe=ke.hidden||!ke.crossTileID||p.allowVerticalPlacement&&!ke.placedOrientation?null:y[ke.crossTileID];if(xe){let Be=0,Qe=0,ct=0;if(ye){const Tt=ye?ye.getAtTileOffset(D,qe,Ve):0,[Kt,Qt,ni]=ge.upVector(D.canonical,qe,Ve);Be=Tt*Kt*Pe,Qe=Tt*Qt*Pe,ct=Tt*ni*Pe}let[it,$e,ft,Pt]=ls(ke.projectedAnchorX+Be,ke.projectedAnchorY+Qe,ke.projectedAnchorZ+ct,l?_e:M);const Dt=ya(T.getCameraToCenterDistance(ge),Pt);let Lt=b.evaluateSizeForFeature(p.textSizeData,V,ke)*Dt/r.bN;l&&(Lt*=p.tilePixelRatio/F);const ot=Uo(xe,Lt);l?({x:it,y:$e,z:ft}=ge.projectTilePoint(qe+ot.x,Ve+ot.y,D.canonical),[it,$e,ft]=ls(it+Be,$e+Qe,ft+ct,M)):(n&&ot._rotate(-T.angle),it+=ot.x,$e+=ot.y,ft=0);const gt=p.allowVerticalPlacement&&ke.placedOrientation===r.aE.vertical?Math.PI/2:0;for(let Tt=0;Tt<Ze;Tt++)r.aH(le,it,$e,ft,gt);X&&ke.associatedIconIndex>=0&&(me[ke.associatedIconIndex]={x:it,y:$e,z:ft,angle:gt})}else zs(Ze,le)}if(X){ue.clear();const De=p.icon.placedSymbolArray;for(let ke=0;ke<De.length;ke++){const qe=De.get(ke),{numGlyphs:Ve}=qe,Ze=me[ke];if(qe.hidden||!Ze)zs(Ve,ue);else{const{x:xe,y:Be,z:Qe,angle:ct}=Ze;for(let it=0;it<Ve;it++)r.aH(ue,xe,Be,Qe,ct)}}p.icon.dynamicLayoutVertexBuffer.updateData(ue)}p.text.dynamicLayoutVertexBuffer.updateData(le)}function ta(p,n,l,y,b,T,M={}){const D=l.paint.get("icon-translate"),F=l.paint.get("text-translate"),V=l.paint.get("icon-translate-anchor"),X=l.paint.get("text-translate-anchor"),ie=l.layout.get("icon-rotation-alignment"),le=l.layout.get("text-rotation-alignment"),ue=l.layout.get("icon-pitch-alignment"),me=l.layout.get("text-pitch-alignment"),ge=l.layout.get("icon-keep-upright"),_e=l.layout.get("text-keep-upright"),ye=l.paint.get("icon-color-saturation"),Pe=l.paint.get("icon-color-contrast"),De=l.paint.get("icon-color-brightness-min"),ke=l.paint.get("icon-color-brightness-max"),qe=l.paint.get("icon-occlusion-opacity").constantOr(0),Ve=l.paint.get("text-occlusion-opacity").constantOr(0),Ze=p.context,xe=Ze.gl,Be=p.transform,Qe=ie==="map",ct=le==="map",it=ue==="map",$e=me==="map",ft=qe!==1,Pt=Ve!==1,Dt=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Lt=!1;const ot=p.depthModeForSublayer(0,r.ae.ReadOnly),gt=[r.aj(Be.center.lng),r.ak(Be.center.lat)],Tt=l.layout.get("text-variable-anchor"),Kt=Be.projection.name==="globe",Qt=[],ni=[0,-1,0];for(const Jt of y){const Wt=n.getTile(Jt),wt=Wt.getBucket(l);if(!wt||wt.projection.name==="mercator"&&Kt||wt.fullyClipped)continue;const hi=wt.projection.name==="globe",dn=hi?r.a1(Be.zoom):0,ji=wn(Jt,wt.getProjection(),Be),Ji=Be.calculatePixelsToTileUnitsMatrix(Wt),Cn=Tt&&wt.hasTextData(),Sr=wt.hasIconTextFit()&&Cn&&wt.hasIconData(),vn=wt.getProjection().createInversionMatrix(Be,Jt.canonical),$i=()=>{const xr=Qe&&l.layout.get("symbol-placement")!=="point",It=[];l.hasInitialOcclusionOpacityProperties&&ft&&p.symbolParams.useOcclusionQueries&&!hi&&!Kt&&It.push("OCCLUSION_QUERIES"),l.hasInitialOcclusionOpacityProperties||It.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH");const li=xr||Sr,rs=l.paint.get("icon-image-cross-fade").constantOr(0);p.terrainRenderModeElevated()&&it&&It.push("PITCH_WITH_MAP_TERRAIN"),hi&&(It.push("PROJECTION_GLOBE_VIEW"),li&&It.push("PROJECTED_POS_ON_VIEWPORT")),rs>0&&It.push("ICON_TRANSITION"),wt.icon.zOffsetVertexBuffer&&It.push("Z_OFFSET"),It.push("TERRAIN_DEPTH_D24"),ye===0&&Pe===0&&De===0&&ke===1||It.push("COLOR_ADJUSTMENT");const Wn=wt.icon.programConfigurations.get(l.id),lt=p.getOrCreateProgram(wt.sdfIcons?"symbolSDF":"symbolIcon",{config:Wn,defines:It});let Ms;const xs=Wt.imageAtlasTexture?Wt.imageAtlasTexture.size:[0,0],os=wt.iconSizeData,ws=r.aD(os,Be.zoom),$a=it||Be.pitch!==0,Ll=Ki(ji,Wt.tileID.canonical,it,Qe,Be,wt.getProjection(),Ji),la=Na(ji,Wt.tileID.canonical,it,Qe,Be,wt.getProjection(),Ji),cc=p.translatePosMatrix(la,Wt,D,V,!0),uc=p.translatePosMatrix(ji,Wt,D,V),hc=li?Yr:Ll,cl=Qe&&!it&&!xr;let zc=ni;!Kt&&!Be.mercatorFromTransition||Qe||(zc=fr(Be));const _u=hi?zc:ni;if(wt.sdfIcons&&!wt.iconsInText)Ms=Ie(os.kind,ws,cl,it,p,uc,hc,cc,!1,xs,!0,Jt,dn,gt,vn,_u,wt.getProjection());else{const Vc=l.getColorAdjustmentMatrix(ye,Pe,De,ke);Ms=pe(os.kind,ws,cl,it,p,uc,hc,cc,!1,xs,Jt,dn,gt,vn,_u,wt.getProjection(),Vc,rs)}const uh=Wt.imageAtlasTexture?Wt.imageAtlasTexture:null,yu=l.layout.get("icon-size").constantOr(0)!==1||wt.iconsNeedLinear,vu=wt.sdfIcons||p.options.rotating||p.options.zooming||yu||$a?xe.LINEAR:xe.NEAREST,Qh=wt.sdfIcons&&l.paint.get("icon-halo-width").constantOr(1)!==0,Jh=p.terrain&&it&&xr?r.ad.invert(r.ad.create(),Ll):Yr;if(xr&&wt.icon){const Vc=Be.elevation,bs=Vc?Vc.getAtTileOffsetFunc(Jt,Be.center.lat,Be.worldSize,wt.getProjection()):null,Sf=il(ji,Wt.tileID.canonical,it,Qe,Be,wt.getProjection(),Ji);Zl(wt,ji,p,!1,Sf,la,it,ge,bs,Jt)}return{program:lt,buffers:wt.icon,uniformValues:Ms,atlasTexture:uh,atlasTextureIcon:null,atlasInterpolation:vu,atlasInterpolationIcon:null,isSDF:wt.sdfIcons,hasHalo:Qh,tile:Wt,labelPlaneMatrixInv:Jh}},mr=()=>{const xr=ct&&l.layout.get("symbol-placement")!=="point",It=[],li=xr||Tt||Sr;l.hasInitialOcclusionOpacityProperties&&Pt&&p.symbolParams.useOcclusionQueries&&!hi&&!Kt&&It.push("OCCLUSION_QUERIES"),l.hasInitialOcclusionOpacityProperties||It.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH"),p.terrainRenderModeElevated()&&$e&&It.push("PITCH_WITH_MAP_TERRAIN"),hi&&(It.push("PROJECTION_GLOBE_VIEW"),li&&It.push("PROJECTED_POS_ON_VIEWPORT")),wt.text.zOffsetVertexBuffer&&It.push("Z_OFFSET"),It.push("TERRAIN_DEPTH_D24");const rs=wt.text.programConfigurations.get(l.id),Wn=p.getOrCreateProgram(wt.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:rs,defines:It});let lt,Ms=[0,0],xs=null;const os=wt.textSizeData;wt.iconsInText&&(Ms=Wt.imageAtlasTexture?Wt.imageAtlasTexture.size:[0,0],xs=Wt.imageAtlasTexture?Wt.imageAtlasTexture:null,lt=$e||Be.pitch!==0||p.options.rotating||p.options.zooming||os.kind==="composite"||os.kind==="camera"?xe.LINEAR:xe.NEAREST);const ws=Wt.glyphAtlasTexture?Wt.glyphAtlasTexture.size:[0,0],$a=r.aD(os,Be.zoom),Ll=Ki(ji,Wt.tileID.canonical,$e,ct,Be,wt.getProjection(),Ji),la=Na(ji,Wt.tileID.canonical,$e,ct,Be,wt.getProjection(),Ji),cc=p.translatePosMatrix(la,Wt,F,X,!0),uc=p.translatePosMatrix(ji,Wt,F,X),hc=li?Yr:Ll,cl=ct&&!$e&&!xr;let zc=ni;!Kt&&!Be.mercatorFromTransition||ct||(zc=fr(Be));const _u=hi?zc:ni;let uh;uh=wt.iconsInText?Ne(os.kind,$a,cl,$e,p,uc,hc,cc,ws,Ms,Jt,dn,gt,vn,_u,wt.getProjection()):Ie(os.kind,$a,cl,$e,p,uc,hc,cc,!0,ws,!0,Jt,dn,gt,vn,_u,wt.getProjection());const yu=Wt.glyphAtlasTexture?Wt.glyphAtlasTexture:null,vu=xe.LINEAR,Qh=l.paint.get("text-halo-width").constantOr(1)!==0,Jh=p.terrain&&$e&&xr?r.ad.invert(r.ad.create(),Ll):Yr;if(xr&&wt.text){const Vc=Be.elevation,bs=Vc?Vc.getAtTileOffsetFunc(Jt,Be.center.lat,Be.worldSize,wt.getProjection()):null,Sf=il(ji,Wt.tileID.canonical,$e,ct,Be,wt.getProjection(),Ji);Zl(wt,ji,p,!0,Sf,la,$e,_e,bs,Jt)}return{program:Wn,buffers:wt.text,uniformValues:uh,atlasTexture:yu,atlasTextureIcon:xs,atlasInterpolation:vu,atlasInterpolationIcon:lt,isSDF:!0,hasHalo:Qh,tile:Wt,labelPlaneMatrixInv:Jh}},Qn=wt.icon.segments.get().length,En=wt.text.segments.get().length,rn=Qn&&!M.onlyText?$i():null,vr=En&&!M.onlyIcons?mr():null,ro=l.paint.get("icon-opacity").constantOr(1),or=l.paint.get("text-opacity").constantOr(1);if(Dt&&wt.canOverlap){Lt=!0;const xr=ro&&!M.onlyText?wt.icon.segments.get():[],It=or&&!M.onlyIcons?wt.text.segments.get():[];for(const li of xr)Qt.push({segments:new r.b([li]),sortKey:li.sortKey,state:rn});for(const li of It)Qt.push({segments:new r.b([li]),sortKey:li.sortKey,state:vr})}else M.onlyText||Qt.push({segments:ro?wt.icon.segments:new r.b([]),sortKey:0,state:rn}),M.onlyIcons||Qt.push({segments:or?wt.text.segments:new r.b([]),sortKey:0,state:vr})}Lt&&Qt.sort((Jt,Wt)=>Jt.sortKey-Wt.sortKey);for(const Jt of Qt){const Wt=Jt.state;if(Wt)if(p.terrain&&p.terrain.setupElevationDraw(Wt.tile,Wt.program,{useDepthForOcclusion:!l.hasInitialOcclusionOpacityProperties&&Be.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Wt.labelPlaneMatrixInv}),Ze.activeTexture.set(xe.TEXTURE0),Wt.atlasTexture&&Wt.atlasTexture.bind(Wt.atlasInterpolation,xe.CLAMP_TO_EDGE,!0),Wt.atlasTextureIcon&&(Ze.activeTexture.set(xe.TEXTURE1),Wt.atlasTextureIcon&&Wt.atlasTextureIcon.bind(Wt.atlasInterpolationIcon,xe.CLAMP_TO_EDGE,!0)),p.uploadCommonLightUniforms(p.context,Wt.program),Wt.hasHalo){const wt=Wt.uniformValues;wt.u_is_halo=1,ia(Wt.buffers,Jt.segments,l,p,Wt.program,ot,b,T,wt,2),wt.u_is_halo=0}else{if(Wt.isSDF){const wt=Wt.uniformValues;Wt.hasHalo&&(wt.u_is_halo=1,ia(Wt.buffers,Jt.segments,l,p,Wt.program,ot,b,T,wt,1)),wt.u_is_halo=0}ia(Wt.buffers,Jt.segments,l,p,Wt.program,ot,b,T,Wt.uniformValues,1)}}}function ia(p,n,l,y,b,T,M,D,F,V){const X=y.context.gl,ie=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer];p.occlusionQueryOpacityVertexBuffer.length>0&&ie.push(p.occlusionQueryOpacityVertexBuffer),b.draw(y,X.TRIANGLES,T,M,D,r.af.disabled,F,l.id,p.layoutVertexBuffer,p.indexBuffer,n,l.paint,y.transform.zoom,p.programConfigurations.get(l.id),ie,V)}function Tl(p,n,l,y,b,T,M){const D=p.context.gl,F=l.paint.get("fill-pattern"),V=F&&F.constantOr(1);let X,ie,le,ue,me;M?(ie=V&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",X=D.LINES):(ie=V?"fillPattern":"fill",X=D.TRIANGLES);for(const ge of y){const _e=n.getTile(ge);if(V&&!_e.patternsLoaded())continue;const ye=_e.getBucket(l);if(!ye)continue;p.prepareDrawTile();const Pe=ye.programConfigurations.get(l.id),De=p.isTileAffectedByFog(ge),ke=p.getOrCreateProgram(ie,{config:Pe,overrideFog:De});V&&(p.context.activeTexture.set(D.TEXTURE0),_e.imageAtlasTexture&&_e.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Pe.updatePaintBuffers());const qe=F.constantOr(null);if(qe&&_e.imageAtlas){const xe=_e.imageAtlas.patternPositions[qe.toString()];xe&&Pe.setConstantPatternPositions(xe)}const Ve=p.translatePosMatrix(ge.projMatrix,_e,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor")),Ze=l.paint.get("fill-emissive-strength");if(M){ue=ye.indexBuffer2,me=ye.segments2;const xe=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[D.drawingBufferWidth,D.drawingBufferHeight];le=ie==="fillOutlinePattern"&&V?El(Ve,Ze,p,_e,xe):Ic(Ve,Ze,xe)}else ue=ye.indexBuffer,me=ye.segments,le=V?Ts(Ve,Ze,p,_e):Ca(Ve,Ze);p.uploadCommonUniforms(p.context,ke,ge.toUnwrapped()),ke.draw(p,X,b,p.stencilModeForClipping(ge),T,r.af.disabled,le,l.id,ye.layoutVertexBuffer,ue,me,l.paint,p.transform.zoom,Pe,void 0)}}function vs(p,n,l,y,b,T,M,D){l.resetLayerRenderingStats(p);const F=p.context,V=F.gl,X=p.transform,ie=l.paint.get("fill-extrusion-pattern"),le=ie.constantOr(1),ue=l.paint.get("fill-extrusion-opacity"),me=p.style.enable3dLights(),ge=l.paint.get(me&&!le?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),_e=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),ge],ye=l.layout.get("fill-extrusion-edge-radius"),Pe=ye>0&&!l.paint.get("fill-extrusion-rounded-roof"),De=Pe?0:ye,ke=X.projection.name==="globe"?r.bY():0,qe=X.projection.name==="globe",Ve=qe?r.a1(X.zoom):0,Ze=[r.aj(X.center.lng),r.ak(X.center.lat)],xe=l.paint.get("fill-extrusion-flood-light-color").toRenderColor(l.lut).toArray01().slice(0,3),Be=l.paint.get("fill-extrusion-flood-light-intensity"),Qe=l.paint.get("fill-extrusion-vertical-scale"),ct=Rr(p,l.paint.get("fill-extrusion-cutoff-fade-range")),it=l.paint.get("fill-extrusion-emissive-strength"),$e=[];let ft;qe&&$e.push("PROJECTION_GLOBE_VIEW"),_e[0]>0&&$e.push("FAUX_AO"),Pe&&$e.push("ZERO_ROOF_RADIUS"),D&&$e.push("HAS_CENTROID"),Be>0&&$e.push("FLOOD_LIGHT"),ct.shouldRenderCutoff&&$e.push("RENDER_CUTOFF");const Pt=p.renderPass==="shadow",Dt=p.shadowRenderer,Lt=Pt&&!!Dt;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let ot=[0,0,0];if(Dt){const Kt=p.style.directionalLight,Qt=p.style.ambientLight;Kt&&Qt&&(ot=nl(p.style,Kt,Qt)),ft=$e.concat(["SHADOWS_SINGLE_CASCADE"])}const gt=Lt?"fillExtrusionDepth":le?"fillExtrusionPattern":"fillExtrusion",Tt=l.getLayerRenderingStats();for(const Kt of y){const Qt=n.getTile(Kt),ni=Qt.getBucket(l);if(!ni||ni.projection.name!==X.projection.name)continue;let Jt=!1;Dt&&(Jt=Dt.getMaxCascadeForTile(Kt.toUnwrapped())===0);const Wt=p.isTileAffectedByFog(Kt),wt=ni.programConfigurations.get(l.id),hi=p.getOrCreateProgram(gt,{config:wt,defines:Jt?ft:$e,overrideFog:Wt});if(p.terrain&&p.terrain.setupElevationDraw(Qt,hi,{useMeterToDem:!0}),!ni.centroidVertexBuffer){const vn=hi.attributes.a_centroid_pos;vn!==void 0&&V.vertexAttrib2f(vn,0,0)}!Pt&&Dt&&Dt.setupShadows(Qt.tileID.toUnwrapped(),hi,"vector-tile",Qt.tileID.overscaledZ),le&&(p.context.activeTexture.set(V.TEXTURE0),Qt.imageAtlasTexture&&Qt.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),wt.updatePaintBuffers());const dn=ie.constantOr(null);if(dn&&Qt.imageAtlas){const vn=Qt.imageAtlas.patternPositions[dn.toString()];vn&&wt.setConstantPatternPositions(vn)}const ji=l.paint.get("fill-extrusion-vertical-gradient");let Ji;if(Pt&&Dt){if(nu(Qt.tileID,ni,p))continue;const vn=Dt.calculateShadowPassMatrixFromTile(Qt.tileID.toUnwrapped());Ji=wa(vn,De,Qe)}else{const vn=p.translatePosMatrix(Kt.expandedProjMatrix,Qt,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),$i=X.projection.createInversionMatrix(X,Kt.canonical);Ji=le?ba(vn,p,ji,ue,_e,De,Kt,Qt,ke,Ve,Ze,$i,xe,Qe):sl(vn,p,ji,ue,_e,De,Kt,ke,Ve,Ze,$i,xe,Qe,Be,ot,it)}p.uploadCommonUniforms(F,hi,Kt.toUnwrapped(),null,ct);let Cn=ni.segments;if(X.projection.name==="mercator"&&!Pt&&(Cn=ni.getVisibleSegments(Qt.tileID,p.terrain,p.transform.getFrustum(0)),!Cn.get().length))continue;if(Tt)if(Pt)for(const vn of Cn.get())Tt.numRenderedVerticesInShadowPass+=vn.primitiveLength;else for(const vn of Cn.get())Tt.numRenderedVerticesInTransparentPass+=vn.primitiveLength;const Sr=[];(p.terrain||D)&&Sr.push(ni.centroidVertexBuffer),qe&&Sr.push(ni.layoutVertexExtBuffer),hi.draw(p,F.gl.TRIANGLES,b,T,M,r.af.backCCW,Ji,l.id,ni.layoutVertexBuffer,ni.indexBuffer,Cn,l.paint,p.transform.zoom,wt,Sr)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}function qa(p,n,l,y,b,T,M,D,F,V,X,ie,le,ue,me,ge,_e,ye,Pe){const De=p.context,ke=De.gl,qe=p.transform,Ve=p.transform.zoom,Ze=[],xe=Rr(p,l.paint.get("fill-extrusion-cutoff-fade-range"));V==="clear"?(Ze.push("CLEAR_SUBPASS"),Pe&&(Ze.push("CLEAR_FROM_TEXTURE"),De.activeTexture.set(ke.TEXTURE0),Pe.bind(ke.LINEAR,ke.CLAMP_TO_EDGE))):V==="sdf"&&Ze.push("SDF_SUBPASS"),_e&&Ze.push("HAS_CENTROID"),xe.shouldRenderCutoff&&Ze.push("RENDER_CUTOFF");const Be=l.layout.get("fill-extrusion-edge-radius"),Qe=(ct,it,$e,ft,Pt)=>{const Dt=it.programConfigurations.get(l.id),Lt=p.isTileAffectedByFog(ct),ot=p.getOrCreateProgram("fillExtrusionGroundEffect",{config:Dt,defines:Ze,overrideFog:Lt}),gt=((Kt,Qt,ni,Jt,Wt,wt,hi,dn,ji,Ji,Cn)=>({u_matrix:Qt,u_opacity:ni,u_ao_pass:Jt?1:0,u_meter_to_tile:Wt,u_ao:wt,u_flood_light_intensity:hi,u_flood_light_color:dn,u_attenuation:ji,u_edge_radius:Ji,u_fb:0,u_fb_size:Cn}))(0,ft,X,F,Pt,[ie,le*Pt],ue,me,ge,Ve>=17?0:Be*Pt,Pe?Pe.size[0]:0),Tt=[];_e&&Tt.push(it.hiddenByLandmarkVertexBuffer),p.uploadCommonUniforms(De,ot,ct.toUnwrapped(),null,xe),ot.draw(p,De.gl.TRIANGLES,b,T,M,D,gt,l.id,it.vertexBuffer,it.indexBuffer,$e,l.paint,Ve,Dt,Tt)};for(const ct of y){const it=n.getTile(ct),$e=it.getBucket(l);if(!$e||$e.projection.name!==qe.projection.name||!$e.groundEffect||$e.groundEffect&&!$e.groundEffect.hasData())continue;const ft=$e.groundEffect,Pt=1/$e.tileToMeter;{const Dt=p.translatePosMatrix(ct.projMatrix,it,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Lt=ft.getDefaultSegment();Qe(ct,ft,Lt,Dt,Pt)}if(ye)for(let Dt=0;Dt<4;Dt++){const Lt=r.bZ[Dt](ct),ot=n.getTile(Lt);if(!ot)continue;const gt=ot.getBucket(l);if(!gt||gt.projection.name!==qe.projection.name||!gt.groundEffect||gt.groundEffect&&!gt.groundEffect.hasData())continue;const Tt=gt.groundEffect;let Kt,Qt;Dt===0?(Kt=[-r.a3,0,0],Qt=1):Dt===1?(Kt=[r.a3,0,0],Qt=0):Dt===2?(Kt=[0,-r.a3,0],Qt=3):(Kt=[0,r.a3,0],Qt=2);const ni=Tt.regionSegments[Qt];if(!ni)continue;const Jt=new Float32Array(16);r.ad.translate(Jt,ct.projMatrix,Kt),Qe(ct,Tt,ni,p.translatePosMatrix(Jt,it,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Pt)}}}function Bh(p,n,l,y,b,T,M){y.centroidVertexArray.length===0&&y.createCentroidsBuffer();const D=T?T.findDEMTileFor(l):null;if(!(D&&D.dem||M))return;const F=ye=>new r.P(Math.ceil((ye+r.c0)*r.c1),0),V=ye=>{const Pe=n.getSource().minzoom,De=qe=>{const Ve=n.getTileByID(qe);if(Ve&&Ve.hasData())return Ve.getBucket(b)},ke=[0,-1,1];for(const qe of ke){if(ye.overscaledZ+qe<Pe)continue;const Ve=De(ye.calculateScaledKey(ye.overscaledZ+qe));if(Ve)return Ve}},X=[0,0,0],ie=(ye,Pe)=>(X[0]=Math.min(ye.min.y,Pe.min.y),X[1]=Math.max(ye.max.y,Pe.max.y),X[2]=r.a3-Pe.min.x>ye.max.x?Pe.min.x-r.a3:ye.max.x,X),le=(ye,Pe)=>(X[0]=Math.min(ye.min.x,Pe.min.x),X[1]=Math.max(ye.max.x,Pe.max.x),X[2]=r.a3-Pe.min.y>ye.max.y?Pe.min.y-r.a3:ye.max.y,X),ue=[(ye,Pe)=>ie(ye,Pe),(ye,Pe)=>ie(Pe,ye),(ye,Pe)=>le(ye,Pe),(ye,Pe)=>le(Pe,ye)],me=(ye,Pe,De,ke,qe,Ve,Ze)=>{if(!T)return 0;const xe=[[Ve?De:ye,Ve?ye:De,0],[Ve?De:Pe,Ve?Pe:De,0]],Be=Ze<0?r.a3+Ze:Ze,Qe=[Ve?Be:(ye+Pe)/2,Ve?(ye+Pe)/2:Be,0];return De===0&&Ze<0||De!==0&&Ze>0?T.getForTilePoints(qe,[Qe],!0,ke):xe.push(Qe),T.getForTilePoints(l,xe,!0,D),Math.max(xe[0][2],xe[1][2],Qe[2])/T.exaggeration()};for(let ye=0;ye<4;ye++){const Pe=y.borderFeatureIndices[ye];if(Pe.length===0)continue;const De=r.bZ[ye](l),ke=V(De);if(!(ke&&ke instanceof r.b_)||y.borderDoneWithNeighborZ[ye]===ke.canonical.z)continue;ke.centroidVertexArray.length===0&&ke.createCentroidsBuffer();const qe=T?T.findDEMTileFor(De):null;if(!(qe&&qe.dem||M))continue;const Ve=(ye<2?1:5)-ye,Ze=ke.borderDoneWithNeighborZ[Ve]!==y.canonical.z,xe=ke.borderFeatureIndices[Ve];let Be=0;if(y.canonical.z!==ke.canonical.z){for(const Qe of Pe)y.showCentroid(y.featuresOnBorder[Qe]);if(Ze)for(const Qe of xe)ke.showCentroid(ke.featuresOnBorder[Qe]);y.borderDoneWithNeighborZ[ye]=ke.canonical.z,ke.borderDoneWithNeighborZ[Ve]=y.canonical.z}for(const Qe of Pe){const ct=y.featuresOnBorder[Qe],it=y.centroidData[ct.centroidDataIndex],$e=ct.borders[ye];let ft;for(;Be<xe.length;){ft=ke.featuresOnBorder[xe[Be]];const Pt=ft.borders[Ve];if(Pt[1]>$e[0]+3||Pt[0]>$e[0]-3)break;ke.showCentroid(ft),Be++}if(ft&&Be<xe.length){const Pt=Be;let Dt=0;for(;!(ft.borders[Ve][0]>$e[1]-3)&&(Dt++,++Be!==xe.length);)ft=ke.featuresOnBorder[xe[Be]];if(ft=ke.featuresOnBorder[xe[Pt]],Dt>1){const gt=ft.borders[Ve];Math.abs($e[0]-gt[0])<3&&Math.abs($e[1]-gt[1])<3&&(Dt=1,Be=Pt+1)}else if(Dt===0){y.showCentroid(ct);continue}const Lt=ke.centroidData[ft.centroidDataIndex];M&&Dt===1&&(((ge=it).flags|(_e=Lt).flags)&r.b$?(ge.flags|=r.b$,_e.flags|=r.b$):(ge.flags&=~r.b$,_e.flags&=~r.b$));const ot=ct.intersectsCount()>1||ft.intersectsCount()>1;if(Dt>1)Be=Pt,it.centroidXY=Lt.centroidXY=new r.P(0,0);else if(qe&&qe.dem&&!ot){const gt=ue[ye](it,Lt),Tt=ye%2?r.a3-1:0,Kt=me(gt[0],Math.min(r.a3-1,gt[1]),Tt,qe,De,ye<2,gt[2]);it.centroidXY=Lt.centroidXY=F(Kt)}else ot?it.centroidXY=Lt.centroidXY=new r.P(0,0):(it.centroidXY=y.encodeBorderCentroid(ct),Lt.centroidXY=ke.encodeBorderCentroid(ft));y.writeCentroidToBuffer(it),ke.writeCentroidToBuffer(Lt)}else y.showCentroid(ct)}y.borderDoneWithNeighborZ[ye]=ke.canonical.z,ke.borderDoneWithNeighborZ[Ve]=y.canonical.z}var ge,_e;(y.needsCentroidUpdate||!y.centroidVertexBuffer&&y.centroidVertexArray.length!==0)&&y.uploadCentroid(p)}const iu=[1,0,0],al=[0,1,0],Nh=[0,0,1];function nu(p,n,l){const y=l.transform,b=l.shadowRenderer;if(!b)return!0;const T=p.toUnwrapped(),M=y.tileSize*b._cascades[l.currentShadowCascade].scale;let D=n.maxHeight;if(y.elevation){const ge=y.elevation.getMinMaxForTile(p);ge&&(D+=ge.max)}const F=[...b.shadowDirection];F[2]=-F[2];const V=b.computeSimplifiedTileShadowVolume(T,D,M,F);if(!V)return!1;const X=[iu,al,Nh,F,[F[0],0,F[2]],[0,F[1],F[2]]],ie=y.projection.name==="globe",le=y.scaleZoom(M),ue=r.aM.fromInvProjectionMatrix(y.invProjMatrix,y.worldSize,le,!ie),me=b.getCurrentCascadeFrustum();return ue.intersectsPrecise(V.vertices,V.planes,X)===0||me.intersectsPrecise(V.vertices,V.planes,X)===0}function ru(p){return[p[0]*r.c2,p[1]*r.c2,p[2]*r.c2,0]}function Sl(p,n,l,y,b,T,M,D,F){const V=y.getSource(),X=l.globeSharedBuffers;if(!X)return;let ie,le,ue;if(n&&(ie=y.getTile(n)),V instanceof r.bm?(le=V.texture,ue=r.bh(0,0,l.transform)):ie&&n&&(le=ie.texture,ue=r.bh(n.canonical.z,n.canonical.x,l.transform)),!le||!ue)return;p||(ue=r.ad.scale(r.ad.create(),ue,[1,-1,1]));const me=l.context,ge=me.gl,_e=b.paint.get("raster-resampling")==="nearest"?ge.NEAREST:ge.LINEAR,ye=l.colorModeForDrapableLayerRenderPass(T),Pe=M.defines;Pe.push("GLOBE_POLES");const De=new r.ae(ge.LEQUAL,r.ae.ReadWrite,l.depthRangeFor3D),ke=Float32Array.from(l.transform.expandedFarZProjMatrix),qe=Float32Array.from(r.bf(r.bg(new r.aO(0,0,0))));l.terrain&&l.terrain.prepareDrawTile(),me.activeTexture.set(ge.TEXTURE0),le.bind(_e,ge.CLAMP_TO_EDGE),me.activeTexture.set(ge.TEXTURE1),le.bind(_e,ge.CLAMP_TO_EDGE),le.useMipmap&&me.extTextureFilterAnisotropic&&l.transform.pitch>20&&ge.texParameterf(ge.TEXTURE_2D,me.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,me.extTextureFilterAnisotropicMax);const[Ve,Ze,xe,Be]=n?X.getPoleBuffers(n.canonical.z,!1):X.getPoleBuffers(0,!0),Qe=b.paint.get("raster-elevation");let ct;p?(ct=Ve,l.renderDefaultNorthPole=Qe!==0):(ct=Ze,l.renderDefaultSouthPole=Qe!==0);const it=ru(M.mix),$e=((Pt,Dt,Lt,ot,gt,Tt,Kt,Qt,ni,Jt,Wt,wt,hi)=>v(Pt,Dt,Lt,new Float32Array(16),new Float32Array(9),[0,0],ot,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Tt,[0,0],Qt,2,Jt,Wt,wt,1,0,hi))(ke,qe,ue,r.a1(l.transform.zoom),0,b,0,Qe,0,it,M.offset,M.range,T),ft=l.getOrCreateProgram("raster",{defines:Pe});l.uploadCommonUniforms(me,ft,null),ft.draw(l,ge.TRIANGLES,De,F,ye,D,$e,b.id,ct,xe,Be)}function Mc(p){const n=p._nearZ,l=p.projection.farthestPixelDistance(p),y=l-n,b=.2*p.height,T=n+b;return[n,l,(T-b-n)/y,(T-n)/y]}function kn(p,n,l,y){if(p)return n instanceof za&&p instanceof r.c3?n.getTextureDescriptor(p,l,!0):{texture:p.texture,mix:ru(y.mix),offset:y.offset,buffer:0,tileSize:1}}function $d(p,n,l){if(!p)return null;const y=n.getTextureDescriptor(p,l,!0);if(!y)return null;let{texture:b,mix:T,offset:M,tileSize:D,buffer:F,format:V}=y;if(!b||!V)return null;let X=!1;return V==="uint32"&&(X=!0,T[3]=0,T=c(r.c4,T,[0,l.paint.get("raster-particle-max-speed")]),M=m(r.c4,M,[0,l.paint.get("raster-particle-max-speed")])),{texture:b,textureOffset:[F/(D+2*F),D/(D+2*F)],tileSize:D,scalarData:X,scale:T,offset:M,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[V]]}}function Fi(p){const n=p._nearZ,l=p.projection.farthestPixelDistance(p),y=l-n,b=.2*p.height,T=n+b;return[n,l,(T-b-n)/y,(T-n)/y]}const Fh=new r.C(1,0,0,1),Lc=new r.C(0,1,0,1),Qu=new r.C(0,0,1,1),Ea=new r.C(1,0,1,1),Ju=new r.C(0,1,1,1);function na(p,n,l,y,b,T,M){const D=p.context,F=p.transform,V=D.gl,X=F.projection.name==="globe",ie=X?["PROJECTION_GLOBE_VIEW"]:[];let le=r.ad.clone(l.projMatrix);if(X&&r.a1(F.zoom)>0){const it=r.c5(l.canonical,F),$e=r.c6(it);le=r.ad.multiply(new Float32Array(16),F.globeMatrix,$e),r.ad.multiply(le,F.projMatrix,le)}const ue=r.ad.create();ue[12]+=2*b/(r.e.devicePixelRatio*F.width),ue[13]+=2*T/(r.e.devicePixelRatio*F.height),r.ad.multiply(le,ue,le);const me=p.getOrCreateProgram("debug",{defines:ie}),ge=n.getTileByID(l.key);p.terrain&&p.terrain.setupElevationDraw(ge,me);const _e=r.ae.disabled,ye=r.ag.disabled,Pe=p.colorModeForRenderPass(),De="$debug";D.activeTexture.set(V.TEXTURE0),p.emptyTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),X?ge._makeGlobeTileDebugBuffers(p.context,F):ge._makeDebugTileBoundsBuffers(p.context,F.projection);const ke=ge._tileDebugBuffer||p.debugBuffer,qe=ge._tileDebugIndexBuffer||p.debugIndexBuffer,Ve=ge._tileDebugSegments||p.debugSegments;if(me.draw(p,V.LINE_STRIP,_e,ye,Pe,r.af.disabled,Zn(le,y),De,ke,qe,Ve,null,null,null,[ge._globeTileDebugBorderBuffer]),M){const it=ge.latestRawTileData,$e=Math.floor((it&&it.byteLength||0)/1024);let ft=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(ft+=` => ${l.overscaledZ}`),ft+=` ${ge.state}`,ft+=` ${$e}kb`,function(Pt,Dt){Pt.initDebugOverlayCanvas();const Lt=Pt.debugOverlayCanvas,ot=Pt.context.gl,gt=Pt.debugOverlayCanvas.getContext("2d");gt.clearRect(0,0,Lt.width,Lt.height),gt.shadowColor="white",gt.shadowBlur=2,gt.lineWidth=1.5,gt.strokeStyle="white",gt.textBaseline="top",gt.font="bold 36px Open Sans, sans-serif",gt.fillText(Dt,5,5),gt.strokeText(Dt,5,5),Pt.debugOverlayTexture.update(Lt),Pt.debugOverlayTexture.bind(ot.LINEAR,ot.CLAMP_TO_EDGE)}(p,ft)}const Ze=n.getTile(l).tileSize,xe=512/Math.min(Ze,512)*(l.overscaledZ/F.zoom)*.5,Be=ge._tileDebugTextBuffer||p.debugBuffer,Qe=ge._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,ct=ge._tileDebugTextSegments||p.debugSegments;me.draw(p,V.TRIANGLES,_e,ye,r.a.alphaBlended,r.af.disabled,Zn(le,r.C.transparent,xe),De,Be,Qe,ct,null,null,null,[ge._globeTileDebugTextBuffer])}function ci(p,n,l,y){In(p,0,n+l/2,p.transform.width,l,y)}function Bn(p,n,l,y){In(p,n-l/2,0,l,p.transform.height,y)}function In(p,n,l,y,b,T){const M=p.context,D=M.gl;D.enable(D.SCISSOR_TEST),D.scissor(n*r.e.devicePixelRatio,l*r.e.devicePixelRatio,y*r.e.devicePixelRatio,b*r.e.devicePixelRatio),M.clear({color:T}),D.disable(D.SCISSOR_TEST)}const Hs=r.c7([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ql}=Hs;function sn(p,n,l,y){p.emplaceBack(n,l,y)}class Jl{constructor(n){this.vertexArray=new r.c8,this.indices=new r.bu,sn(this.vertexArray,-1,-1,1),sn(this.vertexArray,1,-1,1),sn(this.vertexArray,-1,1,1),sn(this.vertexArray,1,1,1),sn(this.vertexArray,-1,-1,-1),sn(this.vertexArray,1,-1,-1),sn(this.vertexArray,-1,1,-1),sn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Ql),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=r.b.simpleSegment(0,0,36,12)}}function Ta(p,n,l,y,b,T){const M=p.context.gl,D=n.paint.get("sky-atmosphere-color"),F=n.paint.get("sky-atmosphere-halo-color"),V=n.paint.get("sky-atmosphere-sun-intensity"),X=((ie,le,ue,me,ge)=>({u_matrix_3f:ie,u_sun_direction:le,u_sun_intensity:ue,u_color_tint_r:[me.r,me.g,me.b,me.a],u_color_tint_m:[ge.r,ge.g,ge.b,ge.a],u_luminance:5e-5}))(r.bC.fromMat4(r.bC.create(),y),b,V,D,F);M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+T,n.skyboxTexture,0),l.draw(p,M.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.unblended,r.af.frontCW,X,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const ec=r.c7([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class As{constructor(n){const l=new r.c9;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const y=new r.bu;y.emplaceBack(0,1,2),y.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(l,ec.members),this.indexBuffer=n.createIndexBuffer(y),this.segments=r.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const no=r.c7([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Zd{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class tc{constructor(n){this.colorModeAlphaBlendedWriteRGB=new r.a([r.ca,r.cb,r.ca,r.cb],r.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new r.a([r.ca,r.cc,r.ca,r.cc],r.C.transparent,[!1,!1,!1,!0]),this.params=new Zd,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(n){const l=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new As(l);const y=this.params.sizeRange,b=this.params.intensityRange,T=function(X){const ie=r.cf(30),le=[];for(let ue=0;ue<X;++ue){const me=2*Math.PI*ie(),ge=Math.acos(1-2*ie())-.5*Math.PI;le.push(r._.fromValues(Math.cos(ge)*Math.cos(me),Math.cos(ge)*Math.sin(me),Math.sin(ge)))}return le}(this.params.starsCount),M=r.cf(300),D=new r.cd,F=new r.bu;let V=0;for(let X=0;X<T.length;++X){const ie=r._.scale([],T[X],200),le=Math.max(0,1+.01*y*(1*M()-.5)),ue=Math.max(0,1+.01*b*(1*M()-.5));D.emplaceBack(ie[0],ie[1],ie[2],-1,-1,le,ue),D.emplaceBack(ie[0],ie[1],ie[2],1,-1,le,ue),D.emplaceBack(ie[0],ie[1],ie[2],1,1,le,ue),D.emplaceBack(ie[0],ie[1],ie[2],-1,1,le,ue),F.emplaceBack(V+0,V+1,V+2),F.emplaceBack(V+0,V+2,V+3),V+=4}this.starsVx=l.createVertexBuffer(D,no.members),this.starsIdx=l.createIndexBuffer(F),this.starsSegments=r.b.simpleSegment(0,0,D.length,F.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,l){const y=n.context,b=y.gl,T=n.transform,M=new r.ae(b.LEQUAL,r.ae.ReadOnly,[0,1]),D=r.a1(T.zoom),F=n.style.getLut(l.scope),V=l.properties.get("color").toRenderColor(F).toArray01(),X=l.properties.get("high-color").toRenderColor(F).toArray01(),ie=l.properties.get("space-color").toRenderColor(F).toArray01PremultipliedAlpha(),le=5e-4,ue=r.ce(l.properties.get("horizon-blend"),0,1,le,.25),me=r.ba(n,y,T)&&ue===le?T.worldSize/(2*Math.PI*1.025)-1:T.globeRadius,ge=n.frameCounter/1e3%1,_e=r._.length(T.globeCenterInViewSpace),ye=Math.sqrt(Math.pow(_e,2)-Math.pow(me,2)),Pe=Math.acos(ye/_e),De=ke=>{const qe=T.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ke&&qe.push("ALPHA_PASS");const Ve=n.getOrCreateProgram("globeAtmosphere",{defines:qe}),Ze=((Be,Qe,ct,it,$e,ft,Pt,Dt,Lt,ot,gt,Tt)=>({u_frustum_tl:Be,u_frustum_tr:Qe,u_frustum_br:ct,u_frustum_bl:it,u_horizon:$e,u_transition:ft,u_fadeout_range:Pt,u_color:Dt,u_high_color:Lt,u_space_color:ot,u_temporal_offset:gt,u_horizon_angle:Tt}))(T.frustumCorners.TL,T.frustumCorners.TR,T.frustumCorners.BR,T.frustumCorners.BL,T.frustumCorners.horizon,D,ue,V,X,ie,ge,Pe);n.uploadCommonUniforms(y,Ve);const xe=this.atmosphereBuffer;xe&&Ve.draw(n,b.TRIANGLES,M,r.ag.disabled,ke?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,r.af.backCW,Ze,ke?"atmosphere_glow_alpha":"atmosphere_glow",xe.vertexBuffer,xe.indexBuffer,xe.segments)};De(!1),De(!0)}drawStars(n,l){const y=r.at(l.properties.get("star-intensity"),0,1);if(y===0)return;const b=n.context,T=b.gl,M=n.transform,D=n.getOrCreateProgram("stars"),F=r.av.identity([]);r.av.rotateX(F,F,-M._pitch),r.av.rotateZ(F,F,-M.angle),r.av.rotateX(F,F,r.ab(M._center.lat)),r.av.rotateY(F,F,-r.ab(M._center.lng));const V=r.ad.fromQuat(new Float32Array(16),F),X=r.ad.multiply([],M.starsProjMatrix,V),ie=r.bC.fromMat4([],V),le=r.bC.invert([],ie),ue=[0,1,0];r._.transformMat3(ue,ue,le),r._.scale(ue,ue,this.params.sizeMultiplier);const me=[1,0,0];r._.transformMat3(me,me,le),r._.scale(me,me,this.params.sizeMultiplier);const ge=(_e=ue,ye=me,Pe=y,{u_matrix:Float32Array.from(X),u_up:_e,u_right:ye,u_intensity_multiplier:Pe});var _e,ye,Pe;n.uploadCommonUniforms(b,D),this.starsVx&&this.starsIdx&&D.draw(n,T.TRIANGLES,r.ae.disabled,r.ag.disabled,this.colorModeAlphaBlendedWriteRGB,r.af.disabled,ge,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function ou(p,n){const l=[...p],y=n.cameraWorldSizeForFog/n.worldSize,b=r.ad.identity([]);return r.ad.scale(b,b,[y,y,1]),r.ad.multiply(l,b,l),r.ad.multiply(l,n.worldToFogMatrix,l),l}function Al(p,n,l,y,b){const T=l.material,M=y.context,{baseColorTexture:D,metallicRoughnessTexture:F}=T.pbrMetallicRoughness,{normalTexture:V,occlusionTexture:X,emissionTexture:ie}=T;function le(ue,me,ge){if(ue&&(p.push(me),M.activeTexture.set(M.gl.TEXTURE0+ge),ue.gfxTexture)){const{minFilter:_e,magFilter:ye,wrapS:Pe,wrapT:De}=ue.sampler;ue.gfxTexture.bindExtraParam(_e,ye,Pe,De)}}le(D,"HAS_TEXTURE_u_baseColorTexture",Ir.BaseColor),le(F,"HAS_TEXTURE_u_metallicRoughnessTexture",Ir.MetallicRoughness),le(V,"HAS_TEXTURE_u_normalTexture",Ir.Normal),le(X,"HAS_TEXTURE_u_occlusionTexture",Ir.Occlusion),le(ie,"HAS_TEXTURE_u_emissionTexture",Ir.Emission),b&&(b.texture||(b.texture=new r.ch(y.context,b.image,[b.image.height,b.image.height,b.image.height],M.gl.RGBA)),M.activeTexture.set(M.gl.TEXTURE0+Ir.LUT),b.texture&&b.texture.bind(M.gl.LINEAR,M.gl.CLAMP_TO_EDGE),p.push("APPLY_LUT_ON_GPU")),l.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(l.texcoordBuffer)),l.colorBuffer&&(p.push(l.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(l.colorBuffer)),l.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(l.normalBuffer)),l.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(l.pbrBuffer)),T.alphaMode!=="OPAQUE"&&T.alphaMode!=="MASK"||p.push("UNPREMULT_TEXTURE_IN_SHADER"),T.defined||p.push("DIFFUSE_SHADED"),p.push("USE_STANDARD_DERIVATIVES")}function ic(p,n,l,y,b,T){const M=l.paint.get("model-opacity"),D=n.context,F=new r.ae(n.context.gl.LEQUAL,r.ae.ReadWrite,n.depthRangeFor3D),V=n.transform,X=p.mesh,ie=X.material,le=ie.pbrMetallicRoughness,ue=n.style.fog;let me;me=n.transform.projection.zAxisUnit==="pixels"?[...p.nodeModelMatrix]:r.ad.multiply([],y.zScaleMatrix,p.nodeModelMatrix),r.ad.multiply(me,y.negCameraPosMatrix,me);const ge=r.ad.invert([],me);r.ad.transpose(ge,ge);const _e=l.paint.get("model-emissive-strength").constantOr(0),ye=Et(new Float32Array(p.worldViewProjection),new Float32Array(me),new Float32Array(ge),null,n,M,le.baseColorFactor.toRenderColor(null),ie.emissiveFactor,le.metallicFactor,le.roughnessFactor,ie,_e,l),Pe={defines:[]},De=[];Al(Pe.defines,De,X,n,l.lut);const ke=n.shadowRenderer;ke&&(ke.useNormalOffset=!1);let qe=null;if(ue){const xe=ou(p.nodeModelMatrix,n.transform);if(qe=new Float32Array(xe),V.projection.name!=="globe"){const Be=X.aabb.min,Qe=X.aabb.max,[ct,it]=ue.getOpacityForBounds(xe,Be[0],Be[1],Qe[0],Qe[1]);Pe.overrideFog=ct>=Xi||it>=Xi}}const Ve=Rr(n,l.paint.get("model-cutoff-fade-range"));Ve.shouldRenderCutoff&&Pe.defines.push("RENDER_CUTOFF");const Ze=n.getOrCreateProgram("model",Pe);n.uploadCommonUniforms(D,Ze,null,qe,Ve),n.renderPass!=="shadow"&&ke&&ke.setupShadowsFromMatrix(p.nodeModelMatrix,Ze),Ze.draw(n,D.gl.TRIANGLES,F,b,T,X.material.doubleSided?r.af.disabled:r.af.backCCW,ye,l.id,X.vertexBuffer,X.indexBuffer,X.segments,l.paint,n.transform.zoom,void 0,De)}function Is(p,n,l,y,b,T,M){let D;D=p.projection.name==="globe"?r.ci(l,p):[...l],r.ad.multiply(D,D,n.matrix);const F=r.ad.multiply([],y,D);if(n.meshes)for(const V of n.meshes){if(V.material.alphaMode!=="BLEND"){M.push({mesh:V,depth:0,modelIndex:b,worldViewProjection:F,nodeModelMatrix:D});continue}const X=r._.transformMat4([],V.centroid,F);X[2]>0&&T.push({mesh:V,depth:X[2],modelIndex:b,worldViewProjection:F,nodeModelMatrix:D})}if(n.children)for(const V of n.children)Is(p,V,l,y,b,T,M)}function vo(p,n,l,y){const b=l.shadowRenderer;if(!b)return;const T=b.getShadowPassDepthMode(),M=b.getShadowPassColorMode(),D=b.calculateShadowPassMatrixFromMatrix(n),F=Rt(D);l.getOrCreateProgram("modelDepth",{defines:l._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(l,l.context.gl.TRIANGLES,T,r.ag.disabled,M,r.af.backCCW,F,y.id,p.vertexBuffer,p.indexBuffer,p.segments,y.paint,l.transform.zoom,void 0,void 0)}function pr(p,n,l){const y=n.updateZoomBasedPaintProperties(),b=function(T,M,D){let F,V,X,ie=T.terrain?T.terrain.exaggeration():0;if(T.terrain&&ie>0){const le=T.terrain,ue=le.findDEMTileFor(D);ue&&ue.dem?F=r.ck.create(le,D,ue):ie=0}if(ie===0&&(M.terrainElevationMin=0,M.terrainElevationMax=0),ie===M.validForExaggeration&&(ie===0||F&&F._demTile&&F._demTile.tileID===M.validForDEMTile.id&&F._dem._timestamp===M.validForDEMTile.timestamp))return!1;for(const le in M.instancesPerModel){const ue=M.instancesPerModel[le];for(let me=0;me<ue.instancedDataArray.length;++me){const ge=(F?ie*F.getElevationAt(0|ue.instancedDataArray.float32[16*me],0|ue.instancedDataArray.float32[16*me+1],!0,!0):0)+ue.instancesEvaluatedElevation[me];ue.instancedDataArray.float32[16*me+6]=ge,V=V?Math.min(M.terrainElevationMin,ge):ge,X=X?Math.max(M.terrainElevationMax,ge):ge}}return M.terrainElevationMin=V||0,M.terrainElevationMax=X||0,M.validForExaggeration=ie,M.validForDEMTile=F&&F._demTile?{id:F._demTile.tileID,timestamp:F._dem._timestamp}:{id:void 0,timestamp:0},!0}(p,n,l);(y||b)&&(n.uploaded=!1,n.upload(p.context))}const ra={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.b6([0,0,0],[r.a3,r.a3,0])};function nc(p,n){const l=1<<p.canonical.z,y=n.getFreeCameraOptions().position,b=n.elevation,T=p.canonical.x/l,M=(p.canonical.x+1)/l,D=p.canonical.y/l,F=(p.canonical.y+1)/l;let V=n._centerAltitude;if(b){const ue=b.getMinMaxForTile(p);ue&&ue.max>V&&(V=ue.max)}const X=r.at(y.x,T,M)-y.x,ie=r.at(y.y,D,F)-y.y,le=r.ax(V,n.center.lat)-y.z;return n._zoomFromMercatorZ(Math.sqrt(X*X+ie*ie+le*le))}function lo(p,n,l,y,b,T,M){const D=p.context,F=p.renderPass==="shadow",V=p.shadowRenderer,X=F&&V?V.getShadowPassDepthMode():new r.ae(D.gl.LEQUAL,r.ae.ReadWrite,p.depthRangeFor3D),ie=p.isTileAffectedByFog(T);if(l.meshes)for(const le of l.meshes){const ue=["MODEL_POSITION_ON_GPU"],me=[];let ge,_e,ye;y.instancedDataArray.length>20&&ue.push("INSTANCED_ARRAYS");const Pe=Rr(p,n.paint.get("model-cutoff-fade-range"));if(Pe.shouldRenderCutoff&&ue.push("RENDER_CUTOFF"),F&&V)ge=p.getOrCreateProgram("modelDepth",{defines:ue}),_e=Rt(M.shadowTileMatrix,M.shadowTileMatrix,Float32Array.from(l.matrix)),ye=V.getShadowPassColorMode();else{Al(ue,me,le,p,n.lut),ge=p.getOrCreateProgram("model",{defines:ue,overrideFog:ie});const ke=le.material,qe=ke.pbrMetallicRoughness,Ve=n.paint.get("model-opacity"),Ze=n.paint.get("model-emissive-strength").constantOr(0);_e=Et(T.expandedProjMatrix,Float32Array.from(l.matrix),new Float32Array(16),null,p,Ve,qe.baseColorFactor.toRenderColor(null),ke.emissiveFactor,qe.metallicFactor,qe.roughnessFactor,ke,Ze,n,b),V&&(M.shadowUniformsInitialized?ge.setShadowUniformValues(D,V.getShadowUniformValues()):(V.setupShadows(T.toUnwrapped(),ge,"model-tile",T.overscaledZ),M.shadowUniformsInitialized=!0)),ye=Pe.shouldRenderCutoff||Ve<1||ke.alphaMode!=="OPAQUE"?r.a.alphaBlended:r.a.unblended}p.uploadCommonUniforms(D,ge,T.toUnwrapped(),null,Pe);const De=le.material.doubleSided?r.af.disabled:r.af.backCCW;if(y.instancedDataArray.length>20)me.push(y.instancedDataBuffer),ge.draw(p,D.gl.TRIANGLES,X,r.ag.disabled,ye,De,_e,n.id,le.vertexBuffer,le.indexBuffer,le.segments,n.paint,p.transform.zoom,void 0,me,y.instancedDataArray.length);else{const ke=F?"u_instance":"u_normal_matrix";for(let qe=0;qe<y.instancedDataArray.length;++qe)_e[ke]=new Float32Array(y.instancedDataArray.arrayBuffer,64*qe,16),ge.draw(p,D.gl.TRIANGLES,X,r.ag.disabled,ye,De,_e,n.id,le.vertexBuffer,le.indexBuffer,le.segments,n.paint,p.transform.zoom,void 0,me)}}if(l.children)for(const le of l.children)lo(p,n,le,y,b,T,M)}const oa=[1,-1,1];function Ha(p,n,l,y){if(!l.modelManager)return!0;const b=l.modelManager;if(!l.shadowRenderer)return!0;const T=l.shadowRenderer,M=n.aabb;let D=!0,F=p.maxHeight;if(F===0){let X=0;for(const ie in p.instancesPerModel){const le=b.getModel(ie,y);le?X=Math.max(X,Math.max(Math.max(le.aabb.max[0],le.aabb.max[1]),le.aabb.max[2])):D=!1}F=p.maxScale*X*1.41+p.maxVerticalOffset,D&&(p.maxHeight=F)}M.max[2]=F,M.min[2]+=p.terrainElevationMin,M.max[2]+=p.terrainElevationMax,r._.transformMat4(M.min,M.min,n.tileMatrix),r._.transformMat4(M.max,M.max,n.tileMatrix);const V=M.intersects(T.getCurrentCascadeFrustum());return l.currentShadowCascade===0&&(p.isInsideFirstShadowMapFrustum=V===2),V===0}function Io(p,n){const l=p.uniformValues.u_cutoff_params[0],y=p.uniformValues.u_cutoff_params[1],b=p.uniformValues.u_cutoff_params[2],T=p.uniformValues.u_cutoff_params[3];return y===l||T===b?1:r.at(((n-l)/(y-l)-b)/(T-b),0,1)}function eh(p,n,l,y){if(n.pitch<20)return 1;const b=n.getWorldToCameraMatrix(),T=r.ad.multiply([],b,p),M=[...l.min,1];let D=r.aA.transformMat4([],M,T),F=D,V=D;M[1]=l.max[1],D=r.aA.transformMat4([],M,T),F=D[1]<F[1]?D:F,V=D[1]>V[1]?D:V,M[0]=l.max[0],D=r.aA.transformMat4([],M,T),F=D[1]<F[1]?D:F,V=D[1]>V[1]?D:V,M[1]=l.min[1],D=r.aA.transformMat4([],M,T),F=D[1]<F[1]?D:F,V=D[1]>V[1]?D:V;const X=r.at(y[0],0,1),ie=100*n.pixelsPerMeter*r.at(y[1],0,1),le=r.at(y[2],0,1),ue=r._.lerp([],F,V,X),me=Math.tan(.5*n.fovX),ge=-ue[2]*me;if(ie===0)return ue[1]<-Math.abs(ge)?le:1;const _e=(-Math.abs(ge)-ue[1])/ie,ye=(De,ke,qe)=>(1-qe)*De+qe*ke,Pe=r.at(ye(1,le,_e),le,1);return ye(1,Pe,r.at((n.pitch-20)/20,0,1))}class sa{}class rc{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,l,y){{const ie=this._storage.get(l.id);if(ie)return ie.lastUsedFrameIdx=n,ie.buf}const b=y.gl,T=b.getBufferParameter(b.ELEMENT_ARRAY_BUFFER,b.BUFFER_SIZE),M=new ArrayBuffer(T),D=new Int16Array(M);b.getBufferSubData(b.ELEMENT_ARRAY_BUFFER,0,new Int16Array(M));const F=new r.cm;for(let ie=0;ie<T/2;ie+=3){const le=D[ie],ue=D[ie+1],me=D[ie+2];F.emplaceBack(le,ue),F.emplaceBack(ue,me),F.emplaceBack(me,le)}const V=y.bindVertexArrayOES.current,X=new sa;return X.buf=new r.I(y,F),X.lastUsedFrameIdx=n,this._storage.set(l.id,X),y.bindVertexArrayOES.set(V),X.buf}update(n){for(const[l,y]of this._storage)n-y.lastUsedFrameIdx>30&&(y.buf.destroy(),this._storage.delete(l))}destroy(){for(const[n,l]of this._storage)l.buf.destroy(),this._storage.delete(n)}}const oc=r.c7([{type:"Float32",name:"a_offset_xy",components:2}]);class Sa{constructor(n){const l=new r.cn,y=new r.bu;l.emplaceBack(-1,-1),l.emplaceBack(1,-1),l.emplaceBack(1,1),l.emplaceBack(-1,1),y.emplaceBack(0,1,2),y.emplaceBack(0,2,3),this.segments=r.b.simpleSegment(0,0,l.length,y.length),this.vx=n.createVertexBuffer(l,oc.members),this.idx=n.createIndexBuffer(y)}destroy(){this.vx.destroy(),this.idx.destroy()}}const be={symbol:function(p,n,l,y,b){if(p.renderPass!=="translucent")return;const T=r.ag.disabled,M=p.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(V,X,ie,le,ue,me,ge){const _e=X.transform,ye=ue==="map",Pe=me==="map";for(const De of V){const ke=le.getTile(De),qe=ke.getBucket(ie);if(!qe||!qe.text||!qe.text.segments.get().length)continue;const Ve=r.aD(qe.textSizeData,_e.zoom),Ze=wn(De,qe.getProjection(),_e),xe=_e.calculatePixelsToTileUnitsMatrix(ke),Be=Ki(Ze,ke.tileID.canonical,Pe,ye,_e,qe.getProjection(),xe),Qe=qe.hasIconTextFit()&&qe.hasIconData();if(Ve){const ct=Math.pow(2,_e.zoom-ke.tileID.overscaledZ);ys(qe,ye,Pe,ge,r.bO,_e,Be,De,ct,Ve,Qe)}}}(y,p,l,n,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),b);const D=l.paint.get("icon-opacity").constantOr(1)!==0,F=l.paint.get("text-opacity").constantOr(1)!==0;l.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(D||F)?ta(p,n,l,y,T,M):(D&&ta(p,n,l,y,T,M,{onlyIcons:!0}),F&&ta(p,n,l,y,T,M,{onlyText:!0}),function(V,X,ie,le){if(!V.symbolParams.useOcclusionQueries)return;const ue=V.context.gl,me=V.transform,ge=ie.paint,_e=ge.get("icon-occlusion-opacity").constantOr(0),ye=ge.get("text-occlusion-opacity").constantOr(0);if(!ie.hasInitialOcclusionOpacityProperties||_e===1&&ye===1)return;const Pe=me.projection.name==="globe";for(const De of le){const ke=X.getTile(De),qe=ke.getBucket(ie);if(!qe||qe.projection.name==="mercator"&&Pe||qe.fullyClipped)continue;if(qe.projection.name==="globe"){r.w(`Occlusion not supported for globe mode. Layer: ${ie.type}`);continue}const Ve=wn(De,qe.getProjection(),me),Ze=r.ad.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,V.symbolParams.depthOffset,1),xe=r.ad.multiply([],Ze,Ve),Be=V.symbolParams.visualizeOcclusions!=="none"?1:V.symbolParams.occlusionQueryFrameWindow;for(let Qe=0;Qe<qe.symbolInstances.length;Qe++){const ct=qe.symbolInstances.get(Qe),it=V.style.placement.opacities[ct.crossTileID];if(it&&it.isHidden()||(V.frameCounter+Qe)%Be!=0)continue;const $e=ct.tileAnchorX,ft=ct.tileAnchorY,Pt=ct.zOffset;let Dt;if(V.symbolParams.visualizeOcclusions==="none"){const Kt=qe.queries.get(Qe);if(Kt){if(!Kt.isFree()){if(!Kt.isResultAvailable())continue;const Qt=Kt.consumeResult();ct.occlusionState=Qt===0?0:1;continue}Dt=Kt}else Dt=new Bo(V.context),qe.queries.set(Qe,Dt)}const Lt=V.getOrCreateProgram("occlusion"),ot=V.symbolParams.occluderSize,gt=mi(xe,[$e,ft,Pt],[me.width,me.height],[ot,ot],V.symbolParams.visualizeOcclusions==="zPass"?[1,0,0,.8]:[1,.4,.2,.9]);V.terrain&&V.terrain.setupElevationDraw(ke,Lt,{useDepthForOcclusion:!1,labelPlaneMatrixInv:void 0}),V.symbolParams.visualizeOcclusions==="none"&&Dt&&Dt.begin();const Tt=new r.ae(V.symbolParams.visualizeOcclusions==="zPass"?V.context.gl.ALWAYS:V.context.gl.LEQUAL,r.ae.ReadOnly,V.depthRangeFor3D);Lt.draw(V,ue.TRIANGLES,Tt,r.ag.disabled,V.symbolParams.visualizeOcclusions!=="none"?r.a.alphaBlendedNonPremultiplied:r.a.disabled,r.af.disabled,gt,"occlusion",V.occlusionBuffers.vx,V.occlusionBuffers.idx,V.occlusionBuffers.segments),V.symbolParams.visualizeOcclusions==="none"&&Dt&&Dt.end()}}}(p,n,l,y)),n.map.showCollisionBoxes&&(Ss(p,n,l,y,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),Ss(p,n,l,y,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(p,n,l,y){if(p.renderPass!=="translucent")return;const b=l.paint.get("circle-opacity"),T=l.paint.get("circle-stroke-width"),M=l.paint.get("circle-stroke-opacity"),D=l.layout.get("circle-sort-key").constantOr(1)!==void 0,F=l.paint.get("circle-emissive-strength");if(b.constantOr(1)===0&&(T.constantOr(1)===0||M.constantOr(1)===0))return;const V=p.context,X=V.gl,ie=p.transform,le=p.depthModeForSublayer(0,r.ae.ReadOnly),ue=r.ag.disabled,me=p.colorModeForDrapableLayerRenderPass(F),ge=ie.projection.name==="globe",_e=[r.aj(ie.center.lng),r.ak(ie.center.lat)],ye=[];for(let De=0;De<y.length;De++){const ke=y[De],qe=n.getTile(ke),Ve=qe.getBucket(l);if(!Ve||Ve.projection.name!==ie.projection.name)continue;const Ze=Ve.programConfigurations.get(l.id),xe=r.bR(l),Be=p.isTileAffectedByFog(ke);ge&&xe.push("PROJECTION_GLOBE_VIEW"),xe.push("TERRAIN_DEPTH_D24");const Qe=p.getOrCreateProgram("circle",{config:Ze,defines:xe,overrideFog:Be}),ct=Ve.layoutVertexBuffer,it=Ve.globeExtVertexBuffer,$e=Ve.indexBuffer,ft=ie.projection.createInversionMatrix(ie,ke.canonical),Pt={programConfiguration:Ze,program:Qe,layoutVertexBuffer:ct,globeExtVertexBuffer:it,indexBuffer:$e,uniformValues:r.bS(p,ke,qe,ft,_e,l),tile:qe};if(D){const Dt=Ve.segments.get();for(const Lt of Dt)ye.push({segments:new r.b([Lt]),sortKey:Lt.sortKey,state:Pt})}else ye.push({segments:Ve.segments,sortKey:0,state:Pt})}D&&ye.sort((De,ke)=>De.sortKey-ke.sortKey);const Pe={useDepthForOcclusion:ie.depthOcclusionForSymbolsAndCircles};for(const De of ye){const{programConfiguration:ke,program:qe,layoutVertexBuffer:Ve,globeExtVertexBuffer:Ze,indexBuffer:xe,uniformValues:Be,tile:Qe}=De.state,ct=De.segments;p.terrain&&p.terrain.setupElevationDraw(Qe,qe,Pe),p.uploadCommonUniforms(V,qe,Qe.tileID.toUnwrapped()),qe.draw(p,X.TRIANGLES,le,ue,me,r.af.disabled,Be,l.id,Ve,xe,ct,l.paint,ie.zoom,ke,[Ze])}},heatmap:function(p,n,l,y){if(l.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const b=p.context,T=b.gl,M=r.ag.disabled,D=new r.a([T.ONE,T.ONE,T.ONE,T.ONE],r.C.transparent,[!0,!0,!0,!0]);(function(ue,me,ge,_e){const ye=ue.gl,Pe=me.width*_e,De=me.height*_e;ue.activeTexture.set(ye.TEXTURE1),ue.viewport.set([0,0,Pe,De]);let ke=ge.heatmapFbo;if(!ke||ke&&(ke.width!==Pe||ke.height!==De)){ke&&ke.destroy();const qe=ye.createTexture();ye.bindTexture(ye.TEXTURE_2D,qe),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_WRAP_S,ye.CLAMP_TO_EDGE),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_WRAP_T,ye.CLAMP_TO_EDGE),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_MIN_FILTER,ye.LINEAR),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_MAG_FILTER,ye.LINEAR),ke=ge.heatmapFbo=ue.createFramebuffer(Pe,De,!0,null),function(Ve,Ze,xe,Be,Qe,ct){const it=Ve.gl;it.texImage2D(it.TEXTURE_2D,0,Ve.extRenderToTextureHalfFloat?it.RGBA16F:it.RGBA,Qe,ct,0,it.RGBA,Ve.extRenderToTextureHalfFloat?it.HALF_FLOAT:it.UNSIGNED_BYTE,null),Be.colorAttachment.set(xe)}(ue,0,qe,ke,Pe,De)}else ye.bindTexture(ye.TEXTURE_2D,ke.colorAttachment.get()),ue.bindFramebuffer.set(ke.framebuffer)})(b,p,l,p.transform.projection.name==="globe"?.5:.25),b.clear({color:r.C.transparent});const F=p.transform,V=F.projection.name==="globe",X=V?["PROJECTION_GLOBE_VIEW"]:[],ie=V?r.af.frontCCW:r.af.disabled,le=[r.aj(F.center.lng),r.ak(F.center.lat)];for(let ue=0;ue<y.length;ue++){const me=y[ue];if(n.hasRenderableParent(me))continue;const ge=n.getTile(me),_e=ge.getBucket(l);if(!_e||_e.projection.name!==F.projection.name)continue;const ye=p.isTileAffectedByFog(me),Pe=_e.programConfigurations.get(l.id),De=p.getOrCreateProgram("heatmap",{config:Pe,defines:X,overrideFog:ye}),{zoom:ke}=p.transform;p.terrain&&p.terrain.setupElevationDraw(ge,De),p.uploadCommonUniforms(b,De,me.toUnwrapped());const qe=F.projection.createInversionMatrix(F,me.canonical);De.draw(p,T.TRIANGLES,r.ae.disabled,M,D,ie,Te(p,me,ge,qe,le,ke,l.paint.get("heatmap-intensity")),l.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,l.paint,p.transform.zoom,Pe,V?[_e.globeExtVertexBuffer]:null)}b.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(b,T){const M=b.context,D=M.gl,F=T.heatmapFbo;if(!F)return;M.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,F.colorAttachment.get()),M.activeTexture.set(D.TEXTURE1);let V=T.colorRampTexture;V||(V=T.colorRampTexture=new r.T(M,T.colorRamp,D.RGBA)),V.bind(D.LINEAR,D.CLAMP_TO_EDGE),b.getOrCreateProgram("heatmapTexture").draw(b,D.TRIANGLES,r.ae.disabled,r.ag.disabled,b.colorModeForRenderPass(),r.af.disabled,((X,ie,le,ue)=>({u_image:0,u_color_ramp:1,u_opacity:ie.paint.get("heatmap-opacity")}))(0,T),T.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,T.paint,b.transform.zoom)}(p,l))},line:function(p,n,l,y){if(p.renderPass!=="translucent")return;const b=l.paint.get("line-opacity"),T=l.paint.get("line-width");if(b.constantOr(1)===0||T.constantOr(1)===0)return;const M=l.paint.get("line-emissive-strength"),D=l.paint.get("line-occlusion-opacity"),F=p.context,V=F.gl,X=l.layout.get("line-z-offset"),ie=!X.isConstant()||!!X.constantOr(0),le=ie?new r.ae(p.depthOcclusion?V.GREATER:V.LEQUAL,r.ae.ReadOnly,p.depthRangeFor3D):p.depthModeForSublayer(0,r.ae.ReadOnly),ue=p.colorModeForDrapableLayerRenderPass(M),me=p.terrain&&p.terrain.renderingToTexture,ge=me?1:r.e.devicePixelRatio,_e=l.paint.get("line-dasharray"),ye=_e.constantOr(1),Pe=l.layout.get("line-cap"),De=_e.constantOr(null),ke=Pe.constantOr(null),qe=l.paint.get("line-pattern"),Ve=qe.constantOr(1),Ze=qe.constantOr(null),xe=l.paint.get("line-opacity").constantOr(1);let Be=!Ve&&xe!==1||p.depthOcclusion&&D>0&&D<1;const Qe=l.paint.get("line-gradient"),ct=Ve?"linePattern":"line",it=r.bT(l);let $e;if(me&&p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(Be=!1),D!==0&&p.depthOcclusion){const Pt=l.paint._values["line-opacity"];Pt&&Pt.value&&Pt.value.kind==="constant"?$e=Pt.value:r.w(`Occlusion opacity for layer ${l.id} is supported only when line-opacity isn't data-driven.`)}if(ie&&(p.forceTerrainMode=!0),!ie&&D!==0&&p.terrain&&!me)return void r.w(`Occlusion opacity for layer ${l.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const ft=Be&&ie?p.stencilModeFor3D():r.ag.disabled;for(const Pt of y){const Dt=n.getTile(Pt);if(Ve&&!Dt.patternsLoaded())continue;const Lt=Dt.getBucket(l);if(!Lt)continue;p.prepareDrawTile();const ot=Lt.programConfigurations.get(l.id),gt=p.isTileAffectedByFog(Pt),Tt=p.getOrCreateProgram(ct,{config:ot,defines:ie?[...it,"ELEVATED"]:it,overrideFog:gt});if(Ze&&Dt.imageAtlas){const wt=Dt.imageAtlas.patternPositions[Ze.toString()];wt&&ot.setConstantPatternPositions(wt)}if(!Ve&&De&&ke&&Dt.lineAtlas){const wt=Dt.lineAtlas.getDash(De,ke);wt&&ot.setConstantPatternPositions(wt)}let[Kt,Qt]=l.paint.get("line-trim-offset");(ke==="round"||ke==="square")&&Kt!==Qt&&(Kt===0&&(Kt-=1),Qt===1&&(Qt+=1));const ni=me?Pt.projMatrix:null,Jt=Ve?r.bU(p,Dt,l,ni,ge,[Kt,Qt]):r.bV(p,Dt,l,ni,Lt.lineClipsArray.length,ge,[Kt,Qt]);if(Qe){const wt=Lt.gradients[l.id];let hi=wt.texture;if(l.gradientVersion!==wt.version){let dn=256;if(l.stepInterpolant){const ji=n.getSource().maxzoom,Ji=Pt.canonical.z===ji?Math.ceil(1<<p.transform.maxZoom-Pt.canonical.z):1;dn=r.at(r.bW(Lt.maxLineLength/r.a3*1024*Ji),256,F.maxTextureSize)}wt.gradient=r.bX({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:dn,image:wt.gradient||void 0,clips:Lt.lineClipsArray}),wt.texture?wt.texture.update(wt.gradient):wt.texture=new r.T(F,wt.gradient,V.RGBA),wt.version=l.gradientVersion,hi=wt.texture}F.activeTexture.set(V.TEXTURE1),hi.bind(l.stepInterpolant?V.NEAREST:V.LINEAR,V.CLAMP_TO_EDGE)}ye&&(F.activeTexture.set(V.TEXTURE0),Dt.lineAtlasTexture&&Dt.lineAtlasTexture.bind(V.LINEAR,V.REPEAT),ot.updatePaintBuffers()),Ve&&(F.activeTexture.set(V.TEXTURE0),Dt.imageAtlasTexture&&Dt.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),ot.updatePaintBuffers()),ie&&p.terrain.setupElevationDraw(Dt,Tt),p.uploadCommonUniforms(F,Tt,Pt.toUnwrapped());const Wt=wt=>{$e!=null&&($e.value=xe*D),Tt.draw(p,V.TRIANGLES,le,wt,ue,r.af.disabled,Jt,l.id,Lt.layoutVertexBuffer,Lt.indexBuffer,Lt.segments,l.paint,p.transform.zoom,ot,[Lt.layoutVertexBuffer2,Lt.patternVertexBuffer,Lt.zOffsetVertexBuffer]),$e!=null&&($e.value=xe)};if(Be&&!ie){const wt=p.stencilModeForClipping(Pt).ref;wt===0&&me&&F.clear({stencil:0});const hi={func:V.EQUAL,mask:255};Jt.u_alpha_discard_threshold=.8,Wt(new r.ag(hi,wt,255,V.KEEP,V.KEEP,V.INVERT)),Jt.u_alpha_discard_threshold=0,Wt(new r.ag(hi,wt,255,V.KEEP,V.KEEP,V.KEEP))}else Be&&ie&&(Jt.u_alpha_discard_threshold=.001),Wt(ie?ft:p.stencilModeForClipping(Pt))}Be&&(p.resetStencilClippingMasks(),me&&F.clear({stencil:0})),D===0||p.depthOcclusion||me||p.layersWithOcclusionOpacity.push(p.currentLayer),ie&&(p.forceTerrainMode=!1)},fill:function(p,n,l,y){const b=l.paint.get("fill-color"),T=l.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const M=l.paint.get("fill-emissive-strength"),D=p.colorModeForDrapableLayerRenderPass(M),F=l.paint.get("fill-pattern"),V=p.opaquePassEnabledForLayer()&&!F.constantOr(1)&&b.constantOr(r.C.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===V){const X=p.depthModeForSublayer(1,p.renderPass==="opaque"?r.ae.ReadWrite:r.ae.ReadOnly);Tl(p,n,l,y,X,D,!1)}if(p.renderPass==="translucent"&&l.paint.get("fill-antialias")){const X=p.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,r.ae.ReadOnly);Tl(p,n,l,y,X,D,!0)}},"fill-extrusion":function(p,n,l,y){const b=l.paint.get("fill-extrusion-opacity"),T=p.context,M=T.gl,D=p.terrain,F=D&&D.renderingToTexture;if(b===0)return;const V=p.conflationActive&&p.style.isLayerClipped(l,n.getSource()),X=p.style.order.indexOf(l.fqid);if(V&&function(ie,le,ue,me,ge){for(const _e of me){const ye=le.getTile(_e).getBucket(ue);ye&&(ye.updateReplacement(_e,ie.replacementSource,ge),ye.uploadCentroid(ie.context))}}(p,n,l,y,X),D||V)for(const ie of y){const le=n.getTile(ie).getBucket(l);le&&Bh(p.context,n,ie,le,l,D,V)}if(p.renderPass==="shadow"&&p.shadowRenderer){const ie=p.shadowRenderer;if(D&&b<.65&&l._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.Z)return;const le=ie.getShadowPassDepthMode(),ue=ie.getShadowPassColorMode();vs(p,n,l,y,le,r.ag.disabled,ue,V)}else if(p.renderPass==="translucent"){const ie=!l.paint.get("fill-extrusion-pattern").constantOr(1),le=l.paint.get("fill-extrusion-color").constantOr(r.C.white);if(!F&&le.a!==0){const ue=new r.ae(p.context.gl.LEQUAL,r.ae.ReadWrite,p.depthRangeFor3D);b===1&&ie?vs(p,n,l,y,ue,r.ag.disabled,r.a.unblended,V):(vs(p,n,l,y,ue,r.ag.disabled,r.a.disabled,V),vs(p,n,l,y,ue,p.stencilModeFor3D(),p.colorModeForRenderPass(),V),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&ie&&(!D&&p.transform.projection.name!=="globe"||F)){const ue=l.paint.get("fill-extrusion-opacity"),me=l.paint.get("fill-extrusion-ambient-occlusion-intensity"),ge=l.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),_e=l.paint.get("fill-extrusion-flood-light-intensity"),ye=l.paint.get("fill-extrusion-flood-light-color").toRenderColor(l.lut).toArray01().slice(0,3),Pe=me>0&&ge>0,De=_e>0,ke=(Ve,Ze,xe)=>(1-xe)*Ve+xe*Ze,qe=Ve=>{const Ze=p.depthModeForSublayer(1,r.ae.ReadOnly,M.LEQUAL,!0),xe=l.paint.get(Ve?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Be=ke(.1,3,xe),Qe=p._showOverdrawInspector;if(!Qe){const ct=new r.ag({func:M.ALWAYS,mask:255},255,255,M.KEEP,M.KEEP,M.REPLACE),it=new r.a([M.ONE,M.ONE,M.ONE,M.ONE],r.C.transparent,[!1,!1,!1,!0],M.MIN);qa(p,n,l,y,Ze,ct,it,r.af.disabled,Ve,"sdf",ue,me,ge,_e,ye,Be,V,!1)}{const ct=Qe?r.ag.disabled:new r.ag({func:M.EQUAL,mask:255},255,255,M.KEEP,M.DECR,M.DECR),it=Qe?p.colorModeForRenderPass():new r.a([M.ONE_MINUS_DST_ALPHA,M.DST_ALPHA,M.ONE,M.ONE],r.C.transparent,[!0,!0,!0,!0]);qa(p,n,l,y,Ze,ct,it,r.af.disabled,Ve,"color",ue,me,ge,_e,ye,Be,V,!1)}};if(F){const Ve=(Ze,xe,Be)=>{const Qe=p.depthModeForSublayer(1,r.ae.ReadOnly,M.LEQUAL,!1),ct=l.paint.get(Ze?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),it=ke(.1,3,ct);{const $e=new r.a([M.ONE,M.ONE,M.ONE,M.ONE],r.C.transparent,[!1,!1,!1,!0]);qa(p,n,l,y,Qe,r.ag.disabled,$e,r.af.disabled,Ze,"clear",ue,me,ge,_e,ye,it,V,xe)}{const $e=new r.ag({func:M.ALWAYS,mask:255},255,255,M.KEEP,M.KEEP,M.REPLACE),ft=new r.a([M.ONE,M.ONE,M.ONE,M.ONE],r.C.transparent,[!1,!1,!1,!0],M.MIN);qa(p,n,l,y,Qe,$e,ft,r.af.disabled,Ze,"sdf",ue,me,ge,_e,ye,it,V,xe)}{const $e=Ze?M.ZERO:M.ONE_MINUS_DST_ALPHA,ft=new r.ag({func:M.EQUAL,mask:255},255,255,M.KEEP,M.DECR,M.DECR),Pt=new r.a([$e,M.DST_ALPHA,M.ONE_MINUS_DST_ALPHA,M.ZERO],r.C.transparent,[!0,!0,!0,!0]);qa(p,n,l,y,Qe,ft,Pt,r.af.disabled,Ze,"color",ue,me,ge,_e,ye,it,V,xe)}{const $e=new r.a([M.ONE,M.ONE,M.ONE,Ze?M.ZERO:M.ONE],r.C.transparent,[!1,!1,!1,!0],Ze?M.FUNC_ADD:M.MAX);qa(p,n,l,y,Qe,r.ag.disabled,$e,r.af.disabled,Ze,"clear",ue,me,ge,_e,ye,it,V,xe,Be)}};if(Pe||De){let Ze;if(p.prepareDrawTile(),D){const xe=D.drapeBufferSize[0],Be=D.drapeBufferSize[1];Ze=D.framebufferCopyTexture,Ze&&(!Ze||Ze.size[0]===xe&&Ze.size[1]===Be)||(Ze&&Ze.destroy(),Ze=D.framebufferCopyTexture=new r.T(T,new r.i({width:xe,height:Be}),M.RGBA)),Ze.bind(M.LINEAR,M.CLAMP_TO_EDGE),M.copyTexImage2D(M.TEXTURE_2D,0,M.RGBA,0,0,xe,Be,0)}Pe&&Ve(!0,!1,Ze),De&&Ve(!1,!0,Ze)}}else Pe&&qe(!0),De&&qe(!1)}}},hillshade:function(p,n,l,y){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent"||p.style.disableElevatedTerrain)return;const b=p.context,T=p.terrain&&p.terrain.renderingToTexture,[M,D]=p.renderPass!=="translucent"||T?[{},y]:p.stencilConfigForOverlap(y);for(const F of D){const V=n.getTile(F);if(V.needsHillshadePrepare&&p.renderPass==="offscreen")hn(p,V,l);else if(p.renderPass==="translucent"){const X=p.depthModeForSublayer(0,r.ae.ReadOnly),ie=l.paint.get("hillshade-emissive-strength"),le=p.colorModeForDrapableLayerRenderPass(ie),ue=T&&p.terrain?p.terrain.stencilModeForRTTOverlap(F):M[F.overscaledZ];en(p,F,V,l,X,ue,le)}}b.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,n,l,y,b,T){if(p.renderPass!=="translucent"||l.paint.get("raster-opacity")===0)return;const M=p.transform.projection.name==="globe",D=l.paint.get("raster-elevation")!==0,F=D&&M;if(p.renderElevatedRasterBackface&&!F)return;const V=p.context,X=V.gl,ie=n.getSource(),le=function(Ve,Ze,xe,Be){const Qe=Ze.paint.get("raster-color"),ct=Ve.type==="raster-array",it=[],$e=Ze.paint.get("raster-resampling"),ft=Ze.paint.get("raster-color-mix");let Pt=Ze.paint.get("raster-color-range");const Dt=[ft[0],ft[1],ft[2],0],Lt=ft[3];let ot=$e==="nearest"?Be.NEAREST:Be.LINEAR;if(ct&&(it.push("RASTER_ARRAY"),Qe||it.push("RASTER_COLOR"),$e==="linear"&&it.push("RASTER_ARRAY_LINEAR"),ot=Be.NEAREST,!Pt&&Ve.rasterLayers)){const gt=Ve.rasterLayers.find(({id:Tt})=>Tt===Ze.sourceLayer);gt&&gt.fields&&gt.fields.range&&(Pt=gt.fields.range)}if(Pt=Pt||[0,1],Qe){it.push("RASTER_COLOR"),xe.activeTexture.set(Be.TEXTURE2),Ze.updateColorRamp(Pt);let gt=Ze.colorRampTexture;gt||(gt=Ze.colorRampTexture=new r.T(xe,Ze.colorRamp,Be.RGBA)),gt.bind(Be.LINEAR,Be.CLAMP_TO_EDGE)}return{mix:Dt,range:Pt,offset:Lt,defines:it,resampling:ot}}(ie,l,V,X);if(ie instanceof r.bm&&!y.length&&!M)return;const ue=l.paint.get("raster-emissive-strength"),me=p.colorModeForDrapableLayerRenderPass(ue),ge=p.terrain&&p.terrain.renderingToTexture,_e=!p.options.moving,ye=l.paint.get("raster-resampling")==="nearest"?X.NEAREST:X.LINEAR;if(ie instanceof r.bm&&!y.length&&(ie.onNorthPole||ie.onSouthPole)){const Ve=D?p.stencilModeFor3D():r.ag.disabled;return void Sl(!!ie.onNorthPole,null,p,n,l,ue,le,r.af.disabled,Ve)}if(!y.length)return;const[Pe,De]=ie instanceof r.bm||ge?[{},y]:p.stencilConfigForOverlap(y),ke=De[De.length-1].overscaledZ;F&&le.defines.push("PROJECTION_GLOBE_VIEW"),D&&le.defines.push("RENDER_CUTOFF");const qe=(Ve,Ze,xe)=>{for(const Be of Ve){const Qe=Be.toUnwrapped(),ct=n.getTile(Be);if(ge&&(!ct||!ct.hasData()))continue;V.activeTexture.set(X.TEXTURE0);const it=kn(ct,ie,l,le);if(!it||!it.texture)continue;const{texture:$e,mix:ft,offset:Pt,tileSize:Dt,buffer:Lt}=it;let ot,gt;ge?(ot=r.ae.disabled,gt=Be.projMatrix):D?(ot=new r.ae(X.LEQUAL,r.ae.ReadWrite,p.depthRangeFor3D),gt=M?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix(Qe,_e)):(ot=p.depthModeForSublayer(Be.overscaledZ-ke,l.paint.get("raster-opacity")===1?r.ae.ReadWrite:r.ae.ReadOnly,X.LESS),gt=p.transform.calculateProjMatrix(Qe,_e));const Tt=p.terrain&&ge?p.terrain.stencilModeForRTTOverlap(Be):Pe[Be.overscaledZ],Kt=T?0:l.paint.get("raster-fade-duration");ct.registerFadeDuration(Kt);const Qt=n.findLoadedParent(Be,0),ni=rl(ct,Qt,n,p.transform,Kt);let Jt,Wt;p.terrain&&p.terrain.prepareDrawTile(),V.activeTexture.set(X.TEXTURE0),$e.bind(ye,X.CLAMP_TO_EDGE),V.activeTexture.set(X.TEXTURE1),Qt?(Qt.texture&&Qt.texture.bind(ye,X.CLAMP_TO_EDGE),Jt=Math.pow(2,Qt.tileID.overscaledZ-ct.tileID.overscaledZ),Wt=[ct.tileID.canonical.x*Jt%1,ct.tileID.canonical.y*Jt%1]):$e.bind(ye,X.CLAMP_TO_EDGE),$e.useMipmap&&V.extTextureFilterAnisotropic&&p.transform.pitch>20&&X.texParameterf(X.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax);const wt=p.transform;let hi;const dn=D?Mc(wt):[0,0,0,0];let ji,Ji,Cn,Sr,vn,$i=0;if(F&&ie instanceof r.bm&&ie.coordinates.length>3)ji=Float32Array.from(r.bf(r.bg(new r.aO(0,0,0)))),Ji=Float32Array.from(wt.globeMatrix),Cn=Float32Array.from(r.bb(wt)),Sr=[r.aj(wt.center.lng),r.ak(wt.center.lat)],hi=ie.elevatedGlobePerspectiveTransform,vn=ie.elevatedGlobeGridMatrix||new Float32Array(9);else if(F){const rn=r.bc(Be.canonical);$i=r.bd(rn.getCenter().lat),ji=Float32Array.from(r.bf(r.bg(Be.canonical))),Ji=Float32Array.from(wt.globeMatrix),Cn=Float32Array.from(r.bb(wt)),Sr=[r.aj(wt.center.lng),r.ak(wt.center.lat)],hi=[0,0],vn=Float32Array.from(r.be(Be.canonical,rn,$i,wt.worldSize/wt._pixelsPerMercatorPixel))}else hi=ie instanceof r.bm?ie.perspectiveTransform:[0,0],ji=new Float32Array(16),Ji=new Float32Array(9),Cn=new Float32Array(16),Sr=[0,0],vn=new Float32Array(9);const mr=v(gt,ji,Ji,Cn,vn,Wt||[0,0],r.a1(p.transform.zoom),Sr,dn,Jt||1,ni,l,hi,D?l.paint.get("raster-elevation"):0,2,ft,Pt,le.range,Dt,Lt,ue),Qn=p.isTileAffectedByFog(Be),En=p.getOrCreateProgram("raster",{defines:le.defines,overrideFog:Qn});if(p.uploadCommonUniforms(V,En,Qe),ie instanceof r.bm){const rn=ie.elevatedGlobeVertexBuffer,vr=ie.elevatedGlobeIndexBuffer;if(ge||!M)ie.boundsBuffer&&ie.boundsSegments&&En.draw(p,X.TRIANGLES,ot,r.ag.disabled,me,r.af.disabled,mr,l.id,ie.boundsBuffer,p.quadTriangleIndexBuffer,ie.boundsSegments);else if(rn&&vr){const ro=wt.zoom<=r.b1?ie.elevatedGlobeSegments:ie.getSegmentsForLongitude(wt.center.lng);ro&&En.draw(p,X.TRIANGLES,ot,r.ag.disabled,me,Ze,mr,l.id,rn,vr,ro)}}else if(F){ot=new r.ae(X.LEQUAL,r.ae.ReadOnly,p.depthRangeFor3D);const rn=p.globeSharedBuffers;if(rn){const[vr,ro,or]=rn.getGridBuffers($i,!1);En.draw(p,X.TRIANGLES,ot,xe||Tt,p.colorModeForRenderPass(),Ze,mr,l.id,vr,ro,or)}}else{const{tileBoundsBuffer:rn,tileBoundsIndexBuffer:vr,tileBoundsSegments:ro}=p.getTileBoundsBuffers(ct);En.draw(p,X.TRIANGLES,ot,Tt,me,r.af.disabled,mr,l.id,rn,vr,ro)}}if(!(ie instanceof r.bm)&&F)for(const Be of Ve){const Qe=Be.canonical.y===(1<<Be.canonical.z)-1;Be.canonical.y===0&&Sl(!0,Be,p,n,l,ue,le,Ze,xe||r.ag.disabled),Qe&&Sl(!1,Be,p,n,l,ue,le,Ze===r.af.frontCW?r.af.backCW:r.af.frontCW,xe||r.ag.disabled)}};F?qe(De,p.renderElevatedRasterBackface?r.af.backCW:r.af.frontCW,p.stencilModeFor3D()):qe(De,r.af.disabled,void 0),p.resetStencilClippingMasks()},"raster-particle":function(p,n,l,y,b,T){p.renderPass==="offscreen"&&function(M,D,F,V){if(!V.length)return;const X=M.context,ie=X.gl,le=D.getSource();if(!(le instanceof za))return;const ue=Math.ceil(Math.sqrt(F.paint.get("raster-particle-count")));let me=F.particlePositionRGBAImage;if(!me||me.width!==ue){const De=function(ke){const qe=ke*ke,Ve=new Uint8Array(4*qe),Ze=function(Be){return Be|=0,Be=Math.imul(2747636419^Be,2654435769),Be=Math.imul(Be^Be>>>16,2654435769),((Be=Math.imul(Be^Be>>>16,2654435769))>>>0)/4294967296},xe=1/1.1;for(let Be=0;Be<qe;Be++){const Qe=xe*(Ze(2*Be+0)+I),ct=xe*(Ze(2*Be+1)+I),it=255*Qe%1,$e=255*ct%1,ft=it,Pt=ct-$e/255,Dt=$e;Ve[4*Be+0]=255*(Qe-it/255),Ve[4*Be+1]=255*ft,Ve[4*Be+2]=255*Pt,Ve[4*Be+3]=255*Dt}return Ve}(ue);me=F.particlePositionRGBAImage=new r.i({width:ue,height:ue},De)}let ge=F.particleFramebuffer;ge?ge.width!==ue&&(ge.destroy(),ge=F.particleFramebuffer=X.createFramebuffer(ue,ue,!0,null)):ge=F.particleFramebuffer=X.createFramebuffer(ue,ue,!0,null);const _e=[];for(const De of V){const ke=D.getTile(De);if(!(ke instanceof r.c3))continue;const qe=$d(ke,le,F);if(!qe)continue;const Ve=[ke.tileSize,ke.tileSize];let Ze=F.tileFramebuffer;Ze||(Ze=F.tileFramebuffer=X.createFramebuffer(Ve[0],Ve[1],!0,null));let xe=ke.rasterParticleState;xe||(xe=ke.rasterParticleState=new er(X,De,Ve,me));const Be=xe.update(F.lastInvalidatedAt);xe.particleTextureDimension!==ue&&xe.updateParticleTexture(De,me);const Qe=xe.targetColorTexture;xe.targetColorTexture=xe.backgroundColorTexture,xe.backgroundColorTexture=Qe;const ct=xe.particleTexture0;xe.particleTexture0=xe.particleTexture1,xe.particleTexture1=ct,_e.push([De,qe,xe,Be])}if(_e.length===0)return;const ye=r.e.now(),Pe=F.previousDrawTimestamp?.001*(ye-F.previousDrawTimestamp):.0167;if(F.previousDrawTimestamp=ye,F.hasColorMap()){X.activeTexture.set(ie.TEXTURE0+2);let De=F.colorRampTexture;De||(De=F.colorRampTexture=new r.T(X,F.colorRamp,ie.RGBA)),De.bind(ie.LINEAR,ie.CLAMP_TO_EDGE)}X.bindFramebuffer.set(F.tileFramebuffer.framebuffer),function(De,ke,qe){const Ve=De.context,Ze=Ve.gl,xe=ke.tileFramebuffer;Ve.activeTexture.set(Ze.TEXTURE0);const Be={u_texture:0,u_opacity:1.05*(ct=ke.paint.get("raster-particle-fade-opacity-factor"))/(ct+.05)},Qe=De.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ct;for(const it of qe){const[,,$e,ft]=it;xe.colorAttachment.set($e.targetColorTexture.texture),Ve.viewport.set([0,0,xe.width,xe.height]),Ve.clear({color:r.C.transparent}),ft&&($e.backgroundColorTexture.bind(Ze.NEAREST,Ze.CLAMP_TO_EDGE),Qe.draw(De,Ze.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.alphaBlended,r.af.disabled,Be,ke.id,De.viewportBuffer,De.quadTriangleIndexBuffer,De.viewportSegments))}}(M,F,_e),function(De,ke,qe,Ve){const Ze=De.context,xe=Ze.gl,Be=qe.tileFramebuffer,Qe=De.transform.projection.name==="globe",ct=qe.paint.get("raster-particle-max-speed");for(const it of Ve){const[$e,ft,Pt]=it;Ze.activeTexture.set(xe.TEXTURE0+0),ft.texture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),Be.colorAttachment.set(Pt.targetColorTexture.texture);const Dt=De.getOrCreateProgram("rasterParticleDraw",{defines:ft.defines,overrideFog:!1});Ze.activeTexture.set(xe.TEXTURE0+1);const Lt=ft.scalarData?[]:[0,1,2,3].map(Tt=>r.bZ[Tt]($e));Lt.push($e);const ot=$e.canonical.x,gt=$e.canonical.y;for(const Tt of Lt){const Kt=ke.getTile(Qe?Tt.wrapped():Tt);if(!Kt)continue;const Qt=Kt.rasterParticleState;if(!Qt)continue;const ni=Tt.canonical.x+(1<<Tt.canonical.z)*(Tt.wrap-$e.wrap),Jt=Tt.canonical.y;Qt.particleTexture0.bind(xe.NEAREST,xe.CLAMP_TO_EDGE);const Wt=k(1,Qt.particleTexture0.size[0],[ni-ot,Jt-gt],0,ft.texture.size,2,ct,ft.textureOffset,ft.scale,ft.offset);Dt.draw(De,xe.POINTS,r.ae.disabled,r.ag.disabled,r.a.alphaBlended,r.af.disabled,Wt,qe.id,Qt.particleIndexBuffer,void 0,Qt.particleSegment)}}}(M,D,F,_e),X.bindFramebuffer.set(F.particleFramebuffer.framebuffer),function(De,ke,qe,Ve){const Ze=De.context,xe=Ze.gl,Be=ke.paint.get("raster-particle-max-speed"),Qe=Ve*ke.paint.get("raster-particle-speed-factor")*.15,ct=function($e){return Math.pow($e,6)}(.01+1*ke.paint.get("raster-particle-reset-rate-factor")),it=ke.particleFramebuffer;Ze.viewport.set([0,0,it.width,it.height]);for(const $e of qe){const[,ft,Pt]=$e;Ze.activeTexture.set(xe.TEXTURE0+0),ft.texture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),Ze.activeTexture.set(xe.TEXTURE0+1);const Dt=Pt.particleTexture0;Dt.bind(xe.NEAREST,xe.CLAMP_TO_EDGE);const Lt=j(1,Dt.size[0],0,ft.texture.size,Be,Qe,ct,ft.textureOffset,ft.scale,ft.offset);it.colorAttachment.set(Pt.particleTexture1.texture),Ze.clear({color:r.C.transparent}),De.getOrCreateProgram("rasterParticleUpdate",{defines:ft.defines}).draw(De,xe.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.unblended,r.af.disabled,Lt,ke.id,De.viewportBuffer,De.quadTriangleIndexBuffer,De.viewportSegments)}}(M,F,_e,Pe)}(p,n,l,y),p.renderPass==="translucent"&&(function(M,D,F,V,X){const ie=M.context,le=ie.gl,ue=!M.options.moving,me=M.transform.projection.name==="globe";if(!V.length)return;const[ge,_e]=M.stencilConfigForOverlap(V),ye=[];me&&ye.push("PROJECTION_GLOBE_VIEW");const Pe=M.stencilModeFor3D();for(const De of _e){const ke=De.toUnwrapped(),qe=D.getTile(De);if(!qe.rasterParticleState)continue;const Ve=qe.rasterParticleState,Ze=100;qe.registerFadeDuration(Ze);const xe=D.findLoadedParent(De,0),Be=rl(qe,xe,D,M.transform,Ze);let Qe,ct;M.terrain&&M.terrain.prepareDrawTile(),ie.activeTexture.set(le.TEXTURE0),Ve.targetColorTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),ie.activeTexture.set(le.TEXTURE1),xe&&xe.rasterParticleState?(xe.rasterParticleState.targetColorTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),Qe=Math.pow(2,xe.tileID.overscaledZ-qe.tileID.overscaledZ),ct=[qe.tileID.canonical.x*Qe%1,qe.tileID.canonical.y*Qe%1]):Ve.targetColorTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE);const it=me?Float32Array.from(M.transform.expandedFarZProjMatrix):M.transform.calculateProjMatrix(ke,ue),$e=M.transform,ft=Fi($e),Pt=r.bc(De.canonical),Dt=r.bd(Pt.getCenter().lat);let Lt,ot,gt,Tt,Kt;me?(Lt=Float32Array.from(r.bf(r.bg(De.canonical))),ot=Float32Array.from($e.globeMatrix),gt=Float32Array.from(r.bb($e)),Tt=[r.aj($e.center.lng),r.ak($e.center.lat)],Kt=Float32Array.from(r.be(De.canonical,Pt,Dt,$e.worldSize/$e._pixelsPerMercatorPixel))):(Lt=new Float32Array(16),ot=new Float32Array(9),gt=new Float32Array(16),Tt=[0,0],Kt=new Float32Array(9));const Qt=L(it,Lt,ot,gt,Kt,ct||[0,0],r.a1(M.transform.zoom),Tt,ft,Qe||1,Be,250),ni=M.isTileAffectedByFog(De),Jt=M.getOrCreateProgram("rasterParticle",{defines:ye,overrideFog:ni});if(M.uploadCommonUniforms(ie,Jt,ke),me){const Wt=new r.ae(le.LEQUAL,r.ae.ReadWrite,M.depthRangeFor3D),wt=0,hi=M.globeSharedBuffers;if(hi){const[dn,ji,Ji]=hi.getGridBuffers(Dt,wt!==0);Jt.draw(M,le.TRIANGLES,Wt,Pe,r.a.alphaBlended,r.af.backCCW,Qt,F.id,dn,ji,Ji)}}else{const Wt=M.depthModeForSublayer(0,r.ae.ReadOnly),wt=ge[De.overscaledZ],{tileBoundsBuffer:hi,tileBoundsIndexBuffer:dn,tileBoundsSegments:ji}=M.getTileBoundsBuffers(qe);Jt.draw(M,le.TRIANGLES,Wt,wt,r.a.alphaBlended,r.af.disabled,Qt,F.id,hi,dn,ji)}}M.resetStencilClippingMasks()}(p,n,l,y),p.style.map.triggerRepaint())},background:function(p,n,l,y){const b=l.paint.get("background-color"),T=l.paint.get("background-opacity"),M=l.paint.get("background-emissive-strength");if(T===0)return;const D=p.context,F=D.gl,V=p.transform,X=V.tileSize,ie=l.paint.get("background-pattern");let le;if(ie!==void 0&&(ie===null||(le=p.imageManager.getPattern(ie.toString(),l.scope,p.style.getLut(l.scope)),!le)))return;const ue=!ie&&b.a===1&&T===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==ue)return;const me=r.ag.disabled,ge=p.depthModeForSublayer(0,ue==="opaque"?r.ae.ReadWrite:r.ae.ReadOnly),_e=p.colorModeForDrapableLayerRenderPass(M),ye=ie?"backgroundPattern":"background";let Pe,De=y;De||(Pe=p.getBackgroundTiles(),De=Object.values(Pe).map(ke=>ke.tileID)),ie&&(D.activeTexture.set(F.TEXTURE0),p.imageManager.bind(p.context,l.scope));for(const ke of De){const qe=p.isTileAffectedByFog(ke),Ve=p.getOrCreateProgram(ye,{overrideFog:qe}),Ze=ke.toUnwrapped(),xe=y?ke.projMatrix:p.transform.calculateProjMatrix(Ze);p.prepareDrawTile();const Be=n?n.getTile(ke):Pe?Pe[ke.key]:new r.by(ke,X,V.zoom,p),Qe=ie?at(xe,M,T,p,0,l.scope,le,{tileID:ke,tileSize:X}):Ye(xe,M,T,b.toRenderColor(l.lut));p.uploadCommonUniforms(D,Ve,Ze);const{tileBoundsBuffer:ct,tileBoundsIndexBuffer:it,tileBoundsSegments:$e}=p.getTileBoundsBuffers(Be);Ve.draw(p,F.TRIANGLES,ge,me,_e,r.af.disabled,Qe,l.id,ct,it,$e)}},sky:function(p,n,l){const y=p._atmosphere?r.a1(p.transform.zoom):1,b=l.paint.get("sky-opacity")*y;if(b===0)return;const T=p.context,M=l.paint.get("sky-type"),D=new r.ae(T.gl.LEQUAL,r.ae.ReadOnly,[0,1]),F=p.frameCounter/1e3%1;M==="atmosphere"?p.renderPass==="offscreen"?l.needsSkyboxCapture(p)&&(function(V,X,ie,le){const ue=V.context,me=ue.gl;let ge=X.skyboxFbo;if(!ge){ge=X.skyboxFbo=ue.createFramebuffer(32,32,!0,null),X.skyboxGeometry=new Jl(ue),X.skyboxTexture=ue.gl.createTexture(),me.bindTexture(me.TEXTURE_CUBE_MAP,X.skyboxTexture),me.texParameteri(me.TEXTURE_CUBE_MAP,me.TEXTURE_WRAP_S,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_CUBE_MAP,me.TEXTURE_WRAP_T,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_CUBE_MAP,me.TEXTURE_MIN_FILTER,me.LINEAR),me.texParameteri(me.TEXTURE_CUBE_MAP,me.TEXTURE_MAG_FILTER,me.LINEAR);for(let De=0;De<6;++De)me.texImage2D(me.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,me.RGBA,32,32,0,me.RGBA,me.UNSIGNED_BYTE,null)}ue.bindFramebuffer.set(ge.framebuffer),ue.viewport.set([0,0,32,32]);const _e=X.getCenter(V,!0),ye=V.getOrCreateProgram("skyboxCapture"),Pe=new Float64Array(16);r.ad.identity(Pe),r.ad.rotateY(Pe,Pe,.5*-Math.PI),Ta(V,X,ye,Pe,_e,0),r.ad.identity(Pe),r.ad.rotateY(Pe,Pe,.5*Math.PI),Ta(V,X,ye,Pe,_e,1),r.ad.identity(Pe),r.ad.rotateX(Pe,Pe,.5*-Math.PI),Ta(V,X,ye,Pe,_e,2),r.ad.identity(Pe),r.ad.rotateX(Pe,Pe,.5*Math.PI),Ta(V,X,ye,Pe,_e,3),r.ad.identity(Pe),Ta(V,X,ye,Pe,_e,4),r.ad.identity(Pe),r.ad.rotateY(Pe,Pe,Math.PI),Ta(V,X,ye,Pe,_e,5),ue.viewport.set([0,0,V.width,V.height])}(p,l),l.markSkyboxValid(p)):p.renderPass==="sky"&&function(V,X,ie,le,ue){const me=V.context,ge=me.gl,_e=V.transform,ye=V.getOrCreateProgram("skybox");me.activeTexture.set(ge.TEXTURE0),ge.bindTexture(ge.TEXTURE_CUBE_MAP,X.skyboxTexture);const Pe=((De,ke,qe,Ve,Ze)=>({u_matrix:De,u_sun_direction:ke,u_cubemap:0,u_opacity:Ve,u_temporal_offset:Ze}))(_e.skyboxMatrix,X.getCenter(V,!1),0,le,ue);V.uploadCommonUniforms(me,ye),ye.draw(V,ge.TRIANGLES,ie,r.ag.disabled,V.colorModeForRenderPass(),r.af.backCW,Pe,"skybox",X.skyboxGeometry.vertexBuffer,X.skyboxGeometry.indexBuffer,X.skyboxGeometry.segment)}(p,l,D,b,F):M==="gradient"&&p.renderPass==="sky"&&function(V,X,ie,le,ue){const me=V.context,ge=me.gl,_e=V.transform,ye=V.getOrCreateProgram("skyboxGradient");X.skyboxGeometry||(X.skyboxGeometry=new Jl(me)),me.activeTexture.set(ge.TEXTURE0);let Pe=X.colorRampTexture;Pe||(Pe=X.colorRampTexture=new r.T(me,X.colorRamp,ge.RGBA)),Pe.bind(ge.LINEAR,ge.CLAMP_TO_EDGE);const De=((ke,qe,Ve,Ze,xe)=>({u_matrix:ke,u_color_ramp:0,u_center_direction:qe,u_radius:r.ab(Ve),u_opacity:Ze,u_temporal_offset:xe}))(_e.skyboxMatrix,X.getCenter(V,!1),X.paint.get("sky-gradient-radius"),le,ue);V.uploadCommonUniforms(me,ye),ye.draw(V,ge.TRIANGLES,ie,r.ag.disabled,V.colorModeForRenderPass(),r.af.backCW,De,"skyboxGradient",X.skyboxGeometry.vertexBuffer,X.skyboxGeometry.indexBuffer,X.skyboxGeometry.segment)}(p,l,D,b,F)},debug:function(p,n,l,y,b,T){for(let M=0;M<l.length;M++)if(b){const V=new r.C(y.r*.8,y.g*.8,y.b*.8,1);na(p,n,l[M],y,-1,-1,T),na(p,n,l[M],y,-1,1,T),na(p,n,l[M],y,1,1,T),na(p,n,l[M],y,1,-1,T),na(p,n,l[M],V,0,0,T)}else na(p,n,l[M],y,0,0,T)},custom:function(p,n,l,y){const b=p.context,T=l.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&l.isDraped(n)){if(p.renderPass==="offscreen"){const M=T.prerender;if(M){if(p.setCustomLayerDefaults(),b.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){const D=p.transform.pointMerc;M.call(T,b.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),r.a1(p.transform.zoom),[D.x,D.y],p.transform.pixelsPerMeterRatio)}else M.call(T,b.gl,p.transform.customLayerMatrix());b.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){const D=T.renderToTile;if(D){const F=y[0].canonical,V=new r.Y(F.x+y[0].wrap*(1<<F.z),F.y,F.z);b.setDepthMode(r.ae.disabled),b.setStencilMode(r.ag.disabled),b.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),D.call(T,b.gl,V),b.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),b.setColorMode(p.colorModeForRenderPass()),b.setStencilMode(r.ag.disabled);const M=T.renderingMode==="3d"?new r.ae(p.context.gl.LEQUAL,r.ae.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,r.ae.ReadOnly);if(b.setDepthMode(M),p.transform.projection.name==="globe"){const D=p.transform.pointMerc;T.render(b.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),r.a1(p.transform.zoom),[D.x,D.y],p.transform.pixelsPerMeterRatio)}else T.render(b.gl,p.transform.customLayerMatrix());b.setDirty(),p.setBaseState(),b.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,n,l,y){if(p.renderPass==="opaque")return;const b=l.paint.get("model-opacity");if(b===0)return;const T=l.paint.get("model-cast-shadows");if(p.renderPass==="shadow"&&(!T||p.terrain&&b<.65&&l._transitionablePaint._values["model-opacity"].value.expression instanceof r.Z))return;const M=p.shadowRenderer,D=l.paint.get("model-receive-shadows");M&&(M.useNormalOffset=!0,D||(M.enabled=!1));const F=()=>{M&&(M.useNormalOffset=!0,D||(M.enabled=!0))},V=n.getSource();if(p.renderPass==="light-beam"&&V.type!=="batched-model")return;if(V.type==="vector"||V.type==="geojson")return function(ye,Pe,De,ke,qe){const Ve=ye.transform;if(Ve.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${Ve.projection.name} projection is not yet implemented`);const Ze=Ve.getFreeCameraOptions().position;if(!ye.modelManager)return;const xe=ye.modelManager;De.modelManager=xe;const Be=ye.shadowRenderer;if(!De._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Qe=De._unevaluatedLayout._values["model-id"],ct={...De.layout.get("model-id").parameters},it=ye.style.order.indexOf(De.fqid);for(const $e of ke){const ft=Pe.getTile($e).getBucket(De);if(!ft||ft.projection.name!==Ve.projection.name)continue;const Pt=ft.getModelUris();Pt&&!ft.modelsRequested&&(xe.addModelsFromBucket(Pt,qe),ft.modelsRequested=!0);const Dt=nc($e,Ve);ct.zoom=Dt;const Lt=Qe.possiblyEvaluate(ct);if(pr(ye,ft,$e),ra.shadowUniformsInitialized=!1,ra.useSingleShadowCascade=!!Be&&Be.getMaxCascadeForTile($e.toUnwrapped())===0,ye.renderPass==="shadow"&&Be){if(ye.currentShadowCascade===1&&ft.isInsideFirstShadowMapFrustum)continue;const Tt=Ve.calculatePosMatrix($e.toUnwrapped(),Ve.worldSize);if(ra.tileMatrix.set(Tt),ra.shadowTileMatrix=Float32Array.from(Be.calculateShadowPassMatrixFromMatrix(Tt)),ra.aabb.min.fill(0),ra.aabb.max[0]=ra.aabb.max[1]=r.a3,ra.aabb.max[2]=0,Ha(ft,ra,ye,De.scope))continue}const ot=1<<$e.canonical.z,gt=[((Ze.x-$e.wrap)*ot-$e.canonical.x)*r.a3,(Ze.y*ot-$e.canonical.y)*r.a3,Ze.z*ot*r.a3];ye.conflationActive&&Object.keys(ft.instancesPerModel).length>0&&ye.style.isLayerClipped(De,Pe.getSource())&&ft.updateReplacement($e,ye.replacementSource,it)&&(ft.uploaded=!1,ft.upload(ye.context));for(let Tt in ft.instancesPerModel){const Kt=ft.instancesPerModel[Tt];Kt.features.length>0&&(Tt=Lt.evaluate(Kt.features[0].feature,{}));const Qt=xe.getModel(Tt,qe);if(Qt&&Qt.uploaded)for(const ni of Qt.nodes)lo(ye,De,ni,Kt,gt,$e,ra)}}}(p,n,l,y,V.type==="vector"?l.scope:""),void F();if(!V.loaded())return;if(V.type==="batched-model")return function(ye,Pe,De,ke){De.resetLayerRenderingStats(ye);const qe=ye.context,Ve=ye.transform,Ze=ye.style.fog,xe=ye.shadowRenderer;if(Ve.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${Ve.projection.name} projection is not yet implemented`);const Be=ye.transform.getFreeCameraOptions().position,Qe=r._.scale([],[Be.x,Be.y,Be.z],ye.transform.worldSize);r._.negate(Qe,Qe);const ct=r.ad.identity([]),it=r.cg(Ve.center.lat,Ve.zoom),$e=r.ad.fromScaling([],[1,1,1/it]);r.ad.translate(ct,ct,Qe);const ft=De.paint.get("model-opacity"),Pt=new r.ae(qe.gl.LEQUAL,r.ae.ReadWrite,ye.depthRangeFor3D),Dt=new r.ae(qe.gl.LEQUAL,r.ae.ReadOnly,ye.depthRangeFor3D),Lt=new r.b6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ot=ye.renderPass==="shadow",gt=ot&&xe?xe.getCurrentCascadeFrustum():Ve.getFrustum(Ve.scaleZoom(Ve.worldSize)),Tt=De.paint.get("model-front-cutoff"),Kt=Tt[2]<1,Qt=Rr(ye,De.paint.get("model-cutoff-fade-range")),ni=De.getLayerRenderingStats();(function(Jt,Wt,wt,hi){const dn=Jt.terrain?Jt.terrain.exaggeration():0,ji=Jt.transform.zoom;for(const Ji of hi){const Cn=Wt.getTile(Ji).getBucket(wt);Cn&&(Jt.conflationActive&&Cn.updateReplacement(Ji,Jt.replacementSource),Cn.evaluateScale(Jt,wt),Jt.terrain&&dn>0&&Cn.elevationUpdate(Jt.terrain,dn,Ji,wt.source),Cn.needsReEvaluation(Jt,ji,wt)&&Cn.evaluate(wt))}})(ye,Pe,De,ke),function(){let Jt,Wt,wt;Kt?(Jt=ke.length-1,Wt=-1,wt=-1):(Jt=0,Wt=ke.length,wt=1);for(let hi=Jt;hi!==Wt;hi+=wt){const dn=ke[hi],ji=Pe.getTile(dn).getBucket(De);if(!ji||!ji.uploaded)continue;let Ji=!1;xe&&(Ji=xe.getMaxCascadeForTile(dn.toUnwrapped())===0);const Cn=Ve.calculatePosMatrix(dn.toUnwrapped(),Ve.worldSize),Sr=ji.modelTraits,vn=[];for(const $i of ji.getNodesInfo()){if($i.hiddenByReplacement||!$i.node.meshes)continue;const mr=$i.node;let Qn=0;ye.terrain&&mr.elevation&&(Qn=mr.elevation*ye.terrain.exaggeration());const En=$i.evaluatedScale;if(En[0]<=1&&En[1]<=1&&En[2]<=1&&(()=>{const Wn=$i.aabb;return Lt.min=[...Wn.min],Lt.max=[...Wn.max],Lt.min[2]+=Qn,Lt.max[2]+=Qn,r._.transformMat4(Lt.min,Lt.min,Cn),r._.transformMat4(Lt.max,Lt.max,Cn),Lt})().intersects(gt)===0)continue;const rn=[...Cn],vr=mr.anchor?mr.anchor[0]:0,ro=mr.anchor?mr.anchor[1]:0;r.ad.translate(rn,rn,[vr*(En[0]-1),ro*(En[1]-1),Qn]),r._.exactEquals(En,r.cj)||r.ad.scale(rn,rn,En);const or=r.ad.multiply([],rn,mr.matrix),xr=r.ad.multiply([],Ve.expandedFarZProjMatrix,or),It=r.ad.multiply([],Ve.expandedFarZProjMatrix,rn),li=r.aA.transformMat4([],[vr,ro,Qn,1],xr)[2];mr.hidden=!1;let rs=ft;ot||(Kt&&(rs*=eh(rn,Ve,$i.aabb,Tt)),rs*=Io(Qt,li)),rs!==0?vn.push({nodeInfo:$i,depth:li,opacity:rs,wvpForNode:xr,wvpForTile:It,nodeModelMatrix:or,tileModelMatrix:rn}):mr.hidden=!0}ot||vn.sort(($i,mr)=>!Kt||$i.opacity===1&&mr.opacity===1?$i.depth<mr.depth?-1:1:$i.opacity===1?-1:mr.opacity===1?1:$i.depth>mr.depth?-1:1);for(const $i of vn){const mr=$i.nodeInfo,Qn=mr.node;let En=r.ad.multiply([],$e,$i.tileModelMatrix);r.ad.multiply(En,ct,En);const rn=r.ad.invert([],En);r.ad.transpose(rn,rn),r.ad.scale(rn,rn,oa),En=r.ad.multiply(En,En,Qn.matrix);const vr=ye.renderPass==="light-beam",ro=Sr&r.cl.HasMapboxMeshFeatures,or=ro?0:mr.evaluatedRMEA[0][2];for(let xr=0;xr<Qn.meshes.length;++xr){const It=Qn.meshes[xr],li=xr===Qn.lightMeshIndex;let rs=$i.wvpForNode;if(li){if(!vr&&!ye.terrain&&ye.shadowRenderer){ye.currentLayer<ye.firstLightBeamLayer&&(ye.firstLightBeamLayer=ye.currentLayer);continue}rs=$i.wvpForTile}else if(vr)continue;const Wn={defines:[]},lt=[];if(Al(Wn.defines,lt,It,ye,De.lut),ro||Wn.defines.push("DIFFUSE_SHADED"),Ji&&Wn.defines.push("SHADOWS_SINGLE_CASCADE"),ni&&(ot?ni.numRenderedVerticesInShadowPass+=It.vertexArray.length:ni.numRenderedVerticesInTransparentPass+=It.vertexArray.length),ot){vo(It,$i.nodeModelMatrix,ye,De);continue}let Ms=null;if(Ze){const la=ou($i.nodeModelMatrix,ye.transform);if(Ms=new Float32Array(la),Ve.projection.name!=="globe"){const cc=It.aabb.min,uc=It.aabb.max,[hc,cl]=Ze.getOpacityForBounds(la,cc[0],cc[1],uc[0],uc[1]);Wn.overrideFog=hc>=Xi||cl>=Xi}}const xs=It.material;let os;xs.occlusionTexture&&xs.occlusionTexture.offsetScale&&(os=xs.occlusionTexture.offsetScale,Wn.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!ot&&xe&&(xe.useNormalOffset=!!It.normalBuffer);const ws=ye.getOrCreateProgram("model",Wn);!ot&&xe&&xe.setupShadowsFromMatrix($i.tileModelMatrix,ws,xe.useNormalOffset),ye.uploadCommonUniforms(qe,ws,null,Ms);const $a=xs.pbrMetallicRoughness;$a.metallicFactor=.9,$a.roughnessFactor=.5;const Ll=Et(new Float32Array(rs),new Float32Array(En),new Float32Array(rn),new Float32Array(Qn.matrix),ye,$i.opacity,$a.baseColorFactor.toRenderColor(null),xs.emissiveFactor,$a.metallicFactor,$a.roughnessFactor,xs,or,De,[0,0,0],os);!li&&(mr.hasTranslucentParts||$i.opacity<1)&&ws.draw(ye,qe.gl.TRIANGLES,Pt,r.ag.disabled,r.a.disabled,r.af.backCCW,Ll,De.id,It.vertexBuffer,It.indexBuffer,It.segments,De.paint,ye.transform.zoom,void 0,lt),ws.draw(ye,qe.gl.TRIANGLES,li?Dt:Pt,r.ag.disabled,li||$i.opacity<1||mr.hasTranslucentParts?r.a.alphaBlended:r.a.unblended,r.af.backCCW,Ll,De.id,It.vertexBuffer,It.indexBuffer,It.segments,De.paint,ye.transform.zoom,void 0,lt)}}}}()}(p,n,l,y),void F();if(V.type!=="model")return;const X=V.getModels(),ie=[],le=p.transform.getFreeCameraOptions().position,ue=r._.scale([],[le.x,le.y,le.z],p.transform.worldSize);r._.negate(ue,ue);const me=[],ge=[];let _e=0;for(const ye of X){const Pe=l.paint.get("model-rotation").constantOr(null),De=l.paint.get("model-scale").constantOr(null),ke=l.paint.get("model-translation").constantOr(null);ye.computeModelMatrix(p,Pe,De,ke,!0,!0,!1);const qe=r.ad.identity([]),Ve=r.cg(ye.position.lat,p.transform.zoom),Ze=r.ad.fromScaling([],[1,1,1/Ve]);r.ad.translate(qe,qe,ue),ie.push({zScaleMatrix:Ze,negCameraPosMatrix:qe});for(const xe of ye.nodes)Is(p.transform,xe,ye.matrix,p.transform.expandedFarZProjMatrix,_e,me,ge);_e++}if(me.sort((ye,Pe)=>Pe.depth-ye.depth),p.renderPass!=="shadow"){if(b===1)for(const ye of ge)ic(ye,p,l,ie[ye.modelIndex],r.ag.disabled,p.colorModeForRenderPass());else{for(const ye of ge)ic(ye,p,l,ie[ye.modelIndex],r.ag.disabled,r.a.disabled);for(const ye of ge)ic(ye,p,l,ie[ye.modelIndex],p.stencilModeFor3D(),p.colorModeForRenderPass());p.resetStencilClippingMasks()}for(const ye of me)ic(ye,p,l,ie[ye.modelIndex],r.ag.disabled,p.colorModeForRenderPass());F()}else{for(const ye of ge)vo(ye.mesh,ye.nodeModelMatrix,p,l);for(const ye of me)vo(ye.mesh,ye.nodeModelMatrix,p,l);F()}}},Z={model:function(p,n,l){const y=n.getSource();if(!y.loaded())return;if(y.type==="vector"||y.type==="geojson")return void(l.modelManager&&l.modelManager.upload(l,y.type==="vector"?p.scope:""));if(y.type==="batched-model"||y.type!=="model")return;const b=y.getModels();for(const T of b)T.upload(l.context)},raster:function(p,n,l){const y=n.getSource();if(!(y instanceof za&&y.loaded()))return;const b=p.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!b)return;const T=p.paint.get("raster-array-band")||y.getInitialBand(b);if(T==null)return;const M=n.getIds().map(D=>n.getTileByID(D));for(const D of M)D.updateNeeded(b,T)&&y.prepareTile(D,b,T)},"raster-particle":function(p,n,l){const y=n.getSource();if(!(y instanceof za&&y.loaded()))return;const b=p.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!b)return;const T=p.paint.get("raster-particle-array-band")||y.getInitialBand(b);if(T==null)return;const M=n.getIds().map(D=>n.getTileByID(D));for(const D of M)D.updateNeeded(b,T)&&y.prepareTile(D,b,T)}};class oe{constructor(n,l,y,b){this.context=new ko(n,l),this.occlusionBuffers=new Sa(this.context),this.transform=y,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=r.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const T=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const M of T)this._debugParams.enabledLayers[M]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const M of T)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],M);this.symbolParams=new Wo(b),this.setup(),this.numSublayers=r.bv.maxUnderzooming+r.bv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.co,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new gs(this),this._wireframeDebugCache=new rc,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[]}updateTerrain(n,l){const y=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new qs(this,n));const b=this._terrain;this.transform.elevation=y?b:null,b.update(n,this.transform,l),this.transform.elevation&&!b.enabled&&(this.transform.elevation=null)}_updateFog(n){const l=n.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,b]=l.getFovAdjustedRange(this.transform._fov);if(y>b)return void(this.transform.fogCullDistSq=null);const T=y+.78*(b-y);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new qs(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,l){if(this.width=n*r.e.devicePixelRatio,this.height=l*r.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._mergedLayers[y].resize()}setup(){const n=this.context,l=new r.bt;l.emplaceBack(0,0),l.emplaceBack(r.a3,0),l.emplaceBack(0,r.a3),l.emplaceBack(r.a3,r.a3),this.tileExtentBuffer=n.createVertexBuffer(l,r.br.members),this.tileExtentSegments=r.b.simpleSegment(0,0,4,2);const y=new r.bt;y.emplaceBack(0,0),y.emplaceBack(r.a3,0),y.emplaceBack(0,r.a3),y.emplaceBack(r.a3,r.a3),this.debugBuffer=n.createVertexBuffer(y,r.br.members),this.debugSegments=r.b.simpleSegment(0,0,4,5);const b=new r.bt;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(b,r.br.members),this.viewportSegments=r.b.simpleSegment(0,0,4,2);const T=new r.cp;T.emplaceBack(0,0,0,0),T.emplaceBack(r.a3,0,r.a3,0),T.emplaceBack(0,r.a3,0,r.a3),T.emplaceBack(r.a3,r.a3,r.a3,r.a3),this.mercatorBoundsBuffer=n.createVertexBuffer(T,r.cq.members),this.mercatorBoundsSegments=r.b.simpleSegment(0,0,4,2);const M=new r.bu;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(M);const D=new r.cr;for(const V of[0,1,3,2,0])D.emplaceBack(V);this.debugIndexBuffer=n.createIndexBuffer(D),this.emptyTexture=new r.T(n,new r.i({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=r.ad.create();const F=this.context.gl;this.stencilClearMode=new r.ag({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,r.ae.disabled,this.stencilClearMode,r.a.disabled,r.af.disabled,bl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,l,y){if(!l||this.currentStencilSource===l.id||!n.isTileClipped()||!y||y.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let D=!1;for(const F of y)if(this._tileClippingMaskIDs[F.key]===void 0){D=!0;break}if(!D)return}this.currentStencilSource=l.id;const b=this.context,T=b.gl;this.nextStencilID+y.length>256&&this.clearStencil(),b.setColorMode(r.a.disabled),b.setDepthMode(r.ae.disabled);const M=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const D of y){const F=l.getTile(D),V=this._tileClippingMaskIDs[D.key]=this.nextStencilID++,{tileBoundsBuffer:X,tileBoundsIndexBuffer:ie,tileBoundsSegments:le}=this.getTileBoundsBuffers(F);M.draw(this,T.TRIANGLES,r.ae.disabled,new r.ag({func:T.ALWAYS,mask:0},V,255,T.KEEP,T.KEEP,T.REPLACE),r.a.disabled,r.af.disabled,bl(D.projMatrix),"$clipping",X,ie,le)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,l=this.context.gl;return new r.ag({func:l.NOTEQUAL,mask:255},n,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const l=this.context.gl;return new r.ag({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(n){const l=this.context.gl,y=n.sort((M,D)=>D.overscaledZ-M.overscaledZ),b=y[y.length-1].overscaledZ,T=y[0].overscaledZ-b+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const M={};for(let D=0;D<T;D++)M[D+b]=new r.ag({func:l.GEQUAL,mask:255},D+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=T,[M,y]}return[{[b]:r.ag.disabled},y]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new r.a([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new r.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?r.a.unblended:r.a.alphaBlended}colorModeForDrapableLayerRenderPass(n){const l=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&this.renderPass==="translucent"?new r.a([l.ONE,l.ONE_MINUS_SRC_ALPHA,l.CONSTANT_ALPHA,l.ONE_MINUS_SRC_ALPHA],new r.C(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,l,y,b=!1){if(this.depthOcclusion)return new r.ae(this.context.gl.GREATER,r.ae.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!b)return r.ae.disabled;const T=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new r.ae(y||this.context.gl.LEQUAL,l,[T,T])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,l=Math.ceil(this.width),y=Math.ceil(this.height),b=this.context.bindFramebuffer.get(),T=n.getParameter(n.TEXTURE_BINDING_2D);this.terrainDepthFBO&&this.terrainDepthFBO.width===l&&this.terrainDepthFBO.height===y||(this.terrainDepthFBO&&(this.terrainDepthFBO.destroy(),this.terrainDepthFBO=void 0,this.terrainDepthTexture=void 0),l!==0&&y!==0&&(this.terrainDepthFBO=new yr(this.context,l,y,!1,"texture"),this.terrainDepthTexture=new r.T(this.context,{width:l,height:y,data:null},n.DEPTH_STENCIL),this.terrainDepthFBO.depthAttachment.set(this.terrainDepthTexture.texture))),this.context.bindFramebuffer.set(b),n.bindTexture(n.TEXTURE_2D,T),this.terrainDepthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.terrainDepthFBO.framebuffer),n.blitFramebuffer(0,0,l,y,0,0,l,y,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((n,l)=>n+l/this._fpsHistory.length,0))}render(n,l){const y=r.e.now();this._dt=y-this._timeStamp,this._timeStamp=y,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=l;const b=this.style._mergedLayers,T=this.style.order.filter(xe=>{const Be=b[xe];return!(Be.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Be.type]}),M=T.map(xe=>b[xe]),D=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(r.e.now()),this.imageManager.beginFrame();let F=0,V=!1;for(const xe in D){const Be=D[xe];Be.used&&(Be.prepare(this.context),Be.getSource().usedInConflation&&++F)}let X=!1;for(const xe of M)xe.isHidden(this.transform.zoom)||(xe.type==="clip"&&(X=!0),this.prepareLayer(xe));const ie={},le={},ue={},me={},ge={};for(const xe in D){const Be=D[xe];ie[xe]=Be.getVisibleCoordinates(),le[xe]=ie[xe].slice().reverse(),ue[xe]=Be.getVisibleCoordinates(!0).reverse(),me[xe]=Be.getShadowCasterCoordinates(),ge[xe]=Be.sortCoordinatesByDistance(ie[xe])}const _e=xe=>{const Be=this.style.getLayerSourceCache(xe);return Be&&Be.used?Be.getSource():null};if(F||X){const xe=[],Be=[];let Qe=0;for(const ct of M)this.isSourceForClippingOrConflation(ct,_e(ct))&&(xe.push(ct),Be.push(Qe)),Qe++;if(xe&&(X||xe.length>1)){const ct=[];for(let it=0;it<xe.length;it++){const $e=xe[it],ft=Be[it],Pt=this.style.getLayerSourceCache($e);if(!Pt||!Pt.used||!Pt.getSource().usedInConflation&&$e.type!=="clip")continue;let Dt=1/0,Lt=r.cu.None;if($e.type==="clip"){Dt=ft;for(const ot of $e.layout.get("clip-layer-types"))Lt|=ot==="model"?r.cu.Model:ot==="symbol"?r.cu.Symbol:r.cu.FillExtrusion}ct.push({layer:$e.fqid,cache:Pt,order:Dt,clipMask:Lt})}this.replacementSource.setSources(ct),V=!0}}V||this.replacementSource.clear(),this.conflationActive=V,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let xe=0;xe<M.length;xe++){const Be=M[xe],Qe=Be.cutoffRange();if(this.longestCutoffRange=Math.max(Qe,this.longestCutoffRange),Qe>0){const ct=_e(Be);ct&&(this.minCutoffZoom=Math.max(ct.minzoom,this.minCutoffZoom)),Be.minzoom&&(this.minCutoffZoom=Math.max(Be.minzoom,this.minCutoffZoom))}Be.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=xe),this._lastOcclusionLayer=xe)}const ye=this.style&&this.style.fog;ye?(this._fogVisible=ye.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ye.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ue),this.opaquePassCutoff=0);const Pe=this._shadowRenderer;if(Pe){Pe.updateShadowParameters(this.transform,this.style.directionalLight);for(const xe in D)for(const Be of ie[xe]){let Qe={min:0,max:0};this.terrain&&(Qe=this.terrain.getMinMaxForTile(Be)||Qe),Pe.addShadowReceiver(Be.toUnwrapped(),Qe.min,Qe.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.cs(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new tc(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!r.ct(this.context.gl))return;this.renderPass="offscreen";for(const xe of M){const Be=n.getLayerSourceCache(xe);if(!xe.hasOffscreenPass()||xe.isHidden(this.transform.zoom))continue;const Qe=Be?le[Be.id]:void 0;(xe.type==="custom"||xe.type==="raster"||xe.type==="raster-particle"||xe.isSky()||Qe&&Qe.length)&&this.renderLayer(this,Be,xe,Qe)}this.depthRangeFor3D=[0,1-(M.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,me)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const De=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ke=(()=>{if(l.showOverdrawInspector)return r.C.black;const xe=this.style.fog;if(xe&&this.transform.projection.supportsFog){const Be=this.style.getLut(xe.scope);if(!De){const Qe=xe.properties.get("color").toRenderColor(Be).toArray01();return new r.C(...Qe)}if(De){const Qe=xe.properties.get("space-color").toRenderColor(Be).toArray01();return new r.C(...Qe)}}return r.C.transparent})();if(this.context.clear({color:ke,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&De&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=T.length-1;this.currentLayer>=0;this.currentLayer--){const xe=M[this.currentLayer],Be=n.getLayerSourceCache(xe);if(xe.isSky())continue;const Qe=Be?(xe.is3D()?ge:le)[Be.id]:void 0;this._renderTileClippingMasks(xe,Be,Qe),this.renderLayer(this,Be,xe,Qe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&De&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.a1(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<T.length;this.currentLayer++){const xe=M[this.currentLayer],Be=n.getLayerSourceCache(xe);xe.isSky()&&this.renderLayer(this,Be,xe,Be?le[Be.id]:void 0)}function qe(xe,Be){let Qe;return Be&&(Qe=(xe.type==="symbol"?ue:xe.is3D()?ge:le)[Be.id]),Qe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<T.length;){const xe=M[this.currentLayer];if(xe.type==="raster"){const Be=n.getLayerSourceCache(xe);this.renderLayer(this,Be,xe,qe(xe,Be))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ve=0;Pe&&(Ve=Pe.getShadowCastingLayerCount());let Ze=!1;for(;this.currentLayer<T.length;){const xe=M[this.currentLayer],Be=n.getLayerSourceCache(xe);if(xe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(xe)){if(xe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(Ze||!this.terrain||!this.style.hasSymbolLayers()&&!this.style.hasCircleLayers()||this.transform.isOrthographic||(Ze=!0,this.blitDepth()),xe.is3D()||this.terrain||this._renderTileClippingMasks(xe,Be,Be?ie[Be.id]:void 0),this.renderLayer(this,Be,xe,qe(xe,Be)),!this.terrain&&Pe&&Ve>0&&xe.hasShadowPass()&&--Ve==0&&(Pe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Qe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Qe;this.currentLayer++){const ct=M[this.currentLayer];if(!ct.hasLightBeamPass())continue;const it=n.getLayerSourceCache(ct);this.renderLayer(this,it,ct,it?le[it.id]:void 0)}this.currentLayer=Qe,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Qe=this.currentLayer;this.depthOcclusion=!0;for(const ct of this.layersWithOcclusionOpacity){this.currentLayer=ct;const it=M[this.currentLayer],$e=n.getLayerSourceCache(it),ft=$e?le[$e.id]:void 0;it.is3D()||this.terrain||this._renderTileClippingMasks(it,$e,$e?ie[$e.id]:void 0),this.renderLayer(this,$e,it,ft)}this.depthOcclusion=!1,this.currentLayer=Qe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let xe=null;M.forEach(Be=>{const Qe=n.getLayerSourceCache(Be);Qe&&!Be.isHidden(this.transform.zoom)&&Qe.getVisibleCoordinates().length&&(!xe||xe.getSource().maxzoom<Qe.getSource().maxzoom)&&(xe=Qe)}),xe&&this.options.showTileBoundaries&&be.debug(this,xe,xe.getVisibleCoordinates(),r.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&be.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(xe){const Be=xe.transform.padding;ci(xe,xe.transform.height-(Be.top||0),3,Fh),ci(xe,Be.bottom||0,3,Lc),Bn(xe,Be.left||0,3,Qu),Bn(xe,xe.transform.width-(Be.right||0),3,Ea);const Qe=xe.transform.centerPoint;(function(ct,it,$e,ft){In(ct,it-1,$e-10,2,20,ft),In(ct,it-10,$e-1,20,2,ft)})(xe,Qe.x,xe.transform.height-Qe.y,Ju)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),V||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:l}=this.transform.projection,y=!l||!l.includes(n.type);if(Z[n.type]&&(y||this.terrain&&n.type==="custom")){const b=this.style.getLayerSourceCache(n);Z[n.type](n,b,this)}this.gpuTimingEnd()}renderLayer(n,l,y,b){y.isHidden(this.transform.zoom)||(y.type==="background"||y.type==="sky"||y.type==="custom"||y.type==="model"||y.type==="raster"||y.type==="raster-particle"||b&&b.length)&&(this.id=y.id,this.gpuTimingStart(y),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(y.type)&&(!n.terrain||y.type!=="custom")||y.type==="clip"||be[y.type](n,l,y,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery,y=this.context.gl;let b=this.gpuTimers[n.id];b||(b=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:y.createQuery()}),b.calls++,y.beginQuery(l.TIME_ELAPSED_EXT,b.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,l=this.context.gl,y=l.createQuery();this.deferredRenderGpuTimeQueries.push(y),l.beginQuery(n.TIME_ELAPSED_EXT,y)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const l={};for(const y in n){const b=n[y],T=this.context.extTimerQuery,M=T.getQueryParameter(b.query,this.context.gl.QUERY_RESULT)/1e6;T.deleteQueryEXT(b.query),l[y]=M}return l}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery,y=this.context.gl;let b=0;for(const T of n)b+=l.getQueryParameter(T,y.QUERY_RESULT)/1e6,l.deleteQueryEXT(T);return b}translatePosMatrix(n,l,y,b,T){if(!y[0]&&!y[1])return n;const M=T?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(M){const V=Math.sin(M),X=Math.cos(M);y=[y[0]*X-y[1]*V,y[0]*V+y[1]*X]}const D=[T?y[0]:r.bB(l,y[0],this.transform.zoom),T?y[1]:r.bB(l,y[1],this.transform.zoom),0],F=new Float32Array(16);return r.ad.translate(F,n,D),F}saveTileTexture(n){const l=n.size[0],y=this._tileTextures[l];y?y.push(n):this._tileTextures[l]=[n]}getTileTexture(n){const l=this._tileTextures[n];return l&&l.length>0?l.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,l,y){const b=y===void 0?this.terrain&&this.terrain.renderingToTexture:y,T=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(T.push("LIGHTING_3D_MODE"),T.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):b||T.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||T.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?T.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):T.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(T.push("TERRAIN"),this.linearFloatFilteringSupported()&&T.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&T.push("GLOBE"),!this._fogVisible||b||l!==void 0&&!l||T.push("FOG","FOG_DITHERING"),b&&T.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&T.push("OVERDRAW_INSPECTOR"),T}getOrCreateProgram(n,l){this.cache=this.cache||{};const y=l&&l.defines||[],b=l&&l.config,T=this.currentGlobalDefines(n,l&&l.overrideFog,l&&l.overrideRtt).concat(y),M=ns.cacheKey(Us[n],n,T,b);return this.cache[M]||(this.cache[M]=new ns(this.context,n,Us[n],b,gi[n],T)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.terrainDepthFBO&&(this.terrainDepthFBO.destroy(),this.terrainDepthFBO=void 0,this.terrainDepthTexture=void 0)}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,l){if(this.style.enable3dLights()){const y=this.style.directionalLight,b=this.style.ambientLight;if(y&&b){const T=((M,D,F)=>{const V=M.properties.get("direction"),X=M.properties.get("color").toRenderColor(F.getLut(M.scope)).toArray01(),ie=M.properties.get("intensity"),le=D.properties.get("color").toRenderColor(F.getLut(D.scope)).toArray01(),ue=D.properties.get("intensity"),me=[V.x,V.y,V.z],ge=r.bA(le,ue),_e=r.bA(X,ie);return{u_lighting_ambient_color:ge,u_lighting_directional_dir:me,u_lighting_directional_color:_e,u_ground_radiance:tu(me,_e,ge)}})(y,b,this.style);l.setLightsUniformValues(n,T)}}}uploadCommonUniforms(n,l,y,b,T){if(this.uploadCommonLightUniforms(n,l),this.terrain&&this.terrain.renderingToTexture)return;const M=this.style.fog;if(M){const D=M.getOpacity(this.transform.pitch),F=((V,X,ie,le,ue,me,ge,_e,ye,Pe,De,ke)=>{const qe=V.transform,Ve=X.properties.get("color").toRenderColor(V.style.getLut(X.scope)).toArray01();Ve[3]=le;const Ze=V.frameCounter/1e3%1,[xe,Be]=X.properties.get("vertical-range");return{u_fog_matrix:ie?qe.calculateFogTileMatrix(ie):ke||V.identityMat,u_fog_range:X.getFovAdjustedRange(qe._fov),u_fog_color:Ve,u_fog_horizon_blend:X.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(xe,Be),Be],u_fog_temporal_offset:Ze,u_frustum_tl:ue,u_frustum_tr:me,u_frustum_br:ge,u_frustum_bl:_e,u_globe_pos:ye,u_globe_radius:Pe,u_viewport:De,u_globe_transition:r.a1(qe.zoom),u_is_globe:+(qe.projection.name==="globe")}})(this,M,y,D,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.e.devicePixelRatio,this.transform.height*r.e.devicePixelRatio],b);l.setFogUniformValues(n,F)}T&&l.setCutoffUniformValues(n,T.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,l=n.createTexture();return n.bindTexture(n.TEXTURE_2D,l),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,l=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const b of y)l[b.key]=n[b.key]||new r.by(b,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,l){return!(!n.is3D()||n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||n.sourceLayer!=="building")&&n.type!=="clip"&&(!l||l.type!=="batched-model"))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let l=this._cachedTileFogOpacities[n.key];return l||(this._cachedTileFogOpacities[n.key]=l=this.style.fog.getOpacityForTile(n)),l[0]>=Xi||l[1]>=Xi}}class we{constructor(n,l,y,b){this.screenBounds=n,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=y,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(n,l){let y,b;if(n instanceof r.P||typeof n[0]=="number"){const T=r.P.convert(n);y=[T],b=l.isPointAboveHorizon(T)}else{const T=r.P.convert(n[0]),M=r.P.convert(n[1]);y=[T,M],b=r.cv(T,M).every(D=>l.isPointAboveHorizon(D))}return new we(y,l.getCameraPoint(),b,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return r.cv(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const l=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],b=r.cv(l,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<y.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?b[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(b[3]=this.cameraPoint)),r.cw(b,n)}bufferedCameraGeometryGlobe(n){const l=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],b=r.cv(l,y,n),T=this.cameraPoint.clone();switch(3*((T.y>l.y)+(T.y>y.y))+((T.x>l.x)+(T.x>y.x))){case 0:b[0]=T,b[4]=T.clone();break;case 1:b.splice(1,0,T);break;case 2:b[1]=T;break;case 3:b.splice(4,0,T);break;case 5:b.splice(2,0,T);break;case 6:b[3]=T;break;case 7:b.splice(3,0,T);break;case 8:b[2]=T}return b}containsTile(n,l,y,b=0){const T=n.queryPadding/l._pixelsPerMercatorPixel+1,M=y?this._bufferedCameraMercator(T,l):this._bufferedScreenMercator(T,l);let D=n.tileID.wrap+(M.unwrapped?b:0);const F=M.polygon.map(_e=>r.cx(n.tileTransform,_e,D));if(!r.cy(F,0,0,r.a3,r.a3))return;D=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const V=this.screenGeometryMercator.polygon.map(_e=>r.cz(n.tileTransform,_e,D)),X=V.map(_e=>new r.P(_e[0],_e[1])),ie=l.getFreeCameraOptions().position||new r.Y(0,0,0),le=r.cz(n.tileTransform,ie,D),ue=V.map(_e=>{const ye=r._.sub(_e,_e,le);return r._.normalize(ye,ye),new r.aT(le,ye)}),me=r.bB(n,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:X,tilespaceRays:ue,bufferedTilespaceGeometry:F,bufferedTilespaceBounds:(ge=r.cA(F),ge.min.x=r.at(ge.min.x,0,r.a3),ge.min.y=r.at(ge.min.y,0,r.a3),ge.max.x=r.at(ge.max.x,0,r.a3),ge.max.y=r.at(ge.max.y,0,r.a3),ge),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:me};var ge}_bufferedScreenMercator(n,l){const y=Li(n);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{let b;return b=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),l):{polygon:this.bufferedScreenGeometry(n).map(T=>l.pointCoordinate3D(T)),unwrapped:!0},this._screenRaycastCache[y]=b,b}}_bufferedCameraMercator(n,l){const y=Li(n);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{let b;return b=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),l):{polygon:this.bufferedCameraGeometry(n).map(T=>l.pointCoordinate3D(T)),unwrapped:!0},this._cameraRaycastCache[y]=b,b}}_projectAndResample(n,l){const y=function(T,M){const D=r.ad.multiply([],M.pixelMatrix,M.globeMatrix),F=[0,-r.cD,0,1],V=[0,r.cD,0,1],X=[0,0,0,1];r.aA.transformMat4(F,F,D),r.aA.transformMat4(V,V,D),r.aA.transformMat4(X,X,D);const ie=new r.P(F[0]/F[3],F[1]/F[3]),le=new r.P(V[0]/V[3],V[1]/V[3]),ue=r.cB(T,ie)&&F[3]<X[3],me=r.cB(T,le)&&V[3]<X[3];if(!ue&&!me)return null;const ge=function(Ze,xe,Be){for(let Qe=1;Qe<Ze.length;Qe++){const ct=Ft(xe.pointCoordinate3D(Ze[Qe-1]).x),it=Ft(xe.pointCoordinate3D(Ze[Qe]).x);if(Be<0){if(ct<it)return{idx:Qe,t:-ct/(it-1-ct)}}else if(it<ct)return{idx:Qe,t:(1-ct)/(it+1-ct)}}return null}(T,M,ue?-1:1);if(!ge)return null;const{idx:_e,t:ye}=ge;let Pe=_e>1?tt(T.slice(0,_e),M):[],De=_e<T.length?tt(T.slice(_e),M):[];Pe=Pe.map(Ze=>new r.P(Ft(Ze.x),Ze.y)),De=De.map(Ze=>new r.P(Ft(Ze.x),Ze.y));const ke=[...Pe];ke.length===0&&ke.push(De[De.length-1]);const qe=r.a2(ke[ke.length-1].y,(De.length===0?Pe[0]:De[0]).y,ye);let Ve;return Ve=ue?[new r.P(0,qe),new r.P(0,0),new r.P(1,0),new r.P(1,qe)]:[new r.P(1,qe),new r.P(1,1),new r.P(0,1),new r.P(0,qe)],ke.push(...Ve),De.length===0?ke.push(Pe[0]):ke.push(...De),{polygon:ke.map(Ze=>new r.Y(Ze.x,Ze.y)),unwrapped:!1}}(n,l);if(y)return y;const b=function(T,M){let D=!1,F=-1/0,V=0;for(let ie=0;ie<T.length-1;ie++)T[ie].x>F&&(F=T[ie].x,V=ie);for(let ie=0;ie<T.length-1;ie++){const le=(V+ie)%(T.length-1),ue=T[le],me=T[le+1];Math.abs(ue.x-me.x)>.5&&(ue.x<me.x?(ue.x+=1,le===0&&(T[T.length-1].x+=1)):(me.x+=1,le+1===T.length-1&&(T[0].x+=1)),D=!0)}const X=r.aj(M.center.lng);return D&&X<Math.abs(X-1)&&T.forEach(ie=>{ie.x-=1}),{polygon:T,unwrapped:D}}(tt(n,l).map(T=>new r.P(Ft(T.x),T.y)),l);return{polygon:b.polygon.map(T=>new r.Y(T.x,T.y)),unwrapped:b.unwrapped}}}function tt(p,n){return r.cC(p,l=>{const y=n.pointCoordinate3D(l);l.x=y.x,l.y=y.y},1/256)}function Ft(p){return p<0?1+p%1:p%1}function Li(p){return 100*p|0}function zn(p,n){const l=r.ad.identity([]);return r.ad.scale(l,l,[.5*p.width,.5*-p.height,1]),r.ad.translate(l,l,[1,-1,0]),r.ad.multiply(l,l,p.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(l)}function bn(p,n,l,y,b,T,M,D=!1){const F=p.tilesIn(y,M,D);F.sort(sc);const V=[];for(const ie of F)V.push({wrappedTileID:ie.tile.tileID.wrapped().key,queryResults:ie.tile.queryRenderedFeatures(n,l,p._state,ie,b,T,zn(p.transform,ie.tile.tileID),D)});const X=function(ie){const le={},ue={};for(const me of ie){const ge=me.queryResults,_e=me.wrappedTileID,ye=ue[_e]=ue[_e]||{};for(const Pe in ge){const De=ge[Pe],ke=ye[Pe]=ye[Pe]||{},qe=le[Pe]=le[Pe]||[];for(const Ve of De)ke[Ve.featureIndex]||(ke[Ve.featureIndex]=!0,qe.push(Ve))}}return le}(V);for(const ie in X)X[ie].forEach(le=>{const ue=le.feature,me=ue.layer;me&&me.type!=="background"&&me.type!=="sky"&&me.type!=="slot"&&(ue.source=me.source,me["source-layer"]&&(ue.sourceLayer=me["source-layer"]),ue.state=ue.id!==void 0?p.getFeatureState(me["source-layer"],ue.id):{})});return X}function po(p,n){const l=p.getRenderableIds().map(T=>p.getTileByID(T)),y=[],b={};for(let T=0;T<l.length;T++){const M=l[T],D=M.tileID.canonical.key;b[D]||(b[D]=!0,M.querySourceFeatures(y,n))}return y}function sc(p,n){const l=p.tileID,y=n.tileID;return l.overscaledZ-y.overscaledZ||l.canonical.y-y.canonical.y||l.wrap-y.wrap||l.canonical.x-y.canonical.x}class th{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,l=!1;for(const y in this.style._mergedLayers){const b=this.style._mergedLayers[y];if(b.type==="fill-extrusion")this.layers.push({layer:b,visible:n,visibilityChanged:l});else if(b.type==="model"){const T=this.style.getLayerSource(b);T&&T.type==="batched-model"&&this.layers.push({layer:b,visible:n,visibilityChanged:l})}}}onNewFrame(n){this.layersGotHidden=!1;for(const l of this.layers){const y=l.layer;let b=!1;y.type==="fill-extrusion"?b=!y.isHidden(n)&&y.paint.get("fill-extrusion-opacity")>0:y.type==="model"&&(b=!y.isHidden(n)&&y.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!b&&l.visible,l.visible=b}}updateZOffset(n,l){this.currentBuildingBuckets=[];for(const b of this.layers){const T=b.layer,M=this.style.getLayerSourceCache(T);let D=1;T.type==="fill-extrusion"&&(D=b.visible?T.paint.get("fill-extrusion-vertical-scale"):0);let F=M?M.getTile(l):null;if(!F&&M&&l.canonical.z>M.getSource().minzoom){let V=l.scaledTo(Math.min(M.getSource().maxzoom,l.overscaledZ-1));for(;V.overscaledZ>=M.getSource().minzoom&&(F=M.getTile(V),!F&&V.overscaledZ!==0);)V=V.scaledTo(V.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:F?F.getBucket(T):null,tileID:F?F.tileID:l,verticalScale:D})}n.hasAnyZOffset=!1;let y=!1;for(let b=0;b<n.symbolInstances.length;b++){const T=n.symbolInstances.get(b),M=T.zOffset,D=this._getHeightAtTileOffset(l,T.tileAnchorX,T.tileAnchorY);T.zOffset=D!==Number.NEGATIVE_INFINITY?D:M,y||M===T.zOffset||(y=!0),n.hasAnyZOffset||T.zOffset===0||(n.hasAnyZOffset=!0)}y&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,l,y,b){let T=l,M=y;if(n.canonical.z!==b.canonical.z){const D=b.canonical,F=1/(1<<n.canonical.z-D.z);T=(l+n.canonical.x*r.a3)*F-D.x*r.a3|0,M=(y+n.canonical.y*r.a3)*F-D.y*r.a3|0}return{tileX:T,tileY:M}}_getHeightAtTileOffset(n,l,y){let b,T;for(let M=0;M<this.layers.length;++M){if(this.layers[M].layer.type!=="fill-extrusion")continue;const{bucket:D,tileID:F,verticalScale:V}=this.currentBuildingBuckets[M];if(!D)continue;const{tileX:X,tileY:ie}=this._mapCoordToOverlappingTile(n,l,y,F),le=D.getHeightAtTileCoord(X,ie);le&&le.height!==void 0&&(le.hidden?b=le.height:T=Math.max(le.height*V,T||0))}if(T!==void 0)return T;for(let M=0;M<this.layers.length;++M){const D=this.layers[M];if(D.layer.type!=="model"||!D.visible)continue;const{bucket:F,tileID:V}=this.currentBuildingBuckets[M];if(!F)continue;const{tileX:X,tileY:ie}=this._mapCoordToOverlappingTile(n,l,y,V),le=F.getHeightAtTileCoord(X,ie);if(le&&!le.hidden)return le.height===void 0&&b!==void 0?Math.min(le.maxHeight,b)*le.verticalScale:le.height?le.height*le.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ih(p,n){const l={};for(const y in p)y!=="ref"&&(l[y]=p[y]);return r.cE.forEach(y=>{y in n&&(l[y]=n[y])}),l}function Np(p){p=p.slice();const n=Object.create(null);for(let l=0;l<p.length;l++)n[p[l].id]=p[l];for(let l=0;l<p.length;l++)"ref"in p[l]&&(p[l]=ih(p[l],n[p[l].ref]));return p}const Mn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Xd(p,n,l){l.push({command:Mn.addSource,args:[p,n[p]]})}function nh(p,n,l){n.push({command:Mn.removeSource,args:[p]}),l[p]=!0}function ac(p,n,l,y){nh(p,l,y),Xd(p,n,l)}function a0(p,n,l){let y;for(y in p[l])if(p[l].hasOwnProperty(y)&&y!=="data"&&!U(p[l][y],n[l][y]))return!1;for(y in n[l])if(n[l].hasOwnProperty(y)&&y!=="data"&&!U(p[l][y],n[l][y]))return!1;return!0}function zh(p,n,l,y,b,T){let M;for(M in n=n||{},p=p||{})p.hasOwnProperty(M)&&(U(p[M],n[M])||l.push({command:T,args:[y,M,n[M],b]}));for(M in n)n.hasOwnProperty(M)&&!p.hasOwnProperty(M)&&(U(p[M],n[M])||l.push({command:T,args:[y,M,n[M],b]}))}function Vh(p){return p.id}function rh(p,n){return p[n.id]=n,p}class l0{constructor(n,l){this.reset(n,l)}reset(n,l){this.points=n||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=r.at(n,0,1);let l=1,y=this._distances[l];const b=n*this.paddedLength+this.padding;for(;y<b&&l<this._distances.length;)y=this._distances[++l];const T=l-1,M=this._distances[T],D=y-M,F=D>0?(b-M)/D:0;return this.points[T].mult(1-F).add(this.points[l].mult(F))}}class Uh{constructor(n,l,y){const b=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(n/y),this.yCellCount=Math.ceil(l/y);for(let M=0;M<this.xCellCount*this.yCellCount;M++)b.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=l,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,l,y,b,T){this._forEachCell(l,y,b,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(l),this.bboxes.push(y),this.bboxes.push(b),this.bboxes.push(T)}insertCircle(n,l,y,b){this._forEachCell(l-b,y-b,l+b,y+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(l),this.circles.push(y),this.circles.push(b)}_insertBoxCell(n,l,y,b,T,M){this.boxCells[T].push(M)}_insertCircleCell(n,l,y,b,T,M){this.circleCells[T].push(M)}_query(n,l,y,b,T,M){if(y<0||n>this.width||b<0||l>this.height)return!T&&[];const D=[];if(n<=0&&l<=0&&this.width<=y&&this.height<=b){if(T)return!0;for(let F=0;F<this.boxKeys.length;F++)D.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const V=this.circles[3*F],X=this.circles[3*F+1],ie=this.circles[3*F+2];D.push({key:this.circleKeys[F],x1:V-ie,y1:X-ie,x2:V+ie,y2:X+ie})}return M?D.filter(M):D}return this._forEachCell(n,l,y,b,this._queryCell,D,{hitTest:T,seenUids:{box:{},circle:{}}},M),T?D.length>0:D}_queryCircle(n,l,y,b,T){const M=n-y,D=n+y,F=l-y,V=l+y;if(D<0||M>this.width||V<0||F>this.height)return!b&&[];const X=[];return this._forEachCell(M,F,D,V,this._queryCellCircle,X,{hitTest:b,circle:{x:n,y:l,radius:y},seenUids:{box:{},circle:{}}},T),b?X.length>0:X}query(n,l,y,b,T){return this._query(n,l,y,b,!1,T)}hitTest(n,l,y,b,T){return this._query(n,l,y,b,!0,T)}hitTestCircle(n,l,y,b){return this._queryCircle(n,l,y,!0,b)}_queryCell(n,l,y,b,T,M,D,F){const V=D.seenUids,X=this.boxCells[T];if(X!==null){const le=this.bboxes;for(const ue of X)if(!V.box[ue]){V.box[ue]=!0;const me=4*ue;if(n<=le[me+2]&&l<=le[me+3]&&y>=le[me+0]&&b>=le[me+1]&&(!F||F(this.boxKeys[ue]))){if(D.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[ue],x1:le[me],y1:le[me+1],x2:le[me+2],y2:le[me+3]})}}}const ie=this.circleCells[T];if(ie!==null){const le=this.circles;for(const ue of ie)if(!V.circle[ue]){V.circle[ue]=!0;const me=3*ue;if(this._circleAndRectCollide(le[me],le[me+1],le[me+2],n,l,y,b)&&(!F||F(this.circleKeys[ue]))){if(D.hitTest)return M.push(!0),!0;{const ge=le[me],_e=le[me+1],ye=le[me+2];M.push({key:this.circleKeys[ue],x1:ge-ye,y1:_e-ye,x2:ge+ye,y2:_e+ye})}}}}}_queryCellCircle(n,l,y,b,T,M,D,F){const V=D.circle,X=D.seenUids,ie=this.boxCells[T];if(ie!==null){const ue=this.bboxes;for(const me of ie)if(!X.box[me]){X.box[me]=!0;const ge=4*me;if(this._circleAndRectCollide(V.x,V.y,V.radius,ue[ge+0],ue[ge+1],ue[ge+2],ue[ge+3])&&(!F||F(this.boxKeys[me])))return M.push(!0),!0}}const le=this.circleCells[T];if(le!==null){const ue=this.circles;for(const me of le)if(!X.circle[me]){X.circle[me]=!0;const ge=3*me;if(this._circlesCollide(ue[ge],ue[ge+1],ue[ge+2],V.x,V.y,V.radius)&&(!F||F(this.circleKeys[me])))return M.push(!0),!0}}}_forEachCell(n,l,y,b,T,M,D,F){const V=this._convertToXCellCoord(n),X=this._convertToYCellCoord(l),ie=this._convertToXCellCoord(y),le=this._convertToYCellCoord(b);for(let ue=V;ue<=ie;ue++)for(let me=X;me<=le;me++)if(T.call(this,n,l,y,b,this.xCellCount*me+ue,M,D,F))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,l,y,b,T,M){const D=b-n,F=T-l,V=y+M;return V*V>D*D+F*F}_circleAndRectCollide(n,l,y,b,T,M,D){const F=(M-b)/2,V=Math.abs(n-(b+F));if(V>F+y)return!1;const X=(D-T)/2,ie=Math.abs(l-(T+X));if(ie>X+y)return!1;if(V<=F||ie<=X)return!0;const le=V-F,ue=ie-X;return le*le+ue*ue<=y*y}}const Ga=100;class Fp{constructor(n,l,y=new Uh(n.width+200,n.height+200,25),b=new Uh(n.width+200,n.height+200,25)){this.transform=n,this.grid=y,this.ignoredGrid=b,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Ga,this.screenBottomBoundary=n.height+Ga,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=l}placeCollisionBox(n,l,y,b,T,M,D,F){let V=y.projectedAnchorX,X=y.projectedAnchorY,ie=y.projectedAnchorZ;const le=y.elevation,ue=y.tileID,me=n.getProjection();if(le&&ue){const[Ve,Ze,xe]=me.upVector(ue.canonical,y.tileAnchorX,y.tileAnchorY),Be=me.upVectorScale(ue.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;V+=Ve*le*Be,X+=Ze*le*Be,ie+=xe*le*Be}const ge=this.projectAndGetPerspectiveRatio(D,V,X,ie,y.tileID,me.name==="globe"||!!le||this.transform.pitch>0,me),_e=M*ge.perspectiveRatio,ye=(y.x1*l+b.x-y.padding)*_e+ge.point.x,Pe=(y.y1*l+b.y-y.padding)*_e+ge.point.y,De=(y.x2*l+b.x+y.padding)*_e+ge.point.x,ke=(y.y2*l+b.y+y.padding)*_e+ge.point.y,qe=ge.perspectiveRatio<=.55||ge.occluded;return!this.isInsideGrid(ye,Pe,De,ke)||!T&&this.grid.hitTest(ye,Pe,De,ke,F)||qe?{box:[],offscreen:!1,occluded:ge.occluded}:{box:[ye,Pe,De,ke],offscreen:this.isOffscreen(ye,Pe,De,ke),occluded:!1}}placeCollisionCircles(n,l,y,b,T,M,D,F,V,X,ie,le,ue,me,ge){const _e=[],ye=this.transform.elevation,Pe=n.getProjection(),De=ye?ye.getAtTileOffsetFunc(ge,this.transform.center.lat,this.transform.worldSize,Pe):null,ke=new r.P(y.tileAnchorX,y.tileAnchorY);let{x:qe,y:Ve,z:Ze}=Pe.projectTilePoint(ke.x,ke.y,ge.canonical);if(De){const[Lt,ot,gt]=De(ke);qe+=Lt,Ve+=ot,Ze+=gt}const xe=Pe.name==="globe",Be=this.projectAndGetPerspectiveRatio(D,qe,Ve,Ze,ge,xe||!!ye||this.transform.pitch>0,Pe),{perspectiveRatio:Qe}=Be,ct=(ie?M/Qe:M*Qe)/r.bN,it=ls(qe,Ve,Ze,F),$e=Be.signedDistanceFromCamera>0?va(ct,T,y.lineOffsetX*ct,y.lineOffsetY*ct,!1,it,ke,y,b,F,{},ye&&!ie?De:null,ie&&!!ye,Pe,ge,ie):null;let ft=!1,Pt=!1,Dt=!0;if($e&&!Be.occluded){const Lt=.5*ue*Qe+me,ot=new r.P(-100,-100),gt=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Tt=new l0,{first:Kt,last:Qt}=$e,ni=Kt.path.length;let Jt=[];for(let hi=ni-1;hi>=1;hi--)Jt.push(Kt.path[hi]);for(let hi=1;hi<Qt.path.length;hi++)Jt.push(Qt.path[hi]);const Wt=2.5*Lt;V&&(Jt=Jt.map(([hi,dn,ji],Ji)=>(De&&!xe&&(ji=De(Ji<ni-1?Kt.tilePath[ni-1-Ji]:Qt.tilePath[Ji-ni+2])[2]),ls(hi,dn,ji,V))),Jt.some(hi=>hi[3]<=0)&&(Jt=[]));let wt=[];if(Jt.length>0){let hi=1/0,dn=-1/0,ji=1/0,Ji=-1/0;for(const Cn of Jt)hi=Math.min(hi,Cn[0]),ji=Math.min(ji,Cn[1]),dn=Math.max(dn,Cn[0]),Ji=Math.max(Ji,Cn[1]);dn>=ot.x&&hi<=gt.x&&Ji>=ot.y&&ji<=gt.y&&(wt=[Jt.map(Cn=>new r.P(Cn[0],Cn[1]))],(hi<ot.x||dn>gt.x||ji<ot.y||Ji>gt.y)&&(wt=r.cF(wt,ot.x,ot.y,gt.x,gt.y)))}for(const hi of wt){Tt.reset(hi,.25*Lt);let dn=0;dn=Tt.length<=.5*Lt?1:Math.ceil(Tt.paddedLength/Wt)+1;for(let ji=0;ji<dn;ji++){const Ji=ji/Math.max(dn-1,1),Cn=Tt.lerp(Ji),Sr=Cn.x+Ga,vn=Cn.y+Ga;_e.push(Sr,vn,Lt,0);const $i=Sr-Lt,mr=vn-Lt,Qn=Sr+Lt,En=vn+Lt;if(Dt=Dt&&this.isOffscreen($i,mr,Qn,En),Pt=Pt||this.isInsideGrid($i,mr,Qn,En),!l&&this.grid.hitTestCircle(Sr,vn,Lt,le)&&(ft=!0,!X))return{circles:[],offscreen:!1,collisionDetected:ft,occluded:!1}}}}return{circles:!X&&ft||!Pt?[]:_e,offscreen:Dt,collisionDetected:ft,occluded:Be.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let y=1/0,b=1/0,T=-1/0,M=-1/0;for(const X of n){const ie=new r.P(X.x+Ga,X.y+Ga);y=Math.min(y,ie.x),b=Math.min(b,ie.y),T=Math.max(T,ie.x),M=Math.max(M,ie.y),l.push(ie)}const D=this.grid.query(y,b,T,M).concat(this.ignoredGrid.query(y,b,T,M)),F={},V={};for(const X of D){const ie=X.key;if(F[ie.bucketInstanceId]===void 0&&(F[ie.bucketInstanceId]={}),F[ie.bucketInstanceId][ie.featureIndex])continue;const le=[new r.P(X.x1,X.y1),new r.P(X.x2,X.y1),new r.P(X.x2,X.y2),new r.P(X.x1,X.y2)];r.cG(l,le)&&(F[ie.bucketInstanceId][ie.featureIndex]=!0,V[ie.bucketInstanceId]===void 0&&(V[ie.bucketInstanceId]=[]),V[ie.bucketInstanceId].push(ie.featureIndex))}return V}insertCollisionBox(n,l,y,b,T){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:b,collisionGroupID:T},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,l,y,b,T){const M=l?this.ignoredGrid:this.grid,D={bucketInstanceId:y,featureIndex:b,collisionGroupID:T};for(let F=0;F<n.length;F+=4)M.insertCircle(D,n[F],n[F+1],n[F+2])}projectAndGetPerspectiveRatio(n,l,y,b,T,M,D){const F=[l,y,b,1];let V=!1;b||this.transform.pitch>0?(r.aA.transformMat4(F,F,n),this.fogState&&T&&D.name!=="globe"&&(V=function(le,ue,me,ge,_e,ye){const Pe=ye.calculateFogTileMatrix(_e),De=[ue,me,ge];return r._.transformMat4(De,De,Pe),tn(le,r._.length(De),ye.pitch,ye._fov)}(this.fogState,l,y,b,T.toUnwrapped(),this.transform)>.9)):Xl(F,F,n);const X=F[3];return{point:new r.P((F[0]/X+1)/2*this.transform.width+Ga,(-F[1]/X+1)/2*this.transform.height+Ga),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(D)/X*.5,1.5),signedDistanceFromCamera:X,occluded:M&&F[2]>X||V}}isOffscreen(n,l,y,b){return y<Ga||n>=this.screenRightBoundary||b<Ga||l>this.screenBottomBoundary}isInsideGrid(n,l,y,b){return y>=0&&n<this.gridRightBoundary&&b>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const n=r.ad.identity([]);return r.ad.translate(n,n,[-100,-100,0]),n}}class Yd{constructor(n,l,y,b){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?l:-l))):b&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class su{constructor(n,l,y,b,T,M=!1){this.text=new Yd(n?n.text:null,l,y,T),this.icon=new Yd(n?n.icon:null,l,b,T),this.clipped=M}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Il{constructor(n,l,y,b=!1){this.text=n,this.icon=l,this.skipFade=y,this.clipped=b}}class jh{constructor(){this.invProjMatrix=r.ad.create(),this.viewportMatrix=r.ad.create(),this.circles=[]}}class zp{constructor(n,l,y,b,T){this.bucketInstanceId=n,this.featureIndex=l,this.sourceLayerIndex=y,this.bucketIndex=b,this.tileID=T}}class Vp{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const l=++this.maxGroupID;this.collisionGroups[n]={ID:l,predicate:y=>y.collisionGroupID===l}}return this.collisionGroups[n]}}function au(p,n,l,y,b){const{horizontalAlign:T,verticalAlign:M}=r.bQ(p),D=-(T-.5)*n,F=-(M-.5)*l,V=r.bP(p,y);return new r.P(D+V[0]*b,F+V[1]*b)}function Oc(p,n,l,y,b){const T=new r.P(p,n);return l&&T._rotate(y?b:-b),T}class Up{constructor(n,l,y,b,T,M){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Fp(this.transform,T),this.buildingIndex=M,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Vp(y),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,l,y,b){const T=y.getBucket(l),M=y.latestFeatureIndex;if(!T||!M||l.fqid!==T.layerIds[0])return;const D=T.layers[0].layout,F=y.collisionBoxArray,V=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),X=y.tileSize/r.a3,ie=y.tileID.toUnwrapped();this.transform.setProjection(T.projection);const le=(ue=y.tileID,me=T.getProjection(),ge=this.transform,me.name===this.projection?ge.calculateProjMatrix(ue.toUnwrapped()):ai(ge,me,ue));var ue,me,ge;const _e=D.get("text-pitch-alignment")==="map",ye=D.get("text-rotation-alignment")==="map";l.compileFilter();const Pe=l.dynamicFilter(),De=l.dynamicFilterNeedsFeature(),ke=this.transform.calculatePixelsToTileUnitsMatrix(y),qe=il(le,y.tileID.canonical,_e,ye,this.transform,T.getProjection(),ke);let Ve=null;if(_e){const Be=Na(le,y.tileID.canonical,_e,ye,this.transform,T.getProjection(),ke);Ve=r.ad.multiply([],this.transform.labelPlaneMatrix,Be)}let Ze=null;Pe&&y.latestFeatureIndex&&(Ze={unwrappedTileID:ie,dynamicFilter:Pe,dynamicFilterNeedsFeature:De,featureIndex:y.latestFeatureIndex}),this.retainedQueryData[T.bucketInstanceId]=new zp(T.bucketInstanceId,M,T.sourceLayerIndex,T.index,y.tileID);const xe={bucket:T,layout:D,posMatrix:le,textLabelPlaneMatrix:qe,labelToScreenMatrix:Ve,clippingData:Ze,scale:V,textPixelRatio:X,holdingForFade:y.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:r.aD(T.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.aD(T.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(b)for(const Be of T.sortKeyRanges){const{sortKey:Qe,symbolInstanceStart:ct,symbolInstanceEnd:it}=Be;n.push({sortKey:Qe,symbolInstanceStart:ct,symbolInstanceEnd:it,parameters:xe})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:xe})}attemptAnchorPlacement(n,l,y,b,T,M,D,F,V,X,ie,le,ue,me,ge,_e,ye,Pe){const{textOffset0:De,textOffset1:ke,crossTileID:qe}=le,Ve=[De,ke],Ze=au(n,y,b,Ve,T),xe=this.collisionIndex.placeCollisionBox(me,T,l,Oc(Ze.x,Ze.y,M,D,this.transform.angle),ie,F,V,X.predicate);if(_e){const Be=me.getSymbolInstanceIconSize(Pe,this.transform.zoom,le.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(me,Be,_e,Oc(Ze.x,Ze.y,M,D,this.transform.angle),ie,F,V,X.predicate).box.length===0)return}if(xe.box.length>0){let Be;return this.prevPlacement&&this.prevPlacement.variableOffsets[qe]&&this.prevPlacement.placements[qe]&&this.prevPlacement.placements[qe].text&&(Be=this.prevPlacement.variableOffsets[qe].anchor),this.variableOffsets[qe]={textOffset:Ve,width:y,height:b,anchor:n,textScale:T,prevAnchor:Be},this.markUsedJustification(me,n,le,ge),me.allowVerticalPlacement&&(this.markUsedOrientation(me,ge,le),this.placedOrientations[qe]=ge),{shift:Ze,placedGlyphBoxes:xe}}}placeLayerBucketPart(n,l,y,b){const{bucket:T,layout:M,posMatrix:D,textLabelPlaneMatrix:F,labelToScreenMatrix:V,clippingData:X,textPixelRatio:ie,holdingForFade:le,collisionBoxArray:ue,partiallyEvaluatedTextSize:me,partiallyEvaluatedIconSize:ge,collisionGroup:_e}=n.parameters,ye=M.get("text-optional"),Pe=M.get("icon-optional"),De=M.get("text-allow-overlap"),ke=M.get("icon-allow-overlap"),qe=M.get("text-rotation-alignment")==="map",Ve=M.get("text-pitch-alignment")==="map",Ze=M.get("symbol-z-order")==="viewport-y",xe=M.get("symbol-z-elevate");this.transform.setProjection(T.projection);let Be=De&&(ke||!T.hasIconData()||Pe),Qe=ke&&(De||!T.hasTextData()||ye);!T.collisionArrays&&ue&&T.deserializeCollisionBoxes(ue),y&&b&&T.updateCollisionDebugBuffers(this.transform.zoom,ue);const ct=(it,$e,ft)=>{const{crossTileID:Pt,numVerticalGlyphVertices:Dt}=it;if(X){const Qn={zoom:this.transform.zoom,pitch:this.transform.pitch};let En=null;if(X.dynamicFilterNeedsFeature){const rn=this.retainedQueryData[T.bucketInstanceId];En=X.featureIndex.loadFeature({featureIndex:it.featureIndex,bucketIndex:rn.bucketIndex,sourceLayerIndex:rn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,X.dynamicFilter)(Qn,En,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new r.P(it.tileAnchorX,it.tileAnchorY),this.transform.calculateDistanceTileData(X.unwrappedTileID)))return this.placements[Pt]=new Il(!1,!1,!1,!0),void l.add(Pt)}if(l.has(Pt))return;if(le)return void(this.placements[Pt]=new Il(!1,!1,!1));let Lt=!1,ot=!1,gt=!0,Tt=!1,Kt=!1,Qt=null,ni={box:null,offscreen:null,occluded:null},Jt={box:null,offscreen:null,occluded:null},Wt=null,wt=null,hi=null,dn=0,ji=0,Ji=0;ft.textFeatureIndex?dn=ft.textFeatureIndex:it.useRuntimeCollisionCircles&&(dn=it.featureIndex),ft.verticalTextFeatureIndex&&(ji=ft.verticalTextFeatureIndex);const Cn=Qn=>{Qn.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const En=this.transform.elevation;Qn.elevation=it.zOffset+(En?En.getAtTileOffset(Qn.tileID,Qn.tileAnchorX,Qn.tileAnchorY):0)},Sr=ft.textBox;if(Sr){Cn(Sr);const Qn=rn=>{let vr=r.aE.horizontal;if(T.allowVerticalPlacement&&!rn&&this.prevPlacement){const ro=this.prevPlacement.placedOrientations[Pt];ro&&(this.placedOrientations[Pt]=ro,vr=ro,this.markUsedOrientation(T,vr,it))}return vr},En=(rn,vr)=>{if(T.allowVerticalPlacement&&Dt>0&&ft.verticalTextBox){for(const ro of T.writingModes)if(ro===r.aE.vertical?(ni=vr(),Jt=ni):ni=rn(),ni&&ni.box&&ni.box.length)break}else ni=rn()};if(M.get("text-variable-anchor")){let rn=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Pt]){const or=this.prevPlacement.variableOffsets[Pt];rn.indexOf(or.anchor)>0&&(rn=rn.filter(xr=>xr!==or.anchor),rn.unshift(or.anchor))}const vr=(or,xr,It)=>{const li=T.getSymbolInstanceTextSize(me,it,this.transform.zoom,$e),rs=(or.x2-or.x1)*li+2*or.padding,Wn=(or.y2-or.y1)*li+2*or.padding,lt=it.hasIconTextFit&&!ke?xr:null;lt&&Cn(lt);let Ms={box:[],offscreen:!1,occluded:!1};const xs=De?2*rn.length:rn.length;for(let os=0;os<xs;++os){const ws=this.attemptAnchorPlacement(rn[os%rn.length],or,rs,Wn,li,qe,Ve,ie,D,_e,os>=rn.length,it,$e,T,It,lt,me,ge);if(ws&&(Ms=ws.placedGlyphBoxes,Ms&&Ms.box&&Ms.box.length)){Lt=!0,Qt=ws.shift;break}}return Ms};En(()=>vr(Sr,ft.iconBox,r.aE.horizontal),()=>{const or=ft.verticalTextBox;return or&&Cn(or),T.allowVerticalPlacement&&!(ni&&ni.box&&ni.box.length)&&Dt>0&&or?vr(or,ft.verticalIconBox,r.aE.vertical):{box:null,offscreen:null,occluded:null}}),ni&&(Lt=ni.box,gt=ni.offscreen,Tt=ni.occluded);const ro=Qn(!(!ni||!ni.box));if(!Lt&&this.prevPlacement){const or=this.prevPlacement.variableOffsets[Pt];or&&(this.variableOffsets[Pt]=or,this.markUsedJustification(T,or.anchor,it,ro))}}else{const rn=(vr,ro)=>{const or=T.getSymbolInstanceTextSize(me,it,this.transform.zoom,$e),xr=this.collisionIndex.placeCollisionBox(T,or,vr,new r.P(0,0),De,ie,D,_e.predicate);return xr&&xr.box&&xr.box.length&&(this.markUsedOrientation(T,ro,it),this.placedOrientations[Pt]=ro),xr};En(()=>rn(Sr,r.aE.horizontal),()=>{const vr=ft.verticalTextBox;return T.allowVerticalPlacement&&Dt>0&&vr?(Cn(vr),rn(vr,r.aE.vertical)):{box:null,offscreen:null,occluded:null}}),Qn(!!(ni&&ni.box&&ni.box.length))}}if(Wt=ni,Lt=Wt&&Wt.box&&Wt.box.length>0,gt=Wt&&Wt.offscreen,Tt=Wt&&Wt.occluded,it.useRuntimeCollisionCircles){const Qn=T.text.placedSymbolArray.get(it.centerJustifiedTextSymbolIndex>=0?it.centerJustifiedTextSymbolIndex:it.verticalPlacedTextSymbolIndex),En=r.aF(T.textSizeData,me,Qn),rn=M.get("text-padding");wt=this.collisionIndex.placeCollisionCircles(T,De,Qn,T.lineVertexArray,T.glyphOffsetArray,En,D,F,V,y,Ve,_e.predicate,it.collisionCircleDiameter*En/r.bN,rn,this.retainedQueryData[T.bucketInstanceId].tileID),Lt=De||wt.circles.length>0&&!wt.collisionDetected,gt=gt&&wt.offscreen,Tt=wt.occluded}if(ft.iconFeatureIndex&&(Ji=ft.iconFeatureIndex),ft.iconBox){const Qn=En=>{Cn(En);const rn=it.hasIconTextFit&&Qt?Oc(Qt.x,Qt.y,qe,Ve,this.transform.angle):new r.P(0,0),vr=T.getSymbolInstanceIconSize(ge,this.transform.zoom,it.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,vr,En,rn,ke,ie,D,_e.predicate)};Jt&&Jt.box&&Jt.box.length&&ft.verticalIconBox?(hi=Qn(ft.verticalIconBox),ot=hi.box.length>0):(hi=Qn(ft.iconBox),ot=hi.box.length>0),gt=gt&&hi.offscreen,Kt=hi.occluded}const vn=ye||it.numHorizontalGlyphVertices===0&&Dt===0,$i=Pe||it.numIconVertices===0;if(vn||$i?$i?vn||(ot=ot&&Lt):Lt=ot&&Lt:ot=Lt=ot&&Lt,Lt&&Wt&&Wt.box&&this.collisionIndex.insertCollisionBox(Wt.box,M.get("text-ignore-placement"),T.bucketInstanceId,Jt&&Jt.box&&ji?ji:dn,_e.ID),ot&&hi&&this.collisionIndex.insertCollisionBox(hi.box,M.get("icon-ignore-placement"),T.bucketInstanceId,Ji,_e.ID),wt&&(Lt&&this.collisionIndex.insertCollisionCircles(wt.circles,M.get("text-ignore-placement"),T.bucketInstanceId,dn,_e.ID),y)){const Qn=T.bucketInstanceId;let En=this.collisionCircleArrays[Qn];En===void 0&&(En=this.collisionCircleArrays[Qn]=new jh);for(let rn=0;rn<wt.circles.length;rn+=4)En.circles.push(wt.circles[rn+0]),En.circles.push(wt.circles[rn+1]),En.circles.push(wt.circles[rn+2]),En.circles.push(wt.collisionDetected?1:0)}const mr=T.projection.name!=="globe";Be=Be&&(mr||!Tt),Qe=Qe&&(mr||!Kt),this.placements[Pt]=new Il(Lt||Be,ot||Qe,gt||T.justReloaded),l.add(Pt)};if(xe&&this.buildingIndex&&(this.buildingIndex.updateZOffset(T,this.retainedQueryData[T.bucketInstanceId].tileID),T.updateZOffset()),Ze){const it=T.getSortedSymbolIndexes(this.transform.angle);for(let $e=it.length-1;$e>=0;--$e){const ft=it[$e];ct(T.symbolInstances.get(ft),ft,T.collisionArrays[ft])}T.hasAnyZOffset&&r.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const it=T.getSortedIndexesByZOffset();for(let $e=0;$e<it.length;++$e){const ft=it[$e];ct(T.symbolInstances.get(ft),ft,T.collisionArrays[ft])}}else for(let it=n.symbolInstanceStart;it<n.symbolInstanceEnd;it++)ct(T.symbolInstances.get(it),it,T.collisionArrays[it]);if(y&&T.bucketInstanceId in this.collisionCircleArrays){const it=this.collisionCircleArrays[T.bucketInstanceId];r.ad.invert(it.invProjMatrix,D),it.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(n,l,y,b){const{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:F,crossTileID:V}=y,X=r.cJ(l),ie=b===r.aE.vertical?F:X==="left"?T:X==="center"?M:X==="right"?D:-1;T>=0&&(n.text.placedSymbolArray.get(T).crossTileID=ie>=0&&T!==ie?0:V),M>=0&&(n.text.placedSymbolArray.get(M).crossTileID=ie>=0&&M!==ie?0:V),D>=0&&(n.text.placedSymbolArray.get(D).crossTileID=ie>=0&&D!==ie?0:V),F>=0&&(n.text.placedSymbolArray.get(F).crossTileID=ie>=0&&F!==ie?0:V)}markUsedOrientation(n,l,y){const b=l===r.aE.horizontal||l===r.aE.horizontalOnly?l:0,T=l===r.aE.vertical?l:0,{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:D,rightJustifiedTextSymbolIndex:F,verticalPlacedTextSymbolIndex:V}=y,X=n.text.placedSymbolArray;M>=0&&(X.get(M).placedOrientation=b),D>=0&&(X.get(D).placedOrientation=b),F>=0&&(X.get(F).placedOrientation=b),V>=0&&(X.get(V).placedOrientation=T)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let y=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const b=l?l.symbolFadeChange(n):1,T=l?l.opacities:{},M=l?l.variableOffsets:{},D=l?l.placedOrientations:{};for(const F in this.placements){const V=this.placements[F],X=T[F];X?(this.opacities[F]=new su(X,b,V.text,V.icon,null,V.clipped),y=y||V.text!==X.text.placed||V.icon!==X.icon.placed):(this.opacities[F]=new su(null,b,V.text,V.icon,V.skipFade,V.clipped),y=y||V.text||V.icon)}for(const F in T){const V=T[F];if(!this.opacities[F]){const X=new su(V,b,!1,!1);X.isHidden()||(this.opacities[F]=X,y=y||V.text.placed||V.icon.placed)}}for(const F in M)this.variableOffsets[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.variableOffsets[F]=M[F]);for(const F in D)this.placedOrientations[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.placedOrientations[F]=D[F]);y?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:n)}updateLayerOpacities(n,l,y,b){const T=new Set;for(const M of l){const D=M.getBucket(n);D&&M.latestFeatureIndex&&n.fqid===D.layerIds[0]&&(this.updateBucketOpacities(D,T,M.collisionBoxArray,y,b,M.tileID),D.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(D,M.tileID),D.updateZOffset()))}}updateBucketOpacities(n,l,y,b,T,M){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const D=n.layers[0].layout,F=!!n.layers[0].dynamicFilter(),V=new su(null,0,!1,!1,!0),X=D.get("text-allow-overlap"),ie=D.get("icon-allow-overlap"),le=D.get("text-variable-anchor"),ue=D.get("text-rotation-alignment")==="map",me=D.get("text-pitch-alignment")==="map",ge=new su(null,0,X&&(ie||!n.hasIconData()||D.get("icon-optional")),ie&&(X||!n.hasTextData()||D.get("text-optional")),!0);!n.collisionArrays&&y&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(y);const _e=(Pe,De,ke)=>{for(let qe=0;qe<De/4;qe++)Pe.opacityVertexArray.emplaceBack(ke)};let ye=0;T&&n.updateReplacement(M,T);for(let Pe=0;Pe<n.symbolInstances.length;Pe++){const De=n.symbolInstances.get(Pe),{numHorizontalGlyphVertices:ke,numVerticalGlyphVertices:qe,crossTileID:Ve,numIconVertices:Ze,tileAnchorX:xe,tileAnchorY:Be}=De,Qe=l.has(Ve);let ct=this.opacities[Ve];Qe?ct=V:ct||(ct=ge,this.opacities[Ve]=ct),l.add(Ve);const it=ke>0||qe>0,$e=Ze>0,ft=this.placedOrientations[Ve],Pt=ft===r.aE.vertical,Dt=ft===r.aE.horizontal||ft===r.aE.horizontalOnly;!it&&!$e||ct.isHidden()||ye++;let Lt=!1;if((it||$e)&&T)for(const ot of n.activeReplacements){if(ot.order<b||ot.order===1/0||!(ot.clipMask&r.cu.Symbol)||ot.min.x>xe||xe>ot.max.x||ot.min.y>Be||Be>ot.max.y)continue;const gt=r.cH(xe,Be,M.canonical,ot.footprintTileId.canonical);if(Lt=r.cI(gt,ot),Lt)break}if(it){const ot=Lt?Gs:oh(ct.text);_e(n.text,ke,Pt?Gs:ot),_e(n.text,qe,Dt?Gs:ot);const gt=ct.text.isHidden(),{leftJustifiedTextSymbolIndex:Tt,centerJustifiedTextSymbolIndex:Kt,rightJustifiedTextSymbolIndex:Qt,verticalPlacedTextSymbolIndex:ni}=De,Jt=n.text.placedSymbolArray,Wt=gt||Pt?1:0;Tt>=0&&(Jt.get(Tt).hidden=Wt),Kt>=0&&(Jt.get(Kt).hidden=Wt),Qt>=0&&(Jt.get(Qt).hidden=Wt),ni>=0&&(Jt.get(ni).hidden=gt||Dt?1:0);const wt=this.variableOffsets[Ve];wt&&this.markUsedJustification(n,wt.anchor,De,ft);const hi=this.placedOrientations[Ve];hi&&(this.markUsedJustification(n,"left",De,hi),this.markUsedOrientation(n,hi,De))}if($e){const ot=Lt?Gs:oh(ct.icon),{placedIconSymbolIndex:gt,verticalPlacedIconSymbolIndex:Tt}=De,Kt=n.icon.placedSymbolArray,Qt=ct.icon.isHidden()?1:0;gt>=0&&(_e(n.icon,Ze,Pt?Gs:ot),Kt.get(gt).hidden=Qt),Tt>=0&&(_e(n.icon,De.numVerticalIconVertices,Dt?Gs:ot),Kt.get(Tt).hidden=Qt)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const ot=n.collisionArrays[Pe];if(ot){let gt=new r.P(0,0),Tt=!0;if(ot.textBox||ot.verticalTextBox){if(le){const Qt=this.variableOffsets[Ve];Qt?(gt=au(Qt.anchor,Qt.width,Qt.height,Qt.textOffset,Qt.textScale),ue&&gt._rotate(me?this.transform.angle:-this.transform.angle)):Tt=!1}F&&(Tt=!ct.clipped),ot.textBox&&lu(n.textCollisionBox.collisionVertexArray,ct.text.placed,!Tt||Pt,gt.x,gt.y),ot.verticalTextBox&&lu(n.textCollisionBox.collisionVertexArray,ct.text.placed,!Tt||Dt,gt.x,gt.y)}const Kt=Tt&&!!(!Dt&&ot.verticalIconBox);ot.iconBox&&lu(n.iconCollisionBox.collisionVertexArray,ct.icon.placed,Kt,De.hasIconTextFit?gt.x:0,De.hasIconTextFit?gt.y:0),ot.verticalIconBox&&lu(n.iconCollisionBox.collisionVertexArray,ct.icon.placed,!Kt,De.hasIconTextFit?gt.x:0,De.hasIconTextFit?gt.y:0)}}}if(n.fullyClipped=ye===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const Pe=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=Pe.invProjMatrix,n.placementViewportMatrix=Pe.viewportMatrix,n.collisionCircleArray=Pe.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,l){const y=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*y>n}setStale(){this.stale=!0}}function lu(p,n,l,y,b){p.emplaceBack(n?1:0,l?1:0,y||0,b||0),p.emplaceBack(n?1:0,l?1:0,y||0,b||0),p.emplaceBack(n?1:0,l?1:0,y||0,b||0),p.emplaceBack(n?1:0,l?1:0,y||0,b||0)}const Aa=Math.pow(2,25),Kd=Math.pow(2,24),Zt=Math.pow(2,17),jp=Math.pow(2,16),Qd=Math.pow(2,9),Jd=Math.pow(2,8),qp=Math.pow(2,1);function oh(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const n=p.placed?1:0,l=Math.floor(127*p.opacity);return l*Aa+n*Kd+l*Zt+n*jp+l*Qd+n*Jd+l*qp+n}const Gs=0;class ef{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,l,y,b,T){const M=this._bucketParts;for(;this._currentTileIndex<n.length;)if(l.getBucketParts(M,b,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((D,F)=>D.sortKey-F.sortKey));this._currentPartIndex<M.length;){const D=M[this._currentPartIndex];if(l.placeLayerBucketPart(D,this._seenCrossTileIDs,y,D.symbolInstanceStart===0),this._currentPartIndex++,T())return!0}return!1}}class Pc{constructor(n,l,y,b,T,M,D,F,V){this.placement=new Up(n,T,M,D,F,V),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(n,l,y,b){const T=r.e.now(),M=()=>{const D=r.e.now()-T;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=l[n[this._currentPlacementIndex]],F=this.placement.collisionIndex.transform.zoom;if(D.type==="symbol"&&(!D.minzoom||D.minzoom<=F)&&(!D.maxzoom||D.maxzoom>F)){const V=D,X=V.layout.get("symbol-z-elevate"),ie=this._inProgressLayer=this._inProgressLayer||new ef(V),le=r.al(D.source,D.scope);if(ie.continuePlacement(X?b[le]:y[le],this.placement,this._showCollisionBoxes,D,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const cu=512/r.a3/2;class uu{constructor(n,l,y){this.tileID=n,this.bucketInstanceId=y,this.index=new r.cK(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=n.canonical.x*r.a3,T=n.canonical.y*r.a3;for(let M=0;M<l.length;M++){const{key:D,crossTileID:F,tileAnchorX:V,tileAnchorY:X}=l.get(M),ie=Math.floor((b+V)*cu),le=Math.floor((T+X)*cu);this.index.add(ie,le),this.keys.push(D),this.crossTileIDs.push(F)}this.index.finish()}findMatches(n,l,y){const b=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),T=cu/Math.pow(2,l.canonical.z-this.tileID.canonical.z),M=l.canonical.x*r.a3,D=l.canonical.y*r.a3;for(let F=0;F<n.length;F++){const V=n.get(F);if(V.crossTileID)continue;const{key:X,tileAnchorX:ie,tileAnchorY:le}=V,ue=Math.floor((M+ie)*T),me=Math.floor((D+le)*T),ge=this.index.range(ue-b,me-b,ue+b,me+b);for(const _e of ge){const ye=this.crossTileIDs[_e];if(this.keys[_e]===X&&!y.has(ye)){y.add(ye),V.crossTileID=ye;break}}}}}class c0{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class u0{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const l=Math.round((n-this.lng)/360);if(l!==0)for(const y in this.indexes){const b=this.indexes[y],T={};for(const M in b){const D=b[M];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+l),T[D.tileID.key]=D}this.indexes[y]=T}this.lng=n}addBucket(n,l,y){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let T=0;T<l.symbolInstances.length;T++)l.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const b=this.usedCrossTileIDs[n.overscaledZ];for(const T in this.indexes){const M=this.indexes[T];if(Number(T)>n.overscaledZ)for(const D in M){const F=M[D];F.tileID.isChildOf(n)&&F.findMatches(l.symbolInstances,n,b)}else{const D=M[n.scaledTo(Number(T)).key];D&&D.findMatches(l.symbolInstances,n,b)}}for(let T=0;T<l.symbolInstances.length;T++){const M=l.symbolInstances.get(T);M.crossTileID||(M.crossTileID=y.generate(),b.add(M.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new uu(n,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(n,l){for(const y of l.crossTileIDs)this.usedCrossTileIDs[n].delete(y)}removeStaleBuckets(n){let l=!1;for(const y in this.indexes){const b=this.indexes[y];for(const T in b)n[b[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,b[T]),delete b[T],l=!0)}return l}}class tf{constructor(){this.layerIndexes={},this.crossTileIDs=new c0,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,l,y,b){let T=this.layerIndexes[n.fqid];T===void 0&&(T=this.layerIndexes[n.fqid]=new u0);let M=!1;const D={};b.name!=="globe"&&T.handleWrapJump(y);for(const F of l){const V=F.getBucket(n);V&&n.fqid===V.layerIds[0]&&(V.bucketInstanceId||(V.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(F.tileID,V,this.crossTileIDs)&&(M=!0),D[V.bucketInstanceId]=!0)}return T.removeStaleBuckets(D)&&(M=!0),M}pruneUnusedLayers(n){const l={};n.forEach(y=>{l[y]=!0});for(const y in this.layerIndexes)l[y]||delete this.layerIndexes[y]}}const h0=new r.N({data:new r.O(r.L.colorTheme.data)}),lc=(p,n)=>Ti(p,n&&n.filter(l=>l.identifier!=="source.canvas")),Hp=r.ah(Mn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),nf=r.ah(Mn,["setCenter","setZoom","setBearing","setPitch"]),Gp={version:8,layers:[],sources:{}},Wp={duration:300,delay:0};class Wa extends r.E{constructor(n,l={}){super(),this.map=n,this.scope=l.scope||"",this.globalId=null,this.fragments=[],this.importDepth=l.importDepth||0,this.importsCache=l.importsCache||new Map,this.resolvedImports=l.resolvedImports||new Set,this.transition=r.W({},Wp),this._buildingIndex=new th(this),this.crossTileSymbolIndex=new tf,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=l.styleChanges||new He,this.dispatcher=l.dispatcher?l.dispatcher:new r.bw(r.bx(),this),l.imageManager?this.imageManager=l.imageManager:(this.imageManager=new Gn,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=l.glyphManager?l.glyphManager:new r.cM(n._requestManager,l.localFontFamily?r.cN.all:l.localIdeographFontFamily?r.cN.ideographs:r.cN.none,l.localFontFamily||l.localIdeographFontFamily),l.modelManager?this.modelManager=l.modelManager:(this.modelManager=new pi(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=l.configOptions?l.configOptions:new Map,this._configDependentLayers=l.configDependentLayers?l.configDependentLayers:new Set,this._config=l.config,this._initialConfig=l.initialConfig,this.dispatcher.broadcast("setReferrer",r.cO());const y=this;this._rtlTextPluginCallback=Wa.registerForPluginStateChange(b=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(T,M)=>{if(r.cP(T),M&&M.every(D=>D))for(const D in y._sourceCaches){const F=y._sourceCaches[D],V=F.getSource().type;V!=="vector"&&V!=="geojson"||F.reload()}})}),this.on("data",b=>{if(b.dataType!=="source"||b.sourceDataType!=="metadata")return;const T=this.getOwnSource(b.sourceId);if(T&&T.vectorLayerIds)for(const M in this._layers){const D=this._layers[M];D.source===T.id&&this._validateLayer(D)}})}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(r.cQ(n))return n;const l=r.cR(n);if(!l.startsWith("http"))try{return new URL(l,location.href).toString()}catch{return l}return l}return`json://${r.cS(JSON.stringify(n))}`}_diffStyle(n,l,y){this.globalId=this._getGlobalId(n);const b=(T,M)=>{try{M(null,this.setState(T,y))}catch(D){M(D,!1)}};if(typeof n=="string"){const T=this.map._requestManager.normalizeStyleURL(n),M=this.map._requestManager.transformRequest(T,r.R.Style);r.g(M,(D,F)=>{D?this.fire(new r.d(D)):F&&b(F,l)})}else typeof n=="object"&&b(n,l)}loadURL(n,l={}){this.fire(new r.f("dataloading",{dataType:"style"}));const y=typeof l.validate=="boolean"?l.validate:!r.cQ(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,l.accessToken),this.resolvedImports.add(n);const b=this.importsCache.get(n);if(b)return this._load(b,y);const T=this.map._requestManager.transformRequest(n,r.R.Style);this._request=r.g(T,(M,D)=>{if(this._request=null,M)this.fire(new r.d(M));else if(D)return this.importsCache.set(n,D),this._load(D,y)})}loadJSON(n,l={}){this.fire(new r.f("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=r.e.frame(()=>{this._request=null,this._load(n,l.validate!==!1)})}loadEmpty(){this.fire(new r.f("dataloading",{dataType:"style"})),this._load(Gp,!1)}_loadImports(n,l,y){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const b=[];for(const T of n){const M=this._createFragmentStyle(T),D=new Promise(X=>{M.once("style.import.load",X),M.once("error",X)}).then(()=>this.mergeAll());if(b.push(D),this.resolvedImports.has(T.url)){M.loadEmpty();continue}const F=T.data||this.importsCache.get(T.url);F?(M.loadJSON(F,{validate:l}),this._isInternalStyle(F)&&(M.globalId=null)):T.url?M.loadURL(T.url,{validate:l}):M.loadEmpty();const V={style:M,id:T.id,config:T.config};if(y){const X=this.fragments.findIndex(({id:ie})=>ie===y);this.fragments=this.fragments.slice(0,X).concat(V).concat(this.fragments.slice(X))}else this.fragments.push(V)}return Promise.allSettled(b)}getImportGlobalIds(n=this,l=new Set){for(const y of n.fragments)y.style.globalId&&l.add(y.style.globalId),this.getImportGlobalIds(y.style,l);return[...l.values()]}_createFragmentStyle(n){const l=this.scope?r.al(n.id,this.scope):n.id;let y;const b=this._initialConfig&&this._initialConfig[l];(n.config||b)&&(y=r.W({},n.config,b));const T=new Wa(this.map,{scope:l,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:y,configOptions:this.options,configDependentLayers:this._configDependentLayers});return T.setEventedParent(this.map,{style:T}),T}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,l){const y=n.schema;if(this._isInternalStyle(n)){const M=r.W({},Gp,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(M,l)}if(this.updateConfig(this._config,y),l&&lc(this,Oe(n)))return;this._loaded=!0,this.stylesheet=r.cT(n);const b=()=>{for(const V in n.sources)this.addSource(V,n.sources[V],{validate:!1,isInitialLoad:!0});n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(n.glyphs,this.scope);const M=Np(this.stylesheet.layers);if(this._order=M.map(V=>V.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const V=this.stylesheet.lights[0];this.light=new Gt(V.properties,V.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Gt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const V of M){const X=r.cY(V,this.scope,this._styleColorTheme.lut,this.options);X.isConfigDependent&&this._configDependentLayers.add(X.fqid),X.setEventedParent(this,{layer:{id:X.id}}),this._layers[X.id]=X,this._serializedLayers[X.id]=X.serialize();const ie=this.getOwnLayerSourceCache(X),le=!!this.directionalLight&&this.directionalLight.shadowsEnabled();ie&&X.canCastShadows()&&le&&(ie.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const D=this.stylesheet.terrain;D&&(this.checkCanvasFingerprintNoise(),this.terrainSetForDrapingOnly()||this._createTerrain(D,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.f("data",{dataType:"style"}));const F=this.isRootStyle();n.imports?this._loadImports(n.imports,l).then(()=>{this._reloadImports(),this.fire(new r.f(F?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.f(F?"style.load":"style.import.load")))},T=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=T,T){const M=this._evaluateColorThemeData(T);this._loadColorTheme(M).then(()=>{b()}).catch(D=>{r.w(`Couldn't load color theme from the stylesheet: ${D}`),b()})}else this._styleColorTheme.lut=null,b()}isRootStyle(){return this.importDepth===0}mergeAll(){let n,l,y,b,T,M,D,F;const V={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(X=>{if(X.stylesheet){if(X.light!=null&&(n=X.light),X.stylesheet.lights)for(const ie of X.stylesheet.lights)ie.type==="ambient"&&X.ambientLight!=null&&(l=X.ambientLight),ie.type==="directional"&&X.directionalLight!=null&&(y=X.directionalLight);b=this._prioritizeTerrain(b,X.terrain,X.stylesheet.terrain),X.stylesheet.fog&&X.fog!=null&&(T=X.fog),X.stylesheet.camera!=null&&(F=X.stylesheet.camera),X.stylesheet.projection!=null&&(M=X.stylesheet.projection),X.stylesheet.transition!=null&&(D=X.stylesheet.transition),V[X.scope]=X._styleColorTheme}}),this.light=n,this.ambientLight=l,this.directionalLight=y,this.fog=T,this._styleColorThemeForScope=V,b===null?delete this.terrain:this.terrain=b,this.camera=F||{"camera-projection":"perspective"},this.projection=M||{name:"mercator"},this.transition=r.W({},Wp,D),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){const l=y=>{for(const b of y.fragments)l(b.style);n(y)};l(this)}_prioritizeTerrain(n,l,y){const b=n&&n.drapeRenderMode===0;return y===null?l&&l.drapeRenderMode===0?l:b?n:null:l!=null&&(!n||b||l&&l.drapeRenderMode===1)?l:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(l=>{n=this._prioritizeTerrain(n,l.terrain,l.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(l=>{l.stylesheet.projection!=null&&(n=l.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},l={},y={};this.forEachFragmentStyle(b=>{for(const T in b._sourceCaches){const M=r.al(T,b.scope);n[M]=b._sourceCaches[T]}for(const T in b._otherSourceCaches){const M=r.al(T,b.scope);l[M]=b._otherSourceCaches[T]}for(const T in b._symbolSourceCaches){const M=r.al(T,b.scope);y[M]=b._symbolSourceCaches[T]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=l,this._mergedSymbolSourceCaches=y}mergeLayers(){const n={},l=[],y={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(M=>{for(const D of M._order){const F=M._layers[D];if(F.type==="slot"){const V=r.cU(D);if(n[V])continue;n[V]=[]}F.slot&&n[F.slot]?n[F.slot].push(F):l.push(F)}}),this._mergedOrder=[],this._clipLayerIndices=[];let b=0;const T=(M=[])=>{for(const D of M)if(D.type==="slot"){const F=r.cU(D.id);n[F]&&T(n[F]),this._mergedSlots.push(F)}else{const F=r.al(D.id,D.scope);this._mergedOrder.push(F),y[F]=D,D.is3D()&&(this._has3DLayers=!0),D.type==="circle"&&(this._hasCircleLayers=!0),D.type==="symbol"&&(this._hasSymbolLayers=!0),D.type==="clip"&&this._clipLayerIndices.push(b),b++}};T(l),this._mergedLayers=y,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=r.W({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?function(l,y,b){const T=r.W({},y);for(const D of Object.keys(r.L.colorTheme))T[D]===void 0&&(T[D]=r.L.colorTheme[D].default);const M=new r.U(h0,l,new Map(b));return M.setTransitionOrValue(T,b),M.untransitioned().possiblyEvaluate(new r.X(0))}(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const l=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((y,b)=>{const T="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void y();let M=n;M.startsWith(T)||(M=T+M);const D="mapbox-reserved-lut",F=new Image;F.src=M,F.onerror=()=>{this._styleColorTheme.lutLoading=!1,b(new Error("Failed to load image data"))},F.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==l)return void y();this._styleColorTheme.lutLoading=!1;const{width:V,height:X,data:ie}=r.e.getImageData(F);if(X>32)return void b(new Error("The height of the image must be less than or equal to 32 pixels."));if(V!==X*X)return void b(new Error("The width of the image must be equal to the height squared."));this.getImage(D)&&this.removeImage(D),this.addImage(D,{data:new r.i({width:V,height:X},ie),pixelRatio:1,sdf:!1,version:0});const le=this.imageManager.getImage(D,this.scope);le?(this._styleColorTheme.lut={image:le.data,data:n},y()):b(new Error("Missing LUT image."))}})}getLut(n){const l=this._styleColorThemeForScope[n];return l?l.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=function(l,y,b){let T,M,D;const F=r.e.devicePixelRatio>1?"@2x":"";let V=r.g(y.transformRequest(y.normalizeSpriteURL(l,F,".json"),r.R.SpriteJSON),(le,ue)=>{V=null,D||(D=le,T=ue,ie())}),X=r.h(y.transformRequest(y.normalizeSpriteURL(l,F,".png"),r.R.SpriteImage),(le,ue)=>{X=null,D||(D=le,M=ue,ie())});function ie(){if(D)b(D);else if(T&&M){const le=r.e.getImageData(M),ue={};for(const me in T){const{width:ge,height:_e,x:ye,y:Pe,sdf:De,pixelRatio:ke,stretchX:qe,stretchY:Ve,content:Ze}=T[me],xe=new r.i({width:ge,height:_e});r.i.copy(le,xe,{x:ye,y:Pe},{x:0,y:0},{width:ge,height:_e},null),ue[me]={data:xe,pixelRatio:ke,sdf:De,stretchX:qe,stretchY:Ve,content:Ze}}b(null,ue)}}return{cancel(){V&&(V.cancel(),V=null),X&&(X.cancel(),X=null)}}}(n,this.map._requestManager,(l,y)=>{if(this._spriteRequest=null,l)this.fire(new r.d(l));else if(y)for(const b in y)this.imageManager.addImage(b,this.scope,y[b]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.f("data",{dataType:"style"}))})}_validateLayer(n){const l=this.getOwnSource(n.source);if(!l)return;const y=n.sourceLayer;y&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(y)===-1)&&this.fire(new r.d(new Error(`Source layer "${y}" does not exist on source "${l.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,l)=>{const y=this.fragments[l];return y&&y.style&&(n.data=y.style.serialize()),n})}_serializeSources(){const n={};for(const l in this._sourceCaches){const y=this._sourceCaches[l].getSource();n[y.id]||(n[y.id]=y.serialize())}return n}_serializeLayers(n){const l=[];for(const y of n){const b=this._layers[y];b&&b.type!=="custom"&&l.push(b.serialize())}return l}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const l=this.getOwnLayer(n);if(l)return l;this.fire(new r.d(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const l=this.getOwnSource(n);if(l)return l;this.fire(new r.d(new Error(`The source '${n}' does not exist in the map's style.`)))}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const l=this.calculateLightsBrightness();n.brightness=l||0,l!==this._brightness&&(this._brightness=l,this.dispatcher.broadcast("setBrightness",l));const y=this._changes.isDirty();let b=!1;if(this._changes.isDirty()){const M=this._changes.getLayerUpdatesByScope();for(const D in M){const{updatedIds:F,removedIds:V}=M[D];(F||V)&&(this._updateWorkerLayers(D,F,V),b=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._changes.reset()}const T={};for(const M in this._mergedSourceCaches){const D=this._mergedSourceCaches[M];T[M]=D.used,D.used=!1,D.tileCoverLift=0}for(const M of this._mergedOrder){const D=this._mergedLayers[M];if(D.recalculate(n,this._availableImages),!D.isHidden(n.zoom)){const F=this.getLayerSourceCache(D);F&&(F.used=!0,F.tileCoverLift=Math.max(F.tileCoverLift,D.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let F=D.minzoom||0;F<(D.maxzoom||25.5);F++){const V=this.map.painter;if(V){const X=D.getProgramIds();if(!X)continue;for(const ie of X){const le=D.getDefaultProgramParams(ie,n.zoom,this._styleColorTheme.lut);le&&(V.style=this,this.fog&&(V._fogVisible=!0,le.overrideFog=!0,V.getOrCreateProgram(ie,le)),V._fogVisible=!1,le.overrideFog=!1,V.getOrCreateProgram(ie,le),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(le.overrideRtt=!0,V.getOrCreateProgram(ie,le)))}}}}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&b&&this.mergeLayers();for(const M in T){const D=this._mergedSourceCaches[M];T[M]!==D.used&&D.getSource().fire(new r.f("data",{sourceDataType:"visibility",dataType:"source",sourceId:D.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),y&&this.fire(new r.f("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=this._changes.getUpdatedImages();if(n.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],n);this._changes.resetUpdatedImages()}}_updateWorkerLayers(n,l,y){const b=this.getFragmentStyle(n);b&&this.dispatcher.broadcast("updateLayers",{layers:l?b._serializeLayers(l):[],scope:n,removedIds:y||[],options:b.options})}setState(n,l){if(this._checkLoaded(),lc(this,Oe(n)))return!1;(n=r.cT(n)).layers=Np(n.layers);const y=function(M,D){if(!M)return[{command:Mn.setStyle,args:[D]}];let F=[];try{if(!U(M.version,D.version))return[{command:Mn.setStyle,args:[D]}];if(U(M.center,D.center)||F.push({command:Mn.setCenter,args:[D.center]}),U(M.zoom,D.zoom)||F.push({command:Mn.setZoom,args:[D.zoom]}),U(M.bearing,D.bearing)||F.push({command:Mn.setBearing,args:[D.bearing]}),U(M.pitch,D.pitch)||F.push({command:Mn.setPitch,args:[D.pitch]}),U(M.sprite,D.sprite)||F.push({command:Mn.setSprite,args:[D.sprite]}),U(M.glyphs,D.glyphs)||F.push({command:Mn.setGlyphs,args:[D.glyphs]}),U(M.imports,D.imports)||function(ue=[],me=[],ge){me=me||[];const _e=(ue=ue||[]).map(Vh),ye=me.map(Vh),Pe=ue.reduce(rh,{}),De=me.reduce(rh,{}),ke=_e.slice();let qe,Ve,Ze,xe;for(qe=0,Ve=0;qe<_e.length;qe++)Ze=_e[qe],De.hasOwnProperty(Ze)?Ve++:(ge.push({command:Mn.removeImport,args:[Ze]}),ke.splice(ke.indexOf(Ze,Ve),1));for(qe=0,Ve=0;qe<ye.length;qe++)Ze=ye[ye.length-1-qe],ke[ke.length-1-qe]!==Ze&&(Pe.hasOwnProperty(Ze)?(ge.push({command:Mn.removeImport,args:[Ze]}),ke.splice(ke.lastIndexOf(Ze,ke.length-Ve),1)):Ve++,xe=ke[ke.length-qe],ge.push({command:Mn.addImport,args:[De[Ze],xe]}),ke.splice(ke.length-qe,0,Ze));for(const Be of me){const Qe=Pe[Be.id];Qe&&!U(Qe,Be)&&ge.push({command:Mn.updateImport,args:[Be.id,Be]})}}(M.imports,D.imports,F),U(M.transition,D.transition)||F.push({command:Mn.setTransition,args:[D.transition]}),U(M.light,D.light)||F.push({command:Mn.setLight,args:[D.light]}),U(M.fog,D.fog)||F.push({command:Mn.setFog,args:[D.fog]}),U(M.projection,D.projection)||F.push({command:Mn.setProjection,args:[D.projection]}),U(M.lights,D.lights)||F.push({command:Mn.setLights,args:[D.lights]}),U(M.camera,D.camera)||F.push({command:Mn.setCamera,args:[D.camera]}),!U(M["color-theme"],D["color-theme"]))return[{command:Mn.setStyle,args:[D]}];const V={},X=[];(function(ue,me,ge,_e){let ye;for(ye in me=me||{},ue=ue||{})ue.hasOwnProperty(ye)&&(me.hasOwnProperty(ye)||nh(ye,ge,_e));for(ye in me){if(!me.hasOwnProperty(ye))continue;const Pe=me[ye];ue.hasOwnProperty(ye)?U(ue[ye],Pe)||(ue[ye].type==="geojson"&&Pe.type==="geojson"&&a0(ue,me,ye)?ge.push({command:Mn.setGeoJSONSourceData,args:[ye,Pe.data]}):ac(ye,me,ge,_e)):Xd(ye,me,ge)}})(M.sources,D.sources,X,V);const ie=[];M.layers&&M.layers.forEach(ue=>{ue.source&&V[ue.source]?F.push({command:Mn.removeLayer,args:[ue.id]}):ie.push(ue)});let le=M.terrain;le&&V[le.source]&&(F.push({command:Mn.setTerrain,args:[void 0]}),le=void 0),F=F.concat(X),U(le,D.terrain)||F.push({command:Mn.setTerrain,args:[D.terrain]}),function(ue,me,ge){me=me||[];const _e=(ue=ue||[]).map(Vh),ye=me.map(Vh),Pe=ue.reduce(rh,{}),De=me.reduce(rh,{}),ke=_e.slice(),qe=Object.create(null);let Ve,Ze,xe,Be,Qe,ct,it;for(Ve=0,Ze=0;Ve<_e.length;Ve++)xe=_e[Ve],De.hasOwnProperty(xe)?Ze++:(ge.push({command:Mn.removeLayer,args:[xe]}),ke.splice(ke.indexOf(xe,Ze),1));for(Ve=0,Ze=0;Ve<ye.length;Ve++)xe=ye[ye.length-1-Ve],ke[ke.length-1-Ve]!==xe&&(Pe.hasOwnProperty(xe)?(ge.push({command:Mn.removeLayer,args:[xe]}),ke.splice(ke.lastIndexOf(xe,ke.length-Ze),1)):Ze++,ct=ke[ke.length-Ve],ge.push({command:Mn.addLayer,args:[De[xe],ct]}),ke.splice(ke.length-Ve,0,xe),qe[xe]=!0);for(Ve=0;Ve<ye.length;Ve++)if(xe=ye[Ve],Be=Pe[xe],Qe=De[xe],!qe[xe]&&!U(Be,Qe))if(U(Be.source,Qe.source)&&U(Be["source-layer"],Qe["source-layer"])&&U(Be.type,Qe.type)){for(it in zh(Be.layout,Qe.layout,ge,xe,null,Mn.setLayoutProperty),zh(Be.paint,Qe.paint,ge,xe,null,Mn.setPaintProperty),U(Be.slot,Qe.slot)||ge.push({command:Mn.setSlot,args:[xe,Qe.slot]}),U(Be.filter,Qe.filter)||ge.push({command:Mn.setFilter,args:[xe,Qe.filter]}),U(Be.minzoom,Qe.minzoom)&&U(Be.maxzoom,Qe.maxzoom)||ge.push({command:Mn.setLayerZoomRange,args:[xe,Qe.minzoom,Qe.maxzoom]}),Be)Be.hasOwnProperty(it)&&it!=="layout"&&it!=="paint"&&it!=="filter"&&it!=="metadata"&&it!=="minzoom"&&it!=="maxzoom"&&it!=="slot"&&(it.indexOf("paint.")===0?zh(Be[it],Qe[it],ge,xe,it.slice(6),Mn.setPaintProperty):U(Be[it],Qe[it])||ge.push({command:Mn.setLayerProperty,args:[xe,it,Qe[it]]}));for(it in Qe)Qe.hasOwnProperty(it)&&!Be.hasOwnProperty(it)&&it!=="layout"&&it!=="paint"&&it!=="filter"&&it!=="metadata"&&it!=="minzoom"&&it!=="maxzoom"&&it!=="slot"&&(it.indexOf("paint.")===0?zh(Be[it],Qe[it],ge,xe,it.slice(6),Mn.setPaintProperty):U(Be[it],Qe[it])||ge.push({command:Mn.setLayerProperty,args:[xe,it,Qe[it]]}))}else ge.push({command:Mn.removeLayer,args:[xe]}),ct=ke[ke.lastIndexOf(xe)+1],ge.push({command:Mn.addLayer,args:[Qe,ct]})}(ie,D.layers,F)}catch(V){console.warn("Unable to compute style diff:",V),F=[{command:Mn.setStyle,args:[D]}]}return F}(this.serialize(),n).filter(M=>!(M.command in nf));if(y.length===0)return!1;const b=y.filter(M=>!(M.command in Hp));if(b.length>0)throw new Error(`Unimplemented: ${b.map(M=>M.command).join(", ")}.`);const T=[];return y.forEach(M=>{T.push(this[M.command].apply(this,M.args))}),l&&Promise.all(T).then(l),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(n,l){return this.getImage(n)?this.fire(new r.d(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,this.scope,l),this._afterImageUpdated(n),this)}updateImage(n,l){this.imageManager.updateImage(n,this.scope,l)}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._afterImageUpdated(n),this):this.fire(new r.d(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(n),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.f("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(n,l,y={}){return this._checkLoaded(),this._validate(bi,`models.${n}`,l,null,y)||(this.modelManager.addModel(n,l,this.scope),this._changes.setDirty()),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope),this):this.fire(new r.d(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,l,y={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(Re,`sources.${n}`,l,null,y))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const b=Ao(n,l,this.dispatcher,this);b.scope=this.scope,b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(b.id),source:b.serialize(),sourceId:b.id}));const T=M=>{const D=(M?"symbol:":"other:")+b.id,F=r.al(D,this.scope),V=this._sourceCaches[D]=new r.bv(F,b,M);(M?this._symbolSourceCaches:this._otherSourceCaches)[b.id]=V,V.onAdd(this.map)};T(!1),l.type!=="vector"&&l.type!=="geojson"||T(!0),b.onAdd&&b.onAdd(this.map),y.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const l=this.getOwnSource(n);if(!l)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===n)return this.fire(new r.d(new Error(`Source "${n}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new r.d(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const y=this.getOwnSourceCaches(n);for(const b of y){const T=r.cU(b.id);delete this._sourceCaches[T],this._changes.discardSourceCacheUpdate(b.id),b.fire(new r.f("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,l){this._checkLoaded(),this.getOwnSource(n).setData(l),this._changes.setDirty()}getOwnSource(n){const l=this.getOwnSourceCache(n);return l&&l.getSource()}getOwnSources(){const n=[];for(const l in this._otherSourceCaches){const y=this.getOwnSourceCache(l);y&&n.push(y.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const l in n){const y=n[l]._tiles;for(const b in y){const T=y[b];if(T.state!=="loaded"&&T.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const l=this._getTransitionParameters();for(const b of n){if(this._validate(Je,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const T=this.ambientLight;T.set(b),T.updateTransitions(l)}else this.ambientLight=new _n(b,Pi,this.scope,this.options);break;case"directional":if(this.directionalLight){const T=this.directionalLight;T.set(b),T.updateTransitions(l)}else this.directionalLight=new _n(b,zo,this.scope,this.options)}}const y=new r.X(this.z||0,l);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,l=this.ambientLight;if(!n||!l)return;const y=ie=>.2126*(ie[0]<=.03928?ie[0]/12.92:Math.pow((ie[0]+.055)/1.055,2.4))+.7152*(ie[1]<=.03928?ie[1]/12.92:Math.pow((ie[1]+.055)/1.055,2.4))+.0722*(ie[2]<=.03928?ie[2]/12.92:Math.pow((ie[2]+.055)/1.055,2.4)),b=n.properties.get("color").toRenderColor(null).toArray01(),T=n.properties.get("intensity"),M=n.properties.get("direction"),D=1-r.ac(M.x,M.y,M.z)[2]/90,F=y(b)*T*D,V=l.properties.get("color").toRenderColor(null).toArray01(),X=l.properties.get("intensity");return(F+y(V)*X)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(!n)return this;if(r.cV(n)){const l=r.cW(n),y=this.fragments.find(({id:T})=>T===l);if(!y)throw new Error(`Style import not found: ${n}`);const b=r.cU(n);return y.style.getFragmentStyle(b)}{const l=this.fragments.find(({id:y})=>y===n);if(!l)throw new Error(`Style import not found: ${n}`);return l.style}}getConfigProperty(n,l){const y=this.getFragmentStyle(n);if(!y)return null;const b=r.al(l,y.scope),T=y.options.get(b),M=T?T.value||T.default:null;return M?M.serialize():null}setConfigProperty(n,l,y){const b=this.getFragmentStyle(n);if(!b)return;const T=b.stylesheet.schema;if(!T||!T[l])return;const M=r.y(y);if(M.result!=="success")return void lc(this,M.value);const D=M.value.expression,F=r.al(l,b.scope),V=b.options.get(F);if(!V)return;let X;const{minValue:ie,maxValue:le,stepValue:ue,type:me,values:ge}=T[l],_e=r.y(T[l].default);_e.result==="success"&&(X=_e.value.expression),X?(this.options.set(F,{...V,value:D,default:X,minValue:ie,maxValue:le,stepValue:ue,type:me,values:ge}),this.updateConfigDependencies()):this.fire(new r.d(new Error(`No schema defined for the config option "${l}" in the "${n}" fragment.`)))}getConfig(n){const l=this.getFragmentStyle(n);if(!l)return null;const y=l.stylesheet.schema;if(!y)return null;const b={};for(const T in y){const M=r.al(T,l.scope),D=l.options.get(M),F=D?D.value||D.default:null;b[T]=F?F.serialize():null}return b}setConfig(n,l){const y=this.getFragmentStyle(n);y&&(y.updateConfig(l,y.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const l=this.getFragmentStyle(n);return l?l.stylesheet.schema:null}setSchema(n,l){const y=this.getFragmentStyle(n);y&&(y.stylesheet.schema=l,y.updateConfig(y._config,l),this.updateConfigDependencies())}updateConfig(n,l){if(this._config=n,n||l)if(l)for(const y in l){let b,T;const M=r.y(l[y].default);if(M.result==="success"&&(b=M.value.expression),n&&n[y]!==void 0){const le=r.y(n[y]);le.result==="success"&&(T=le.value.expression)}const{minValue:D,maxValue:F,stepValue:V,type:X,values:ie}=l[y];if(b){const le=r.al(y,this.scope);this.options.set(le,{default:b,value:T,minValue:D,maxValue:F,stepValue:V,type:X,values:ie})}else this.fire(new r.d(new Error(`No schema defined for config option "${y}".`)))}else this.fire(new r.d(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const n of this._configDependentLayers){const l=this.getLayer(n);l&&(l.possiblyEvaluateVisibility(),this._updateLayer(l))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(n=>{if(n._styleColorTheme.colorTheme){const l=n._evaluateColorThemeData(n._styleColorTheme.colorTheme);(!n._styleColorTheme.lut||n._styleColorTheme.lut&&l!==n._styleColorTheme.lut.data)&&n.setColorTheme(n._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(n,l,y={}){this._checkLoaded();const b=n.id;if(this._layers[b])return void this.fire(new r.d(new Error(`Layer with id "${b}" already exists on this map`)));let T;if(n.type==="custom"){if(lc(this,r.cX(n)))return;T=r.cY(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(b,n.source),n=r.cT(n),n=r.W(n,{source:b})),this._validate(ht,`layers.${b}`,n,{arrayIndex:-1},y))return;T=r.cY(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(T),T.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[T.id]=T.serialize()}T.isConfigDependent&&this._configDependentLayers.add(T.fqid);let M=this._order.length;if(l){const X=this._order.indexOf(l);if(X===-1)return void this.fire(new r.d(new Error(`Layer with id "${l}" does not exist on this map.`)));T.slot===this._layers[l].slot?M=X:r.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(M,0,b),this._layerOrderChanged=!0,this._layers[b]=T;const D=this.getOwnLayerSourceCache(T),F=!!this.directionalLight&&this.directionalLight.shadowsEnabled();D&&T.canCastShadows()&&F&&(D.castsShadows=!0);const V=this._changes.getRemovedLayer(T);if(V&&T.source&&D&&T.type!=="custom"){this._changes.discardLayerRemoval(T);const X=r.al(T.source,T.scope);V.type!==T.type?this._changes.updateSourceCache(X,"clear"):(this._changes.updateSourceCache(X,"reload"),D.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),T.scope=this.scope,this.mergeLayers()}moveLayer(n,l){this._checkLoaded();const y=this._checkLayer(n);if(!y||n===l)return;const b=this._order.indexOf(n);this._order.splice(b,1);let T=this._order.length;if(l){const M=this._order.indexOf(l);if(M===-1)return void this.fire(new r.d(new Error(`Layer with id "${l}" does not exist on this map.`)));y.slot===this._layers[l].slot?T=M:r.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const l=this._checkLayer(n);if(!l)return;l.setEventedParent(null);const y=this._order.indexOf(n);this._order.splice(y,1),delete this._layers[n],delete this._serializedLayers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(l.fqid),this._changes.removeLayer(l);const b=this.getOwnLayerSourceCache(l);if(b&&b.castsShadows){let T=!1;for(const M in this._layers)if(this._layers[M].source===l.source&&this._layers[M].canCastShadows()){T=!0;break}b.castsShadows=T}l.onRemove&&l.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const l in this._layers)if(this._layers[l].type===n)return!0;return!1}setLayerZoomRange(n,l,y){this._checkLoaded();const b=this._checkLayer(n);b&&(b.minzoom===l&&b.maxzoom===y||(l!=null&&(b.minzoom=l),y!=null&&(b.maxzoom=y),this._updateLayer(b)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,l){this._checkLoaded();const y=this._checkLayer(n);y&&y.slot!==l&&(y.slot=l,this._updateLayer(y))}setFilter(n,l,y={}){this._checkLoaded();const b=this._checkLayer(n);if(b&&!U(b.filter,l))return l==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(pt,`layers.${b.id}.filter`,l,{layerType:b.type},y)||(b.filter=r.cT(l),this._updateLayer(b)))}getFilter(n){const l=this._checkLayer(n);if(l)return r.cT(l.filter)}setLayoutProperty(n,l,y,b={}){this._checkLoaded();const T=this._checkLayer(n);if(T&&!U(T.getLayoutProperty(l),y)){if(y!=null&&(!b||b.validate!==!1)&&lc(T,oi.call(Oe,{key:`layers.${n}.layout.${l}`,layerType:T.type,objectKey:l,value:y,styleSpec:r.L,style:{glyphs:!0,sprite:!0}})))return;T.setLayoutProperty(l,y),T.isConfigDependent&&this._configDependentLayers.add(T.fqid),this._updateLayer(T)}}getLayoutProperty(n,l){const y=this._checkLayer(n);if(y)return y.getLayoutProperty(l)}setPaintProperty(n,l,y,b={}){this._checkLoaded();const T=this._checkLayer(n);if(!T||U(T.getPaintProperty(l),y)||y!=null&&(!b||b.validate!==!1)&&lc(T,$t.call(Oe,{key:`layers.${n}.paint.${l}`,layerType:T.type,objectKey:l,value:y,styleSpec:r.L})))return;const M=T.setPaintProperty(l,y);T.isConfigDependent&&this._configDependentLayers.add(T.fqid),M&&this._updateLayer(T),this._changes.updatePaintProperties(T)}getPaintProperty(n,l){const y=this._checkLayer(n);if(y)return y.getPaintProperty(l)}setFeatureState(n,l){this._checkLoaded();const y=n.source,b=n.sourceLayer,T=this._checkSource(y);if(!T)return;const M=T.type;if(M==="geojson"&&b)return void this.fire(new r.d(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(M==="vector"&&!b)return void this.fire(new r.d(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new r.d(new Error("The feature id parameter must be provided.")));const D=this.getOwnSourceCaches(y);for(const F of D)F.setFeatureState(b,n.id,l)}removeFeatureState(n,l){this._checkLoaded();const y=n.source,b=this._checkSource(y);if(!b)return;const T=b.type,M=T==="vector"?n.sourceLayer:void 0;if(T==="vector"&&!M)return void this.fire(new r.d(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new r.d(new Error("A feature id is required to remove its specific state property.")));const D=this.getOwnSourceCaches(y);for(const F of D)F.removeFeatureState(M,n.id,l)}getFeatureState(n){this._checkLoaded();const l=n.source,y=n.sourceLayer,b=this._checkSource(l);if(b){if(b.type!=="vector"||y)return n.id===void 0&&this.fire(new r.d(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(l)[0].getFeatureState(y,n.id);this.fire(new r.d(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=r.W({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return r.W({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),l=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return r.cZ({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:l,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},y=>y!==void 0)}_updateLayer(n){this._changes.updateLayer(n);const l=this.getLayerSourceCache(n),y=r.al(n.source,n.scope),b=this._changes.getUpdatedSourceCaches();n.source&&!b[y]&&l&&l.getSource().type!=="raster"&&(this._changes.updateSourceCache(y,"reload"),l.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const l=D=>this._mergedLayers[D].type==="fill-extrusion"||this._mergedLayers[D].type==="model",y=this.order,b={},T=[];for(let D=y.length-1;D>=0;D--){const F=y[D];if(l(F)){b[F]=D;for(const V of n){const X=V[F];if(X)for(const ie of X)T.push(ie)}}}T.sort((D,F)=>F.intersectionZ-D.intersectionZ);const M=[];for(let D=y.length-1;D>=0;D--){const F=y[D];if(l(F))for(let V=T.length-1;V>=0;V--){const X=T[V].feature;if(X.layer&&b[X.layer.id]<D)break;M.push(X),T.pop()}else for(const V of n){const X=V[F];if(X)for(const ie of X)M.push(ie.feature)}}return M}queryRenderedFeatures(n,l,y){l&&l.filter&&this._validate(pt,"queryRenderedFeatures.filter",l.filter,null,l),l.scope=this.scope,l.availableImages=this._availableImages,l.serializedLayers=this._serializedLayers;const b={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new r.d(new Error("parameters.layers must be an Array."))),[];for(const V of l.layers){const X=this._mergedLayers[V];if(!X)return this.fire(new r.d(new Error(`The layer '${V}' does not exist in the map's style and cannot be queried for features.`))),[];b[X.source]=!0}}const T=[],M=l.serializedLayers||{},D=l&&l.layers?l.layers.some(V=>{const X=this.getLayer(V);return X&&X.is3D()}):this.has3DLayers(),F=we.createFromScreenPoints(n,y);for(const V in this._mergedSourceCaches){const X=this._mergedSourceCaches[V].getSource();if(!X||X.scope!==l.scope)continue;const ie=this._mergedSourceCaches[V].getSource().id;l.layers&&!b[ie]||T.push(bn(this._mergedSourceCaches[V],this._mergedLayers,M,F,l,y,D,!!this.map._showQueryGeometry))}return this.placement&&T.push(function(V,X,ie,le,ue,me,ge){const _e={},ye=me.queryRenderedSymbols(le),Pe=[];for(const De of Object.keys(ye).map(Number))Pe.push(ge[De]);Pe.sort(sc);for(const De of Pe){const ke=De.featureIndex.lookupSymbolFeatures(ye[De.bucketInstanceId],X,De.bucketIndex,De.sourceLayerIndex,ue.filter,ue.layers,ue.availableImages,V);for(const qe in ke){const Ve=_e[qe]=_e[qe]||[],Ze=ke[qe];Ze.sort((xe,Be)=>{const Qe=De.featureSortOrder;if(Qe){const ct=Qe.indexOf(xe.featureIndex);return Qe.indexOf(Be.featureIndex)-ct}return Be.featureIndex-xe.featureIndex});for(const xe of Ze)Ve.push(xe)}}for(const De in _e)_e[De].forEach(ke=>{const qe=ke.feature,Ve=ie(V[De]);if(!Ve)return;const Ze=Ve.getFeatureState(qe.layer["source-layer"],qe.id);qe.source=qe.layer.source,qe.layer["source-layer"]&&(qe.sourceLayer=qe.layer["source-layer"]),qe.state=Ze});return _e}(this._mergedLayers,M,this.getLayerSourceCache.bind(this),F.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(n,l){l&&l.filter&&this._validate(pt,"querySourceFeatures.filter",l.filter,null,l);const y=this.getOwnSourceCaches(n);let b=[];for(const T of y)b=b.concat(po(T,l));return b}addSourceType(n,l,y){return Wa.getSourceType(n)?y(new Error(`A source type called "${n}" already exists.`)):(Wa.setSourceType(n,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:l.workerSourceURL},y):y(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,l,y={}){this._checkLoaded();const b=this.light.getLight();let T=!1;for(const D in n)if(!U(n[D],b[D])){T=!0;break}if(!T)return;const M=this._getTransitionParameters();this.light.setLight(n,l,y),this.light.updateTransitions(M)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,l=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()&&l!==0||delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let y=n;const b=n.source==null;if(l===1){if(this.disableElevatedTerrain)return;if(typeof y.source=="object"){const D="terrain-dem-src";this.addSource(D,y.source),y=r.cT(y),y=r.W(y,{source:D})}const T=r.W({},y),M={};if(this.terrain&&b){T.source=this.terrain.get().source;const D=this.terrain?this.getFragmentStyle(this.terrain.scope):null;D&&(M.style=D.serialize())}if(this._validate(Ge,"terrain",T,M))return}if(!this.terrain||this.terrain.scope!==this.scope&&!b||this.terrain&&l!==this.terrain.drapeRenderMode){if(!y)return;this._createTerrain(y,l),this.fire(new r.f("data",{dataType:"style"}))}else{const T=this.terrain,M=T.get();for(const D of Object.keys(r.L.terrain))!y.hasOwnProperty(D)&&r.L.terrain[D].default&&(y[D]=r.L.terrain[D].default);for(const D in n)if(!U(n[D],M[D])){T.set(n,this.options),this.stylesheet.terrain=n;const F=this._getTransitionParameters({duration:0});T.updateTransitions(F),this.fire(new r.f("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const l=this.fog=new ar(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=l.get();const y=this._getTransitionParameters({duration:0});l.updateTransitions(y)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog;if(!U(l.get(),n)){l.set(n,this.options),this.stylesheet.fog=l.get();const y=this._getTransitionParameters({duration:0});l.updateTransitions(y)}}else this._createFog(n);this._markersNeedUpdate=!0}setColorTheme(n){this._checkLoaded();const l=()=>{for(const b in this._layers)this._layers[b].lut=this._styleColorTheme.lut;for(const b in this._sourceCaches)this._sourceCaches[b].clearTiles()};if(this._styleColorTheme.colorTheme=n,!n)return this._styleColorTheme.lut=null,void l();const y=this._evaluateColorThemeData(n);this._loadColorTheme(y).then(()=>{this.fire(new r.f("colorthemeset")),l()}).catch(b=>{r.w(`Couldn't set color theme: ${b}`)})}_getTransitionParameters(n){return{now:r.e.now(),transition:r.W(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],l=[];for(const y in this._mergedLayers)this.isLayerDraped(this._mergedLayers[y])?n.push(y):l.push(y);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...l)}_createTerrain(n,l){const y=this.terrain=new ei(n,l,this.scope,this.options);l===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const b=this._getTransitionParameters({duration:0});y.updateTransitions(b)}_force3DLayerUpdate(){for(const n in this._layers){const l=this._layers[n];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const l=this._layers[n];l.type==="symbol"&&this._updateLayer(l)}}_validate(n,l,y,b,T={}){if(T&&T.validate===!1)return!1;const M=r.W({},this.serialize());return lc(this,n.call(Oe,r.W({key:l,style:M,value:y,styleSpec:r.L},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.c_.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(n){const l=this.getSourceCaches(n);for(const y of l)y.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}reloadSource(n){const l=this.getSourceCaches(n);for(const y of l)y.resume(),y.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}updateSources(n){let l;this.directionalLight&&(l=ln(this.directionalLight));for(const y in this._mergedSourceCaches)this._mergedSourceCaches[y].update(n,void 0,void 0,l)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const l=this._sourceCaches[n];l.resume(),l.reload()}}_updatePlacement(n,l,y,b,T,M,D=!1){let F=!1,V=!1;const X={},ie={};for(const ue of this._mergedOrder){const me=this._mergedLayers[ue];if(me.type!=="symbol")continue;const ge=r.al(me.source,me.scope);let _e=X[ge];if(!_e){const Pe=this.getLayerSourceCache(me);if(!Pe)continue;const De=Pe.getRenderableIds(!0).map(ke=>Pe.getTileByID(ke));ie[ge]=De.slice(),_e=X[ge]=De.sort((ke,qe)=>qe.tileID.overscaledZ-ke.tileID.overscaledZ||(ke.tileID.isLessThan(qe.tileID)?-1:1))}const ye=this.crossTileSymbolIndex.addLayer(me,_e,l.center.lng,l.projection);F=F||ye}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),D=D||this._layerOrderChanged||b===0,this._layerOrderChanged&&this.fire(new r.f("neworder")),(D||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.e.now(),l.zoom))&&(this.pauseablePlacement=new Pc(l,this._mergedOrder,D,y,b,T,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,X,ie),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.e.now()),V=!0),F&&this.pauseablePlacement.placement.setStale()),V||F){this._buildingIndex.onNewFrame(l.zoom);for(let ue=0;ue<this._mergedOrder.length;ue++){const me=this._mergedLayers[this._mergedOrder[ue]];if(me.type!=="symbol")continue;const ge=this.isLayerClipped(me)&&this._clipLayerIndices.some(_e=>ue<_e);this.placement.updateLayerOpacities(me,X[r.al(me.source,me.scope)],ue,ge?M:null)}}let le=!1;for(const ue of this._mergedOrder){const me=this._mergedLayers[ue];if(me.type!=="symbol")continue;const ge=X[r.al(me.source,me.scope)];for(const _e of ge){const ye=_e.getBucket(me);ye&&_e.latestFeatureIndex&&me.fqid===ye.layerIds[0]&&(le=ye.updateOcclusionOpacities(n.context,n.symbolParams,n._dt)||le)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.e.now())||le,occlusionQueryBasedOpacityChanged:le}}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,l){this._checkLoaded();const y=this.stylesheet.imports=this.stylesheet.imports||[];if(y.findIndex(({id:T})=>T===n.id)!==-1)return void this.fire(new r.d(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!l)return y.push(n),this._loadImports([n],!0);const b=y.findIndex(({id:T})=>T===l);return b===-1&&this.fire(new r.d(new Error(`Import with id "${l}" does not exist on this map.`))),this.stylesheet.imports=y.slice(0,b).concat(n).concat(y.slice(b)),this._loadImports([n],!0,l)}updateImport(n,l){this._checkLoaded();const y=this.stylesheet.imports||[],b=this.getImportIndex(n);return b===-1?this:typeof l=="string"?(this.setImportUrl(n,l),this):(l.url&&l.url!==y[b].url&&this.setImportUrl(n,l.url),U(l.config,y[b].config)||this.setImportConfig(n,l.config),U(l.data,y[b].data)||this.setImportData(n,l.data),this)}moveImport(n,l){this._checkLoaded();let y=this.stylesheet.imports||[];const b=this.getImportIndex(n);if(b===-1)return this;const T=this.getImportIndex(l);if(T===-1)return this;const M=y[b],D=this.fragments[b];return y=y.filter(({id:F})=>F!==n),this.fragments=this.fragments.filter(({id:F})=>F!==n),this.stylesheet.imports=y.slice(0,T).concat(M).concat(y.slice(T)),this.fragments=this.fragments.slice(0,T).concat(D).concat(this.fragments.slice(T)),this.mergeLayers(),this}setImportUrl(n,l){this._checkLoaded();const y=this.stylesheet.imports||[],b=this.getImportIndex(n);if(b===-1)return this;y[b].url=l;const T=this.fragments[b];return T.style=this._createFragmentStyle(y[b]),T.style.on("style.import.load",()=>this.mergeAll()),T.style.loadURL(l),this}setImportData(n,l){this._checkLoaded();const y=this.getImportIndex(n),b=this.stylesheet.imports||[];return y===-1?this:l?(this.fragments[y].style.setState(l),this._reloadImports(),this):(delete b[y].data,this.setImportUrl(n,b[y].url))}setImportConfig(n,l){this._checkLoaded();const y=this.getImportIndex(n),b=this.stylesheet.imports||[];if(y===-1)return this;l?b[y].config=l:delete b[y].config;const T=this.fragments[y],M=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=l,T.style.updateConfig(l,M),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const l=this.stylesheet.imports||[],y=this.getImportIndex(n);y!==-1&&(l.splice(y,1),this.fragments[y].style._remove(),this.fragments.splice(y,1),this._reloadImports())}getImportIndex(n){const l=(this.stylesheet.imports||[]).findIndex(y=>y.id===n);return l===-1&&this.fire(new r.d(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),l}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const l in this._mergedOtherSourceCaches){const y=this._mergedOtherSourceCaches[l];y&&n.push(y.getSource())}return n}getSource(n,l){const y=this.getSourceCache(n,l);return y&&y.getSource()}getLayerSource(n){const l=this.getLayerSourceCache(n);return l&&l.getSource()}getSourceCache(n,l){const y=r.al(n,l);return this._mergedOtherSourceCaches[y]}getLayerSourceCache(n){const l=r.al(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[l]:this._mergedOtherSourceCaches[l]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const l=[];return this._mergedOtherSourceCaches[n]&&l.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&l.push(this._mergedSymbolSourceCaches[n]),l}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const l in n){const y=n[l];y==="reload"?this.reloadSource(l):y==="clear"&&this.clearSource(l)}}updateLayers(n){const l=this._changes.getUpdatedPaintProperties();for(const y of l){const b=this.getLayer(y);b&&b.updateTransitions(n)}}getImages(n,l,y){this.imageManager.getImages(l.icons,l.scope,y),this._updateTilesForChangedImages();const b=T=>{T&&T.setDependencies(l.tileID.key,l.type,l.icons)};b(this._otherSourceCaches[l.source]),b(this._symbolSourceCaches[l.source])}getGlyphs(n,l,y){this.glyphManager.getGlyphs(l.stacks,l.scope,y)}getResource(n,l,y){return r.c$(l,y)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const l=[];return this._otherSourceCaches[n]&&l.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&l.push(this._symbolSourceCaches[n]),l}_isSourceCacheLoaded(n){const l=this.getOwnSourceCaches(n);return l.length===0?(this.fire(new r.d(new Error(`There is no source with ID '${n}'`))),!1):l.every(y=>y.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,l){if(this._clipLayerIndices.length===0&&n.type!=="fill-extrusion")return!1;const y=n.type==="fill-extrusion"&&n.sourceLayer==="building";let b=0;if(n.is3D()){if(y||l&&l.type==="batched-model")return!0;n.type==="model"&&(b=r.cu.Model)}else n.type==="symbol"&&(b=r.cu.Symbol);for(const T of this._clipLayerIndices){const M=this._mergedLayers[this._mergedOrder[T]];if(!M)continue;const D=[];for(const F of M.layout.get("clip-layer-types"))D.push(F==="model"?r.cu.Model:F==="symbol"?r.cu.Symbol:r.cu.FillExtrusion);for(const F of D)if(b&F)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function $p(p,n){let l=!1,y=null;const b=()=>{y=null,l&&(p(),y=setTimeout(b,n),l=!1)};return()=>(l=!0,y||b(),y)}Wa.getSourceType=function(p){return Cl[p]},Wa.setSourceType=function(p,n){Cl[p]=n},Wa.registerForPluginStateChange=r.cL;class Zp{constructor(n){this._hashName=n&&encodeURIComponent(n),r.bp(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=$p(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const l=Xp(n);if(this._hashName){const y=this._hashName;let b=!1;const T=location.hash.slice(1).split("&").map(M=>{const D=M.split("=")[0];return D===y?(b=!0,`${D}=${l}`):M}).filter(M=>M);return b||T.push(`${y}=${l}`),`#${T.join("&")}`}return`#${l}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(l=y)}),(l&&l[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(y=>isNaN(y))){const y=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(l[3]||0):n.getBearing();return n.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:y,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Xp(p,n){const l=p.getCenter(),y=Math.round(100*p.getZoom())/100,b=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,b),M=Math.round(l.lng*T)/T,D=Math.round(l.lat*T)/T,F=p.getBearing(),V=p.getPitch();let X=n?`/${M}/${D}/${y}`:`${y}/${D}/${M}`;return(F||V)&&(X+="/"+Math.round(10*F)/10),V&&(X+=`/${Math.round(V)}`),X}const Dc={linearity:.3,easing:r.d0(0,0,.3,1)},d0=r.W({deceleration:2500,maxSpeed:1400},Dc),Yp=r.W({deceleration:20,maxSpeed:1400},Dc),rf=r.W({deceleration:1e3,maxSpeed:360},Dc),qh=r.W({deceleration:1e3,maxSpeed:90},Dc);class of{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.e.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,l=r.e.now();for(;n.length>0&&l-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)l.zoom+=T.zoomDelta||0,l.bearing+=T.bearingDelta||0,l.pitch+=T.pitchDelta||0,T.panDelta&&l.pan._add(T.panDelta),T.around&&(l.around=T.around),T.pinchAround&&(l.pinchAround=T.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(l.pan.mag()){const T=hu(l.pan.mag(),y,r.W({},d0,n||{}));b.offset=l.pan.mult(T.amount/l.pan.mag()),b.center=this._map.transform.center,ll(b,T)}if(l.zoom){const T=hu(l.zoom,y,Yp);b.zoom=this._map.transform.zoom+T.amount,ll(b,T)}if(l.bearing){const T=hu(l.bearing,y,rf);b.bearing=this._map.transform.bearing+r.at(T.amount,-179,179),ll(b,T)}if(l.pitch){const T=hu(l.pitch,y,qh);b.pitch=this._map.transform.pitch+T.amount,ll(b,T)}if(b.zoom||b.bearing){const T=l.pinchAround===void 0?l.around:l.pinchAround;b.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function ll(p,n){(!p.duration||p.duration<n.duration)&&(p.duration=n.duration,p.easing=n.easing)}function hu(p,n,l){const{maxSpeed:y,linearity:b,deceleration:T}=l,M=r.at(p*b/(n/1e3),-y,y),D=Math.abs(M)/(T*b);return{easing:l.easing,duration:1e3*D,amount:M*(D/2)}}class Ws extends r.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,y,b={}){const T=ee(l.getCanvasContainer(),y),M=l.unproject(T);super(n,r.W({point:T,lngLat:M,originalEvent:y},b)),this._defaultPrevented=!1,this.target=l}}class Ml extends r.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,y){const b=n==="touchend"?y.changedTouches:y.touches,T=fe(l.getCanvasContainer(),b),M=T.map(F=>l.unproject(F)),D=T.reduce((F,V,X,ie)=>F.add(V.div(ie.length)),new r.P(0,0));super(n,{points:T,point:D,lngLats:M,lngLat:l.unproject(D),originalEvent:y}),this._defaultPrevented=!1}}class sh extends r.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l){super("wheel",{originalEvent:l}),this._defaultPrevented=!1}}class Hh{constructor(n,l){this._map=n,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new sh(this._map,n))}mousedown(n,l){return this._mousedownPos=l,this._firePreventable(new Ws(n.type,this._map,n))}mouseup(n){this._map.fire(new Ws(n.type,this._map,n))}preclick(n){const l=r.W({},n);l.type="preclick",this._map.fire(new Ws(l.type,this._map,l))}click(n,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Ws(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Ws(n.type,this._map,n))}mouseover(n){this._map.fire(new Ws(n.type,this._map,n))}mouseout(n){this._map.fire(new Ws(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Ml(n.type,this._map,n))}touchmove(n){this._map.fire(new Ml(n.type,this._map,n))}touchend(n){this._map.fire(new Ml(n.type,this._map,n))}touchcancel(n){this._map.fire(new Ml(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class sf{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Ws(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ws("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Ws(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ah{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,l){this.isEnabled()&&n.shiftKey&&n.button===0&&(z(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(n,l){if(!this._active)return;const y=l,b=this._startPos,T=this._lastPos;if(!b||!T||T.equals(y)||!this._box&&y.dist(b)<this._clickTolerance)return;this._lastPos=y,this._box||(this._box=Ae("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const M=Math.min(b.x,y.x),D=Math.max(b.x,y.x),F=Math.min(b.y,y.y),V=Math.max(b.y,y.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${M}px,${F}px)`,this._box.style.width=D-M+"px",this._box.style.height=V-F+"px")})}mouseupWindow(n,l){if(!this._active)return;const y=this._startPos,b=l;if(y&&n.button===0){if(this.reset(),Q(),y.x!==b.x||y.y!==b.y)return this._map.fire(new r.f("boxzoomend",{originalEvent:n})),{cameraAnimation:T=>T.fitScreenCoordinates(y,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),q(),delete this._startPos,delete this._lastPos}_fireEvent(n,l){return this._map.fire(new r.f(n,{originalEvent:l}))}}function du(p,n){const l={};for(let y=0;y<p.length;y++)l[p[y].identifier]=n[y];return l}class af{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,l,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),y.length===this.numTouches&&(this.centroid=function(b){const T=new r.P(0,0);for(const M of b)T._add(M);return T.div(b.length)}(l),this.touches=du(y,l)))}touchmove(n,l,y){if(this.aborted||!this.centroid)return;const b=du(y,l);for(const T in this.touches){const M=b[T];(!M||M.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(n,l,y){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class Gh{constructor(n){this.singleTap=new af(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,l,y){this.singleTap.touchstart(n,l,y)}touchmove(n,l,y){this.singleTap.touchmove(n,l,y)}touchend(n,l,y){const b=this.singleTap.touchend(n,l,y);if(b){const T=n.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(b)<30;if(T&&M||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class lf{constructor(){this._zoomIn=new Gh({numTouches:1,numTaps:2}),this._zoomOut=new Gh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,l,y){this._zoomIn.touchstart(n,l,y),this._zoomOut.touchstart(n,l,y)}touchmove(n,l,y){this._zoomIn.touchmove(n,l,y),this._zoomOut.touchmove(n,l,y)}touchend(n,l,y){const b=this._zoomIn.touchend(n,l,y),T=this._zoomOut.touchend(n,l,y);return b?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(b)},{originalEvent:n})}):T?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(T)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Wh={0:1,2:2};class Rc{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,l){return!1}_move(n,l){return{}}mousedown(n,l){if(this._lastPoint)return;const y=ce(n);this._correctButton(n,y)&&(this._lastPoint=l,this._eventButton=y)}mousemoveWindow(n,l){const y=this._lastPoint;if(y){if(n.preventDefault(),this._eventButton!=null&&function(b,T){const M=Wh[T];return b.buttons===void 0||(b.buttons&M)!==M}(n,this._eventButton))this.reset();else if(this._moved||!(l.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(y,l)}}mouseupWindow(n){this._lastPoint&&ce(n)===this._eventButton&&(this._moved&&Q(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kp extends Rc{mousedown(n,l){super.mousedown(n,l),this._lastPoint&&(this._active=!0)}_correctButton(n,l){return l===0&&!n.ctrlKey}_move(n,l){return{around:l,panDelta:l.sub(n)}}}class cf extends Rc{_correctButton(n,l){return l===0&&n.ctrlKey||l===2}_move(n,l){const y=.8*(l.x-n.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(n){n.preventDefault()}}class uf extends Rc{_correctButton(n,l){return l===0&&n.ctrlKey||l===2}_move(n,l){const y=-.5*(l.y-n.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(n){n.preventDefault()}}class fu{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),r.bp(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(n,l,y){return this._calculateTransform(n,l,y)}touchmove(n,l,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(y.length===1&&!r.d1())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,l,y)}}touchend(n,l,y){this._calculateTransform(n,l,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,l,y){y.length>0&&(this._active=!0);const b=du(y,l),T=new r.P(0,0),M=new r.P(0,0);let D=0;for(const V in b){const X=b[V],ie=this._touches[V];ie&&(T._add(X),M._add(X.sub(ie)),D++,b[V]=X)}if(this._touches=b,D<this._minTouches||!M.mag())return;const F=M.div(D);return this._sum._add(F),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(D),panDelta:F}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ae("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class $h{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,l,y){return{}}touchstart(n,l,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([l[0],l[1]]))}touchmove(n,l,y){const b=this._firstTwoTouches;if(!b)return;n.preventDefault();const[T,M]=b,D=Zh(y,l,T),F=Zh(y,l,M);if(!D||!F)return;const V=this._aroundCenter?null:D.add(F).div(2);return this._move([D,F],V,n)}touchend(n,l,y){if(!this._firstTwoTouches)return;const[b,T]=this._firstTwoTouches,M=Zh(y,l,b),D=Zh(y,l,T);M&&D||(this._active&&Q(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Zh(p,n,l){for(let y=0;y<p.length;y++)if(p[y].identifier===l)return n[y]}function Qp(p,n){return Math.log(p/n)/Math.LN2}class f0 extends $h{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,l){const y=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Qp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Qp(this._distance,y),pinchAround:l}}}function Xh(p,n){return 180*p.angleWith(n)/Math.PI}class hf extends $h{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,l){const y=this._vector;if(this._vector=n[0].sub(n[1]),y&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Xh(this._vector,y),pinchAround:l}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const l=25/(Math.PI*this._minDiameter)*360,y=this._startVector;if(!y)return!1;const b=Xh(n,y);return Math.abs(b)<l}}function lh(p){return Math.abs(p.y)>Math.abs(p.x)}class df extends $h{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,lh(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,l,y){const b=this._lastPoints;if(!b)return;const T=n[0].sub(b[0]),M=n[1].sub(b[1]);return this._map._cooperativeGestures&&!r.d1()&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(T,M,y.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(T.y+M.y)/2*-.5})}gestureBeginsVertically(n,l,y){if(this._valid!==void 0)return this._valid;const b=n.mag()>=2,T=l.mag()>=2;if(!b&&!T)return;if(!b||!T)return this._firstMove==null&&(this._firstMove=y),y-this._firstMove<100&&void 0;const M=n.y>0==l.y>0;return lh(n)&&lh(l)&&M}}const Jp={panStep:100,bearingStep:15,pitchStep:10};class em{constructor(){const n=Jp;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let l=0,y=0,b=0,T=0,M=0;switch(n.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:n.shiftKey?y=-1:(n.preventDefault(),T=-1);break;case 39:n.shiftKey?y=1:(n.preventDefault(),T=1);break;case 38:n.shiftKey?b=1:(n.preventDefault(),M=-1);break;case 40:n.shiftKey?b=-1:(n.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(y=0,b=0),{cameraAnimation:D=>{const F=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:p0,zoom:l?Math.round(F)+l*(n.shiftKey?2:1):F,bearing:D.getBearing()+y*this._bearingStep,pitch:D.getPitch()+b*this._pitchStep,offset:[-T*this._panStep,-M*this._panStep],center:D.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function p0(p){return p*(2-p)}const pu=4.000244140625,ch=1/450;class tm{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._handler=l,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ch,r.bp(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||r.d1()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const y=r.e.now(),b=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,l!==0&&l%pu==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(b*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),n.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=n,this._delta-=l,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=ee(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const V=this._type==="wheel"&&Math.abs(this._delta)>pu?this._wheelZoomRate:this._defaultZoomRate;let X=2/(1+Math.exp(-Math.abs(this._delta*V)));this._delta<0&&X!==0&&(X=1/X);const ie=l(),le=Math.pow(2,ie),ue=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):le;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(ue*X))),this._type==="wheel"&&(this._startZoom=ie,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const y=typeof this._targetZoom=="number"?this._targetZoom:l(),b=this._startZoom,T=this._easing;let M,D=!1;if(this._type==="wheel"&&b&&T){const V=Math.min((r.e.now()-this._lastWheelEventTime)/200,1),X=T(V);M=r.a2(b,y,X),V<1?this._frameId||(this._frameId=!0):D=!0}else M=y,D=!0;this._active=!0,D&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let F=M-l();return F*this._lastDelta<0&&(F=0),{noInertia:!0,needsRenderFrame:!D,zoomDelta:F,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let l=r.d2;if(this._prevEase){const y=this._prevEase,b=(r.e.now()-y.start)/y.duration,T=y.easing(b+.01)-y.easing(b),M=.27/Math.sqrt(T*T+1e-4)*.01,D=Math.sqrt(.0729-M*M);l=r.d0(M,D,.25,1)}return this._prevEase={start:r.e.now(),duration:n,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ae("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class aa{constructor(n,l){this._clickZoom=n,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ff{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,l){return n.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(n.shiftKey?-1:1),around:y.unproject(l)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yh{constructor(){this._tap=new Gh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,l,y){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=l[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(n,l,y))}touchmove(n,l,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const b=l[0],T=b.y-this._swipePoint.y;return this._swipePoint=b,n.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(n,l,y)}touchend(n,l,y){this._tapTime?this._swipePoint&&y.length===0&&this.reset():this._tap.touchend(n,l,y)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kh{constructor(n,l,y){this._el=n,this._mousePan=l,this._touchPan=y}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class pf{constructor(n,l,y){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=l,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class mf{constructor(n,l,y,b){this._el=n,this._touchZoom=l,this._touchRotate=y,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const kc=p=>p.zoom||p.drag||p.pitch||p.rotate;class gf extends r.f{}class _f{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,l){const y=r._.sub([],l,n);this.radius=r._.length(y[2]<0?r._.div([],y,this.constants):[y[0],y[1],0])}projectRay(n){r._.div(n,n,this.constants),r._.normalize(n,n),r._.mul(n,n,this.constants);const l=r._.scale([],n,this.radius);if(l[2]>0){const y=r._.scale([],[0,0,1],r._.dot(l,[0,0,1])),b=r._.scale([],r._.normalize([],[l[0],l[1],0]),this.radius),T=r._.add([],l,r._.scale([],r._.sub([],r._.add([],b,y),l),2));l[0]=T[0],l[1]=T[1]}return l}}function Bc(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class im{constructor(n,l){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new of(n),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new _f,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),r.bp(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,T,M]of this._listeners){const D=b===document?this.handleWindowEvent:this.handleEvent;b.addEventListener(T,D,M)}}destroy(){for(const[n,l,y]of this._listeners){const b=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(l,b,y)}}_addDefaultHandlers(n){const l=this._map,y=l.getCanvasContainer();this._add("mapEvent",new Hh(l,n));const b=l.boxZoom=new ah(l,n);this._add("boxZoom",b);const T=new lf,M=new ff;l.doubleClickZoom=new aa(M,T),this._add("tapZoom",T),this._add("clickZoom",M);const D=new Yh;this._add("tapDragZoom",D);const F=l.touchPitch=new df(l);this._add("touchPitch",F);const V=new cf(n),X=new uf(n);l.dragRotate=new pf(n,V,X),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",X,["mouseRotate"]);const ie=new Kp(n),le=new fu(l,n);l.dragPan=new Kh(y,ie,le),this._add("mousePan",ie),this._add("touchPan",le,["touchZoom","touchRotate"]);const ue=new hf,me=new f0;l.touchZoomRotate=new mf(y,me,ue,D),this._add("touchRotate",ue,["touchPan","touchZoom"]),this._add("touchZoom",me,["touchPan","touchRotate"]),this._add("blockableMapEvent",new sf(l));const ge=l.scrollZoom=new tm(l,this);this._add("scrollZoom",ge,["mousePan"]);const _e=l.keyboard=new em;this._add("keyboard",_e);for(const ye of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[ye]&&l[ye].enable(n[ye])}_add(n,l,y){this._handlers.push({handlerName:n,handler:l,allowed:y}),this._handlersById[n]=l}stop(n){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!kc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,l,y){for(const b in n)if(b!==y&&(!l||l.indexOf(b)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const l=[];for(const y of n)this._el.contains(y.target)&&l.push(y);return l}handleEvent(n,l){this._updatingCamera=!0;const y=n.type==="renderFrame",b=y?void 0:n,T={needsRenderFrame:!1},M={},D={},F=n.touches?this._getMapTouches(n.touches):void 0,V=F?fe(this._el,F):y?void 0:ee(this._el,n);for(const{handlerName:le,handler:ue,allowed:me}of this._handlers){if(!ue.isEnabled())continue;let ge;this._blockedByActive(D,me,le)?ue.reset():ue[l||n.type]&&(ge=ue[l||n.type](n,V,F),this.mergeHandlerResult(T,M,ge,le,b),ge&&ge.needsRenderFrame&&this._triggerRenderFrame()),(ge||ue.isActive())&&(D[le]=ue)}const X={};for(const le in this._previousActiveHandlers)D[le]||(X[le]=b);this._previousActiveHandlers=D,(Object.keys(X).length||Bc(T))&&(this._changes.push([T,M,X]),this._triggerRenderFrame()),(Object.keys(D).length||Bc(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ie}=T;ie&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ie(this._map))}mergeHandlerResult(n,l,y,b,T){if(!y)return;r.W(n,y);const M={handlerName:b,originalEvent:y.originalEvent||T};y.zoomDelta!==void 0&&(l.zoom=M),y.panDelta!==void 0&&(l.drag=M),y.pitchDelta!==void 0&&(l.pitch=M),y.bearingDelta!==void 0&&(l.rotate=M)}_applyChanges(){const n={},l={},y={};for(const[b,T,M]of this._changes)b.panDelta&&(n.panDelta=(n.panDelta||new r.P(0,0))._add(b.panDelta)),b.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(n.around=b.around),b.aroundCoord!==void 0&&(n.aroundCoord=b.aroundCoord),b.pinchAround!==void 0&&(n.pinchAround=b.pinchAround),b.noInertia&&(n.noInertia=b.noInertia),r.W(l,T),r.W(y,M);this._updateMapTransform(n,l,y),this._changes=[]}_updateMapTransform(n,l,y){const b=this._map,T=b.transform,M=Pe=>[Pe.x,Pe.y,Pe.z];if((Pe=>{const De=this._eventsInProgress.drag;return De&&!this._handlersById[De.handlerName].isActive()})()&&!Bc(n)){const Pe=T.zoom;T.cameraElevationReference="sea",this._originalZoom!=null&&T._orthographicProjectionAtLowPitch&&T.projection.name!=="globe"&&T.pitch===0?(T.cameraElevationReference="ground",T.zoom=this._originalZoom):(T.recenterOnTerrain(),T.cameraElevationReference="ground"),Pe!==T.zoom&&this._map._update(!0)}if(T._isCameraConstrained&&b._stop(!0),!Bc(n))return void this._fireEvents(l,y,!0);let{panDelta:D,zoomDelta:F,bearingDelta:V,pitchDelta:X,around:ie,aroundCoord:le,pinchAround:ue}=n;T._isCameraConstrained&&(F>0&&(F=0),T._isCameraConstrained=!1),ue!==void 0&&(ie=ue),(F||(Pe=>l[Pe]&&!this._eventsInProgress[Pe])("drag"))&&ie&&(this._dragOrigin=M(T.pointCoordinate3D(ie)),this._originalZoom=T.zoom,this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",b._stop(!0),ie=ie||b.transform.centerPoint,V&&(T.bearing+=V),X&&(T.pitch+=X),T._updateCameraState();const me=[0,0,0];if(D)if(T.projection.name==="mercator"){const Pe=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(ie).dir),De=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(ie.sub(D)).dir);me[0]=De[0]-Pe[0],me[1]=De[1]-Pe[1]}else{const Pe=T.pointCoordinate(ie);if(T.projection.name==="globe"){D=D.rotate(-T.angle);const De=T._pixelsPerMercatorPixel/T.worldSize;me[0]=-D.x*r.d3(r.ay(Pe.y))*De,me[1]=-D.y*r.d3(T.center.lat)*De}else{const De=T.pointCoordinate(ie.sub(D));Pe&&De&&(me[0]=De.x-Pe.x,me[1]=De.y-Pe.y)}}const ge=T.zoom,_e=[0,0,0];if(F){const Pe=M(le||T.pointCoordinate3D(ie)),De={dir:r._.normalize([],r._.sub([],Pe,T._camera.position))};if(De.dir[2]<0){const ke=T.zoomDeltaToMovement(Pe,F);r._.scale(_e,De.dir,ke)}}const ye=r._.add(me,me,_e);T._translateCameraConstrained(ye),F&&Math.abs(T.zoom-ge)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(l,y,!0)}_fireEvents(n,l,y){const b=kc(this._eventsInProgress),T=kc(n),M={};for(const X in n){const{originalEvent:ie}=n[X];this._eventsInProgress[X]||(M[`${X}start`]=ie),this._eventsInProgress[X]=n[X]}!b&&T&&this._fireEvent("movestart",T.originalEvent);for(const X in M)this._fireEvent(X,M[X]);T&&this._fireEvent("move",T.originalEvent);for(const X in n){const{originalEvent:ie}=n[X];this._fireEvent(X,ie)}const D={};let F;for(const X in this._eventsInProgress){const{handlerName:ie,originalEvent:le}=this._eventsInProgress[X];this._handlersById[ie].isActive()||(delete this._eventsInProgress[X],F=l[ie]||le,D[`${X}end`]=F)}for(const X in D)this._fireEvent(X,D[X]);const V=kc(this._eventsInProgress);if(y&&(b||T)&&!V){this._updatingCamera=!0;const X=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ie=le=>le!==0&&-this._bearingSnap<le&&le<this._bearingSnap;X?(ie(X.bearing||this._map.getBearing())&&(X.bearing=0),this._map.easeTo(X,{originalEvent:F})):(this._map.fire(new r.f("moveend",{originalEvent:F})),ie(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,l){this._map.fire(new r.f(n,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new gf("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const yf="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class mu extends r.E{constructor(n,l){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,r.bp(["_renderFrameCallback"],this)}getCenter(){return new r.aI(this.transform.center.lng,this.transform.center.lat)}setCenter(n,l){return this.jumpTo({center:n},l)}panBy(n,l,y){return n=r.P.convert(n).mult(-1),this.panTo(this.transform.center,r.W({offset:n},l),y)}panTo(n,l,y){return this.easeTo(r.W({center:n},l),y)}getZoom(){return this.transform.zoom}setZoom(n,l){return this.jumpTo({zoom:n},l),this}zoomTo(n,l,y){return this.easeTo(r.W({zoom:n},l),y)}zoomIn(n,l){return this.zoomTo(this.getZoom()+1,n,l),this}zoomOut(n,l){return this.zoomTo(this.getZoom()-1,n,l),this}getBearing(){return this.transform.bearing}setBearing(n,l){return this.jumpTo({bearing:n},l),this}getPadding(){return this.transform.padding}setPadding(n,l){return this.jumpTo({padding:n},l),this}rotateTo(n,l,y){return this.easeTo(r.W({bearing:n},l),y)}resetNorth(n,l){return this.rotateTo(0,r.W({duration:1e3},n),l),this}resetNorthPitch(n,l){return this.easeTo(r.W({bearing:0,pitch:0,duration:1e3},n),l),this}snapToNorth(n,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,l):this}getPitch(){return this.transform.pitch}setPitch(n,l){return this.jumpTo({pitch:n},l),this}cameraForBounds(n,l){n=r.ai.convert(n);const y=l&&l.bearing||0,b=l&&l.pitch||0,T=n.getNorthWest(),M=n.getSouthEast();return this._cameraForBounds(this.transform,T,M,y,b,l)}_extendPadding(n){const l={top:0,right:0,bottom:0,left:0};return n==null?r.W({},l,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:r.W({},l,n)}_extendCameraOptions(n){return(n=r.W({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,l){const y=l.max[0]-l.min[0],b=l.max[1]-l.min[1];return y/b>n.aspect?y/(2*Math.tan(.5*n.fovX)*n.aspect):b/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,l,y,b,T,M){const D=n.clone(),F=this._extendCameraOptions(M);D.bearing=b,D.pitch=T;const V=r.aI.convert(l),X=r.aI.convert(y),ie=.5*(V.lat+X.lat),le=.5*(V.lng+X.lng),ue=r.d4(ie,le),me=r._.normalize([],ue),ge=r._.normalize([],r._.cross([],me,[0,1,0])),_e=r._.cross([],ge,me),ye=[ge[0],ge[1],ge[2],0,_e[0],_e[1],_e[2],0,me[0],me[1],me[2],0,0,0,0,1],Pe=[ue,r.d4(V.lat,V.lng),r.d4(X.lat,V.lng),r.d4(X.lat,X.lng),r.d4(V.lat,X.lng),r.d4(ie,V.lng),r.d4(ie,X.lng),r.d4(V.lat,le),r.d4(X.lat,le)];let De=r.b6.fromPoints(Pe.map(Tt=>[r._.dot(ge,Tt),r._.dot(_e,Tt),r._.dot(me,Tt)]));const ke=r._.transformMat4([],De.center,ye);r._.squaredLength(ke)===0&&r._.set(ke,0,0,1),r._.normalize(ke,ke),r._.scale(ke,ke,r.cD),D.center=r.d5(ke);const qe=D.getWorldToCameraMatrix(),Ve=r.ad.invert(new Float64Array(16),qe);De=r.b6.applyTransform(De,r.ad.multiply([],qe,ye));const Ze=this._extendAABB(De,D,F,b);if(!Ze)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");De=Ze,r._.transformMat4(ke,ke,qe);const xe=.5*(De.max[2]-De.min[2]),Be=this._minimumAABBFrustumDistance(D,De),Qe=r._.scale([],[0,0,1],xe),ct=r._.add(Qe,ke,Qe),it=Be+(D.pitch===0?0:r._.distance(ke,ct)),$e=D.globeCenterInViewSpace,ft=r._.sub([],ke,[$e[0],$e[1],$e[2]]);r._.normalize(ft,ft),r._.scale(ft,ft,it);const Pt=r._.add([],ke,ft);r._.transformMat4(Pt,Pt,Ve);const Dt=r.d7/r.cD,Lt=r._.length(Pt),ot=r.ax(Math.max(Lt*Dt-r.d7,Number.EPSILON),0),gt=Math.min(D.zoomFromMercatorZAdjusted(ot),F.maxZoom);return gt>.5*(r.b1+r.aU)?(D.setProjection({name:"mercator"}),D.zoom=gt,this._cameraForBounds(D,l,y,b,T,M)):{center:D.center,zoom:gt,bearing:b,pitch:T}}_extendAABB(n,l,y,b){const T=.5*((y.padding.left||0)+(y.padding.right||0)),M=.5*((y.padding.top||0)+(y.padding.bottom||0)),D=M,F=T,V=T,X=M,ie=l.width-(F+V),le=l.height-(D+X),ue=r._.sub([],n.max,n.min),me=Math.min(ie/ue[0],le/ue[1]),ge=Math.min(l.scaleZoom(l.scale*me),y.maxZoom);if(isNaN(ge))return null;const _e=l.scale/l.zoomScale(ge),ye=new r.b6([n.min[0]-F*_e,n.min[1]-X*_e,n.min[2]],[n.max[0]+V*_e,n.max[1]+D*_e,n.max[2]]),Pe=(typeof y.offset.x=="number"&&typeof y.offset.y=="number"?new r.P(y.offset.x,y.offset.y):r.P.convert(y.offset)).rotate(-r.ab(b));return ye.center[0]-=Pe.x*_e,ye.center[1]+=Pe.y*_e,ye}queryTerrainElevation(n,l){const y=this.transform.elevation;return y?(l=r.W({},{exaggerated:!0},l),y.getAtPoint(r.Y.fromLngLat(n),null,l.exaggerated)):null}_cameraForBounds(n,l,y,b,T,M){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,l,y,b,T,M);const D=n.clone(),F=this._extendCameraOptions(M);D.bearing=b,D.pitch=T;const V=r.aI.convert(l),X=r.aI.convert(y),ie=new r.aI(V.lng,X.lat),le=new r.aI(X.lng,V.lat),ue=D.project(V),me=D.project(X),ge=this.queryTerrainElevation(V),_e=this.queryTerrainElevation(X),ye=this.queryTerrainElevation(ie),Pe=this.queryTerrainElevation(le),De=[[ue.x,ue.y,Math.min(ge||0,_e||0,ye||0,Pe||0)],[me.x,me.y,Math.max(ge||0,_e||0,ye||0,Pe||0)]];let ke=r.b6.fromPoints(De);const qe=D.getWorldToCameraMatrix(),Ve=r.ad.invert(new Float64Array(16),qe);ke=r.b6.applyTransform(ke,qe);const Ze=this._extendAABB(ke,D,F,b);if(!Ze)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ke=Ze;const xe=.5*r._.sub([],ke.max,ke.min)[2],Be=this._minimumAABBFrustumDistance(D,ke),Qe=[0,0,1,0];r.aA.transformMat4(Qe,Qe,qe),r.aA.normalize(Qe,Qe);const ct=r._.scale([],Qe,Be+xe),it=r._.add([],ke.center,ct);r._.transformMat4(ke.center,ke.center,Ve),r._.transformMat4(it,it,Ve);const $e=[ke.center[0],ke.center[1],it[2]*D.pixelsPerMeter];r._.scale($e,$e,1/D.worldSize);const ft=r.d6($e[0]),Pt=r.ay($e[1]),Dt=Math.min(D._zoomFromMercatorZ($e[2]),F.maxZoom),Lt=new r.aI(ft,Pt);return D.mercatorFromTransition&&Dt<.5*(r.b1+r.aU)?(D.setProjection({name:"globe"}),D.zoom=Dt,this._cameraForBounds(D,l,y,b,T,M)):{center:Lt,zoom:Dt,bearing:b,pitch:T}}fitBounds(n,l,y){const b=this.cameraForBounds(n,l);return this._fitInternal(b,l,y)}fitScreenCoordinates(n,l,y,b,T){const M=r.P.convert(n),D=r.P.convert(l),F=new r.P(Math.min(M.x,D.x),Math.min(M.y,D.y)),V=new r.P(Math.max(M.x,D.x),Math.max(M.y,D.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(M,D))return this;const X=this.transform.pointLocation3D(F),ie=this.transform.pointLocation3D(V),le=this.transform.pointLocation3D(new r.P(F.x,V.y)),ue=this.transform.pointLocation3D(new r.P(V.x,F.y)),me=[Math.min(X.lng,ie.lng,le.lng,ue.lng),Math.min(X.lat,ie.lat,le.lat,ue.lat)],ge=[Math.max(X.lng,ie.lng,le.lng,ue.lng),Math.max(X.lat,ie.lat,le.lat,ue.lat)],_e=b&&b.pitch?b.pitch:this.getPitch(),ye=this._cameraForBounds(this.transform,me,ge,y,_e,b);return this._fitInternal(ye,b,T)}_fitInternal(n,l,y){return n?(l=r.W(n,l)).linear?this.easeTo(l,y):this.flyTo(l,y):this}jumpTo(n,l){this.stop();const y=n.preloadOnly?this.transform.clone():this.transform;let b=!1,T=!1,M=!1;if("zoom"in n&&y.zoom!==+n.zoom&&(b=!0,y.zoom=+n.zoom),n.center!==void 0&&(y.center=r.aI.convert(n.center)),"bearing"in n&&y.bearing!==+n.bearing&&(T=!0,y.bearing=+n.bearing),"pitch"in n&&y.pitch!==+n.pitch&&(M=!0,y.pitch=+n.pitch),n.padding!=null){const D=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;y.isPaddingEqual(D)||(y.padding=D)}return n.preloadOnly?(this._preloadTiles(y),this):(this.fire(new r.f("movestart",l)).fire(new r.f("move",l)),b&&this.fire(new r.f("zoomstart",l)).fire(new r.f("zoom",l)).fire(new r.f("zoomend",l)),T&&this.fire(new r.f("rotatestart",l)).fire(new r.f("rotate",l)).fire(new r.f("rotateend",l)),M&&this.fire(new r.f("pitchstart",l)).fire(new r.f("pitch",l)).fire(new r.f("pitchend",l)),this.fire(new r.f("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(yf),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,l){const y=this.transform;if(!y.projection.supportsFreeCamera)return r.w(yf),this;this.stop();const b=y.zoom,T=y.pitch,M=y.bearing;y.setFreeCameraOptions(n);const D=b!==y.zoom,F=T!==y.pitch,V=M!==y.bearing;return this.fire(new r.f("movestart",l)).fire(new r.f("move",l)),D&&this.fire(new r.f("zoomstart",l)).fire(new r.f("zoom",l)).fire(new r.f("zoomend",l)),V&&this.fire(new r.f("rotatestart",l)).fire(new r.f("rotate",l)).fire(new r.f("rotateend",l)),F&&this.fire(new r.f("pitchstart",l)).fire(new r.f("pitch",l)).fire(new r.f("pitchend",l)),this.fire(new r.f("moveend",l)),this}easeTo(n,l){this._stop(!1,n.easeId),((n=r.W({offset:[0,0],duration:500,easing:r.d2},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const y=this.transform,b=this.getZoom(),T=this.getBearing(),M=this.getPitch(),D=this.getPadding(),F="zoom"in n?+n.zoom:b,V="bearing"in n?this._normalizeBearing(n.bearing,T):T,X="pitch"in n?+n.pitch:M,ie=this._extendPadding(n.padding),le=r.P.convert(n.offset);let ue,me,ge;if(y.projection.name==="globe"){const Be=r.Y.fromLngLat(y.center),Qe=le.rotate(-y.angle);Be.x+=Qe.x/y.worldSize,Be.y+=Qe.y/y.worldSize;const ct=Be.toLngLat(),it=r.aI.convert(n.center||ct);this._normalizeCenter(it),ue=y.centerPoint.add(Qe),me=new r.P(Be.x,Be.y).mult(y.worldSize),ge=new r.P(r.aj(it.lng),r.ak(it.lat)).mult(y.worldSize).sub(me)}else{ue=y.centerPoint.add(le);const Be=y.pointLocation(ue),Qe=r.aI.convert(n.center||Be);this._normalizeCenter(Qe),me=y.project(Be),ge=y.project(Qe).sub(me)}const _e=y.zoomScale(F-b);let ye,Pe;n.around&&(ye=r.aI.convert(n.around),Pe=y.locationPoint(ye));const De=this._zooming||F!==b,ke=this._rotating||T!==V,qe=this._pitching||X!==M,Ve=!y.isPaddingEqual(ie),Ze=Be=>Qe=>{if(De&&(Be.zoom=r.a2(b,F,Qe)),ke&&(Be.bearing=r.a2(T,V,Qe)),qe&&(Be.pitch=r.a2(M,X,Qe)),Ve&&(Be.interpolatePadding(D,ie,Qe),ue=Be.centerPoint.add(le)),ye)Be.setLocationAtPoint(ye,Pe);else{const ct=Be.zoomScale(Be.zoom-b),it=F>b?Math.min(2,_e):Math.max(.5,_e),$e=Math.pow(it,1-Qe),ft=Be.unproject(me.add(ge.mult(Qe*$e)).mult(ct));Be.setLocationAtPoint(Be.renderWorldCopies?ft.wrap():ft,ue)}return n.preloadOnly||this._fireMoveEvents(l),Be};if(n.preloadOnly){const Be=this._emulate(Ze,n.duration,y);return this._preloadTiles(Be),this}const xe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=De,this._rotating=ke,this._pitching=qe,this._padding=Ve,this._easeId=n.easeId,this._prepareEase(l,n.noMoveStart,xe),this._ease(Ze(y),Be=>{y.cameraElevationReference==="sea"&&y.recenterOnTerrain(),this._afterEase(l,Be)},n),this}_prepareEase(n,l,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),l||y.moving||this.fire(new r.f("movestart",n)),this._zooming&&!y.zooming&&this.fire(new r.f("zoomstart",n)),this._rotating&&!y.rotating&&this.fire(new r.f("rotatestart",n)),this._pitching&&!y.pitching&&this.fire(new r.f("pitchstart",n))}_fireMoveEvents(n){this.fire(new r.f("move",n)),this._zooming&&this.fire(new r.f("zoom",n)),this._rotating&&this.fire(new r.f("rotate",n)),this._pitching&&this.fire(new r.f("pitch",n))}_afterEase(n,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,b=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new r.f("zoomend",n)),b&&this.fire(new r.f("rotateend",n)),T&&this.fire(new r.f("pitchend",n)),this.fire(new r.f("moveend",n))}flyTo(n,l){if(this._prefersReducedMotion(n)){const gt=r.ah(n,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(gt,l)}this.stop(),n=r.W({offset:[0,0],speed:1.2,curve:1.42,easing:r.d2},n);const y=this.transform,b=this.getZoom(),T=this.getBearing(),M=this.getPitch(),D=this.getPadding(),F="zoom"in n?r.at(+n.zoom,y.minZoom,y.maxZoom):b,V="bearing"in n?this._normalizeBearing(n.bearing,T):T,X="pitch"in n?+n.pitch:M,ie=this._extendPadding(n.padding),le=y.zoomScale(F-b),ue=r.P.convert(n.offset);let me=y.centerPoint.add(ue);const ge=y.pointLocation(me),_e=r.aI.convert(n.center||ge);this._normalizeCenter(_e);const ye=y.project(ge),Pe=y.project(_e).sub(ye);let De=n.curve;const ke=Math.max(y.width,y.height),qe=ke/le,Ve=Pe.mag();if("minZoom"in n){const gt=r.at(Math.min(n.minZoom,b,F),y.minZoom,y.maxZoom),Tt=ke/y.zoomScale(gt-b);De=Math.sqrt(Tt/Ve*2)}const Ze=De*De;function xe(gt){const Tt=(qe*qe-ke*ke+(gt?-1:1)*Ze*Ze*Ve*Ve)/(2*(gt?qe:ke)*Ze*Ve);return Math.log(Math.sqrt(Tt*Tt+1)-Tt)}function Be(gt){return(Math.exp(gt)-Math.exp(-gt))/2}function Qe(gt){return(Math.exp(gt)+Math.exp(-gt))/2}const ct=xe(0);let it=function(gt){return Qe(ct)/Qe(ct+De*gt)},$e=function(gt){return ke*((Qe(ct)*(Be(Tt=ct+De*gt)/Qe(Tt))-Be(ct))/Ze)/Ve;var Tt},ft=(xe(1)-ct)/De;if(Math.abs(Ve)<1e-6||!isFinite(ft)){if(Math.abs(ke-qe)<1e-6)return this.easeTo(n,l);const gt=qe<ke?-1:1;ft=Math.abs(Math.log(qe/ke))/De,$e=function(){return 0},it=function(Tt){return Math.exp(gt*De*Tt)}}n.duration="duration"in n?+n.duration:1e3*ft/("screenSpeed"in n?+n.screenSpeed/De:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const Pt=T!==V,Dt=X!==M,Lt=!y.isPaddingEqual(ie),ot=gt=>Tt=>{const Kt=Tt*ft,Qt=1/it(Kt);gt.zoom=Tt===1?F:b+gt.scaleZoom(Qt),Pt&&(gt.bearing=r.a2(T,V,Tt)),Dt&&(gt.pitch=r.a2(M,X,Tt)),Lt&&(gt.interpolatePadding(D,ie,Tt),me=gt.centerPoint.add(ue));const ni=Tt===1?_e:gt.unproject(ye.add(Pe.mult($e(Kt))).mult(Qt));return gt.setLocationAtPoint(gt.renderWorldCopies?ni.wrap():ni,me),gt._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(l),gt};if(n.preloadOnly){const gt=this._emulate(ot,n.duration,y);return this._preloadTiles(gt),this}return this._zooming=!0,this._rotating=Pt,this._pitching=Dt,this._padding=Lt,this._prepareEase(l,!1),this._ease(ot(y),()=>this._afterEase(l),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,l)}if(!n){const y=this.handlers;y&&y.stop(!1)}return this}_ease(n,l,y){y.animate===!1||y.duration===0?(n(1),l()):(this._easeStart=r.e.now(),this._easeOptions=y,this._onEaseFrame=n,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((r.e.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,l){n=r.au(n,-180,180);const y=Math.abs(n-l);return Math.abs(n-360-l)<y&&(n-=360),Math.abs(n+360-l)<y&&(n+=360),n}_normalizeCenter(n){const l=this.transform;if(l.maxBounds||l.projection.name!=="globe"&&!l.renderWorldCopies)return;const y=n.lng-l.center.lng;n.lng+=y>180?-360:y<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&r.e.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,l,y){const b=Math.ceil(15*l/1e3),T=[],M=n(y.clone());for(let D=0;D<=b;D++){const F=M(D/b);T.push(F.clone())}return T}_preloadTiles(n,l){}}class nm{constructor(n={}){this.options=n,r.bp(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const l=this.options&&this.options.compact;return this._map=n,this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ae("button","mapboxgl-ctrl-attrib-button",this._container),Ae("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ae("div","mapboxgl-ctrl-attrib-inner",this._container),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,l){const y=this._map._getUIString(`AttributionControl.${l}`);n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",y)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.d8.ACCESS_TOKEN}];if(n){const y=l.reduce((b,T,M)=>(T.value&&(b+=`${T.key}=${T.value}${M<l.length-1?"&":""}`),b),"?");n.href=`${r.d8.FEEDBACK_URL}/${y}#${Xp(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const l=this._map.style._mergedSourceCaches;for(const b in l){const T=l[b];if(T.used){const M=T.getSource();M.attribution&&n.indexOf(M.attribution)<0&&n.push(M.attribution)}}n.sort((b,T)=>b.length-T.length),n=n.filter((b,T)=>{for(let M=T+1;M<n.length;M++)if(n[M].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const y=n.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,n.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class rm{constructor(){r.bp(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=Ae("div","mapboxgl-ctrl");const l=Ae("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const l in n){const y=n[l].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class om{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const l=++this._id;return this._queue.push({callback:n,id:l,cancelled:!1}),l}remove(n){const l=this._currentlyRunning,y=l?this._queue.concat(l):this._queue;for(const b of y)if(b.id===n)return void(b.cancelled=!0)}run(n=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const y of l)if(!y.cancelled&&(y.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function sm(p,n,l){if(p=new r.aI(p.lng,p.lat),n){const y=new r.aI(p.lng-360,p.lat),b=new r.aI(p.lng+360,p.lat),T=360*Math.ceil(Math.abs(p.lng-l.center.lng)/360),M=l.locationPoint(p).distSqr(n),D=n.x<0||n.y<0||n.x>l.width||n.y>l.height;l.locationPoint(y).distSqr(n)<M&&(D||Math.abs(y.lng-l.center.lng)<T)?p=y:l.locationPoint(b).distSqr(n)<M&&(D||Math.abs(b.lng-l.center.lng)<T)&&(p=b)}for(;Math.abs(p.lng-l.center.lng)>180;){const y=l.locationPoint(p);if(y.x>=0&&y.y>=0&&y.x<=l.width&&y.y<=l.height)break;p.lng>l.center.lng?p.lng-=360:p.lng+=360}return p}const vf={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class xf extends r.E{constructor(n,l){if(super(),(n instanceof HTMLElement||l)&&(n=r.W({element:n},l)),r.bp(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=r.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ae("div");const T=41,M=27,D=Ce("svg",{display:"block",height:T*this._scale+"px",width:M*this._scale+"px",viewBox:`0 0 ${M} ${T}`},this._element),F=Ce("radialGradient",{id:"shadowGradient"},Ce("defs",{},D));Ce("stop",{offset:"10%","stop-opacity":.4},F),Ce("stop",{offset:"100%","stop-opacity":.05},F),Ce("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},D),Ce("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},D),Ce("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},D),Ce("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},D),this._offset=r.P.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",T=>{T.preventDefault()}),this._element.addEventListener("mousedown",T=>{T.preventDefault()});const y=this._element.classList;for(const T in vf)y.remove(`mapboxgl-marker-anchor-${T}`);y.add(`mapboxgl-marker-anchor-${this._anchor}`);const b=n&&n.className?n.className.trim().split(/\s+/):[];y.add(...b),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=r.aI.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const l=n.code,y=n.charCode||n.keyCode;l!=="Space"&&l!=="Enter"&&y!==32&&y!==13||this.togglePopup()}_onMapClick(n){const l=n.originalEvent.target,y=this._element;this._popup&&(l===y||y.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,l=this._pos;if(!n||!l)return!1;const y=n.unproject(l),b=n.getFreeCameraOptions();if(!b.position)return!1;const T=b.position.toLngLat();return T.distanceTo(y)<.9*T.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const l=this._pos;if(!l||l.x<0||l.x>n.transform.width||l.y<0||l.y>n.transform.height)return void this._clearFadeTimer();const y=n.unproject(l);let b;n._showingGlobe()&&r.d9(n.transform,this._lngLat)?b=0:(b=1-n._queryFogOpacity(y),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${vf[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const n=this._pos,l=this._map,y=this.getPitchAlignment();if(!l||!n||y!=="map")return"";if(!l._showingGlobe()){const F=l.getPitch();return F?`rotateX(${F}deg)`:""}const b=r.b0(r.da(l.transform,this._lngLat)),T=n.sub(r.db(l.transform)),M=Math.abs(T.x)+Math.abs(T.y);if(M===0)return"";const D=b/M;return`rotateX(${-T.y*D}deg) rotateY(${T.x*D}deg)`}_calculateZTransform(){const n=this._pos,l=this._map;if(!l||!n)return"";let y=0;const b=this.getRotationAlignment();if(b==="map")if(l._showingGlobe()){const T=l.project(new r.aI(this._lngLat.lng,this._lngLat.lat+.001)),M=l.project(new r.aI(this._lngLat.lng,this._lngLat.lat-.001)).sub(T);y=r.b0(Math.atan2(M.y,M.x))-90}else y=-l.getBearing();else if(b==="horizon"){const T=r.$(4,6,l.getZoom()),M=r.db(l.transform);M.y+=T*l.transform.height;const D=n.sub(M),F=r.b0(Math.atan2(D.y,D.x));y=(F>90?F-270:F+90)*(1-T)}return y+=this._rotation,y?`rotateZ(${y}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=sm(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=r.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const l=this._map;if(!l)return;const y=this._pointerdownPos,b=this._positionDelta;if(y&&b){if(!this._isDragging){const T=this._clickTolerance||l._clickTolerance;if(n.point.dist(y)<T)return;this._isDragging=!0}this._pos=n.point.sub(b),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.f("dragstart"))),this.fire(new r.f("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.f("dragend")),this._state="inactive"}_addDragHandler(n){const l=this._map,y=this._pos;l&&y&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(y),this._pointerdownPos=n.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const l=this._map;return l&&(n?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const wf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},bf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Cf(p=new r.P(0,0),n="bottom"){if(typeof p=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(n){case"top":return new r.P(0,p);case"top-left":return new r.P(l,l);case"top-right":return new r.P(-l,l);case"bottom":return new r.P(0,-p);case"bottom-left":return new r.P(l,-l);case"bottom-right":return new r.P(-l,-l);case"left":return new r.P(p,0);case"right":return new r.P(-p,0)}return new r.P(0,0)}return p instanceof r.P||Array.isArray(p)?r.P.convert(p):r.P.convert(p[n]||[0,0])}class gu{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const l=r.b9((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,l,y){this._start=this.getValue(l),this._end=n,this._startTime=l,this._endTime=l+y}}const am={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class lm{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const cm={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},Ef={showCompass:!0,showZoom:!0,visualizePitch:!1};class Nc{constructor(n,l,y=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new cf({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,y&&(this.mousePitch=new uf({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),r.bp(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(n,l){this.mouseRotate.mousedown(n,l),this.mousePitch&&this.mousePitch.mousedown(n,l),z()}move(n,l){const y=this.map,b=this.mouseRotate.mousemoveWindow(n,l),T=b&&b.bearingDelta;if(T&&y.setBearing(y.getBearing()+T),this.mousePitch){const M=this.mousePitch.mousemoveWindow(n,l),D=M&&M.pitchDelta;D&&y.setPitch(y.getPitch()+D)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){q(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(r.W({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),ee(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,ee(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=fe(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=fe(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const um={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Fc={maxWidth:100,unit:"metric"},hm={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:r.dt,supported:W,setRTLTextPlugin:r.dv,getRTLTextPluginStatus:r.dw,Map:class extends mu{constructor(p){r.dc.mark(r.dd.create);const n=p;if((p=r.W({},cm,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&r.de(window)&&(p.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Dr(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._repaint=!!p.repaint,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new om,this._domRenderTaskQueue=new om,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.df(),this._locale=r.W({},am,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._tessellationStep=p.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new gu(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._lastDirtyFrameId=0,this._requestManager=new r.dg(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?{...p.contextCreateOptions}:{},typeof p.container=="string"){const l=document.getElementById(p.container);if(!l)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=l}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),r.bp(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new lm),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new im(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||r.d8.DEFAULT_STYLE,{config:p.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),p.hash&&(this._hash=new Zp(typeof p.hash=="string"&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});const l=p.bounds;l&&(this.resize(),this.fitBounds(l,r.W({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new nm({customAttribution:p.customAttribution})),this._logoControl=new rm,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new r.f(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new r.f(`${l.dataType}dataloading`,l))})}_getMapId(){return this._mapId}addControl(p,n){if(n===void 0&&(n=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new r.d(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=p.onAdd(this);this._controls.push(p);const y=this._controlPositions[n];return n.indexOf("bottom")!==-1?y.insertBefore(l,y.firstChild):y.appendChild(l),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new r.d(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(p);return n>-1&&this._controls.splice(n,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new r.f("movestart",p)).fire(new r.f("move",p)),this.fire(new r.f("resize",p)),n&&this.fire(new r.f("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(r.ai.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new r.f("zoomstart")).fire(new r.f("zoom")).fire(new r.f("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new r.f("zoomstart")).fire(new r.f("zoom")).fire(new r.f("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new r.f("pitchstart")).fire(new r.f("pitch")).fire(new r.f("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new r.f("pitchstart")).fire(new r.f("pitch")).fire(new r.f("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(n=>n==="auto"?navigator.language:n):p}setLanguage(p){const n=this._parseLanguage(p);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const p=this.transform,n=p.projection.name;let l;n==="globe"&&p.zoom>=r.aU?(p.setMercatorFromTransition(),l=!0):n==="mercator"&&p.zoom<r.aU&&(p.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(p,n){return this._updateProjection(p||n||{name:"mercator"})}_updateProjection(p){let n;return n=p.name==="globe"&&this.transform.zoom>=r.aU?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p){return this.transform.locationPoint3D(r.aI.convert(p))}unproject(p){return this.transform.pointLocation3D(r.P.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,n,l){if(p==="mouseenter"||p==="mouseover"){let y=!1;const b=M=>{const D=n.filter(V=>this.getLayer(V)),F=D.length?this.queryRenderedFeatures(M.point,{layers:D}):[];F.length?y||(y=!0,l.call(this,new Ws(p,this,M.originalEvent,{features:F}))):y=!1},T=()=>{y=!1};return{layers:new Set(n),listener:l,delegates:{mousemove:b,mouseout:T}}}if(p==="mouseleave"||p==="mouseout"){let y=!1;const b=M=>{const D=n.filter(F=>this.getLayer(F));(D.length?this.queryRenderedFeatures(M.point,{layers:D}):[]).length?y=!0:y&&(y=!1,l.call(this,new Ws(p,this,M.originalEvent)))},T=M=>{y&&(y=!1,l.call(this,new Ws(p,this,M.originalEvent)))};return{layers:new Set(n),listener:l,delegates:{mousemove:b,mouseout:T}}}{const y=b=>{const T=n.filter(D=>this.getLayer(D)),M=T.length?this.queryRenderedFeatures(b.point,{layers:T}):[];M.length&&(b.features=M,l.call(this,b),delete b.features)};return{layers:new Set(n),listener:l,delegates:{[p]:y}}}}on(p,n,l){if(typeof n=="function"||l===void 0)return super.on(p,n);if(Array.isArray(n)||(n=[n]),n){for(const b of n)if(!this._isValidId(b))return this}const y=this._createDelegatedListener(p,n,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(y);for(const b in y.delegates)this.on(b,y.delegates[b]);return this}once(p,n,l){if(typeof n=="function"||l===void 0)return super.once(p,n);if(Array.isArray(n)||(n=[n]),n){for(const b of n)if(!this._isValidId(b))return this}const y=this._createDelegatedListener(p,n,l);for(const b in y.delegates)this.once(b,y.delegates[b]);return this}off(p,n,l){if(typeof n=="function"||l===void 0)return super.off(p,n);const y=new Set(Array.isArray(n)?n:[n]);for(const M of y)if(!this._isValidId(M))return this;const b=(M,D)=>{if(M.size!==D.size)return!1;for(const F of M)if(!D.has(F))return!1;return!0},T=this._delegatedListeners?this._delegatedListeners[p]:void 0;return T&&(M=>{for(let D=0;D<M.length;D++){const F=M[D];if(F.listener===l&&b(F.layers,y)){for(const V in F.delegates)this.off(V,F.delegates[V]);return M.splice(D,1),this}}})(T),this}queryRenderedFeatures(p,n){if(!this.style)return[];if(n!==void 0||p===void 0||p instanceof r.P||Array.isArray(p)||(n=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],(n=n||{}).layers&&Array.isArray(n.layers)){for(const l of n.layers)if(!this._isValidId(l))return[]}return this.style.queryRenderedFeatures(p,n,this.transform)}querySourceFeatures(p,n){return this._isValidId(p)?this.style.querySourceFeatures(p,n):[]}isPointOnSurface(p){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&r.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(p))}setStyle(p,n){return n=r.W({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&p&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(p,(l,y)=>{l?(r.w(`Unable to perform style diff: ${String(l.message||l.error||l)}. Rebuilding the style from scratch.`),this._updateStyle(p,n)):y&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(p,n))}_getUIString(p){const n=this._locale[p];if(n==null)throw new Error(`Missing UI string '${p}'`);return n}_updateStyle(p,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p){const l=r.W({},n);n&&n.config&&(l.initialConfig=n.config,delete l.config),this.style=new Wa(this,l).load(p),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Wa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(p){return p==null?(this.fire(new r.d(new Error("IDs can't be empty."))),!1):!r.cV(p)||(this.fire(new r.d(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}addSource(p,n){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,n),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,n,l){this._lazyInitEmptyStyle(),this.style.addSourceType(p,n,l)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,n,{pixelRatio:l=1,sdf:y=!1,stretchX:b,stretchY:T,content:M}={}){if(this._lazyInitEmptyStyle(),n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:D,height:F,data:V}=r.e.getImageData(n);this.style.addImage(p,{data:new r.i({width:D,height:F},V),pixelRatio:l,stretchX:b,stretchY:T,content:M,sdf:y,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new r.d(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:D,height:F}=n,V=n;this.style.addImage(p,{data:new r.i({width:D,height:F},new Uint8Array(V.data)),pixelRatio:l,stretchX:b,stretchY:T,content:M,sdf:y,version:0,userImage:V}),V.onAdd&&V.onAdd(this,p)}}updateImage(p,n){this._lazyInitEmptyStyle();const l=this.style.getImage(p);if(!l)return void this.fire(new r.d(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?r.e.getImageData(n):n,{width:b,height:T,data:M}=y;if(b===void 0||T===void 0)return void this.fire(new r.d(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==l.data.width||T!==l.data.height)return void this.fire(new r.d(new Error(`The width and height of the updated image (${b}, ${T})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`)));const D=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);l.data.replace(M,D),this.style.updateImage(p,l)}hasImage(p){return p?!!this.style&&!!this.style.getImage(p):(this.fire(new r.d(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,n){r.h(this._requestManager.transformRequest(p,r.R.Image),(l,y)=>{n(l,y instanceof HTMLImageElement?r.e.getImageData(y):y)})}listImages(){return this.style.listImages()}addModel(p,n){this._lazyInitEmptyStyle(),this.style.addModel(p,n)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new r.d(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,n){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,n),this._update(!0)):this}getSlot(p){const n=this.getLayer(p);return n&&n.slot||null}setSlot(p,n){return this.style.setSlot(p,n),this.style.mergeLayers(),this._update(!0)}addImport(p,n){return this.style.addImport(p,n),this}updateImport(p,n){return typeof n!="string"&&n.id!==p?(this.removeImport(p),this.addImport(n)):(this.style.updateImport(p,n),this._update(!0))}removeImport(p){return this.style.removeImport(p),this}moveImport(p,n){return this.style.moveImport(p,n),this._update(!0)}moveLayer(p,n){return this._isValidId(p)?(this.style.moveLayer(p,n),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){if(!this._isValidId(p))return null;const n=this.style.getOwnLayer(p);return n?n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(p,n,l){return this._isValidId(p)?(this.style.setLayerZoomRange(p,n,l),this._update(!0)):this}setFilter(p,n,l={}){return this._isValidId(p)?(this.style.setFilter(p,n,l),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,n,l,y={}){return this._isValidId(p)?(this.style.setPaintProperty(p,n,l,y),this._update(!0)):this}getPaintProperty(p,n){return this._isValidId(p)?this.style.getPaintProperty(p,n):null}setLayoutProperty(p,n,l,y={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,n,l,y),this._update(!0)):this}getLayoutProperty(p,n){return this._isValidId(p)?this.style.getLayoutProperty(p,n):null}getSchema(p){return this.style.getSchema(p)}setSchema(p,n){return this.style.setSchema(p,n),this._update(!0)}getConfig(p){return this.style.getConfig(p)}setConfig(p,n){return this.style.setConfig(p,n),this._update(!0)}getConfigProperty(p,n){return this.style.getConfigProperty(p,n)}setConfigProperty(p,n,l){return this.style.setConfigProperty(p,n,l),this._update(!0)}setLights(p){if(this._lazyInitEmptyStyle(),p&&p.length===1&&p[0].type==="flat"){const n=p[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const p=this.style.getLights()||[];return p.length===0&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(p){return this._lazyInitEmptyStyle(),this.style.setColorTheme(p),this._update(!0)}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch(p["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.aI.convert(p),this.transform):0}setFeatureState(p,n){return this._isValidId(p.source)?(this.style.setFeatureState(p,n),this._update()):this}removeFeatureState(p,n){return this._isValidId(p.source)?(this.style.removeFeatureState(p,n),this._update()):this}getFeatureState(p){return this._isValidId(p.source)?this.style.getFeatureState(p):null}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let l,y,b,T=this._container;for(;T&&(!y||!b);){const M=window.getComputedStyle(T).transform;M&&M!=="none"&&(l=M.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(y=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(b=l[3])),T=T.parentElement}this._containerWidth=y?Math.abs(p/y):p,this._containerHeight=b?Math.abs(n/b):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ae("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=Ae("div","mapboxgl-canvas-container",p);this._canvas=Ae("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=Ae("div","mapboxgl-control-container",p),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{y[b]=Ae("div",`mapboxgl-ctrl-${b}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,n){const l=r.e.devicePixelRatio||1;this._canvas.width=l*Math.ceil(p),this._canvas.height=l*Math.ceil(n),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${n}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const n=this._markers.indexOf(p);n!==-1&&this._markers.splice(n,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const n=this._popups.indexOf(p);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const p=r.W({},W.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",p);n?(r.dh(n,!0),this.painter=new oe(n,this._contextCreateOptions,this.transform,this._tp),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.di.testSupport(n)):this.fire(new r.d(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.f("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new r.f("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty&&!this._occlusionOpacityChanged&&this._occlusionCriteriaSatisfied()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let n;this.fire(new r.f("renderstart")),++this._frameId;const l=this.painter.context.extTimerQuery,y=r.e.now(),b=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=b.createQuery(),b.beginQuery(l.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const V=this.transform.zoom,X=this.transform.pitch,ie=r.e.now(),le=new r.X(V,{now:ie,fadeDuration:T,pitch:X,transition:this.style.transition});this.style.update(le)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let M=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),M=this._updateAverageElevation(y),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):M=this._updateAverageElevation(y);const D=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions,this.painter.replacementSource);if(D&&(this._placementDirty=D.needsRerender,this._occlusionOpacityChanged=D.occlusionQueryBasedOpacityChanged),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.f("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,r.dc.mark(r.dd.load),this.fire(new r.f("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const V=r.e.now()-y;b.endQuery(l.TIME_ELAPSED_EXT),setTimeout(()=>{const X=b.getQueryParameter(n,b.QUERY_RESULT)/1e6;b.deleteQuery(n),this.fire(new r.f("gpu-timing-frame",{cpuTime:V,gpuTime:X}))},50)}if(this.listens("gpu-timing-layer")){const V=this.painter.collectGpuTimers();setTimeout(()=>{const X=this.painter.queryGpuTimers(V);this.fire(new r.f("gpu-timing-layer",{layerTimes:X}))},50)}if(this.listens("gpu-timing-deferred-render")){const V=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const X=this.painter.queryGpuTimeDeferredRender(V);this.fire(new r.f("gpu-timing-deferred-render",{gpuTime:X}))},50)}const F=this._sourcesDirty||this._styleDirty||this._placementDirty||this._occlusionOpacityChanged||M;if((this._sourcesDirty||this._styleDirty||M||this._occlusionOpacityChanged)&&(this._lastDirtyFrameId=this._frameId),F||this._repaint||!this._occlusionCriteriaSatisfied())this.triggerRepaint();else{const V=!this.isMoving()&&this.loaded();if(V&&(M=this._updateAverageElevation(y,!0)),M)this.triggerRepaint();else if(this._triggerFrame(!1),V&&(this.fire(new r.f("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const X=this._calculateSpeedIndex();this.fire(new r.f("speedindexcompleted",{speedIndex:X})),this.speedIndexTiming=!1}}this._loaded&&!this._fullyLoaded&&!F&&this._occlusionCriteriaSatisfied()&&(this._fullyLoaded=!0,r.dc.mark(r.dd.fullLoad),this._performanceMetricsCollection&&r.dj(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const n of this._markers)p&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!p||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(p,n=!1){const l=b=>(this.transform.averageElevation=b,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);const y=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(y||(n||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const b=this.transform.averageElevation;let T=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(T)?T=0:this._averageElevationLastSampledAt=p;const M=Math.abs(b-T);if(M>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(T),l(T);this._averageElevation.easeTo(T,p,300)}else if(M>1e-4)return this._averageElevation.jumpTo(T),l(T)}return!!this._averageElevation.isEasing(p)&&l(this._averageElevation.getValue(p))}_authenticate(){r.dk(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===r.dl||p.status===401)){const n=this.painter.context.gl;r.dh(n,!1),this._logoControl instanceof rm&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.d(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),r.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&r.dn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const l=this.painter.context.gl,y=l.createFramebuffer();function b(T){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,T,0);const M=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,M),M}return l.bindFramebuffer(l.FRAMEBUFFER,y),this._canvasPixelComparison(b(p),n.canvasCopies.map(b),n.timeStamps)}_canvasPixelComparison(p,n,l){let y=l[1]-l[0];const b=p.length/4;for(let T=0;T<n.length;T++){const M=n[T];let D=0;for(let F=0;F<M.length;F+=4)M[F]===p[F]&&M[F+1]===p[F+1]&&M[F+2]===p[F+2]&&M[F+3]===p[F+3]&&(D+=1);y+=(l[T+2]-l[T+1])*(1-D/b)}return y}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),r.dp(this.painter.context.gl),r.dq.remove(),r.dr.remove(),this._removed=!0,this.fire(new r.f("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=r.e.frame(n=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(n)}))}_preloadTiles(p){const n=this.style?this.style.getSourceCaches():[];return r.ds(n,(l,y)=>l._preloadTiles(p,y),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(p){this._showParseStatus!==p&&(this._showParseStatus=p,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,this._tp.refreshUI(),p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,this._tp.refreshUI(),p&&this._update())}_setCacheLimits(p,n){r.du(p,n)}_occlusionCriteriaSatisfied(){const p=this.style&&(this.style.has3DLayers()||this.style.terrain&&!this.style.disableElevatedTerrain);return!(this.style&&this.style.hasSymbolLayers()&&p&&this.painter)||this._frameId-this._lastDirtyFrameId>5+2*this.painter.symbolParams.occlusionQueryFrameWindow}get version(){return r.dt}},NavigationControl:class{constructor(p={}){this.options=r.W({},Ef,p),this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(r.bp(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),Ae("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),Ae("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.bp(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:n}):l.resetNorth({},{originalEvent:n}))}),this._compassIcon=Ae("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const n=p.getZoom(),l=n===p.getMaxZoom(),y=n===p.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Nc(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,n){const l=Ae("button",p,this._container);return l.type="button",l.addEventListener("click",n),l}_setButtonTitle(p,n){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${n}`);p.setAttribute("aria-label",l),p.firstElementChild&&p.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends r.E{constructor(p={}){super();const n=navigator.geolocation;this.options=r.W({geolocation:n},um,p),r.bp(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=$p(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const n=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,p(l)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(l=>n(l.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(p){const n=this._map.getMaxBounds(),l=p.coords;return!!n&&(l.longitude<n.getWest()||l.longitude>n.getEast()||l.latitude<n.getSouth()||l.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new r.f("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.f("geolocate",p)),this._finish()}}_updateCamera(p){const n=new r.aI(p.coords.longitude,p.coords.latitude),l=p.coords.accuracy,y=this._map.getBearing(),b=r.W({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(l),b,{geolocateSource:!0})}_updateMarker(p){if(p){const n=new r.aI(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,n=r.ax(1,p._center.lat)*p.worldSize,l=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.f("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=Ae("button","mapboxgl-ctrl-geolocate",this._container),Ae("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ae("div","mapboxgl-user-location"),this._dotElement.appendChild(Ae("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ae("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new xf({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ae("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new xf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.f("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.f("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.f("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.f("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:nm,ScaleControl:class{constructor(p={}){this.options=r.W({},Fc,p),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.bp(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,n=this._map,l=n._containerHeight/2,y=n._containerWidth/2-p/2,b=n.unproject([y,l]),T=n.unproject([y+p,l]),M=b.distanceTo(T);if(this.options.unit==="imperial"){const D=3.2808*M;D>5280?this._setScale(p,D/5280,"mile"):this._setScale(p,D,"foot")}else this.options.unit==="nautical"?this._setScale(p,M/1852,"nautical-mile"):M>=1e3?this._setScale(p,M/1e3,"kilometer"):this._setScale(p,M,"meter")}_setScale(p,n,l){this._map._requestDomTask(()=>{const y=function(T){const M=Math.pow(10,`${Math.floor(T)}`.length-1);let D=T/M;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function(F){const V=Math.pow(10,Math.ceil(-Math.log(F)/Math.LN10));return Math.round(F*V)/V}(D),M*D}(n),b=y/n;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(y):`${y}&nbsp;${hm[l]}`,this._container.style.width=p*b+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p={}){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:r.w("Full screen control 'container' must be a DOM element.")),r.bp(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=Ae("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ae("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(p){super(),this.options=r.W(Object.create(wf),p),r.bp(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new r.f("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new r.f("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=r.aI.convert(p),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const n=document.createDocumentFragment(),l=document.createElement("body");let y;for(l.innerHTML=p;y=l.firstChild,y;)n.appendChild(y);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=Ae("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(p),this.options.closeButton){const l=this._closeButton=Ae("button","mapboxgl-popup-close-button",n);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let n;return this._classList.delete(p)?n=!1:(this._classList.add(p),n=!0),this._updateClassList(),n}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const n=this._map,l=this._container,y=this._pos;if(!n||!l||!y)return"bottom";const b=l.offsetWidth,T=l.offsetHeight,M=y.x<b/2,D=y.x>n.transform.width-b/2;if(y.y+p<T)return M?"top-left":D?"top-right":"top";if(y.y>n.transform.height-T){if(M)return"bottom-left";if(D)return"bottom-right"}return M?"left":D?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),p.className=n.join(" ")}_update(p){const n=this._map,l=this._content;if(!n||!this._lngLat&&!this._trackPointer||!l)return;let y=this._container;if(y||(y=this._container=Ae("div","mapboxgl-popup",n.getContainer()),this._tip=Ae("div","mapboxgl-popup-tip",y),y.appendChild(l)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=sm(this._lngLat,this._pos,n.transform)),!this._trackPointer||p){const b=this._pos=this._trackPointer&&p instanceof r.P?p:n.project(this._lngLat),T=Cf(this.options.offset),M=this._anchor=this._getAnchor(T.y),D=Cf(this.options.offset,M),F=b.add(D).round();n._requestDomTask(()=>{this._container&&M&&(this._container.style.transform=`${vf[M]} translate(${F.x}px,${F.y}px)`)})}if(!this._marker&&n._showingGlobe()){const b=r.d9(n.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(bf);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:xf,Style:Wa,LngLat:r.aI,LngLatBounds:r.ai,Point:r.P,MercatorCoordinate:r.Y,FreeCameraOptions:_a,Evented:r.E,config:r.d8,prewarm:r.dx,clearPrewarmedResources:r.dy,get accessToken(){return r.d8.ACCESS_TOKEN},set accessToken(p){r.d8.ACCESS_TOKEN=p},get baseApiUrl(){return r.d8.API_URL},set baseApiUrl(p){r.d8.API_URL=p},get workerCount(){return r.dz.workerCount},set workerCount(p){r.dz.workerCount=p},get maxParallelImageRequests(){return r.d8.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){r.d8.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){r.dA(p)},get workerUrl(){return r.dB.workerUrl},set workerUrl(p){r.dB.workerUrl=p},get workerClass(){return r.dB.workerClass},set workerClass(p){r.dB.workerClass=p},get workerParams(){return r.dB.workerParams},set workerParams(p){r.dB.workerParams=p},get dracoUrl(){return r.dC()},set dracoUrl(p){r.dD(p)},get meshoptUrl(){return r.dE()},set meshoptUrl(p){r.dF(p)},setNow:r.e.setNow,restoreNow:r.e.restoreNow}});var O=A;return O})})(z2);var N3=z2.exports;const F3=t0(N3);var Wd=V3,z3=Object.prototype.hasOwnProperty;function V3(){for(var d={},s=0;s<arguments.length;s++){var u=arguments[s];for(var g in u)z3.call(u,g)&&(d[g]=u[g])}return d}var U2={exports:{}};(function(d,s){(function(){var u={};d.exports=u,u.simpleFilter=function(g,A){return A.filter(function(E){return u.test(g,E)})},u.test=function(g,A){return u.match(g,A)!==null},u.match=function(g,A,E){E=E||{};var O=0,r=[],U=A.length,W=0,Y=0,se=E.pre||"",Ae=E.post||"",Ce=E.caseSensitive&&A||A.toLowerCase(),he;g=E.caseSensitive&&g||g.toLowerCase();for(var K=0;K<U;K++)he=A[K],Ce[K]===g[O]?(he=se+he+Ae,O+=1,Y+=1+Y):Y=0,W+=Y,r[r.length]=he;return O===g.length?(W=Ce===g?1/0:W,{rendered:r.join(""),score:W}):null},u.filter=function(g,A,E){return!A||A.length===0?[]:typeof g!="string"?A:(E=E||{},A.reduce(function(O,r,U,W){var Y=r;E.extract&&(Y=E.extract(r));var se=u.match(g,Y,E);return se!=null&&(O[O.length]={string:se.rendered,score:se.score,index:U,original:r}),O},[]).sort(function(O,r){var U=r.score-O.score;return U||O.index-r.index}))}})()})(U2);var U3=U2.exports,Ba=function(d){return this.component=d,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,d.el.parentNode.insertBefore(this.wrapper,d.el.nextSibling),this};Ba.prototype.show=function(){this.element.style.display="block"};Ba.prototype.hide=function(){this.element.style.display="none"};Ba.prototype.add=function(d){this.items.push(d)};Ba.prototype.clear=function(){this.items=[],this.active=0};Ba.prototype.isEmpty=function(){return!this.items.length};Ba.prototype.isVisible=function(){return this.element.style.display==="block"};Ba.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var d=0;d<this.items.length;d++)this.drawItem(this.items[d],this.active===d);this.show()};Ba.prototype.drawItem=function(d,s){var u=document.createElement("li"),g=document.createElement("a");s&&(u.className+=" active"),g.innerHTML=d.string,u.appendChild(g),this.element.appendChild(u),u.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),u.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,d)}).bind(this))};Ba.prototype.handleMouseUp=function(d){this.selectingListItem=!1,this.component.value(d.original),this.clear(),this.draw()};Ba.prototype.move=function(d){this.active=d,this.draw()};Ba.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};Ba.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};Ba.prototype.drawError=function(d){var s=document.createElement("li");s.innerHTML=d,this.element.appendChild(s),this.show()};var j3=Ba,q3=Wd,H3=U3,G3=j3,Ks=function(d,s,u){return u=u||{},this.options=q3({minLength:2,limit:5,filter:!0,hideOnBlur:!0},u),this.el=d,this.data=s||[],this.list=new G3(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(g){this.handleKeyUp(g.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(g){this.handleKeyDown(g)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(g){this.handlePaste(g)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Ks.prototype.handleKeyUp=function(d){d===40||d===38||d===27||d===13||d===9||this.handleInputChange(this.el.value)};Ks.prototype.handleKeyDown=function(d){switch(d.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&d.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Ks.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Ks.prototype.handlePaste=function(d){if(d.clipboardData)this.handleInputChange(d.clipboardData.getData("Text"));else{var s=this;setTimeout(function(){s.handleInputChange(d.target.value)},100)}};Ks.prototype.handleInputChange=function(d){if(this.query=this.normalize(d),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(s){for(var u=0;u<s.length&&(this.list.add(s[u]),u!==this.options.limit-1);u++);this.list.draw()}).bind(this))};Ks.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Ks.prototype.update=function(d){this.data=d,this.handleKeyUp()};Ks.prototype.clear=function(){this.data=[],this.list.clear()};Ks.prototype.normalize=function(d){return d=d.toLowerCase(),d};Ks.prototype.match=function(d,s){return d.indexOf(s)>-1};Ks.prototype.value=function(d){if(this.selected=d,this.el.value=this.getItemValue(d),document.createEvent){var s=document.createEvent("HTMLEvents");s.initEvent("change",!0,!1),this.el.dispatchEvent(s)}else this.el.fireEvent("onchange")};Ks.prototype.getCandidates=function(d){var s={pre:"<strong>",post:"</strong>",extract:(function(g){return this.getItemValue(g)}).bind(this)},u;this.options.filter?(u=H3.filter(this.query,this.data,s),u=u.map((function(g){return{original:g.original,string:this.render(g.original,g.string)}}).bind(this))):u=this.data.map((function(g){var A=this.render(g);return{original:g,string:A}}).bind(this)),d(u)};Ks.prototype.getItemValue=function(d){return d};Ks.prototype.render=function(d,s){if(s)return s;for(var u=d.original?this.getItemValue(d.original):this.getItemValue(d),g=this.normalize(u),A=g.lastIndexOf(this.query);A>-1;){var E=A+this.query.length;u=u.slice(0,A)+"<strong>"+u.slice(A,E)+"</strong>"+u.slice(E),A=g.slice(0,A).lastIndexOf(this.query)}return u};Ks.prototype.renderError=function(d){this.list.drawError(d)};var W3=Ks,j2=W3,$3=j2;typeof window<"u"&&(window.Suggestions=j2);var Z3="Expected a function",lb=0/0,X3="[object Symbol]",Y3=/^\s+|\s+$/g,K3=/^[-+]0x[0-9a-f]+$/i,Q3=/^0b[01]+$/i,J3=/^0o[0-7]+$/i,eM=parseInt,tM=typeof Po=="object"&&Po&&Po.Object===Object&&Po,iM=typeof self=="object"&&self&&self.Object===Object&&self,nM=tM||iM||Function("return this")(),rM=Object.prototype,oM=rM.toString,sM=Math.max,aM=Math.min,o_=function(){return nM.Date.now()};function lM(d,s,u){var g,A,E,O,r,U,W=0,Y=!1,se=!1,Ae=!0;if(typeof d!="function")throw new TypeError(Z3);s=cb(s)||0,L_(u)&&(Y=!!u.leading,se="maxWait"in u,E=se?sM(cb(u.maxWait)||0,s):E,Ae="trailing"in u?!!u.trailing:Ae);function Ce(fe){var ce=g,Ue=A;return g=A=void 0,W=fe,O=d.apply(Ue,ce),O}function he(fe){return W=fe,r=setTimeout(z,s),Y?Ce(fe):O}function K(fe){var ce=fe-U,Ue=fe-W,He=s-ce;return se?aM(He,E-Ue):He}function N(fe){var ce=fe-U,Ue=fe-W;return U===void 0||ce>=s||ce<0||se&&Ue>=E}function z(){var fe=o_();if(N(fe))return q(fe);r=setTimeout(z,K(fe))}function q(fe){return r=void 0,Ae&&g?Ce(fe):(g=A=void 0,O)}function G(){r!==void 0&&clearTimeout(r),W=0,g=U=A=r=void 0}function Q(){return r===void 0?O:q(o_())}function ee(){var fe=o_(),ce=N(fe);if(g=arguments,A=this,U=fe,ce){if(r===void 0)return he(U);if(se)return r=setTimeout(z,s),Ce(U)}return r===void 0&&(r=setTimeout(z,s)),O}return ee.cancel=G,ee.flush=Q,ee}function L_(d){var s=typeof d;return!!d&&(s=="object"||s=="function")}function cM(d){return!!d&&typeof d=="object"}function uM(d){return typeof d=="symbol"||cM(d)&&oM.call(d)==X3}function cb(d){if(typeof d=="number")return d;if(uM(d))return lb;if(L_(d)){var s=typeof d.valueOf=="function"?d.valueOf():d;d=L_(s)?s+"":s}if(typeof d!="string")return d===0?d:+d;d=d.replace(Y3,"");var u=Q3.test(d);return u||J3.test(d)?eM(d.slice(2),u?2:8):K3.test(d)?lb:+d}var hM=lM,Q_={exports:{}},Dd=typeof Reflect=="object"?Reflect:null,ub=Dd&&typeof Dd.apply=="function"?Dd.apply:function(s,u,g){return Function.prototype.apply.call(s,u,g)},Ig;Dd&&typeof Dd.ownKeys=="function"?Ig=Dd.ownKeys:Object.getOwnPropertySymbols?Ig=function(s){return Object.getOwnPropertyNames(s).concat(Object.getOwnPropertySymbols(s))}:Ig=function(s){return Object.getOwnPropertyNames(s)};function dM(d){console&&console.warn&&console.warn(d)}var q2=Number.isNaN||function(s){return s!==s};function oo(){oo.init.call(this)}Q_.exports=oo;Q_.exports.once=gM;oo.EventEmitter=oo;oo.prototype._events=void 0;oo.prototype._eventsCount=0;oo.prototype._maxListeners=void 0;var hb=10;function i0(d){if(typeof d!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof d)}Object.defineProperty(oo,"defaultMaxListeners",{enumerable:!0,get:function(){return hb},set:function(d){if(typeof d!="number"||d<0||q2(d))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+d+".");hb=d}});oo.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};oo.prototype.setMaxListeners=function(s){if(typeof s!="number"||s<0||q2(s))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+s+".");return this._maxListeners=s,this};function H2(d){return d._maxListeners===void 0?oo.defaultMaxListeners:d._maxListeners}oo.prototype.getMaxListeners=function(){return H2(this)};oo.prototype.emit=function(s){for(var u=[],g=1;g<arguments.length;g++)u.push(arguments[g]);var A=s==="error",E=this._events;if(E!==void 0)A=A&&E.error===void 0;else if(!A)return!1;if(A){var O;if(u.length>0&&(O=u[0]),O instanceof Error)throw O;var r=new Error("Unhandled error."+(O?" ("+O.message+")":""));throw r.context=O,r}var U=E[s];if(U===void 0)return!1;if(typeof U=="function")ub(U,this,u);else for(var W=U.length,Y=X2(U,W),g=0;g<W;++g)ub(Y[g],this,u);return!0};function G2(d,s,u,g){var A,E,O;if(i0(u),E=d._events,E===void 0?(E=d._events=Object.create(null),d._eventsCount=0):(E.newListener!==void 0&&(d.emit("newListener",s,u.listener?u.listener:u),E=d._events),O=E[s]),O===void 0)O=E[s]=u,++d._eventsCount;else if(typeof O=="function"?O=E[s]=g?[u,O]:[O,u]:g?O.unshift(u):O.push(u),A=H2(d),A>0&&O.length>A&&!O.warned){O.warned=!0;var r=new Error("Possible EventEmitter memory leak detected. "+O.length+" "+String(s)+" listeners added. Use emitter.setMaxListeners() to increase limit");r.name="MaxListenersExceededWarning",r.emitter=d,r.type=s,r.count=O.length,dM(r)}return d}oo.prototype.addListener=function(s,u){return G2(this,s,u,!1)};oo.prototype.on=oo.prototype.addListener;oo.prototype.prependListener=function(s,u){return G2(this,s,u,!0)};function fM(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function W2(d,s,u){var g={fired:!1,wrapFn:void 0,target:d,type:s,listener:u},A=fM.bind(g);return A.listener=u,g.wrapFn=A,A}oo.prototype.once=function(s,u){return i0(u),this.on(s,W2(this,s,u)),this};oo.prototype.prependOnceListener=function(s,u){return i0(u),this.prependListener(s,W2(this,s,u)),this};oo.prototype.removeListener=function(s,u){var g,A,E,O,r;if(i0(u),A=this._events,A===void 0)return this;if(g=A[s],g===void 0)return this;if(g===u||g.listener===u)--this._eventsCount===0?this._events=Object.create(null):(delete A[s],A.removeListener&&this.emit("removeListener",s,g.listener||u));else if(typeof g!="function"){for(E=-1,O=g.length-1;O>=0;O--)if(g[O]===u||g[O].listener===u){r=g[O].listener,E=O;break}if(E<0)return this;E===0?g.shift():pM(g,E),g.length===1&&(A[s]=g[0]),A.removeListener!==void 0&&this.emit("removeListener",s,r||u)}return this};oo.prototype.off=oo.prototype.removeListener;oo.prototype.removeAllListeners=function(s){var u,g,A;if(g=this._events,g===void 0)return this;if(g.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):g[s]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete g[s]),this;if(arguments.length===0){var E=Object.keys(g),O;for(A=0;A<E.length;++A)O=E[A],O!=="removeListener"&&this.removeAllListeners(O);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(u=g[s],typeof u=="function")this.removeListener(s,u);else if(u!==void 0)for(A=u.length-1;A>=0;A--)this.removeListener(s,u[A]);return this};function $2(d,s,u){var g=d._events;if(g===void 0)return[];var A=g[s];return A===void 0?[]:typeof A=="function"?u?[A.listener||A]:[A]:u?mM(A):X2(A,A.length)}oo.prototype.listeners=function(s){return $2(this,s,!0)};oo.prototype.rawListeners=function(s){return $2(this,s,!1)};oo.listenerCount=function(d,s){return typeof d.listenerCount=="function"?d.listenerCount(s):Z2.call(d,s)};oo.prototype.listenerCount=Z2;function Z2(d){var s=this._events;if(s!==void 0){var u=s[d];if(typeof u=="function")return 1;if(u!==void 0)return u.length}return 0}oo.prototype.eventNames=function(){return this._eventsCount>0?Ig(this._events):[]};function X2(d,s){for(var u=new Array(s),g=0;g<s;++g)u[g]=d[g];return u}function pM(d,s){for(;s+1<d.length;s++)d[s]=d[s+1];d.pop()}function mM(d){for(var s=new Array(d.length),u=0;u<s.length;++u)s[u]=d[u].listener||d[u];return s}function gM(d,s){return new Promise(function(u,g){function A(O){d.removeListener(s,E),g(O)}function E(){typeof d.removeListener=="function"&&d.removeListener("error",A),u([].slice.call(arguments))}Y2(d,s,E,{once:!0}),s!=="error"&&_M(d,A,{once:!0})})}function _M(d,s,u){typeof d.on=="function"&&Y2(d,"error",s,u)}function Y2(d,s,u,g){if(typeof d.on=="function")g.once?d.once(s,u):d.on(s,u);else if(typeof d.addEventListener=="function")d.addEventListener(s,function A(E){g.once&&d.removeEventListener(s,A),u(E)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof d)}var yM=Q_.exports,vM={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function xM(d){var s=d.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return s?{key:s[1],value:s[2]}:null}function wM(d){var s=d.match(/<?([^>]*)>(.*)/);if(!s)return null;var u=s[1],g=s[2].split(";"),A=null,E=g.reduce(function(O,r){var U=xM(r);return U?U.key==="rel"?(A||(A=U.value),O):(O[U.key]=U.value,O):O},{});return A?{url:u,rel:A,params:E}:null}function bM(d){return d?d.split(/,\s*</).reduce(function(s,u){var g=wM(u);if(!g)return s;var A=g.rel.split(/\s+/);return A.forEach(function(E){s[E]||(s[E]={url:g.url,params:g.params})}),s},{}):{}}var CM=bM,EM=CM;function J_(d,s){this.request=d,this.headers=s.headers,this.rawBody=s.body,this.statusCode=s.statusCode;try{this.body=JSON.parse(s.body||"{}")}catch{this.body=s.body}this.links=EM(this.headers.link)}J_.prototype.hasNextPage=function(){return!!this.links.next};J_.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var TM=J_,n0={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},db=n0;function SM(d){var s=d.type||db.ERROR_HTTP,u;if(d.body)try{u=JSON.parse(d.body)}catch{u=d.body}else u=null;var g=d.message||null;g||(typeof u=="string"?g=u:u&&typeof u.message=="string"?g=u.message:s===db.ERROR_REQUEST_ABORTED&&(g="Request aborted")),this.message=g,this.type=s,this.statusCode=d.statusCode||null,this.request=d.request,this.body=u}var AM=SM;function IM(d){var s=d.indexOf(":"),u=d.substring(0,s).trim().toLowerCase(),g=d.substring(s+1).trim();return{name:u,value:g}}function MM(d){var s={};return d&&d.trim().split(/[\r|\n]+/).forEach(function(u){var g=IM(u);s[g.name]=g.value}),s}var LM=MM,OM=TM,fb=AM,s_=n0,PM=LM,Ng={};function DM(d){var s=Ng[d.id];s&&(s.abort(),delete Ng[d.id])}function RM(d,s){return new OM(d,{body:s.response,headers:PM(s.getAllResponseHeaders()),statusCode:s.status})}function pb(d){var s=d.total,u=d.loaded,g=100*u/s;return{total:s,transferred:u,percent:g}}function K2(d,s){return new Promise(function(u,g){s.onprogress=function(O){d.emitter.emit(s_.EVENT_PROGRESS_DOWNLOAD,pb(O))};var A=d.file;A&&(s.upload.onprogress=function(O){d.emitter.emit(s_.EVENT_PROGRESS_UPLOAD,pb(O))}),s.onerror=function(O){g(O)},s.onabort=function(){var O=new fb({request:d,type:s_.ERROR_REQUEST_ABORTED});g(O)},s.onload=function(){if(delete Ng[d.id],s.status<200||s.status>=400){var O=new fb({request:d,body:s.response,statusCode:s.status});g(O);return}u(s)};var E=d.body;typeof E=="string"?s.send(E):E?s.send(JSON.stringify(E)):A?s.send(A):s.send(),Ng[d.id]=s}).then(function(u){return RM(d,u)})}function Q2(d,s){var u=d.url(s),g=new window.XMLHttpRequest;return g.open(d.method,u),Object.keys(d.headers).forEach(function(A){g.setRequestHeader(A,d.headers[A])}),g}function kM(d){return Promise.resolve().then(function(){var s=Q2(d,d.client.accessToken);return K2(d,s)})}var BM={browserAbort:DM,sendRequestXhr:K2,browserSend:kM,createRequestXhr:Q2},Fg={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */Fg.exports;(function(d,s){(function(u){var g=s,A=d&&d.exports==g&&d,E=typeof Po=="object"&&Po;(E.global===E||E.window===E)&&(u=E);var O=function(he){this.message=he};O.prototype=new Error,O.prototype.name="InvalidCharacterError";var r=function(he){throw new O(he)},U="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",W=/[\t\n\f\r ]/g,Y=function(he){he=String(he).replace(W,"");var K=he.length;K%4==0&&(he=he.replace(/==?$/,""),K=he.length),(K%4==1||/[^+a-zA-Z0-9/]/.test(he))&&r("Invalid character: the string to be decoded is not correctly encoded.");for(var N=0,z,q,G="",Q=-1;++Q<K;)q=U.indexOf(he.charAt(Q)),z=N%4?z*64+q:q,N++%4&&(G+=String.fromCharCode(255&z>>(-2*N&6)));return G},se=function(he){he=String(he),/[^\0-\xFF]/.test(he)&&r("The string to be encoded contains characters outside of the Latin1 range.");for(var K=he.length%3,N="",z=-1,q,G,Q,ee,fe=he.length-K;++z<fe;)q=he.charCodeAt(z)<<16,G=he.charCodeAt(++z)<<8,Q=he.charCodeAt(++z),ee=q+G+Q,N+=U.charAt(ee>>18&63)+U.charAt(ee>>12&63)+U.charAt(ee>>6&63)+U.charAt(ee&63);return K==2?(q=he.charCodeAt(z)<<8,G=he.charCodeAt(++z),ee=q+G,N+=U.charAt(ee>>10)+U.charAt(ee>>4&63)+U.charAt(ee<<2&63)+"="):K==1&&(ee=he.charCodeAt(z),N+=U.charAt(ee>>2)+U.charAt(ee<<4&63)+"=="),N},Ae={encode:se,decode:Y,version:"0.1.0"};if(g&&!g.nodeType)if(A)A.exports=Ae;else for(var Ce in Ae)Ae.hasOwnProperty(Ce)&&(g[Ce]=Ae[Ce]);else u.base64=Ae})(Po)})(Fg,Fg.exports);var NM=Fg.exports,FM=NM,a_={};function zM(d){if(a_[d])return a_[d];var s=d.split("."),u=s[0],g=s[1];if(!g)throw new Error("Invalid token");var A=VM(g),E={usage:u,user:A.u};return Ih(A,"a")&&(E.authorization=A.a),Ih(A,"exp")&&(E.expires=A.exp*1e3),Ih(A,"iat")&&(E.created=A.iat*1e3),Ih(A,"scopes")&&(E.scopes=A.scopes),Ih(A,"client")&&(E.client=A.client),Ih(A,"ll")&&(E.lastLogin=A.ll),Ih(A,"iu")&&(E.impersonator=A.iu),a_[d]=E,E}function VM(d){try{return JSON.parse(FM.decode(d))}catch{throw new Error("Invalid token")}}function Ih(d,s){return Object.prototype.hasOwnProperty.call(d,s)}var J2=zM,eC={exports:{}};(function(d){var s=Object.prototype.hasOwnProperty,u="~";function g(){}Object.create&&(g.prototype=Object.create(null),new g().__proto__||(u=!1));function A(U,W,Y){this.fn=U,this.context=W,this.once=Y||!1}function E(U,W,Y,se,Ae){if(typeof Y!="function")throw new TypeError("The listener must be a function");var Ce=new A(Y,se||U,Ae),he=u?u+W:W;return U._events[he]?U._events[he].fn?U._events[he]=[U._events[he],Ce]:U._events[he].push(Ce):(U._events[he]=Ce,U._eventsCount++),U}function O(U,W){--U._eventsCount===0?U._events=new g:delete U._events[W]}function r(){this._events=new g,this._eventsCount=0}r.prototype.eventNames=function(){var W=[],Y,se;if(this._eventsCount===0)return W;for(se in Y=this._events)s.call(Y,se)&&W.push(u?se.slice(1):se);return Object.getOwnPropertySymbols?W.concat(Object.getOwnPropertySymbols(Y)):W},r.prototype.listeners=function(W){var Y=u?u+W:W,se=this._events[Y];if(!se)return[];if(se.fn)return[se.fn];for(var Ae=0,Ce=se.length,he=new Array(Ce);Ae<Ce;Ae++)he[Ae]=se[Ae].fn;return he},r.prototype.listenerCount=function(W){var Y=u?u+W:W,se=this._events[Y];return se?se.fn?1:se.length:0},r.prototype.emit=function(W,Y,se,Ae,Ce,he){var K=u?u+W:W;if(!this._events[K])return!1;var N=this._events[K],z=arguments.length,q,G;if(N.fn){switch(N.once&&this.removeListener(W,N.fn,void 0,!0),z){case 1:return N.fn.call(N.context),!0;case 2:return N.fn.call(N.context,Y),!0;case 3:return N.fn.call(N.context,Y,se),!0;case 4:return N.fn.call(N.context,Y,se,Ae),!0;case 5:return N.fn.call(N.context,Y,se,Ae,Ce),!0;case 6:return N.fn.call(N.context,Y,se,Ae,Ce,he),!0}for(G=1,q=new Array(z-1);G<z;G++)q[G-1]=arguments[G];N.fn.apply(N.context,q)}else{var Q=N.length,ee;for(G=0;G<Q;G++)switch(N[G].once&&this.removeListener(W,N[G].fn,void 0,!0),z){case 1:N[G].fn.call(N[G].context);break;case 2:N[G].fn.call(N[G].context,Y);break;case 3:N[G].fn.call(N[G].context,Y,se);break;case 4:N[G].fn.call(N[G].context,Y,se,Ae);break;default:if(!q)for(ee=1,q=new Array(z-1);ee<z;ee++)q[ee-1]=arguments[ee];N[G].fn.apply(N[G].context,q)}}return!0},r.prototype.on=function(W,Y,se){return E(this,W,Y,se,!1)},r.prototype.once=function(W,Y,se){return E(this,W,Y,se,!0)},r.prototype.removeListener=function(W,Y,se,Ae){var Ce=u?u+W:W;if(!this._events[Ce])return this;if(!Y)return O(this,Ce),this;var he=this._events[Ce];if(he.fn)he.fn===Y&&(!Ae||he.once)&&(!se||he.context===se)&&O(this,Ce);else{for(var K=0,N=[],z=he.length;K<z;K++)(he[K].fn!==Y||Ae&&!he[K].once||se&&he[K].context!==se)&&N.push(he[K]);N.length?this._events[Ce]=N.length===1?N[0]:N:O(this,Ce)}return this},r.prototype.removeAllListeners=function(W){var Y;return W?(Y=u?u+W:W,this._events[Y]&&O(this,Y)):(this._events=new g,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=u,r.EventEmitter=r,d.exports=r})(eC);var UM=eC.exports;function jM(d){return d.map(encodeURIComponent).join(",")}function tC(d){return Array.isArray(d)?jM(d):encodeURIComponent(String(d))}function iC(d,s,u){if(u===!1||u===null)return d;var g=/\?/.test(d)?"&":"?",A=encodeURIComponent(s);return u!==void 0&&u!==""&&u!==!0&&(A+="="+tC(u)),""+d+g+A}function qM(d,s){if(!s)return d;var u=d;return Object.keys(s).forEach(function(g){var A=s[g];A!==void 0&&(Array.isArray(A)&&(A=A.filter(function(E){return E!=null}).join(",")),u=iC(u,g,A))}),u}function HM(d,s){if(!s||d.slice(0,4)==="http")return d;var u=d[0]==="/"?"":"/";return""+s.replace(/\/$/,"")+u+d}function GM(d,s){return s?d.replace(/\/:([a-zA-Z0-9]+)/g,function(u,g){var A=s[g];if(A===void 0)throw new Error("Unspecified route parameter "+g);var E=tC(A);return"/"+E}):d}var WM={appendQueryObject:qM,appendQueryParam:iC,prependOrigin:HM,interpolateRouteParams:GM},$M=J2,ey=Wd,ZM=UM,yg=WM,mb=n0,XM=1;function Zu(d,s){if(!d)throw new Error("MapiRequest requires a client");if(!s||!s.path||!s.method)throw new Error("MapiRequest requires an options object with path and method properties");var u={};s.body&&(u["content-type"]="application/json");var g=ey(u,s.headers),A=Object.keys(g).reduce(function(E,O){return E[O.toLowerCase()]=g[O],E},{});this.id=XM++,this._options=s,this.emitter=new ZM,this.client=d,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=s.path,this.method=s.method,this.origin=s.origin||d.origin,this.query=s.query||{},this.params=s.params||{},this.body=s.body||null,this.file=s.file||null,this.encoding=s.encoding||"utf8",this.sendFileAs=s.sendFileAs||null,this.headers=A}Zu.prototype.url=function(s){var u=yg.prependOrigin(this.path,this.origin);u=yg.appendQueryObject(u,this.query);var g=this.params,A=s??this.client.accessToken;if(A){u=yg.appendQueryParam(u,"access_token",A);var E=$M(A).user;g=ey({ownerId:E},g)}return u=yg.interpolateRouteParams(u,g),u};Zu.prototype.send=function(){var s=this;if(s.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return s.sent=!0,s.client.sendRequest(s).then(function(u){return s.response=u,s.emitter.emit(mb.EVENT_RESPONSE,u),u},function(u){throw s.error=u,s.emitter.emit(mb.EVENT_ERROR,u),u})};Zu.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};Zu.prototype.eachPage=function(s){var u=this;function g(O){function r(){delete u._nextPageRequest;var U=O.nextPage();U&&(u._nextPageRequest=U,E(U))}s(null,O,r)}function A(O){s(O,null,function(){})}function E(O){O.send().then(g,A)}E(this)};Zu.prototype.clone=function(){return this._extend()};Zu.prototype._extend=function(s){var u=ey(this._options,s);return new Zu(this.client,u)};var YM=Zu,KM=J2,QM=YM,JM=n0;function nC(d){if(!d||!d.accessToken)throw new Error("Cannot create a client without an access token");KM(d.accessToken),this.accessToken=d.accessToken,this.origin=d.origin||JM.API_ORIGIN}nC.prototype.createRequest=function(s){return new QM(this,s)};var rC=nC,oC=BM,sC=rC;function kd(d){sC.call(this,d)}kd.prototype=Object.create(sC.prototype);kd.prototype.constructor=kd;kd.prototype.sendRequest=oC.browserSend;kd.prototype.abortRequest=oC.browserAbort;function eL(d){return new kd(d)}var aC=eL,tL=aC,iL=tL,nL=Object.prototype.toString,rL=function(d){var s;return nL.call(d)==="[object Object]"&&(s=Object.getPrototypeOf(d),s===null||s===Object.getPrototypeOf({}))},oL=rL,sL=Wd,lC="value",l_=`
  `,go={};go.assert=function(d,s){return s=s||{},function(u){var g=Xu(d,u);if(g){var A=ty(g,s);throw s.apiName&&(A=s.apiName+": "+A),new Error(A)}}};go.shape=function(s){var u=uL(s);return function(A){var E=Xu(go.plainObject,A);if(E)return E;for(var O,r,U=[],W=0;W<u.length;W++)O=u[W].key,r=u[W].value,E=Xu(r,A[O]),E&&U.push([O].concat(E));return U.length<2?U[0]:function(Y){U=U.map(function(Ce){var he=Ce[0],K=ty(Ce,Y).split(`
`).join(l_);return"- "+he+": "+K});var se=Y.path.join("."),Ae=se===lC?"":" of "+se;return"The following properties"+Ae+" have invalid values:"+l_+U.join(l_)}}};go.strictShape=function(s){var u=go.shape(s);return function(A){var E=u(A);if(E)return E;var O=Object.keys(A).reduce(function(r,U){return s[U]===void 0&&r.push(U),r},[]);if(O.length!==0)return function(){return"The following keys are invalid: "+O.join(", ")}}};go.arrayOf=function(s){return cC(s)};go.tuple=function(){var s=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return cC(s)};function cC(d){var s=Array.isArray(d),u=function(g){return s?d[g]:d};return function(A){var E=Xu(go.plainArray,A);if(E)return E;if(s&&A.length!==d.length)return"an array with "+d.length+" items";for(var O=0;O<A.length;O++)if(E=Xu(u(O),A[O]),E)return[O].concat(E)}}go.required=function(s){function u(g){return g==null?function(A){return uC(A,hC(A.path)?"cannot be undefined/null.":"is required.")}:s.apply(this,arguments)}return u.__required=!0,u};go.oneOfType=function(){var s=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(g){var A=s.map(function(E){return Xu(E,g)}).filter(Boolean);if(A.length===s.length)return A.every(function(E){return E.length===1&&typeof E[0]=="string"})?aL(A.map(function(E){return E[0]})):A.reduce(function(E,O){return O.length>E.length?O:E})}};go.equal=function(s){return function(g){if(g!==s)return JSON.stringify(s)}};go.oneOf=function(){var s=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),u=s.map(function(g){return go.equal(g)});return go.oneOfType.apply(this,u)};go.range=function(s){var u=s[0],g=s[1];return function(E){var O=Xu(go.number,E);if(O||E<u||E>g)return"number between "+u+" & "+g+" (inclusive)"}};go.any=function(){};go.boolean=function(s){if(typeof s!="boolean")return"boolean"};go.number=function(s){if(typeof s!="number")return"number"};go.plainArray=function(s){if(!Array.isArray(s))return"array"};go.plainObject=function(s){if(!oL(s))return"object"};go.string=function(s){if(typeof s!="string")return"string"};go.func=function(s){if(typeof s!="function")return"function"};function Xu(d,s){if(!(s==null&&!d.hasOwnProperty("__required"))){var u=d(s);if(u)return Array.isArray(u)?u:[u]}}function ty(d,s){var u=d.length,g=d[u-1],A=d.slice(0,u-1);return A.length===0&&(A=[lC]),s=sL(s,{path:A}),typeof g=="function"?g(s):uC(s,lL(g))}function aL(d){return d.length<2?d[0]:d.length===2?d.join(" or "):d.slice(0,-1).join(", ")+", or "+d.slice(-1)}function lL(d){return"must be "+cL(d)+"."}function cL(d){return/^an? /.test(d)?d:/^[aeiou]/i.test(d)?"an "+d:/^[a-z]/i.test(d)?"a "+d:d}function uC(d,s){var u=hC(d.path),g=d.path.join(".")+" "+s,A=u?"Item at position ":"";return A+g}function hC(d){return typeof d[d.length-1]=="number"||typeof d[0]=="number"}function uL(d){return Object.keys(d||{}).map(function(s){return{key:s,value:d[s]}})}go.validate=Xu;go.processMessage=ty;var hL=go,dL=Wd,Rd=hL;function fL(d){if(typeof window<"u")return d instanceof Po.Blob||d instanceof Po.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof d=="string"||d.pipe!==void 0))return"Filename or Readable stream"}function pL(d,s){return Rd.assert(Rd.strictShape(d),s)}function mL(d){var s="date";if(typeof d=="boolean")return s;try{var u=new Date(d);if(u.getTime&&isNaN(u.getTime()))return s}catch{return s}}function gL(d){return Rd.tuple(Rd.number,Rd.number)(d)}var _L=dL(Rd,{file:fL,date:mL,coordinates:gL,assertShape:pL});function yL(d,s){var u=function(g,A){return s.indexOf(g)!==-1&&A!==void 0};return typeof s=="function"&&(u=s),Object.keys(d).filter(function(g){return u(g,d[g])}).reduce(function(g,A){return g[A]=d[A],g},{})}var vL=yL;function xL(d,s){return Object.keys(d).reduce(function(u,g){return u[g]=s(g,d[g]),u},{})}var wL=xL,bL=wL;function CL(d){return bL(d,function(s,u){return typeof u=="boolean"?JSON.stringify(u):u})}var EL=CL,TL=rC,SL=aC;function AL(d){return function(s){var u;TL.prototype.isPrototypeOf(s)?u=s:u=SL(s);var g=Object.create(d);return g.client=u,g}}var IL=AL,dC=Wd,br=_L,zg=vL,fC=EL,ML=IL,iy={},pC=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];iy.forwardGeocode=function(d){br.assertShape({query:br.required(br.string),mode:br.oneOf("mapbox.places","mapbox.places-permanent"),countries:br.arrayOf(br.string),proximity:br.oneOf(br.coordinates,"ip"),types:br.arrayOf(br.oneOf(pC)),autocomplete:br.boolean,bbox:br.arrayOf(br.number),limit:br.number,language:br.arrayOf(br.string),routing:br.boolean,fuzzyMatch:br.boolean,worldview:br.string})(d),d.mode=d.mode||"mapbox.places";var s=fC(dC({country:d.countries},zg(d,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:zg(d,["mode","query"]),query:s})};iy.reverseGeocode=function(d){br.assertShape({query:br.required(br.coordinates),mode:br.oneOf("mapbox.places","mapbox.places-permanent"),countries:br.arrayOf(br.string),types:br.arrayOf(br.oneOf(pC)),bbox:br.arrayOf(br.number),limit:br.number,language:br.arrayOf(br.string),reverseMode:br.oneOf("distance","score"),routing:br.boolean,worldview:br.string})(d),d.mode=d.mode||"mapbox.places";var s=fC(dC({country:d.countries},zg(d,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:zg(d,["mode","query"]),query:s})};var LL=ML(iy);let OL="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",mC=d=>crypto.getRandomValues(new Uint8Array(d)),gC=(d,s,u)=>{let g=(2<<Math.log(d.length-1)/Math.LN2)-1,A=-~(1.6*g*s/d.length);return(E=s)=>{let O="";for(;;){let r=u(A),U=A;for(;U--;)if(O+=d[r[U]&g]||"",O.length===E)return O}}},PL=(d,s=21)=>gC(d,s,mC),DL=(d=21)=>crypto.getRandomValues(new Uint8Array(d)).reduce((s,u)=>(u&=63,u<36?s+=u.toString(36):u<62?s+=(u-26).toString(36).toUpperCase():u>62?s+="-":s+="_",s),"");const RL=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:PL,customRandom:gC,nanoid:DL,random:mC,urlAlphabet:OL},Symbol.toStringTag,{value:"Module"})),kL=k3(RL);var BL=kL.nanoid;function _C(d){this.origin=d.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=d.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=d,this.send=this.send.bind(this),this.countries=d.countries?d.countries.split(","):null,this.types=d.types?d.types.split(","):null,this.bbox=d.bbox?d.bbox:null,this.language=d.language?d.language.split(","):null,this.limit=d.limit?+d.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(d),this.eventQueue=new Array,this.flushInterval=d.flushInterval||1e3,this.maxQueueSize=d.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}_C.prototype={select:function(d,s){var u=this.getSelectedIndex(d,s),g=this.getEventPayload("search.select",s);if(g.resultIndex=u,g.resultPlaceName=d.place_name,g.resultId=d.id,!(u===this.lastSentIndex&&g.queryString===this.lastSentInput||u==-1)&&(this.lastSentIndex=u,this.lastSentInput=g.queryString,!!g.queryString))return this.push(g)},start:function(d){var s=this.getEventPayload("search.start",d);if(s.queryString)return this.push(s)},keyevent:function(d,s){if(d.key&&!(d.metaKey||[9,27,37,39,13,38,40].indexOf(d.keyCode)!==-1)){var u=this.getEventPayload("search.keystroke",s);if(u.lastAction=d.key,!!u.queryString)return this.push(u)}},send:function(d,s){if(!this.enableEventLogging)return s?s():void 0;var u=this.getRequestOptions(d);this.request(u,(function(g){if(g)return this.handleError(g,s);if(s)return s()}).bind(this))},getRequestOptions:function(d){Array.isArray(d)||(d=[d]);var s={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(d)};return s},getEventPayload:function(d,s){var u;s.options.proximity?typeof s.options.proximity=="object"?u=[s.options.proximity.longitude,s.options.proximity.latitude]:s.options.proximity==="ip"?u=[999,999]:u=s.options.proximity:u=null;var g=s._map?s._map.getZoom():void 0,A={event:d,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:s.options.autocomplete,fuzzyMatch:s.options.fuzzyMatch,proximity:u,limit:s.options.limit,routing:s.options.routing,worldview:s.options.worldview,mapZoom:g,keyboardLocale:this.locale};return d==="search.select"?A.queryString=s.inputString:d!="search.select"&&s._inputEl?A.queryString=s._inputEl.value:A.queryString=s.inputString,A},request:function(d,s){var u=new XMLHttpRequest;u.onreadystatechange=function(){if(this.readyState==4)return this.status==204?s(null):s(this.statusText)},u.open(d.method,d.host+"/"+d.path,!0);for(var g in d.headers){var A=d.headers[g];u.setRequestHeader(g,A)}u.send(d.body)},handleError:function(d,s){if(s)return s(d)},generateSessionID:function(){return BL()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(d,s){if(s._typeahead){var u=s._typeahead.data,g=d.id,A=u.map(function(O){return O.id}),E=A.indexOf(g);return E}},shouldEnableLogging:function(d){return!(d.enableEventLogging===!1||d.origin&&d.origin!=="https://api.mapbox.com"||d.localGeocoder||d.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(d,s){this.eventQueue.push(d),(this.eventQueue.length>=this.maxQueueSize||s)&&this.flush()},remove:function(){this.flush()}};var NL=_C,FL={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},zL={placeholder:FL},yC={exports:{}};(function(d){(function(s,u,g){d.exports?d.exports=g():s[u]=g()})(Po,"subtag",function(){var s="",u=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function g(U){return U.match(u)||[]}function A(U){return g(U).filter(function(W,Y){return W&&Y})}function E(U){return U=g(U),{language:U[1]||s,extlang:U[2]||s,script:U[3]||s,region:U[4]||s}}function O(U,W,Y){Object.defineProperty(U,W,{value:Y,enumerable:!0})}function r(U,W,Y){function se(Ae){return g(Ae)[U]||s}O(se,"pattern",W),O(E,Y,se)}return r(1,/^[a-zA-Z]{2,3}$/,"language"),r(2,/^[a-zA-Z]{3}$/,"extlang"),r(3,/^[a-zA-Z]{4}$/,"script"),r(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),O(E,"split",A),E})})(yC);var VL=yC.exports;function vC(){}vC.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const d={enableHighAccuracy:!0};return new Promise(function(s,u){window.navigator.geolocation.getCurrentPosition(s,u,d)})}};var UL=vC;function jL(d,s){const u=xC(d),g=["address","street","place","country"];var A;if(typeof s=="function")return s(u);const E=g.indexOf(s);return E===-1?A=g:A=g.slice(E),A.reduce(function(O,r){return u[r]?(O!==""&&(O=O+", "),O+u[r]):O},"")}function xC(d){const s=d.address||"",u=d.text||"",g=d.place_name||"",E={address:g.split(",")[0],houseNumber:s,street:u,placeName:g};return d.context.forEach(function(O){const r=O.id.split(".")[0];E[r]=O.text}),E}const qL=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var HL={transformFeatureToGeolocationText:jL,getAddressInfo:xC,REVERSE_GEOCODE_COORD_RGX:qL},GL=$3,WL=hM,Oh=Wd,$L=yM.EventEmitter,gb=vM,c_=iL,u_=LL,ZL=NL,XL=zL,YL=VL,KL=UL,_b=HL;const qu={FORWARD:0,LOCAL:1,REVERSE:2};function QL(){var d=document.createElement("div");return d.className="mapboxgl-ctrl-geocoder--powered-by",d.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',d}function wC(d){this._eventEmitter=new $L,this.options=Oh({},this.options,d),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new KL}wC.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(d){return d.place_name},render:function(d){var s=d.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+s[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+s.splice(1,s.length).join(",")+"</div></div>"}},addTo:function(d){function s(u,g){if(!document.body.contains(g))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const A=u.onAdd();g.appendChild(A)}if(d._controlContainer)d.addControl(this);else if(d instanceof HTMLElement)s(this,d);else if(typeof d=="string"){const u=document.querySelectorAll(d);if(u.length===0)throw new Error("Element ",d,"not found.");if(u.length>1)throw new Error("Geocoder can only be added to a single html element");s(this,u[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(d){if(d&&typeof d!="string"&&(this._map=d),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=u_(c_({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new ZL(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var s=this.container=document.createElement("div");s.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var u=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",WL(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(W){this.eventManager.keyevent(W,this)}).bind(this));var g=document.createElement("div");g.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var A=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(A),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),g.appendChild(this._clearEl),g.appendChild(this._loadingEl),s.appendChild(u),s.appendChild(this._inputEl),s.appendChild(g),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var E=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(E),g.appendChild(this._geolocateEl),this._showGeolocateButton()}var O=this._typeahead=new GL(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),O.getItemValue=this.options.getItemValue;var r=O.list.draw,U=this._footerNode=QL();return O.list.draw=function(){r.call(this),U.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),U.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(U)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),s},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(d){this._hideLoadingIcon();const s={geometry:{type:"Point",coordinates:[d.coords.longitude,d.coords.latitude]}};this._handleMarker(s),this._fly(s),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(s),this._showClearButton(),this.fresh=!1;const u={limit:1,language:[this.options.language],query:s.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const g=s.geometry.coordinates[0]+","+s.geometry.coordinates[1];this._setInputValue(g),this._eventEmitter.emit("result",{result:s})}else this.geocoderService.reverseGeocode(u).send().then((function(g){const A=g.body.features[0];if(A){const E=_b.transformFeatureToGeolocationText(A,this.options.addressAccuracy);this._setInputValue(E),A.user_coordinates=s.geometry.coordinates,this._eventEmitter.emit("result",{result:A})}else this._eventEmitter.emit("result",{result:{user_coordinates:s.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(d){d.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(d,s){var u=document.createElementNS("http://www.w3.org/2000/svg","svg");return u.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+d),u.setAttribute("viewBox","0 0 18 18"),u.setAttribute("xml:space","preserve"),u.setAttribute("width",18),u.setAttribute("height",18),u.innerHTML=s,u},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(d){this._inputEl.value=d,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(d){var s=(d.clipboardData||window.clipboardData).getData("text");s.length>=this.options.minLength&&this._geocode(s)},_onKeyDown:function(d){var s=27,u=9;if(d.keyCode===s&&this.options.clearAndBlurOnEsc)return this._clear(d),this._inputEl.blur();var g=d.target&&d.target.shadowRoot?d.target.shadowRoot.activeElement:d.target,A=g?g.value:"";if(!A)return this.fresh=!0,d.keyCode!==u&&this.clear(d),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(d.metaKey||[u,s,37,39,13,38,40].indexOf(d.keyCode)!==-1)&&g.value.length>=this.options.minLength&&this._geocode(g.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(d){this.options.clearOnBlur&&this._clearOnBlur(d),this.options.collapsed&&this._collapse()},_onChange:function(){var d=this._typeahead.selected;d&&JSON.stringify(d)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(d),this.options.marker&&this._mapboxgl&&this._handleMarker(d),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(d),this._eventEmitter.emit("result",{result:d}),this.eventManager.select(d,this))},_fly:function(d){var s;if(d.properties&&gb[d.properties.short_code])s=Oh({},this.options.flyTo),this._map&&this._map.fitBounds(gb[d.properties.short_code].bbox,s);else if(d.bbox){var u=d.bbox;s=Oh({},this.options.flyTo),this._map&&this._map.fitBounds([[u[0],u[1]],[u[2],u[3]]],s)}else{var g={zoom:this.options.zoom};s=Oh({},g,this.options.flyTo),d.center?s.center=d.center:d.geometry&&d.geometry.type&&d.geometry.type==="Point"&&d.geometry.coordinates&&(s.center=d.geometry.coordinates),this._map&&this._map.flyTo(s)}},_requestType:function(d,s){var u;return d.localGeocoderOnly?u=qu.LOCAL:d.reverseGeocode&&_b.REVERSE_GEOCODE_COORD_RGX.test(s)?u=qu.REVERSE:u=qu.FORWARD,u},_setupConfig:function(d,s){const u=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],g=/[\s,]+/;var A=this,E=u.reduce(function(r,U){if(A.options[U]===void 0||A.options[U]===null)return r;["countries","types","language"].indexOf(U)>-1?r[U]=A.options[U].split(g):r[U]=A.options[U];const W=typeof A.options[U].longitude=="number"&&typeof A.options[U].latitude=="number";if(U==="proximity"&&W){const Y=A.options[U].longitude,se=A.options[U].latitude;r[U]=[Y,se]}return r},{});switch(d){case qu.REVERSE:{var O=s.split(g).map(function(r){return parseFloat(r,10)});A.options.flipCoordinates||O.reverse(),E.types&&E.types[0],E=Oh(E,{query:O,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(r){r in E&&delete E[r]})}break;case qu.FORWARD:{const r=s.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(r)&&(s=s.replace(/,/g," ")),E=Oh(E,{query:s})}break}return E},_geocode:function(d){this.inputString=d,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:d});const s=this._requestType(this.options,d),u=this._setupConfig(s,d);var g;switch(s){case qu.LOCAL:g=Promise.resolve();break;case qu.FORWARD:g=this.geocoderService.forwardGeocode(u).send();break;case qu.REVERSE:g=this.geocoderService.reverseGeocode(u).send();break}var A=this.options.localGeocoder?this.options.localGeocoder(d)||[]:[],E=[],O=null;return g.catch((function(r){O=r}).bind(this)).then((function(r){this._hideLoadingIcon();var U={};return r?r.statusCode=="200"&&(U=r.body,U.request=r.request,U.headers=r.headers):U={type:"FeatureCollection",features:[]},U.config=u,this.fresh&&(this.eventManager.start(this),this.fresh=!1),U.features=U.features?A.concat(U.features):A,this.options.externalGeocoder?(E=this.options.externalGeocoder(d,U.features)||Promise.resolve([]),E.then(function(W){return U.features=U.features?W.concat(U.features):W,U},function(){return U})):U}).bind(this)).then((function(r){if(O)throw O;this.options.filter&&r.features.length&&(r.features=r.features.filter(this.options.filter)),r.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",r),this._typeahead.update(r.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",r))}).bind(this)).catch((function(r){this._hideLoadingIcon(),this._hideAttribution(),A.length&&this.options.localGeocoder||E.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(A)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:A}),this._eventEmitter.emit("error",{error:r})}).bind(this)),g},_clear:function(d){d&&d.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(d){this._clear(d),this._inputEl.focus()},_clearOnBlur:function(d){var s=this;d.relatedTarget&&s._clear(d)},_onQueryResult:function(d){var s=d.body;if(s.features.length){var u=s.features[0];this._typeahead.selected=u,this._inputEl.value=u.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var d=this._map.getCenter().wrap();this.setProximity({longitude:d.lng,latitude:d.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(d){return this._geocode(d).then(this._onQueryResult),this},_renderError:function(){var d="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(d)},_renderLocationError:function(){var d="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(d)},_renderNoResults:function(){var d="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(d)},_renderUserDeniedGeolocationError:function(){var d="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(d)},_renderMessage:function(d){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(d)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var d=this.options.language.split(",")[0],s=YL.language(d),u=XL.placeholder[s];if(u)return u}return"Search"},setInput:function(d,s){return s===void 0&&(s=!1),this._inputEl.value=d,this._typeahead.selected=null,this._typeahead.clear(),d.length>=this.options.minLength&&(s?this._geocode(d):this._onChange()),this},setProximity:function(d,s=!0){return this.options.proximity=d,s&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(d){return d&&typeof d=="function"&&(this._typeahead.render=d),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(d){var s=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=d||this.options.language||s,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(d){return this.options.zoom=d,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(d){return this.options.flyTo=d,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(d){return this.options.placeholder=d||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(d){return this.options.bbox=d,this},getCountries:function(){return this.options.countries},setCountries:function(d){return this.options.countries=d,this},getTypes:function(){return this.options.types},setTypes:function(d){return this.options.types=d,this},getMinLength:function(){return this.options.minLength},setMinLength:function(d){return this.options.minLength=d,this._typeahead&&(this._typeahead.options.minLength=d),this},getLimit:function(){return this.options.limit},setLimit:function(d){return this.options.limit=d,this._typeahead&&(this._typeahead.options.limit=d),this},getFilter:function(){return this.options.filter},setFilter:function(d){return this.options.filter=d,this},setOrigin:function(d){return this.options.origin=d,this.geocoderService=u_(c_({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(d){return this.options.accessToken=d,this.geocoderService=u_(c_({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(d){return this.options.autocomplete=d,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(d){return this.options.fuzzyMatch=d,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(d){return this.options.routing=d,this},getRouting:function(){return this.options.routing},setWorldview:function(d){return this.options.worldview=d,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(d){if(this._map){this._removeMarker();var s={color:"#4668F2"},u=Oh({},s,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(u),d.center?this.mapMarker.setLngLat(d.center).addTo(this._map):d.geometry&&d.geometry.type&&d.geometry.type==="Point"&&d.geometry.coordinates&&this.mapMarker.setLngLat(d.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(d,s){return this._eventEmitter.on(d,s),this},off:function(d,s){return this._eventEmitter.removeListener(d,s),this.eventManager.remove(),this}};var JL=wC;const e4=t0(JL);var Zi;(function(d){d[d.QR_CODE=0]="QR_CODE",d[d.AZTEC=1]="AZTEC",d[d.CODABAR=2]="CODABAR",d[d.CODE_39=3]="CODE_39",d[d.CODE_93=4]="CODE_93",d[d.CODE_128=5]="CODE_128",d[d.DATA_MATRIX=6]="DATA_MATRIX",d[d.MAXICODE=7]="MAXICODE",d[d.ITF=8]="ITF",d[d.EAN_13=9]="EAN_13",d[d.EAN_8=10]="EAN_8",d[d.PDF_417=11]="PDF_417",d[d.RSS_14=12]="RSS_14",d[d.RSS_EXPANDED=13]="RSS_EXPANDED",d[d.UPC_A=14]="UPC_A",d[d.UPC_E=15]="UPC_E",d[d.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(Zi||(Zi={}));var yb=new Map([[Zi.QR_CODE,"QR_CODE"],[Zi.AZTEC,"AZTEC"],[Zi.CODABAR,"CODABAR"],[Zi.CODE_39,"CODE_39"],[Zi.CODE_93,"CODE_93"],[Zi.CODE_128,"CODE_128"],[Zi.DATA_MATRIX,"DATA_MATRIX"],[Zi.MAXICODE,"MAXICODE"],[Zi.ITF,"ITF"],[Zi.EAN_13,"EAN_13"],[Zi.EAN_8,"EAN_8"],[Zi.PDF_417,"PDF_417"],[Zi.RSS_14,"RSS_14"],[Zi.RSS_EXPANDED,"RSS_EXPANDED"],[Zi.UPC_A,"UPC_A"],[Zi.UPC_E,"UPC_E"],[Zi.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]),vb;(function(d){d[d.UNKNOWN=0]="UNKNOWN",d[d.URL=1]="URL"})(vb||(vb={}));function t4(d){return Object.values(Zi).includes(d)}var Yu;(function(d){d[d.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",d[d.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"})(Yu||(Yu={}));var jl=function(){function d(){}return d.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",d.SCAN_DEFAULT_FPS=2,d.DEFAULT_DISABLE_FLIP=!1,d.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,d.DEFAULT_SUPPORTED_SCAN_TYPE=[Yu.SCAN_TYPE_CAMERA,Yu.SCAN_TYPE_FILE],d}(),bC=function(){function d(s,u){this.format=s,this.formatName=u}return d.prototype.toString=function(){return this.formatName},d.create=function(s){if(!yb.has(s))throw"".concat(s," not in html5QrcodeSupportedFormatsTextMap");return new d(s,yb.get(s))},d}(),xb=function(){function d(){}return d.createFromText=function(s){var u={text:s};return{decodedText:s,result:u}},d.createFromQrcodeResult=function(s){return{decodedText:s.text,result:s}},d}(),O_;(function(d){d[d.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",d[d.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",d[d.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"})(O_||(O_={}));var CC=function(){function d(){}return d.createFrom=function(s){return{errorMessage:s,type:O_.UNKWOWN_ERROR}},d}(),EC=function(){function d(s){this.verbose=s}return d.prototype.log=function(s){this.verbose&&console.log(s)},d.prototype.warn=function(s){this.verbose&&console.warn(s)},d.prototype.logError=function(s,u){(this.verbose||u===!0)&&console.error(s)},d.prototype.logErrors=function(s){if(s.length===0)throw"Logger#logError called without arguments";this.verbose&&console.error(s)},d}();function vc(d){return typeof d>"u"||d===null}function i4(d,s,u){return d>u?u:d<s?s:d}var Od=function(){function d(){}return d.codeParseError=function(s){return"QR code parse error, error = ".concat(s)},d.errorGettingUserMedia=function(s){return"Error getting userMedia, error = ".concat(s)},d.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},d.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},d.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},d.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},d.scannerPaused=function(){return"Scanner paused"},d}(),eo=function(){function d(){}return d.scanningStatus=function(){return"Scanning"},d.idleStatus=function(){return"Idle"},d.errorStatus=function(){return"Error"},d.permissionStatus=function(){return"Permission"},d.noCameraFoundErrorStatus=function(){return"No Cameras"},d.lastMatch=function(s){return"Last Match: ".concat(s)},d.codeScannerTitle=function(){return"Code Scanner"},d.cameraPermissionTitle=function(){return"Request Camera Permissions"},d.cameraPermissionRequesting=function(){return"Requesting camera permissions..."},d.noCameraFound=function(){return"No camera found"},d.scanButtonStopScanningText=function(){return"Stop Scanning"},d.scanButtonStartScanningText=function(){return"Start Scanning"},d.torchOnButton=function(){return"Switch On Torch"},d.torchOffButton=function(){return"Switch Off Torch"},d.torchOnFailedMessage=function(){return"Failed to turn on torch"},d.torchOffFailedMessage=function(){return"Failed to turn off torch"},d.scanButtonScanningStarting=function(){return"Launching Camera..."},d.textIfCameraScanSelected=function(){return"Scan an Image File"},d.textIfFileScanSelected=function(){return"Scan using camera directly"},d.selectCamera=function(){return"Select Camera"},d.fileSelectionChooseImage=function(){return"Choose Image"},d.fileSelectionChooseAnother=function(){return"Choose Another"},d.fileSelectionNoImageSelected=function(){return"No image choosen"},d.anonymousCameraPrefix=function(){return"Anonymous Camera"},d.dragAndDropMessage=function(){return"Or drop an image to scan"},d.dragAndDropMessageOnlyImages=function(){return"Or drop an image to scan (other files not supported)"},d.zoom=function(){return"zoom"},d.loadingImage=function(){return"Loading image..."},d.cameraScanAltText=function(){return"Camera based scan"},d.fileScanAltText=function(){return"Fule based scan"},d}(),wb=function(){function d(){}return d.poweredBy=function(){return"Powered by "},d.reportIssues=function(){return"Report issues"},d}(),TC=function(){function d(){}return d.isMediaStreamConstraintsValid=function(s,u){if(typeof s!="object"){var g=typeof s;return u.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(g,"."),!0),!1}for(var A=["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"],E=new Set(A),O=Object.keys(s),r=0,U=O;r<U.length;r++){var W=U[r];if(E.has(W))return u.logError("".concat(W," is not supported videoConstaints."),!0),!1}return!0},d}(),P_={exports:{}};(function(d,s){(function(u,g){g(s)})(Po,function(u){function g(Te){return Te==null}var A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Te,c){Te.__proto__=c}||function(Te,c){for(var m in c)c.hasOwnProperty(m)&&(Te[m]=c[m])};function E(Te,c){A(Te,c);function m(){this.constructor=Te}Te.prototype=c===null?Object.create(c):(m.prototype=c.prototype,new m)}function O(Te,c){var m=Object.setPrototypeOf;m?m(Te,c):Te.__proto__=c}function r(Te,c){c===void 0&&(c=Te.constructor);var m=Error.captureStackTrace;m&&m(Te,c)}var U=function(Te){E(c,Te);function c(m){var v=this.constructor,C=Te.call(this,m)||this;return Object.defineProperty(C,"name",{value:v.name,enumerable:!1}),O(C,v.prototype),r(C),C}return c}(Error);class W extends U{constructor(c=void 0){super(c),this.message=c}getKind(){return this.constructor.kind}}W.kind="Exception";class Y extends W{}Y.kind="ArgumentException";class se extends W{}se.kind="IllegalArgumentException";class Ae{constructor(c){if(this.binarizer=c,c===null)throw new se("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(c,m){return this.binarizer.getBlackRow(c,m)}getBlackMatrix(){return(this.matrix===null||this.matrix===void 0)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(c,m,v,C){const I=this.binarizer.getLuminanceSource().crop(c,m,v,C);return new Ae(this.binarizer.createBinarizer(I))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const c=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new Ae(this.binarizer.createBinarizer(c))}rotateCounterClockwise45(){const c=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new Ae(this.binarizer.createBinarizer(c))}toString(){try{return this.getBlackMatrix().toString()}catch{return""}}}class Ce extends W{static getChecksumInstance(){return new Ce}}Ce.kind="ChecksumException";class he{constructor(c){this.source=c}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class K{static arraycopy(c,m,v,C,I){for(;I--;)v[C++]=c[m++]}static currentTimeMillis(){return Date.now()}}class N extends W{}N.kind="IndexOutOfBoundsException";class z extends N{constructor(c=void 0,m=void 0){super(m),this.index=c,this.message=m}}z.kind="ArrayIndexOutOfBoundsException";class q{static fill(c,m){for(let v=0,C=c.length;v<C;v++)c[v]=m}static fillWithin(c,m,v,C){q.rangeCheck(c.length,m,v);for(let I=m;I<v;I++)c[I]=C}static rangeCheck(c,m,v){if(m>v)throw new se("fromIndex("+m+") > toIndex("+v+")");if(m<0)throw new z(m);if(v>c)throw new z(v)}static asList(...c){return c}static create(c,m,v){return Array.from({length:c}).map(I=>Array.from({length:m}).fill(v))}static createInt32Array(c,m,v){return Array.from({length:c}).map(I=>Int32Array.from({length:m}).fill(v))}static equals(c,m){if(!c||!m||!c.length||!m.length||c.length!==m.length)return!1;for(let v=0,C=c.length;v<C;v++)if(c[v]!==m[v])return!1;return!0}static hashCode(c){if(c===null)return 0;let m=1;for(const v of c)m=31*m+v;return m}static fillUint8Array(c,m){for(let v=0;v!==c.length;v++)c[v]=m}static copyOf(c,m){return c.slice(0,m)}static copyOfUint8Array(c,m){if(c.length<=m){const v=new Uint8Array(m);return v.set(c),v}return c.slice(0,m)}static copyOfRange(c,m,v){const C=v-m,I=new Int32Array(C);return K.arraycopy(c,m,I,0,C),I}static binarySearch(c,m,v){v===void 0&&(v=q.numberComparator);let C=0,I=c.length-1;for(;C<=I;){const L=I+C>>1,k=v(m,c[L]);if(k>0)C=L+1;else if(k<0)I=L-1;else return L}return-C-1}static numberComparator(c,m){return c-m}}class G{static numberOfTrailingZeros(c){let m;if(c===0)return 32;let v=31;return m=c<<16,m!==0&&(v-=16,c=m),m=c<<8,m!==0&&(v-=8,c=m),m=c<<4,m!==0&&(v-=4,c=m),m=c<<2,m!==0&&(v-=2,c=m),v-(c<<1>>>31)}static numberOfLeadingZeros(c){if(c===0)return 32;let m=1;return c>>>16||(m+=16,c<<=16),c>>>24||(m+=8,c<<=8),c>>>28||(m+=4,c<<=4),c>>>30||(m+=2,c<<=2),m-=c>>>31,m}static toHexString(c){return c.toString(16)}static toBinaryString(c){return String(parseInt(String(c),2))}static bitCount(c){return c=c-(c>>>1&1431655765),c=(c&858993459)+(c>>>2&858993459),c=c+(c>>>4)&252645135,c=c+(c>>>8),c=c+(c>>>16),c&63}static truncDivision(c,m){return Math.trunc(c/m)}static parseInt(c,m=void 0){return parseInt(c,m)}}G.MIN_VALUE_32_BITS=-2147483648,G.MAX_VALUE=Number.MAX_SAFE_INTEGER;class Q{constructor(c,m){c===void 0?(this.size=0,this.bits=new Int32Array(1)):(this.size=c,m==null?this.bits=Q.makeArray(c):this.bits=m)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(c){if(c>this.bits.length*32){const m=Q.makeArray(c);K.arraycopy(this.bits,0,m,0,this.bits.length),this.bits=m}}get(c){return(this.bits[Math.floor(c/32)]&1<<(c&31))!==0}set(c){this.bits[Math.floor(c/32)]|=1<<(c&31)}flip(c){this.bits[Math.floor(c/32)]^=1<<(c&31)}getNextSet(c){const m=this.size;if(c>=m)return m;const v=this.bits;let C=Math.floor(c/32),I=v[C];I&=~((1<<(c&31))-1);const L=v.length;for(;I===0;){if(++C===L)return m;I=v[C]}const k=C*32+G.numberOfTrailingZeros(I);return k>m?m:k}getNextUnset(c){const m=this.size;if(c>=m)return m;const v=this.bits;let C=Math.floor(c/32),I=~v[C];I&=~((1<<(c&31))-1);const L=v.length;for(;I===0;){if(++C===L)return m;I=~v[C]}const k=C*32+G.numberOfTrailingZeros(I);return k>m?m:k}setBulk(c,m){this.bits[Math.floor(c/32)]=m}setRange(c,m){if(m<c||c<0||m>this.size)throw new se;if(m===c)return;m--;const v=Math.floor(c/32),C=Math.floor(m/32),I=this.bits;for(let L=v;L<=C;L++){const k=L>v?0:c&31,J=(2<<(L<C?31:m&31))-(1<<k);I[L]|=J}}clear(){const c=this.bits.length,m=this.bits;for(let v=0;v<c;v++)m[v]=0}isRange(c,m,v){if(m<c||c<0||m>this.size)throw new se;if(m===c)return!0;m--;const C=Math.floor(c/32),I=Math.floor(m/32),L=this.bits;for(let k=C;k<=I;k++){const j=k>C?0:c&31,pe=(2<<(k<I?31:m&31))-(1<<j)&4294967295;if((L[k]&pe)!==(v?pe:0))return!1}return!0}appendBit(c){this.ensureCapacity(this.size+1),c&&(this.bits[Math.floor(this.size/32)]|=1<<(this.size&31)),this.size++}appendBits(c,m){if(m<0||m>32)throw new se("Num bits must be between 0 and 32");this.ensureCapacity(this.size+m);for(let v=m;v>0;v--)this.appendBit((c>>v-1&1)===1)}appendBitArray(c){const m=c.size;this.ensureCapacity(this.size+m);for(let v=0;v<m;v++)this.appendBit(c.get(v))}xor(c){if(this.size!==c.size)throw new se("Sizes don't match");const m=this.bits;for(let v=0,C=m.length;v<C;v++)m[v]^=c.bits[v]}toBytes(c,m,v,C){for(let I=0;I<C;I++){let L=0;for(let k=0;k<8;k++)this.get(c)&&(L|=1<<7-k),c++;m[v+I]=L}}getBitArray(){return this.bits}reverse(){const c=new Int32Array(this.bits.length),m=Math.floor((this.size-1)/32),v=m+1,C=this.bits;for(let I=0;I<v;I++){let L=C[I];L=L>>1&1431655765|(L&1431655765)<<1,L=L>>2&858993459|(L&858993459)<<2,L=L>>4&252645135|(L&252645135)<<4,L=L>>8&16711935|(L&16711935)<<8,L=L>>16&65535|(L&65535)<<16,c[m-I]=L}if(this.size!==v*32){const I=v*32-this.size;let L=c[0]>>>I;for(let k=1;k<v;k++){const j=c[k];L|=j<<32-I,c[k-1]=L,L=j>>>I}c[v-1]=L}this.bits=c}static makeArray(c){return new Int32Array(Math.floor((c+31)/32))}equals(c){if(!(c instanceof Q))return!1;const m=c;return this.size===m.size&&q.equals(this.bits,m.bits)}hashCode(){return 31*this.size+q.hashCode(this.bits)}toString(){let c="";for(let m=0,v=this.size;m<v;m++)m&7||(c+=" "),c+=this.get(m)?"X":".";return c}clone(){return new Q(this.size,this.bits.slice())}}var ee;(function(Te){Te[Te.OTHER=0]="OTHER",Te[Te.PURE_BARCODE=1]="PURE_BARCODE",Te[Te.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",Te[Te.TRY_HARDER=3]="TRY_HARDER",Te[Te.CHARACTER_SET=4]="CHARACTER_SET",Te[Te.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",Te[Te.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",Te[Te.ASSUME_GS1=7]="ASSUME_GS1",Te[Te.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",Te[Te.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",Te[Te.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"})(ee||(ee={}));var fe=ee;class ce extends W{static getFormatInstance(){return new ce}}ce.kind="FormatException";var Ue;(function(Te){Te[Te.Cp437=0]="Cp437",Te[Te.ISO8859_1=1]="ISO8859_1",Te[Te.ISO8859_2=2]="ISO8859_2",Te[Te.ISO8859_3=3]="ISO8859_3",Te[Te.ISO8859_4=4]="ISO8859_4",Te[Te.ISO8859_5=5]="ISO8859_5",Te[Te.ISO8859_6=6]="ISO8859_6",Te[Te.ISO8859_7=7]="ISO8859_7",Te[Te.ISO8859_8=8]="ISO8859_8",Te[Te.ISO8859_9=9]="ISO8859_9",Te[Te.ISO8859_10=10]="ISO8859_10",Te[Te.ISO8859_11=11]="ISO8859_11",Te[Te.ISO8859_13=12]="ISO8859_13",Te[Te.ISO8859_14=13]="ISO8859_14",Te[Te.ISO8859_15=14]="ISO8859_15",Te[Te.ISO8859_16=15]="ISO8859_16",Te[Te.SJIS=16]="SJIS",Te[Te.Cp1250=17]="Cp1250",Te[Te.Cp1251=18]="Cp1251",Te[Te.Cp1252=19]="Cp1252",Te[Te.Cp1256=20]="Cp1256",Te[Te.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",Te[Te.UTF8=22]="UTF8",Te[Te.ASCII=23]="ASCII",Te[Te.Big5=24]="Big5",Te[Te.GB18030=25]="GB18030",Te[Te.EUC_KR=26]="EUC_KR"})(Ue||(Ue={}));class He{constructor(c,m,v,...C){this.valueIdentifier=c,this.name=v,typeof m=="number"?this.values=Int32Array.from([m]):this.values=m,this.otherEncodingNames=C,He.VALUE_IDENTIFIER_TO_ECI.set(c,this),He.NAME_TO_ECI.set(v,this);const I=this.values;for(let L=0,k=I.length;L!==k;L++){const j=I[L];He.VALUES_TO_ECI.set(j,this)}for(const L of C)He.NAME_TO_ECI.set(L,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(c){if(c<0||c>=900)throw new ce("incorect value");const m=He.VALUES_TO_ECI.get(c);if(m===void 0)throw new ce("incorect value");return m}static getCharacterSetECIByName(c){const m=He.NAME_TO_ECI.get(c);if(m===void 0)throw new ce("incorect value");return m}equals(c){if(!(c instanceof He))return!1;const m=c;return this.getName()===m.getName()}}He.VALUE_IDENTIFIER_TO_ECI=new Map,He.VALUES_TO_ECI=new Map,He.NAME_TO_ECI=new Map,He.Cp437=new He(Ue.Cp437,Int32Array.from([0,2]),"Cp437"),He.ISO8859_1=new He(Ue.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),He.ISO8859_2=new He(Ue.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),He.ISO8859_3=new He(Ue.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),He.ISO8859_4=new He(Ue.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),He.ISO8859_5=new He(Ue.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),He.ISO8859_6=new He(Ue.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),He.ISO8859_7=new He(Ue.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),He.ISO8859_8=new He(Ue.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),He.ISO8859_9=new He(Ue.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),He.ISO8859_10=new He(Ue.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),He.ISO8859_11=new He(Ue.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),He.ISO8859_13=new He(Ue.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),He.ISO8859_14=new He(Ue.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),He.ISO8859_15=new He(Ue.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),He.ISO8859_16=new He(Ue.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),He.SJIS=new He(Ue.SJIS,20,"SJIS","Shift_JIS"),He.Cp1250=new He(Ue.Cp1250,21,"Cp1250","windows-1250"),He.Cp1251=new He(Ue.Cp1251,22,"Cp1251","windows-1251"),He.Cp1252=new He(Ue.Cp1252,23,"Cp1252","windows-1252"),He.Cp1256=new He(Ue.Cp1256,24,"Cp1256","windows-1256"),He.UnicodeBigUnmarked=new He(Ue.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),He.UTF8=new He(Ue.UTF8,26,"UTF8","UTF-8"),He.ASCII=new He(Ue.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),He.Big5=new He(Ue.Big5,28,"Big5"),He.GB18030=new He(Ue.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),He.EUC_KR=new He(Ue.EUC_KR,30,"EUC_KR","EUC-KR");class nt extends W{}nt.kind="UnsupportedOperationException";class vt{static decode(c,m){const v=this.encodingName(m);return this.customDecoder?this.customDecoder(c,v):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(v)?this.decodeFallback(c,v):new TextDecoder(v).decode(c)}static shouldDecodeOnFallback(c){return!vt.isBrowser()&&c==="ISO-8859-1"}static encode(c,m){const v=this.encodingName(m);return this.customEncoder?this.customEncoder(c,v):typeof TextEncoder>"u"?this.encodeFallback(c):new TextEncoder().encode(c)}static isBrowser(){return typeof window<"u"&&{}.toString.call(window)==="[object Window]"}static encodingName(c){return typeof c=="string"?c:c.getName()}static encodingCharacterSet(c){return c instanceof He?c:He.getCharacterSetECIByName(c)}static decodeFallback(c,m){const v=this.encodingCharacterSet(m);if(vt.isDecodeFallbackSupported(v)){let C="";for(let I=0,L=c.length;I<L;I++){let k=c[I].toString(16);k.length<2&&(k="0"+k),C+="%"+k}return decodeURIComponent(C)}if(v.equals(He.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(c.buffer));throw new nt(`Encoding ${this.encodingName(m)} not supported by fallback.`)}static isDecodeFallbackSupported(c){return c.equals(He.UTF8)||c.equals(He.ISO8859_1)||c.equals(He.ASCII)}static encodeFallback(c){const v=btoa(unescape(encodeURIComponent(c))).split(""),C=[];for(let I=0;I<v.length;I++)C.push(v[I].charCodeAt(0));return new Uint8Array(C)}}class xt{static castAsNonUtf8Char(c,m=null){const v=m?m.getName():this.ISO88591;return vt.decode(new Uint8Array([c]),v)}static guessEncoding(c,m){if(m!=null&&m.get(fe.CHARACTER_SET)!==void 0)return m.get(fe.CHARACTER_SET).toString();const v=c.length;let C=!0,I=!0,L=!0,k=0,j=0,J=0,pe=0,Ie=0,Ne=0,Ye=0,at=0,ut=0,Et=0,Rt=0;const mi=c.length>3&&c[0]===239&&c[1]===187&&c[2]===191;for(let gi=0;gi<v&&(C||I||L);gi++){const ai=c[gi]&255;L&&(k>0?ai&128?k--:L=!1:ai&128&&(ai&64?(k++,ai&32?(k++,ai&16?(k++,ai&8?L=!1:pe++):J++):j++):L=!1)),C&&(ai>127&&ai<160?C=!1:ai>159&&(ai<192||ai===215||ai===247)&&Rt++),I&&(Ie>0?ai<64||ai===127||ai>252?I=!1:Ie--:ai===128||ai===160||ai>239?I=!1:ai>160&&ai<224?(Ne++,at=0,Ye++,Ye>ut&&(ut=Ye)):ai>127?(Ie++,Ye=0,at++,at>Et&&(Et=at)):(Ye=0,at=0))}return L&&k>0&&(L=!1),I&&Ie>0&&(I=!1),L&&(mi||j+J+pe>0)?xt.UTF8:I&&(xt.ASSUME_SHIFT_JIS||ut>=3||Et>=3)?xt.SHIFT_JIS:C&&I?ut===2&&Ne===2||Rt*10>=v?xt.SHIFT_JIS:xt.ISO88591:C?xt.ISO88591:I?xt.SHIFT_JIS:L?xt.UTF8:xt.PLATFORM_DEFAULT_ENCODING}static format(c,...m){let v=-1;function C(L,k,j,J,pe,Ie){if(L==="%%")return"%";if(m[++v]===void 0)return;L=J?parseInt(J.substr(1)):void 0;let Ne=pe?parseInt(pe.substr(1)):void 0,Ye;switch(Ie){case"s":Ye=m[v];break;case"c":Ye=m[v][0];break;case"f":Ye=parseFloat(m[v]).toFixed(L);break;case"p":Ye=parseFloat(m[v]).toPrecision(L);break;case"e":Ye=parseFloat(m[v]).toExponential(L);break;case"x":Ye=parseInt(m[v]).toString(Ne||16);break;case"d":Ye=parseFloat(parseInt(m[v],Ne||10).toPrecision(L)).toFixed(0);break}Ye=typeof Ye=="object"?JSON.stringify(Ye):(+Ye).toString(Ne);let at=parseInt(j),ut=j&&j[0]+""=="0"?"0":" ";for(;Ye.length<at;)Ye=k!==void 0?Ye+ut:ut+Ye;return Ye}let I=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return c.replace(I,C)}static getBytes(c,m){return vt.encode(c,m)}static getCharCode(c,m=0){return c.charCodeAt(m)}static getCharAt(c){return String.fromCharCode(c)}}xt.SHIFT_JIS=He.SJIS.getName(),xt.GB2312="GB2312",xt.ISO88591=He.ISO8859_1.getName(),xt.EUC_JP="EUC_JP",xt.UTF8=He.UTF8.getName(),xt.PLATFORM_DEFAULT_ENCODING=xt.UTF8,xt.ASSUME_SHIFT_JIS=!1;class Ot{constructor(c=""){this.value=c}enableDecoding(c){return this.encoding=c,this}append(c){return typeof c=="string"?this.value+=c.toString():this.encoding?this.value+=xt.castAsNonUtf8Char(c,this.encoding):this.value+=String.fromCharCode(c),this}appendChars(c,m,v){for(let C=m;m<m+v;C++)this.append(c[C]);return this}length(){return this.value.length}charAt(c){return this.value.charAt(c)}deleteCharAt(c){this.value=this.value.substr(0,c)+this.value.substring(c+1)}setCharAt(c,m){this.value=this.value.substr(0,c)+m+this.value.substr(c+1)}substring(c,m){return this.value.substring(c,m)}setLengthToZero(){this.value=""}toString(){return this.value}insert(c,m){this.value=this.value.substr(0,c)+m+this.value.substr(c+m.length)}}class Ui{constructor(c,m,v,C){if(this.width=c,this.height=m,this.rowSize=v,this.bits=C,m==null&&(m=c),this.height=m,c<1||m<1)throw new se("Both dimensions must be greater than 0");v==null&&(v=Math.floor((c+31)/32)),this.rowSize=v,C==null&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(c){const m=c.length,v=c[0].length,C=new Ui(v,m);for(let I=0;I<m;I++){const L=c[I];for(let k=0;k<v;k++)L[k]&&C.set(k,I)}return C}static parseFromString(c,m,v){if(c===null)throw new se("stringRepresentation cannot be null");const C=new Array(c.length);let I=0,L=0,k=-1,j=0,J=0;for(;J<c.length;)if(c.charAt(J)===`
`||c.charAt(J)==="\r"){if(I>L){if(k===-1)k=I-L;else if(I-L!==k)throw new se("row lengths do not match");L=I,j++}J++}else if(c.substring(J,J+m.length)===m)J+=m.length,C[I]=!0,I++;else if(c.substring(J,J+v.length)===v)J+=v.length,C[I]=!1,I++;else throw new se("illegal character encountered: "+c.substring(J));if(I>L){if(k===-1)k=I-L;else if(I-L!==k)throw new se("row lengths do not match");j++}const pe=new Ui(k,j);for(let Ie=0;Ie<I;Ie++)C[Ie]&&pe.set(Math.floor(Ie%k),Math.floor(Ie/k));return pe}get(c,m){const v=m*this.rowSize+Math.floor(c/32);return(this.bits[v]>>>(c&31)&1)!==0}set(c,m){const v=m*this.rowSize+Math.floor(c/32);this.bits[v]|=1<<(c&31)&4294967295}unset(c,m){const v=m*this.rowSize+Math.floor(c/32);this.bits[v]&=~(1<<(c&31)&4294967295)}flip(c,m){const v=m*this.rowSize+Math.floor(c/32);this.bits[v]^=1<<(c&31)&4294967295}xor(c){if(this.width!==c.getWidth()||this.height!==c.getHeight()||this.rowSize!==c.getRowSize())throw new se("input matrix dimensions do not match");const m=new Q(Math.floor(this.width/32)+1),v=this.rowSize,C=this.bits;for(let I=0,L=this.height;I<L;I++){const k=I*v,j=c.getRow(I,m).getBitArray();for(let J=0;J<v;J++)C[k+J]^=j[J]}}clear(){const c=this.bits,m=c.length;for(let v=0;v<m;v++)c[v]=0}setRegion(c,m,v,C){if(m<0||c<0)throw new se("Left and top must be nonnegative");if(C<1||v<1)throw new se("Height and width must be at least 1");const I=c+v,L=m+C;if(L>this.height||I>this.width)throw new se("The region must fit inside the matrix");const k=this.rowSize,j=this.bits;for(let J=m;J<L;J++){const pe=J*k;for(let Ie=c;Ie<I;Ie++)j[pe+Math.floor(Ie/32)]|=1<<(Ie&31)&4294967295}}getRow(c,m){m==null||m.getSize()<this.width?m=new Q(this.width):m.clear();const v=this.rowSize,C=this.bits,I=c*v;for(let L=0;L<v;L++)m.setBulk(L*32,C[I+L]);return m}setRow(c,m){K.arraycopy(m.getBitArray(),0,this.bits,c*this.rowSize,this.rowSize)}rotate180(){const c=this.getWidth(),m=this.getHeight();let v=new Q(c),C=new Q(c);for(let I=0,L=Math.floor((m+1)/2);I<L;I++)v=this.getRow(I,v),C=this.getRow(m-1-I,C),v.reverse(),C.reverse(),this.setRow(I,C),this.setRow(m-1-I,v)}getEnclosingRectangle(){const c=this.width,m=this.height,v=this.rowSize,C=this.bits;let I=c,L=m,k=-1,j=-1;for(let J=0;J<m;J++)for(let pe=0;pe<v;pe++){const Ie=C[J*v+pe];if(Ie!==0){if(J<L&&(L=J),J>j&&(j=J),pe*32<I){let Ne=0;for(;!(Ie<<31-Ne&4294967295);)Ne++;pe*32+Ne<I&&(I=pe*32+Ne)}if(pe*32+31>k){let Ne=31;for(;!(Ie>>>Ne);)Ne--;pe*32+Ne>k&&(k=pe*32+Ne)}}}return k<I||j<L?null:Int32Array.from([I,L,k-I+1,j-L+1])}getTopLeftOnBit(){const c=this.rowSize,m=this.bits;let v=0;for(;v<m.length&&m[v]===0;)v++;if(v===m.length)return null;const C=v/c;let I=v%c*32;const L=m[v];let k=0;for(;!(L<<31-k&4294967295);)k++;return I+=k,Int32Array.from([I,C])}getBottomRightOnBit(){const c=this.rowSize,m=this.bits;let v=m.length-1;for(;v>=0&&m[v]===0;)v--;if(v<0)return null;const C=Math.floor(v/c);let I=Math.floor(v%c)*32;const L=m[v];let k=31;for(;!(L>>>k);)k--;return I+=k,Int32Array.from([I,C])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(c){if(!(c instanceof Ui))return!1;const m=c;return this.width===m.width&&this.height===m.height&&this.rowSize===m.rowSize&&q.equals(this.bits,m.bits)}hashCode(){let c=this.width;return c=31*c+this.width,c=31*c+this.height,c=31*c+this.rowSize,c=31*c+q.hashCode(this.bits),c}toString(c="X ",m="  ",v=`
`){return this.buildToString(c,m,v)}buildToString(c,m,v){let C=new Ot;for(let I=0,L=this.height;I<L;I++){for(let k=0,j=this.width;k<j;k++)C.append(this.get(k,I)?c:m);C.append(v)}return C.toString()}clone(){return new Ui(this.width,this.height,this.rowSize,this.bits.slice())}}class Mt extends W{static getNotFoundInstance(){return new Mt}}Mt.kind="NotFoundException";class _i extends he{constructor(c){super(c),this.luminances=_i.EMPTY,this.buckets=new Int32Array(_i.LUMINANCE_BUCKETS)}getBlackRow(c,m){const v=this.getLuminanceSource(),C=v.getWidth();m==null||m.getSize()<C?m=new Q(C):m.clear(),this.initArrays(C);const I=v.getRow(c,this.luminances),L=this.buckets;for(let j=0;j<C;j++)L[(I[j]&255)>>_i.LUMINANCE_SHIFT]++;const k=_i.estimateBlackPoint(L);if(C<3)for(let j=0;j<C;j++)(I[j]&255)<k&&m.set(j);else{let j=I[0]&255,J=I[1]&255;for(let pe=1;pe<C-1;pe++){const Ie=I[pe+1]&255;(J*4-j-Ie)/2<k&&m.set(pe),j=J,J=Ie}}return m}getBlackMatrix(){const c=this.getLuminanceSource(),m=c.getWidth(),v=c.getHeight(),C=new Ui(m,v);this.initArrays(m);const I=this.buckets;for(let j=1;j<5;j++){const J=Math.floor(v*j/5),pe=c.getRow(J,this.luminances),Ie=Math.floor(m*4/5);for(let Ne=Math.floor(m/5);Ne<Ie;Ne++){const Ye=pe[Ne]&255;I[Ye>>_i.LUMINANCE_SHIFT]++}}const L=_i.estimateBlackPoint(I),k=c.getMatrix();for(let j=0;j<v;j++){const J=j*m;for(let pe=0;pe<m;pe++)(k[J+pe]&255)<L&&C.set(pe,j)}return C}createBinarizer(c){return new _i(c)}initArrays(c){this.luminances.length<c&&(this.luminances=new Uint8ClampedArray(c));const m=this.buckets;for(let v=0;v<_i.LUMINANCE_BUCKETS;v++)m[v]=0}static estimateBlackPoint(c){const m=c.length;let v=0,C=0,I=0;for(let pe=0;pe<m;pe++)c[pe]>I&&(C=pe,I=c[pe]),c[pe]>v&&(v=c[pe]);let L=0,k=0;for(let pe=0;pe<m;pe++){const Ie=pe-C,Ne=c[pe]*Ie*Ie;Ne>k&&(L=pe,k=Ne)}if(C>L){const pe=C;C=L,L=pe}if(L-C<=m/16)throw new Mt;let j=L-1,J=-1;for(let pe=L-1;pe>C;pe--){const Ie=pe-C,Ne=Ie*Ie*(L-pe)*(v-c[pe]);Ne>J&&(j=pe,J=Ne)}return j<<_i.LUMINANCE_SHIFT}}_i.LUMINANCE_BITS=5,_i.LUMINANCE_SHIFT=8-_i.LUMINANCE_BITS,_i.LUMINANCE_BUCKETS=1<<_i.LUMINANCE_BITS,_i.EMPTY=Uint8ClampedArray.from([0]);class di extends _i{constructor(c){super(c),this.matrix=null}getBlackMatrix(){if(this.matrix!==null)return this.matrix;const c=this.getLuminanceSource(),m=c.getWidth(),v=c.getHeight();if(m>=di.MINIMUM_DIMENSION&&v>=di.MINIMUM_DIMENSION){const C=c.getMatrix();let I=m>>di.BLOCK_SIZE_POWER;m&di.BLOCK_SIZE_MASK&&I++;let L=v>>di.BLOCK_SIZE_POWER;v&di.BLOCK_SIZE_MASK&&L++;const k=di.calculateBlackPoints(C,I,L,m,v),j=new Ui(m,v);di.calculateThresholdForBlock(C,I,L,m,v,k,j),this.matrix=j}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(c){return new di(c)}static calculateThresholdForBlock(c,m,v,C,I,L,k){const j=I-di.BLOCK_SIZE,J=C-di.BLOCK_SIZE;for(let pe=0;pe<v;pe++){let Ie=pe<<di.BLOCK_SIZE_POWER;Ie>j&&(Ie=j);const Ne=di.cap(pe,2,v-3);for(let Ye=0;Ye<m;Ye++){let at=Ye<<di.BLOCK_SIZE_POWER;at>J&&(at=J);const ut=di.cap(Ye,2,m-3);let Et=0;for(let mi=-2;mi<=2;mi++){const gi=L[Ne+mi];Et+=gi[ut-2]+gi[ut-1]+gi[ut]+gi[ut+1]+gi[ut+2]}const Rt=Et/25;di.thresholdBlock(c,at,Ie,Rt,C,k)}}}static cap(c,m,v){return c<m?m:c>v?v:c}static thresholdBlock(c,m,v,C,I,L){for(let k=0,j=v*I+m;k<di.BLOCK_SIZE;k++,j+=I)for(let J=0;J<di.BLOCK_SIZE;J++)(c[j+J]&255)<=C&&L.set(m+J,v+k)}static calculateBlackPoints(c,m,v,C,I){const L=I-di.BLOCK_SIZE,k=C-di.BLOCK_SIZE,j=new Array(v);for(let J=0;J<v;J++){j[J]=new Int32Array(m);let pe=J<<di.BLOCK_SIZE_POWER;pe>L&&(pe=L);for(let Ie=0;Ie<m;Ie++){let Ne=Ie<<di.BLOCK_SIZE_POWER;Ne>k&&(Ne=k);let Ye=0,at=255,ut=0;for(let Rt=0,mi=pe*C+Ne;Rt<di.BLOCK_SIZE;Rt++,mi+=C){for(let gi=0;gi<di.BLOCK_SIZE;gi++){const ai=c[mi+gi]&255;Ye+=ai,ai<at&&(at=ai),ai>ut&&(ut=ai)}if(ut-at>di.MIN_DYNAMIC_RANGE)for(Rt++,mi+=C;Rt<di.BLOCK_SIZE;Rt++,mi+=C)for(let gi=0;gi<di.BLOCK_SIZE;gi++)Ye+=c[mi+gi]&255}let Et=Ye>>di.BLOCK_SIZE_POWER*2;if(ut-at<=di.MIN_DYNAMIC_RANGE&&(Et=at/2,J>0&&Ie>0)){const Rt=(j[J-1][Ie]+2*j[J][Ie-1]+j[J-1][Ie-1])/4;at<Rt&&(Et=Rt)}j[J][Ie]=Et}}return j}}di.BLOCK_SIZE_POWER=3,di.BLOCK_SIZE=1<<di.BLOCK_SIZE_POWER,di.BLOCK_SIZE_MASK=di.BLOCK_SIZE-1,di.MINIMUM_DIMENSION=di.BLOCK_SIZE*5,di.MIN_DYNAMIC_RANGE=24;class Un{constructor(c,m){this.width=c,this.height=m}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(c,m,v,C){throw new nt("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new nt("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new nt("This luminance source does not support rotation by 45 degrees.")}toString(){const c=new Uint8ClampedArray(this.width);let m=new Ot;for(let v=0;v<this.height;v++){const C=this.getRow(v,c);for(let I=0;I<this.width;I++){const L=C[I]&255;let k;L<64?k="#":L<128?k="+":L<192?k=".":k=" ",m.append(k)}m.append(`
`)}return m.toString()}}class Nn extends Un{constructor(c){super(c.getWidth(),c.getHeight()),this.delegate=c}getRow(c,m){const v=this.delegate.getRow(c,m),C=this.getWidth();for(let I=0;I<C;I++)v[I]=255-(v[I]&255);return v}getMatrix(){const c=this.delegate.getMatrix(),m=this.getWidth()*this.getHeight(),v=new Uint8ClampedArray(m);for(let C=0;C<m;C++)v[C]=255-(c[C]&255);return v}isCropSupported(){return this.delegate.isCropSupported()}crop(c,m,v,C){return new Nn(this.delegate.crop(c,m,v,C))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new Nn(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new Nn(this.delegate.rotateCounterClockwise45())}}class Vi extends Un{constructor(c){super(c.width,c.height),this.canvas=c,this.tempCanvasElement=null,this.buffer=Vi.makeBufferFromCanvasImageData(c)}static makeBufferFromCanvasImageData(c){const m=c.getContext("2d").getImageData(0,0,c.width,c.height);return Vi.toGrayscaleBuffer(m.data,c.width,c.height)}static toGrayscaleBuffer(c,m,v){const C=new Uint8ClampedArray(m*v);for(let I=0,L=0,k=c.length;I<k;I+=4,L++){let j;if(c[I+3]===0)j=255;else{const pe=c[I],Ie=c[I+1],Ne=c[I+2];j=306*pe+601*Ie+117*Ne+512>>10}C[L]=j}return C}getRow(c,m){if(c<0||c>=this.getHeight())throw new se("Requested row is outside the image: "+c);const v=this.getWidth(),C=c*v;return m===null?m=this.buffer.slice(C,C+v):(m.length<v&&(m=new Uint8ClampedArray(v)),m.set(this.buffer.slice(C,C+v))),m}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(c,m,v,C){return super.crop(c,m,v,C),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(this.tempCanvasElement===null){const c=this.canvas.ownerDocument.createElement("canvas");c.width=this.canvas.width,c.height=this.canvas.height,this.tempCanvasElement=c}return this.tempCanvasElement}rotate(c){const m=this.getTempCanvasElement(),v=m.getContext("2d"),C=c*Vi.DEGREE_TO_RADIANS,I=this.canvas.width,L=this.canvas.height,k=Math.ceil(Math.abs(Math.cos(C))*I+Math.abs(Math.sin(C))*L),j=Math.ceil(Math.abs(Math.sin(C))*I+Math.abs(Math.cos(C))*L);return m.width=k,m.height=j,v.translate(k/2,j/2),v.rotate(C),v.drawImage(this.canvas,I/-2,L/-2),this.buffer=Vi.makeBufferFromCanvasImageData(m),this}invert(){return new Nn(this)}}Vi.DEGREE_TO_RADIANS=Math.PI/180;class Vr{constructor(c,m,v){this.deviceId=c,this.label=m,this.kind="videoinput",this.groupId=v||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var Oi=(globalThis||Po||self||window||void 0)&&(globalThis||Po||self||window||void 0).__awaiter||function(Te,c,m,v){function C(I){return I instanceof m?I:new m(function(L){L(I)})}return new(m||(m=Promise))(function(I,L){function k(pe){try{J(v.next(pe))}catch(Ie){L(Ie)}}function j(pe){try{J(v.throw(pe))}catch(Ie){L(Ie)}}function J(pe){pe.done?I(pe.value):C(pe.value).then(k,j)}J((v=v.apply(Te,c||[])).next())})};class ir{constructor(c,m=500,v){this.reader=c,this.timeBetweenScansMillis=m,this._hints=v,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return typeof navigator<"u"}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(c){this._timeBetweenDecodingAttempts=c<0?0:c}set hints(c){this._hints=c||null}get hints(){return this._hints}listVideoInputDevices(){return Oi(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const c=yield navigator.mediaDevices.enumerateDevices(),m=[];for(const v of c){const C=v.kind==="video"?"videoinput":v.kind;if(C!=="videoinput")continue;const I=v.deviceId||v.id,L=v.label||`Video device ${m.length+1}`,k=v.groupId,j={deviceId:I,label:L,kind:C,groupId:k};m.push(j)}return m})}getVideoInputDevices(){return Oi(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(m=>new Vr(m.deviceId,m.label))})}findDeviceById(c){return Oi(this,void 0,void 0,function*(){const m=yield this.listVideoInputDevices();return m?m.find(v=>v.deviceId===c):null})}decodeFromInputVideoDevice(c,m){return Oi(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(c,m)})}decodeOnceFromVideoDevice(c,m){return Oi(this,void 0,void 0,function*(){this.reset();let v;c?v={deviceId:{exact:c}}:v={facingMode:"environment"};const C={video:v};return yield this.decodeOnceFromConstraints(C,m)})}decodeOnceFromConstraints(c,m){return Oi(this,void 0,void 0,function*(){const v=yield navigator.mediaDevices.getUserMedia(c);return yield this.decodeOnceFromStream(v,m)})}decodeOnceFromStream(c,m){return Oi(this,void 0,void 0,function*(){this.reset();const v=yield this.attachStreamToVideo(c,m);return yield this.decodeOnce(v)})}decodeFromInputVideoDeviceContinuously(c,m,v){return Oi(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(c,m,v)})}decodeFromVideoDevice(c,m,v){return Oi(this,void 0,void 0,function*(){let C;c?C={deviceId:{exact:c}}:C={facingMode:"environment"};const I={video:C};return yield this.decodeFromConstraints(I,m,v)})}decodeFromConstraints(c,m,v){return Oi(this,void 0,void 0,function*(){const C=yield navigator.mediaDevices.getUserMedia(c);return yield this.decodeFromStream(C,m,v)})}decodeFromStream(c,m,v){return Oi(this,void 0,void 0,function*(){this.reset();const C=yield this.attachStreamToVideo(c,m);return yield this.decodeContinuously(C,v)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(c,m){return Oi(this,void 0,void 0,function*(){const v=this.prepareVideoElement(m);return this.addVideoSource(v,c),this.videoElement=v,this.stream=c,yield this.playVideoOnLoadAsync(v),v})}playVideoOnLoadAsync(c){return new Promise((m,v)=>this.playVideoOnLoad(c,()=>m()))}playVideoOnLoad(c,m){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(c),c.addEventListener("ended",this.videoEndedListener),c.addEventListener("canplay",this.videoCanPlayListener),c.addEventListener("playing",m),this.tryPlayVideo(c)}isVideoPlaying(c){return c.currentTime>0&&!c.paused&&!c.ended&&c.readyState>2}tryPlayVideo(c){return Oi(this,void 0,void 0,function*(){if(this.isVideoPlaying(c)){console.warn("Trying to play video that is already playing.");return}try{yield c.play()}catch{console.warn("It was not possible to play the video.")}})}getMediaElement(c,m){const v=document.getElementById(c);if(!v)throw new Y(`element with id '${c}' not found`);if(v.nodeName.toLowerCase()!==m.toLowerCase())throw new Y(`element with id '${c}' must be an ${m} element`);return v}decodeFromImage(c,m){if(!c&&!m)throw new Y("either imageElement with a src set or an url must be provided");return m&&!c?this.decodeFromImageUrl(m):this.decodeFromImageElement(c)}decodeFromVideo(c,m){if(!c&&!m)throw new Y("Either an element with a src set or an URL must be provided");return m&&!c?this.decodeFromVideoUrl(m):this.decodeFromVideoElement(c)}decodeFromVideoContinuously(c,m,v){if(c===void 0&&m===void 0)throw new Y("Either an element with a src set or an URL must be provided");return m&&!c?this.decodeFromVideoUrlContinuously(m,v):this.decodeFromVideoElementContinuously(c,v)}decodeFromImageElement(c){if(!c)throw new Y("An image element must be provided.");this.reset();const m=this.prepareImageElement(c);this.imageElement=m;let v;return this.isImageLoaded(m)?v=this.decodeOnce(m,!1,!0):v=this._decodeOnLoadImage(m),v}decodeFromVideoElement(c){const m=this._decodeFromVideoElementSetup(c);return this._decodeOnLoadVideo(m)}decodeFromVideoElementContinuously(c,m){const v=this._decodeFromVideoElementSetup(c);return this._decodeOnLoadVideoContinuously(v,m)}_decodeFromVideoElementSetup(c){if(!c)throw new Y("A video element must be provided.");this.reset();const m=this.prepareVideoElement(c);return this.videoElement=m,m}decodeFromImageUrl(c){if(!c)throw new Y("An URL must be provided.");this.reset();const m=this.prepareImageElement();this.imageElement=m;const v=this._decodeOnLoadImage(m);return m.src=c,v}decodeFromVideoUrl(c){if(!c)throw new Y("An URL must be provided.");this.reset();const m=this.prepareVideoElement(),v=this.decodeFromVideoElement(m);return m.src=c,v}decodeFromVideoUrlContinuously(c,m){if(!c)throw new Y("An URL must be provided.");this.reset();const v=this.prepareVideoElement(),C=this.decodeFromVideoElementContinuously(v,m);return v.src=c,C}_decodeOnLoadImage(c){return new Promise((m,v)=>{this.imageLoadedListener=()=>this.decodeOnce(c,!1,!0).then(m,v),c.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(c){return Oi(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(c),yield this.decodeOnce(c)})}_decodeOnLoadVideoContinuously(c,m){return Oi(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(c),this.decodeContinuously(c,m)})}isImageLoaded(c){return!(!c.complete||c.naturalWidth===0)}prepareImageElement(c){let m;return typeof c>"u"&&(m=document.createElement("img"),m.width=200,m.height=200),typeof c=="string"&&(m=this.getMediaElement(c,"img")),c instanceof HTMLImageElement&&(m=c),m}prepareVideoElement(c){let m;return!c&&typeof document<"u"&&(m=document.createElement("video"),m.width=200,m.height=200),typeof c=="string"&&(m=this.getMediaElement(c,"video")),c instanceof HTMLVideoElement&&(m=c),m.setAttribute("autoplay","true"),m.setAttribute("muted","true"),m.setAttribute("playsinline","true"),m}decodeOnce(c,m=!0,v=!0){this._stopAsyncDecode=!1;const C=(I,L)=>{if(this._stopAsyncDecode){L(new Mt("Video stream has ended before any code could be detected.")),this._stopAsyncDecode=void 0;return}try{const k=this.decode(c);I(k)}catch(k){const j=m&&k instanceof Mt,pe=(k instanceof Ce||k instanceof ce)&&v;if(j||pe)return setTimeout(C,this._timeBetweenDecodingAttempts,I,L);L(k)}};return new Promise((I,L)=>C(I,L))}decodeContinuously(c,m){this._stopContinuousDecode=!1;const v=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=void 0;return}try{const C=this.decode(c);m(C,null),setTimeout(v,this.timeBetweenScansMillis)}catch(C){m(null,C);const I=C instanceof Ce||C instanceof ce,L=C instanceof Mt;(I||L)&&setTimeout(v,this._timeBetweenDecodingAttempts)}};v()}decode(c){const m=this.createBinaryBitmap(c);return this.decodeBitmap(m)}_isHTMLVideoElement(c){return c.videoWidth!==0}drawFrameOnCanvas(c,m,v){m||(m={sx:0,sy:0,sWidth:c.videoWidth,sHeight:c.videoHeight,dx:0,dy:0,dWidth:c.videoWidth,dHeight:c.videoHeight}),v||(v=this.captureCanvasContext),v.drawImage(c,m.sx,m.sy,m.sWidth,m.sHeight,m.dx,m.dy,m.dWidth,m.dHeight)}drawImageOnCanvas(c,m,v=this.captureCanvasContext){m||(m={sx:0,sy:0,sWidth:c.naturalWidth,sHeight:c.naturalHeight,dx:0,dy:0,dWidth:c.naturalWidth,dHeight:c.naturalHeight}),v||(v=this.captureCanvasContext),v.drawImage(c,m.sx,m.sy,m.sWidth,m.sHeight,m.dx,m.dy,m.dWidth,m.dHeight)}createBinaryBitmap(c){this.getCaptureCanvasContext(c),this._isHTMLVideoElement(c)?this.drawFrameOnCanvas(c):this.drawImageOnCanvas(c);const m=this.getCaptureCanvas(c),v=new Vi(m),C=new di(v);return new Ae(C)}getCaptureCanvasContext(c){if(!this.captureCanvasContext){const v=this.getCaptureCanvas(c).getContext("2d");this.captureCanvasContext=v}return this.captureCanvasContext}getCaptureCanvas(c){if(!this.captureCanvas){const m=this.createCaptureCanvas(c);this.captureCanvas=m}return this.captureCanvas}decodeBitmap(c){return this.reader.decode(c,this._hints)}createCaptureCanvas(c){if(typeof document>"u")return this._destroyCaptureCanvas(),null;const m=document.createElement("canvas");let v,C;return typeof c<"u"&&(c instanceof HTMLVideoElement?(v=c.videoWidth,C=c.videoHeight):c instanceof HTMLImageElement&&(v=c.naturalWidth||c.width,C=c.naturalHeight||c.height)),m.style.width=v+"px",m.style.height=C+"px",m.width=v,m.height=C,m}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(c=>c.stop()),this.stream=void 0),this._stopAsyncDecode===!1&&this.stopAsyncDecode(),this._stopContinuousDecode===!1&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(this.imageLoadedListener!==void 0&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(c,m){try{c.srcObject=m}catch{c.src=URL.createObjectURL(m)}}cleanVideoSource(c){try{c.srcObject=null}catch{c.src=""}this.videoElement.removeAttribute("src")}}class fn{constructor(c,m,v=m==null?0:8*m.length,C,I,L=K.currentTimeMillis()){this.text=c,this.rawBytes=m,this.numBits=v,this.resultPoints=C,this.format=I,this.timestamp=L,this.text=c,this.rawBytes=m,v==null?this.numBits=m==null?0:8*m.length:this.numBits=v,this.resultPoints=C,this.format=I,this.resultMetadata=null,L==null?this.timestamp=K.currentTimeMillis():this.timestamp=L}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(c,m){this.resultMetadata===null&&(this.resultMetadata=new Map),this.resultMetadata.set(c,m)}putAllMetadata(c){c!==null&&(this.resultMetadata===null?this.resultMetadata=c:this.resultMetadata=new Map(c))}addResultPoints(c){const m=this.resultPoints;if(m===null)this.resultPoints=c;else if(c!==null&&c.length>0){const v=new Array(m.length+c.length);K.arraycopy(m,0,v,0,m.length),K.arraycopy(c,0,v,m.length,c.length),this.resultPoints=v}}getTimestamp(){return this.timestamp}toString(){return this.text}}var At;(function(Te){Te[Te.AZTEC=0]="AZTEC",Te[Te.CODABAR=1]="CODABAR",Te[Te.CODE_39=2]="CODE_39",Te[Te.CODE_93=3]="CODE_93",Te[Te.CODE_128=4]="CODE_128",Te[Te.DATA_MATRIX=5]="DATA_MATRIX",Te[Te.EAN_8=6]="EAN_8",Te[Te.EAN_13=7]="EAN_13",Te[Te.ITF=8]="ITF",Te[Te.MAXICODE=9]="MAXICODE",Te[Te.PDF_417=10]="PDF_417",Te[Te.QR_CODE=11]="QR_CODE",Te[Te.RSS_14=12]="RSS_14",Te[Te.RSS_EXPANDED=13]="RSS_EXPANDED",Te[Te.UPC_A=14]="UPC_A",Te[Te.UPC_E=15]="UPC_E",Te[Te.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(At||(At={}));var Ri=At,Lr;(function(Te){Te[Te.OTHER=0]="OTHER",Te[Te.ORIENTATION=1]="ORIENTATION",Te[Te.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",Te[Te.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",Te[Te.ISSUE_NUMBER=4]="ISSUE_NUMBER",Te[Te.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",Te[Te.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",Te[Te.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",Te[Te.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",Te[Te.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",Te[Te.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"})(Lr||(Lr={}));var si=Lr;class zi{constructor(c,m,v,C,I=-1,L=-1){this.rawBytes=c,this.text=m,this.byteSegments=v,this.ecLevel=C,this.structuredAppendSequenceNumber=I,this.structuredAppendParity=L,this.numBits=c==null?0:8*c.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(c){this.numBits=c}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(c){this.errorsCorrected=c}getErasures(){return this.erasures}setErasures(c){this.erasures=c}getOther(){return this.other}setOther(c){this.other=c}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class Qi{exp(c){return this.expTable[c]}log(c){if(c===0)throw new se;return this.logTable[c]}static addOrSubtract(c,m){return c^m}}class Sn{constructor(c,m){if(m.length===0)throw new se;this.field=c;const v=m.length;if(v>1&&m[0]===0){let C=1;for(;C<v&&m[C]===0;)C++;C===v?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(v-C),K.arraycopy(m,C,this.coefficients,0,this.coefficients.length))}else this.coefficients=m}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(c){return this.coefficients[this.coefficients.length-1-c]}evaluateAt(c){if(c===0)return this.getCoefficient(0);const m=this.coefficients;let v;if(c===1){v=0;for(let L=0,k=m.length;L!==k;L++){const j=m[L];v=Qi.addOrSubtract(v,j)}return v}v=m[0];const C=m.length,I=this.field;for(let L=1;L<C;L++)v=Qi.addOrSubtract(I.multiply(c,v),m[L]);return v}addOrSubtract(c){if(!this.field.equals(c.field))throw new se("GenericGFPolys do not have same GenericGF field");if(this.isZero())return c;if(c.isZero())return this;let m=this.coefficients,v=c.coefficients;if(m.length>v.length){const L=m;m=v,v=L}let C=new Int32Array(v.length);const I=v.length-m.length;K.arraycopy(v,0,C,0,I);for(let L=I;L<v.length;L++)C[L]=Qi.addOrSubtract(m[L-I],v[L]);return new Sn(this.field,C)}multiply(c){if(!this.field.equals(c.field))throw new se("GenericGFPolys do not have same GenericGF field");if(this.isZero()||c.isZero())return this.field.getZero();const m=this.coefficients,v=m.length,C=c.coefficients,I=C.length,L=new Int32Array(v+I-1),k=this.field;for(let j=0;j<v;j++){const J=m[j];for(let pe=0;pe<I;pe++)L[j+pe]=Qi.addOrSubtract(L[j+pe],k.multiply(J,C[pe]))}return new Sn(k,L)}multiplyScalar(c){if(c===0)return this.field.getZero();if(c===1)return this;const m=this.coefficients.length,v=this.field,C=new Int32Array(m),I=this.coefficients;for(let L=0;L<m;L++)C[L]=v.multiply(I[L],c);return new Sn(v,C)}multiplyByMonomial(c,m){if(c<0)throw new se;if(m===0)return this.field.getZero();const v=this.coefficients,C=v.length,I=new Int32Array(C+c),L=this.field;for(let k=0;k<C;k++)I[k]=L.multiply(v[k],m);return new Sn(L,I)}divide(c){if(!this.field.equals(c.field))throw new se("GenericGFPolys do not have same GenericGF field");if(c.isZero())throw new se("Divide by 0");const m=this.field;let v=m.getZero(),C=this;const I=c.getCoefficient(c.getDegree()),L=m.inverse(I);for(;C.getDegree()>=c.getDegree()&&!C.isZero();){const k=C.getDegree()-c.getDegree(),j=m.multiply(C.getCoefficient(C.getDegree()),L),J=c.multiplyByMonomial(k,j),pe=m.buildMonomial(k,j);v=v.addOrSubtract(pe),C=C.addOrSubtract(J)}return[v,C]}toString(){let c="";for(let m=this.getDegree();m>=0;m--){let v=this.getCoefficient(m);if(v!==0){if(v<0?(c+=" - ",v=-v):c.length>0&&(c+=" + "),m===0||v!==1){const C=this.field.log(v);C===0?c+="1":C===1?c+="a":(c+="a^",c+=C)}m!==0&&(m===1?c+="x":(c+="x^",c+=m))}}return c}}class Co extends W{}Co.kind="ArithmeticException";class fi extends Qi{constructor(c,m,v){super(),this.primitive=c,this.size=m,this.generatorBase=v;const C=new Int32Array(m);let I=1;for(let k=0;k<m;k++)C[k]=I,I*=2,I>=m&&(I^=c,I&=m-1);this.expTable=C;const L=new Int32Array(m);for(let k=0;k<m-1;k++)L[C[k]]=k;this.logTable=L,this.zero=new Sn(this,Int32Array.from([0])),this.one=new Sn(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(c,m){if(c<0)throw new se;if(m===0)return this.zero;const v=new Int32Array(c+1);return v[0]=m,new Sn(this,v)}inverse(c){if(c===0)throw new Co;return this.expTable[this.size-this.logTable[c]-1]}multiply(c,m){return c===0||m===0?0:this.expTable[(this.logTable[c]+this.logTable[m])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+G.toHexString(this.primitive)+","+this.size+")"}equals(c){return c===this}}fi.AZTEC_DATA_12=new fi(4201,4096,1),fi.AZTEC_DATA_10=new fi(1033,1024,1),fi.AZTEC_DATA_6=new fi(67,64,1),fi.AZTEC_PARAM=new fi(19,16,1),fi.QR_CODE_FIELD_256=new fi(285,256,0),fi.DATA_MATRIX_FIELD_256=new fi(301,256,1),fi.AZTEC_DATA_8=fi.DATA_MATRIX_FIELD_256,fi.MAXICODE_FIELD_64=fi.AZTEC_DATA_6;class $r extends W{}$r.kind="ReedSolomonException";class Or extends W{}Or.kind="IllegalStateException";class Hi{constructor(c){this.field=c}decode(c,m){const v=this.field,C=new Sn(v,c),I=new Int32Array(m);let L=!0;for(let Ye=0;Ye<m;Ye++){const at=C.evaluateAt(v.exp(Ye+v.getGeneratorBase()));I[I.length-1-Ye]=at,at!==0&&(L=!1)}if(L)return;const k=new Sn(v,I),j=this.runEuclideanAlgorithm(v.buildMonomial(m,1),k,m),J=j[0],pe=j[1],Ie=this.findErrorLocations(J),Ne=this.findErrorMagnitudes(pe,Ie);for(let Ye=0;Ye<Ie.length;Ye++){const at=c.length-1-v.log(Ie[Ye]);if(at<0)throw new $r("Bad error location");c[at]=fi.addOrSubtract(c[at],Ne[Ye])}}runEuclideanAlgorithm(c,m,v){if(c.getDegree()<m.getDegree()){const Ye=c;c=m,m=Ye}const C=this.field;let I=c,L=m,k=C.getZero(),j=C.getOne();for(;L.getDegree()>=(v/2|0);){let Ye=I,at=k;if(I=L,k=j,I.isZero())throw new $r("r_{i-1} was zero");L=Ye;let ut=C.getZero();const Et=I.getCoefficient(I.getDegree()),Rt=C.inverse(Et);for(;L.getDegree()>=I.getDegree()&&!L.isZero();){const mi=L.getDegree()-I.getDegree(),gi=C.multiply(L.getCoefficient(L.getDegree()),Rt);ut=ut.addOrSubtract(C.buildMonomial(mi,gi)),L=L.addOrSubtract(I.multiplyByMonomial(mi,gi))}if(j=ut.multiply(k).addOrSubtract(at),L.getDegree()>=I.getDegree())throw new Or("Division algorithm failed to reduce polynomial?")}const J=j.getCoefficient(0);if(J===0)throw new $r("sigmaTilde(0) was zero");const pe=C.inverse(J),Ie=j.multiplyScalar(pe),Ne=L.multiplyScalar(pe);return[Ie,Ne]}findErrorLocations(c){const m=c.getDegree();if(m===1)return Int32Array.from([c.getCoefficient(1)]);const v=new Int32Array(m);let C=0;const I=this.field;for(let L=1;L<I.getSize()&&C<m;L++)c.evaluateAt(L)===0&&(v[C]=I.inverse(L),C++);if(C!==m)throw new $r("Error locator degree does not match number of roots");return v}findErrorMagnitudes(c,m){const v=m.length,C=new Int32Array(v),I=this.field;for(let L=0;L<v;L++){const k=I.inverse(m[L]);let j=1;for(let J=0;J<v;J++)if(L!==J){const pe=I.multiply(m[J],k),Ie=pe&1?pe&-2:pe|1;j=I.multiply(j,Ie)}C[L]=I.multiply(c.evaluateAt(k),I.inverse(j)),I.getGeneratorBase()!==0&&(C[L]=I.multiply(C[L],k))}return C}}var Hn;(function(Te){Te[Te.UPPER=0]="UPPER",Te[Te.LOWER=1]="LOWER",Te[Te.MIXED=2]="MIXED",Te[Te.DIGIT=3]="DIGIT",Te[Te.PUNCT=4]="PUNCT",Te[Te.BINARY=5]="BINARY"})(Hn||(Hn={}));class Fn{decode(c){this.ddata=c;let m=c.getBits(),v=this.extractBits(m),C=this.correctBits(v),I=Fn.convertBoolArrayToByteArray(C),L=Fn.getEncodedData(C),k=new zi(I,L,null,null);return k.setNumBits(C.length),k}static highLevelDecode(c){return this.getEncodedData(c)}static getEncodedData(c){let m=c.length,v=Hn.UPPER,C=Hn.UPPER,I="",L=0;for(;L<m;)if(C===Hn.BINARY){if(m-L<5)break;let k=Fn.readCode(c,L,5);if(L+=5,k===0){if(m-L<11)break;k=Fn.readCode(c,L,11)+31,L+=11}for(let j=0;j<k;j++){if(m-L<8){L=m;break}const J=Fn.readCode(c,L,8);I+=xt.castAsNonUtf8Char(J),L+=8}C=v}else{let k=C===Hn.DIGIT?4:5;if(m-L<k)break;let j=Fn.readCode(c,L,k);L+=k;let J=Fn.getCharacter(C,j);J.startsWith("CTRL_")?(v=C,C=Fn.getTable(J.charAt(5)),J.charAt(6)==="L"&&(v=C)):(I+=J,C=v)}return I}static getTable(c){switch(c){case"L":return Hn.LOWER;case"P":return Hn.PUNCT;case"M":return Hn.MIXED;case"D":return Hn.DIGIT;case"B":return Hn.BINARY;case"U":default:return Hn.UPPER}}static getCharacter(c,m){switch(c){case Hn.UPPER:return Fn.UPPER_TABLE[m];case Hn.LOWER:return Fn.LOWER_TABLE[m];case Hn.MIXED:return Fn.MIXED_TABLE[m];case Hn.PUNCT:return Fn.PUNCT_TABLE[m];case Hn.DIGIT:return Fn.DIGIT_TABLE[m];default:throw new Or("Bad table")}}correctBits(c){let m,v;this.ddata.getNbLayers()<=2?(v=6,m=fi.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(v=8,m=fi.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(v=10,m=fi.AZTEC_DATA_10):(v=12,m=fi.AZTEC_DATA_12);let C=this.ddata.getNbDatablocks(),I=c.length/v;if(I<C)throw new ce;let L=c.length%v,k=new Int32Array(I);for(let Ne=0;Ne<I;Ne++,L+=v)k[Ne]=Fn.readCode(c,L,v);try{new Hi(m).decode(k,I-C)}catch(Ne){throw new ce(Ne)}let j=(1<<v)-1,J=0;for(let Ne=0;Ne<C;Ne++){let Ye=k[Ne];if(Ye===0||Ye===j)throw new ce;(Ye===1||Ye===j-1)&&J++}let pe=new Array(C*v-J),Ie=0;for(let Ne=0;Ne<C;Ne++){let Ye=k[Ne];if(Ye===1||Ye===j-1)pe.fill(Ye>1,Ie,Ie+v-1),Ie+=v-1;else for(let at=v-1;at>=0;--at)pe[Ie++]=(Ye&1<<at)!==0}return pe}extractBits(c){let m=this.ddata.isCompact(),v=this.ddata.getNbLayers(),C=(m?11:14)+v*4,I=new Int32Array(C),L=new Array(this.totalBitsInLayer(v,m));if(m)for(let k=0;k<I.length;k++)I[k]=k;else{let k=C+1+2*G.truncDivision(G.truncDivision(C,2)-1,15),j=C/2,J=G.truncDivision(k,2);for(let pe=0;pe<j;pe++){let Ie=pe+G.truncDivision(pe,15);I[j-pe-1]=J-Ie-1,I[j+pe]=J+Ie+1}}for(let k=0,j=0;k<v;k++){let J=(v-k)*4+(m?9:12),pe=k*2,Ie=C-1-pe;for(let Ne=0;Ne<J;Ne++){let Ye=Ne*2;for(let at=0;at<2;at++)L[j+Ye+at]=c.get(I[pe+at],I[pe+Ne]),L[j+2*J+Ye+at]=c.get(I[pe+Ne],I[Ie-at]),L[j+4*J+Ye+at]=c.get(I[Ie-at],I[Ie-Ne]),L[j+6*J+Ye+at]=c.get(I[Ie-Ne],I[pe+at])}j+=J*8}return L}static readCode(c,m,v){let C=0;for(let I=m;I<m+v;I++)C<<=1,c[I]&&(C|=1);return C}static readByte(c,m){let v=c.length-m;return v>=8?Fn.readCode(c,m,8):Fn.readCode(c,m,v)<<8-v}static convertBoolArrayToByteArray(c){let m=new Uint8Array((c.length+7)/8);for(let v=0;v<m.length;v++)m[v]=Fn.readByte(c,8*v);return m}totalBitsInLayer(c,m){return((m?88:112)+16*c)*c}}Fn.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],Fn.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],Fn.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","	",`
`,"\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],Fn.PUNCT_TABLE=["","\r",`\r
`,". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],Fn.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class ti{constructor(){}static round(c){return c===NaN?0:c<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:c>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:c+(c<0?-.5:.5)|0}static distance(c,m,v,C){const I=c-v,L=m-C;return Math.sqrt(I*I+L*L)}static sum(c){let m=0;for(let v=0,C=c.length;v!==C;v++){const I=c[v];m+=I}return m}}class Ii{static floatToIntBits(c){return c}}Ii.MAX_VALUE=Number.MAX_SAFE_INTEGER;class wi{constructor(c,m){this.x=c,this.y=m}getX(){return this.x}getY(){return this.y}equals(c){if(c instanceof wi){const m=c;return this.x===m.x&&this.y===m.y}return!1}hashCode(){return 31*Ii.floatToIntBits(this.x)+Ii.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(c){const m=this.distance(c[0],c[1]),v=this.distance(c[1],c[2]),C=this.distance(c[0],c[2]);let I,L,k;if(v>=m&&v>=C?(L=c[0],I=c[1],k=c[2]):C>=v&&C>=m?(L=c[1],I=c[0],k=c[2]):(L=c[2],I=c[0],k=c[1]),this.crossProductZ(I,L,k)<0){const j=I;I=k,k=j}c[0]=I,c[1]=L,c[2]=k}static distance(c,m){return ti.distance(c.x,c.y,m.x,m.y)}static crossProductZ(c,m,v){const C=m.x,I=m.y;return(v.x-C)*(c.y-I)-(v.y-I)*(c.x-C)}}class on{constructor(c,m){this.bits=c,this.points=m}getBits(){return this.bits}getPoints(){return this.points}}class Do extends on{constructor(c,m,v,C,I){super(c,m),this.compact=v,this.nbDatablocks=C,this.nbLayers=I}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class so{constructor(c,m,v,C){this.image=c,this.height=c.getHeight(),this.width=c.getWidth(),m==null&&(m=so.INIT_SIZE),v==null&&(v=c.getWidth()/2|0),C==null&&(C=c.getHeight()/2|0);const I=m/2|0;if(this.leftInit=v-I,this.rightInit=v+I,this.upInit=C-I,this.downInit=C+I,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new Mt}detect(){let c=this.leftInit,m=this.rightInit,v=this.upInit,C=this.downInit,I=!1,L=!0,k=!1,j=!1,J=!1,pe=!1,Ie=!1;const Ne=this.width,Ye=this.height;for(;L;){L=!1;let at=!0;for(;(at||!j)&&m<Ne;)at=this.containsBlackPoint(v,C,m,!1),at?(m++,L=!0,j=!0):j||m++;if(m>=Ne){I=!0;break}let ut=!0;for(;(ut||!J)&&C<Ye;)ut=this.containsBlackPoint(c,m,C,!0),ut?(C++,L=!0,J=!0):J||C++;if(C>=Ye){I=!0;break}let Et=!0;for(;(Et||!pe)&&c>=0;)Et=this.containsBlackPoint(v,C,c,!1),Et?(c--,L=!0,pe=!0):pe||c--;if(c<0){I=!0;break}let Rt=!0;for(;(Rt||!Ie)&&v>=0;)Rt=this.containsBlackPoint(c,m,v,!0),Rt?(v--,L=!0,Ie=!0):Ie||v--;if(v<0){I=!0;break}L&&(k=!0)}if(!I&&k){const at=m-c;let ut=null;for(let gi=1;ut===null&&gi<at;gi++)ut=this.getBlackPointOnSegment(c,C-gi,c+gi,C);if(ut==null)throw new Mt;let Et=null;for(let gi=1;Et===null&&gi<at;gi++)Et=this.getBlackPointOnSegment(c,v+gi,c+gi,v);if(Et==null)throw new Mt;let Rt=null;for(let gi=1;Rt===null&&gi<at;gi++)Rt=this.getBlackPointOnSegment(m,v+gi,m-gi,v);if(Rt==null)throw new Mt;let mi=null;for(let gi=1;mi===null&&gi<at;gi++)mi=this.getBlackPointOnSegment(m,C-gi,m-gi,C);if(mi==null)throw new Mt;return this.centerEdges(mi,ut,Rt,Et)}else throw new Mt}getBlackPointOnSegment(c,m,v,C){const I=ti.round(ti.distance(c,m,v,C)),L=(v-c)/I,k=(C-m)/I,j=this.image;for(let J=0;J<I;J++){const pe=ti.round(c+J*L),Ie=ti.round(m+J*k);if(j.get(pe,Ie))return new wi(pe,Ie)}return null}centerEdges(c,m,v,C){const I=c.getX(),L=c.getY(),k=m.getX(),j=m.getY(),J=v.getX(),pe=v.getY(),Ie=C.getX(),Ne=C.getY(),Ye=so.CORR;return I<this.width/2?[new wi(Ie-Ye,Ne+Ye),new wi(k+Ye,j+Ye),new wi(J-Ye,pe-Ye),new wi(I+Ye,L-Ye)]:[new wi(Ie+Ye,Ne+Ye),new wi(k+Ye,j-Ye),new wi(J-Ye,pe+Ye),new wi(I-Ye,L-Ye)]}containsBlackPoint(c,m,v,C){const I=this.image;if(C){for(let L=c;L<=m;L++)if(I.get(L,v))return!0}else for(let L=c;L<=m;L++)if(I.get(v,L))return!0;return!1}}so.INIT_SIZE=10,so.CORR=1;class Go{static checkAndNudgePoints(c,m){const v=c.getWidth(),C=c.getHeight();let I=!0;for(let L=0;L<m.length&&I;L+=2){const k=Math.floor(m[L]),j=Math.floor(m[L+1]);if(k<-1||k>v||j<-1||j>C)throw new Mt;I=!1,k===-1?(m[L]=0,I=!0):k===v&&(m[L]=v-1,I=!0),j===-1?(m[L+1]=0,I=!0):j===C&&(m[L+1]=C-1,I=!0)}I=!0;for(let L=m.length-2;L>=0&&I;L-=2){const k=Math.floor(m[L]),j=Math.floor(m[L+1]);if(k<-1||k>v||j<-1||j>C)throw new Mt;I=!1,k===-1?(m[L]=0,I=!0):k===v&&(m[L]=v-1,I=!0),j===-1?(m[L+1]=0,I=!0):j===C&&(m[L+1]=C-1,I=!0)}}}class Pr{constructor(c,m,v,C,I,L,k,j,J){this.a11=c,this.a21=m,this.a31=v,this.a12=C,this.a22=I,this.a32=L,this.a13=k,this.a23=j,this.a33=J}static quadrilateralToQuadrilateral(c,m,v,C,I,L,k,j,J,pe,Ie,Ne,Ye,at,ut,Et){const Rt=Pr.quadrilateralToSquare(c,m,v,C,I,L,k,j);return Pr.squareToQuadrilateral(J,pe,Ie,Ne,Ye,at,ut,Et).times(Rt)}transformPoints(c){const m=c.length,v=this.a11,C=this.a12,I=this.a13,L=this.a21,k=this.a22,j=this.a23,J=this.a31,pe=this.a32,Ie=this.a33;for(let Ne=0;Ne<m;Ne+=2){const Ye=c[Ne],at=c[Ne+1],ut=I*Ye+j*at+Ie;c[Ne]=(v*Ye+L*at+J)/ut,c[Ne+1]=(C*Ye+k*at+pe)/ut}}transformPointsWithValues(c,m){const v=this.a11,C=this.a12,I=this.a13,L=this.a21,k=this.a22,j=this.a23,J=this.a31,pe=this.a32,Ie=this.a33,Ne=c.length;for(let Ye=0;Ye<Ne;Ye++){const at=c[Ye],ut=m[Ye],Et=I*at+j*ut+Ie;c[Ye]=(v*at+L*ut+J)/Et,m[Ye]=(C*at+k*ut+pe)/Et}}static squareToQuadrilateral(c,m,v,C,I,L,k,j){const J=c-v+I-k,pe=m-C+L-j;if(J===0&&pe===0)return new Pr(v-c,I-v,c,C-m,L-C,m,0,0,1);{const Ie=v-I,Ne=k-I,Ye=C-L,at=j-L,ut=Ie*at-Ne*Ye,Et=(J*at-Ne*pe)/ut,Rt=(Ie*pe-J*Ye)/ut;return new Pr(v-c+Et*v,k-c+Rt*k,c,C-m+Et*C,j-m+Rt*j,m,Et,Rt,1)}}static quadrilateralToSquare(c,m,v,C,I,L,k,j){return Pr.squareToQuadrilateral(c,m,v,C,I,L,k,j).buildAdjoint()}buildAdjoint(){return new Pr(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(c){return new Pr(this.a11*c.a11+this.a21*c.a12+this.a31*c.a13,this.a11*c.a21+this.a21*c.a22+this.a31*c.a23,this.a11*c.a31+this.a21*c.a32+this.a31*c.a33,this.a12*c.a11+this.a22*c.a12+this.a32*c.a13,this.a12*c.a21+this.a22*c.a22+this.a32*c.a23,this.a12*c.a31+this.a22*c.a32+this.a32*c.a33,this.a13*c.a11+this.a23*c.a12+this.a33*c.a13,this.a13*c.a21+this.a23*c.a22+this.a33*c.a23,this.a13*c.a31+this.a23*c.a32+this.a33*c.a33)}}class Ro extends Go{sampleGrid(c,m,v,C,I,L,k,j,J,pe,Ie,Ne,Ye,at,ut,Et,Rt,mi,gi){const ai=Pr.quadrilateralToQuadrilateral(C,I,L,k,j,J,pe,Ie,Ne,Ye,at,ut,Et,Rt,mi,gi);return this.sampleGridWithTransform(c,m,v,ai)}sampleGridWithTransform(c,m,v,C){if(m<=0||v<=0)throw new Mt;const I=new Ui(m,v),L=new Float32Array(2*m);for(let k=0;k<v;k++){const j=L.length,J=k+.5;for(let pe=0;pe<j;pe+=2)L[pe]=pe/2+.5,L[pe+1]=J;C.transformPoints(L),Go.checkAndNudgePoints(c,L);try{for(let pe=0;pe<j;pe+=2)c.get(Math.floor(L[pe]),Math.floor(L[pe+1]))&&I.set(pe/2,k)}catch{throw new Mt}}return I}}class ao{static setGridSampler(c){ao.gridSampler=c}static getInstance(){return ao.gridSampler}}ao.gridSampler=new Ro;class yr{constructor(c,m){this.x=c,this.y=m}toResultPoint(){return new wi(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class ko{constructor(c){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=c}detect(){return this.detectMirror(!1)}detectMirror(c){let m=this.getMatrixCenter(),v=this.getBullsEyeCorners(m);if(c){let L=v[0];v[0]=v[2],v[2]=L}this.extractParameters(v);let C=this.sampleGrid(this.image,v[this.shift%4],v[(this.shift+1)%4],v[(this.shift+2)%4],v[(this.shift+3)%4]),I=this.getMatrixCornerPoints(v);return new Do(C,I,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(c){if(!this.isValidPoint(c[0])||!this.isValidPoint(c[1])||!this.isValidPoint(c[2])||!this.isValidPoint(c[3]))throw new Mt;let m=2*this.nbCenterLayers,v=new Int32Array([this.sampleLine(c[0],c[1],m),this.sampleLine(c[1],c[2],m),this.sampleLine(c[2],c[3],m),this.sampleLine(c[3],c[0],m)]);this.shift=this.getRotation(v,m);let C=0;for(let L=0;L<4;L++){let k=v[(this.shift+L)%4];this.compact?(C<<=7,C+=k>>1&127):(C<<=10,C+=(k>>2&992)+(k>>1&31))}let I=this.getCorrectedParameterData(C,this.compact);this.compact?(this.nbLayers=(I>>6)+1,this.nbDataBlocks=(I&63)+1):(this.nbLayers=(I>>11)+1,this.nbDataBlocks=(I&2047)+1)}getRotation(c,m){let v=0;c.forEach((C,I,L)=>{let k=(C>>m-2<<1)+(C&1);v=(v<<3)+k}),v=((v&1)<<11)+(v>>1);for(let C=0;C<4;C++)if(G.bitCount(v^this.EXPECTED_CORNER_BITS[C])<=2)return C;throw new Mt}getCorrectedParameterData(c,m){let v,C;m?(v=7,C=2):(v=10,C=4);let I=v-C,L=new Int32Array(v);for(let j=v-1;j>=0;--j)L[j]=c&15,c>>=4;try{new Hi(fi.AZTEC_PARAM).decode(L,I)}catch{throw new Mt}let k=0;for(let j=0;j<C;j++)k=(k<<4)+L[j];return k}getBullsEyeCorners(c){let m=c,v=c,C=c,I=c,L=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let Ie=this.getFirstDifferent(m,L,1,-1),Ne=this.getFirstDifferent(v,L,1,1),Ye=this.getFirstDifferent(C,L,-1,1),at=this.getFirstDifferent(I,L,-1,-1);if(this.nbCenterLayers>2){let ut=this.distancePoint(at,Ie)*this.nbCenterLayers/(this.distancePoint(I,m)*(this.nbCenterLayers+2));if(ut<.75||ut>1.25||!this.isWhiteOrBlackRectangle(Ie,Ne,Ye,at))break}m=Ie,v=Ne,C=Ye,I=at,L=!L}if(this.nbCenterLayers!==5&&this.nbCenterLayers!==7)throw new Mt;this.compact=this.nbCenterLayers===5;let k=new wi(m.getX()+.5,m.getY()-.5),j=new wi(v.getX()+.5,v.getY()+.5),J=new wi(C.getX()-.5,C.getY()+.5),pe=new wi(I.getX()-.5,I.getY()-.5);return this.expandSquare([k,j,J,pe],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let c,m,v,C;try{let k=new so(this.image).detect();c=k[0],m=k[1],v=k[2],C=k[3]}catch{let j=this.image.getWidth()/2,J=this.image.getHeight()/2;c=this.getFirstDifferent(new yr(j+7,J-7),!1,1,-1).toResultPoint(),m=this.getFirstDifferent(new yr(j+7,J+7),!1,1,1).toResultPoint(),v=this.getFirstDifferent(new yr(j-7,J+7),!1,-1,1).toResultPoint(),C=this.getFirstDifferent(new yr(j-7,J-7),!1,-1,-1).toResultPoint()}let I=ti.round((c.getX()+C.getX()+m.getX()+v.getX())/4),L=ti.round((c.getY()+C.getY()+m.getY()+v.getY())/4);try{let k=new so(this.image,15,I,L).detect();c=k[0],m=k[1],v=k[2],C=k[3]}catch{c=this.getFirstDifferent(new yr(I+7,L-7),!1,1,-1).toResultPoint(),m=this.getFirstDifferent(new yr(I+7,L+7),!1,1,1).toResultPoint(),v=this.getFirstDifferent(new yr(I-7,L+7),!1,-1,1).toResultPoint(),C=this.getFirstDifferent(new yr(I-7,L-7),!1,-1,-1).toResultPoint()}return I=ti.round((c.getX()+C.getX()+m.getX()+v.getX())/4),L=ti.round((c.getY()+C.getY()+m.getY()+v.getY())/4),new yr(I,L)}getMatrixCornerPoints(c){return this.expandSquare(c,2*this.nbCenterLayers,this.getDimension())}sampleGrid(c,m,v,C,I){let L=ao.getInstance(),k=this.getDimension(),j=k/2-this.nbCenterLayers,J=k/2+this.nbCenterLayers;return L.sampleGrid(c,k,k,j,j,J,j,J,J,j,J,m.getX(),m.getY(),v.getX(),v.getY(),C.getX(),C.getY(),I.getX(),I.getY())}sampleLine(c,m,v){let C=0,I=this.distanceResultPoint(c,m),L=I/v,k=c.getX(),j=c.getY(),J=L*(m.getX()-c.getX())/I,pe=L*(m.getY()-c.getY())/I;for(let Ie=0;Ie<v;Ie++)this.image.get(ti.round(k+Ie*J),ti.round(j+Ie*pe))&&(C|=1<<v-Ie-1);return C}isWhiteOrBlackRectangle(c,m,v,C){let I=3;c=new yr(c.getX()-I,c.getY()+I),m=new yr(m.getX()-I,m.getY()-I),v=new yr(v.getX()+I,v.getY()-I),C=new yr(C.getX()+I,C.getY()+I);let L=this.getColor(C,c);if(L===0)return!1;let k=this.getColor(c,m);return k!==L||(k=this.getColor(m,v),k!==L)?!1:(k=this.getColor(v,C),k===L)}getColor(c,m){let v=this.distancePoint(c,m),C=(m.getX()-c.getX())/v,I=(m.getY()-c.getY())/v,L=0,k=c.getX(),j=c.getY(),J=this.image.get(c.getX(),c.getY()),pe=Math.ceil(v);for(let Ne=0;Ne<pe;Ne++)k+=C,j+=I,this.image.get(ti.round(k),ti.round(j))!==J&&L++;let Ie=L/v;return Ie>.1&&Ie<.9?0:Ie<=.1===J?1:-1}getFirstDifferent(c,m,v,C){let I=c.getX()+v,L=c.getY()+C;for(;this.isValid(I,L)&&this.image.get(I,L)===m;)I+=v,L+=C;for(I-=v,L-=C;this.isValid(I,L)&&this.image.get(I,L)===m;)I+=v;for(I-=v;this.isValid(I,L)&&this.image.get(I,L)===m;)L+=C;return L-=C,new yr(I,L)}expandSquare(c,m,v){let C=v/(2*m),I=c[0].getX()-c[2].getX(),L=c[0].getY()-c[2].getY(),k=(c[0].getX()+c[2].getX())/2,j=(c[0].getY()+c[2].getY())/2,J=new wi(k+C*I,j+C*L),pe=new wi(k-C*I,j-C*L);I=c[1].getX()-c[3].getX(),L=c[1].getY()-c[3].getY(),k=(c[1].getX()+c[3].getX())/2,j=(c[1].getY()+c[3].getY())/2;let Ie=new wi(k+C*I,j+C*L),Ne=new wi(k-C*I,j-C*L);return[J,Ie,pe,Ne]}isValid(c,m){return c>=0&&c<this.image.getWidth()&&m>0&&m<this.image.getHeight()}isValidPoint(c){let m=ti.round(c.getX()),v=ti.round(c.getY());return this.isValid(m,v)}distancePoint(c,m){return ti.distance(c.getX(),c.getY(),m.getX(),m.getY())}distanceResultPoint(c,m){return ti.distance(c.getX(),c.getY(),m.getX(),m.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(G.truncDivision(this.nbLayers-4,8)+1)+15}}class Bo{decode(c,m=null){let v=null,C=new ko(c.getBlackMatrix()),I=null,L=null;try{let pe=C.detectMirror(!1);I=pe.getPoints(),this.reportFoundResultPoints(m,I),L=new Fn().decode(pe)}catch(pe){v=pe}if(L==null)try{let pe=C.detectMirror(!0);I=pe.getPoints(),this.reportFoundResultPoints(m,I),L=new Fn().decode(pe)}catch(pe){throw v??pe}let k=new fn(L.getText(),L.getRawBytes(),L.getNumBits(),I,Ri.AZTEC,K.currentTimeMillis()),j=L.getByteSegments();j!=null&&k.putMetadata(si.BYTE_SEGMENTS,j);let J=L.getECLevel();return J!=null&&k.putMetadata(si.ERROR_CORRECTION_LEVEL,J),k}reportFoundResultPoints(c,m){if(c!=null){let v=c.get(fe.NEED_RESULT_POINT_CALLBACK);v!=null&&m.forEach((C,I,L)=>{v.foundPossibleResultPoint(C)})}}reset(){}}class Wo extends ir{constructor(c=500){super(new Bo,c)}}class er{decode(c,m){try{return this.doDecode(c,m)}catch{if(m&&m.get(fe.TRY_HARDER)===!0&&c.isRotateSupported()){const I=c.rotateCounterClockwise(),L=this.doDecode(I,m),k=L.getResultMetadata();let j=270;k!==null&&k.get(si.ORIENTATION)===!0&&(j=j+k.get(si.ORIENTATION)%360),L.putMetadata(si.ORIENTATION,j);const J=L.getResultPoints();if(J!==null){const pe=I.getHeight();for(let Ie=0;Ie<J.length;Ie++)J[Ie]=new wi(pe-J[Ie].getY()-1,J[Ie].getX())}return L}else throw new Mt}}reset(){}doDecode(c,m){const v=c.getWidth(),C=c.getHeight();let I=new Q(v);const L=m&&m.get(fe.TRY_HARDER)===!0,k=Math.max(1,C>>(L?8:5));let j;L?j=C:j=15;const J=Math.trunc(C/2);for(let pe=0;pe<j;pe++){const Ie=Math.trunc((pe+1)/2),Ne=(pe&1)===0,Ye=J+k*(Ne?Ie:-Ie);if(Ye<0||Ye>=C)break;try{I=c.getBlackRow(Ye,I)}catch{continue}for(let at=0;at<2;at++){if(at===1&&(I.reverse(),m&&m.get(fe.NEED_RESULT_POINT_CALLBACK)===!0)){const ut=new Map;m.forEach((Et,Rt)=>ut.set(Rt,Et)),ut.delete(fe.NEED_RESULT_POINT_CALLBACK),m=ut}try{const ut=this.decodeRow(Ye,I,m);if(at===1){ut.putMetadata(si.ORIENTATION,180);const Et=ut.getResultPoints();Et!==null&&(Et[0]=new wi(v-Et[0].getX()-1,Et[0].getY()),Et[1]=new wi(v-Et[1].getX()-1,Et[1].getY()))}return ut}catch{}}}throw new Mt}static recordPattern(c,m,v){const C=v.length;for(let J=0;J<C;J++)v[J]=0;const I=c.getSize();if(m>=I)throw new Mt;let L=!c.get(m),k=0,j=m;for(;j<I;){if(c.get(j)!==L)v[k]++;else{if(++k===C)break;v[k]=1,L=!L}j++}if(!(k===C||k===C-1&&j===I))throw new Mt}static recordPatternInReverse(c,m,v){let C=v.length,I=c.get(m);for(;m>0&&C>=0;)c.get(--m)!==I&&(C--,I=!I);if(C>=0)throw new Mt;er.recordPattern(c,m+1,v)}static patternMatchVariance(c,m,v){const C=c.length;let I=0,L=0;for(let J=0;J<C;J++)I+=c[J],L+=m[J];if(I<L)return Number.POSITIVE_INFINITY;const k=I/L;v*=k;let j=0;for(let J=0;J<C;J++){const pe=c[J],Ie=m[J]*k,Ne=pe>Ie?pe-Ie:Ie-pe;if(Ne>v)return Number.POSITIVE_INFINITY;j+=Ne}return j/I}}class pi extends er{static findStartPattern(c){const m=c.getSize(),v=c.getNextSet(0);let C=0,I=Int32Array.from([0,0,0,0,0,0]),L=v,k=!1;const j=6;for(let J=v;J<m;J++)if(c.get(J)!==k)I[C]++;else{if(C===j-1){let pe=pi.MAX_AVG_VARIANCE,Ie=-1;for(let Ne=pi.CODE_START_A;Ne<=pi.CODE_START_C;Ne++){const Ye=er.patternMatchVariance(I,pi.CODE_PATTERNS[Ne],pi.MAX_INDIVIDUAL_VARIANCE);Ye<pe&&(pe=Ye,Ie=Ne)}if(Ie>=0&&c.isRange(Math.max(0,L-(J-L)/2),L,!1))return Int32Array.from([L,J,Ie]);L+=I[0]+I[1],I=I.slice(2,I.length-1),I[C-1]=0,I[C]=0,C--}else C++;I[C]=1,k=!k}throw new Mt}static decodeCode(c,m,v){er.recordPattern(c,v,m);let C=pi.MAX_AVG_VARIANCE,I=-1;for(let L=0;L<pi.CODE_PATTERNS.length;L++){const k=pi.CODE_PATTERNS[L],j=this.patternMatchVariance(m,k,pi.MAX_INDIVIDUAL_VARIANCE);j<C&&(C=j,I=L)}if(I>=0)return I;throw new Mt}decodeRow(c,m,v){const C=v&&v.get(fe.ASSUME_GS1)===!0,I=pi.findStartPattern(m),L=I[2];let k=0;const j=new Uint8Array(20);j[k++]=L;let J;switch(L){case pi.CODE_START_A:J=pi.CODE_CODE_A;break;case pi.CODE_START_B:J=pi.CODE_CODE_B;break;case pi.CODE_START_C:J=pi.CODE_CODE_C;break;default:throw new ce}let pe=!1,Ie=!1,Ne="",Ye=I[0],at=I[1];const ut=Int32Array.from([0,0,0,0,0,0]);let Et=0,Rt=0,mi=L,gi=0,ai=!0,Xn=!1,wn=!1;for(;!pe;){const ia=Ie;switch(Ie=!1,Et=Rt,Rt=pi.decodeCode(m,ut,at),j[k++]=Rt,Rt!==pi.CODE_STOP&&(ai=!0),Rt!==pi.CODE_STOP&&(gi++,mi+=gi*Rt),Ye=at,at+=ut.reduce((Tl,vs)=>Tl+vs,0),Rt){case pi.CODE_START_A:case pi.CODE_START_B:case pi.CODE_START_C:throw new ce}switch(J){case pi.CODE_CODE_A:if(Rt<64)wn===Xn?Ne+=String.fromCharCode(" ".charCodeAt(0)+Rt):Ne+=String.fromCharCode(" ".charCodeAt(0)+Rt+128),wn=!1;else if(Rt<96)wn===Xn?Ne+=String.fromCharCode(Rt-64):Ne+=String.fromCharCode(Rt+64),wn=!1;else switch(Rt!==pi.CODE_STOP&&(ai=!1),Rt){case pi.CODE_FNC_1:C&&(Ne.length===0?Ne+="]C1":Ne+=String.fromCharCode(29));break;case pi.CODE_FNC_2:case pi.CODE_FNC_3:break;case pi.CODE_FNC_4_A:!Xn&&wn?(Xn=!0,wn=!1):Xn&&wn?(Xn=!1,wn=!1):wn=!0;break;case pi.CODE_SHIFT:Ie=!0,J=pi.CODE_CODE_B;break;case pi.CODE_CODE_B:J=pi.CODE_CODE_B;break;case pi.CODE_CODE_C:J=pi.CODE_CODE_C;break;case pi.CODE_STOP:pe=!0;break}break;case pi.CODE_CODE_B:if(Rt<96)wn===Xn?Ne+=String.fromCharCode(" ".charCodeAt(0)+Rt):Ne+=String.fromCharCode(" ".charCodeAt(0)+Rt+128),wn=!1;else switch(Rt!==pi.CODE_STOP&&(ai=!1),Rt){case pi.CODE_FNC_1:C&&(Ne.length===0?Ne+="]C1":Ne+=String.fromCharCode(29));break;case pi.CODE_FNC_2:case pi.CODE_FNC_3:break;case pi.CODE_FNC_4_B:!Xn&&wn?(Xn=!0,wn=!1):Xn&&wn?(Xn=!1,wn=!1):wn=!0;break;case pi.CODE_SHIFT:Ie=!0,J=pi.CODE_CODE_A;break;case pi.CODE_CODE_A:J=pi.CODE_CODE_A;break;case pi.CODE_CODE_C:J=pi.CODE_CODE_C;break;case pi.CODE_STOP:pe=!0;break}break;case pi.CODE_CODE_C:if(Rt<100)Rt<10&&(Ne+="0"),Ne+=Rt;else switch(Rt!==pi.CODE_STOP&&(ai=!1),Rt){case pi.CODE_FNC_1:C&&(Ne.length===0?Ne+="]C1":Ne+=String.fromCharCode(29));break;case pi.CODE_CODE_A:J=pi.CODE_CODE_A;break;case pi.CODE_CODE_B:J=pi.CODE_CODE_B;break;case pi.CODE_STOP:pe=!0;break}break}ia&&(J=J===pi.CODE_CODE_A?pi.CODE_CODE_B:pi.CODE_CODE_A)}const yo=at-Ye;if(at=m.getNextUnset(at),!m.isRange(at,Math.min(m.getSize(),at+(at-Ye)/2),!1))throw new Mt;if(mi-=gi*Et,mi%103!==Et)throw new Ce;const Ss=Ne.length;if(Ss===0)throw new Mt;Ss>0&&ai&&(J===pi.CODE_CODE_C?Ne=Ne.substring(0,Ss-2):Ne=Ne.substring(0,Ss-1));const Yr=(I[1]+I[0])/2,fr=Ye+yo/2,Uo=j.length,ys=new Uint8Array(Uo);for(let ia=0;ia<Uo;ia++)ys[ia]=j[ia];const ta=[new wi(Yr,c),new wi(fr,c)];return new fn(Ne,ys,0,ta,Ri.CODE_128,new Date().getTime())}}pi.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],pi.MAX_AVG_VARIANCE=.25,pi.MAX_INDIVIDUAL_VARIANCE=.7,pi.CODE_SHIFT=98,pi.CODE_CODE_C=99,pi.CODE_CODE_B=100,pi.CODE_CODE_A=101,pi.CODE_FNC_1=102,pi.CODE_FNC_2=97,pi.CODE_FNC_3=96,pi.CODE_FNC_4_A=101,pi.CODE_FNC_4_B=100,pi.CODE_START_A=103,pi.CODE_START_B=104,pi.CODE_START_C=105,pi.CODE_STOP=106;class xi extends er{constructor(c=!1,m=!1){super(),this.usingCheckDigit=c,this.extendedMode=m,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(c,m,v){let C=this.counters;C.fill(0),this.decodeRowResult="";let I=xi.findAsteriskPattern(m,C),L=m.getNextSet(I[1]),k=m.getSize(),j,J;do{xi.recordPattern(m,L,C);let ut=xi.toNarrowWidePattern(C);if(ut<0)throw new Mt;j=xi.patternToChar(ut),this.decodeRowResult+=j,J=L;for(let Et of C)L+=Et;L=m.getNextSet(L)}while(j!=="*");this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let pe=0;for(let ut of C)pe+=ut;let Ie=L-J-pe;if(L!==k&&Ie*2<pe)throw new Mt;if(this.usingCheckDigit){let ut=this.decodeRowResult.length-1,Et=0;for(let Rt=0;Rt<ut;Rt++)Et+=xi.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(Rt));if(this.decodeRowResult.charAt(ut)!==xi.ALPHABET_STRING.charAt(Et%43))throw new Ce;this.decodeRowResult=this.decodeRowResult.substring(0,ut)}if(this.decodeRowResult.length===0)throw new Mt;let Ne;this.extendedMode?Ne=xi.decodeExtended(this.decodeRowResult):Ne=this.decodeRowResult;let Ye=(I[1]+I[0])/2,at=J+pe/2;return new fn(Ne,null,0,[new wi(Ye,c),new wi(at,c)],Ri.CODE_39,new Date().getTime())}static findAsteriskPattern(c,m){let v=c.getSize(),C=c.getNextSet(0),I=0,L=C,k=!1,j=m.length;for(let J=C;J<v;J++)if(c.get(J)!==k)m[I]++;else{if(I===j-1){if(this.toNarrowWidePattern(m)===xi.ASTERISK_ENCODING&&c.isRange(Math.max(0,L-Math.floor((J-L)/2)),L,!1))return[L,J];L+=m[0]+m[1],m.copyWithin(0,2,2+I-1),m[I-1]=0,m[I]=0,I--}else I++;m[I]=1,k=!k}throw new Mt}static toNarrowWidePattern(c){let m=c.length,v=0,C;do{let I=2147483647;for(let j of c)j<I&&j>v&&(I=j);v=I,C=0;let L=0,k=0;for(let j=0;j<m;j++){let J=c[j];J>v&&(k|=1<<m-1-j,C++,L+=J)}if(C===3){for(let j=0;j<m&&C>0;j++){let J=c[j];if(J>v&&(C--,J*2>=L))return-1}return k}}while(C>3);return-1}static patternToChar(c){for(let m=0;m<xi.CHARACTER_ENCODINGS.length;m++)if(xi.CHARACTER_ENCODINGS[m]===c)return xi.ALPHABET_STRING.charAt(m);if(c===xi.ASTERISK_ENCODING)return"*";throw new Mt}static decodeExtended(c){let m=c.length,v="";for(let C=0;C<m;C++){let I=c.charAt(C);if(I==="+"||I==="$"||I==="%"||I==="/"){let L=c.charAt(C+1),k="\0";switch(I){case"+":if(L>="A"&&L<="Z")k=String.fromCharCode(L.charCodeAt(0)+32);else throw new ce;break;case"$":if(L>="A"&&L<="Z")k=String.fromCharCode(L.charCodeAt(0)-64);else throw new ce;break;case"%":if(L>="A"&&L<="E")k=String.fromCharCode(L.charCodeAt(0)-38);else if(L>="F"&&L<="J")k=String.fromCharCode(L.charCodeAt(0)-11);else if(L>="K"&&L<="O")k=String.fromCharCode(L.charCodeAt(0)+16);else if(L>="P"&&L<="T")k=String.fromCharCode(L.charCodeAt(0)+43);else if(L==="U")k="\0";else if(L==="V")k="@";else if(L==="W")k="`";else if(L==="X"||L==="Y"||L==="Z")k="";else throw new ce;break;case"/":if(L>="A"&&L<="O")k=String.fromCharCode(L.charCodeAt(0)-32);else if(L==="Z")k=":";else throw new ce;break}v+=k,C++}else v+=I}return v}}xi.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",xi.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],xi.ASTERISK_ENCODING=148;class Gn extends er{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(c,m,v){let C=this.decodeStart(m),I=this.decodeEnd(m),L=new Ot;Gn.decodeMiddle(m,C[1],I[0],L);let k=L.toString(),j=null;v!=null&&(j=v.get(fe.ALLOWED_LENGTHS)),j==null&&(j=Gn.DEFAULT_ALLOWED_LENGTHS);let J=k.length,pe=!1,Ie=0;for(let at of j){if(J===at){pe=!0;break}at>Ie&&(Ie=at)}if(!pe&&J>Ie&&(pe=!0),!pe)throw new ce;const Ne=[new wi(C[1],c),new wi(I[0],c)];return new fn(k,null,0,Ne,Ri.ITF,new Date().getTime())}static decodeMiddle(c,m,v,C){let I=new Int32Array(10),L=new Int32Array(5),k=new Int32Array(5);for(I.fill(0),L.fill(0),k.fill(0);m<v;){er.recordPattern(c,m,I);for(let J=0;J<5;J++){let pe=2*J;L[J]=I[pe],k[J]=I[pe+1]}let j=Gn.decodeDigit(L);C.append(j.toString()),j=this.decodeDigit(k),C.append(j.toString()),I.forEach(function(J){m+=J})}}decodeStart(c){let m=Gn.skipWhiteSpace(c),v=Gn.findGuardPattern(c,m,Gn.START_PATTERN);return this.narrowLineWidth=(v[1]-v[0])/4,this.validateQuietZone(c,v[0]),v}validateQuietZone(c,m){let v=this.narrowLineWidth*10;v=v<m?v:m;for(let C=m-1;v>0&&C>=0&&!c.get(C);C--)v--;if(v!==0)throw new Mt}static skipWhiteSpace(c){const m=c.getSize(),v=c.getNextSet(0);if(v===m)throw new Mt;return v}decodeEnd(c){c.reverse();try{let m=Gn.skipWhiteSpace(c),v;try{v=Gn.findGuardPattern(c,m,Gn.END_PATTERN_REVERSED[0])}catch(I){I instanceof Mt&&(v=Gn.findGuardPattern(c,m,Gn.END_PATTERN_REVERSED[1]))}this.validateQuietZone(c,v[0]);let C=v[0];return v[0]=c.getSize()-v[1],v[1]=c.getSize()-C,v}finally{c.reverse()}}static findGuardPattern(c,m,v){let C=v.length,I=new Int32Array(C),L=c.getSize(),k=!1,j=0,J=m;I.fill(0);for(let pe=m;pe<L;pe++)if(c.get(pe)!==k)I[j]++;else{if(j===C-1){if(er.patternMatchVariance(I,v,Gn.MAX_INDIVIDUAL_VARIANCE)<Gn.MAX_AVG_VARIANCE)return[J,pe];J+=I[0]+I[1],K.arraycopy(I,2,I,0,j-1),I[j-1]=0,I[j]=0,j--}else j++;I[j]=1,k=!k}throw new Mt}static decodeDigit(c){let m=Gn.MAX_AVG_VARIANCE,v=-1,C=Gn.PATTERNS.length;for(let I=0;I<C;I++){let L=Gn.PATTERNS[I],k=er.patternMatchVariance(c,L,Gn.MAX_INDIVIDUAL_VARIANCE);k<m?(m=k,v=I):k===m&&(v=-1)}if(v>=0)return v%10;throw new Mt}}Gn.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],Gn.MAX_AVG_VARIANCE=.38,Gn.MAX_INDIVIDUAL_VARIANCE=.5,Gn.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],Gn.START_PATTERN=Int32Array.from([1,1,1,1]),Gn.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class an extends er{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(c){let m=!1,v,C=0,I=Int32Array.from([0,0,0]);for(;!m;){I=Int32Array.from([0,0,0]),v=an.findGuardPattern(c,C,!1,this.START_END_PATTERN,I);let L=v[0];C=v[1];let k=L-(C-L);k>=0&&(m=c.isRange(k,L,!1))}return v}static checkChecksum(c){return an.checkStandardUPCEANChecksum(c)}static checkStandardUPCEANChecksum(c){let m=c.length;if(m===0)return!1;let v=parseInt(c.charAt(m-1),10);return an.getStandardUPCEANChecksum(c.substring(0,m-1))===v}static getStandardUPCEANChecksum(c){let m=c.length,v=0;for(let C=m-1;C>=0;C-=2){let I=c.charAt(C).charCodeAt(0)-"0".charCodeAt(0);if(I<0||I>9)throw new ce;v+=I}v*=3;for(let C=m-2;C>=0;C-=2){let I=c.charAt(C).charCodeAt(0)-"0".charCodeAt(0);if(I<0||I>9)throw new ce;v+=I}return(1e3-v)%10}static decodeEnd(c,m){return an.findGuardPattern(c,m,!1,an.START_END_PATTERN,new Int32Array(an.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(c,m,v,C){return this.findGuardPattern(c,m,v,C,new Int32Array(C.length))}static findGuardPattern(c,m,v,C,I){let L=c.getSize();m=v?c.getNextUnset(m):c.getNextSet(m);let k=0,j=m,J=C.length,pe=v;for(let Ie=m;Ie<L;Ie++)if(c.get(Ie)!==pe)I[k]++;else{if(k===J-1){if(er.patternMatchVariance(I,C,an.MAX_INDIVIDUAL_VARIANCE)<an.MAX_AVG_VARIANCE)return Int32Array.from([j,Ie]);j+=I[0]+I[1];let Ne=I.slice(2,I.length-1);for(let Ye=0;Ye<k-1;Ye++)I[Ye]=Ne[Ye];I[k-1]=0,I[k]=0,k--}else k++;I[k]=1,pe=!pe}throw new Mt}static decodeDigit(c,m,v,C){this.recordPattern(c,v,m);let I=this.MAX_AVG_VARIANCE,L=-1,k=C.length;for(let j=0;j<k;j++){let J=C[j],pe=er.patternMatchVariance(m,J,an.MAX_INDIVIDUAL_VARIANCE);pe<I&&(I=pe,L=j)}if(L>=0)return L;throw new Mt}}an.MAX_AVG_VARIANCE=.48,an.MAX_INDIVIDUAL_VARIANCE=.7,an.START_END_PATTERN=Int32Array.from([1,1,1]),an.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),an.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),an.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class Jo{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(c,m,v){let C=this.decodeRowStringBuffer,I=this.decodeMiddle(m,v,C),L=C.toString(),k=Jo.parseExtensionString(L),j=[new wi((v[0]+v[1])/2,c),new wi(I,c)],J=new fn(L,null,0,j,Ri.UPC_EAN_EXTENSION,new Date().getTime());return k!=null&&J.putAllMetadata(k),J}decodeMiddle(c,m,v){let C=this.decodeMiddleCounters;C[0]=0,C[1]=0,C[2]=0,C[3]=0;let I=c.getSize(),L=m[1],k=0;for(let J=0;J<5&&L<I;J++){let pe=an.decodeDigit(c,C,L,an.L_AND_G_PATTERNS);v+=String.fromCharCode("0".charCodeAt(0)+pe%10);for(let Ie of C)L+=Ie;pe>=10&&(k|=1<<4-J),J!==4&&(L=c.getNextSet(L),L=c.getNextUnset(L))}if(v.length!==5)throw new Mt;let j=this.determineCheckDigit(k);if(Jo.extensionChecksum(v.toString())!==j)throw new Mt;return L}static extensionChecksum(c){let m=c.length,v=0;for(let C=m-2;C>=0;C-=2)v+=c.charAt(C).charCodeAt(0)-"0".charCodeAt(0);v*=3;for(let C=m-1;C>=0;C-=2)v+=c.charAt(C).charCodeAt(0)-"0".charCodeAt(0);return v*=3,v%10}determineCheckDigit(c){for(let m=0;m<10;m++)if(c===this.CHECK_DIGIT_ENCODINGS[m])return m;throw new Mt}static parseExtensionString(c){if(c.length!==5)return null;let m=Jo.parseExtension5String(c);return m==null?null:new Map([[si.SUGGESTED_PRICE,m]])}static parseExtension5String(c){let m;switch(c.charAt(0)){case"0":m="£";break;case"5":m="$";break;case"9":switch(c){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}m="";break;default:m="";break}let v=parseInt(c.substring(1)),C=(v/100).toString(),I=v%100,L=I<10?"0"+I:I.toString();return m+C+"."+L}}class Ds{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(c,m,v){let C=this.decodeRowStringBuffer,I=this.decodeMiddle(m,v,C),L=C.toString(),k=Ds.parseExtensionString(L),j=[new wi((v[0]+v[1])/2,c),new wi(I,c)],J=new fn(L,null,0,j,Ri.UPC_EAN_EXTENSION,new Date().getTime());return k!=null&&J.putAllMetadata(k),J}decodeMiddle(c,m,v){let C=this.decodeMiddleCounters;C[0]=0,C[1]=0,C[2]=0,C[3]=0;let I=c.getSize(),L=m[1],k=0;for(let j=0;j<2&&L<I;j++){let J=an.decodeDigit(c,C,L,an.L_AND_G_PATTERNS);v+=String.fromCharCode("0".charCodeAt(0)+J%10);for(let pe of C)L+=pe;J>=10&&(k|=1<<1-j),j!==1&&(L=c.getNextSet(L),L=c.getNextUnset(L))}if(v.length!==2)throw new Mt;if(parseInt(v.toString())%4!==k)throw new Mt;return L}static parseExtensionString(c){return c.length!==2?null:new Map([[si.ISSUE_NUMBER,parseInt(c)]])}}class $o{static decodeRow(c,m,v){let C=an.findGuardPattern(m,v,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return new Jo().decodeRow(c,m,C)}catch{return new Ds().decodeRow(c,m,C)}}}$o.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class gn extends an{constructor(){super(),this.decodeRowStringBuffer="",gn.L_AND_G_PATTERNS=gn.L_PATTERNS.map(c=>Int32Array.from(c));for(let c=10;c<20;c++){let m=gn.L_PATTERNS[c-10],v=new Int32Array(m.length);for(let C=0;C<m.length;C++)v[C]=m[m.length-C-1];gn.L_AND_G_PATTERNS[c]=v}}decodeRow(c,m,v){let C=gn.findStartGuardPattern(m),I=v==null?null:v.get(fe.NEED_RESULT_POINT_CALLBACK);if(I!=null){const ai=new wi((C[0]+C[1])/2,c);I.foundPossibleResultPoint(ai)}let L=this.decodeMiddle(m,C,this.decodeRowStringBuffer),k=L.rowOffset,j=L.resultString;if(I!=null){const ai=new wi(k,c);I.foundPossibleResultPoint(ai)}let J=this.decodeEnd(m,k);if(I!=null){const ai=new wi((J[0]+J[1])/2,c);I.foundPossibleResultPoint(ai)}let pe=J[1],Ie=pe+(pe-J[0]);if(Ie>=m.getSize()||!m.isRange(pe,Ie,!1))throw new Mt;let Ne=j.toString();if(Ne.length<8)throw new ce;if(!gn.checkChecksum(Ne))throw new Ce;let Ye=(C[1]+C[0])/2,at=(J[1]+J[0])/2,ut=this.getBarcodeFormat(),Et=[new wi(Ye,c),new wi(at,c)],Rt=new fn(Ne,null,0,Et,ut,new Date().getTime()),mi=0;try{let ai=$o.decodeRow(c,m,J[1]);Rt.putMetadata(si.UPC_EAN_EXTENSION,ai.getText()),Rt.putAllMetadata(ai.getResultMetadata()),Rt.addResultPoints(ai.getResultPoints()),mi=ai.getText().length}catch{}let gi=v==null?null:v.get(fe.ALLOWED_EAN_EXTENSIONS);if(gi!=null){let ai=!1;for(let Xn in gi)if(mi.toString()===Xn){ai=!0;break}if(!ai)throw new Mt}return Rt}decodeEnd(c,m){return gn.findGuardPattern(c,m,!1,gn.START_END_PATTERN,new Int32Array(gn.START_END_PATTERN.length).fill(0))}static checkChecksum(c){return gn.checkStandardUPCEANChecksum(c)}static checkStandardUPCEANChecksum(c){let m=c.length;if(m===0)return!1;let v=parseInt(c.charAt(m-1),10);return gn.getStandardUPCEANChecksum(c.substring(0,m-1))===v}static getStandardUPCEANChecksum(c){let m=c.length,v=0;for(let C=m-1;C>=0;C-=2){let I=c.charAt(C).charCodeAt(0)-"0".charCodeAt(0);if(I<0||I>9)throw new ce;v+=I}v*=3;for(let C=m-2;C>=0;C-=2){let I=c.charAt(C).charCodeAt(0)-"0".charCodeAt(0);if(I<0||I>9)throw new ce;v+=I}return(1e3-v)%10}}class No extends gn{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(c,m,v){let C=this.decodeMiddleCounters;C[0]=0,C[1]=0,C[2]=0,C[3]=0;let I=c.getSize(),L=m[1],k=0;for(let J=0;J<6&&L<I;J++){let pe=gn.decodeDigit(c,C,L,gn.L_AND_G_PATTERNS);v+=String.fromCharCode("0".charCodeAt(0)+pe%10);for(let Ie of C)L+=Ie;pe>=10&&(k|=1<<5-J)}v=No.determineFirstDigit(v,k),L=gn.findGuardPattern(c,L,!0,gn.MIDDLE_PATTERN,new Int32Array(gn.MIDDLE_PATTERN.length).fill(0))[1];for(let J=0;J<6&&L<I;J++){let pe=gn.decodeDigit(c,C,L,gn.L_PATTERNS);v+=String.fromCharCode("0".charCodeAt(0)+pe);for(let Ie of C)L+=Ie}return{rowOffset:L,resultString:v}}getBarcodeFormat(){return Ri.EAN_13}static determineFirstDigit(c,m){for(let v=0;v<10;v++)if(m===this.FIRST_DIGIT_ENCODINGS[v])return c=String.fromCharCode("0".charCodeAt(0)+v)+c,c;throw new Mt}}No.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class Es extends gn{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(c,m,v){const C=this.decodeMiddleCounters;C[0]=0,C[1]=0,C[2]=0,C[3]=0;let I=c.getSize(),L=m[1];for(let j=0;j<4&&L<I;j++){let J=gn.decodeDigit(c,C,L,gn.L_PATTERNS);v+=String.fromCharCode("0".charCodeAt(0)+J);for(let pe of C)L+=pe}L=gn.findGuardPattern(c,L,!0,gn.MIDDLE_PATTERN,new Int32Array(gn.MIDDLE_PATTERN.length).fill(0))[1];for(let j=0;j<4&&L<I;j++){let J=gn.decodeDigit(c,C,L,gn.L_PATTERNS);v+=String.fromCharCode("0".charCodeAt(0)+J);for(let pe of C)L+=pe}return{rowOffset:L,resultString:v}}getBarcodeFormat(){return Ri.EAN_8}}class Ur extends gn{constructor(){super(...arguments),this.ean13Reader=new No}getBarcodeFormat(){return Ri.UPC_A}decode(c,m){return this.maybeReturnResult(this.ean13Reader.decode(c))}decodeRow(c,m,v){return this.maybeReturnResult(this.ean13Reader.decodeRow(c,m,v))}decodeMiddle(c,m,v){return this.ean13Reader.decodeMiddle(c,m,v)}maybeReturnResult(c){let m=c.getText();if(m.charAt(0)==="0"){let v=new fn(m.substring(1),null,null,c.getResultPoints(),Ri.UPC_A);return c.getResultMetadata()!=null&&v.putAllMetadata(c.getResultMetadata()),v}else throw new Mt}reset(){this.ean13Reader.reset()}}class Tr extends gn{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(c,m,v){const C=this.decodeMiddleCounters.map(J=>J);C[0]=0,C[1]=0,C[2]=0,C[3]=0;const I=c.getSize();let L=m[1],k=0;for(let J=0;J<6&&L<I;J++){const pe=Tr.decodeDigit(c,C,L,Tr.L_AND_G_PATTERNS);v+=String.fromCharCode("0".charCodeAt(0)+pe%10);for(let Ie of C)L+=Ie;pe>=10&&(k|=1<<5-J)}let j=Tr.determineNumSysAndCheckDigit(v,k);return{rowOffset:L,resultString:j}}decodeEnd(c,m){return Tr.findGuardPatternWithoutCounters(c,m,!0,Tr.MIDDLE_END_PATTERN)}checkChecksum(c){return gn.checkChecksum(Tr.convertUPCEtoUPCA(c))}static determineNumSysAndCheckDigit(c,m){for(let v=0;v<=1;v++)for(let C=0;C<10;C++)if(m===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[v][C]){let I=String.fromCharCode("0".charCodeAt(0)+v),L=String.fromCharCode("0".charCodeAt(0)+C);return I+c+L}throw Mt.getNotFoundInstance()}getBarcodeFormat(){return Ri.UPC_E}static convertUPCEtoUPCA(c){const m=c.slice(1,7).split("").map(I=>I.charCodeAt(0)),v=new Ot;v.append(c.charAt(0));let C=m[5];switch(C){case 0:case 1:case 2:v.appendChars(m,0,2),v.append(C),v.append("0000"),v.appendChars(m,2,3);break;case 3:v.appendChars(m,0,3),v.append("00000"),v.appendChars(m,3,2);break;case 4:v.appendChars(m,0,4),v.append("00000"),v.append(m[4]);break;default:v.appendChars(m,0,5),v.append("0000"),v.append(C);break}return c.length>=8&&v.append(c.charAt(7)),v.toString()}}Tr.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Tr.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class Rs extends er{constructor(c){super();let m=c==null?null:c.get(fe.POSSIBLE_FORMATS),v=[];g(m)?(v.push(new No),v.push(new Ur),v.push(new Es),v.push(new Tr)):(m.indexOf(Ri.EAN_13)>-1&&v.push(new No),m.indexOf(Ri.UPC_A)>-1&&v.push(new Ur),m.indexOf(Ri.EAN_8)>-1&&v.push(new Es),m.indexOf(Ri.UPC_E)>-1&&v.push(new Tr)),this.readers=v}decodeRow(c,m,v){for(let C of this.readers)try{const I=C.decodeRow(c,m,v),L=I.getBarcodeFormat()===Ri.EAN_13&&I.getText().charAt(0)==="0",k=v==null?null:v.get(fe.POSSIBLE_FORMATS),j=k==null||k.includes(Ri.UPC_A);if(L&&j){const J=I.getRawBytes(),pe=new fn(I.getText().substring(1),J,J?J.length:null,I.getResultPoints(),Ri.UPC_A);return pe.putAllMetadata(I.getResultMetadata()),pe}return I}catch{}throw new Mt}reset(){for(let c of this.readers)c.reset()}}class tr extends er{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(c,m){for(let v=0;v<m.length;v++)if(er.patternMatchVariance(c,m[v],tr.MAX_INDIVIDUAL_VARIANCE)<tr.MAX_AVG_VARIANCE)return v;throw new Mt}static count(c){return ti.sum(new Int32Array(c))}static increment(c,m){let v=0,C=m[0];for(let I=1;I<c.length;I++)m[I]>C&&(C=m[I],v=I);c[v]++}static decrement(c,m){let v=0,C=m[0];for(let I=1;I<c.length;I++)m[I]<C&&(C=m[I],v=I);c[v]--}static isFinderPattern(c){let m=c[0]+c[1],v=m+c[2]+c[3],C=m/v;if(C>=tr.MIN_FINDER_PATTERN_RATIO&&C<=tr.MAX_FINDER_PATTERN_RATIO){let I=Number.MAX_SAFE_INTEGER,L=Number.MIN_SAFE_INTEGER;for(let k of c)k>L&&(L=k),k<I&&(I=k);return L<10*I}return!1}}tr.MAX_AVG_VARIANCE=.2,tr.MAX_INDIVIDUAL_VARIANCE=.45,tr.MIN_FINDER_PATTERN_RATIO=9.5/12,tr.MAX_FINDER_PATTERN_RATIO=12.5/14;class Fo{constructor(c,m){this.value=c,this.checksumPortion=m}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(c){if(!(c instanceof Fo))return!1;const m=c;return this.value===m.value&&this.checksumPortion===m.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class Eo{constructor(c,m,v,C,I){this.value=c,this.startEnd=m,this.value=c,this.startEnd=m,this.resultPoints=new Array,this.resultPoints.push(new wi(v,I)),this.resultPoints.push(new wi(C,I))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(c){if(!(c instanceof Eo))return!1;const m=c;return this.value===m.value}hashCode(){return this.value}}class uo{constructor(){}static getRSSvalue(c,m,v){let C=0;for(let j of c)C+=j;let I=0,L=0,k=c.length;for(let j=0;j<k-1;j++){let J;for(J=1,L|=1<<j;J<c[j];J++,L&=~(1<<j)){let pe=uo.combins(C-J-1,k-j-2);if(v&&L===0&&C-J-(k-j-1)>=k-j-1&&(pe-=uo.combins(C-J-(k-j),k-j-2)),k-j-1>1){let Ie=0;for(let Ne=C-J-(k-j-2);Ne>m;Ne--)Ie+=uo.combins(C-J-Ne-1,k-j-3);pe-=Ie*(k-1-j)}else C-J>m&&pe--;I+=pe}C-=J}return I}static combins(c,m){let v,C;c-m>m?(C=m,v=c-m):(C=c-m,v=m);let I=1,L=1;for(let k=c;k>v;k--)I*=k,L<=C&&(I/=L,L++);for(;L<=C;)I/=L,L++;return I}}class yn{static buildBitArray(c){let m=c.length*2-1;c[c.length-1].getRightChar()==null&&(m-=1);let v=12*m,C=new Q(v),I=0,k=c[0].getRightChar().getValue();for(let j=11;j>=0;--j)k&1<<j&&C.set(I),I++;for(let j=1;j<c.length;++j){let J=c[j],pe=J.getLeftChar().getValue();for(let Ie=11;Ie>=0;--Ie)pe&1<<Ie&&C.set(I),I++;if(J.getRightChar()!=null){let Ie=J.getRightChar().getValue();for(let Ne=11;Ne>=0;--Ne)Ie&1<<Ne&&C.set(I),I++}}return C}}class Kn{constructor(c,m){m?this.decodedInformation=null:(this.finished=c,this.decodedInformation=m)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class To{constructor(c){this.newPosition=c}getNewPosition(){return this.newPosition}}class Cr extends To{constructor(c,m){super(c),this.value=m}getValue(){return this.value}isFNC1(){return this.value===Cr.FNC1}}Cr.FNC1="$";class hr extends To{constructor(c,m,v){super(c),v?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=m}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class nr extends To{constructor(c,m,v){if(super(c),m<0||m>10||v<0||v>10)throw new ce;this.firstDigit=m,this.secondDigit=v}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return this.firstDigit*10+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===nr.FNC1}isSecondDigitFNC1(){return this.secondDigit===nr.FNC1}isAnyFNC1(){return this.firstDigit===nr.FNC1||this.secondDigit===nr.FNC1}}nr.FNC1=10;class Ke{constructor(){}static parseFieldsInGeneralPurpose(c){if(!c)return null;if(c.length<2)throw new Mt;let m=c.substring(0,2);for(let I of Ke.TWO_DIGIT_DATA_LENGTH)if(I[0]===m)return I[1]===Ke.VARIABLE_LENGTH?Ke.processVariableAI(2,I[2],c):Ke.processFixedAI(2,I[1],c);if(c.length<3)throw new Mt;let v=c.substring(0,3);for(let I of Ke.THREE_DIGIT_DATA_LENGTH)if(I[0]===v)return I[1]===Ke.VARIABLE_LENGTH?Ke.processVariableAI(3,I[2],c):Ke.processFixedAI(3,I[1],c);for(let I of Ke.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(I[0]===v)return I[1]===Ke.VARIABLE_LENGTH?Ke.processVariableAI(4,I[2],c):Ke.processFixedAI(4,I[1],c);if(c.length<4)throw new Mt;let C=c.substring(0,4);for(let I of Ke.FOUR_DIGIT_DATA_LENGTH)if(I[0]===C)return I[1]===Ke.VARIABLE_LENGTH?Ke.processVariableAI(4,I[2],c):Ke.processFixedAI(4,I[1],c);throw new Mt}static processFixedAI(c,m,v){if(v.length<c)throw new Mt;let C=v.substring(0,c);if(v.length<c+m)throw new Mt;let I=v.substring(c,c+m),L=v.substring(c+m),k="("+C+")"+I,j=Ke.parseFieldsInGeneralPurpose(L);return j==null?k:k+j}static processVariableAI(c,m,v){let C=v.substring(0,c),I;v.length<c+m?I=v.length:I=c+m;let L=v.substring(c,I),k=v.substring(I),j="("+C+")"+L,J=Ke.parseFieldsInGeneralPurpose(k);return J==null?j:j+J}}Ke.VARIABLE_LENGTH=[],Ke.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",Ke.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",Ke.VARIABLE_LENGTH,20],["22",Ke.VARIABLE_LENGTH,29],["30",Ke.VARIABLE_LENGTH,8],["37",Ke.VARIABLE_LENGTH,8],["90",Ke.VARIABLE_LENGTH,30],["91",Ke.VARIABLE_LENGTH,30],["92",Ke.VARIABLE_LENGTH,30],["93",Ke.VARIABLE_LENGTH,30],["94",Ke.VARIABLE_LENGTH,30],["95",Ke.VARIABLE_LENGTH,30],["96",Ke.VARIABLE_LENGTH,30],["97",Ke.VARIABLE_LENGTH,3],["98",Ke.VARIABLE_LENGTH,30],["99",Ke.VARIABLE_LENGTH,30]],Ke.THREE_DIGIT_DATA_LENGTH=[["240",Ke.VARIABLE_LENGTH,30],["241",Ke.VARIABLE_LENGTH,30],["242",Ke.VARIABLE_LENGTH,6],["250",Ke.VARIABLE_LENGTH,30],["251",Ke.VARIABLE_LENGTH,30],["253",Ke.VARIABLE_LENGTH,17],["254",Ke.VARIABLE_LENGTH,20],["400",Ke.VARIABLE_LENGTH,30],["401",Ke.VARIABLE_LENGTH,30],["402",17],["403",Ke.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",Ke.VARIABLE_LENGTH,20],["421",Ke.VARIABLE_LENGTH,15],["422",3],["423",Ke.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],Ke.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",Ke.VARIABLE_LENGTH,15],["391",Ke.VARIABLE_LENGTH,18],["392",Ke.VARIABLE_LENGTH,15],["393",Ke.VARIABLE_LENGTH,18],["703",Ke.VARIABLE_LENGTH,30]],Ke.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",Ke.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",Ke.VARIABLE_LENGTH,20],["8003",Ke.VARIABLE_LENGTH,30],["8004",Ke.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",Ke.VARIABLE_LENGTH,30],["8008",Ke.VARIABLE_LENGTH,12],["8018",18],["8020",Ke.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",Ke.VARIABLE_LENGTH,70],["8200",Ke.VARIABLE_LENGTH,70]];class ve{constructor(c){this.buffer=new Ot,this.information=c}decodeAllCodes(c,m){let v=m,C=null;do{let I=this.decodeGeneralPurposeField(v,C),L=Ke.parseFieldsInGeneralPurpose(I.getNewString());if(L!=null&&c.append(L),I.isRemaining()?C=""+I.getRemainingValue():C=null,v===I.getNewPosition())break;v=I.getNewPosition()}while(!0);return c.toString()}isStillNumeric(c){if(c+7>this.information.getSize())return c+4<=this.information.getSize();for(let m=c;m<c+3;++m)if(this.information.get(m))return!0;return this.information.get(c+3)}decodeNumeric(c){if(c+7>this.information.getSize()){let I=this.extractNumericValueFromBitArray(c,4);return I===0?new nr(this.information.getSize(),nr.FNC1,nr.FNC1):new nr(this.information.getSize(),I-1,nr.FNC1)}let m=this.extractNumericValueFromBitArray(c,7),v=(m-8)/11,C=(m-8)%11;return new nr(c+7,v,C)}extractNumericValueFromBitArray(c,m){return ve.extractNumericValueFromBitArray(this.information,c,m)}static extractNumericValueFromBitArray(c,m,v){let C=0;for(let I=0;I<v;++I)c.get(m+I)&&(C|=1<<v-I-1);return C}decodeGeneralPurposeField(c,m){this.buffer.setLengthToZero(),m!=null&&this.buffer.append(m),this.current.setPosition(c);let v=this.parseBlocks();return v!=null&&v.isRemaining()?new hr(this.current.getPosition(),this.buffer.toString(),v.getRemainingValue()):new hr(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let c,m;do{let v=this.current.getPosition();if(this.current.isAlpha()?(m=this.parseAlphaBlock(),c=m.isFinished()):this.current.isIsoIec646()?(m=this.parseIsoIec646Block(),c=m.isFinished()):(m=this.parseNumericBlock(),c=m.isFinished()),!(v!==this.current.getPosition())&&!c)break}while(!c);return m.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let c=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(c.getNewPosition()),c.isFirstDigitFNC1()){let m;return c.isSecondDigitFNC1()?m=new hr(this.current.getPosition(),this.buffer.toString()):m=new hr(this.current.getPosition(),this.buffer.toString(),c.getSecondDigit()),new Kn(!0,m)}if(this.buffer.append(c.getFirstDigit()),c.isSecondDigitFNC1()){let m=new hr(this.current.getPosition(),this.buffer.toString());return new Kn(!0,m)}this.buffer.append(c.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new Kn(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let c=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(c.getNewPosition()),c.isFNC1()){let m=new hr(this.current.getPosition(),this.buffer.toString());return new Kn(!0,m)}this.buffer.append(c.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new Kn(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let c=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(c.getNewPosition()),c.isFNC1()){let m=new hr(this.current.getPosition(),this.buffer.toString());return new Kn(!0,m)}this.buffer.append(c.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new Kn(!1)}isStillIsoIec646(c){if(c+5>this.information.getSize())return!1;let m=this.extractNumericValueFromBitArray(c,5);if(m>=5&&m<16)return!0;if(c+7>this.information.getSize())return!1;let v=this.extractNumericValueFromBitArray(c,7);if(v>=64&&v<116)return!0;if(c+8>this.information.getSize())return!1;let C=this.extractNumericValueFromBitArray(c,8);return C>=232&&C<253}decodeIsoIec646(c){let m=this.extractNumericValueFromBitArray(c,5);if(m===15)return new Cr(c+5,Cr.FNC1);if(m>=5&&m<15)return new Cr(c+5,"0"+(m-5));let v=this.extractNumericValueFromBitArray(c,7);if(v>=64&&v<90)return new Cr(c+7,""+(v+1));if(v>=90&&v<116)return new Cr(c+7,""+(v+7));let C=this.extractNumericValueFromBitArray(c,8),I;switch(C){case 232:I="!";break;case 233:I='"';break;case 234:I="%";break;case 235:I="&";break;case 236:I="'";break;case 237:I="(";break;case 238:I=")";break;case 239:I="*";break;case 240:I="+";break;case 241:I=",";break;case 242:I="-";break;case 243:I=".";break;case 244:I="/";break;case 245:I=":";break;case 246:I=";";break;case 247:I="<";break;case 248:I="=";break;case 249:I=">";break;case 250:I="?";break;case 251:I="_";break;case 252:I=" ";break;default:throw new ce}return new Cr(c+8,I)}isStillAlpha(c){if(c+5>this.information.getSize())return!1;let m=this.extractNumericValueFromBitArray(c,5);if(m>=5&&m<16)return!0;if(c+6>this.information.getSize())return!1;let v=this.extractNumericValueFromBitArray(c,6);return v>=16&&v<63}decodeAlphanumeric(c){let m=this.extractNumericValueFromBitArray(c,5);if(m===15)return new Cr(c+5,Cr.FNC1);if(m>=5&&m<15)return new Cr(c+5,"0"+(m-5));let v=this.extractNumericValueFromBitArray(c,6);if(v>=32&&v<58)return new Cr(c+6,""+(v+33));let C;switch(v){case 58:C="*";break;case 59:C=",";break;case 60:C="-";break;case 61:C=".";break;case 62:C="/";break;default:throw new Or("Decoding invalid alphanumeric value: "+v)}return new Cr(c+6,C)}isAlphaTo646ToAlphaLatch(c){if(c+1>this.information.getSize())return!1;for(let m=0;m<5&&m+c<this.information.getSize();++m)if(m===2){if(!this.information.get(c+2))return!1}else if(this.information.get(c+m))return!1;return!0}isAlphaOr646ToNumericLatch(c){if(c+3>this.information.getSize())return!1;for(let m=c;m<c+3;++m)if(this.information.get(m))return!1;return!0}isNumericToAlphaNumericLatch(c){if(c+1>this.information.getSize())return!1;for(let m=0;m<4&&m+c<this.information.getSize();++m)if(this.information.get(c+m))return!1;return!0}}class re{constructor(c){this.information=c,this.generalDecoder=new ve(c)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class ae extends re{constructor(c){super(c)}encodeCompressedGtin(c,m){c.append("(01)");let v=c.length();c.append("9"),this.encodeCompressedGtinWithoutAI(c,m,v)}encodeCompressedGtinWithoutAI(c,m,v){for(let C=0;C<4;++C){let I=this.getGeneralDecoder().extractNumericValueFromBitArray(m+10*C,10);I/100===0&&c.append("0"),I/10===0&&c.append("0"),c.append(I)}ae.appendCheckDigit(c,v)}static appendCheckDigit(c,m){let v=0;for(let C=0;C<13;C++){let I=c.charAt(C+m).charCodeAt(0)-"0".charCodeAt(0);v+=C&1?I:3*I}v=10-v%10,v===10&&(v=0),c.append(v)}}ae.GTIN_SIZE=40;class Ee extends ae{constructor(c){super(c)}parseInformation(){let c=new Ot;c.append("(01)");let m=c.length(),v=this.getGeneralDecoder().extractNumericValueFromBitArray(Ee.HEADER_SIZE,4);return c.append(v),this.encodeCompressedGtinWithoutAI(c,Ee.HEADER_SIZE+4,m),this.getGeneralDecoder().decodeAllCodes(c,Ee.HEADER_SIZE+44)}}Ee.HEADER_SIZE=1+1+2;class Oe extends re{constructor(c){super(c)}parseInformation(){let c=new Ot;return this.getGeneralDecoder().decodeAllCodes(c,Oe.HEADER_SIZE)}}Oe.HEADER_SIZE=2+1+2;class Re extends ae{constructor(c){super(c)}encodeCompressedWeight(c,m,v){let C=this.getGeneralDecoder().extractNumericValueFromBitArray(m,v);this.addWeightCode(c,C);let I=this.checkWeight(C),L=1e5;for(let k=0;k<5;++k)I/L===0&&c.append("0"),L/=10;c.append(I)}}class je extends Re{constructor(c){super(c)}parseInformation(){if(this.getInformation().getSize()!=je.HEADER_SIZE+Re.GTIN_SIZE+je.WEIGHT_SIZE)throw new Mt;let c=new Ot;return this.encodeCompressedGtin(c,je.HEADER_SIZE),this.encodeCompressedWeight(c,je.HEADER_SIZE+Re.GTIN_SIZE,je.WEIGHT_SIZE),c.toString()}}je.HEADER_SIZE=4+1,je.WEIGHT_SIZE=15;class Je extends je{constructor(c){super(c)}addWeightCode(c,m){c.append("(3103)")}checkWeight(c){return c}}class Ge extends je{constructor(c){super(c)}addWeightCode(c,m){m<1e4?c.append("(3202)"):c.append("(3203)")}checkWeight(c){return c<1e4?c:c-1e4}}class rt extends ae{constructor(c){super(c)}parseInformation(){if(this.getInformation().getSize()<rt.HEADER_SIZE+ae.GTIN_SIZE)throw new Mt;let c=new Ot;this.encodeCompressedGtin(c,rt.HEADER_SIZE);let m=this.getGeneralDecoder().extractNumericValueFromBitArray(rt.HEADER_SIZE+ae.GTIN_SIZE,rt.LAST_DIGIT_SIZE);c.append("(392"),c.append(m),c.append(")");let v=this.getGeneralDecoder().decodeGeneralPurposeField(rt.HEADER_SIZE+ae.GTIN_SIZE+rt.LAST_DIGIT_SIZE,null);return c.append(v.getNewString()),c.toString()}}rt.HEADER_SIZE=5+1+2,rt.LAST_DIGIT_SIZE=2;class ht extends ae{constructor(c){super(c)}parseInformation(){if(this.getInformation().getSize()<ht.HEADER_SIZE+ae.GTIN_SIZE)throw new Mt;let c=new Ot;this.encodeCompressedGtin(c,ht.HEADER_SIZE);let m=this.getGeneralDecoder().extractNumericValueFromBitArray(ht.HEADER_SIZE+ae.GTIN_SIZE,ht.LAST_DIGIT_SIZE);c.append("(393"),c.append(m),c.append(")");let v=this.getGeneralDecoder().extractNumericValueFromBitArray(ht.HEADER_SIZE+ae.GTIN_SIZE+ht.LAST_DIGIT_SIZE,ht.FIRST_THREE_DIGITS_SIZE);v/100==0&&c.append("0"),v/10==0&&c.append("0"),c.append(v);let C=this.getGeneralDecoder().decodeGeneralPurposeField(ht.HEADER_SIZE+ae.GTIN_SIZE+ht.LAST_DIGIT_SIZE+ht.FIRST_THREE_DIGITS_SIZE,null);return c.append(C.getNewString()),c.toString()}}ht.HEADER_SIZE=5+1+2,ht.LAST_DIGIT_SIZE=2,ht.FIRST_THREE_DIGITS_SIZE=10;class pt extends Re{constructor(c,m,v){super(c),this.dateCode=v,this.firstAIdigits=m}parseInformation(){if(this.getInformation().getSize()!=pt.HEADER_SIZE+pt.GTIN_SIZE+pt.WEIGHT_SIZE+pt.DATE_SIZE)throw new Mt;let c=new Ot;return this.encodeCompressedGtin(c,pt.HEADER_SIZE),this.encodeCompressedWeight(c,pt.HEADER_SIZE+pt.GTIN_SIZE,pt.WEIGHT_SIZE),this.encodeCompressedDate(c,pt.HEADER_SIZE+pt.GTIN_SIZE+pt.WEIGHT_SIZE),c.toString()}encodeCompressedDate(c,m){let v=this.getGeneralDecoder().extractNumericValueFromBitArray(m,pt.DATE_SIZE);if(v==38400)return;c.append("("),c.append(this.dateCode),c.append(")");let C=v%32;v/=32;let I=v%12+1;v/=12;let L=v;L/10==0&&c.append("0"),c.append(L),I/10==0&&c.append("0"),c.append(I),C/10==0&&c.append("0"),c.append(C)}addWeightCode(c,m){c.append("("),c.append(this.firstAIdigits),c.append(m/1e5),c.append(")")}checkWeight(c){return c%1e5}}pt.HEADER_SIZE=7+1,pt.WEIGHT_SIZE=20,pt.DATE_SIZE=16;function $t(Te){try{if(Te.get(1))return new Ee(Te);if(!Te.get(2))return new Oe(Te);switch(ve.extractNumericValueFromBitArray(Te,1,4)){case 4:return new Je(Te);case 5:return new Ge(Te)}switch(ve.extractNumericValueFromBitArray(Te,1,5)){case 12:return new rt(Te);case 13:return new ht(Te)}switch(ve.extractNumericValueFromBitArray(Te,1,7)){case 56:return new pt(Te,"310","11");case 57:return new pt(Te,"320","11");case 58:return new pt(Te,"310","13");case 59:return new pt(Te,"320","13");case 60:return new pt(Te,"310","15");case 61:return new pt(Te,"320","15");case 62:return new pt(Te,"310","17");case 63:return new pt(Te,"320","17")}}catch(c){throw console.log(c),new Or("unknown decoder: "+Te)}}class oi{constructor(c,m,v,C){this.leftchar=c,this.rightchar=m,this.finderpattern=v,this.maybeLast=C}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return this.rightchar==null}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(this.finderpattern==null?"null":this.finderpattern.getValue())+" ]"}static equals(c,m){return c instanceof oi?oi.equalsOrNull(c.leftchar,m.leftchar)&&oi.equalsOrNull(c.rightchar,m.rightchar)&&oi.equalsOrNull(c.finderpattern,m.finderpattern):!1}static equalsOrNull(c,m){return c===null?m===null:oi.equals(c,m)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class bi{constructor(c,m,v){this.pairs=c,this.rowNumber=m,this.wasReversed=v}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(c){return this.checkEqualitity(this,c)}toString(){return"{ "+this.pairs+" }"}equals(c,m){return c instanceof bi?this.checkEqualitity(c,m)&&c.wasReversed===m.wasReversed:!1}checkEqualitity(c,m){if(!c||!m)return;let v;return c.forEach((C,I)=>{m.forEach(L=>{C.getLeftChar().getValue()===L.getLeftChar().getValue()&&C.getRightChar().getValue()===L.getRightChar().getValue()&&C.getFinderPatter().getValue()===L.getFinderPatter().getValue()&&(v=!0)})}),v}}class mt extends tr{constructor(c){super(...arguments),this.pairs=new Array(mt.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=c===!0}decodeRow(c,m,v){this.pairs.length=0,this.startFromEven=!1;try{return mt.constructResult(this.decodeRow2pairs(c,m))}catch(C){this.verbose&&console.log(C)}return this.pairs.length=0,this.startFromEven=!0,mt.constructResult(this.decodeRow2pairs(c,m))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(c,m){let v=!1;for(;!v;)try{this.pairs.push(this.retrieveNextPair(m,this.pairs,c))}catch(I){if(I instanceof Mt){if(!this.pairs.length)throw new Mt;v=!0}}if(this.checkChecksum())return this.pairs;let C;if(this.rows.length?C=!0:C=!1,this.storeRow(c,!1),C){let I=this.checkRowsBoolean(!1);if(I!=null||(I=this.checkRowsBoolean(!0),I!=null))return I}throw new Mt}checkRowsBoolean(c){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,c&&(this.rows=this.rows.reverse());let m=null;try{m=this.checkRows(new Array,0)}catch(v){this.verbose&&console.log(v)}return c&&(this.rows=this.rows.reverse()),m}checkRows(c,m){for(let v=m;v<this.rows.length;v++){let C=this.rows[v];this.pairs.length=0;for(let L of c)this.pairs.push(L.getPairs());if(this.pairs.push(C.getPairs()),!mt.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let I=new Array(c);I.push(C);try{return this.checkRows(I,v+1)}catch(L){this.verbose&&console.log(L)}}throw new Mt}static isValidSequence(c){for(let m of mt.FINDER_PATTERN_SEQUENCES){if(c.length>m.length)continue;let v=!0;for(let C=0;C<c.length;C++)if(c[C].getFinderPattern().getValue()!=m[C]){v=!1;break}if(v)return!0}return!1}storeRow(c,m){let v=0,C=!1,I=!1;for(;v<this.rows.length;){let L=this.rows[v];if(L.getRowNumber()>c){I=L.isEquivalent(this.pairs);break}C=L.isEquivalent(this.pairs),v++}I||C||mt.isPartialRow(this.pairs,this.rows)||(this.rows.push(v,new bi(this.pairs,c,m)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(c,m){for(let v of m)if(v.getPairs().length!==c.length){for(let C of v.getPairs())for(let I of c)if(oi.equals(C,I))break}}static isPartialRow(c,m){for(let v of m){let C=!0;for(let I of c){let L=!1;for(let k of v.getPairs())if(I.equals(k)){L=!0;break}if(!L){C=!1;break}}if(C)return!0}return!1}getRows(){return this.rows}static constructResult(c){let m=yn.buildBitArray(c),C=$t(m).parseInformation(),I=c[0].getFinderPattern().getResultPoints(),L=c[c.length-1].getFinderPattern().getResultPoints(),k=[I[0],I[1],L[0],L[1]];return new fn(C,null,null,k,Ri.RSS_EXPANDED,null)}checkChecksum(){let c=this.pairs.get(0),m=c.getLeftChar(),v=c.getRightChar();if(v==null)return!1;let C=v.getChecksumPortion(),I=2;for(let k=1;k<this.pairs.size();++k){let j=this.pairs.get(k);C+=j.getLeftChar().getChecksumPortion(),I++;let J=j.getRightChar();J!=null&&(C+=J.getChecksumPortion(),I++)}return C%=211,211*(I-4)+C==m.getValue()}static getNextSecondBar(c,m){let v;return c.get(m)?(v=c.getNextUnset(m),v=c.getNextSet(v)):(v=c.getNextSet(m),v=c.getNextUnset(v)),v}retrieveNextPair(c,m,v){let C=m.length%2==0;this.startFromEven&&(C=!C);let I,L=!0,k=-1;do this.findNextPair(c,m,k),I=this.parseFoundFinderPattern(c,v,C),I==null?k=mt.getNextSecondBar(c,this.startEnd[0]):L=!1;while(L);let j=this.decodeDataCharacter(c,I,C,!0);if(!this.isEmptyPair(m)&&m[m.length-1].mustBeLast())throw new Mt;let J;try{J=this.decodeDataCharacter(c,I,C,!1)}catch(pe){J=null,this.verbose&&console.log(pe)}return new oi(j,J,I,!0)}isEmptyPair(c){return c.length===0}findNextPair(c,m,v){let C=this.getDecodeFinderCounters();C[0]=0,C[1]=0,C[2]=0,C[3]=0;let I=c.getSize(),L;v>=0?L=v:this.isEmptyPair(m)?L=0:L=m[m.length-1].getFinderPattern().getStartEnd()[1];let k=m.length%2!=0;this.startFromEven&&(k=!k);let j=!1;for(;L<I&&(j=!c.get(L),!!j);)L++;let J=0,pe=L;for(let Ie=L;Ie<I;Ie++)if(c.get(Ie)!=j)C[J]++;else{if(J==3){if(k&&mt.reverseCounters(C),mt.isFinderPattern(C)){this.startEnd[0]=pe,this.startEnd[1]=Ie;return}k&&mt.reverseCounters(C),pe+=C[0]+C[1],C[0]=C[2],C[1]=C[3],C[2]=0,C[3]=0,J--}else J++;C[J]=1,j=!j}throw new Mt}static reverseCounters(c){let m=c.length;for(let v=0;v<m/2;++v){let C=c[v];c[v]=c[m-v-1],c[m-v-1]=C}}parseFoundFinderPattern(c,m,v){let C,I,L;if(v){let J=this.startEnd[0]-1;for(;J>=0&&!c.get(J);)J--;J++,C=this.startEnd[0]-J,I=J,L=this.startEnd[1]}else I=this.startEnd[0],L=c.getNextUnset(this.startEnd[1]+1),C=L-this.startEnd[1];let k=this.getDecodeFinderCounters();K.arraycopy(k,0,k,1,k.length-1),k[0]=C;let j;try{j=this.parseFinderValue(k,mt.FINDER_PATTERNS)}catch{return null}return new Eo(j,[I,L],I,L,m)}decodeDataCharacter(c,m,v,C){let I=this.getDataCharacterCounters();for(let fr=0;fr<I.length;fr++)I[fr]=0;if(C)mt.recordPatternInReverse(c,m.getStartEnd()[0],I);else{mt.recordPattern(c,m.getStartEnd()[1],I);for(let fr=0,Uo=I.length-1;fr<Uo;fr++,Uo--){let ys=I[fr];I[fr]=I[Uo],I[Uo]=ys}}let L=17,k=ti.sum(new Int32Array(I))/L,j=(m.getStartEnd()[1]-m.getStartEnd()[0])/15;if(Math.abs(k-j)/j>.3)throw new Mt;let J=this.getOddCounts(),pe=this.getEvenCounts(),Ie=this.getOddRoundingErrors(),Ne=this.getEvenRoundingErrors();for(let fr=0;fr<I.length;fr++){let Uo=1*I[fr]/k,ys=Uo+.5;if(ys<1){if(Uo<.3)throw new Mt;ys=1}else if(ys>8){if(Uo>8.7)throw new Mt;ys=8}let ta=fr/2;fr&1?(pe[ta]=ys,Ne[ta]=Uo-ys):(J[ta]=ys,Ie[ta]=Uo-ys)}this.adjustOddEvenCounts(L);let Ye=4*m.getValue()+(v?0:2)+(C?0:1)-1,at=0,ut=0;for(let fr=J.length-1;fr>=0;fr--){if(mt.isNotA1left(m,v,C)){let Uo=mt.WEIGHTS[Ye][2*fr];ut+=J[fr]*Uo}at+=J[fr]}let Et=0;for(let fr=pe.length-1;fr>=0;fr--)if(mt.isNotA1left(m,v,C)){let Uo=mt.WEIGHTS[Ye][2*fr+1];Et+=pe[fr]*Uo}let Rt=ut+Et;if(at&1||at>13||at<4)throw new Mt;let mi=(13-at)/2,gi=mt.SYMBOL_WIDEST[mi],ai=9-gi,Xn=uo.getRSSvalue(J,gi,!0),wn=uo.getRSSvalue(pe,ai,!1),yo=mt.EVEN_TOTAL_SUBSET[mi],Ss=mt.GSUM[mi],Yr=Xn*yo+wn+Ss;return new Fo(Yr,Rt)}static isNotA1left(c,m,v){return!(c.getValue()==0&&m&&v)}adjustOddEvenCounts(c){let m=ti.sum(new Int32Array(this.getOddCounts())),v=ti.sum(new Int32Array(this.getEvenCounts())),C=!1,I=!1;m>13?I=!0:m<4&&(C=!0);let L=!1,k=!1;v>13?k=!0:v<4&&(L=!0);let j=m+v-c,J=(m&1)==1,pe=(v&1)==0;if(j==1)if(J){if(pe)throw new Mt;I=!0}else{if(!pe)throw new Mt;k=!0}else if(j==-1)if(J){if(pe)throw new Mt;C=!0}else{if(!pe)throw new Mt;L=!0}else if(j==0){if(J){if(!pe)throw new Mt;m<v?(C=!0,k=!0):(I=!0,L=!0)}else if(pe)throw new Mt}else throw new Mt;if(C){if(I)throw new Mt;mt.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(I&&mt.decrement(this.getOddCounts(),this.getOddRoundingErrors()),L){if(k)throw new Mt;mt.increment(this.getEvenCounts(),this.getOddRoundingErrors())}k&&mt.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}mt.SYMBOL_WIDEST=[7,5,4,3,1],mt.EVEN_TOTAL_SUBSET=[4,20,52,104,204],mt.GSUM=[0,348,1388,2948,3988],mt.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],mt.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],mt.FINDER_PAT_A=0,mt.FINDER_PAT_B=1,mt.FINDER_PAT_C=2,mt.FINDER_PAT_D=3,mt.FINDER_PAT_E=4,mt.FINDER_PAT_F=5,mt.FINDER_PATTERN_SEQUENCES=[[mt.FINDER_PAT_A,mt.FINDER_PAT_A],[mt.FINDER_PAT_A,mt.FINDER_PAT_B,mt.FINDER_PAT_B],[mt.FINDER_PAT_A,mt.FINDER_PAT_C,mt.FINDER_PAT_B,mt.FINDER_PAT_D],[mt.FINDER_PAT_A,mt.FINDER_PAT_E,mt.FINDER_PAT_B,mt.FINDER_PAT_D,mt.FINDER_PAT_C],[mt.FINDER_PAT_A,mt.FINDER_PAT_E,mt.FINDER_PAT_B,mt.FINDER_PAT_D,mt.FINDER_PAT_D,mt.FINDER_PAT_F],[mt.FINDER_PAT_A,mt.FINDER_PAT_E,mt.FINDER_PAT_B,mt.FINDER_PAT_D,mt.FINDER_PAT_E,mt.FINDER_PAT_F,mt.FINDER_PAT_F],[mt.FINDER_PAT_A,mt.FINDER_PAT_A,mt.FINDER_PAT_B,mt.FINDER_PAT_B,mt.FINDER_PAT_C,mt.FINDER_PAT_C,mt.FINDER_PAT_D,mt.FINDER_PAT_D],[mt.FINDER_PAT_A,mt.FINDER_PAT_A,mt.FINDER_PAT_B,mt.FINDER_PAT_B,mt.FINDER_PAT_C,mt.FINDER_PAT_C,mt.FINDER_PAT_D,mt.FINDER_PAT_E,mt.FINDER_PAT_E],[mt.FINDER_PAT_A,mt.FINDER_PAT_A,mt.FINDER_PAT_B,mt.FINDER_PAT_B,mt.FINDER_PAT_C,mt.FINDER_PAT_C,mt.FINDER_PAT_D,mt.FINDER_PAT_E,mt.FINDER_PAT_F,mt.FINDER_PAT_F],[mt.FINDER_PAT_A,mt.FINDER_PAT_A,mt.FINDER_PAT_B,mt.FINDER_PAT_B,mt.FINDER_PAT_C,mt.FINDER_PAT_D,mt.FINDER_PAT_D,mt.FINDER_PAT_E,mt.FINDER_PAT_E,mt.FINDER_PAT_F,mt.FINDER_PAT_F]],mt.MAX_PAIRS=11;class Ti extends Fo{constructor(c,m,v){super(c,m),this.count=0,this.finderPattern=v}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class ui extends tr{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(c,m,v){const C=this.decodePair(m,!1,c,v);ui.addOrTally(this.possibleLeftPairs,C),m.reverse();let I=this.decodePair(m,!0,c,v);ui.addOrTally(this.possibleRightPairs,I),m.reverse();for(let L of this.possibleLeftPairs)if(L.getCount()>1){for(let k of this.possibleRightPairs)if(k.getCount()>1&&ui.checkChecksum(L,k))return ui.constructResult(L,k)}throw new Mt}static addOrTally(c,m){if(m==null)return;let v=!1;for(let C of c)if(C.getValue()===m.getValue()){C.incrementCount(),v=!0;break}v||c.push(m)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(c,m){let v=4537077*c.getValue()+m.getValue(),C=new String(v).toString(),I=new Ot;for(let J=13-C.length;J>0;J--)I.append("0");I.append(C);let L=0;for(let J=0;J<13;J++){let pe=I.charAt(J).charCodeAt(0)-"0".charCodeAt(0);L+=J&1?pe:3*pe}L=10-L%10,L===10&&(L=0),I.append(L.toString());let k=c.getFinderPattern().getResultPoints(),j=m.getFinderPattern().getResultPoints();return new fn(I.toString(),null,0,[k[0],k[1],j[0],j[1]],Ri.RSS_14,new Date().getTime())}static checkChecksum(c,m){let v=(c.getChecksumPortion()+16*m.getChecksumPortion())%79,C=9*c.getFinderPattern().getValue()+m.getFinderPattern().getValue();return C>72&&C--,C>8&&C--,v===C}decodePair(c,m,v,C){try{let I=this.findFinderPattern(c,m),L=this.parseFoundFinderPattern(c,v,m,I),k=C==null?null:C.get(fe.NEED_RESULT_POINT_CALLBACK);if(k!=null){let pe=(I[0]+I[1])/2;m&&(pe=c.getSize()-1-pe),k.foundPossibleResultPoint(new wi(pe,v))}let j=this.decodeDataCharacter(c,L,!0),J=this.decodeDataCharacter(c,L,!1);return new Ti(1597*j.getValue()+J.getValue(),j.getChecksumPortion()+4*J.getChecksumPortion(),L)}catch{return null}}decodeDataCharacter(c,m,v){let C=this.getDataCharacterCounters();for(let Et=0;Et<C.length;Et++)C[Et]=0;if(v)er.recordPatternInReverse(c,m.getStartEnd()[0],C);else{er.recordPattern(c,m.getStartEnd()[1]+1,C);for(let Et=0,Rt=C.length-1;Et<Rt;Et++,Rt--){let mi=C[Et];C[Et]=C[Rt],C[Rt]=mi}}let I=v?16:15,L=ti.sum(new Int32Array(C))/I,k=this.getOddCounts(),j=this.getEvenCounts(),J=this.getOddRoundingErrors(),pe=this.getEvenRoundingErrors();for(let Et=0;Et<C.length;Et++){let Rt=C[Et]/L,mi=Math.floor(Rt+.5);mi<1?mi=1:mi>8&&(mi=8);let gi=Math.floor(Et/2);Et&1?(j[gi]=mi,pe[gi]=Rt-mi):(k[gi]=mi,J[gi]=Rt-mi)}this.adjustOddEvenCounts(v,I);let Ie=0,Ne=0;for(let Et=k.length-1;Et>=0;Et--)Ne*=9,Ne+=k[Et],Ie+=k[Et];let Ye=0,at=0;for(let Et=j.length-1;Et>=0;Et--)Ye*=9,Ye+=j[Et],at+=j[Et];let ut=Ne+3*Ye;if(v){if(Ie&1||Ie>12||Ie<4)throw new Mt;let Et=(12-Ie)/2,Rt=ui.OUTSIDE_ODD_WIDEST[Et],mi=9-Rt,gi=uo.getRSSvalue(k,Rt,!1),ai=uo.getRSSvalue(j,mi,!0),Xn=ui.OUTSIDE_EVEN_TOTAL_SUBSET[Et],wn=ui.OUTSIDE_GSUM[Et];return new Fo(gi*Xn+ai+wn,ut)}else{if(at&1||at>10||at<4)throw new Mt;let Et=(10-at)/2,Rt=ui.INSIDE_ODD_WIDEST[Et],mi=9-Rt,gi=uo.getRSSvalue(k,Rt,!0),ai=uo.getRSSvalue(j,mi,!1),Xn=ui.INSIDE_ODD_TOTAL_SUBSET[Et],wn=ui.INSIDE_GSUM[Et];return new Fo(ai*Xn+gi+wn,ut)}}findFinderPattern(c,m){let v=this.getDecodeFinderCounters();v[0]=0,v[1]=0,v[2]=0,v[3]=0;let C=c.getSize(),I=!1,L=0;for(;L<C&&(I=!c.get(L),m!==I);)L++;let k=0,j=L;for(let J=L;J<C;J++)if(c.get(J)!==I)v[k]++;else{if(k===3){if(tr.isFinderPattern(v))return[j,J];j+=v[0]+v[1],v[0]=v[2],v[1]=v[3],v[2]=0,v[3]=0,k--}else k++;v[k]=1,I=!I}throw new Mt}parseFoundFinderPattern(c,m,v,C){let I=c.get(C[0]),L=C[0]-1;for(;L>=0&&I!==c.get(L);)L--;L++;const k=C[0]-L,j=this.getDecodeFinderCounters(),J=new Int32Array(j.length);K.arraycopy(j,0,J,1,j.length-1),J[0]=k;const pe=this.parseFinderValue(J,ui.FINDER_PATTERNS);let Ie=L,Ne=C[1];return v&&(Ie=c.getSize()-1-Ie,Ne=c.getSize()-1-Ne),new Eo(pe,[L,C[1]],Ie,Ne,m)}adjustOddEvenCounts(c,m){let v=ti.sum(new Int32Array(this.getOddCounts())),C=ti.sum(new Int32Array(this.getEvenCounts())),I=!1,L=!1,k=!1,j=!1;c?(v>12?L=!0:v<4&&(I=!0),C>12?j=!0:C<4&&(k=!0)):(v>11?L=!0:v<5&&(I=!0),C>10?j=!0:C<4&&(k=!0));let J=v+C-m,pe=(v&1)===(c?1:0),Ie=(C&1)===1;if(J===1)if(pe){if(Ie)throw new Mt;L=!0}else{if(!Ie)throw new Mt;j=!0}else if(J===-1)if(pe){if(Ie)throw new Mt;I=!0}else{if(!Ie)throw new Mt;k=!0}else if(J===0){if(pe){if(!Ie)throw new Mt;v<C?(I=!0,j=!0):(L=!0,k=!0)}else if(Ie)throw new Mt}else throw new Mt;if(I){if(L)throw new Mt;tr.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(L&&tr.decrement(this.getOddCounts(),this.getOddRoundingErrors()),k){if(j)throw new Mt;tr.increment(this.getEvenCounts(),this.getOddRoundingErrors())}j&&tr.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}ui.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],ui.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],ui.OUTSIDE_GSUM=[0,161,961,2015,2715],ui.INSIDE_GSUM=[0,336,1036,1516],ui.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],ui.INSIDE_ODD_WIDEST=[2,4,6,8],ui.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class Gt extends er{constructor(c,m){super(),this.readers=[],this.verbose=m===!0;const v=c?c.get(fe.POSSIBLE_FORMATS):null,C=c&&c.get(fe.ASSUME_CODE_39_CHECK_DIGIT)!==void 0;v?((v.includes(Ri.EAN_13)||v.includes(Ri.UPC_A)||v.includes(Ri.EAN_8)||v.includes(Ri.UPC_E))&&this.readers.push(new Rs(c)),v.includes(Ri.CODE_39)&&this.readers.push(new xi(C)),v.includes(Ri.CODE_128)&&this.readers.push(new pi),v.includes(Ri.ITF)&&this.readers.push(new Gn),v.includes(Ri.RSS_14)&&this.readers.push(new ui),v.includes(Ri.RSS_EXPANDED)&&this.readers.push(new mt(this.verbose))):(this.readers.push(new Rs(c)),this.readers.push(new xi),this.readers.push(new Rs(c)),this.readers.push(new pi),this.readers.push(new Gn),this.readers.push(new ui),this.readers.push(new mt(this.verbose)))}decodeRow(c,m,v){for(let C=0;C<this.readers.length;C++)try{return this.readers[C].decodeRow(c,m,v)}catch{}throw new Mt}reset(){this.readers.forEach(c=>c.reset())}}class Yi extends ir{constructor(c=500,m){super(new Gt(m),c,m)}}class ei{constructor(c,m,v){this.ecCodewords=c,this.ecBlocks=[m],v&&this.ecBlocks.push(v)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class ii{constructor(c,m){this.count=c,this.dataCodewords=m}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class yi{constructor(c,m,v,C,I,L){this.versionNumber=c,this.symbolSizeRows=m,this.symbolSizeColumns=v,this.dataRegionSizeRows=C,this.dataRegionSizeColumns=I,this.ecBlocks=L;let k=0;const j=L.getECCodewords(),J=L.getECBlocks();for(let pe of J)k+=pe.getCount()*(pe.getDataCodewords()+j);this.totalCodewords=k}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(c,m){if(c&1||m&1)throw new ce;for(let v of yi.VERSIONS)if(v.symbolSizeRows===c&&v.symbolSizeColumns===m)return v;throw new ce}toString(){return""+this.versionNumber}static buildVersions(){return[new yi(1,10,10,8,8,new ei(5,new ii(1,3))),new yi(2,12,12,10,10,new ei(7,new ii(1,5))),new yi(3,14,14,12,12,new ei(10,new ii(1,8))),new yi(4,16,16,14,14,new ei(12,new ii(1,12))),new yi(5,18,18,16,16,new ei(14,new ii(1,18))),new yi(6,20,20,18,18,new ei(18,new ii(1,22))),new yi(7,22,22,20,20,new ei(20,new ii(1,30))),new yi(8,24,24,22,22,new ei(24,new ii(1,36))),new yi(9,26,26,24,24,new ei(28,new ii(1,44))),new yi(10,32,32,14,14,new ei(36,new ii(1,62))),new yi(11,36,36,16,16,new ei(42,new ii(1,86))),new yi(12,40,40,18,18,new ei(48,new ii(1,114))),new yi(13,44,44,20,20,new ei(56,new ii(1,144))),new yi(14,48,48,22,22,new ei(68,new ii(1,174))),new yi(15,52,52,24,24,new ei(42,new ii(2,102))),new yi(16,64,64,14,14,new ei(56,new ii(2,140))),new yi(17,72,72,16,16,new ei(36,new ii(4,92))),new yi(18,80,80,18,18,new ei(48,new ii(4,114))),new yi(19,88,88,20,20,new ei(56,new ii(4,144))),new yi(20,96,96,22,22,new ei(68,new ii(4,174))),new yi(21,104,104,24,24,new ei(56,new ii(6,136))),new yi(22,120,120,18,18,new ei(68,new ii(6,175))),new yi(23,132,132,20,20,new ei(62,new ii(8,163))),new yi(24,144,144,22,22,new ei(62,new ii(8,156),new ii(2,155))),new yi(25,8,18,6,16,new ei(7,new ii(1,5))),new yi(26,8,32,6,14,new ei(11,new ii(1,10))),new yi(27,12,26,10,24,new ei(14,new ii(1,16))),new yi(28,12,36,10,16,new ei(18,new ii(1,22))),new yi(29,16,36,14,16,new ei(24,new ii(1,32))),new yi(30,16,48,14,22,new ei(28,new ii(1,49)))]}}yi.VERSIONS=yi.buildVersions();class Xi{constructor(c){const m=c.getHeight();if(m<8||m>144||m&1)throw new ce;this.version=Xi.readVersion(c),this.mappingBitMatrix=this.extractDataRegion(c),this.readMappingMatrix=new Ui(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(c){const m=c.getHeight(),v=c.getWidth();return yi.getVersionForDimensions(m,v)}readCodewords(){const c=new Int8Array(this.version.getTotalCodewords());let m=0,v=4,C=0;const I=this.mappingBitMatrix.getHeight(),L=this.mappingBitMatrix.getWidth();let k=!1,j=!1,J=!1,pe=!1;do if(v===I&&C===0&&!k)c[m++]=this.readCorner1(I,L)&255,v-=2,C+=2,k=!0;else if(v===I-2&&C===0&&L&3&&!j)c[m++]=this.readCorner2(I,L)&255,v-=2,C+=2,j=!0;else if(v===I+4&&C===2&&!(L&7)&&!J)c[m++]=this.readCorner3(I,L)&255,v-=2,C+=2,J=!0;else if(v===I-2&&C===0&&(L&7)===4&&!pe)c[m++]=this.readCorner4(I,L)&255,v-=2,C+=2,pe=!0;else{do v<I&&C>=0&&!this.readMappingMatrix.get(C,v)&&(c[m++]=this.readUtah(v,C,I,L)&255),v-=2,C+=2;while(v>=0&&C<L);v+=1,C+=3;do v>=0&&C<L&&!this.readMappingMatrix.get(C,v)&&(c[m++]=this.readUtah(v,C,I,L)&255),v+=2,C-=2;while(v<I&&C>=0);v+=3,C+=1}while(v<I||C<L);if(m!==this.version.getTotalCodewords())throw new ce;return c}readModule(c,m,v,C){return c<0&&(c+=v,m+=4-(v+4&7)),m<0&&(m+=C,c+=4-(C+4&7)),this.readMappingMatrix.set(m,c),this.mappingBitMatrix.get(m,c)}readUtah(c,m,v,C){let I=0;return this.readModule(c-2,m-2,v,C)&&(I|=1),I<<=1,this.readModule(c-2,m-1,v,C)&&(I|=1),I<<=1,this.readModule(c-1,m-2,v,C)&&(I|=1),I<<=1,this.readModule(c-1,m-1,v,C)&&(I|=1),I<<=1,this.readModule(c-1,m,v,C)&&(I|=1),I<<=1,this.readModule(c,m-2,v,C)&&(I|=1),I<<=1,this.readModule(c,m-1,v,C)&&(I|=1),I<<=1,this.readModule(c,m,v,C)&&(I|=1),I}readCorner1(c,m){let v=0;return this.readModule(c-1,0,c,m)&&(v|=1),v<<=1,this.readModule(c-1,1,c,m)&&(v|=1),v<<=1,this.readModule(c-1,2,c,m)&&(v|=1),v<<=1,this.readModule(0,m-2,c,m)&&(v|=1),v<<=1,this.readModule(0,m-1,c,m)&&(v|=1),v<<=1,this.readModule(1,m-1,c,m)&&(v|=1),v<<=1,this.readModule(2,m-1,c,m)&&(v|=1),v<<=1,this.readModule(3,m-1,c,m)&&(v|=1),v}readCorner2(c,m){let v=0;return this.readModule(c-3,0,c,m)&&(v|=1),v<<=1,this.readModule(c-2,0,c,m)&&(v|=1),v<<=1,this.readModule(c-1,0,c,m)&&(v|=1),v<<=1,this.readModule(0,m-4,c,m)&&(v|=1),v<<=1,this.readModule(0,m-3,c,m)&&(v|=1),v<<=1,this.readModule(0,m-2,c,m)&&(v|=1),v<<=1,this.readModule(0,m-1,c,m)&&(v|=1),v<<=1,this.readModule(1,m-1,c,m)&&(v|=1),v}readCorner3(c,m){let v=0;return this.readModule(c-1,0,c,m)&&(v|=1),v<<=1,this.readModule(c-1,m-1,c,m)&&(v|=1),v<<=1,this.readModule(0,m-3,c,m)&&(v|=1),v<<=1,this.readModule(0,m-2,c,m)&&(v|=1),v<<=1,this.readModule(0,m-1,c,m)&&(v|=1),v<<=1,this.readModule(1,m-3,c,m)&&(v|=1),v<<=1,this.readModule(1,m-2,c,m)&&(v|=1),v<<=1,this.readModule(1,m-1,c,m)&&(v|=1),v}readCorner4(c,m){let v=0;return this.readModule(c-3,0,c,m)&&(v|=1),v<<=1,this.readModule(c-2,0,c,m)&&(v|=1),v<<=1,this.readModule(c-1,0,c,m)&&(v|=1),v<<=1,this.readModule(0,m-2,c,m)&&(v|=1),v<<=1,this.readModule(0,m-1,c,m)&&(v|=1),v<<=1,this.readModule(1,m-1,c,m)&&(v|=1),v<<=1,this.readModule(2,m-1,c,m)&&(v|=1),v<<=1,this.readModule(3,m-1,c,m)&&(v|=1),v}extractDataRegion(c){const m=this.version.getSymbolSizeRows(),v=this.version.getSymbolSizeColumns();if(c.getHeight()!==m)throw new se("Dimension of bitMatrix must match the version size");const C=this.version.getDataRegionSizeRows(),I=this.version.getDataRegionSizeColumns(),L=m/C|0,k=v/I|0,j=L*C,J=k*I,pe=new Ui(J,j);for(let Ie=0;Ie<L;++Ie){const Ne=Ie*C;for(let Ye=0;Ye<k;++Ye){const at=Ye*I;for(let ut=0;ut<C;++ut){const Et=Ie*(C+2)+1+ut,Rt=Ne+ut;for(let mi=0;mi<I;++mi){const gi=Ye*(I+2)+1+mi;if(c.get(gi,Et)){const ai=at+mi;pe.set(ai,Rt)}}}}}return pe}}class tn{constructor(c,m){this.numDataCodewords=c,this.codewords=m}static getDataBlocks(c,m){const v=m.getECBlocks();let C=0;const I=v.getECBlocks();for(let ut of I)C+=ut.getCount();const L=new Array(C);let k=0;for(let ut of I)for(let Et=0;Et<ut.getCount();Et++){const Rt=ut.getDataCodewords(),mi=v.getECCodewords()+Rt;L[k++]=new tn(Rt,new Uint8Array(mi))}const J=L[0].codewords.length-v.getECCodewords(),pe=J-1;let Ie=0;for(let ut=0;ut<pe;ut++)for(let Et=0;Et<k;Et++)L[Et].codewords[ut]=c[Ie++];const Ne=m.getVersionNumber()===24,Ye=Ne?8:k;for(let ut=0;ut<Ye;ut++)L[ut].codewords[J-1]=c[Ie++];const at=L[0].codewords.length;for(let ut=J;ut<at;ut++)for(let Et=0;Et<k;Et++){const Rt=Ne?(Et+8)%k:Et,mi=Ne&&Rt>7?ut-1:ut;L[Rt].codewords[mi]=c[Ie++]}if(Ie!==c.length)throw new se;return L}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class Dn{constructor(c){this.bytes=c,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(c){if(c<1||c>32||c>this.available())throw new se(""+c);let m=0,v=this.bitOffset,C=this.byteOffset;const I=this.bytes;if(v>0){const L=8-v,k=c<L?c:L,j=L-k,J=255>>8-k<<j;m=(I[C]&J)>>j,c-=k,v+=k,v===8&&(v=0,C++)}if(c>0){for(;c>=8;)m=m<<8|I[C]&255,C++,c-=8;if(c>0){const L=8-c,k=255>>L<<L;m=m<<c|(I[C]&k)>>L,v+=c}}return this.bitOffset=v,this.byteOffset=C,m}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}var pn;(function(Te){Te[Te.PAD_ENCODE=0]="PAD_ENCODE",Te[Te.ASCII_ENCODE=1]="ASCII_ENCODE",Te[Te.C40_ENCODE=2]="C40_ENCODE",Te[Te.TEXT_ENCODE=3]="TEXT_ENCODE",Te[Te.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",Te[Te.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",Te[Te.BASE256_ENCODE=6]="BASE256_ENCODE"})(pn||(pn={}));class Ar{static decode(c){const m=new Dn(c),v=new Ot,C=new Ot,I=new Array;let L=pn.ASCII_ENCODE;do if(L===pn.ASCII_ENCODE)L=this.decodeAsciiSegment(m,v,C);else{switch(L){case pn.C40_ENCODE:this.decodeC40Segment(m,v);break;case pn.TEXT_ENCODE:this.decodeTextSegment(m,v);break;case pn.ANSIX12_ENCODE:this.decodeAnsiX12Segment(m,v);break;case pn.EDIFACT_ENCODE:this.decodeEdifactSegment(m,v);break;case pn.BASE256_ENCODE:this.decodeBase256Segment(m,v,I);break;default:throw new ce}L=pn.ASCII_ENCODE}while(L!==pn.PAD_ENCODE&&m.available()>0);return C.length()>0&&v.append(C.toString()),new zi(c,v.toString(),I.length===0?null:I,null)}static decodeAsciiSegment(c,m,v){let C=!1;do{let I=c.readBits(8);if(I===0)throw new ce;if(I<=128)return C&&(I+=128),m.append(String.fromCharCode(I-1)),pn.ASCII_ENCODE;if(I===129)return pn.PAD_ENCODE;if(I<=229){const L=I-130;L<10&&m.append("0"),m.append(""+L)}else switch(I){case 230:return pn.C40_ENCODE;case 231:return pn.BASE256_ENCODE;case 232:m.append(String.fromCharCode(29));break;case 233:case 234:break;case 235:C=!0;break;case 236:m.append("[)>05"),v.insert(0,"");break;case 237:m.append("[)>06"),v.insert(0,"");break;case 238:return pn.ANSIX12_ENCODE;case 239:return pn.TEXT_ENCODE;case 240:return pn.EDIFACT_ENCODE;case 241:break;default:if(I!==254||c.available()!==0)throw new ce;break}}while(c.available()>0);return pn.ASCII_ENCODE}static decodeC40Segment(c,m){let v=!1;const C=[];let I=0;do{if(c.available()===8)return;const L=c.readBits(8);if(L===254)return;this.parseTwoBytes(L,c.readBits(8),C);for(let k=0;k<3;k++){const j=C[k];switch(I){case 0:if(j<3)I=j+1;else if(j<this.C40_BASIC_SET_CHARS.length){const J=this.C40_BASIC_SET_CHARS[j];v?(m.append(String.fromCharCode(J.charCodeAt(0)+128)),v=!1):m.append(J)}else throw new ce;break;case 1:v?(m.append(String.fromCharCode(j+128)),v=!1):m.append(String.fromCharCode(j)),I=0;break;case 2:if(j<this.C40_SHIFT2_SET_CHARS.length){const J=this.C40_SHIFT2_SET_CHARS[j];v?(m.append(String.fromCharCode(J.charCodeAt(0)+128)),v=!1):m.append(J)}else switch(j){case 27:m.append(String.fromCharCode(29));break;case 30:v=!0;break;default:throw new ce}I=0;break;case 3:v?(m.append(String.fromCharCode(j+224)),v=!1):m.append(String.fromCharCode(j+96)),I=0;break;default:throw new ce}}}while(c.available()>0)}static decodeTextSegment(c,m){let v=!1,C=[],I=0;do{if(c.available()===8)return;const L=c.readBits(8);if(L===254)return;this.parseTwoBytes(L,c.readBits(8),C);for(let k=0;k<3;k++){const j=C[k];switch(I){case 0:if(j<3)I=j+1;else if(j<this.TEXT_BASIC_SET_CHARS.length){const J=this.TEXT_BASIC_SET_CHARS[j];v?(m.append(String.fromCharCode(J.charCodeAt(0)+128)),v=!1):m.append(J)}else throw new ce;break;case 1:v?(m.append(String.fromCharCode(j+128)),v=!1):m.append(String.fromCharCode(j)),I=0;break;case 2:if(j<this.TEXT_SHIFT2_SET_CHARS.length){const J=this.TEXT_SHIFT2_SET_CHARS[j];v?(m.append(String.fromCharCode(J.charCodeAt(0)+128)),v=!1):m.append(J)}else switch(j){case 27:m.append(String.fromCharCode(29));break;case 30:v=!0;break;default:throw new ce}I=0;break;case 3:if(j<this.TEXT_SHIFT3_SET_CHARS.length){const J=this.TEXT_SHIFT3_SET_CHARS[j];v?(m.append(String.fromCharCode(J.charCodeAt(0)+128)),v=!1):m.append(J),I=0}else throw new ce;break;default:throw new ce}}}while(c.available()>0)}static decodeAnsiX12Segment(c,m){const v=[];do{if(c.available()===8)return;const C=c.readBits(8);if(C===254)return;this.parseTwoBytes(C,c.readBits(8),v);for(let I=0;I<3;I++){const L=v[I];switch(L){case 0:m.append("\r");break;case 1:m.append("*");break;case 2:m.append(">");break;case 3:m.append(" ");break;default:if(L<14)m.append(String.fromCharCode(L+44));else if(L<40)m.append(String.fromCharCode(L+51));else throw new ce;break}}}while(c.available()>0)}static parseTwoBytes(c,m,v){let C=(c<<8)+m-1,I=Math.floor(C/1600);v[0]=I,C-=I*1600,I=Math.floor(C/40),v[1]=I,v[2]=C-I*40}static decodeEdifactSegment(c,m){do{if(c.available()<=16)return;for(let v=0;v<4;v++){let C=c.readBits(6);if(C===31){const I=8-c.getBitOffset();I!==8&&c.readBits(I);return}C&32||(C|=64),m.append(String.fromCharCode(C))}}while(c.available()>0)}static decodeBase256Segment(c,m,v){let C=1+c.getByteOffset();const I=this.unrandomize255State(c.readBits(8),C++);let L;if(I===0?L=c.available()/8|0:I<250?L=I:L=250*(I-249)+this.unrandomize255State(c.readBits(8),C++),L<0)throw new ce;const k=new Uint8Array(L);for(let j=0;j<L;j++){if(c.available()<8)throw new ce;k[j]=this.unrandomize255State(c.readBits(8),C++)}v.push(k);try{m.append(vt.decode(k,xt.ISO88591))}catch(j){throw new Or("Platform does not support required encoding: "+j.message)}}static unrandomize255State(c,m){const v=149*m%255+1,C=c-v;return C>=0?C:C+256}}Ar.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],Ar.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],Ar.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],Ar.TEXT_SHIFT2_SET_CHARS=Ar.C40_SHIFT2_SET_CHARS,Ar.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",String.fromCharCode(127)];class es{constructor(){this.rsDecoder=new Hi(fi.DATA_MATRIX_FIELD_256)}decode(c){const m=new Xi(c),v=m.getVersion(),C=m.readCodewords(),I=tn.getDataBlocks(C,v);let L=0;for(let J of I)L+=J.getNumDataCodewords();const k=new Uint8Array(L),j=I.length;for(let J=0;J<j;J++){const pe=I[J],Ie=pe.getCodewords(),Ne=pe.getNumDataCodewords();this.correctErrors(Ie,Ne);for(let Ye=0;Ye<Ne;Ye++)k[Ye*j+J]=Ie[Ye]}return Ar.decode(k)}correctErrors(c,m){const v=new Int32Array(c);try{this.rsDecoder.decode(v,c.length-m)}catch{throw new Ce}for(let C=0;C<m;C++)c[C]=v[C]}}class ar{constructor(c){this.image=c,this.rectangleDetector=new so(this.image)}detect(){const c=this.rectangleDetector.detect();let m=this.detectSolid1(c);if(m=this.detectSolid2(m),m[3]=this.correctTopRight(m),!m[3])throw new Mt;m=this.shiftToModuleCenter(m);const v=m[0],C=m[1],I=m[2],L=m[3];let k=this.transitionsBetween(v,L)+1,j=this.transitionsBetween(I,L)+1;(k&1)===1&&(k+=1),(j&1)===1&&(j+=1),4*k<7*j&&4*j<7*k&&(k=j=Math.max(k,j));let J=ar.sampleGrid(this.image,v,C,I,L,k,j);return new on(J,[v,C,I,L])}static shiftPoint(c,m,v){let C=(m.getX()-c.getX())/(v+1),I=(m.getY()-c.getY())/(v+1);return new wi(c.getX()+C,c.getY()+I)}static moveAway(c,m,v){let C=c.getX(),I=c.getY();return C<m?C-=1:C+=1,I<v?I-=1:I+=1,new wi(C,I)}detectSolid1(c){let m=c[0],v=c[1],C=c[3],I=c[2],L=this.transitionsBetween(m,v),k=this.transitionsBetween(v,C),j=this.transitionsBetween(C,I),J=this.transitionsBetween(I,m),pe=L,Ie=[I,m,v,C];return pe>k&&(pe=k,Ie[0]=m,Ie[1]=v,Ie[2]=C,Ie[3]=I),pe>j&&(pe=j,Ie[0]=v,Ie[1]=C,Ie[2]=I,Ie[3]=m),pe>J&&(Ie[0]=C,Ie[1]=I,Ie[2]=m,Ie[3]=v),Ie}detectSolid2(c){let m=c[0],v=c[1],C=c[2],I=c[3],L=this.transitionsBetween(m,I),k=ar.shiftPoint(v,C,(L+1)*4),j=ar.shiftPoint(C,v,(L+1)*4),J=this.transitionsBetween(k,m),pe=this.transitionsBetween(j,I);return J<pe?(c[0]=m,c[1]=v,c[2]=C,c[3]=I):(c[0]=v,c[1]=C,c[2]=I,c[3]=m),c}correctTopRight(c){let m=c[0],v=c[1],C=c[2],I=c[3],L=this.transitionsBetween(m,I),k=this.transitionsBetween(v,I),j=ar.shiftPoint(m,v,(k+1)*4),J=ar.shiftPoint(C,v,(L+1)*4);L=this.transitionsBetween(j,I),k=this.transitionsBetween(J,I);let pe=new wi(I.getX()+(C.getX()-v.getX())/(L+1),I.getY()+(C.getY()-v.getY())/(L+1)),Ie=new wi(I.getX()+(m.getX()-v.getX())/(k+1),I.getY()+(m.getY()-v.getY())/(k+1));if(!this.isValid(pe))return this.isValid(Ie)?Ie:null;if(!this.isValid(Ie))return pe;let Ne=this.transitionsBetween(j,pe)+this.transitionsBetween(J,pe),Ye=this.transitionsBetween(j,Ie)+this.transitionsBetween(J,Ie);return Ne>Ye?pe:Ie}shiftToModuleCenter(c){let m=c[0],v=c[1],C=c[2],I=c[3],L=this.transitionsBetween(m,I)+1,k=this.transitionsBetween(C,I)+1,j=ar.shiftPoint(m,v,k*4),J=ar.shiftPoint(C,v,L*4);L=this.transitionsBetween(j,I)+1,k=this.transitionsBetween(J,I)+1,(L&1)===1&&(L+=1),(k&1)===1&&(k+=1);let pe=(m.getX()+v.getX()+C.getX()+I.getX())/4,Ie=(m.getY()+v.getY()+C.getY()+I.getY())/4;m=ar.moveAway(m,pe,Ie),v=ar.moveAway(v,pe,Ie),C=ar.moveAway(C,pe,Ie),I=ar.moveAway(I,pe,Ie);let Ne,Ye;return j=ar.shiftPoint(m,v,k*4),j=ar.shiftPoint(j,I,L*4),Ne=ar.shiftPoint(v,m,k*4),Ne=ar.shiftPoint(Ne,C,L*4),J=ar.shiftPoint(C,I,k*4),J=ar.shiftPoint(J,v,L*4),Ye=ar.shiftPoint(I,C,k*4),Ye=ar.shiftPoint(Ye,m,L*4),[j,Ne,J,Ye]}isValid(c){return c.getX()>=0&&c.getX()<this.image.getWidth()&&c.getY()>0&&c.getY()<this.image.getHeight()}static sampleGrid(c,m,v,C,I,L,k){return ao.getInstance().sampleGrid(c,L,k,.5,.5,L-.5,.5,L-.5,k-.5,.5,k-.5,m.getX(),m.getY(),I.getX(),I.getY(),C.getX(),C.getY(),v.getX(),v.getY())}transitionsBetween(c,m){let v=Math.trunc(c.getX()),C=Math.trunc(c.getY()),I=Math.trunc(m.getX()),L=Math.trunc(m.getY()),k=Math.abs(L-C)>Math.abs(I-v);if(k){let ut=v;v=C,C=ut,ut=I,I=L,L=ut}let j=Math.abs(I-v),J=Math.abs(L-C),pe=-j/2,Ie=C<L?1:-1,Ne=v<I?1:-1,Ye=0,at=this.image.get(k?C:v,k?v:C);for(let ut=v,Et=C;ut!==I;ut+=Ne){let Rt=this.image.get(k?Et:ut,k?ut:Et);if(Rt!==at&&(Ye++,at=Rt),pe+=J,pe>0){if(Et===L)break;Et+=Ie,pe-=j}}return Ye}}class _n{constructor(){this.decoder=new es}decode(c,m=null){let v,C;if(m!=null&&m.has(fe.PURE_BARCODE)){const J=_n.extractPureBits(c.getBlackMatrix());v=this.decoder.decode(J),C=_n.NO_POINTS}else{const J=new ar(c.getBlackMatrix()).detect();v=this.decoder.decode(J.getBits()),C=J.getPoints()}const I=v.getRawBytes(),L=new fn(v.getText(),I,8*I.length,C,Ri.DATA_MATRIX,K.currentTimeMillis()),k=v.getByteSegments();k!=null&&L.putMetadata(si.BYTE_SEGMENTS,k);const j=v.getECLevel();return j!=null&&L.putMetadata(si.ERROR_CORRECTION_LEVEL,j),L}reset(){}static extractPureBits(c){const m=c.getTopLeftOnBit(),v=c.getBottomRightOnBit();if(m==null||v==null)throw new Mt;const C=this.moduleSize(m,c);let I=m[1];const L=v[1];let k=m[0];const J=(v[0]-k+1)/C,pe=(L-I+1)/C;if(J<=0||pe<=0)throw new Mt;const Ie=C/2;I+=Ie,k+=Ie;const Ne=new Ui(J,pe);for(let Ye=0;Ye<pe;Ye++){const at=I+Ye*C;for(let ut=0;ut<J;ut++)c.get(k+ut*C,at)&&Ne.set(ut,Ye)}return Ne}static moduleSize(c,m){const v=m.getWidth();let C=c[0];const I=c[1];for(;C<v&&m.get(C,I);)C++;if(C===v)throw new Mt;const L=C-c[0];if(L===0)throw new Mt;return L}}_n.NO_POINTS=[];class Pi extends ir{constructor(c=500){super(new _n,c)}}var zo;(function(Te){Te[Te.L=0]="L",Te[Te.M=1]="M",Te[Te.Q=2]="Q",Te[Te.H=3]="H"})(zo||(zo={}));class Rn{constructor(c,m,v){this.value=c,this.stringValue=m,this.bits=v,Rn.FOR_BITS.set(v,this),Rn.FOR_VALUE.set(c,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(c){switch(c){case"L":return Rn.L;case"M":return Rn.M;case"Q":return Rn.Q;case"H":return Rn.H;default:throw new Y(c+"not available")}}toString(){return this.stringValue}equals(c){if(!(c instanceof Rn))return!1;const m=c;return this.value===m.value}static forBits(c){if(c<0||c>=Rn.FOR_BITS.size)throw new se;return Rn.FOR_BITS.get(c)}}Rn.FOR_BITS=new Map,Rn.FOR_VALUE=new Map,Rn.L=new Rn(zo.L,"L",1),Rn.M=new Rn(zo.M,"M",0),Rn.Q=new Rn(zo.Q,"Q",3),Rn.H=new Rn(zo.H,"H",2);class Zr{constructor(c){this.errorCorrectionLevel=Rn.forBits(c>>3&3),this.dataMask=c&7}static numBitsDiffering(c,m){return G.bitCount(c^m)}static decodeFormatInformation(c,m){const v=Zr.doDecodeFormatInformation(c,m);return v!==null?v:Zr.doDecodeFormatInformation(c^Zr.FORMAT_INFO_MASK_QR,m^Zr.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(c,m){let v=Number.MAX_SAFE_INTEGER,C=0;for(const I of Zr.FORMAT_INFO_DECODE_LOOKUP){const L=I[0];if(L===c||L===m)return new Zr(I[1]);let k=Zr.numBitsDiffering(c,L);k<v&&(C=I[1],v=k),c!==m&&(k=Zr.numBitsDiffering(m,L),k<v&&(C=I[1],v=k))}return v<=3?new Zr(C):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(c){if(!(c instanceof Zr))return!1;const m=c;return this.errorCorrectionLevel===m.errorCorrectionLevel&&this.dataMask===m.dataMask}}Zr.FORMAT_INFO_MASK_QR=21522,Zr.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class Ct{constructor(c,...m){this.ecCodewordsPerBlock=c,this.ecBlocks=m}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let c=0;const m=this.ecBlocks;for(const v of m)c+=v.getCount();return c}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class We{constructor(c,m){this.count=c,this.dataCodewords=m}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class ki{constructor(c,m,...v){this.versionNumber=c,this.alignmentPatternCenters=m,this.ecBlocks=v;let C=0;const I=v[0].getECCodewordsPerBlock(),L=v[0].getECBlocks();for(const k of L)C+=k.getCount()*(k.getDataCodewords()+I);this.totalCodewords=C}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(c){return this.ecBlocks[c.getValue()]}static getProvisionalVersionForDimension(c){if(c%4!==1)throw new ce;try{return this.getVersionForNumber((c-17)/4)}catch{throw new ce}}static getVersionForNumber(c){if(c<1||c>40)throw new se;return ki.VERSIONS[c-1]}static decodeVersionInformation(c){let m=Number.MAX_SAFE_INTEGER,v=0;for(let C=0;C<ki.VERSION_DECODE_INFO.length;C++){const I=ki.VERSION_DECODE_INFO[C];if(I===c)return ki.getVersionForNumber(C+7);const L=Zr.numBitsDiffering(c,I);L<m&&(v=C+7,m=L)}return m<=3?ki.getVersionForNumber(v):null}buildFunctionPattern(){const c=this.getDimensionForVersion(),m=new Ui(c);m.setRegion(0,0,9,9),m.setRegion(c-8,0,8,9),m.setRegion(0,c-8,9,8);const v=this.alignmentPatternCenters.length;for(let C=0;C<v;C++){const I=this.alignmentPatternCenters[C]-2;for(let L=0;L<v;L++)C===0&&(L===0||L===v-1)||C===v-1&&L===0||m.setRegion(this.alignmentPatternCenters[L]-2,I,5,5)}return m.setRegion(6,9,1,c-17),m.setRegion(9,6,c-17,1),this.versionNumber>6&&(m.setRegion(c-11,0,3,6),m.setRegion(0,c-11,6,3)),m}toString(){return""+this.versionNumber}}ki.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),ki.VERSIONS=[new ki(1,new Int32Array(0),new Ct(7,new We(1,19)),new Ct(10,new We(1,16)),new Ct(13,new We(1,13)),new Ct(17,new We(1,9))),new ki(2,Int32Array.from([6,18]),new Ct(10,new We(1,34)),new Ct(16,new We(1,28)),new Ct(22,new We(1,22)),new Ct(28,new We(1,16))),new ki(3,Int32Array.from([6,22]),new Ct(15,new We(1,55)),new Ct(26,new We(1,44)),new Ct(18,new We(2,17)),new Ct(22,new We(2,13))),new ki(4,Int32Array.from([6,26]),new Ct(20,new We(1,80)),new Ct(18,new We(2,32)),new Ct(26,new We(2,24)),new Ct(16,new We(4,9))),new ki(5,Int32Array.from([6,30]),new Ct(26,new We(1,108)),new Ct(24,new We(2,43)),new Ct(18,new We(2,15),new We(2,16)),new Ct(22,new We(2,11),new We(2,12))),new ki(6,Int32Array.from([6,34]),new Ct(18,new We(2,68)),new Ct(16,new We(4,27)),new Ct(24,new We(4,19)),new Ct(28,new We(4,15))),new ki(7,Int32Array.from([6,22,38]),new Ct(20,new We(2,78)),new Ct(18,new We(4,31)),new Ct(18,new We(2,14),new We(4,15)),new Ct(26,new We(4,13),new We(1,14))),new ki(8,Int32Array.from([6,24,42]),new Ct(24,new We(2,97)),new Ct(22,new We(2,38),new We(2,39)),new Ct(22,new We(4,18),new We(2,19)),new Ct(26,new We(4,14),new We(2,15))),new ki(9,Int32Array.from([6,26,46]),new Ct(30,new We(2,116)),new Ct(22,new We(3,36),new We(2,37)),new Ct(20,new We(4,16),new We(4,17)),new Ct(24,new We(4,12),new We(4,13))),new ki(10,Int32Array.from([6,28,50]),new Ct(18,new We(2,68),new We(2,69)),new Ct(26,new We(4,43),new We(1,44)),new Ct(24,new We(6,19),new We(2,20)),new Ct(28,new We(6,15),new We(2,16))),new ki(11,Int32Array.from([6,30,54]),new Ct(20,new We(4,81)),new Ct(30,new We(1,50),new We(4,51)),new Ct(28,new We(4,22),new We(4,23)),new Ct(24,new We(3,12),new We(8,13))),new ki(12,Int32Array.from([6,32,58]),new Ct(24,new We(2,92),new We(2,93)),new Ct(22,new We(6,36),new We(2,37)),new Ct(26,new We(4,20),new We(6,21)),new Ct(28,new We(7,14),new We(4,15))),new ki(13,Int32Array.from([6,34,62]),new Ct(26,new We(4,107)),new Ct(22,new We(8,37),new We(1,38)),new Ct(24,new We(8,20),new We(4,21)),new Ct(22,new We(12,11),new We(4,12))),new ki(14,Int32Array.from([6,26,46,66]),new Ct(30,new We(3,115),new We(1,116)),new Ct(24,new We(4,40),new We(5,41)),new Ct(20,new We(11,16),new We(5,17)),new Ct(24,new We(11,12),new We(5,13))),new ki(15,Int32Array.from([6,26,48,70]),new Ct(22,new We(5,87),new We(1,88)),new Ct(24,new We(5,41),new We(5,42)),new Ct(30,new We(5,24),new We(7,25)),new Ct(24,new We(11,12),new We(7,13))),new ki(16,Int32Array.from([6,26,50,74]),new Ct(24,new We(5,98),new We(1,99)),new Ct(28,new We(7,45),new We(3,46)),new Ct(24,new We(15,19),new We(2,20)),new Ct(30,new We(3,15),new We(13,16))),new ki(17,Int32Array.from([6,30,54,78]),new Ct(28,new We(1,107),new We(5,108)),new Ct(28,new We(10,46),new We(1,47)),new Ct(28,new We(1,22),new We(15,23)),new Ct(28,new We(2,14),new We(17,15))),new ki(18,Int32Array.from([6,30,56,82]),new Ct(30,new We(5,120),new We(1,121)),new Ct(26,new We(9,43),new We(4,44)),new Ct(28,new We(17,22),new We(1,23)),new Ct(28,new We(2,14),new We(19,15))),new ki(19,Int32Array.from([6,30,58,86]),new Ct(28,new We(3,113),new We(4,114)),new Ct(26,new We(3,44),new We(11,45)),new Ct(26,new We(17,21),new We(4,22)),new Ct(26,new We(9,13),new We(16,14))),new ki(20,Int32Array.from([6,34,62,90]),new Ct(28,new We(3,107),new We(5,108)),new Ct(26,new We(3,41),new We(13,42)),new Ct(30,new We(15,24),new We(5,25)),new Ct(28,new We(15,15),new We(10,16))),new ki(21,Int32Array.from([6,28,50,72,94]),new Ct(28,new We(4,116),new We(4,117)),new Ct(26,new We(17,42)),new Ct(28,new We(17,22),new We(6,23)),new Ct(30,new We(19,16),new We(6,17))),new ki(22,Int32Array.from([6,26,50,74,98]),new Ct(28,new We(2,111),new We(7,112)),new Ct(28,new We(17,46)),new Ct(30,new We(7,24),new We(16,25)),new Ct(24,new We(34,13))),new ki(23,Int32Array.from([6,30,54,78,102]),new Ct(30,new We(4,121),new We(5,122)),new Ct(28,new We(4,47),new We(14,48)),new Ct(30,new We(11,24),new We(14,25)),new Ct(30,new We(16,15),new We(14,16))),new ki(24,Int32Array.from([6,28,54,80,106]),new Ct(30,new We(6,117),new We(4,118)),new Ct(28,new We(6,45),new We(14,46)),new Ct(30,new We(11,24),new We(16,25)),new Ct(30,new We(30,16),new We(2,17))),new ki(25,Int32Array.from([6,32,58,84,110]),new Ct(26,new We(8,106),new We(4,107)),new Ct(28,new We(8,47),new We(13,48)),new Ct(30,new We(7,24),new We(22,25)),new Ct(30,new We(22,15),new We(13,16))),new ki(26,Int32Array.from([6,30,58,86,114]),new Ct(28,new We(10,114),new We(2,115)),new Ct(28,new We(19,46),new We(4,47)),new Ct(28,new We(28,22),new We(6,23)),new Ct(30,new We(33,16),new We(4,17))),new ki(27,Int32Array.from([6,34,62,90,118]),new Ct(30,new We(8,122),new We(4,123)),new Ct(28,new We(22,45),new We(3,46)),new Ct(30,new We(8,23),new We(26,24)),new Ct(30,new We(12,15),new We(28,16))),new ki(28,Int32Array.from([6,26,50,74,98,122]),new Ct(30,new We(3,117),new We(10,118)),new Ct(28,new We(3,45),new We(23,46)),new Ct(30,new We(4,24),new We(31,25)),new Ct(30,new We(11,15),new We(31,16))),new ki(29,Int32Array.from([6,30,54,78,102,126]),new Ct(30,new We(7,116),new We(7,117)),new Ct(28,new We(21,45),new We(7,46)),new Ct(30,new We(1,23),new We(37,24)),new Ct(30,new We(19,15),new We(26,16))),new ki(30,Int32Array.from([6,26,52,78,104,130]),new Ct(30,new We(5,115),new We(10,116)),new Ct(28,new We(19,47),new We(10,48)),new Ct(30,new We(15,24),new We(25,25)),new Ct(30,new We(23,15),new We(25,16))),new ki(31,Int32Array.from([6,30,56,82,108,134]),new Ct(30,new We(13,115),new We(3,116)),new Ct(28,new We(2,46),new We(29,47)),new Ct(30,new We(42,24),new We(1,25)),new Ct(30,new We(23,15),new We(28,16))),new ki(32,Int32Array.from([6,34,60,86,112,138]),new Ct(30,new We(17,115)),new Ct(28,new We(10,46),new We(23,47)),new Ct(30,new We(10,24),new We(35,25)),new Ct(30,new We(19,15),new We(35,16))),new ki(33,Int32Array.from([6,30,58,86,114,142]),new Ct(30,new We(17,115),new We(1,116)),new Ct(28,new We(14,46),new We(21,47)),new Ct(30,new We(29,24),new We(19,25)),new Ct(30,new We(11,15),new We(46,16))),new ki(34,Int32Array.from([6,34,62,90,118,146]),new Ct(30,new We(13,115),new We(6,116)),new Ct(28,new We(14,46),new We(23,47)),new Ct(30,new We(44,24),new We(7,25)),new Ct(30,new We(59,16),new We(1,17))),new ki(35,Int32Array.from([6,30,54,78,102,126,150]),new Ct(30,new We(12,121),new We(7,122)),new Ct(28,new We(12,47),new We(26,48)),new Ct(30,new We(39,24),new We(14,25)),new Ct(30,new We(22,15),new We(41,16))),new ki(36,Int32Array.from([6,24,50,76,102,128,154]),new Ct(30,new We(6,121),new We(14,122)),new Ct(28,new We(6,47),new We(34,48)),new Ct(30,new We(46,24),new We(10,25)),new Ct(30,new We(2,15),new We(64,16))),new ki(37,Int32Array.from([6,28,54,80,106,132,158]),new Ct(30,new We(17,122),new We(4,123)),new Ct(28,new We(29,46),new We(14,47)),new Ct(30,new We(49,24),new We(10,25)),new Ct(30,new We(24,15),new We(46,16))),new ki(38,Int32Array.from([6,32,58,84,110,136,162]),new Ct(30,new We(4,122),new We(18,123)),new Ct(28,new We(13,46),new We(32,47)),new Ct(30,new We(48,24),new We(14,25)),new Ct(30,new We(42,15),new We(32,16))),new ki(39,Int32Array.from([6,26,54,82,110,138,166]),new Ct(30,new We(20,117),new We(4,118)),new Ct(28,new We(40,47),new We(7,48)),new Ct(30,new We(43,24),new We(22,25)),new Ct(30,new We(10,15),new We(67,16))),new ki(40,Int32Array.from([6,30,58,86,114,142,170]),new Ct(30,new We(19,118),new We(6,119)),new Ct(28,new We(18,47),new We(31,48)),new Ct(30,new We(34,24),new We(34,25)),new Ct(30,new We(20,15),new We(61,16)))];var dr;(function(Te){Te[Te.DATA_MASK_000=0]="DATA_MASK_000",Te[Te.DATA_MASK_001=1]="DATA_MASK_001",Te[Te.DATA_MASK_010=2]="DATA_MASK_010",Te[Te.DATA_MASK_011=3]="DATA_MASK_011",Te[Te.DATA_MASK_100=4]="DATA_MASK_100",Te[Te.DATA_MASK_101=5]="DATA_MASK_101",Te[Te.DATA_MASK_110=6]="DATA_MASK_110",Te[Te.DATA_MASK_111=7]="DATA_MASK_111"})(dr||(dr={}));class jr{constructor(c,m){this.value=c,this.isMasked=m}unmaskBitMatrix(c,m){for(let v=0;v<m;v++)for(let C=0;C<m;C++)this.isMasked(v,C)&&c.flip(C,v)}}jr.values=new Map([[dr.DATA_MASK_000,new jr(dr.DATA_MASK_000,(Te,c)=>(Te+c&1)===0)],[dr.DATA_MASK_001,new jr(dr.DATA_MASK_001,(Te,c)=>(Te&1)===0)],[dr.DATA_MASK_010,new jr(dr.DATA_MASK_010,(Te,c)=>c%3===0)],[dr.DATA_MASK_011,new jr(dr.DATA_MASK_011,(Te,c)=>(Te+c)%3===0)],[dr.DATA_MASK_100,new jr(dr.DATA_MASK_100,(Te,c)=>(Math.floor(Te/2)+Math.floor(c/3)&1)===0)],[dr.DATA_MASK_101,new jr(dr.DATA_MASK_101,(Te,c)=>Te*c%6===0)],[dr.DATA_MASK_110,new jr(dr.DATA_MASK_110,(Te,c)=>Te*c%6<3)],[dr.DATA_MASK_111,new jr(dr.DATA_MASK_111,(Te,c)=>(Te+c+Te*c%3&1)===0)]]);class So{constructor(c){const m=c.getHeight();if(m<21||(m&3)!==1)throw new ce;this.bitMatrix=c}readFormatInformation(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==void 0)return this.parsedFormatInfo;let c=0;for(let I=0;I<6;I++)c=this.copyBit(I,8,c);c=this.copyBit(7,8,c),c=this.copyBit(8,8,c),c=this.copyBit(8,7,c);for(let I=5;I>=0;I--)c=this.copyBit(8,I,c);const m=this.bitMatrix.getHeight();let v=0;const C=m-7;for(let I=m-1;I>=C;I--)v=this.copyBit(8,I,v);for(let I=m-8;I<m;I++)v=this.copyBit(I,8,v);if(this.parsedFormatInfo=Zr.decodeFormatInformation(c,v),this.parsedFormatInfo!==null)return this.parsedFormatInfo;throw new ce}readVersion(){if(this.parsedVersion!==null&&this.parsedVersion!==void 0)return this.parsedVersion;const c=this.bitMatrix.getHeight(),m=Math.floor((c-17)/4);if(m<=6)return ki.getVersionForNumber(m);let v=0;const C=c-11;for(let L=5;L>=0;L--)for(let k=c-9;k>=C;k--)v=this.copyBit(k,L,v);let I=ki.decodeVersionInformation(v);if(I!==null&&I.getDimensionForVersion()===c)return this.parsedVersion=I,I;v=0;for(let L=5;L>=0;L--)for(let k=c-9;k>=C;k--)v=this.copyBit(L,k,v);if(I=ki.decodeVersionInformation(v),I!==null&&I.getDimensionForVersion()===c)return this.parsedVersion=I,I;throw new ce}copyBit(c,m,v){return(this.isMirror?this.bitMatrix.get(m,c):this.bitMatrix.get(c,m))?v<<1|1:v<<1}readCodewords(){const c=this.readFormatInformation(),m=this.readVersion(),v=jr.values.get(c.getDataMask()),C=this.bitMatrix.getHeight();v.unmaskBitMatrix(this.bitMatrix,C);const I=m.buildFunctionPattern();let L=!0;const k=new Uint8Array(m.getTotalCodewords());let j=0,J=0,pe=0;for(let Ie=C-1;Ie>0;Ie-=2){Ie===6&&Ie--;for(let Ne=0;Ne<C;Ne++){const Ye=L?C-1-Ne:Ne;for(let at=0;at<2;at++)I.get(Ie-at,Ye)||(pe++,J<<=1,this.bitMatrix.get(Ie-at,Ye)&&(J|=1),pe===8&&(k[j++]=J,pe=0,J=0))}L=!L}if(j!==m.getTotalCodewords())throw new ce;return k}remask(){if(this.parsedFormatInfo===null)return;const c=jr.values[this.parsedFormatInfo.getDataMask()],m=this.bitMatrix.getHeight();c.unmaskBitMatrix(this.bitMatrix,m)}setMirror(c){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=c}mirror(){const c=this.bitMatrix;for(let m=0,v=c.getWidth();m<v;m++)for(let C=m+1,I=c.getHeight();C<I;C++)c.get(m,C)!==c.get(C,m)&&(c.flip(C,m),c.flip(m,C))}}class gr{constructor(c,m){this.numDataCodewords=c,this.codewords=m}static getDataBlocks(c,m,v){if(c.length!==m.getTotalCodewords())throw new se;const C=m.getECBlocksForLevel(v);let I=0;const L=C.getECBlocks();for(const at of L)I+=at.getCount();const k=new Array(I);let j=0;for(const at of L)for(let ut=0;ut<at.getCount();ut++){const Et=at.getDataCodewords(),Rt=C.getECCodewordsPerBlock()+Et;k[j++]=new gr(Et,new Uint8Array(Rt))}const J=k[0].codewords.length;let pe=k.length-1;for(;pe>=0&&k[pe].codewords.length!==J;)pe--;pe++;const Ie=J-C.getECCodewordsPerBlock();let Ne=0;for(let at=0;at<Ie;at++)for(let ut=0;ut<j;ut++)k[ut].codewords[at]=c[Ne++];for(let at=pe;at<j;at++)k[at].codewords[Ie]=c[Ne++];const Ye=k[0].codewords.length;for(let at=Ie;at<Ye;at++)for(let ut=0;ut<j;ut++){const Et=ut<pe?at:at+1;k[ut].codewords[Et]=c[Ne++]}return k}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}var _o;(function(Te){Te[Te.TERMINATOR=0]="TERMINATOR",Te[Te.NUMERIC=1]="NUMERIC",Te[Te.ALPHANUMERIC=2]="ALPHANUMERIC",Te[Te.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",Te[Te.BYTE=4]="BYTE",Te[Te.ECI=5]="ECI",Te[Te.KANJI=6]="KANJI",Te[Te.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",Te[Te.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",Te[Te.HANZI=9]="HANZI"})(_o||(_o={}));class Wi{constructor(c,m,v,C){this.value=c,this.stringValue=m,this.characterCountBitsForVersions=v,this.bits=C,Wi.FOR_BITS.set(C,this),Wi.FOR_VALUE.set(c,this)}static forBits(c){const m=Wi.FOR_BITS.get(c);if(m===void 0)throw new se;return m}getCharacterCountBits(c){const m=c.getVersionNumber();let v;return m<=9?v=0:m<=26?v=1:v=2,this.characterCountBitsForVersions[v]}getValue(){return this.value}getBits(){return this.bits}equals(c){if(!(c instanceof Wi))return!1;const m=c;return this.value===m.value}toString(){return this.stringValue}}Wi.FOR_BITS=new Map,Wi.FOR_VALUE=new Map,Wi.TERMINATOR=new Wi(_o.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),Wi.NUMERIC=new Wi(_o.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),Wi.ALPHANUMERIC=new Wi(_o.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),Wi.STRUCTURED_APPEND=new Wi(_o.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),Wi.BYTE=new Wi(_o.BYTE,"BYTE",Int32Array.from([8,16,16]),4),Wi.ECI=new Wi(_o.ECI,"ECI",Int32Array.from([0,0,0]),7),Wi.KANJI=new Wi(_o.KANJI,"KANJI",Int32Array.from([8,10,12]),8),Wi.FNC1_FIRST_POSITION=new Wi(_o.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),Wi.FNC1_SECOND_POSITION=new Wi(_o.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),Wi.HANZI=new Wi(_o.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class lr{static decode(c,m,v,C){const I=new Dn(c);let L=new Ot;const k=new Array;let j=-1,J=-1;try{let pe=null,Ie=!1,Ne;do{if(I.available()<4)Ne=Wi.TERMINATOR;else{const Ye=I.readBits(4);Ne=Wi.forBits(Ye)}switch(Ne){case Wi.TERMINATOR:break;case Wi.FNC1_FIRST_POSITION:case Wi.FNC1_SECOND_POSITION:Ie=!0;break;case Wi.STRUCTURED_APPEND:if(I.available()<16)throw new ce;j=I.readBits(8),J=I.readBits(8);break;case Wi.ECI:const Ye=lr.parseECIValue(I);if(pe=He.getCharacterSetECIByValue(Ye),pe===null)throw new ce;break;case Wi.HANZI:const at=I.readBits(4),ut=I.readBits(Ne.getCharacterCountBits(m));at===lr.GB2312_SUBSET&&lr.decodeHanziSegment(I,L,ut);break;default:const Et=I.readBits(Ne.getCharacterCountBits(m));switch(Ne){case Wi.NUMERIC:lr.decodeNumericSegment(I,L,Et);break;case Wi.ALPHANUMERIC:lr.decodeAlphanumericSegment(I,L,Et,Ie);break;case Wi.BYTE:lr.decodeByteSegment(I,L,Et,pe,k,C);break;case Wi.KANJI:lr.decodeKanjiSegment(I,L,Et);break;default:throw new ce}break}}while(Ne!==Wi.TERMINATOR)}catch{throw new ce}return new zi(c,L.toString(),k.length===0?null:k,v===null?null:v.toString(),j,J)}static decodeHanziSegment(c,m,v){if(v*13>c.available())throw new ce;const C=new Uint8Array(2*v);let I=0;for(;v>0;){const L=c.readBits(13);let k=L/96<<8&4294967295|L%96;k<959?k+=41377:k+=42657,C[I]=k>>8&255,C[I+1]=k&255,I+=2,v--}try{m.append(vt.decode(C,xt.GB2312))}catch(L){throw new ce(L)}}static decodeKanjiSegment(c,m,v){if(v*13>c.available())throw new ce;const C=new Uint8Array(2*v);let I=0;for(;v>0;){const L=c.readBits(13);let k=L/192<<8&4294967295|L%192;k<7936?k+=33088:k+=49472,C[I]=k>>8,C[I+1]=k,I+=2,v--}try{m.append(vt.decode(C,xt.SHIFT_JIS))}catch(L){throw new ce(L)}}static decodeByteSegment(c,m,v,C,I,L){if(8*v>c.available())throw new ce;const k=new Uint8Array(v);for(let J=0;J<v;J++)k[J]=c.readBits(8);let j;C===null?j=xt.guessEncoding(k,L):j=C.getName();try{m.append(vt.decode(k,j))}catch(J){throw new ce(J)}I.push(k)}static toAlphaNumericChar(c){if(c>=lr.ALPHANUMERIC_CHARS.length)throw new ce;return lr.ALPHANUMERIC_CHARS[c]}static decodeAlphanumericSegment(c,m,v,C){const I=m.length();for(;v>1;){if(c.available()<11)throw new ce;const L=c.readBits(11);m.append(lr.toAlphaNumericChar(Math.floor(L/45))),m.append(lr.toAlphaNumericChar(L%45)),v-=2}if(v===1){if(c.available()<6)throw new ce;m.append(lr.toAlphaNumericChar(c.readBits(6)))}if(C)for(let L=I;L<m.length();L++)m.charAt(L)==="%"&&(L<m.length()-1&&m.charAt(L+1)==="%"?m.deleteCharAt(L+1):m.setCharAt(L,String.fromCharCode(29)))}static decodeNumericSegment(c,m,v){for(;v>=3;){if(c.available()<10)throw new ce;const C=c.readBits(10);if(C>=1e3)throw new ce;m.append(lr.toAlphaNumericChar(Math.floor(C/100))),m.append(lr.toAlphaNumericChar(Math.floor(C/10)%10)),m.append(lr.toAlphaNumericChar(C%10)),v-=3}if(v===2){if(c.available()<7)throw new ce;const C=c.readBits(7);if(C>=100)throw new ce;m.append(lr.toAlphaNumericChar(Math.floor(C/10))),m.append(lr.toAlphaNumericChar(C%10))}else if(v===1){if(c.available()<4)throw new ce;const C=c.readBits(4);if(C>=10)throw new ce;m.append(lr.toAlphaNumericChar(C))}}static parseECIValue(c){const m=c.readBits(8);if(!(m&128))return m&127;if((m&192)===128){const v=c.readBits(8);return(m&63)<<8&4294967295|v}if((m&224)===192){const v=c.readBits(16);return(m&31)<<16&4294967295|v}throw new ce}}lr.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",lr.GB2312_SUBSET=1;class Vs{constructor(c){this.mirrored=c}isMirrored(){return this.mirrored}applyMirroredCorrection(c){if(!this.mirrored||c===null||c.length<3)return;const m=c[0];c[0]=c[2],c[2]=m}}class ks{constructor(){this.rsDecoder=new Hi(fi.QR_CODE_FIELD_256)}decodeBooleanArray(c,m){return this.decodeBitMatrix(Ui.parseFromBooleanArray(c),m)}decodeBitMatrix(c,m){const v=new So(c);let C=null;try{return this.decodeBitMatrixParser(v,m)}catch(I){C=I}try{v.remask(),v.setMirror(!0),v.readVersion(),v.readFormatInformation(),v.mirror();const I=this.decodeBitMatrixParser(v,m);return I.setOther(new Vs(!0)),I}catch(I){throw C!==null?C:I}}decodeBitMatrixParser(c,m){const v=c.readVersion(),C=c.readFormatInformation().getErrorCorrectionLevel(),I=c.readCodewords(),L=gr.getDataBlocks(I,v,C);let k=0;for(const pe of L)k+=pe.getNumDataCodewords();const j=new Uint8Array(k);let J=0;for(const pe of L){const Ie=pe.getCodewords(),Ne=pe.getNumDataCodewords();this.correctErrors(Ie,Ne);for(let Ye=0;Ye<Ne;Ye++)j[J++]=Ie[Ye]}return lr.decode(j,v,C,m)}correctErrors(c,m){const v=new Int32Array(c);try{this.rsDecoder.decode(v,c.length-m)}catch{throw new Ce}for(let C=0;C<m;C++)c[C]=v[C]}}class pa extends wi{constructor(c,m,v){super(c,m),this.estimatedModuleSize=v}aboutEquals(c,m,v){if(Math.abs(m-this.getY())<=c&&Math.abs(v-this.getX())<=c){const C=Math.abs(c-this.estimatedModuleSize);return C<=1||C<=this.estimatedModuleSize}return!1}combineEstimate(c,m,v){const C=(this.getX()+m)/2,I=(this.getY()+c)/2,L=(this.estimatedModuleSize+v)/2;return new pa(C,I,L)}}class Bs{constructor(c,m,v,C,I,L,k){this.image=c,this.startX=m,this.startY=v,this.width=C,this.height=I,this.moduleSize=L,this.resultPointCallback=k,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const c=this.startX,m=this.height,v=this.width,C=c+v,I=this.startY+m/2,L=new Int32Array(3),k=this.image;for(let j=0;j<m;j++){const J=I+(j&1?-Math.floor((j+1)/2):Math.floor((j+1)/2));L[0]=0,L[1]=0,L[2]=0;let pe=c;for(;pe<C&&!k.get(pe,J);)pe++;let Ie=0;for(;pe<C;){if(k.get(pe,J))if(Ie===1)L[1]++;else if(Ie===2){if(this.foundPatternCross(L)){const Ne=this.handlePossibleCenter(L,J,pe);if(Ne!==null)return Ne}L[0]=L[2],L[1]=1,L[2]=0,Ie=1}else L[++Ie]++;else Ie===1&&Ie++,L[Ie]++;pe++}if(this.foundPatternCross(L)){const Ne=this.handlePossibleCenter(L,J,C);if(Ne!==null)return Ne}}if(this.possibleCenters.length!==0)return this.possibleCenters[0];throw new Mt}static centerFromEnd(c,m){return m-c[2]-c[1]/2}foundPatternCross(c){const m=this.moduleSize,v=m/2;for(let C=0;C<3;C++)if(Math.abs(m-c[C])>=v)return!1;return!0}crossCheckVertical(c,m,v,C){const I=this.image,L=I.getHeight(),k=this.crossCheckStateCount;k[0]=0,k[1]=0,k[2]=0;let j=c;for(;j>=0&&I.get(m,j)&&k[1]<=v;)k[1]++,j--;if(j<0||k[1]>v)return NaN;for(;j>=0&&!I.get(m,j)&&k[0]<=v;)k[0]++,j--;if(k[0]>v)return NaN;for(j=c+1;j<L&&I.get(m,j)&&k[1]<=v;)k[1]++,j++;if(j===L||k[1]>v)return NaN;for(;j<L&&!I.get(m,j)&&k[2]<=v;)k[2]++,j++;if(k[2]>v)return NaN;const J=k[0]+k[1]+k[2];return 5*Math.abs(J-C)>=2*C?NaN:this.foundPatternCross(k)?Bs.centerFromEnd(k,j):NaN}handlePossibleCenter(c,m,v){const C=c[0]+c[1]+c[2],I=Bs.centerFromEnd(c,v),L=this.crossCheckVertical(m,I,2*c[1],C);if(!isNaN(L)){const k=(c[0]+c[1]+c[2])/3;for(const J of this.possibleCenters)if(J.aboutEquals(k,L,I))return J.combineEstimate(L,I,k);const j=new pa(I,L,k);this.possibleCenters.push(j),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(j)}return null}}class Us extends wi{constructor(c,m,v,C){super(c,m),this.estimatedModuleSize=v,this.count=C,C===void 0&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(c,m,v){if(Math.abs(m-this.getY())<=c&&Math.abs(v-this.getX())<=c){const C=Math.abs(c-this.estimatedModuleSize);return C<=1||C<=this.estimatedModuleSize}return!1}combineEstimate(c,m,v){const C=this.count+1,I=(this.count*this.getX()+m)/C,L=(this.count*this.getY()+c)/C,k=(this.count*this.estimatedModuleSize+v)/C;return new Us(I,L,k,C)}}class ms{constructor(c){this.bottomLeft=c[0],this.topLeft=c[1],this.topRight=c[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class Bi{constructor(c,m){this.image=c,this.resultPointCallback=m,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=m}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(c){const m=c!=null&&c.get(fe.TRY_HARDER)!==void 0,v=c!=null&&c.get(fe.PURE_BARCODE)!==void 0,C=this.image,I=C.getHeight(),L=C.getWidth();let k=Math.floor(3*I/(4*Bi.MAX_MODULES));(k<Bi.MIN_SKIP||m)&&(k=Bi.MIN_SKIP);let j=!1;const J=new Int32Array(5);for(let Ie=k-1;Ie<I&&!j;Ie+=k){J[0]=0,J[1]=0,J[2]=0,J[3]=0,J[4]=0;let Ne=0;for(let Ye=0;Ye<L;Ye++)if(C.get(Ye,Ie))(Ne&1)===1&&Ne++,J[Ne]++;else if(Ne&1)J[Ne]++;else if(Ne===4)if(Bi.foundPatternCross(J)){if(this.handlePossibleCenter(J,Ie,Ye,v)===!0)if(k=2,this.hasSkipped===!0)j=this.haveMultiplyConfirmedCenters();else{const ut=this.findRowSkip();ut>J[2]&&(Ie+=ut-J[2]-k,Ye=L-1)}else{J[0]=J[2],J[1]=J[3],J[2]=J[4],J[3]=1,J[4]=0,Ne=3;continue}Ne=0,J[0]=0,J[1]=0,J[2]=0,J[3]=0,J[4]=0}else J[0]=J[2],J[1]=J[3],J[2]=J[4],J[3]=1,J[4]=0,Ne=3;else J[++Ne]++;Bi.foundPatternCross(J)&&this.handlePossibleCenter(J,Ie,L,v)===!0&&(k=J[0],this.hasSkipped&&(j=this.haveMultiplyConfirmedCenters()))}const pe=this.selectBestPatterns();return wi.orderBestPatterns(pe),new ms(pe)}static centerFromEnd(c,m){return m-c[4]-c[3]-c[2]/2}static foundPatternCross(c){let m=0;for(let I=0;I<5;I++){const L=c[I];if(L===0)return!1;m+=L}if(m<7)return!1;const v=m/7,C=v/2;return Math.abs(v-c[0])<C&&Math.abs(v-c[1])<C&&Math.abs(3*v-c[2])<3*C&&Math.abs(v-c[3])<C&&Math.abs(v-c[4])<C}getCrossCheckStateCount(){const c=this.crossCheckStateCount;return c[0]=0,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c}crossCheckDiagonal(c,m,v,C){const I=this.getCrossCheckStateCount();let L=0;const k=this.image;for(;c>=L&&m>=L&&k.get(m-L,c-L);)I[2]++,L++;if(c<L||m<L)return!1;for(;c>=L&&m>=L&&!k.get(m-L,c-L)&&I[1]<=v;)I[1]++,L++;if(c<L||m<L||I[1]>v)return!1;for(;c>=L&&m>=L&&k.get(m-L,c-L)&&I[0]<=v;)I[0]++,L++;if(I[0]>v)return!1;const j=k.getHeight(),J=k.getWidth();for(L=1;c+L<j&&m+L<J&&k.get(m+L,c+L);)I[2]++,L++;if(c+L>=j||m+L>=J)return!1;for(;c+L<j&&m+L<J&&!k.get(m+L,c+L)&&I[3]<v;)I[3]++,L++;if(c+L>=j||m+L>=J||I[3]>=v)return!1;for(;c+L<j&&m+L<J&&k.get(m+L,c+L)&&I[4]<v;)I[4]++,L++;if(I[4]>=v)return!1;const pe=I[0]+I[1]+I[2]+I[3]+I[4];return Math.abs(pe-C)<2*C&&Bi.foundPatternCross(I)}crossCheckVertical(c,m,v,C){const I=this.image,L=I.getHeight(),k=this.getCrossCheckStateCount();let j=c;for(;j>=0&&I.get(m,j);)k[2]++,j--;if(j<0)return NaN;for(;j>=0&&!I.get(m,j)&&k[1]<=v;)k[1]++,j--;if(j<0||k[1]>v)return NaN;for(;j>=0&&I.get(m,j)&&k[0]<=v;)k[0]++,j--;if(k[0]>v)return NaN;for(j=c+1;j<L&&I.get(m,j);)k[2]++,j++;if(j===L)return NaN;for(;j<L&&!I.get(m,j)&&k[3]<v;)k[3]++,j++;if(j===L||k[3]>=v)return NaN;for(;j<L&&I.get(m,j)&&k[4]<v;)k[4]++,j++;if(k[4]>=v)return NaN;const J=k[0]+k[1]+k[2]+k[3]+k[4];return 5*Math.abs(J-C)>=2*C?NaN:Bi.foundPatternCross(k)?Bi.centerFromEnd(k,j):NaN}crossCheckHorizontal(c,m,v,C){const I=this.image,L=I.getWidth(),k=this.getCrossCheckStateCount();let j=c;for(;j>=0&&I.get(j,m);)k[2]++,j--;if(j<0)return NaN;for(;j>=0&&!I.get(j,m)&&k[1]<=v;)k[1]++,j--;if(j<0||k[1]>v)return NaN;for(;j>=0&&I.get(j,m)&&k[0]<=v;)k[0]++,j--;if(k[0]>v)return NaN;for(j=c+1;j<L&&I.get(j,m);)k[2]++,j++;if(j===L)return NaN;for(;j<L&&!I.get(j,m)&&k[3]<v;)k[3]++,j++;if(j===L||k[3]>=v)return NaN;for(;j<L&&I.get(j,m)&&k[4]<v;)k[4]++,j++;if(k[4]>=v)return NaN;const J=k[0]+k[1]+k[2]+k[3]+k[4];return 5*Math.abs(J-C)>=C?NaN:Bi.foundPatternCross(k)?Bi.centerFromEnd(k,j):NaN}handlePossibleCenter(c,m,v,C){const I=c[0]+c[1]+c[2]+c[3]+c[4];let L=Bi.centerFromEnd(c,v),k=this.crossCheckVertical(m,Math.floor(L),c[2],I);if(!isNaN(k)&&(L=this.crossCheckHorizontal(Math.floor(L),Math.floor(k),c[2],I),!isNaN(L)&&(!C||this.crossCheckDiagonal(Math.floor(k),Math.floor(L),c[2],I)))){const j=I/7;let J=!1;const pe=this.possibleCenters;for(let Ie=0,Ne=pe.length;Ie<Ne;Ie++){const Ye=pe[Ie];if(Ye.aboutEquals(j,k,L)){pe[Ie]=Ye.combineEstimate(k,L,j),J=!0;break}}if(!J){const Ie=new Us(L,k,j);pe.push(Ie),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(Ie)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let m=null;for(const v of this.possibleCenters)if(v.getCount()>=Bi.CENTER_QUORUM)if(m==null)m=v;else return this.hasSkipped=!0,Math.floor((Math.abs(m.getX()-v.getX())-Math.abs(m.getY()-v.getY()))/2);return 0}haveMultiplyConfirmedCenters(){let c=0,m=0;const v=this.possibleCenters.length;for(const L of this.possibleCenters)L.getCount()>=Bi.CENTER_QUORUM&&(c++,m+=L.getEstimatedModuleSize());if(c<3)return!1;const C=m/v;let I=0;for(const L of this.possibleCenters)I+=Math.abs(L.getEstimatedModuleSize()-C);return I<=.05*m}selectBestPatterns(){const c=this.possibleCenters.length;if(c<3)throw new Mt;const m=this.possibleCenters;let v;if(c>3){let C=0,I=0;for(const j of this.possibleCenters){const J=j.getEstimatedModuleSize();C+=J,I+=J*J}v=C/c;let L=Math.sqrt(I/c-v*v);m.sort((j,J)=>{const pe=Math.abs(J.getEstimatedModuleSize()-v),Ie=Math.abs(j.getEstimatedModuleSize()-v);return pe<Ie?-1:pe>Ie?1:0});const k=Math.max(.2*v,L);for(let j=0;j<m.length&&m.length>3;j++){const J=m[j];Math.abs(J.getEstimatedModuleSize()-v)>k&&(m.splice(j,1),j--)}}if(m.length>3){let C=0;for(const I of m)C+=I.getEstimatedModuleSize();v=C/m.length,m.sort((I,L)=>{if(L.getCount()===I.getCount()){const k=Math.abs(L.getEstimatedModuleSize()-v),j=Math.abs(I.getEstimatedModuleSize()-v);return k<j?1:k>j?-1:0}else return L.getCount()-I.getCount()}),m.splice(3)}return[m[0],m[1],m[2]]}}Bi.CENTER_QUORUM=2,Bi.MIN_SKIP=3,Bi.MAX_MODULES=57;class Zo{constructor(c){this.image=c}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(c){this.resultPointCallback=c==null?null:c.get(fe.NEED_RESULT_POINT_CALLBACK);const v=new Bi(this.image,this.resultPointCallback).find(c);return this.processFinderPatternInfo(v)}processFinderPatternInfo(c){const m=c.getTopLeft(),v=c.getTopRight(),C=c.getBottomLeft(),I=this.calculateModuleSize(m,v,C);if(I<1)throw new Mt("No pattern found in proccess finder.");const L=Zo.computeDimension(m,v,C,I),k=ki.getProvisionalVersionForDimension(L),j=k.getDimensionForVersion()-7;let J=null;if(k.getAlignmentPatternCenters().length>0){const Ye=v.getX()-m.getX()+C.getX(),at=v.getY()-m.getY()+C.getY(),ut=1-3/j,Et=Math.floor(m.getX()+ut*(Ye-m.getX())),Rt=Math.floor(m.getY()+ut*(at-m.getY()));for(let mi=4;mi<=16;mi<<=1)try{J=this.findAlignmentInRegion(I,Et,Rt,mi);break}catch(gi){if(!(gi instanceof Mt))throw gi}}const pe=Zo.createTransform(m,v,C,J,L),Ie=Zo.sampleGrid(this.image,pe,L);let Ne;return J===null?Ne=[C,m,v]:Ne=[C,m,v,J],new on(Ie,Ne)}static createTransform(c,m,v,C,I){const L=I-3.5;let k,j,J,pe;return C!==null?(k=C.getX(),j=C.getY(),J=L-3,pe=J):(k=m.getX()-c.getX()+v.getX(),j=m.getY()-c.getY()+v.getY(),J=L,pe=L),Pr.quadrilateralToQuadrilateral(3.5,3.5,L,3.5,J,pe,3.5,L,c.getX(),c.getY(),m.getX(),m.getY(),k,j,v.getX(),v.getY())}static sampleGrid(c,m,v){return ao.getInstance().sampleGridWithTransform(c,v,v,m)}static computeDimension(c,m,v,C){const I=ti.round(wi.distance(c,m)/C),L=ti.round(wi.distance(c,v)/C);let k=Math.floor((I+L)/2)+7;switch(k&3){case 0:k++;break;case 2:k--;break;case 3:throw new Mt("Dimensions could be not found.")}return k}calculateModuleSize(c,m,v){return(this.calculateModuleSizeOneWay(c,m)+this.calculateModuleSizeOneWay(c,v))/2}calculateModuleSizeOneWay(c,m){const v=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(c.getX()),Math.floor(c.getY()),Math.floor(m.getX()),Math.floor(m.getY())),C=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(m.getX()),Math.floor(m.getY()),Math.floor(c.getX()),Math.floor(c.getY()));return isNaN(v)?C/7:isNaN(C)?v/7:(v+C)/14}sizeOfBlackWhiteBlackRunBothWays(c,m,v,C){let I=this.sizeOfBlackWhiteBlackRun(c,m,v,C),L=1,k=c-(v-c);k<0?(L=c/(c-k),k=0):k>=this.image.getWidth()&&(L=(this.image.getWidth()-1-c)/(k-c),k=this.image.getWidth()-1);let j=Math.floor(m-(C-m)*L);return L=1,j<0?(L=m/(m-j),j=0):j>=this.image.getHeight()&&(L=(this.image.getHeight()-1-m)/(j-m),j=this.image.getHeight()-1),k=Math.floor(c+(k-c)*L),I+=this.sizeOfBlackWhiteBlackRun(c,m,k,j),I-1}sizeOfBlackWhiteBlackRun(c,m,v,C){const I=Math.abs(C-m)>Math.abs(v-c);if(I){let Ye=c;c=m,m=Ye,Ye=v,v=C,C=Ye}const L=Math.abs(v-c),k=Math.abs(C-m);let j=-L/2;const J=c<v?1:-1,pe=m<C?1:-1;let Ie=0;const Ne=v+J;for(let Ye=c,at=m;Ye!==Ne;Ye+=J){const ut=I?at:Ye,Et=I?Ye:at;if(Ie===1===this.image.get(ut,Et)){if(Ie===2)return ti.distance(Ye,at,c,m);Ie++}if(j+=k,j>0){if(at===C)break;at+=pe,j-=L}}return Ie===2?ti.distance(v+J,C,c,m):NaN}findAlignmentInRegion(c,m,v,C){const I=Math.floor(C*c),L=Math.max(0,m-I),k=Math.min(this.image.getWidth()-1,m+I);if(k-L<c*3)throw new Mt("Alignment top exceeds estimated module size.");const j=Math.max(0,v-I),J=Math.min(this.image.getHeight()-1,v+I);if(J-j<c*3)throw new Mt("Alignment bottom exceeds estimated module size.");return new Bs(this.image,L,j,k-L,J-j,c,this.resultPointCallback).find()}}class Xo{constructor(){this.decoder=new ks}getDecoder(){return this.decoder}decode(c,m){let v,C;if(m!=null&&m.get(fe.PURE_BARCODE)!==void 0){const j=Xo.extractPureBits(c.getBlackMatrix());v=this.decoder.decodeBitMatrix(j,m),C=Xo.NO_POINTS}else{const j=new Zo(c.getBlackMatrix()).detect(m);v=this.decoder.decodeBitMatrix(j.getBits(),m),C=j.getPoints()}v.getOther()instanceof Vs&&v.getOther().applyMirroredCorrection(C);const I=new fn(v.getText(),v.getRawBytes(),void 0,C,Ri.QR_CODE,void 0),L=v.getByteSegments();L!==null&&I.putMetadata(si.BYTE_SEGMENTS,L);const k=v.getECLevel();return k!==null&&I.putMetadata(si.ERROR_CORRECTION_LEVEL,k),v.hasStructuredAppend()&&(I.putMetadata(si.STRUCTURED_APPEND_SEQUENCE,v.getStructuredAppendSequenceNumber()),I.putMetadata(si.STRUCTURED_APPEND_PARITY,v.getStructuredAppendParity())),I}reset(){}static extractPureBits(c){const m=c.getTopLeftOnBit(),v=c.getBottomRightOnBit();if(m===null||v===null)throw new Mt;const C=this.moduleSize(m,c);let I=m[1],L=v[1],k=m[0],j=v[0];if(k>=j||I>=L)throw new Mt;if(L-I!==j-k&&(j=k+(L-I),j>=c.getWidth()))throw new Mt;const J=Math.round((j-k+1)/C),pe=Math.round((L-I+1)/C);if(J<=0||pe<=0)throw new Mt;if(pe!==J)throw new Mt;const Ie=Math.floor(C/2);I+=Ie,k+=Ie;const Ne=k+Math.floor((J-1)*C)-j;if(Ne>0){if(Ne>Ie)throw new Mt;k-=Ne}const Ye=I+Math.floor((pe-1)*C)-L;if(Ye>0){if(Ye>Ie)throw new Mt;I-=Ye}const at=new Ui(J,pe);for(let ut=0;ut<pe;ut++){const Et=I+Math.floor(ut*C);for(let Rt=0;Rt<J;Rt++)c.get(k+Math.floor(Rt*C),Et)&&at.set(Rt,ut)}return at}static moduleSize(c,m){const v=m.getHeight(),C=m.getWidth();let I=c[0],L=c[1],k=!0,j=0;for(;I<C&&L<v;){if(k!==m.get(I,L)){if(++j===5)break;k=!k}I++,L++}if(I===C||L===v)throw new Mt;return(I-c[0])/7}}Xo.NO_POINTS=new Array;class en{PDF417Common(){}static getBitCountSum(c){return ti.sum(c)}static toIntArray(c){if(c==null||!c.length)return en.EMPTY_INT_ARRAY;const m=new Int32Array(c.length);let v=0;for(const C of c)m[v++]=C;return m}static getCodeword(c){const m=q.binarySearch(en.SYMBOL_TABLE,c&262143);return m<0?-1:(en.CODEWORD_TABLE[m]-1)%en.NUMBER_OF_CODEWORDS}}en.NUMBER_OF_CODEWORDS=929,en.MAX_CODEWORDS_IN_BARCODE=en.NUMBER_OF_CODEWORDS-1,en.MIN_ROWS_IN_BARCODE=3,en.MAX_ROWS_IN_BARCODE=90,en.MODULES_IN_CODEWORD=17,en.MODULES_IN_STOP_PATTERN=18,en.BARS_IN_MODULE=8,en.EMPTY_INT_ARRAY=new Int32Array([]),en.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),en.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class ma{constructor(c,m){this.bits=c,this.points=m}getBits(){return this.bits}getPoints(){return this.points}}class hn{static detectMultiple(c,m,v){let C=c.getBlackMatrix(),I=hn.detect(v,C);return I.length||(C=C.clone(),C.rotate180(),I=hn.detect(v,C)),new ma(C,I)}static detect(c,m){const v=new Array;let C=0,I=0,L=!1;for(;C<m.getHeight();){const k=hn.findVertices(m,C,I);if(k[0]==null&&k[3]==null){if(!L)break;L=!1,I=0;for(const j of v)j[1]!=null&&(C=Math.trunc(Math.max(C,j[1].getY()))),j[3]!=null&&(C=Math.max(C,Math.trunc(j[3].getY())));C+=hn.ROW_STEP;continue}if(L=!0,v.push(k),!c)break;k[2]!=null?(I=Math.trunc(k[2].getX()),C=Math.trunc(k[2].getY())):(I=Math.trunc(k[4].getX()),C=Math.trunc(k[4].getY()))}return v}static findVertices(c,m,v){const C=c.getHeight(),I=c.getWidth(),L=new Array(8);return hn.copyToResult(L,hn.findRowsWithPattern(c,C,I,m,v,hn.START_PATTERN),hn.INDEXES_START_PATTERN),L[4]!=null&&(v=Math.trunc(L[4].getX()),m=Math.trunc(L[4].getY())),hn.copyToResult(L,hn.findRowsWithPattern(c,C,I,m,v,hn.STOP_PATTERN),hn.INDEXES_STOP_PATTERN),L}static copyToResult(c,m,v){for(let C=0;C<v.length;C++)c[v[C]]=m[C]}static findRowsWithPattern(c,m,v,C,I,L){const k=new Array(4);let j=!1;const J=new Int32Array(L.length);for(;C<m;C+=hn.ROW_STEP){let Ie=hn.findGuardPattern(c,I,C,v,!1,L,J);if(Ie!=null){for(;C>0;){const Ne=hn.findGuardPattern(c,I,--C,v,!1,L,J);if(Ne!=null)Ie=Ne;else{C++;break}}k[0]=new wi(Ie[0],C),k[1]=new wi(Ie[1],C),j=!0;break}}let pe=C+1;if(j){let Ie=0,Ne=Int32Array.from([Math.trunc(k[0].getX()),Math.trunc(k[1].getX())]);for(;pe<m;pe++){const Ye=hn.findGuardPattern(c,Ne[0],pe,v,!1,L,J);if(Ye!=null&&Math.abs(Ne[0]-Ye[0])<hn.MAX_PATTERN_DRIFT&&Math.abs(Ne[1]-Ye[1])<hn.MAX_PATTERN_DRIFT)Ne=Ye,Ie=0;else{if(Ie>hn.SKIPPED_ROW_COUNT_MAX)break;Ie++}}pe-=Ie+1,k[2]=new wi(Ne[0],pe),k[3]=new wi(Ne[1],pe)}return pe-C<hn.BARCODE_MIN_HEIGHT&&q.fill(k,null),k}static findGuardPattern(c,m,v,C,I,L,k){q.fillWithin(k,0,k.length,0);let j=m,J=0;for(;c.get(j,v)&&j>0&&J++<hn.MAX_PIXEL_DRIFT;)j--;let pe=j,Ie=0,Ne=L.length;for(let Ye=I;pe<C;pe++)if(c.get(pe,v)!==Ye)k[Ie]++;else{if(Ie===Ne-1){if(hn.patternMatchVariance(k,L,hn.MAX_INDIVIDUAL_VARIANCE)<hn.MAX_AVG_VARIANCE)return new Int32Array([j,pe]);j+=k[0]+k[1],K.arraycopy(k,2,k,0,Ie-1),k[Ie-1]=0,k[Ie]=0,Ie--}else Ie++;k[Ie]=1,Ye=!Ye}return Ie===Ne-1&&hn.patternMatchVariance(k,L,hn.MAX_INDIVIDUAL_VARIANCE)<hn.MAX_AVG_VARIANCE?new Int32Array([j,pe-1]):null}static patternMatchVariance(c,m,v){let C=c.length,I=0,L=0;for(let J=0;J<C;J++)I+=c[J],L+=m[J];if(I<L)return 1/0;let k=I/L;v*=k;let j=0;for(let J=0;J<C;J++){let pe=c[J],Ie=m[J]*k,Ne=pe>Ie?pe-Ie:Ie-pe;if(Ne>v)return 1/0;j+=Ne}return j/I}}hn.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),hn.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),hn.MAX_AVG_VARIANCE=.42,hn.MAX_INDIVIDUAL_VARIANCE=.8,hn.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),hn.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),hn.MAX_PIXEL_DRIFT=3,hn.MAX_PATTERN_DRIFT=5,hn.SKIPPED_ROW_COUNT_MAX=25,hn.ROW_STEP=5,hn.BARCODE_MIN_HEIGHT=10;class io{constructor(c,m){if(m.length===0)throw new se;this.field=c;let v=m.length;if(v>1&&m[0]===0){let C=1;for(;C<v&&m[C]===0;)C++;C===v?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(v-C),K.arraycopy(m,C,this.coefficients,0,this.coefficients.length))}else this.coefficients=m}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(c){return this.coefficients[this.coefficients.length-1-c]}evaluateAt(c){if(c===0)return this.getCoefficient(0);if(c===1){let C=0;for(let I of this.coefficients)C=this.field.add(C,I);return C}let m=this.coefficients[0],v=this.coefficients.length;for(let C=1;C<v;C++)m=this.field.add(this.field.multiply(c,m),this.coefficients[C]);return m}add(c){if(!this.field.equals(c.field))throw new se("ModulusPolys do not have same ModulusGF field");if(this.isZero())return c;if(c.isZero())return this;let m=this.coefficients,v=c.coefficients;if(m.length>v.length){let L=m;m=v,v=L}let C=new Int32Array(v.length),I=v.length-m.length;K.arraycopy(v,0,C,0,I);for(let L=I;L<v.length;L++)C[L]=this.field.add(m[L-I],v[L]);return new io(this.field,C)}subtract(c){if(!this.field.equals(c.field))throw new se("ModulusPolys do not have same ModulusGF field");return c.isZero()?this:this.add(c.negative())}multiply(c){return c instanceof io?this.multiplyOther(c):this.multiplyScalar(c)}multiplyOther(c){if(!this.field.equals(c.field))throw new se("ModulusPolys do not have same ModulusGF field");if(this.isZero()||c.isZero())return new io(this.field,new Int32Array([0]));let m=this.coefficients,v=m.length,C=c.coefficients,I=C.length,L=new Int32Array(v+I-1);for(let k=0;k<v;k++){let j=m[k];for(let J=0;J<I;J++)L[k+J]=this.field.add(L[k+J],this.field.multiply(j,C[J]))}return new io(this.field,L)}negative(){let c=this.coefficients.length,m=new Int32Array(c);for(let v=0;v<c;v++)m[v]=this.field.subtract(0,this.coefficients[v]);return new io(this.field,m)}multiplyScalar(c){if(c===0)return new io(this.field,new Int32Array([0]));if(c===1)return this;let m=this.coefficients.length,v=new Int32Array(m);for(let C=0;C<m;C++)v[C]=this.field.multiply(this.coefficients[C],c);return new io(this.field,v)}multiplyByMonomial(c,m){if(c<0)throw new se;if(m===0)return new io(this.field,new Int32Array([0]));let v=this.coefficients.length,C=new Int32Array(v+c);for(let I=0;I<v;I++)C[I]=this.field.multiply(this.coefficients[I],m);return new io(this.field,C)}toString(){let c=new Ot;for(let m=this.getDegree();m>=0;m--){let v=this.getCoefficient(m);v!==0&&(v<0?(c.append(" - "),v=-v):c.length()>0&&c.append(" + "),(m===0||v!==1)&&c.append(v),m!==0&&(m===1?c.append("x"):(c.append("x^"),c.append(m))))}return c.toString()}}class Qs{add(c,m){return(c+m)%this.modulus}subtract(c,m){return(this.modulus+c-m)%this.modulus}exp(c){return this.expTable[c]}log(c){if(c===0)throw new se;return this.logTable[c]}inverse(c){if(c===0)throw new Co;return this.expTable[this.modulus-this.logTable[c]-1]}multiply(c,m){return c===0||m===0?0:this.expTable[(this.logTable[c]+this.logTable[m])%(this.modulus-1)]}getSize(){return this.modulus}equals(c){return c===this}}class Ns extends Qs{constructor(c,m){super(),this.modulus=c,this.expTable=new Int32Array(c),this.logTable=new Int32Array(c);let v=1;for(let C=0;C<c;C++)this.expTable[C]=v,v=v*m%c;for(let C=0;C<c-1;C++)this.logTable[this.expTable[C]]=C;this.zero=new io(this,new Int32Array([0])),this.one=new io(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(c,m){if(c<0)throw new se;if(m===0)return this.zero;let v=new Int32Array(c+1);return v[0]=m,new io(this,v)}}Ns.PDF417_GF=new Ns(en.NUMBER_OF_CODEWORDS,3);class ga{constructor(){this.field=Ns.PDF417_GF}decode(c,m,v){let C=new io(this.field,c),I=new Int32Array(m),L=!1;for(let at=m;at>0;at--){let ut=C.evaluateAt(this.field.exp(at));I[m-at]=ut,ut!==0&&(L=!0)}if(!L)return 0;let k=this.field.getOne();if(v!=null)for(const at of v){let ut=this.field.exp(c.length-1-at),Et=new io(this.field,new Int32Array([this.field.subtract(0,ut),1]));k=k.multiply(Et)}let j=new io(this.field,I),J=this.runEuclideanAlgorithm(this.field.buildMonomial(m,1),j,m),pe=J[0],Ie=J[1],Ne=this.findErrorLocations(pe),Ye=this.findErrorMagnitudes(Ie,pe,Ne);for(let at=0;at<Ne.length;at++){let ut=c.length-1-this.field.log(Ne[at]);if(ut<0)throw Ce.getChecksumInstance();c[ut]=this.field.subtract(c[ut],Ye[at])}return Ne.length}runEuclideanAlgorithm(c,m,v){if(c.getDegree()<m.getDegree()){let Ne=c;c=m,m=Ne}let C=c,I=m,L=this.field.getZero(),k=this.field.getOne();for(;I.getDegree()>=Math.round(v/2);){let Ne=C,Ye=L;if(C=I,L=k,C.isZero())throw Ce.getChecksumInstance();I=Ne;let at=this.field.getZero(),ut=C.getCoefficient(C.getDegree()),Et=this.field.inverse(ut);for(;I.getDegree()>=C.getDegree()&&!I.isZero();){let Rt=I.getDegree()-C.getDegree(),mi=this.field.multiply(I.getCoefficient(I.getDegree()),Et);at=at.add(this.field.buildMonomial(Rt,mi)),I=I.subtract(C.multiplyByMonomial(Rt,mi))}k=at.multiply(L).subtract(Ye).negative()}let j=k.getCoefficient(0);if(j===0)throw Ce.getChecksumInstance();let J=this.field.inverse(j),pe=k.multiply(J),Ie=I.multiply(J);return[pe,Ie]}findErrorLocations(c){let m=c.getDegree(),v=new Int32Array(m),C=0;for(let I=1;I<this.field.getSize()&&C<m;I++)c.evaluateAt(I)===0&&(v[C]=this.field.inverse(I),C++);if(C!==m)throw Ce.getChecksumInstance();return v}findErrorMagnitudes(c,m,v){let C=m.getDegree(),I=new Int32Array(C);for(let J=1;J<=C;J++)I[C-J]=this.field.multiply(J,m.getCoefficient(J));let L=new io(this.field,I),k=v.length,j=new Int32Array(k);for(let J=0;J<k;J++){let pe=this.field.inverse(v[J]),Ie=this.field.subtract(0,c.evaluateAt(pe)),Ne=this.field.inverse(L.evaluateAt(pe));j[J]=this.field.multiply(Ie,Ne)}return j}}class Yo{constructor(c,m,v,C,I){c instanceof Yo?this.constructor_2(c):this.constructor_1(c,m,v,C,I)}constructor_1(c,m,v,C,I){const L=m==null||v==null,k=C==null||I==null;if(L&&k)throw new Mt;L?(m=new wi(0,C.getY()),v=new wi(0,I.getY())):k&&(C=new wi(c.getWidth()-1,m.getY()),I=new wi(c.getWidth()-1,v.getY())),this.image=c,this.topLeft=m,this.bottomLeft=v,this.topRight=C,this.bottomRight=I,this.minX=Math.trunc(Math.min(m.getX(),v.getX())),this.maxX=Math.trunc(Math.max(C.getX(),I.getX())),this.minY=Math.trunc(Math.min(m.getY(),C.getY())),this.maxY=Math.trunc(Math.max(v.getY(),I.getY()))}constructor_2(c){this.image=c.image,this.topLeft=c.getTopLeft(),this.bottomLeft=c.getBottomLeft(),this.topRight=c.getTopRight(),this.bottomRight=c.getBottomRight(),this.minX=c.getMinX(),this.maxX=c.getMaxX(),this.minY=c.getMinY(),this.maxY=c.getMaxY()}static merge(c,m){return c==null?m:m==null?c:new Yo(c.image,c.topLeft,c.bottomLeft,m.topRight,m.bottomRight)}addMissingRows(c,m,v){let C=this.topLeft,I=this.bottomLeft,L=this.topRight,k=this.bottomRight;if(c>0){let j=v?this.topLeft:this.topRight,J=Math.trunc(j.getY()-c);J<0&&(J=0);let pe=new wi(j.getX(),J);v?C=pe:L=pe}if(m>0){let j=v?this.bottomLeft:this.bottomRight,J=Math.trunc(j.getY()+m);J>=this.image.getHeight()&&(J=this.image.getHeight()-1);let pe=new wi(j.getX(),J);v?I=pe:k=pe}return new Yo(this.image,C,I,L,k)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class Yt{constructor(c,m,v,C){this.columnCount=c,this.errorCorrectionLevel=C,this.rowCountUpperPart=m,this.rowCountLowerPart=v,this.rowCount=m+v}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class Js{constructor(){this.buffer=""}static form(c,m){let v=-1;function C(L,k,j,J,pe,Ie){if(L==="%%")return"%";if(m[++v]===void 0)return;L=J?parseInt(J.substr(1)):void 0;let Ne=pe?parseInt(pe.substr(1)):void 0,Ye;switch(Ie){case"s":Ye=m[v];break;case"c":Ye=m[v][0];break;case"f":Ye=parseFloat(m[v]).toFixed(L);break;case"p":Ye=parseFloat(m[v]).toPrecision(L);break;case"e":Ye=parseFloat(m[v]).toExponential(L);break;case"x":Ye=parseInt(m[v]).toString(Ne||16);break;case"d":Ye=parseFloat(parseInt(m[v],Ne||10).toPrecision(L)).toFixed(0);break}Ye=typeof Ye=="object"?JSON.stringify(Ye):(+Ye).toString(Ne);let at=parseInt(j),ut=j&&j[0]+""=="0"?"0":" ";for(;Ye.length<at;)Ye=k!==void 0?Ye+ut:ut+Ye;return Ye}let I=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return c.replace(I,C)}format(c,...m){this.buffer+=Js.form(c,m)}toString(){return this.buffer}}class ts{constructor(c){this.boundingBox=new Yo(c),this.codewords=new Array(c.getMaxY()-c.getMinY()+1)}getCodewordNearby(c){let m=this.getCodeword(c);if(m!=null)return m;for(let v=1;v<ts.MAX_NEARBY_DISTANCE;v++){let C=this.imageRowToCodewordIndex(c)-v;if(C>=0&&(m=this.codewords[C],m!=null)||(C=this.imageRowToCodewordIndex(c)+v,C<this.codewords.length&&(m=this.codewords[C],m!=null)))return m}return null}imageRowToCodewordIndex(c){return c-this.boundingBox.getMinY()}setCodeword(c,m){this.codewords[this.imageRowToCodewordIndex(c)]=m}getCodeword(c){return this.codewords[this.imageRowToCodewordIndex(c)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const c=new Js;let m=0;for(const v of this.codewords){if(v==null){c.format("%3d:    |   %n",m++);continue}c.format("%3d: %3d|%3d%n",m++,v.getRowNumber(),v.getValue())}return c.toString()}}ts.MAX_NEARBY_DISTANCE=5;class nn{constructor(){this.values=new Map}setValue(c){c=Math.trunc(c);let m=this.values.get(c);m==null&&(m=0),m++,this.values.set(c,m)}getValue(){let c=-1,m=new Array;for(const[v,C]of this.values.entries()){const I={getKey:()=>v,getValue:()=>C};I.getValue()>c?(c=I.getValue(),m=[],m.push(I.getKey())):I.getValue()===c&&m.push(I.getKey())}return en.toIntArray(m)}getConfidence(c){return this.values.get(c)}}class ho extends ts{constructor(c,m){super(c),this._isLeft=m}setRowNumbers(){for(let c of this.getCodewords())c!=null&&c.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(c){let m=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(m,c);let v=this.getBoundingBox(),C=this._isLeft?v.getTopLeft():v.getTopRight(),I=this._isLeft?v.getBottomLeft():v.getBottomRight(),L=this.imageRowToCodewordIndex(Math.trunc(C.getY())),k=this.imageRowToCodewordIndex(Math.trunc(I.getY())),j=-1,J=1,pe=0;for(let Ie=L;Ie<k;Ie++){if(m[Ie]==null)continue;let Ne=m[Ie],Ye=Ne.getRowNumber()-j;if(Ye===0)pe++;else if(Ye===1)J=Math.max(J,pe),pe=1,j=Ne.getRowNumber();else if(Ye<0||Ne.getRowNumber()>=c.getRowCount()||Ye>Ie)m[Ie]=null;else{let at;J>2?at=(J-2)*Ye:at=Ye;let ut=at>=Ie;for(let Et=1;Et<=at&&!ut;Et++)ut=m[Ie-Et]!=null;ut?m[Ie]=null:(j=Ne.getRowNumber(),pe=1)}}}getRowHeights(){let c=this.getBarcodeMetadata();if(c==null)return null;this.adjustIncompleteIndicatorColumnRowNumbers(c);let m=new Int32Array(c.getRowCount());for(let v of this.getCodewords())if(v!=null){let C=v.getRowNumber();if(C>=m.length)continue;m[C]++}return m}adjustIncompleteIndicatorColumnRowNumbers(c){let m=this.getBoundingBox(),v=this._isLeft?m.getTopLeft():m.getTopRight(),C=this._isLeft?m.getBottomLeft():m.getBottomRight(),I=this.imageRowToCodewordIndex(Math.trunc(v.getY())),L=this.imageRowToCodewordIndex(Math.trunc(C.getY())),k=this.getCodewords(),j=-1;for(let J=I;J<L;J++){if(k[J]==null)continue;let pe=k[J];pe.setRowNumberAsRowIndicatorColumn();let Ie=pe.getRowNumber()-j;Ie===0||(Ie===1?j=pe.getRowNumber():pe.getRowNumber()>=c.getRowCount()?k[J]=null:j=pe.getRowNumber())}}getBarcodeMetadata(){let c=this.getCodewords(),m=new nn,v=new nn,C=new nn,I=new nn;for(let k of c){if(k==null)continue;k.setRowNumberAsRowIndicatorColumn();let j=k.getValue()%30,J=k.getRowNumber();switch(this._isLeft||(J+=2),J%3){case 0:v.setValue(j*3+1);break;case 1:I.setValue(j/3),C.setValue(j%3);break;case 2:m.setValue(j+1);break}}if(m.getValue().length===0||v.getValue().length===0||C.getValue().length===0||I.getValue().length===0||m.getValue()[0]<1||v.getValue()[0]+C.getValue()[0]<en.MIN_ROWS_IN_BARCODE||v.getValue()[0]+C.getValue()[0]>en.MAX_ROWS_IN_BARCODE)return null;let L=new Yt(m.getValue()[0],v.getValue()[0],C.getValue()[0],I.getValue()[0]);return this.removeIncorrectCodewords(c,L),L}removeIncorrectCodewords(c,m){for(let v=0;v<c.length;v++){let C=c[v];if(c[v]==null)continue;let I=C.getValue()%30,L=C.getRowNumber();if(L>m.getRowCount()){c[v]=null;continue}switch(this._isLeft||(L+=2),L%3){case 0:I*3+1!==m.getRowCountUpperPart()&&(c[v]=null);break;case 1:(Math.trunc(I/3)!==m.getErrorCorrectionLevel()||I%3!==m.getRowCountLowerPart())&&(c[v]=null);break;case 2:I+1!==m.getColumnCount()&&(c[v]=null);break}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+`
`+super.toString()}}class _a{constructor(c,m){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=c,this.barcodeColumnCount=c.getColumnCount(),this.boundingBox=m,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let c=en.MAX_CODEWORDS_IN_BARCODE,m;do m=c,c=this.adjustRowNumbersAndGetCount();while(c>0&&c<m);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(c){c!=null&&c.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let c=this.adjustRowNumbersByRow();if(c===0)return 0;for(let m=1;m<this.barcodeColumnCount+1;m++){let v=this.detectionResultColumns[m].getCodewords();for(let C=0;C<v.length;C++)v[C]!=null&&(v[C].hasValidRowNumber()||this.adjustRowNumbers(m,C,v))}return c}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(this.detectionResultColumns[0]==null||this.detectionResultColumns[this.barcodeColumnCount+1]==null)return;let c=this.detectionResultColumns[0].getCodewords(),m=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let v=0;v<c.length;v++)if(c[v]!=null&&m[v]!=null&&c[v].getRowNumber()===m[v].getRowNumber())for(let C=1;C<=this.barcodeColumnCount;C++){let I=this.detectionResultColumns[C].getCodewords()[v];I!=null&&(I.setRowNumber(c[v].getRowNumber()),I.hasValidRowNumber()||(this.detectionResultColumns[C].getCodewords()[v]=null))}}adjustRowNumbersFromRRI(){if(this.detectionResultColumns[this.barcodeColumnCount+1]==null)return 0;let c=0,m=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let v=0;v<m.length;v++){if(m[v]==null)continue;let C=m[v].getRowNumber(),I=0;for(let L=this.barcodeColumnCount+1;L>0&&I<this.ADJUST_ROW_NUMBER_SKIP;L--){let k=this.detectionResultColumns[L].getCodewords()[v];k!=null&&(I=_a.adjustRowNumberIfValid(C,I,k),k.hasValidRowNumber()||c++)}}return c}adjustRowNumbersFromLRI(){if(this.detectionResultColumns[0]==null)return 0;let c=0,m=this.detectionResultColumns[0].getCodewords();for(let v=0;v<m.length;v++){if(m[v]==null)continue;let C=m[v].getRowNumber(),I=0;for(let L=1;L<this.barcodeColumnCount+1&&I<this.ADJUST_ROW_NUMBER_SKIP;L++){let k=this.detectionResultColumns[L].getCodewords()[v];k!=null&&(I=_a.adjustRowNumberIfValid(C,I,k),k.hasValidRowNumber()||c++)}}return c}static adjustRowNumberIfValid(c,m,v){return v==null||v.hasValidRowNumber()||(v.isValidRowNumber(c)?(v.setRowNumber(c),m=0):++m),m}adjustRowNumbers(c,m,v){if(!this.detectionResultColumns[c-1])return;let C=v[m],I=this.detectionResultColumns[c-1].getCodewords(),L=I;this.detectionResultColumns[c+1]!=null&&(L=this.detectionResultColumns[c+1].getCodewords());let k=new Array(14);k[2]=I[m],k[3]=L[m],m>0&&(k[0]=v[m-1],k[4]=I[m-1],k[5]=L[m-1]),m>1&&(k[8]=v[m-2],k[10]=I[m-2],k[11]=L[m-2]),m<v.length-1&&(k[1]=v[m+1],k[6]=I[m+1],k[7]=L[m+1]),m<v.length-2&&(k[9]=v[m+2],k[12]=I[m+2],k[13]=L[m+2]);for(let j of k)if(_a.adjustRowNumber(C,j))return}static adjustRowNumber(c,m){return m==null?!1:m.hasValidRowNumber()&&m.getBucket()===c.getBucket()?(c.setRowNumber(m.getRowNumber()),!0):!1}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(c){this.boundingBox=c}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(c,m){this.detectionResultColumns[c]=m}getDetectionResultColumn(c){return this.detectionResultColumns[c]}toString(){let c=this.detectionResultColumns[0];c==null&&(c=this.detectionResultColumns[this.barcodeColumnCount+1]);let m=new Js;for(let v=0;v<c.getCodewords().length;v++){m.format("CW %3d:",v);for(let C=0;C<this.barcodeColumnCount+2;C++){if(this.detectionResultColumns[C]==null){m.format("    |   ");continue}let I=this.detectionResultColumns[C].getCodewords()[v];if(I==null){m.format("    |   ");continue}m.format(" %3d|%3d",I.getRowNumber(),I.getValue())}m.format("%n")}return m.toString()}}class js{constructor(c,m,v,C){this.rowNumber=js.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(c),this.endX=Math.trunc(m),this.bucket=Math.trunc(v),this.value=Math.trunc(C)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(c){return c!==js.BARCODE_ROW_UNKNOWN&&this.bucket===c%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(Math.trunc(this.value/30)*3+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(c){this.rowNumber=c}toString(){return this.rowNumber+"|"+this.value}}js.BARCODE_ROW_UNKNOWN=-1;class fo{static initialize(){for(let c=0;c<en.SYMBOL_TABLE.length;c++){let m=en.SYMBOL_TABLE[c],v=m&1;for(let C=0;C<en.BARS_IN_MODULE;C++){let I=0;for(;(m&1)===v;)I+=1,m>>=1;v=m&1,fo.RATIOS_TABLE[c]||(fo.RATIOS_TABLE[c]=new Array(en.BARS_IN_MODULE)),fo.RATIOS_TABLE[c][en.BARS_IN_MODULE-C-1]=Math.fround(I/en.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(c){let m=fo.getDecodedCodewordValue(fo.sampleBitCounts(c));return m!==-1?m:fo.getClosestDecodedValue(c)}static sampleBitCounts(c){let m=ti.sum(c),v=new Int32Array(en.BARS_IN_MODULE),C=0,I=0;for(let L=0;L<en.MODULES_IN_CODEWORD;L++){let k=m/(2*en.MODULES_IN_CODEWORD)+L*m/en.MODULES_IN_CODEWORD;I+c[C]<=k&&(I+=c[C],C++),v[C]++}return v}static getDecodedCodewordValue(c){let m=fo.getBitValue(c);return en.getCodeword(m)===-1?-1:m}static getBitValue(c){let m=0;for(let v=0;v<c.length;v++)for(let C=0;C<c[v];C++)m=m<<1|(v%2===0?1:0);return Math.trunc(m)}static getClosestDecodedValue(c){let m=ti.sum(c),v=new Array(en.BARS_IN_MODULE);if(m>1)for(let L=0;L<v.length;L++)v[L]=Math.fround(c[L]/m);let C=Ii.MAX_VALUE,I=-1;this.bSymbolTableReady||fo.initialize();for(let L=0;L<fo.RATIOS_TABLE.length;L++){let k=0,j=fo.RATIOS_TABLE[L];for(let J=0;J<en.BARS_IN_MODULE;J++){let pe=Math.fround(j[J]-v[J]);if(k+=Math.fround(pe*pe),k>=C)break}k<C&&(C=k,I=en.SYMBOL_TABLE[L])}return I}}fo.bSymbolTableReady=!1,fo.RATIOS_TABLE=new Array(en.SYMBOL_TABLE.length).map(Te=>new Array(en.BARS_IN_MODULE));class eu{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(c){this.segmentIndex=c}getFileId(){return this.fileId}setFileId(c){this.fileId=c}getOptionalData(){return this.optionalData}setOptionalData(c){this.optionalData=c}isLastSegment(){return this.lastSegment}setLastSegment(c){this.lastSegment=c}getSegmentCount(){return this.segmentCount}setSegmentCount(c){this.segmentCount=c}getSender(){return this.sender||null}setSender(c){this.sender=c}getAddressee(){return this.addressee||null}setAddressee(c){this.addressee=c}getFileName(){return this.fileName}setFileName(c){this.fileName=c}getFileSize(){return this.fileSize}setFileSize(c){this.fileSize=c}getChecksum(){return this.checksum}setChecksum(c){this.checksum=c}getTimestamp(){return this.timestamp}setTimestamp(c){this.timestamp=c}}class Ki{static parseLong(c,m=void 0){return parseInt(c,m)}}class il extends W{}il.kind="NullPointerException";class Na{writeBytes(c){this.writeBytesOffset(c,0,c.length)}writeBytesOffset(c,m,v){if(c==null)throw new il;if(m<0||m>c.length||v<0||m+v>c.length||m+v<0)throw new N;if(v===0)return;for(let C=0;C<v;C++)this.write(c[m+C])}flush(){}close(){}}class ls extends W{}class ya extends Na{constructor(c=32){if(super(),this.count=0,c<0)throw new se("Negative initial size: "+c);this.buf=new Uint8Array(c)}ensureCapacity(c){c-this.buf.length>0&&this.grow(c)}grow(c){let v=this.buf.length<<1;if(v-c<0&&(v=c),v<0){if(c<0)throw new ls;v=G.MAX_VALUE}this.buf=q.copyOfUint8Array(this.buf,v)}write(c){this.ensureCapacity(this.count+1),this.buf[this.count]=c,this.count+=1}writeBytesOffset(c,m,v){if(m<0||m>c.length||v<0||m+v-c.length>0)throw new N;this.ensureCapacity(this.count+v),K.arraycopy(c,m,this.buf,this.count,v),this.count+=v}writeTo(c){c.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return q.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(c){return c?typeof c=="string"?this.toString_string(c):this.toString_number(c):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(c){return new String(this.buf).toString()}toString_number(c){return new String(this.buf).toString()}close(){}}var An;(function(Te){Te[Te.ALPHA=0]="ALPHA",Te[Te.LOWER=1]="LOWER",Te[Te.MIXED=2]="MIXED",Te[Te.PUNCT=3]="PUNCT",Te[Te.ALPHA_SHIFT=4]="ALPHA_SHIFT",Te[Te.PUNCT_SHIFT=5]="PUNCT_SHIFT"})(An||(An={}));function Zl(){if(typeof window<"u")return window.BigInt||null;if(typeof Po<"u")return Po.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let va;function Fs(Te){if(typeof va>"u"&&(va=Zl()),va===null)throw new Error("BigInt is not supported!");return va(Te)}function Tc(){let Te=[];Te[0]=Fs(1);let c=Fs(900);Te[1]=c;for(let m=2;m<16;m++)Te[m]=Te[m-1]*c;return Te}class Nt{static decode(c,m){let v=new Ot(""),C=He.ISO8859_1;v.enableDecoding(C);let I=1,L=c[I++],k=new eu;for(;I<c[0];){switch(L){case Nt.TEXT_COMPACTION_MODE_LATCH:I=Nt.textCompaction(c,I,v);break;case Nt.BYTE_COMPACTION_MODE_LATCH:case Nt.BYTE_COMPACTION_MODE_LATCH_6:I=Nt.byteCompaction(L,c,C,I,v);break;case Nt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:v.append(c[I++]);break;case Nt.NUMERIC_COMPACTION_MODE_LATCH:I=Nt.numericCompaction(c,I,v);break;case Nt.ECI_CHARSET:He.getCharacterSetECIByValue(c[I++]);break;case Nt.ECI_GENERAL_PURPOSE:I+=2;break;case Nt.ECI_USER_DEFINED:I++;break;case Nt.BEGIN_MACRO_PDF417_CONTROL_BLOCK:I=Nt.decodeMacroBlock(c,I,k);break;case Nt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case Nt.MACRO_PDF417_TERMINATOR:throw new ce;default:I--,I=Nt.textCompaction(c,I,v);break}if(I<c.length)L=c[I++];else throw ce.getFormatInstance()}if(v.length()===0)throw ce.getFormatInstance();let j=new zi(null,v.toString(),null,m);return j.setOther(k),j}static decodeMacroBlock(c,m,v){if(m+Nt.NUMBER_OF_SEQUENCE_CODEWORDS>c[0])throw ce.getFormatInstance();let C=new Int32Array(Nt.NUMBER_OF_SEQUENCE_CODEWORDS);for(let k=0;k<Nt.NUMBER_OF_SEQUENCE_CODEWORDS;k++,m++)C[k]=c[m];v.setSegmentIndex(G.parseInt(Nt.decodeBase900toBase10(C,Nt.NUMBER_OF_SEQUENCE_CODEWORDS)));let I=new Ot;m=Nt.textCompaction(c,m,I),v.setFileId(I.toString());let L=-1;for(c[m]===Nt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(L=m+1);m<c[0];)switch(c[m]){case Nt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(m++,c[m]){case Nt.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let k=new Ot;m=Nt.textCompaction(c,m+1,k),v.setFileName(k.toString());break;case Nt.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let j=new Ot;m=Nt.textCompaction(c,m+1,j),v.setSender(j.toString());break;case Nt.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let J=new Ot;m=Nt.textCompaction(c,m+1,J),v.setAddressee(J.toString());break;case Nt.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let pe=new Ot;m=Nt.numericCompaction(c,m+1,pe),v.setSegmentCount(G.parseInt(pe.toString()));break;case Nt.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let Ie=new Ot;m=Nt.numericCompaction(c,m+1,Ie),v.setTimestamp(Ki.parseLong(Ie.toString()));break;case Nt.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let Ne=new Ot;m=Nt.numericCompaction(c,m+1,Ne),v.setChecksum(G.parseInt(Ne.toString()));break;case Nt.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let Ye=new Ot;m=Nt.numericCompaction(c,m+1,Ye),v.setFileSize(Ki.parseLong(Ye.toString()));break;default:throw ce.getFormatInstance()}break;case Nt.MACRO_PDF417_TERMINATOR:m++,v.setLastSegment(!0);break;default:throw ce.getFormatInstance()}if(L!==-1){let k=m-L;v.isLastSegment()&&k--,v.setOptionalData(q.copyOfRange(c,L,L+k))}return m}static textCompaction(c,m,v){let C=new Int32Array((c[0]-m)*2),I=new Int32Array((c[0]-m)*2),L=0,k=!1;for(;m<c[0]&&!k;){let j=c[m++];if(j<Nt.TEXT_COMPACTION_MODE_LATCH)C[L]=j/30,C[L+1]=j%30,L+=2;else switch(j){case Nt.TEXT_COMPACTION_MODE_LATCH:C[L++]=Nt.TEXT_COMPACTION_MODE_LATCH;break;case Nt.BYTE_COMPACTION_MODE_LATCH:case Nt.BYTE_COMPACTION_MODE_LATCH_6:case Nt.NUMERIC_COMPACTION_MODE_LATCH:case Nt.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case Nt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case Nt.MACRO_PDF417_TERMINATOR:m--,k=!0;break;case Nt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:C[L]=Nt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,j=c[m++],I[L]=j,L++;break}}return Nt.decodeTextCompaction(C,I,L,v),m}static decodeTextCompaction(c,m,v,C){let I=An.ALPHA,L=An.ALPHA,k=0;for(;k<v;){let j=c[k],J="";switch(I){case An.ALPHA:if(j<26)J=String.fromCharCode(65+j);else switch(j){case 26:J=" ";break;case Nt.LL:I=An.LOWER;break;case Nt.ML:I=An.MIXED;break;case Nt.PS:L=I,I=An.PUNCT_SHIFT;break;case Nt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:C.append(m[k]);break;case Nt.TEXT_COMPACTION_MODE_LATCH:I=An.ALPHA;break}break;case An.LOWER:if(j<26)J=String.fromCharCode(97+j);else switch(j){case 26:J=" ";break;case Nt.AS:L=I,I=An.ALPHA_SHIFT;break;case Nt.ML:I=An.MIXED;break;case Nt.PS:L=I,I=An.PUNCT_SHIFT;break;case Nt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:C.append(m[k]);break;case Nt.TEXT_COMPACTION_MODE_LATCH:I=An.ALPHA;break}break;case An.MIXED:if(j<Nt.PL)J=Nt.MIXED_CHARS[j];else switch(j){case Nt.PL:I=An.PUNCT;break;case 26:J=" ";break;case Nt.LL:I=An.LOWER;break;case Nt.AL:I=An.ALPHA;break;case Nt.PS:L=I,I=An.PUNCT_SHIFT;break;case Nt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:C.append(m[k]);break;case Nt.TEXT_COMPACTION_MODE_LATCH:I=An.ALPHA;break}break;case An.PUNCT:if(j<Nt.PAL)J=Nt.PUNCT_CHARS[j];else switch(j){case Nt.PAL:I=An.ALPHA;break;case Nt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:C.append(m[k]);break;case Nt.TEXT_COMPACTION_MODE_LATCH:I=An.ALPHA;break}break;case An.ALPHA_SHIFT:if(I=L,j<26)J=String.fromCharCode(65+j);else switch(j){case 26:J=" ";break;case Nt.TEXT_COMPACTION_MODE_LATCH:I=An.ALPHA;break}break;case An.PUNCT_SHIFT:if(I=L,j<Nt.PAL)J=Nt.PUNCT_CHARS[j];else switch(j){case Nt.PAL:I=An.ALPHA;break;case Nt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:C.append(m[k]);break;case Nt.TEXT_COMPACTION_MODE_LATCH:I=An.ALPHA;break}break}J!==""&&C.append(J),k++}}static byteCompaction(c,m,v,C,I){let L=new ya,k=0,j=0,J=!1;switch(c){case Nt.BYTE_COMPACTION_MODE_LATCH:let pe=new Int32Array(6),Ie=m[C++];for(;C<m[0]&&!J;)switch(pe[k++]=Ie,j=900*j+Ie,Ie=m[C++],Ie){case Nt.TEXT_COMPACTION_MODE_LATCH:case Nt.BYTE_COMPACTION_MODE_LATCH:case Nt.NUMERIC_COMPACTION_MODE_LATCH:case Nt.BYTE_COMPACTION_MODE_LATCH_6:case Nt.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case Nt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case Nt.MACRO_PDF417_TERMINATOR:C--,J=!0;break;default:if(k%5===0&&k>0){for(let Ne=0;Ne<6;++Ne)L.write(Number(Fs(j)>>Fs(8*(5-Ne))));j=0,k=0}break}C===m[0]&&Ie<Nt.TEXT_COMPACTION_MODE_LATCH&&(pe[k++]=Ie);for(let Ne=0;Ne<k;Ne++)L.write(pe[Ne]);break;case Nt.BYTE_COMPACTION_MODE_LATCH_6:for(;C<m[0]&&!J;){let Ne=m[C++];if(Ne<Nt.TEXT_COMPACTION_MODE_LATCH)k++,j=900*j+Ne;else switch(Ne){case Nt.TEXT_COMPACTION_MODE_LATCH:case Nt.BYTE_COMPACTION_MODE_LATCH:case Nt.NUMERIC_COMPACTION_MODE_LATCH:case Nt.BYTE_COMPACTION_MODE_LATCH_6:case Nt.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case Nt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case Nt.MACRO_PDF417_TERMINATOR:C--,J=!0;break}if(k%5===0&&k>0){for(let Ye=0;Ye<6;++Ye)L.write(Number(Fs(j)>>Fs(8*(5-Ye))));j=0,k=0}}break}return I.append(vt.decode(L.toByteArray(),v)),C}static numericCompaction(c,m,v){let C=0,I=!1,L=new Int32Array(Nt.MAX_NUMERIC_CODEWORDS);for(;m<c[0]&&!I;){let k=c[m++];if(m===c[0]&&(I=!0),k<Nt.TEXT_COMPACTION_MODE_LATCH)L[C]=k,C++;else switch(k){case Nt.TEXT_COMPACTION_MODE_LATCH:case Nt.BYTE_COMPACTION_MODE_LATCH:case Nt.BYTE_COMPACTION_MODE_LATCH_6:case Nt.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case Nt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case Nt.MACRO_PDF417_TERMINATOR:m--,I=!0;break}(C%Nt.MAX_NUMERIC_CODEWORDS===0||k===Nt.NUMERIC_COMPACTION_MODE_LATCH||I)&&C>0&&(v.append(Nt.decodeBase900toBase10(L,C)),C=0)}return m}static decodeBase900toBase10(c,m){let v=Fs(0);for(let I=0;I<m;I++)v+=Nt.EXP900[m-I-1]*Fs(c[I]);let C=v.toString();if(C.charAt(0)!=="1")throw new ce;return C.substring(1)}}Nt.TEXT_COMPACTION_MODE_LATCH=900,Nt.BYTE_COMPACTION_MODE_LATCH=901,Nt.NUMERIC_COMPACTION_MODE_LATCH=902,Nt.BYTE_COMPACTION_MODE_LATCH_6=924,Nt.ECI_USER_DEFINED=925,Nt.ECI_GENERAL_PURPOSE=926,Nt.ECI_CHARSET=927,Nt.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,Nt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,Nt.MACRO_PDF417_TERMINATOR=922,Nt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,Nt.MAX_NUMERIC_CODEWORDS=15,Nt.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,Nt.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,Nt.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,Nt.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,Nt.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,Nt.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,Nt.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,Nt.PL=25,Nt.LL=27,Nt.AS=27,Nt.ML=28,Nt.AL=28,Nt.PS=29,Nt.PAL=29,Nt.PUNCT_CHARS=`;<>@[\\]_\`~!\r	,:
-.$/"|*()?{}'`,Nt.MIXED_CHARS="0123456789&\r	,:#-.$/+%*=^",Nt.EXP900=Zl()?Tc():[],Nt.NUMBER_OF_SEQUENCE_CODEWORDS=2;class On{constructor(){}static decode(c,m,v,C,I,L,k){let j=new Yo(c,m,v,C,I),J=null,pe=null,Ie;for(let at=!0;;at=!1){if(m!=null&&(J=On.getRowIndicatorColumn(c,j,m,!0,L,k)),C!=null&&(pe=On.getRowIndicatorColumn(c,j,C,!1,L,k)),Ie=On.merge(J,pe),Ie==null)throw Mt.getNotFoundInstance();let ut=Ie.getBoundingBox();if(at&&ut!=null&&(ut.getMinY()<j.getMinY()||ut.getMaxY()>j.getMaxY()))j=ut;else break}Ie.setBoundingBox(j);let Ne=Ie.getBarcodeColumnCount()+1;Ie.setDetectionResultColumn(0,J),Ie.setDetectionResultColumn(Ne,pe);let Ye=J!=null;for(let at=1;at<=Ne;at++){let ut=Ye?at:Ne-at;if(Ie.getDetectionResultColumn(ut)!==void 0)continue;let Et;ut===0||ut===Ne?Et=new ho(j,ut===0):Et=new ts(j),Ie.setDetectionResultColumn(ut,Et);let Rt=-1,mi=Rt;for(let gi=j.getMinY();gi<=j.getMaxY();gi++){if(Rt=On.getStartColumn(Ie,ut,gi,Ye),Rt<0||Rt>j.getMaxX()){if(mi===-1)continue;Rt=mi}let ai=On.detectCodeword(c,j.getMinX(),j.getMaxX(),Ye,Rt,gi,L,k);ai!=null&&(Et.setCodeword(gi,ai),mi=Rt,L=Math.min(L,ai.getWidth()),k=Math.max(k,ai.getWidth()))}}return On.createDecoderResult(Ie)}static merge(c,m){if(c==null&&m==null)return null;let v=On.getBarcodeMetadata(c,m);if(v==null)return null;let C=Yo.merge(On.adjustBoundingBox(c),On.adjustBoundingBox(m));return new _a(v,C)}static adjustBoundingBox(c){if(c==null)return null;let m=c.getRowHeights();if(m==null)return null;let v=On.getMax(m),C=0;for(let k of m)if(C+=v-k,k>0)break;let I=c.getCodewords();for(let k=0;C>0&&I[k]==null;k++)C--;let L=0;for(let k=m.length-1;k>=0&&(L+=v-m[k],!(m[k]>0));k--);for(let k=I.length-1;L>0&&I[k]==null;k--)L--;return c.getBoundingBox().addMissingRows(C,L,c.isLeft())}static getMax(c){let m=-1;for(let v of c)m=Math.max(m,v);return m}static getBarcodeMetadata(c,m){let v;if(c==null||(v=c.getBarcodeMetadata())==null)return m==null?null:m.getBarcodeMetadata();let C;return m==null||(C=m.getBarcodeMetadata())==null?v:v.getColumnCount()!==C.getColumnCount()&&v.getErrorCorrectionLevel()!==C.getErrorCorrectionLevel()&&v.getRowCount()!==C.getRowCount()?null:v}static getRowIndicatorColumn(c,m,v,C,I,L){let k=new ho(m,C);for(let j=0;j<2;j++){let J=j===0?1:-1,pe=Math.trunc(Math.trunc(v.getX()));for(let Ie=Math.trunc(Math.trunc(v.getY()));Ie<=m.getMaxY()&&Ie>=m.getMinY();Ie+=J){let Ne=On.detectCodeword(c,0,c.getWidth(),C,pe,Ie,I,L);Ne!=null&&(k.setCodeword(Ie,Ne),C?pe=Ne.getStartX():pe=Ne.getEndX())}}return k}static adjustCodewordCount(c,m){let v=m[0][1],C=v.getValue(),I=c.getBarcodeColumnCount()*c.getBarcodeRowCount()-On.getNumberOfECCodeWords(c.getBarcodeECLevel());if(C.length===0){if(I<1||I>en.MAX_CODEWORDS_IN_BARCODE)throw Mt.getNotFoundInstance();v.setValue(I)}else C[0]!==I&&v.setValue(I)}static createDecoderResult(c){let m=On.createBarcodeMatrix(c);On.adjustCodewordCount(c,m);let v=new Array,C=new Int32Array(c.getBarcodeRowCount()*c.getBarcodeColumnCount()),I=[],L=new Array;for(let j=0;j<c.getBarcodeRowCount();j++)for(let J=0;J<c.getBarcodeColumnCount();J++){let pe=m[j][J+1].getValue(),Ie=j*c.getBarcodeColumnCount()+J;pe.length===0?v.push(Ie):pe.length===1?C[Ie]=pe[0]:(L.push(Ie),I.push(pe))}let k=new Array(I.length);for(let j=0;j<k.length;j++)k[j]=I[j];return On.createDecoderResultFromAmbiguousValues(c.getBarcodeECLevel(),C,en.toIntArray(v),en.toIntArray(L),k)}static createDecoderResultFromAmbiguousValues(c,m,v,C,I){let L=new Int32Array(C.length),k=100;for(;k-- >0;){for(let j=0;j<L.length;j++)m[C[j]]=I[j][L[j]];try{return On.decodeCodewords(m,c,v)}catch(j){if(!(j instanceof Ce))throw j}if(L.length===0)throw Ce.getChecksumInstance();for(let j=0;j<L.length;j++)if(L[j]<I[j].length-1){L[j]++;break}else if(L[j]=0,j===L.length-1)throw Ce.getChecksumInstance()}throw Ce.getChecksumInstance()}static createBarcodeMatrix(c){let m=Array.from({length:c.getBarcodeRowCount()},()=>new Array(c.getBarcodeColumnCount()+2));for(let C=0;C<m.length;C++)for(let I=0;I<m[C].length;I++)m[C][I]=new nn;let v=0;for(let C of c.getDetectionResultColumns()){if(C!=null){for(let I of C.getCodewords())if(I!=null){let L=I.getRowNumber();if(L>=0){if(L>=m.length)continue;m[L][v].setValue(I.getValue())}}}v++}return m}static isValidBarcodeColumn(c,m){return m>=0&&m<=c.getBarcodeColumnCount()+1}static getStartColumn(c,m,v,C){let I=C?1:-1,L=null;if(On.isValidBarcodeColumn(c,m-I)&&(L=c.getDetectionResultColumn(m-I).getCodeword(v)),L!=null)return C?L.getEndX():L.getStartX();if(L=c.getDetectionResultColumn(m).getCodewordNearby(v),L!=null)return C?L.getStartX():L.getEndX();if(On.isValidBarcodeColumn(c,m-I)&&(L=c.getDetectionResultColumn(m-I).getCodewordNearby(v)),L!=null)return C?L.getEndX():L.getStartX();let k=0;for(;On.isValidBarcodeColumn(c,m-I);){m-=I;for(let j of c.getDetectionResultColumn(m).getCodewords())if(j!=null)return(C?j.getEndX():j.getStartX())+I*k*(j.getEndX()-j.getStartX());k++}return C?c.getBoundingBox().getMinX():c.getBoundingBox().getMaxX()}static detectCodeword(c,m,v,C,I,L,k,j){I=On.adjustCodewordStartColumn(c,m,v,C,I,L);let J=On.getModuleBitCount(c,m,v,C,I,L);if(J==null)return null;let pe,Ie=ti.sum(J);if(C)pe=I+Ie;else{for(let at=0;at<J.length/2;at++){let ut=J[at];J[at]=J[J.length-1-at],J[J.length-1-at]=ut}pe=I,I=pe-Ie}if(!On.checkCodewordSkew(Ie,k,j))return null;let Ne=fo.getDecodedValue(J),Ye=en.getCodeword(Ne);return Ye===-1?null:new js(I,pe,On.getCodewordBucketNumber(Ne),Ye)}static getModuleBitCount(c,m,v,C,I,L){let k=I,j=new Int32Array(8),J=0,pe=C?1:-1,Ie=C;for(;(C?k<v:k>=m)&&J<j.length;)c.get(k,L)===Ie?(j[J]++,k+=pe):(J++,Ie=!Ie);return J===j.length||k===(C?v:m)&&J===j.length-1?j:null}static getNumberOfECCodeWords(c){return 2<<c}static adjustCodewordStartColumn(c,m,v,C,I,L){let k=I,j=C?-1:1;for(let J=0;J<2;J++){for(;(C?k>=m:k<v)&&C===c.get(k,L);){if(Math.abs(I-k)>On.CODEWORD_SKEW_SIZE)return I;k+=j}j=-j,C=!C}return k}static checkCodewordSkew(c,m,v){return m-On.CODEWORD_SKEW_SIZE<=c&&c<=v+On.CODEWORD_SKEW_SIZE}static decodeCodewords(c,m,v){if(c.length===0)throw ce.getFormatInstance();let C=1<<m+1,I=On.correctErrors(c,v,C);On.verifyCodewordCount(c,C);let L=Nt.decode(c,""+m);return L.setErrorsCorrected(I),L.setErasures(v.length),L}static correctErrors(c,m,v){if(m!=null&&m.length>v/2+On.MAX_ERRORS||v<0||v>On.MAX_EC_CODEWORDS)throw Ce.getChecksumInstance();return On.errorCorrection.decode(c,v,m)}static verifyCodewordCount(c,m){if(c.length<4)throw ce.getFormatInstance();let v=c[0];if(v>c.length)throw ce.getFormatInstance();if(v===0)if(m<c.length)c[0]=c.length-m;else throw ce.getFormatInstance()}static getBitCountForCodeword(c){let m=new Int32Array(8),v=0,C=m.length-1;for(;!((c&1)!==v&&(v=c&1,C--,C<0));)m[C]++,c>>=1;return m}static getCodewordBucketNumber(c){return c instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(c):this.getCodewordBucketNumber_number(c)}static getCodewordBucketNumber_number(c){return On.getCodewordBucketNumber(On.getBitCountForCodeword(c))}static getCodewordBucketNumber_Int32Array(c){return(c[0]-c[2]+c[4]-c[6]+9)%9}static toString(c){let m=new Js;for(let v=0;v<c.length;v++){m.format("Row %2d: ",v);for(let C=0;C<c[v].length;C++){let I=c[v][C];I.getValue().length===0?m.format("        ",null):m.format("%4d(%2d)",I.getValue()[0],I.getConfidence(I.getValue()[0]))}m.format("%n")}return m.toString()}}On.CODEWORD_SKEW_SIZE=2,On.MAX_ERRORS=3,On.MAX_EC_CODEWORDS=512,On.errorCorrection=new ga;class Xr{decode(c,m=null){let v=Xr.decode(c,m,!1);if(v==null||v.length===0||v[0]==null)throw Mt.getNotFoundInstance();return v[0]}decodeMultiple(c,m=null){try{return Xr.decode(c,m,!0)}catch(v){throw v instanceof ce||v instanceof Ce?Mt.getNotFoundInstance():v}}static decode(c,m,v){const C=new Array,I=hn.detectMultiple(c,m,v);for(const L of I.getPoints()){const k=On.decode(I.getBits(),L[4],L[5],L[6],L[7],Xr.getMinCodewordWidth(L),Xr.getMaxCodewordWidth(L)),j=new fn(k.getText(),k.getRawBytes(),void 0,L,Ri.PDF_417);j.putMetadata(si.ERROR_CORRECTION_LEVEL,k.getECLevel());const J=k.getOther();J!=null&&j.putMetadata(si.PDF417_EXTRA_METADATA,J),C.push(j)}return C.map(L=>L)}static getMaxWidth(c,m){return c==null||m==null?0:Math.trunc(Math.abs(c.getX()-m.getX()))}static getMinWidth(c,m){return c==null||m==null?G.MAX_VALUE:Math.trunc(Math.abs(c.getX()-m.getX()))}static getMaxCodewordWidth(c){return Math.floor(Math.max(Math.max(Xr.getMaxWidth(c[0],c[4]),Xr.getMaxWidth(c[6],c[2])*en.MODULES_IN_CODEWORD/en.MODULES_IN_STOP_PATTERN),Math.max(Xr.getMaxWidth(c[1],c[5]),Xr.getMaxWidth(c[7],c[3])*en.MODULES_IN_CODEWORD/en.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(c){return Math.floor(Math.min(Math.min(Xr.getMinWidth(c[0],c[4]),Xr.getMinWidth(c[6],c[2])*en.MODULES_IN_CODEWORD/en.MODULES_IN_STOP_PATTERN),Math.min(Xr.getMinWidth(c[1],c[5]),Xr.getMinWidth(c[7],c[3])*en.MODULES_IN_CODEWORD/en.MODULES_IN_STOP_PATTERN)))}reset(){}}class zs extends W{}zs.kind="ReaderException";class Xl{constructor(c,m){this.verbose=c===!0,m&&this.setHints(m)}decode(c,m){return m&&this.setHints(m),this.decodeInternal(c)}decodeWithState(c){return(this.readers===null||this.readers===void 0)&&this.setHints(null),this.decodeInternal(c)}setHints(c){this.hints=c;const m=!g(c)&&c.get(fe.TRY_HARDER)===!0,v=g(c)?null:c.get(fe.POSSIBLE_FORMATS),C=new Array;if(!g(v)){const I=v.some(L=>L===Ri.UPC_A||L===Ri.UPC_E||L===Ri.EAN_13||L===Ri.EAN_8||L===Ri.CODABAR||L===Ri.CODE_39||L===Ri.CODE_93||L===Ri.CODE_128||L===Ri.ITF||L===Ri.RSS_14||L===Ri.RSS_EXPANDED);I&&!m&&C.push(new Gt(c,this.verbose)),v.includes(Ri.QR_CODE)&&C.push(new Xo),v.includes(Ri.DATA_MATRIX)&&C.push(new _n),v.includes(Ri.AZTEC)&&C.push(new Bo),v.includes(Ri.PDF_417)&&C.push(new Xr),I&&m&&C.push(new Gt(c,this.verbose))}C.length===0&&(m||C.push(new Gt(c,this.verbose)),C.push(new Xo),C.push(new _n),C.push(new Bo),C.push(new Xr),m&&C.push(new Gt(c,this.verbose))),this.readers=C}reset(){if(this.readers!==null)for(const c of this.readers)c.reset()}decodeInternal(c){if(this.readers===null)throw new zs("No readers where selected, nothing can be read.");for(const m of this.readers)try{return m.decode(c,this.hints)}catch(v){if(v instanceof zs)continue}throw new Mt("No MultiFormat Readers were able to detect the code.")}}class is extends ir{constructor(c=null,m=500){const v=new Xl;v.setHints(c),super(v,m)}decodeBitmap(c){return this.reader.decodeWithState(c)}}class Sc extends ir{constructor(c=500){super(new Xr,c)}}class Dr extends ir{constructor(c=500){super(new Xo,c)}}var Ir;(function(Te){Te[Te.ERROR_CORRECTION=0]="ERROR_CORRECTION",Te[Te.CHARACTER_SET=1]="CHARACTER_SET",Te[Te.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",Te[Te.MIN_SIZE=3]="MIN_SIZE",Te[Te.MAX_SIZE=4]="MAX_SIZE",Te[Te.MARGIN=5]="MARGIN",Te[Te.PDF417_COMPACT=6]="PDF417_COMPACT",Te[Te.PDF417_COMPACTION=7]="PDF417_COMPACTION",Te[Te.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",Te[Te.AZTEC_LAYERS=9]="AZTEC_LAYERS",Te[Te.QR_VERSION=10]="QR_VERSION"})(Ir||(Ir={}));var Rr=Ir;class kr{constructor(c){this.field=c,this.cachedGenerators=[],this.cachedGenerators.push(new Sn(c,Int32Array.from([1])))}buildGenerator(c){const m=this.cachedGenerators;if(c>=m.length){let v=m[m.length-1];const C=this.field;for(let I=m.length;I<=c;I++){const L=v.multiply(new Sn(C,Int32Array.from([1,C.exp(I-1+C.getGeneratorBase())])));m.push(L),v=L}}return m[c]}encode(c,m){if(m===0)throw new se("No error correction bytes");const v=c.length-m;if(v<=0)throw new se("No data bytes provided");const C=this.buildGenerator(m),I=new Int32Array(v);K.arraycopy(c,0,I,0,v);let L=new Sn(this.field,I);L=L.multiplyByMonomial(m,1);const j=L.divide(C)[1].getCoefficients(),J=m-j.length;for(let pe=0;pe<J;pe++)c[v+pe]=0;K.arraycopy(j,0,c,v+J,j.length)}}class Mr{constructor(){}static applyMaskPenaltyRule1(c){return Mr.applyMaskPenaltyRule1Internal(c,!0)+Mr.applyMaskPenaltyRule1Internal(c,!1)}static applyMaskPenaltyRule2(c){let m=0;const v=c.getArray(),C=c.getWidth(),I=c.getHeight();for(let L=0;L<I-1;L++){const k=v[L];for(let j=0;j<C-1;j++){const J=k[j];J===k[j+1]&&J===v[L+1][j]&&J===v[L+1][j+1]&&m++}}return Mr.N2*m}static applyMaskPenaltyRule3(c){let m=0;const v=c.getArray(),C=c.getWidth(),I=c.getHeight();for(let L=0;L<I;L++)for(let k=0;k<C;k++){const j=v[L];k+6<C&&j[k]===1&&j[k+1]===0&&j[k+2]===1&&j[k+3]===1&&j[k+4]===1&&j[k+5]===0&&j[k+6]===1&&(Mr.isWhiteHorizontal(j,k-4,k)||Mr.isWhiteHorizontal(j,k+7,k+11))&&m++,L+6<I&&v[L][k]===1&&v[L+1][k]===0&&v[L+2][k]===1&&v[L+3][k]===1&&v[L+4][k]===1&&v[L+5][k]===0&&v[L+6][k]===1&&(Mr.isWhiteVertical(v,k,L-4,L)||Mr.isWhiteVertical(v,k,L+7,L+11))&&m++}return m*Mr.N3}static isWhiteHorizontal(c,m,v){m=Math.max(m,0),v=Math.min(v,c.length);for(let C=m;C<v;C++)if(c[C]===1)return!1;return!0}static isWhiteVertical(c,m,v,C){v=Math.max(v,0),C=Math.min(C,c.length);for(let I=v;I<C;I++)if(c[I][m]===1)return!1;return!0}static applyMaskPenaltyRule4(c){let m=0;const v=c.getArray(),C=c.getWidth(),I=c.getHeight();for(let j=0;j<I;j++){const J=v[j];for(let pe=0;pe<C;pe++)J[pe]===1&&m++}const L=c.getHeight()*c.getWidth();return Math.floor(Math.abs(m*2-L)*10/L)*Mr.N4}static getDataMaskBit(c,m,v){let C,I;switch(c){case 0:C=v+m&1;break;case 1:C=v&1;break;case 2:C=m%3;break;case 3:C=(v+m)%3;break;case 4:C=Math.floor(v/2)+Math.floor(m/3)&1;break;case 5:I=v*m,C=(I&1)+I%3;break;case 6:I=v*m,C=(I&1)+I%3&1;break;case 7:I=v*m,C=I%3+(v+m&1)&1;break;default:throw new se("Invalid mask pattern: "+c)}return C===0}static applyMaskPenaltyRule1Internal(c,m){let v=0;const C=m?c.getHeight():c.getWidth(),I=m?c.getWidth():c.getHeight(),L=c.getArray();for(let k=0;k<C;k++){let j=0,J=-1;for(let pe=0;pe<I;pe++){const Ie=m?L[k][pe]:L[pe][k];Ie===J?j++:(j>=5&&(v+=Mr.N1+(j-5)),j=1,J=Ie)}j>=5&&(v+=Mr.N1+(j-5))}return v}}Mr.N1=3,Mr.N2=3,Mr.N3=40,Mr.N4=10;class Fa{constructor(c,m){this.width=c,this.height=m;const v=new Array(m);for(let C=0;C!==m;C++)v[C]=new Uint8Array(c);this.bytes=v}getHeight(){return this.height}getWidth(){return this.width}get(c,m){return this.bytes[m][c]}getArray(){return this.bytes}setNumber(c,m,v){this.bytes[m][c]=v}setBoolean(c,m,v){this.bytes[m][c]=v?1:0}clear(c){for(const m of this.bytes)q.fill(m,c)}equals(c){if(!(c instanceof Fa))return!1;const m=c;if(this.width!==m.width||this.height!==m.height)return!1;for(let v=0,C=this.height;v<C;++v){const I=this.bytes[v],L=m.bytes[v];for(let k=0,j=this.width;k<j;++k)if(I[k]!==L[k])return!1}return!0}toString(){const c=new Ot;for(let m=0,v=this.height;m<v;++m){const C=this.bytes[m];for(let I=0,L=this.width;I<L;++I)switch(C[I]){case 0:c.append(" 0");break;case 1:c.append(" 1");break;default:c.append("  ");break}c.append(`
`)}return c.toString()}}class gs{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const c=new Ot;return c.append(`<<
`),c.append(" mode: "),c.append(this.mode?this.mode.toString():"null"),c.append(`
 ecLevel: `),c.append(this.ecLevel?this.ecLevel.toString():"null"),c.append(`
 version: `),c.append(this.version?this.version.toString():"null"),c.append(`
 maskPattern: `),c.append(this.maskPattern.toString()),this.matrix?(c.append(`
 matrix:
`),c.append(this.matrix.toString())):c.append(`
 matrix: null
`),c.append(`>>
`),c.toString()}setMode(c){this.mode=c}setECLevel(c){this.ecLevel=c}setVersion(c){this.version=c}setMaskPattern(c){this.maskPattern=c}setMatrix(c){this.matrix=c}static isValidMaskPattern(c){return c>=0&&c<gs.NUM_MASK_PATTERNS}}gs.NUM_MASK_PATTERNS=8;class rr extends W{}rr.kind="WriterException";class ln{constructor(){}static clearMatrix(c){c.clear(255)}static buildMatrix(c,m,v,C,I){ln.clearMatrix(I),ln.embedBasicPatterns(v,I),ln.embedTypeInfo(m,C,I),ln.maybeEmbedVersionInfo(v,I),ln.embedDataBits(c,C,I)}static embedBasicPatterns(c,m){ln.embedPositionDetectionPatternsAndSeparators(m),ln.embedDarkDotAtLeftBottomCorner(m),ln.maybeEmbedPositionAdjustmentPatterns(c,m),ln.embedTimingPatterns(m)}static embedTypeInfo(c,m,v){const C=new Q;ln.makeTypeInfoBits(c,m,C);for(let I=0,L=C.getSize();I<L;++I){const k=C.get(C.getSize()-1-I),j=ln.TYPE_INFO_COORDINATES[I],J=j[0],pe=j[1];if(v.setBoolean(J,pe,k),I<8){const Ie=v.getWidth()-I-1,Ne=8;v.setBoolean(Ie,Ne,k)}else{const Ne=v.getHeight()-7+(I-8);v.setBoolean(8,Ne,k)}}}static maybeEmbedVersionInfo(c,m){if(c.getVersionNumber()<7)return;const v=new Q;ln.makeVersionInfoBits(c,v);let C=6*3-1;for(let I=0;I<6;++I)for(let L=0;L<3;++L){const k=v.get(C);C--,m.setBoolean(I,m.getHeight()-11+L,k),m.setBoolean(m.getHeight()-11+L,I,k)}}static embedDataBits(c,m,v){let C=0,I=-1,L=v.getWidth()-1,k=v.getHeight()-1;for(;L>0;){for(L===6&&(L-=1);k>=0&&k<v.getHeight();){for(let j=0;j<2;++j){const J=L-j;if(!ln.isEmpty(v.get(J,k)))continue;let pe;C<c.getSize()?(pe=c.get(C),++C):pe=!1,m!==255&&Mr.getDataMaskBit(m,J,k)&&(pe=!pe),v.setBoolean(J,k,pe)}k+=I}I=-I,k+=I,L-=2}if(C!==c.getSize())throw new rr("Not all bits consumed: "+C+"/"+c.getSize())}static findMSBSet(c){return 32-G.numberOfLeadingZeros(c)}static calculateBCHCode(c,m){if(m===0)throw new se("0 polynomial");const v=ln.findMSBSet(m);for(c<<=v-1;ln.findMSBSet(c)>=v;)c^=m<<ln.findMSBSet(c)-v;return c}static makeTypeInfoBits(c,m,v){if(!gs.isValidMaskPattern(m))throw new rr("Invalid mask pattern");const C=c.getBits()<<3|m;v.appendBits(C,5);const I=ln.calculateBCHCode(C,ln.TYPE_INFO_POLY);v.appendBits(I,10);const L=new Q;if(L.appendBits(ln.TYPE_INFO_MASK_PATTERN,15),v.xor(L),v.getSize()!==15)throw new rr("should not happen but we got: "+v.getSize())}static makeVersionInfoBits(c,m){m.appendBits(c.getVersionNumber(),6);const v=ln.calculateBCHCode(c.getVersionNumber(),ln.VERSION_INFO_POLY);if(m.appendBits(v,12),m.getSize()!==18)throw new rr("should not happen but we got: "+m.getSize())}static isEmpty(c){return c===255}static embedTimingPatterns(c){for(let m=8;m<c.getWidth()-8;++m){const v=(m+1)%2;ln.isEmpty(c.get(m,6))&&c.setNumber(m,6,v),ln.isEmpty(c.get(6,m))&&c.setNumber(6,m,v)}}static embedDarkDotAtLeftBottomCorner(c){if(c.get(8,c.getHeight()-8)===0)throw new rr;c.setNumber(8,c.getHeight()-8,1)}static embedHorizontalSeparationPattern(c,m,v){for(let C=0;C<8;++C){if(!ln.isEmpty(v.get(c+C,m)))throw new rr;v.setNumber(c+C,m,0)}}static embedVerticalSeparationPattern(c,m,v){for(let C=0;C<7;++C){if(!ln.isEmpty(v.get(c,m+C)))throw new rr;v.setNumber(c,m+C,0)}}static embedPositionAdjustmentPattern(c,m,v){for(let C=0;C<5;++C){const I=ln.POSITION_ADJUSTMENT_PATTERN[C];for(let L=0;L<5;++L)v.setNumber(c+L,m+C,I[L])}}static embedPositionDetectionPattern(c,m,v){for(let C=0;C<7;++C){const I=ln.POSITION_DETECTION_PATTERN[C];for(let L=0;L<7;++L)v.setNumber(c+L,m+C,I[L])}}static embedPositionDetectionPatternsAndSeparators(c){const m=ln.POSITION_DETECTION_PATTERN[0].length;ln.embedPositionDetectionPattern(0,0,c),ln.embedPositionDetectionPattern(c.getWidth()-m,0,c),ln.embedPositionDetectionPattern(0,c.getWidth()-m,c);const v=8;ln.embedHorizontalSeparationPattern(0,v-1,c),ln.embedHorizontalSeparationPattern(c.getWidth()-v,v-1,c),ln.embedHorizontalSeparationPattern(0,c.getWidth()-v,c);const C=7;ln.embedVerticalSeparationPattern(C,0,c),ln.embedVerticalSeparationPattern(c.getHeight()-C-1,0,c),ln.embedVerticalSeparationPattern(C,c.getHeight()-C,c)}static maybeEmbedPositionAdjustmentPatterns(c,m){if(c.getVersionNumber()<2)return;const v=c.getVersionNumber()-1,C=ln.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[v];for(let I=0,L=C.length;I!==L;I++){const k=C[I];if(k>=0)for(let j=0;j!==L;j++){const J=C[j];J>=0&&ln.isEmpty(m.get(J,k))&&ln.embedPositionAdjustmentPattern(J-2,k-2,m)}}}}ln.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),ln.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),ln.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),ln.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),ln.VERSION_INFO_POLY=7973,ln.TYPE_INFO_POLY=1335,ln.TYPE_INFO_MASK_PATTERN=21522;class nl{constructor(c,m){this.dataBytes=c,this.errorCorrectionBytes=m}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class cr{constructor(){}static calculateMaskPenalty(c){return Mr.applyMaskPenaltyRule1(c)+Mr.applyMaskPenaltyRule2(c)+Mr.applyMaskPenaltyRule3(c)+Mr.applyMaskPenaltyRule4(c)}static encode(c,m,v=null){let C=cr.DEFAULT_BYTE_MODE_ENCODING;const I=v!==null&&v.get(Rr.CHARACTER_SET)!==void 0;I&&(C=v.get(Rr.CHARACTER_SET).toString());const L=this.chooseMode(c,C),k=new Q;if(L===Wi.BYTE&&(I||cr.DEFAULT_BYTE_MODE_ENCODING!==C)){const gi=He.getCharacterSetECIByName(C);gi!==void 0&&this.appendECI(gi,k)}this.appendModeInfo(L,k);const j=new Q;this.appendBytes(c,L,j,C);let J;if(v!==null&&v.get(Rr.QR_VERSION)!==void 0){const gi=Number.parseInt(v.get(Rr.QR_VERSION).toString(),10);J=ki.getVersionForNumber(gi);const ai=this.calculateBitsNeeded(L,k,j,J);if(!this.willFit(ai,J,m))throw new rr("Data too big for requested version")}else J=this.recommendVersion(m,L,k,j);const pe=new Q;pe.appendBitArray(k);const Ie=L===Wi.BYTE?j.getSizeInBytes():c.length;this.appendLengthInfo(Ie,J,L,pe),pe.appendBitArray(j);const Ne=J.getECBlocksForLevel(m),Ye=J.getTotalCodewords()-Ne.getTotalECCodewords();this.terminateBits(Ye,pe);const at=this.interleaveWithECBytes(pe,J.getTotalCodewords(),Ye,Ne.getNumBlocks()),ut=new gs;ut.setECLevel(m),ut.setMode(L),ut.setVersion(J);const Et=J.getDimensionForVersion(),Rt=new Fa(Et,Et),mi=this.chooseMaskPattern(at,m,J,Rt);return ut.setMaskPattern(mi),ln.buildMatrix(at,m,J,mi,Rt),ut.setMatrix(Rt),ut}static recommendVersion(c,m,v,C){const I=this.calculateBitsNeeded(m,v,C,ki.getVersionForNumber(1)),L=this.chooseVersion(I,c),k=this.calculateBitsNeeded(m,v,C,L);return this.chooseVersion(k,c)}static calculateBitsNeeded(c,m,v,C){return m.getSize()+c.getCharacterCountBits(C)+v.getSize()}static getAlphanumericCode(c){return c<cr.ALPHANUMERIC_TABLE.length?cr.ALPHANUMERIC_TABLE[c]:-1}static chooseMode(c,m=null){if(He.SJIS.getName()===m&&this.isOnlyDoubleByteKanji(c))return Wi.KANJI;let v=!1,C=!1;for(let I=0,L=c.length;I<L;++I){const k=c.charAt(I);if(cr.isDigit(k))v=!0;else if(this.getAlphanumericCode(k.charCodeAt(0))!==-1)C=!0;else return Wi.BYTE}return C?Wi.ALPHANUMERIC:v?Wi.NUMERIC:Wi.BYTE}static isOnlyDoubleByteKanji(c){let m;try{m=vt.encode(c,He.SJIS)}catch{return!1}const v=m.length;if(v%2!==0)return!1;for(let C=0;C<v;C+=2){const I=m[C]&255;if((I<129||I>159)&&(I<224||I>235))return!1}return!0}static chooseMaskPattern(c,m,v,C){let I=Number.MAX_SAFE_INTEGER,L=-1;for(let k=0;k<gs.NUM_MASK_PATTERNS;k++){ln.buildMatrix(c,m,v,k,C);let j=this.calculateMaskPenalty(C);j<I&&(I=j,L=k)}return L}static chooseVersion(c,m){for(let v=1;v<=40;v++){const C=ki.getVersionForNumber(v);if(cr.willFit(c,C,m))return C}throw new rr("Data too big")}static willFit(c,m,v){const C=m.getTotalCodewords(),L=m.getECBlocksForLevel(v).getTotalECCodewords(),k=C-L,j=(c+7)/8;return k>=j}static terminateBits(c,m){const v=c*8;if(m.getSize()>v)throw new rr("data bits cannot fit in the QR Code"+m.getSize()+" > "+v);for(let L=0;L<4&&m.getSize()<v;++L)m.appendBit(!1);const C=m.getSize()&7;if(C>0)for(let L=C;L<8;L++)m.appendBit(!1);const I=c-m.getSizeInBytes();for(let L=0;L<I;++L)m.appendBits(L&1?17:236,8);if(m.getSize()!==v)throw new rr("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(c,m,v,C,I,L){if(C>=v)throw new rr("Block ID too large");const k=c%v,j=v-k,J=Math.floor(c/v),pe=J+1,Ie=Math.floor(m/v),Ne=Ie+1,Ye=J-Ie,at=pe-Ne;if(Ye!==at)throw new rr("EC bytes mismatch");if(v!==j+k)throw new rr("RS blocks mismatch");if(c!==(Ie+Ye)*j+(Ne+at)*k)throw new rr("Total bytes mismatch");C<j?(I[0]=Ie,L[0]=Ye):(I[0]=Ne,L[0]=at)}static interleaveWithECBytes(c,m,v,C){if(c.getSizeInBytes()!==v)throw new rr("Number of bits and data bytes does not match");let I=0,L=0,k=0;const j=new Array;for(let pe=0;pe<C;++pe){const Ie=new Int32Array(1),Ne=new Int32Array(1);cr.getNumDataBytesAndNumECBytesForBlockID(m,v,C,pe,Ie,Ne);const Ye=Ie[0],at=new Uint8Array(Ye);c.toBytes(8*I,at,0,Ye);const ut=cr.generateECBytes(at,Ne[0]);j.push(new nl(at,ut)),L=Math.max(L,Ye),k=Math.max(k,ut.length),I+=Ie[0]}if(v!==I)throw new rr("Data bytes does not match offset");const J=new Q;for(let pe=0;pe<L;++pe)for(const Ie of j){const Ne=Ie.getDataBytes();pe<Ne.length&&J.appendBits(Ne[pe],8)}for(let pe=0;pe<k;++pe)for(const Ie of j){const Ne=Ie.getErrorCorrectionBytes();pe<Ne.length&&J.appendBits(Ne[pe],8)}if(m!==J.getSizeInBytes())throw new rr("Interleaving error: "+m+" and "+J.getSizeInBytes()+" differ.");return J}static generateECBytes(c,m){const v=c.length,C=new Int32Array(v+m);for(let L=0;L<v;L++)C[L]=c[L]&255;new kr(fi.QR_CODE_FIELD_256).encode(C,m);const I=new Uint8Array(m);for(let L=0;L<m;L++)I[L]=C[v+L];return I}static appendModeInfo(c,m){m.appendBits(c.getBits(),4)}static appendLengthInfo(c,m,v,C){const I=v.getCharacterCountBits(m);if(c>=1<<I)throw new rr(c+" is bigger than "+((1<<I)-1));C.appendBits(c,I)}static appendBytes(c,m,v,C){switch(m){case Wi.NUMERIC:cr.appendNumericBytes(c,v);break;case Wi.ALPHANUMERIC:cr.appendAlphanumericBytes(c,v);break;case Wi.BYTE:cr.append8BitBytes(c,v,C);break;case Wi.KANJI:cr.appendKanjiBytes(c,v);break;default:throw new rr("Invalid mode: "+m)}}static getDigit(c){return c.charCodeAt(0)-48}static isDigit(c){const m=cr.getDigit(c);return m>=0&&m<=9}static appendNumericBytes(c,m){const v=c.length;let C=0;for(;C<v;){const I=cr.getDigit(c.charAt(C));if(C+2<v){const L=cr.getDigit(c.charAt(C+1)),k=cr.getDigit(c.charAt(C+2));m.appendBits(I*100+L*10+k,10),C+=3}else if(C+1<v){const L=cr.getDigit(c.charAt(C+1));m.appendBits(I*10+L,7),C+=2}else m.appendBits(I,4),C++}}static appendAlphanumericBytes(c,m){const v=c.length;let C=0;for(;C<v;){const I=cr.getAlphanumericCode(c.charCodeAt(C));if(I===-1)throw new rr;if(C+1<v){const L=cr.getAlphanumericCode(c.charCodeAt(C+1));if(L===-1)throw new rr;m.appendBits(I*45+L,11),C+=2}else m.appendBits(I,6),C++}}static append8BitBytes(c,m,v){let C;try{C=vt.encode(c,v)}catch(I){throw new rr(I)}for(let I=0,L=C.length;I!==L;I++){const k=C[I];m.appendBits(k,8)}}static appendKanjiBytes(c,m){let v;try{v=vt.encode(c,He.SJIS)}catch(I){throw new rr(I)}const C=v.length;for(let I=0;I<C;I+=2){const L=v[I]&255,k=v[I+1]&255,j=L<<8&4294967295|k;let J=-1;if(j>=33088&&j<=40956?J=j-33088:j>=57408&&j<=60351&&(J=j-49472),J===-1)throw new rr("Invalid byte sequence");const pe=(J>>8)*192+(J&255);m.appendBits(pe,13)}}static appendECI(c,m){m.appendBits(Wi.ECI.getBits(),4),m.appendBits(c.getValue(),8)}}cr.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),cr.DEFAULT_BYTE_MODE_ENCODING=He.UTF8.getName();class Vo{write(c,m,v,C=null){if(c.length===0)throw new se("Found empty contents");if(m<0||v<0)throw new se("Requested dimensions are too small: "+m+"x"+v);let I=Rn.L,L=Vo.QUIET_ZONE_SIZE;C!==null&&(C.get(Rr.ERROR_CORRECTION)!==void 0&&(I=Rn.fromString(C.get(Rr.ERROR_CORRECTION).toString())),C.get(Rr.MARGIN)!==void 0&&(L=Number.parseInt(C.get(Rr.MARGIN).toString(),10)));const k=cr.encode(c,I,C);return this.renderResult(k,m,v,L)}writeToDom(c,m,v,C,I=null){typeof c=="string"&&(c=document.querySelector(c));const L=this.write(m,v,C,I);c&&c.appendChild(L)}renderResult(c,m,v,C){const I=c.getMatrix();if(I===null)throw new Or;const L=I.getWidth(),k=I.getHeight(),j=L+C*2,J=k+C*2,pe=Math.max(m,j),Ie=Math.max(v,J),Ne=Math.min(Math.floor(pe/j),Math.floor(Ie/J)),Ye=Math.floor((pe-L*Ne)/2),at=Math.floor((Ie-k*Ne)/2),ut=this.createSVGElement(pe,Ie);for(let Et=0,Rt=at;Et<k;Et++,Rt+=Ne)for(let mi=0,gi=Ye;mi<L;mi++,gi+=Ne)if(I.get(mi,Et)===1){const ai=this.createSvgRectElement(gi,Rt,Ne,Ne);ut.appendChild(ai)}return ut}createSVGElement(c,m){const v=document.createElementNS(Vo.SVG_NS,"svg");return v.setAttributeNS(null,"height",c.toString()),v.setAttributeNS(null,"width",m.toString()),v}createSvgRectElement(c,m,v,C){const I=document.createElementNS(Vo.SVG_NS,"rect");return I.setAttributeNS(null,"x",c.toString()),I.setAttributeNS(null,"y",m.toString()),I.setAttributeNS(null,"height",v.toString()),I.setAttributeNS(null,"width",C.toString()),I.setAttributeNS(null,"fill","#000000"),I}}Vo.QUIET_ZONE_SIZE=4,Vo.SVG_NS="http://www.w3.org/2000/svg";class _s{encode(c,m,v,C,I){if(c.length===0)throw new se("Found empty contents");if(m!==Ri.QR_CODE)throw new se("Can only encode QR_CODE, but got "+m);if(v<0||C<0)throw new se(`Requested dimensions are too small: ${v}x${C}`);let L=Rn.L,k=_s.QUIET_ZONE_SIZE;I!==null&&(I.get(Rr.ERROR_CORRECTION)!==void 0&&(L=Rn.fromString(I.get(Rr.ERROR_CORRECTION).toString())),I.get(Rr.MARGIN)!==void 0&&(k=Number.parseInt(I.get(Rr.MARGIN).toString(),10)));const j=cr.encode(c,L,I);return _s.renderResult(j,v,C,k)}static renderResult(c,m,v,C){const I=c.getMatrix();if(I===null)throw new Or;const L=I.getWidth(),k=I.getHeight(),j=L+C*2,J=k+C*2,pe=Math.max(m,j),Ie=Math.max(v,J),Ne=Math.min(Math.floor(pe/j),Math.floor(Ie/J)),Ye=Math.floor((pe-L*Ne)/2),at=Math.floor((Ie-k*Ne)/2),ut=new Ui(pe,Ie);for(let Et=0,Rt=at;Et<k;Et++,Rt+=Ne)for(let mi=0,gi=Ye;mi<L;mi++,gi+=Ne)I.get(mi,Et)===1&&ut.setRegion(gi,Rt,Ne,Ne);return ut}}_s.QUIET_ZONE_SIZE=4;class Ac{encode(c,m,v,C,I){let L;switch(m){case Ri.QR_CODE:L=new _s;break;default:throw new se("No encoder available for format "+m)}return L.encode(c,m,v,C,I)}}class cs extends Un{constructor(c,m,v,C,I,L,k,j){if(super(L,k),this.yuvData=c,this.dataWidth=m,this.dataHeight=v,this.left=C,this.top=I,C+L>m||I+k>v)throw new se("Crop rectangle does not fit within image data.");j&&this.reverseHorizontal(L,k)}getRow(c,m){if(c<0||c>=this.getHeight())throw new se("Requested row is outside the image: "+c);const v=this.getWidth();(m==null||m.length<v)&&(m=new Uint8ClampedArray(v));const C=(c+this.top)*this.dataWidth+this.left;return K.arraycopy(this.yuvData,C,m,0,v),m}getMatrix(){const c=this.getWidth(),m=this.getHeight();if(c===this.dataWidth&&m===this.dataHeight)return this.yuvData;const v=c*m,C=new Uint8ClampedArray(v);let I=this.top*this.dataWidth+this.left;if(c===this.dataWidth)return K.arraycopy(this.yuvData,I,C,0,v),C;for(let L=0;L<m;L++){const k=L*c;K.arraycopy(this.yuvData,I,C,k,c),I+=this.dataWidth}return C}isCropSupported(){return!0}crop(c,m,v,C){return new cs(this.yuvData,this.dataWidth,this.dataHeight,this.left+c,this.top+m,v,C,!1)}renderThumbnail(){const c=this.getWidth()/cs.THUMBNAIL_SCALE_FACTOR,m=this.getHeight()/cs.THUMBNAIL_SCALE_FACTOR,v=new Int32Array(c*m),C=this.yuvData;let I=this.top*this.dataWidth+this.left;for(let L=0;L<m;L++){const k=L*c;for(let j=0;j<c;j++){const J=C[I+j*cs.THUMBNAIL_SCALE_FACTOR]&255;v[k+j]=4278190080|J*65793}I+=this.dataWidth*cs.THUMBNAIL_SCALE_FACTOR}return v}getThumbnailWidth(){return this.getWidth()/cs.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/cs.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(c,m){const v=this.yuvData;for(let C=0,I=this.top*this.dataWidth+this.left;C<m;C++,I+=this.dataWidth){const L=I+c/2;for(let k=I,j=I+c-1;k<L;k++,j--){const J=v[k];v[k]=v[j],v[j]=J}}}invert(){return new Nn(this)}}cs.THUMBNAIL_SCALE_FACTOR=2;class Yl extends Un{constructor(c,m,v,C,I,L,k){if(super(m,v),this.dataWidth=C,this.dataHeight=I,this.left=L,this.top=k,c.BYTES_PER_ELEMENT===4){const j=m*v,J=new Uint8ClampedArray(j);for(let pe=0;pe<j;pe++){const Ie=c[pe],Ne=Ie>>16&255,Ye=Ie>>7&510,at=Ie&255;J[pe]=(Ne+Ye+at)/4&255}this.luminances=J}else this.luminances=c;if(C===void 0&&(this.dataWidth=m),I===void 0&&(this.dataHeight=v),L===void 0&&(this.left=0),k===void 0&&(this.top=0),this.left+m>this.dataWidth||this.top+v>this.dataHeight)throw new se("Crop rectangle does not fit within image data.")}getRow(c,m){if(c<0||c>=this.getHeight())throw new se("Requested row is outside the image: "+c);const v=this.getWidth();(m==null||m.length<v)&&(m=new Uint8ClampedArray(v));const C=(c+this.top)*this.dataWidth+this.left;return K.arraycopy(this.luminances,C,m,0,v),m}getMatrix(){const c=this.getWidth(),m=this.getHeight();if(c===this.dataWidth&&m===this.dataHeight)return this.luminances;const v=c*m,C=new Uint8ClampedArray(v);let I=this.top*this.dataWidth+this.left;if(c===this.dataWidth)return K.arraycopy(this.luminances,I,C,0,v),C;for(let L=0;L<m;L++){const k=L*c;K.arraycopy(this.luminances,I,C,k,c),I+=this.dataWidth}return C}isCropSupported(){return!0}crop(c,m,v,C){return new Yl(this.luminances,v,C,this.dataWidth,this.dataHeight,this.left+c,this.top+m)}invert(){return new Nn(this)}}class bl extends He{static forName(c){return this.getCharacterSetECIByName(c)}}class rl{}rl.ISO_8859_1=He.ISO8859_1;class za{isCompact(){return this.compact}setCompact(c){this.compact=c}getSize(){return this.size}setSize(c){this.size=c}getLayers(){return this.layers}setLayers(c){this.layers=c}getCodeWords(){return this.codeWords}setCodeWords(c){this.codeWords=c}getMatrix(){return this.matrix}setMatrix(c){this.matrix=c}}class Cl{static singletonList(c){return[c]}static min(c,m){return c.sort(m)[0]}}class Ao{constructor(c){this.previous=c}getPrevious(){return this.previous}}class Va extends Ao{constructor(c,m,v){super(c),this.value=m,this.bitCount=v}appendTo(c,m){c.appendBits(this.value,this.bitCount)}add(c,m){return new Va(this,c,m)}addBinaryShift(c,m){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new Va(this,c,m)}toString(){let c=this.value&(1<<this.bitCount)-1;return c|=1<<this.bitCount,"<"+G.toBinaryString(c|1<<this.bitCount).substring(1)+">"}}class xa extends Va{constructor(c,m,v){super(c,0,0),this.binaryShiftStart=m,this.binaryShiftByteCount=v}appendTo(c,m){for(let v=0;v<this.binaryShiftByteCount;v++)(v===0||v===31&&this.binaryShiftByteCount<=62)&&(c.appendBits(31,5),this.binaryShiftByteCount>62?c.appendBits(this.binaryShiftByteCount-31,16):v===0?c.appendBits(Math.min(this.binaryShiftByteCount,31),5):c.appendBits(this.binaryShiftByteCount-31,5)),c.appendBits(m[this.binaryShiftStart+v],8)}addBinaryShift(c,m){return new xa(this,c,m)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function Kl(Te,c,m){return new xa(Te,c,m)}function qs(Te,c,m){return new Va(Te,c,m)}const tu=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],Ko=0,Ua=1,ns=2,ol=3,us=4,sl=new Va(null,0,0),wa=[Int32Array.from([0,(5<<16)+28,(5<<16)+30,(5<<16)+29,655360+928+30]),Int32Array.from([(9<<16)+480+14,0,(5<<16)+30,(5<<16)+29,655360+928+30]),Int32Array.from([(4<<16)+14,(9<<16)+448+28,0,(9<<16)+448+29,917504+14336+928+30]),Int32Array.from([(5<<16)+29,(5<<16)+28,655360+928+30,0,(5<<16)+30]),Int32Array.from([(5<<16)+31,655360+992+28,655360+992+30,655360+992+29,0])];function ba(Te){for(let c of Te)q.fill(c,-1);return Te[Ko][us]=0,Te[Ua][us]=0,Te[Ua][Ko]=28,Te[ol][us]=0,Te[ns][us]=0,Te[ns][Ko]=15,Te}const Ca=ba(q.createInt32Array(6,6));class Ts{constructor(c,m,v,C){this.token=c,this.mode=m,this.binaryShiftByteCount=v,this.bitCount=C}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(c,m){let v=this.bitCount,C=this.token;if(c!==this.mode){let L=wa[this.mode][c];C=qs(C,L&65535,L>>16),v+=L>>16}let I=c===ns?4:5;return C=qs(C,m,I),new Ts(C,c,0,v+I)}shiftAndAppend(c,m){let v=this.token,C=this.mode===ns?4:5;return v=qs(v,Ca[this.mode][c],C),v=qs(v,m,5),new Ts(v,this.mode,0,this.bitCount+C+5)}addBinaryShiftChar(c){let m=this.token,v=this.mode,C=this.bitCount;if(this.mode===us||this.mode===ns){let k=wa[v][Ko];m=qs(m,k&65535,k>>16),C+=k>>16,v=Ko}let I=this.binaryShiftByteCount===0||this.binaryShiftByteCount===31?18:this.binaryShiftByteCount===62?9:8,L=new Ts(m,v,this.binaryShiftByteCount+1,C+I);return L.binaryShiftByteCount===2047+31&&(L=L.endBinaryShift(c+1)),L}endBinaryShift(c){if(this.binaryShiftByteCount===0)return this;let m=this.token;return m=Kl(m,c-this.binaryShiftByteCount,this.binaryShiftByteCount),new Ts(m,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(c){let m=this.bitCount+(wa[this.mode][c.mode]>>16);return this.binaryShiftByteCount<c.binaryShiftByteCount?m+=Ts.calculateBinaryShiftCost(c)-Ts.calculateBinaryShiftCost(this):this.binaryShiftByteCount>c.binaryShiftByteCount&&c.binaryShiftByteCount>0&&(m+=10),m<=c.bitCount}toBitArray(c){let m=[];for(let C=this.endBinaryShift(c.length).token;C!==null;C=C.getPrevious())m.unshift(C);let v=new Q;for(const C of m)C.appendTo(v,c);return v}toString(){return xt.format("%s bits=%d bytes=%d",tu[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(c){return c.binaryShiftByteCount>62?21:c.binaryShiftByteCount>31?20:c.binaryShiftByteCount>0?10:0}}Ts.INITIAL_STATE=new Ts(sl,Ko,0,0);function Ic(Te){const c=xt.getCharCode(" "),m=xt.getCharCode("."),v=xt.getCharCode(",");Te[Ko][c]=1;const C=xt.getCharCode("Z"),I=xt.getCharCode("A");for(let Ne=I;Ne<=C;Ne++)Te[Ko][Ne]=Ne-I+2;Te[Ua][c]=1;const L=xt.getCharCode("z"),k=xt.getCharCode("a");for(let Ne=k;Ne<=L;Ne++)Te[Ua][Ne]=Ne-k+2;Te[ns][c]=1;const j=xt.getCharCode("9"),J=xt.getCharCode("0");for(let Ne=J;Ne<=j;Ne++)Te[ns][Ne]=Ne-J+2;Te[ns][v]=12,Te[ns][m]=13;const pe=["\0"," ","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","\x1B","","","","","@","\\","^","_","`","|","~",""];for(let Ne=0;Ne<pe.length;Ne++)Te[ol][xt.getCharCode(pe[Ne])]=Ne;const Ie=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let Ne=0;Ne<Ie.length;Ne++)xt.getCharCode(Ie[Ne])>0&&(Te[us][xt.getCharCode(Ie[Ne])]=Ne);return Te}const El=Ic(q.createInt32Array(5,256));class ea{constructor(c){this.text=c}encode(){const c=xt.getCharCode(" "),m=xt.getCharCode(`
`);let v=Cl.singletonList(Ts.INITIAL_STATE);for(let I=0;I<this.text.length;I++){let L,k=I+1<this.text.length?this.text[I+1]:0;switch(this.text[I]){case xt.getCharCode("\r"):L=k===m?2:0;break;case xt.getCharCode("."):L=k===c?3:0;break;case xt.getCharCode(","):L=k===c?4:0;break;case xt.getCharCode(":"):L=k===c?5:0;break;default:L=0}L>0?(v=ea.updateStateListForPair(v,I,L),I++):v=this.updateStateListForChar(v,I)}return Cl.min(v,(I,L)=>I.getBitCount()-L.getBitCount()).toBitArray(this.text)}updateStateListForChar(c,m){const v=[];for(let C of c)this.updateStateForChar(C,m,v);return ea.simplifyStates(v)}updateStateForChar(c,m,v){let C=this.text[m]&255,I=El[c.getMode()][C]>0,L=null;for(let k=0;k<=us;k++){let j=El[k][C];if(j>0){if(L==null&&(L=c.endBinaryShift(m)),!I||k===c.getMode()||k===ns){const J=L.latchAndAppend(k,j);v.push(J)}if(!I&&Ca[c.getMode()][k]>=0){const J=L.shiftAndAppend(k,j);v.push(J)}}}if(c.getBinaryShiftByteCount()>0||El[c.getMode()][C]===0){let k=c.addBinaryShiftChar(m);v.push(k)}}static updateStateListForPair(c,m,v){const C=[];for(let I of c)this.updateStateForPair(I,m,v,C);return this.simplifyStates(C)}static updateStateForPair(c,m,v,C){let I=c.endBinaryShift(m);if(C.push(I.latchAndAppend(us,v)),c.getMode()!==us&&C.push(I.shiftAndAppend(us,v)),v===3||v===4){let L=I.latchAndAppend(ns,16-v).latchAndAppend(ns,1);C.push(L)}if(c.getBinaryShiftByteCount()>0){let L=c.addBinaryShiftChar(m).addBinaryShiftChar(m+1);C.push(L)}}static simplifyStates(c){let m=[];for(const v of c){let C=!0;for(const I of m){if(I.isBetterThanOrEqualTo(v)){C=!1;break}v.isBetterThanOrEqualTo(I)&&(m=m.filter(L=>L!==I))}C&&m.push(v)}return m}}class Zn{constructor(){}static encodeBytes(c){return Zn.encode(c,Zn.DEFAULT_EC_PERCENT,Zn.DEFAULT_AZTEC_LAYERS)}static encode(c,m,v){let C=new ea(c).encode(),I=G.truncDivision(C.getSize()*m,100)+11,L=C.getSize()+I,k,j,J,pe,Ie;if(v!==Zn.DEFAULT_AZTEC_LAYERS){if(k=v<0,j=Math.abs(v),j>(k?Zn.MAX_NB_BITS_COMPACT:Zn.MAX_NB_BITS))throw new se(xt.format("Illegal value %s for layers",v));J=Zn.totalBitsInLayer(j,k),pe=Zn.WORD_SIZE[j];let ai=J-J%pe;if(Ie=Zn.stuffBits(C,pe),Ie.getSize()+I>ai)throw new se("Data to large for user specified layer");if(k&&Ie.getSize()>pe*64)throw new se("Data to large for user specified layer")}else{pe=0,Ie=null;for(let ai=0;;ai++){if(ai>Zn.MAX_NB_BITS)throw new se("Data too large for an Aztec code");if(k=ai<=3,j=k?ai+1:ai,J=Zn.totalBitsInLayer(j,k),L>J)continue;(Ie==null||pe!==Zn.WORD_SIZE[j])&&(pe=Zn.WORD_SIZE[j],Ie=Zn.stuffBits(C,pe));let Xn=J-J%pe;if(!(k&&Ie.getSize()>pe*64)&&Ie.getSize()+I<=Xn)break}}let Ne=Zn.generateCheckWords(Ie,J,pe),Ye=Ie.getSize()/pe,at=Zn.generateModeMessage(k,j,Ye),ut=(k?11:14)+j*4,Et=new Int32Array(ut),Rt;if(k){Rt=ut;for(let ai=0;ai<Et.length;ai++)Et[ai]=ai}else{Rt=ut+1+2*G.truncDivision(G.truncDivision(ut,2)-1,15);let ai=G.truncDivision(ut,2),Xn=G.truncDivision(Rt,2);for(let wn=0;wn<ai;wn++){let yo=wn+G.truncDivision(wn,15);Et[ai-wn-1]=Xn-yo-1,Et[ai+wn]=Xn+yo+1}}let mi=new Ui(Rt);for(let ai=0,Xn=0;ai<j;ai++){let wn=(j-ai)*4+(k?9:12);for(let yo=0;yo<wn;yo++){let Ss=yo*2;for(let Yr=0;Yr<2;Yr++)Ne.get(Xn+Ss+Yr)&&mi.set(Et[ai*2+Yr],Et[ai*2+yo]),Ne.get(Xn+wn*2+Ss+Yr)&&mi.set(Et[ai*2+yo],Et[ut-1-ai*2-Yr]),Ne.get(Xn+wn*4+Ss+Yr)&&mi.set(Et[ut-1-ai*2-Yr],Et[ut-1-ai*2-yo]),Ne.get(Xn+wn*6+Ss+Yr)&&mi.set(Et[ut-1-ai*2-yo],Et[ai*2+Yr])}Xn+=wn*8}if(Zn.drawModeMessage(mi,k,Rt,at),k)Zn.drawBullsEye(mi,G.truncDivision(Rt,2),5);else{Zn.drawBullsEye(mi,G.truncDivision(Rt,2),7);for(let ai=0,Xn=0;ai<G.truncDivision(ut,2)-1;ai+=15,Xn+=16)for(let wn=G.truncDivision(Rt,2)&1;wn<Rt;wn+=2)mi.set(G.truncDivision(Rt,2)-Xn,wn),mi.set(G.truncDivision(Rt,2)+Xn,wn),mi.set(wn,G.truncDivision(Rt,2)-Xn),mi.set(wn,G.truncDivision(Rt,2)+Xn)}let gi=new za;return gi.setCompact(k),gi.setSize(Rt),gi.setLayers(j),gi.setCodeWords(Ye),gi.setMatrix(mi),gi}static drawBullsEye(c,m,v){for(let C=0;C<v;C+=2)for(let I=m-C;I<=m+C;I++)c.set(I,m-C),c.set(I,m+C),c.set(m-C,I),c.set(m+C,I);c.set(m-v,m-v),c.set(m-v+1,m-v),c.set(m-v,m-v+1),c.set(m+v,m-v),c.set(m+v,m-v+1),c.set(m+v,m+v-1)}static generateModeMessage(c,m,v){let C=new Q;return c?(C.appendBits(m-1,2),C.appendBits(v-1,6),C=Zn.generateCheckWords(C,28,4)):(C.appendBits(m-1,5),C.appendBits(v-1,11),C=Zn.generateCheckWords(C,40,4)),C}static drawModeMessage(c,m,v,C){let I=G.truncDivision(v,2);if(m)for(let L=0;L<7;L++){let k=I-3+L;C.get(L)&&c.set(k,I-5),C.get(L+7)&&c.set(I+5,k),C.get(20-L)&&c.set(k,I+5),C.get(27-L)&&c.set(I-5,k)}else for(let L=0;L<10;L++){let k=I-5+L+G.truncDivision(L,5);C.get(L)&&c.set(k,I-7),C.get(L+10)&&c.set(I+7,k),C.get(29-L)&&c.set(k,I+7),C.get(39-L)&&c.set(I-7,k)}}static generateCheckWords(c,m,v){let C=c.getSize()/v,I=new kr(Zn.getGF(v)),L=G.truncDivision(m,v),k=Zn.bitsToWords(c,v,L);I.encode(k,L-C);let j=m%v,J=new Q;J.appendBits(0,j);for(const pe of Array.from(k))J.appendBits(pe,v);return J}static bitsToWords(c,m,v){let C=new Int32Array(v),I,L;for(I=0,L=c.getSize()/m;I<L;I++){let k=0;for(let j=0;j<m;j++)k|=c.get(I*m+j)?1<<m-j-1:0;C[I]=k}return C}static getGF(c){switch(c){case 4:return fi.AZTEC_PARAM;case 6:return fi.AZTEC_DATA_6;case 8:return fi.AZTEC_DATA_8;case 10:return fi.AZTEC_DATA_10;case 12:return fi.AZTEC_DATA_12;default:throw new se("Unsupported word size "+c)}}static stuffBits(c,m){let v=new Q,C=c.getSize(),I=(1<<m)-2;for(let L=0;L<C;L+=m){let k=0;for(let j=0;j<m;j++)(L+j>=C||c.get(L+j))&&(k|=1<<m-1-j);(k&I)===I?(v.appendBits(k&I,m),L--):k&I?v.appendBits(k,m):(v.appendBits(k|1,m),L--)}return v}static totalBitsInLayer(c,m){return((m?88:112)+16*c)*c}}Zn.DEFAULT_EC_PERCENT=33,Zn.DEFAULT_AZTEC_LAYERS=0,Zn.MAX_NB_BITS=32,Zn.MAX_NB_BITS_COMPACT=4,Zn.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class ja{encode(c,m,v,C){return this.encodeWithHints(c,m,v,C,null)}encodeWithHints(c,m,v,C,I){let L=rl.ISO_8859_1,k=Zn.DEFAULT_EC_PERCENT,j=Zn.DEFAULT_AZTEC_LAYERS;return I!=null&&(I.has(Rr.CHARACTER_SET)&&(L=bl.forName(I.get(Rr.CHARACTER_SET).toString())),I.has(Rr.ERROR_CORRECTION)&&(k=G.parseInt(I.get(Rr.ERROR_CORRECTION).toString())),I.has(Rr.AZTEC_LAYERS)&&(j=G.parseInt(I.get(Rr.AZTEC_LAYERS).toString()))),ja.encodeLayers(c,m,v,C,L,k,j)}static encodeLayers(c,m,v,C,I,L,k){if(m!==Ri.AZTEC)throw new se("Can only encode AZTEC, but got "+m);let j=Zn.encode(xt.getBytes(c,I),L,k);return ja.renderResult(j,v,C)}static renderResult(c,m,v){let C=c.getMatrix();if(C==null)throw new Or;let I=C.getWidth(),L=C.getHeight(),k=Math.max(m,I),j=Math.max(v,L),J=Math.min(k/I,j/L),pe=(k-I*J)/2,Ie=(j-L*J)/2,Ne=new Ui(k,j);for(let Ye=0,at=Ie;Ye<L;Ye++,at+=J)for(let ut=0,Et=pe;ut<I;ut++,Et+=J)C.get(ut,Ye)&&Ne.setRegion(Et,at,J,J);return Ne}}u.AbstractExpandedDecoder=re,u.ArgumentException=Y,u.ArithmeticException=Co,u.AztecCode=za,u.AztecCodeReader=Bo,u.AztecCodeWriter=ja,u.AztecDecoder=Fn,u.AztecDetector=ko,u.AztecDetectorResult=Do,u.AztecEncoder=Zn,u.AztecHighLevelEncoder=ea,u.AztecPoint=yr,u.BarcodeFormat=Ri,u.Binarizer=he,u.BinaryBitmap=Ae,u.BitArray=Q,u.BitMatrix=Ui,u.BitSource=Dn,u.BrowserAztecCodeReader=Wo,u.BrowserBarcodeReader=Yi,u.BrowserCodeReader=ir,u.BrowserDatamatrixCodeReader=Pi,u.BrowserMultiFormatReader=is,u.BrowserPDF417Reader=Sc,u.BrowserQRCodeReader=Dr,u.BrowserQRCodeSvgWriter=Vo,u.CharacterSetECI=He,u.ChecksumException=Ce,u.Code128Reader=pi,u.Code39Reader=xi,u.DataMatrixDecodedBitStreamParser=Ar,u.DataMatrixReader=_n,u.DecodeHintType=fe,u.DecoderResult=zi,u.DefaultGridSampler=Ro,u.DetectorResult=on,u.EAN13Reader=No,u.EncodeHintType=Rr,u.Exception=W,u.FormatException=ce,u.GenericGF=fi,u.GenericGFPoly=Sn,u.GlobalHistogramBinarizer=_i,u.GridSampler=Go,u.GridSamplerInstance=ao,u.HTMLCanvasElementLuminanceSource=Vi,u.HybridBinarizer=di,u.ITFReader=Gn,u.IllegalArgumentException=se,u.IllegalStateException=Or,u.InvertedLuminanceSource=Nn,u.LuminanceSource=Un,u.MathUtils=ti,u.MultiFormatOneDReader=Gt,u.MultiFormatReader=Xl,u.MultiFormatWriter=Ac,u.NotFoundException=Mt,u.OneDReader=er,u.PDF417DecodedBitStreamParser=Nt,u.PDF417DecoderErrorCorrection=ga,u.PDF417Reader=Xr,u.PDF417ResultMetadata=eu,u.PerspectiveTransform=Pr,u.PlanarYUVLuminanceSource=cs,u.QRCodeByteMatrix=Fa,u.QRCodeDataMask=jr,u.QRCodeDecodedBitStreamParser=lr,u.QRCodeDecoderErrorCorrectionLevel=Rn,u.QRCodeDecoderFormatInformation=Zr,u.QRCodeEncoder=cr,u.QRCodeEncoderQRCode=gs,u.QRCodeMaskUtil=Mr,u.QRCodeMatrixUtil=ln,u.QRCodeMode=Wi,u.QRCodeReader=Xo,u.QRCodeVersion=ki,u.QRCodeWriter=_s,u.RGBLuminanceSource=Yl,u.RSS14Reader=ui,u.RSSExpandedReader=mt,u.ReaderException=zs,u.ReedSolomonDecoder=Hi,u.ReedSolomonEncoder=kr,u.ReedSolomonException=$r,u.Result=fn,u.ResultMetadataType=si,u.ResultPoint=wi,u.StringUtils=xt,u.UnsupportedOperationException=nt,u.VideoInputDevice=Vr,u.WhiteRectangleDetector=so,u.WriterException=rr,u.ZXingArrays=q,u.ZXingCharset=bl,u.ZXingInteger=G,u.ZXingStandardCharsets=rl,u.ZXingStringBuilder=Ot,u.ZXingStringEncoding=vt,u.ZXingSystem=K,u.createAbstractExpandedDecoder=$t,Object.defineProperty(u,"__esModule",{value:!0})})})(P_,P_.exports);var bo=P_.exports;const n4=t0(bo),r4=nI({__proto__:null,default:n4},[bo]);var bb=function(){function d(s,u,g){if(this.formatMap=new Map([[Zi.QR_CODE,bo.BarcodeFormat.QR_CODE],[Zi.AZTEC,bo.BarcodeFormat.AZTEC],[Zi.CODABAR,bo.BarcodeFormat.CODABAR],[Zi.CODE_39,bo.BarcodeFormat.CODE_39],[Zi.CODE_93,bo.BarcodeFormat.CODE_93],[Zi.CODE_128,bo.BarcodeFormat.CODE_128],[Zi.DATA_MATRIX,bo.BarcodeFormat.DATA_MATRIX],[Zi.MAXICODE,bo.BarcodeFormat.MAXICODE],[Zi.ITF,bo.BarcodeFormat.ITF],[Zi.EAN_13,bo.BarcodeFormat.EAN_13],[Zi.EAN_8,bo.BarcodeFormat.EAN_8],[Zi.PDF_417,bo.BarcodeFormat.PDF_417],[Zi.RSS_14,bo.BarcodeFormat.RSS_14],[Zi.RSS_EXPANDED,bo.BarcodeFormat.RSS_EXPANDED],[Zi.UPC_A,bo.BarcodeFormat.UPC_A],[Zi.UPC_E,bo.BarcodeFormat.UPC_E],[Zi.UPC_EAN_EXTENSION,bo.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!r4)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=u,this.logger=g;var A=this.createZXingFormats(s),E=new Map;E.set(bo.DecodeHintType.POSSIBLE_FORMATS,A),E.set(bo.DecodeHintType.TRY_HARDER,!1),this.hints=E}return d.prototype.decodeAsync=function(s){var u=this;return new Promise(function(g,A){try{g(u.decode(s))}catch(E){A(E)}})},d.prototype.decode=function(s){var u=new bo.MultiFormatReader(this.verbose,this.hints),g=new bo.HTMLCanvasElementLuminanceSource(s),A=new bo.BinaryBitmap(new bo.HybridBinarizer(g)),E=u.decode(A);return{text:E.text,format:bC.create(this.toHtml5QrcodeSupportedFormats(E.format)),debugData:this.createDebugData()}},d.prototype.createReverseFormatMap=function(){var s=new Map;return this.formatMap.forEach(function(u,g,A){s.set(u,g)}),s},d.prototype.toHtml5QrcodeSupportedFormats=function(s){if(!this.reverseFormatMap.has(s))throw"reverseFormatMap doesn't have ".concat(s);return this.reverseFormatMap.get(s)},d.prototype.createZXingFormats=function(s){for(var u=[],g=0,A=s;g<A.length;g++){var E=A[g];this.formatMap.has(E)?u.push(this.formatMap.get(E)):this.logger.logError("".concat(E," is not supported by")+"ZXingHtml5QrcodeShim")}return u},d.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},d}(),o4=globalThis&&globalThis.__awaiter||function(d,s,u,g){function A(E){return E instanceof u?E:new u(function(O){O(E)})}return new(u||(u=Promise))(function(E,O){function r(Y){try{W(g.next(Y))}catch(se){O(se)}}function U(Y){try{W(g.throw(Y))}catch(se){O(se)}}function W(Y){Y.done?E(Y.value):A(Y.value).then(r,U)}W((g=g.apply(d,s||[])).next())})},s4=globalThis&&globalThis.__generator||function(d,s){var u={label:0,sent:function(){if(E[0]&1)throw E[1];return E[1]},trys:[],ops:[]},g,A,E,O;return O={next:r(0),throw:r(1),return:r(2)},typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function r(W){return function(Y){return U([W,Y])}}function U(W){if(g)throw new TypeError("Generator is already executing.");for(;O&&(O=0,W[0]&&(u=0)),u;)try{if(g=1,A&&(E=W[0]&2?A.return:W[0]?A.throw||((E=A.return)&&E.call(A),0):A.next)&&!(E=E.call(A,W[1])).done)return E;switch(A=0,E&&(W=[W[0]&2,E.value]),W[0]){case 0:case 1:E=W;break;case 4:return u.label++,{value:W[1],done:!1};case 5:u.label++,A=W[1],W=[0];continue;case 7:W=u.ops.pop(),u.trys.pop();continue;default:if(E=u.trys,!(E=E.length>0&&E[E.length-1])&&(W[0]===6||W[0]===2)){u=0;continue}if(W[0]===3&&(!E||W[1]>E[0]&&W[1]<E[3])){u.label=W[1];break}if(W[0]===6&&u.label<E[1]){u.label=E[1],E=W;break}if(E&&u.label<E[2]){u.label=E[2],u.ops.push(W);break}E[2]&&u.ops.pop(),u.trys.pop();continue}W=s.call(d,u)}catch(Y){W=[6,Y],A=0}finally{g=E=0}if(W[0]&5)throw W[1];return{value:W[0]?W[1]:void 0,done:!0}}},Cb=function(){function d(s,u,g){if(this.formatMap=new Map([[Zi.QR_CODE,"qr_code"],[Zi.AZTEC,"aztec"],[Zi.CODABAR,"codabar"],[Zi.CODE_39,"code_39"],[Zi.CODE_93,"code_93"],[Zi.CODE_128,"code_128"],[Zi.DATA_MATRIX,"data_matrix"],[Zi.ITF,"itf"],[Zi.EAN_13,"ean_13"],[Zi.EAN_8,"ean_8"],[Zi.PDF_417,"pdf417"],[Zi.UPC_A,"upc_a"],[Zi.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!d.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=u,this.logger=g;var A=this.createBarcodeDetectorFormats(s);if(this.detector=new BarcodeDetector(A),!this.detector)throw"BarcodeDetector detector not supported"}return d.isSupported=function(){if(!("BarcodeDetector"in window))return!1;var s=new BarcodeDetector({formats:["qr_code"]});return typeof s<"u"},d.prototype.decodeAsync=function(s){return o4(this,void 0,void 0,function(){var u,g;return s4(this,function(A){switch(A.label){case 0:return[4,this.detector.detect(s)];case 1:if(u=A.sent(),!u||u.length===0)throw"No barcode or QR code detected.";return g=this.selectLargestBarcode(u),[2,{text:g.rawValue,format:bC.create(this.toHtml5QrcodeSupportedFormats(g.format)),debugData:this.createDebugData()}]}})})},d.prototype.selectLargestBarcode=function(s){for(var u=null,g=0,A=0,E=s;A<E.length;A++){var O=E[A],r=O.boundingBox.width*O.boundingBox.height;r>g&&(g=r,u=O)}if(!u)throw"No largest barcode found";return u},d.prototype.createBarcodeDetectorFormats=function(s){for(var u=[],g=0,A=s;g<A.length;g++){var E=A[g];this.formatMap.has(E)?u.push(this.formatMap.get(E)):this.logger.warn("".concat(E," is not supported by")+"BarcodeDetectorDelegate")}return{formats:u}},d.prototype.toHtml5QrcodeSupportedFormats=function(s){if(!this.reverseFormatMap.has(s))throw"reverseFormatMap doesn't have ".concat(s);return this.reverseFormatMap.get(s)},d.prototype.createReverseFormatMap=function(){var s=new Map;return this.formatMap.forEach(function(u,g,A){s.set(u,g)}),s},d.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},d}(),Eb=globalThis&&globalThis.__awaiter||function(d,s,u,g){function A(E){return E instanceof u?E:new u(function(O){O(E)})}return new(u||(u=Promise))(function(E,O){function r(Y){try{W(g.next(Y))}catch(se){O(se)}}function U(Y){try{W(g.throw(Y))}catch(se){O(se)}}function W(Y){Y.done?E(Y.value):A(Y.value).then(r,U)}W((g=g.apply(d,s||[])).next())})},Tb=globalThis&&globalThis.__generator||function(d,s){var u={label:0,sent:function(){if(E[0]&1)throw E[1];return E[1]},trys:[],ops:[]},g,A,E,O;return O={next:r(0),throw:r(1),return:r(2)},typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function r(W){return function(Y){return U([W,Y])}}function U(W){if(g)throw new TypeError("Generator is already executing.");for(;O&&(O=0,W[0]&&(u=0)),u;)try{if(g=1,A&&(E=W[0]&2?A.return:W[0]?A.throw||((E=A.return)&&E.call(A),0):A.next)&&!(E=E.call(A,W[1])).done)return E;switch(A=0,E&&(W=[W[0]&2,E.value]),W[0]){case 0:case 1:E=W;break;case 4:return u.label++,{value:W[1],done:!1};case 5:u.label++,A=W[1],W=[0];continue;case 7:W=u.ops.pop(),u.trys.pop();continue;default:if(E=u.trys,!(E=E.length>0&&E[E.length-1])&&(W[0]===6||W[0]===2)){u=0;continue}if(W[0]===3&&(!E||W[1]>E[0]&&W[1]<E[3])){u.label=W[1];break}if(W[0]===6&&u.label<E[1]){u.label=E[1],E=W;break}if(E&&u.label<E[2]){u.label=E[2],u.ops.push(W);break}E[2]&&u.ops.pop(),u.trys.pop();continue}W=s.call(d,u)}catch(Y){W=[6,Y],A=0}finally{g=E=0}if(W[0]&5)throw W[1];return{value:W[0]?W[1]:void 0,done:!0}}},a4=function(){function d(s,u,g,A){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=g,u&&Cb.isSupported()?(this.primaryDecoder=new Cb(s,g,A),this.secondaryDecoder=new bb(s,g,A)):this.primaryDecoder=new bb(s,g,A)}return d.prototype.decodeAsync=function(s){return Eb(this,void 0,void 0,function(){var u;return Tb(this,function(g){switch(g.label){case 0:u=performance.now(),g.label=1;case 1:return g.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(s)];case 2:return[2,g.sent()];case 3:return this.possiblyLogPerformance(u),[7];case 4:return[2]}})})},d.prototype.decodeRobustlyAsync=function(s){return Eb(this,void 0,void 0,function(){var u,g;return Tb(this,function(A){switch(A.label){case 0:u=performance.now(),A.label=1;case 1:return A.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(s)];case 2:return[2,A.sent()];case 3:if(g=A.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(s)];throw g;case 4:return this.possiblyLogPerformance(u),[7];case 5:return[2]}})})},d.prototype.getDecoder=function(){return this.secondaryDecoder?this.wasPrimaryDecoderUsedInLastDecode===!1?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},d.prototype.possiblyLogPerformance=function(s){if(this.verbose){var u=performance.now()-s;this.executionResults.push(u),this.executions++,this.possiblyFlushPerformanceReport()}},d.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var s=0,u=0,g=this.executionResults;u<g.length;u++){var A=g[u];s+=A}var E=s/this.executionResults.length;console.log("".concat(E," ms for ").concat(this.executionResults.length," last runs.")),this.executions=0,this.executionResults=[]}},d}(),ny=globalThis&&globalThis.__extends||function(){var d=function(s,u){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,A){g.__proto__=A}||function(g,A){for(var E in A)Object.prototype.hasOwnProperty.call(A,E)&&(g[E]=A[E])},d(s,u)};return function(s,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");d(s,u);function g(){this.constructor=s}s.prototype=u===null?Object.create(u):(g.prototype=u.prototype,new g)}}(),Vg=globalThis&&globalThis.__awaiter||function(d,s,u,g){function A(E){return E instanceof u?E:new u(function(O){O(E)})}return new(u||(u=Promise))(function(E,O){function r(Y){try{W(g.next(Y))}catch(se){O(se)}}function U(Y){try{W(g.throw(Y))}catch(se){O(se)}}function W(Y){Y.done?E(Y.value):A(Y.value).then(r,U)}W((g=g.apply(d,s||[])).next())})},Ug=globalThis&&globalThis.__generator||function(d,s){var u={label:0,sent:function(){if(E[0]&1)throw E[1];return E[1]},trys:[],ops:[]},g,A,E,O;return O={next:r(0),throw:r(1),return:r(2)},typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function r(W){return function(Y){return U([W,Y])}}function U(W){if(g)throw new TypeError("Generator is already executing.");for(;O&&(O=0,W[0]&&(u=0)),u;)try{if(g=1,A&&(E=W[0]&2?A.return:W[0]?A.throw||((E=A.return)&&E.call(A),0):A.next)&&!(E=E.call(A,W[1])).done)return E;switch(A=0,E&&(W=[W[0]&2,E.value]),W[0]){case 0:case 1:E=W;break;case 4:return u.label++,{value:W[1],done:!1};case 5:u.label++,A=W[1],W=[0];continue;case 7:W=u.ops.pop(),u.trys.pop();continue;default:if(E=u.trys,!(E=E.length>0&&E[E.length-1])&&(W[0]===6||W[0]===2)){u=0;continue}if(W[0]===3&&(!E||W[1]>E[0]&&W[1]<E[3])){u.label=W[1];break}if(W[0]===6&&u.label<E[1]){u.label=E[1],E=W;break}if(E&&u.label<E[2]){u.label=E[2],u.ops.push(W);break}E[2]&&u.ops.pop(),u.trys.pop();continue}W=s.call(d,u)}catch(Y){W=[6,Y],A=0}finally{g=E=0}if(W[0]&5)throw W[1];return{value:W[0]?W[1]:void 0,done:!0}}},SC=function(){function d(s,u){this.name=s,this.track=u}return d.prototype.isSupported=function(){return this.track.getCapabilities?this.name in this.track.getCapabilities():!1},d.prototype.apply=function(s){var u={};u[this.name]=s;var g={advanced:[u]};return this.track.applyConstraints(g)},d.prototype.value=function(){var s=this.track.getSettings();if(this.name in s){var u=s[this.name];return u}return null},d}(),l4=function(d){ny(s,d);function s(u,g){return d.call(this,u,g)||this}return s.prototype.min=function(){return this.getCapabilities().min},s.prototype.max=function(){return this.getCapabilities().max},s.prototype.step=function(){return this.getCapabilities().step},s.prototype.apply=function(u){var g={};g[this.name]=u;var A={advanced:[g]};return this.track.applyConstraints(A)},s.prototype.getCapabilities=function(){this.failIfNotSupported();var u=this.track.getCapabilities(),g=u[this.name];return{min:g.min,max:g.max,step:g.step}},s.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},s}(SC),c4=function(d){ny(s,d);function s(u){return d.call(this,"zoom",u)||this}return s}(l4),u4=function(d){ny(s,d);function s(u){return d.call(this,"torch",u)||this}return s}(SC),h4=function(){function d(s){this.track=s}return d.prototype.zoomFeature=function(){return new c4(this.track)},d.prototype.torchFeature=function(){return new u4(this.track)},d}(),d4=function(){function d(s,u,g){this.isClosed=!1,this.parentElement=s,this.mediaStream=u,this.callbacks=g,this.surface=this.createVideoElement(this.parentElement.clientWidth),s.append(this.surface)}return d.prototype.createVideoElement=function(s){var u=document.createElement("video");return u.style.width="".concat(s,"px"),u.style.display="block",u.muted=!0,u.setAttribute("muted","true"),u.playsInline=!0,u},d.prototype.setupSurface=function(){var s=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var u=function(){var g=s.surface.clientWidth,A=s.surface.clientHeight;s.callbacks.onRenderSurfaceReady(g,A),s.surface.removeEventListener("playing",u)};this.surface.addEventListener("playing",u),this.surface.srcObject=this.mediaStream,this.surface.play()},d.create=function(s,u,g,A){return Vg(this,void 0,void 0,function(){var E,O;return Ug(this,function(r){switch(r.label){case 0:return E=new d(s,u,A),g.aspectRatio?(O={aspectRatio:g.aspectRatio},[4,E.getFirstTrackOrFail().applyConstraints(O)]):[3,2];case 1:r.sent(),r.label=2;case 2:return E.setupSurface(),[2,E]}})})},d.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},d.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),this.mediaStream.getVideoTracks().length===0)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},d.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},d.prototype.resume=function(s){this.failIfClosed();var u=this,g=function(){setTimeout(s,200),u.surface.removeEventListener("playing",g)};this.surface.addEventListener("playing",g),this.surface.play()},d.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},d.prototype.getSurface=function(){return this.failIfClosed(),this.surface},d.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},d.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},d.prototype.applyVideoConstraints=function(s){return Vg(this,void 0,void 0,function(){return Ug(this,function(u){if("aspectRatio"in s)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(s)]})})},d.prototype.close=function(){if(this.isClosed)return Promise.resolve();var s=this;return new Promise(function(u,g){var A=s.mediaStream.getVideoTracks(),E=A.length,O=0;s.mediaStream.getVideoTracks().forEach(function(r){s.mediaStream.removeTrack(r),r.stop(),++O,O>=E&&(s.isClosed=!0,s.parentElement.removeChild(s.surface),u())})})},d.prototype.getCapabilities=function(){return new h4(this.getFirstTrackOrFail())},d}(),f4=function(){function d(s){this.mediaStream=s}return d.prototype.render=function(s,u,g){return Vg(this,void 0,void 0,function(){return Ug(this,function(A){return[2,d4.create(s,this.mediaStream,u,g)]})})},d.create=function(s){return Vg(this,void 0,void 0,function(){var u,g;return Ug(this,function(A){switch(A.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return u={audio:!1,video:s},[4,navigator.mediaDevices.getUserMedia(u)];case 1:return g=A.sent(),[2,new d(g)]}})})},d}(),Sb=globalThis&&globalThis.__awaiter||function(d,s,u,g){function A(E){return E instanceof u?E:new u(function(O){O(E)})}return new(u||(u=Promise))(function(E,O){function r(Y){try{W(g.next(Y))}catch(se){O(se)}}function U(Y){try{W(g.throw(Y))}catch(se){O(se)}}function W(Y){Y.done?E(Y.value):A(Y.value).then(r,U)}W((g=g.apply(d,s||[])).next())})},Ab=globalThis&&globalThis.__generator||function(d,s){var u={label:0,sent:function(){if(E[0]&1)throw E[1];return E[1]},trys:[],ops:[]},g,A,E,O;return O={next:r(0),throw:r(1),return:r(2)},typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function r(W){return function(Y){return U([W,Y])}}function U(W){if(g)throw new TypeError("Generator is already executing.");for(;O&&(O=0,W[0]&&(u=0)),u;)try{if(g=1,A&&(E=W[0]&2?A.return:W[0]?A.throw||((E=A.return)&&E.call(A),0):A.next)&&!(E=E.call(A,W[1])).done)return E;switch(A=0,E&&(W=[W[0]&2,E.value]),W[0]){case 0:case 1:E=W;break;case 4:return u.label++,{value:W[1],done:!1};case 5:u.label++,A=W[1],W=[0];continue;case 7:W=u.ops.pop(),u.trys.pop();continue;default:if(E=u.trys,!(E=E.length>0&&E[E.length-1])&&(W[0]===6||W[0]===2)){u=0;continue}if(W[0]===3&&(!E||W[1]>E[0]&&W[1]<E[3])){u.label=W[1];break}if(W[0]===6&&u.label<E[1]){u.label=E[1],E=W;break}if(E&&u.label<E[2]){u.label=E[2],u.ops.push(W);break}E[2]&&u.ops.pop(),u.trys.pop();continue}W=s.call(d,u)}catch(Y){W=[6,Y],A=0}finally{g=E=0}if(W[0]&5)throw W[1];return{value:W[0]?W[1]:void 0,done:!0}}},p4=function(){function d(){}return d.failIfNotSupported=function(){return Sb(this,void 0,void 0,function(){return Ab(this,function(s){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new d]})})},d.prototype.create=function(s){return Sb(this,void 0,void 0,function(){return Ab(this,function(u){return[2,f4.create(s)]})})},d}(),m4=globalThis&&globalThis.__awaiter||function(d,s,u,g){function A(E){return E instanceof u?E:new u(function(O){O(E)})}return new(u||(u=Promise))(function(E,O){function r(Y){try{W(g.next(Y))}catch(se){O(se)}}function U(Y){try{W(g.throw(Y))}catch(se){O(se)}}function W(Y){Y.done?E(Y.value):A(Y.value).then(r,U)}W((g=g.apply(d,s||[])).next())})},g4=globalThis&&globalThis.__generator||function(d,s){var u={label:0,sent:function(){if(E[0]&1)throw E[1];return E[1]},trys:[],ops:[]},g,A,E,O;return O={next:r(0),throw:r(1),return:r(2)},typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function r(W){return function(Y){return U([W,Y])}}function U(W){if(g)throw new TypeError("Generator is already executing.");for(;O&&(O=0,W[0]&&(u=0)),u;)try{if(g=1,A&&(E=W[0]&2?A.return:W[0]?A.throw||((E=A.return)&&E.call(A),0):A.next)&&!(E=E.call(A,W[1])).done)return E;switch(A=0,E&&(W=[W[0]&2,E.value]),W[0]){case 0:case 1:E=W;break;case 4:return u.label++,{value:W[1],done:!1};case 5:u.label++,A=W[1],W=[0];continue;case 7:W=u.ops.pop(),u.trys.pop();continue;default:if(E=u.trys,!(E=E.length>0&&E[E.length-1])&&(W[0]===6||W[0]===2)){u=0;continue}if(W[0]===3&&(!E||W[1]>E[0]&&W[1]<E[3])){u.label=W[1];break}if(W[0]===6&&u.label<E[1]){u.label=E[1],E=W;break}if(E&&u.label<E[2]){u.label=E[2],u.ops.push(W);break}E[2]&&u.ops.pop(),u.trys.pop();continue}W=s.call(d,u)}catch(Y){W=[6,Y],A=0}finally{g=E=0}if(W[0]&5)throw W[1];return{value:W[0]?W[1]:void 0,done:!0}}},_4=function(){function d(){}return d.retrieve=function(){if(navigator.mediaDevices)return d.getCamerasFromMediaDevices();var s=MediaStreamTrack;return MediaStreamTrack&&s.getSources?d.getCamerasFromMediaStreamTrack():d.rejectWithError()},d.rejectWithError=function(){var s=Od.unableToQuerySupportedDevices();return d.isHttpsOrLocalhost()||(s=Od.insecureContextCameraQueryError()),Promise.reject(s)},d.isHttpsOrLocalhost=function(){if(location.protocol==="https:")return!0;var s=location.host.split(":")[0];return s==="127.0.0.1"||s==="localhost"},d.getCamerasFromMediaDevices=function(){return m4(this,void 0,void 0,function(){var s,u,g,A,E,O,r;return g4(this,function(U){switch(U.label){case 0:return s=function(W){for(var Y=W.getVideoTracks(),se=0,Ae=Y;se<Ae.length;se++){var Ce=Ae[se];Ce.enabled=!1,Ce.stop(),W.removeTrack(Ce)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return u=U.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(g=U.sent(),A=[],E=0,O=g;E<O.length;E++)r=O[E],r.kind==="videoinput"&&A.push({id:r.deviceId,label:r.label});return s(u),[2,A]}})})},d.getCamerasFromMediaStreamTrack=function(){return new Promise(function(s,u){var g=function(E){for(var O=[],r=0,U=E;r<U.length;r++){var W=U[r];W.kind==="video"&&O.push({id:W.id,label:W.label})}s(O)},A=MediaStreamTrack;A.getSources(g)})},d}(),Qo;(function(d){d[d.UNKNOWN=0]="UNKNOWN",d[d.NOT_STARTED=1]="NOT_STARTED",d[d.SCANNING=2]="SCANNING",d[d.PAUSED=3]="PAUSED"})(Qo||(Qo={}));var y4=function(){function d(){this.state=Qo.NOT_STARTED,this.onGoingTransactionNewState=Qo.UNKNOWN}return d.prototype.directTransition=function(s){this.failIfTransitionOngoing(),this.validateTransition(s),this.state=s},d.prototype.startTransition=function(s){return this.failIfTransitionOngoing(),this.validateTransition(s),this.onGoingTransactionNewState=s,this},d.prototype.execute=function(){if(this.onGoingTransactionNewState===Qo.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var s=this.onGoingTransactionNewState;this.onGoingTransactionNewState=Qo.UNKNOWN,this.directTransition(s)},d.prototype.cancel=function(){if(this.onGoingTransactionNewState===Qo.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=Qo.UNKNOWN},d.prototype.getState=function(){return this.state},d.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==Qo.UNKNOWN)throw"Cannot transition to a new state, already under transition"},d.prototype.validateTransition=function(s){switch(this.state){case Qo.UNKNOWN:throw"Transition from unknown is not allowed";case Qo.NOT_STARTED:this.failIfNewStateIs(s,[Qo.PAUSED]);break;case Qo.SCANNING:break;case Qo.PAUSED:break}},d.prototype.failIfNewStateIs=function(s,u){for(var g=0,A=u;g<A.length;g++){var E=A[g];if(s===E)throw"Cannot transition from ".concat(this.state," to ").concat(s)}},d}(),v4=function(){function d(s){this.stateManager=s}return d.prototype.startTransition=function(s){return this.stateManager.startTransition(s)},d.prototype.directTransition=function(s){this.stateManager.directTransition(s)},d.prototype.getState=function(){return this.stateManager.getState()},d.prototype.canScanFile=function(){return this.stateManager.getState()===Qo.NOT_STARTED},d.prototype.isScanning=function(){return this.stateManager.getState()!==Qo.NOT_STARTED},d.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===Qo.SCANNING},d.prototype.isPaused=function(){return this.stateManager.getState()===Qo.PAUSED},d}(),x4=function(){function d(){}return d.create=function(){return new v4(new y4)},d}(),w4=globalThis&&globalThis.__extends||function(){var d=function(s,u){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,A){g.__proto__=A}||function(g,A){for(var E in A)Object.prototype.hasOwnProperty.call(A,E)&&(g[E]=A[E])},d(s,u)};return function(s,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");d(s,u);function g(){this.constructor=s}s.prototype=u===null?Object.create(u):(g.prototype=u.prototype,new g)}}(),Qa=function(d){w4(s,d);function s(){return d!==null&&d.apply(this,arguments)||this}return s.DEFAULT_WIDTH=300,s.DEFAULT_WIDTH_OFFSET=2,s.FILE_SCAN_MIN_HEIGHT=300,s.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,s.MIN_QR_BOX_SIZE=50,s.SHADED_LEFT=1,s.SHADED_RIGHT=2,s.SHADED_TOP=3,s.SHADED_BOTTOM=4,s.SHADED_REGION_ELEMENT_ID="qr-shaded-region",s.VERBOSE=!1,s.BORDER_SHADER_DEFAULT_COLOR="#ffffff",s.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",s}(jl),b4=function(){function d(s,u){this.logger=u,this.fps=Qa.SCAN_DEFAULT_FPS,s?(s.fps&&(this.fps=s.fps),this.disableFlip=s.disableFlip===!0,this.qrbox=s.qrbox,this.aspectRatio=s.aspectRatio,this.videoConstraints=s.videoConstraints):this.disableFlip=Qa.DEFAULT_DISABLE_FLIP}return d.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?TC.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},d.prototype.isShadedBoxEnabled=function(){return!vc(this.qrbox)},d.create=function(s,u){return new d(s,u)},d}(),D_=function(){function d(s,u){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(s))throw"HTML Element with id=".concat(s," not found");this.elementId=s,this.verbose=!1;var g;typeof u=="boolean"?this.verbose=u===!0:u&&(g=u,this.verbose=g.verbose===!0,g.experimentalFeatures),this.logger=new EC(this.verbose),this.qrcode=new a4(this.getSupportedFormats(u),this.getUseBarCodeDetectorIfSupported(g),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=x4.create()}return d.prototype.start=function(s,u,g,A){var E=this;if(!s)throw"cameraIdOrConfig is required";if(!g||typeof g!="function")throw"qrCodeSuccessCallback is required and should be a function.";var O;A?O=A:O=this.verbose?this.logger.log:function(){};var r=b4.create(u,this.logger);this.clearElement();var U=!1;r.videoConstraints&&(r.isMediaStreamConstraintsValid()?U=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var W=U,Y=document.getElementById(this.elementId);Y.clientWidth?Y.clientWidth:Qa.DEFAULT_WIDTH,Y.style.position="relative",this.shouldScan=!0,this.element=Y;var se=this,Ae=this.stateManagerProxy.startTransition(Qo.SCANNING);return new Promise(function(Ce,he){var K=W?r.videoConstraints:se.createVideoConstraints(s);if(!K){Ae.cancel(),he("videoConstraints should be defined");return}var N={};(!W||r.aspectRatio)&&(N.aspectRatio=r.aspectRatio);var z={onRenderSurfaceReady:function(q,G){se.setupUi(q,G,r),se.isScanning=!0,se.foreverScan(r,g,O)}};p4.failIfNotSupported().then(function(q){q.create(K).then(function(G){return G.render(E.element,N,z).then(function(Q){se.renderedCamera=Q,Ae.execute(),Ce(null)}).catch(function(Q){Ae.cancel(),he(Q)})}).catch(function(G){Ae.cancel(),he(Od.errorGettingUserMedia(G))})}).catch(function(q){Ae.cancel(),he(Od.cameraStreamingNotSupported())})})},d.prototype.pause=function(s){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(Qo.PAUSED),this.showPausedState(),(vc(s)||s!==!0)&&(s=!1),s&&this.renderedCamera&&this.renderedCamera.pause()},d.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var s=this,u=function(){s.stateManagerProxy.directTransition(Qo.SCANNING),s.hidePausedState()};if(!this.renderedCamera.isPaused()){u();return}this.renderedCamera.resume(function(){u()})},d.prototype.getState=function(){return this.stateManagerProxy.getState()},d.prototype.stop=function(){var s=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var u=this.stateManagerProxy.startTransition(Qo.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var g=function(){if(s.element){var E=document.getElementById(Qa.SHADED_REGION_ELEMENT_ID);E&&s.element.removeChild(E)}},A=this;return this.renderedCamera.close().then(function(){return A.renderedCamera=null,A.element&&(A.element.removeChild(A.canvasElement),A.canvasElement=null),g(),A.qrRegion&&(A.qrRegion=null),A.context&&(A.context=null),u.execute(),A.hidePausedState(),A.isScanning=!1,Promise.resolve()})},d.prototype.scanFile=function(s,u){return this.scanFileV2(s,u).then(function(g){return g.decodedText})},d.prototype.scanFileV2=function(s,u){var g=this;if(!s||!(s instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(vc(u)&&(u=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(A,E){g.possiblyCloseLastScanImageFile(),g.clearElement(),g.lastScanImageFile=URL.createObjectURL(s);var O=new Image;O.onload=function(){var r=O.width,U=O.height,W=document.getElementById(g.elementId),Y=W.clientWidth?W.clientWidth:Qa.DEFAULT_WIDTH,se=Math.max(W.clientHeight?W.clientHeight:U,Qa.FILE_SCAN_MIN_HEIGHT),Ae=g.computeCanvasDrawConfig(r,U,Y,se);if(u){var Ce=g.createCanvasElement(Y,se,"qr-canvas-visible");Ce.style.display="inline-block",W.appendChild(Ce);var he=Ce.getContext("2d");if(!he)throw"Unable to get 2d context from canvas";he.canvas.width=Y,he.canvas.height=se,he.drawImage(O,0,0,r,U,Ae.x,Ae.y,Ae.width,Ae.height)}var K=Qa.FILE_SCAN_HIDDEN_CANVAS_PADDING,N=Math.max(O.width,Ae.width),z=Math.max(O.height,Ae.height),q=N+2*K,G=z+2*K,Q=g.createCanvasElement(q,G);W.appendChild(Q);var ee=Q.getContext("2d");if(!ee)throw"Unable to get 2d context from canvas";ee.canvas.width=q,ee.canvas.height=G,ee.drawImage(O,0,0,r,U,K,K,N,z);try{g.qrcode.decodeRobustlyAsync(Q).then(function(fe){A(xb.createFromQrcodeResult(fe))}).catch(E)}catch(fe){E("QR code parse error, error = ".concat(fe))}},O.onerror=E,O.onabort=E,O.onstalled=E,O.onsuspend=E,O.src=URL.createObjectURL(s)})},d.prototype.clear=function(){this.clearElement()},d.getCameras=function(){return _4.retrieve()},d.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},d.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},d.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},d.prototype.applyVideoConstraints=function(s){if(s){if(!TC.isMediaStreamConstraintsValid(s,this.logger))throw"invalid videoConstaints passed, check logs for more details"}else throw"videoConstaints is required argument.";return this.getRenderedCameraOrFail().applyVideoConstraints(s)},d.prototype.getRenderedCameraOrFail=function(){if(this.renderedCamera==null)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},d.prototype.getSupportedFormats=function(s){var u=[Zi.QR_CODE,Zi.AZTEC,Zi.CODABAR,Zi.CODE_39,Zi.CODE_93,Zi.CODE_128,Zi.DATA_MATRIX,Zi.MAXICODE,Zi.ITF,Zi.EAN_13,Zi.EAN_8,Zi.PDF_417,Zi.RSS_14,Zi.RSS_EXPANDED,Zi.UPC_A,Zi.UPC_E,Zi.UPC_EAN_EXTENSION];if(!s||typeof s=="boolean"||!s.formatsToSupport)return u;if(!Array.isArray(s.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(s.formatsToSupport.length===0)throw"Atleast 1 formatsToSupport is needed.";for(var g=[],A=0,E=s.formatsToSupport;A<E.length;A++){var O=E[A];t4(O)?g.push(O):this.logger.warn("Invalid format: ".concat(O," passed in config, ignoring."))}if(g.length===0)throw"None of formatsToSupport match supported values.";return g},d.prototype.getUseBarCodeDetectorIfSupported=function(s){if(vc(s))return!0;if(!vc(s.useBarCodeDetectorIfSupported))return s.useBarCodeDetectorIfSupported!==!1;if(vc(s.experimentalFeatures))return!0;var u=s.experimentalFeatures;return vc(u.useBarCodeDetectorIfSupported)?!0:u.useBarCodeDetectorIfSupported!==!1},d.prototype.validateQrboxSize=function(s,u,g){var A=this,E=g.qrbox;this.validateQrboxConfig(E);var O=this.toQrdimensions(s,u,E),r=function(W){if(W<Qa.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(Qa.MIN_QR_BOX_SIZE,"px.")},U=function(W){return W>s&&(A.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),W=s),W};r(O.width),r(O.height),O.width=U(O.width)},d.prototype.validateQrboxConfig=function(s){if(typeof s!="number"&&typeof s!="function"&&(s.width===void 0||s.height===void 0))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},d.prototype.toQrdimensions=function(s,u,g){if(typeof g=="number")return{width:g,height:g};if(typeof g=="function")try{return g(s,u)}catch(A){throw new Error("qrbox config was passed as a function but it failed with unknown error"+A)}return g},d.prototype.setupUi=function(s,u,g){g.isShadedBoxEnabled()&&this.validateQrboxSize(s,u,g);var A=vc(g.qrbox)?{width:s,height:u}:g.qrbox;this.validateQrboxConfig(A);var E=this.toQrdimensions(s,u,A);E.height>u&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var O=g.isShadedBoxEnabled()&&E.height<=u,r={x:0,y:0,width:s,height:u},U=O?this.getShadedRegionBounds(s,u,E):r,W=this.createCanvasElement(U.width,U.height),Y={willReadFrequently:!0},se=W.getContext("2d",Y);se.canvas.width=U.width,se.canvas.height=U.height,this.element.append(W),O&&this.possiblyInsertShadingElement(this.element,s,u,E),this.createScannerPausedUiElement(this.element),this.qrRegion=U,this.context=se,this.canvasElement=W},d.prototype.createScannerPausedUiElement=function(s){var u=document.createElement("div");u.innerText=Od.scannerPaused(),u.style.display="none",u.style.position="absolute",u.style.top="0px",u.style.zIndex="1",u.style.background="rgba(9, 9, 9, 0.46)",u.style.color="#FFECEC",u.style.textAlign="center",u.style.width="100%",s.appendChild(u),this.scannerPausedUiElement=u},d.prototype.scanContext=function(s,u){var g=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(A){return s(A.text,xb.createFromQrcodeResult(A)),g.possiblyUpdateShaders(!0),!0}).catch(function(A){g.possiblyUpdateShaders(!1);var E=Od.codeParseError(A);return u(E,CC.createFrom(E)),!1})},d.prototype.foreverScan=function(s,u,g){var A=this;if(this.shouldScan&&this.renderedCamera){var E=this.renderedCamera.getSurface(),O=E.videoWidth/E.clientWidth,r=E.videoHeight/E.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var U=this.qrRegion.width*O,W=this.qrRegion.height*r,Y=this.qrRegion.x*O,se=this.qrRegion.y*r;this.context.drawImage(E,Y,se,U,W,0,0,this.qrRegion.width,this.qrRegion.height);var Ae=function(){A.foreverScanTimeout=setTimeout(function(){A.foreverScan(s,u,g)},A.getTimeoutFps(s.fps))};this.scanContext(u,g).then(function(Ce){!Ce&&s.disableFlip!==!0?(A.context.translate(A.context.canvas.width,0),A.context.scale(-1,1),A.scanContext(u,g).finally(function(){Ae()})):Ae()}).catch(function(Ce){A.logger.logError("Error happend while scanning context",Ce),Ae()})}},d.prototype.createVideoConstraints=function(s){if(typeof s=="string")return{deviceId:{exact:s}};if(typeof s=="object"){var u="facingMode",g="deviceId",A={user:!0,environment:!0},E="exact",O=function(he){if(he in A)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(he,"'")},r=Object.keys(s);if(r.length!==1)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(r.length," keys");var U=Object.keys(s)[0];if(U!==u&&U!==g)throw"Only '".concat(u,"' and '").concat(g,"' ")+" are supported for 'cameraIdOrConfig'";if(U===u){var W=s.facingMode;if(typeof W=="string"){if(O(W))return{facingMode:W}}else if(typeof W=="object")if(E in W){if(O(W["".concat(E)]))return{facingMode:{exact:W["".concat(E)]}}}else throw"'facingMode' should be string or object with"+" ".concat(E," as key.");else{var Y=typeof W;throw"Invalid type of 'facingMode' = ".concat(Y)}}else{var se=s.deviceId;if(typeof se=="string")return{deviceId:se};if(typeof se=="object"){if(E in se)return{deviceId:{exact:se["".concat(E)]}};throw"'deviceId' should be string or object with"+" ".concat(E," as key.")}else{var Ae=typeof se;throw"Invalid type of 'deviceId' = ".concat(Ae)}}}var Ce=typeof s;throw"Invalid type of 'cameraIdOrConfig' = ".concat(Ce)},d.prototype.computeCanvasDrawConfig=function(s,u,g,A){if(s<=g&&u<=A){var E=(g-s)/2,O=(A-u)/2;return{x:E,y:O,width:s,height:u}}else{var r=s,U=u;return s>g&&(u=g/s*u,s=g),u>A&&(s=A/u*s,u=A),this.logger.log("Image downsampled from "+"".concat(r,"X").concat(U)+" to ".concat(s,"X").concat(u,".")),this.computeCanvasDrawConfig(s,u,g,A)}},d.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var s=document.getElementById(this.elementId);s&&(s.innerHTML="")},d.prototype.possiblyUpdateShaders=function(s){this.qrMatch!==s&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(u){u.style.backgroundColor=s?Qa.BORDER_SHADER_MATCH_COLOR:Qa.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=s)},d.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},d.prototype.createCanvasElement=function(s,u,g){var A=s,E=u,O=document.createElement("canvas");return O.style.width="".concat(A,"px"),O.style.height="".concat(E,"px"),O.style.display="none",O.id=vc(g)?"qr-canvas":g,O},d.prototype.getShadedRegionBounds=function(s,u,g){if(g.width>s||g.height>u)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(s-g.width)/2,y:(u-g.height)/2,width:g.width,height:g.height}},d.prototype.possiblyInsertShadingElement=function(s,u,g,A){if(!(u-A.width<1||g-A.height<1)){var E=document.createElement("div");E.style.position="absolute";var O=(u-A.width)/2,r=(g-A.height)/2;if(E.style.borderLeft="".concat(O,"px solid rgba(0, 0, 0, 0.48)"),E.style.borderRight="".concat(O,"px solid rgba(0, 0, 0, 0.48)"),E.style.borderTop="".concat(r,"px solid rgba(0, 0, 0, 0.48)"),E.style.borderBottom="".concat(r,"px solid rgba(0, 0, 0, 0.48)"),E.style.boxSizing="border-box",E.style.top="0px",E.style.bottom="0px",E.style.left="0px",E.style.right="0px",E.id="".concat(Qa.SHADED_REGION_ELEMENT_ID),u-A.width<11||g-A.height<11)this.hasBorderShaders=!1;else{var U=5,W=40;this.insertShaderBorders(E,W,U,-U,null,0,!0),this.insertShaderBorders(E,W,U,-U,null,0,!1),this.insertShaderBorders(E,W,U,null,-U,0,!0),this.insertShaderBorders(E,W,U,null,-U,0,!1),this.insertShaderBorders(E,U,W+U,-U,null,-U,!0),this.insertShaderBorders(E,U,W+U,null,-U,-U,!0),this.insertShaderBorders(E,U,W+U,-U,null,-U,!1),this.insertShaderBorders(E,U,W+U,null,-U,-U,!1),this.hasBorderShaders=!0}s.append(E)}},d.prototype.insertShaderBorders=function(s,u,g,A,E,O,r){var U=document.createElement("div");U.style.position="absolute",U.style.backgroundColor=Qa.BORDER_SHADER_DEFAULT_COLOR,U.style.width="".concat(u,"px"),U.style.height="".concat(g,"px"),A!==null&&(U.style.top="".concat(A,"px")),E!==null&&(U.style.bottom="".concat(E,"px")),r?U.style.left="".concat(O,"px"):U.style.right="".concat(O,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(U),s.appendChild(U)},d.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},d.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},d.prototype.getTimeoutFps=function(s){return 1e3/s},d}(),ry="data:image/svg+xml;base64,",C4=ry+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzNzEuNjQzIDM3MS42NDMiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDM3MS42NDMgMzcxLjY0MyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHBhdGggZD0iTTEwNS4wODQgMzguMjcxaDE2My43Njh2MjBIMTA1LjA4NHoiLz48cGF0aCBkPSJNMzExLjU5NiAxOTAuMTg5Yy03LjQ0MS05LjM0Ny0xOC40MDMtMTYuMjA2LTMyLjc0My0yMC41MjJWMzBjMC0xNi41NDItMTMuNDU4LTMwLTMwLTMwSDEyNS4wODRjLTE2LjU0MiAwLTMwIDEzLjQ1OC0zMCAzMHYxMjAuMTQzaC04LjI5NmMtMTYuNTQyIDAtMzAgMTMuNDU4LTMwIDMwdjEuMzMzYTI5LjgwNCAyOS44MDQgMCAwIDAgNC42MDMgMTUuOTM5Yy03LjM0IDUuNDc0LTEyLjEwMyAxNC4yMjEtMTIuMTAzIDI0LjA2MXYxLjMzM2MwIDkuODQgNC43NjMgMTguNTg3IDEyLjEwMyAyNC4wNjJhMjkuODEgMjkuODEgMCAwIDAtNC42MDMgMTUuOTM4djEuMzMzYzAgMTYuNTQyIDEzLjQ1OCAzMCAzMCAzMGg4LjMyNGMuNDI3IDExLjYzMSA3LjUwMyAyMS41ODcgMTcuNTM0IDI2LjE3Ny45MzEgMTAuNTAzIDQuMDg0IDMwLjE4NyAxNC43NjggNDUuNTM3YTkuOTg4IDkuOTg4IDAgMCAwIDguMjE2IDQuMjg4IDkuOTU4IDkuOTU4IDAgMCAwIDUuNzA0LTEuNzkzYzQuNTMzLTMuMTU1IDUuNjUtOS4zODggMi40OTUtMTMuOTIxLTYuNzk4LTkuNzY3LTkuNjAyLTIyLjYwOC0xMC43Ni0zMS40aDgyLjY4NWMuMjcyLjQxNC41NDUuODE4LjgxNSAxLjIxIDMuMTQyIDQuNTQxIDkuMzcyIDUuNjc5IDEzLjkxMyAyLjUzNCA0LjU0Mi0zLjE0MiA1LjY3Ny05LjM3MSAyLjUzNS0xMy45MTMtMTEuOTE5LTE3LjIyOS04Ljc4Ny0zNS44ODQgOS41ODEtNTcuMDEyIDMuMDY3LTIuNjUyIDEyLjMwNy0xMS43MzIgMTEuMjE3LTI0LjAzMy0uODI4LTkuMzQzLTcuMTA5LTE3LjE5NC0xOC42NjktMjMuMzM3YTkuODU3IDkuODU3IDAgMCAwLTEuMDYxLS40ODZjLS40NjYtLjE4Mi0xMS40MDMtNC41NzktOS43NDEtMTUuNzA2IDEuMDA3LTYuNzM3IDE0Ljc2OC04LjI3MyAyMy43NjYtNy42NjYgMjMuMTU2IDEuNTY5IDM5LjY5OCA3LjgwMyA0Ny44MzYgMTguMDI2IDUuNzUyIDcuMjI1IDcuNjA3IDE2LjYyMyA1LjY3MyAyOC43MzMtLjQxMyAyLjU4NS0uODI0IDUuMjQxLTEuMjQ1IDcuOTU5LTUuNzU2IDM3LjE5NC0xMi45MTkgODMuNDgzLTQ5Ljg3IDExNC42NjEtNC4yMjEgMy41NjEtNC43NTYgOS44Ny0xLjE5NCAxNC4wOTJhOS45OCA5Ljk4IDAgMCAwIDcuNjQ4IDMuNTUxIDkuOTU1IDkuOTU1IDAgMCAwIDYuNDQ0LTIuMzU4YzQyLjY3Mi0zNi4wMDUgNTAuODAyLTg4LjUzMyA1Ni43MzctMTI2Ljg4OC40MTUtMi42ODQuODIxLTUuMzA5IDEuMjI5LTcuODYzIDIuODM0LTE3LjcyMS0uNDU1LTMyLjY0MS05Ljc3Mi00NC4zNDV6bS0yMzIuMzA4IDQyLjYyYy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM2MwLTUuNTE0IDQuNDg2LTEwIDEwLTEwaDE1djIxLjMzM2gtMTV6bS0yLjUtNTIuNjY2YzAtNS41MTQgNC40ODYtMTAgMTAtMTBoNy41djIxLjMzM2gtNy41Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM3ptMTcuNSA5My45OTloLTcuNWMtNS41MTQgMC0xMC00LjQ4Ni0xMC0xMHYtMS4zMzNjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGg3LjV2MjEuMzMzem0zMC43OTYgMjguODg3Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi04LjI3MWg5MS40NTdjLS44NTEgNi42NjgtLjQzNyAxMi43ODcuNzMxIDE4LjI3MWgtODIuMTg4em03OS40ODItMTEzLjY5OGMtMy4xMjQgMjAuOTA2IDEyLjQyNyAzMy4xODQgMjEuNjI1IDM3LjA0IDUuNDQxIDIuOTY4IDcuNTUxIDUuNjQ3IDcuNzAxIDcuMTg4LjIxIDIuMTUtMi41NTMgNS42ODQtNC40NzcgNy4yNTEtLjQ4Mi4zNzgtLjkyOS44LTEuMzM1IDEuMjYxLTYuOTg3IDcuOTM2LTExLjk4MiAxNS41Mi0xNS40MzIgMjIuNjg4aC05Ny41NjRWMzBjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGgxMjMuNzY5YzUuNTE0IDAgMTAgNC40ODYgMTAgMTB2MTM1LjU3OWMtMy4wMzItLjM4MS02LjE1LS42OTQtOS4zODktLjkxNC0yNS4xNTktMS42OTQtNDIuMzcgNy43NDgtNDQuODk4IDI0LjY2NnoiLz48cGF0aCBkPSJNMTc5LjEyOSA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXpNMTcyLjYyOSAxNDIuODZoLTEyLjU2VjEzMC44YTUgNSAwIDEgMC0xMCAwdjE3LjA2MWE1IDUgMCAwIDAgNSA1aDE3LjU2YTUgNSAwIDEgMCAwLTEwLjAwMXpNMjE2LjU2OCA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXptLTUgMjQuMDYxaC0xNC4wNlY5My4xNjdoMTQuMDZ2MTQuMDYxek0yMTEuNjY5IDEyNS45MzZIMTk3LjQxYTUgNSAwIDAgMC01IDV2MTQuMjU3YTUgNSAwIDAgMCA1IDVoMTQuMjU5YTUgNSAwIDAgMCA1LTV2LTE0LjI1N2E1IDUgMCAwIDAtNS01eiIvPjwvc3ZnPg==",E4=ry+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1OS4wMTggNTkuMDE4IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1OS4wMTggNTkuMDE4IiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJtNTguNzQxIDU0LjgwOS01Ljk2OS02LjI0NGExMC43NCAxMC43NCAwIDAgMCAyLjgyLTcuMjVjMC01Ljk1My00Ljg0My0xMC43OTYtMTAuNzk2LTEwLjc5NlMzNCAzNS4zNjEgMzQgNDEuMzE0IDM4Ljg0MyA1Mi4xMSA0NC43OTYgNTIuMTFjMi40NDEgMCA0LjY4OC0uODI0IDYuNDk5LTIuMTk2bDYuMDAxIDYuMjc3YS45OTguOTk4IDAgMCAwIDEuNDE0LjAzMiAxIDEgMCAwIDAgLjAzMS0xLjQxNHpNMzYgNDEuMzE0YzAtNC44NSAzLjk0Ni04Ljc5NiA4Ljc5Ni04Ljc5NnM4Ljc5NiAzLjk0NiA4Ljc5NiA4Ljc5Ni0zLjk0NiA4Ljc5Ni04Ljc5NiA4Ljc5NlMzNiA0Ni4xNjQgMzYgNDEuMzE0ek0xMC40MzEgMTYuMDg4YzAgMy4wNyAyLjQ5OCA1LjU2OCA1LjU2OSA1LjU2OHM1LjU2OS0yLjQ5OCA1LjU2OS01LjU2OGMwLTMuMDcxLTIuNDk4LTUuNTY5LTUuNTY5LTUuNTY5cy01LjU2OSAyLjQ5OC01LjU2OSA1LjU2OXptOS4xMzggMGMwIDEuOTY4LTEuNjAyIDMuNTY4LTMuNTY5IDMuNTY4cy0zLjU2OS0xLjYwMS0zLjU2OS0zLjU2OCAxLjYwMi0zLjU2OSAzLjU2OS0zLjU2OSAzLjU2OSAxLjYwMSAzLjU2OSAzLjU2OXoiLz48cGF0aCBkPSJtMzAuODgyIDI4Ljk4NyA5LjE4LTEwLjA1NCAxMS4yNjIgMTAuMzIzYTEgMSAwIDAgMCAxLjM1MS0xLjQ3NWwtMTItMTFhMSAxIDAgMCAwLTEuNDE0LjA2M2wtOS43OTQgMTAuNzI3LTQuNzQzLTQuNzQzYTEuMDAzIDEuMDAzIDAgMCAwLTEuMzY4LS4wNDRMNi4zMzkgMzcuNzY4YTEgMSAwIDEgMCAxLjMyMiAxLjUwMWwxNi4zMTMtMTQuMzYyIDcuMzE5IDcuMzE4YS45OTkuOTk5IDAgMSAwIDEuNDE0LTEuNDE0bC0xLjgyNS0xLjgyNHoiLz48cGF0aCBkPSJNMzAgNDYuNTE4SDJ2LTQyaDU0djI4YTEgMSAwIDEgMCAyIDB2LTI5YTEgMSAwIDAgMC0xLTFIMWExIDEgMCAwIDAtMSAxdjQ0YTEgMSAwIDAgMCAxIDFoMjlhMSAxIDAgMSAwIDAtMnoiLz48L3N2Zz4=",Ib=ry+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NjAgNDYwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NjAgNDYwIiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJNMjMwIDBDMTAyLjk3NSAwIDAgMTAyLjk3NSAwIDIzMHMxMDIuOTc1IDIzMCAyMzAgMjMwIDIzMC0xMDIuOTc0IDIzMC0yMzBTMzU3LjAyNSAwIDIzMCAwem0zOC4zMzMgMzc3LjM2YzAgOC42NzYtNy4wMzQgMTUuNzEtMTUuNzEgMTUuNzFoLTQzLjEwMWMtOC42NzYgMC0xNS43MS03LjAzNC0xNS43MS0xNS43MVYyMDIuNDc3YzAtOC42NzYgNy4wMzMtMTUuNzEgMTUuNzEtMTUuNzFoNDMuMTAxYzguNjc2IDAgMTUuNzEgNy4wMzMgMTUuNzEgMTUuNzFWMzc3LjM2ek0yMzAgMTU3Yy0yMS41MzkgMC0zOS0xNy40NjEtMzktMzlzMTcuNDYxLTM5IDM5LTM5IDM5IDE3LjQ2MSAzOSAzOS0xNy40NjEgMzktMzkgMzl6Ii8+PC9zdmc+",T4="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAQgAAAEIBarqQRAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAE1SURBVDiNfdI7S0NBEAXgLya1otFgpbYSbISAgpXYi6CmiH9KCAiChaVga6OiWPgfRDQ+0itaGVNosXtluWwcuMzePfM4M3sq8lbHBubwg1dc4m1E/J/N4ghDPOIsfk/4xiEao5KX0McFljN4C9d4QTPXuY99jP3DsIoDPGM6BY5i5yI5R7O4q+ImFkJY2DCh3cAH2klyB+9J1xUMMAG7eCh1a+Mr+k48b5diXrFVwwLuS+BJ9MfR7+G0FHOHhTHhnXNWS87VDF4pcnfQK4Ep7XScNLmPTZgURNKKYENYWDpzW1BhscS1WHS8CDgURFJQrWcoF3c13KKbgg1BYQfy8xZWEzTTw1QZbAoKu8FqJnktdu5hcVSHmchiILzzuaDQvjBzV2m8yohCE1jHfPx/xhU+y4G/D75ELlRJsSYAAAAASUVORK5CYII=",Mb=function(){function d(){}return d.createDefault=function(){return{hasPermission:!1,lastUsedCameraId:null}},d}(),S4=function(){function d(){this.data=Mb.createDefault();var s=localStorage.getItem(d.LOCAL_STORAGE_KEY);s?this.data=JSON.parse(s):this.reset()}return d.prototype.hasCameraPermissions=function(){return this.data.hasPermission},d.prototype.getLastUsedCameraId=function(){return this.data.lastUsedCameraId},d.prototype.setHasPermission=function(s){this.data.hasPermission=s,this.flush()},d.prototype.setLastUsedCameraId=function(s){this.data.lastUsedCameraId=s,this.flush()},d.prototype.resetLastUsedCameraId=function(){this.data.lastUsedCameraId=null,this.flush()},d.prototype.reset=function(){this.data=Mb.createDefault(),this.flush()},d.prototype.flush=function(){localStorage.setItem(d.LOCAL_STORAGE_KEY,JSON.stringify(this.data))},d.LOCAL_STORAGE_KEY="HTML5_QRCODE_DATA",d}(),A4=function(){function d(){this.infoDiv=document.createElement("div")}return d.prototype.renderInto=function(s){this.infoDiv.style.position="absolute",this.infoDiv.style.top="10px",this.infoDiv.style.right="10px",this.infoDiv.style.zIndex="2",this.infoDiv.style.display="none",this.infoDiv.style.padding="5pt",this.infoDiv.style.border="1px solid #171717",this.infoDiv.style.fontSize="10pt",this.infoDiv.style.background="rgb(0 0 0 / 69%)",this.infoDiv.style.borderRadius="5px",this.infoDiv.style.textAlign="center",this.infoDiv.style.fontWeight="400",this.infoDiv.style.color="white",this.infoDiv.innerText=wb.poweredBy();var u=document.createElement("a");u.innerText="ScanApp",u.href="https://scanapp.org",u.target="new",u.style.color="white",this.infoDiv.appendChild(u);var g=document.createElement("br"),A=document.createElement("br");this.infoDiv.appendChild(g),this.infoDiv.appendChild(A);var E=document.createElement("a");E.innerText=wb.reportIssues(),E.href="https://github.com/mebjas/html5-qrcode/issues",E.target="new",E.style.color="white",this.infoDiv.appendChild(E),s.appendChild(this.infoDiv)},d.prototype.show=function(){this.infoDiv.style.display="block"},d.prototype.hide=function(){this.infoDiv.style.display="none"},d}(),I4=function(){function d(s,u){this.isShowingInfoIcon=!0,this.onTapIn=s,this.onTapOut=u,this.infoIcon=document.createElement("img")}return d.prototype.renderInto=function(s){var u=this;this.infoIcon.alt="Info icon",this.infoIcon.src=Ib,this.infoIcon.style.position="absolute",this.infoIcon.style.top="4px",this.infoIcon.style.right="4px",this.infoIcon.style.opacity="0.6",this.infoIcon.style.cursor="pointer",this.infoIcon.style.zIndex="2",this.infoIcon.style.width="16px",this.infoIcon.style.height="16px",this.infoIcon.onmouseover=function(g){return u.onHoverIn()},this.infoIcon.onmouseout=function(g){return u.onHoverOut()},this.infoIcon.onclick=function(g){return u.onClick()},s.appendChild(this.infoIcon)},d.prototype.onHoverIn=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="1")},d.prototype.onHoverOut=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="0.6")},d.prototype.onClick=function(){this.isShowingInfoIcon?(this.isShowingInfoIcon=!1,this.onTapIn(),this.infoIcon.src=T4,this.infoIcon.style.opacity="1"):(this.isShowingInfoIcon=!0,this.onTapOut(),this.infoIcon.src=Ib,this.infoIcon.style.opacity="0.6")},d}(),M4=function(){function d(){var s=this;this.infoDiv=new A4,this.infoIcon=new I4(function(){s.infoDiv.show()},function(){s.infoDiv.hide()})}return d.prototype.renderInto=function(s){this.infoDiv.renderInto(s),this.infoIcon.renderInto(s)},d}(),L4=globalThis&&globalThis.__awaiter||function(d,s,u,g){function A(E){return E instanceof u?E:new u(function(O){O(E)})}return new(u||(u=Promise))(function(E,O){function r(Y){try{W(g.next(Y))}catch(se){O(se)}}function U(Y){try{W(g.throw(Y))}catch(se){O(se)}}function W(Y){Y.done?E(Y.value):A(Y.value).then(r,U)}W((g=g.apply(d,s||[])).next())})},O4=globalThis&&globalThis.__generator||function(d,s){var u={label:0,sent:function(){if(E[0]&1)throw E[1];return E[1]},trys:[],ops:[]},g,A,E,O;return O={next:r(0),throw:r(1),return:r(2)},typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function r(W){return function(Y){return U([W,Y])}}function U(W){if(g)throw new TypeError("Generator is already executing.");for(;O&&(O=0,W[0]&&(u=0)),u;)try{if(g=1,A&&(E=W[0]&2?A.return:W[0]?A.throw||((E=A.return)&&E.call(A),0):A.next)&&!(E=E.call(A,W[1])).done)return E;switch(A=0,E&&(W=[W[0]&2,E.value]),W[0]){case 0:case 1:E=W;break;case 4:return u.label++,{value:W[1],done:!1};case 5:u.label++,A=W[1],W=[0];continue;case 7:W=u.ops.pop(),u.trys.pop();continue;default:if(E=u.trys,!(E=E.length>0&&E[E.length-1])&&(W[0]===6||W[0]===2)){u=0;continue}if(W[0]===3&&(!E||W[1]>E[0]&&W[1]<E[3])){u.label=W[1];break}if(W[0]===6&&u.label<E[1]){u.label=E[1],E=W;break}if(E&&u.label<E[2]){u.label=E[2],u.ops.push(W);break}E[2]&&u.ops.pop(),u.trys.pop();continue}W=s.call(d,u)}catch(Y){W=[6,Y],A=0}finally{g=E=0}if(W[0]&5)throw W[1];return{value:W[0]?W[1]:void 0,done:!0}}},Lb=function(){function d(){}return d.hasPermissions=function(){return L4(this,void 0,void 0,function(){var s,u,g,A;return O4(this,function(E){switch(E.label){case 0:return[4,navigator.mediaDevices.enumerateDevices()];case 1:for(s=E.sent(),u=0,g=s;u<g.length;u++)if(A=g[u],A.kind==="videoinput"&&A.label)return[2,!0];return[2,!1]}})})},d}(),Hu=function(){function d(s){this.supportedScanTypes=this.validateAndReturnScanTypes(s)}return d.prototype.getDefaultScanType=function(){return this.supportedScanTypes[0]},d.prototype.hasMoreThanOneScanType=function(){return this.supportedScanTypes.length>1},d.prototype.isCameraScanRequired=function(){for(var s=0,u=this.supportedScanTypes;s<u.length;s++){var g=u[s];if(d.isCameraScanType(g))return!0}return!1},d.isCameraScanType=function(s){return s===Yu.SCAN_TYPE_CAMERA},d.isFileScanType=function(s){return s===Yu.SCAN_TYPE_FILE},d.prototype.validateAndReturnScanTypes=function(s){if(!s||s.length===0)return jl.DEFAULT_SUPPORTED_SCAN_TYPE;var u=jl.DEFAULT_SUPPORTED_SCAN_TYPE.length;if(s.length>u)throw"Max ".concat(u," values expected for ")+"supportedScanTypes";for(var g=0,A=s;g<A.length;g++){var E=A[g];if(!jl.DEFAULT_SUPPORTED_SCAN_TYPE.includes(E))throw"Unsupported scan type ".concat(E)}return s},d}(),el=function(){function d(){}return d.ALL_ELEMENT_CLASS="html5-qrcode-element",d.CAMERA_PERMISSION_BUTTON_ID="html5-qrcode-button-camera-permission",d.CAMERA_START_BUTTON_ID="html5-qrcode-button-camera-start",d.CAMERA_STOP_BUTTON_ID="html5-qrcode-button-camera-stop",d.TORCH_BUTTON_ID="html5-qrcode-button-torch",d.CAMERA_SELECTION_SELECT_ID="html5-qrcode-select-camera",d.FILE_SELECTION_BUTTON_ID="html5-qrcode-button-file-selection",d.ZOOM_SLIDER_ID="html5-qrcode-input-range-zoom",d.SCAN_TYPE_CHANGE_ANCHOR_ID="html5-qrcode-anchor-scan-type-change",d.TORCH_BUTTON_CLASS_TORCH_ON="html5-qrcode-button-torch-on",d.TORCH_BUTTON_CLASS_TORCH_OFF="html5-qrcode-button-torch-off",d}(),Qc=function(){function d(){}return d.createElement=function(s,u){var g=document.createElement(s);return g.id=u,g.classList.add(el.ALL_ELEMENT_CLASS),s==="button"&&g.setAttribute("type","button"),g},d}(),AC=globalThis&&globalThis.__awaiter||function(d,s,u,g){function A(E){return E instanceof u?E:new u(function(O){O(E)})}return new(u||(u=Promise))(function(E,O){function r(Y){try{W(g.next(Y))}catch(se){O(se)}}function U(Y){try{W(g.throw(Y))}catch(se){O(se)}}function W(Y){Y.done?E(Y.value):A(Y.value).then(r,U)}W((g=g.apply(d,s||[])).next())})},IC=globalThis&&globalThis.__generator||function(d,s){var u={label:0,sent:function(){if(E[0]&1)throw E[1];return E[1]},trys:[],ops:[]},g,A,E,O;return O={next:r(0),throw:r(1),return:r(2)},typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function r(W){return function(Y){return U([W,Y])}}function U(W){if(g)throw new TypeError("Generator is already executing.");for(;O&&(O=0,W[0]&&(u=0)),u;)try{if(g=1,A&&(E=W[0]&2?A.return:W[0]?A.throw||((E=A.return)&&E.call(A),0):A.next)&&!(E=E.call(A,W[1])).done)return E;switch(A=0,E&&(W=[W[0]&2,E.value]),W[0]){case 0:case 1:E=W;break;case 4:return u.label++,{value:W[1],done:!1};case 5:u.label++,A=W[1],W=[0];continue;case 7:W=u.ops.pop(),u.trys.pop();continue;default:if(E=u.trys,!(E=E.length>0&&E[E.length-1])&&(W[0]===6||W[0]===2)){u=0;continue}if(W[0]===3&&(!E||W[1]>E[0]&&W[1]<E[3])){u.label=W[1];break}if(W[0]===6&&u.label<E[1]){u.label=E[1],E=W;break}if(E&&u.label<E[2]){u.label=E[2],u.ops.push(W);break}E[2]&&u.ops.pop(),u.trys.pop();continue}W=s.call(d,u)}catch(Y){W=[6,Y],A=0}finally{g=E=0}if(W[0]&5)throw W[1];return{value:W[0]?W[1]:void 0,done:!0}}},Ob=function(){function d(s,u,g){this.isTorchOn=!1,this.torchCapability=s,this.buttonController=u,this.onTorchActionFailureCallback=g}return d.prototype.isTorchEnabled=function(){return this.isTorchOn},d.prototype.flipState=function(){return AC(this,void 0,void 0,function(){var s,u;return IC(this,function(g){switch(g.label){case 0:this.buttonController.disable(),s=!this.isTorchOn,g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this.torchCapability.apply(s)];case 2:return g.sent(),this.updateUiBasedOnLatestSettings(this.torchCapability.value(),s),[3,4];case 3:return u=g.sent(),this.propagateFailure(s,u),this.buttonController.enable(),[3,4];case 4:return[2]}})})},d.prototype.updateUiBasedOnLatestSettings=function(s,u){s===u?(this.buttonController.setText(u?eo.torchOffButton():eo.torchOnButton()),this.isTorchOn=u):this.propagateFailure(u),this.buttonController.enable()},d.prototype.propagateFailure=function(s,u){var g=s?eo.torchOnFailedMessage():eo.torchOffFailedMessage();u&&(g+="; Error = "+u),this.onTorchActionFailureCallback(g)},d.prototype.reset=function(){this.isTorchOn=!1},d}(),P4=function(){function d(s,u){this.onTorchActionFailureCallback=u,this.torchButton=Qc.createElement("button",el.TORCH_BUTTON_ID),this.torchController=new Ob(s,this,u)}return d.prototype.render=function(s,u){var g=this;this.torchButton.innerText=eo.torchOnButton(),this.torchButton.style.display=u.display,this.torchButton.style.marginLeft=u.marginLeft;var A=this;this.torchButton.addEventListener("click",function(E){return AC(g,void 0,void 0,function(){return IC(this,function(O){switch(O.label){case 0:return[4,A.torchController.flipState()];case 1:return O.sent(),A.torchController.isTorchEnabled()?(A.torchButton.classList.remove(el.TORCH_BUTTON_CLASS_TORCH_OFF),A.torchButton.classList.add(el.TORCH_BUTTON_CLASS_TORCH_ON)):(A.torchButton.classList.remove(el.TORCH_BUTTON_CLASS_TORCH_ON),A.torchButton.classList.add(el.TORCH_BUTTON_CLASS_TORCH_OFF)),[2]}})})}),s.appendChild(this.torchButton)},d.prototype.updateTorchCapability=function(s){this.torchController=new Ob(s,this,this.onTorchActionFailureCallback)},d.prototype.getTorchButton=function(){return this.torchButton},d.prototype.hide=function(){this.torchButton.style.display="none"},d.prototype.show=function(){this.torchButton.style.display="inline-block"},d.prototype.disable=function(){this.torchButton.disabled=!0},d.prototype.enable=function(){this.torchButton.disabled=!1},d.prototype.setText=function(s){this.torchButton.innerText=s},d.prototype.reset=function(){this.torchButton.innerText=eo.torchOnButton(),this.torchController.reset()},d.create=function(s,u,g,A){var E=new d(u,A);return E.render(s,g),E},d}(),D4=function(){function d(s,u,g){this.fileBasedScanRegion=this.createFileBasedScanRegion(),this.fileBasedScanRegion.style.display=u?"block":"none",s.appendChild(this.fileBasedScanRegion);var A=document.createElement("label");A.setAttribute("for",this.getFileScanInputId()),A.style.display="inline-block",this.fileBasedScanRegion.appendChild(A),this.fileSelectionButton=Qc.createElement("button",el.FILE_SELECTION_BUTTON_ID),this.setInitialValueToButton(),this.fileSelectionButton.addEventListener("click",function(r){A.click()}),A.append(this.fileSelectionButton),this.fileScanInput=Qc.createElement("input",this.getFileScanInputId()),this.fileScanInput.type="file",this.fileScanInput.accept="image/*",this.fileScanInput.style.display="none",A.appendChild(this.fileScanInput);var E=this;this.fileScanInput.addEventListener("change",function(r){if(!(r==null||r.target==null)){var U=r.target;if(!(U.files&&U.files.length===0)){var W=U.files,Y=W[0],se=Y.name;E.setImageNameToButton(se),g(Y)}}});var O=this.createDragAndDropMessage();this.fileBasedScanRegion.appendChild(O),this.fileBasedScanRegion.addEventListener("dragenter",function(r){E.fileBasedScanRegion.style.border=E.fileBasedScanRegionActiveBorder(),r.stopPropagation(),r.preventDefault()}),this.fileBasedScanRegion.addEventListener("dragleave",function(r){E.fileBasedScanRegion.style.border=E.fileBasedScanRegionDefaultBorder(),r.stopPropagation(),r.preventDefault()}),this.fileBasedScanRegion.addEventListener("dragover",function(r){E.fileBasedScanRegion.style.border=E.fileBasedScanRegionActiveBorder(),r.stopPropagation(),r.preventDefault()}),this.fileBasedScanRegion.addEventListener("drop",function(r){r.stopPropagation(),r.preventDefault(),E.fileBasedScanRegion.style.border=E.fileBasedScanRegionDefaultBorder();var U=r.dataTransfer;if(U){var W=U.files;if(!W||W.length===0)return;for(var Y=!1,se=0;se<W.length;++se){var Ae=W.item(se);if(Ae){var Ce=/image.*/;if(Ae.type.match(Ce)){Y=!0;var he=Ae.name;E.setImageNameToButton(he),g(Ae),O.innerText=eo.dragAndDropMessage();break}}}Y||(O.innerText=eo.dragAndDropMessageOnlyImages())}})}return d.prototype.hide=function(){this.fileBasedScanRegion.style.display="none",this.fileScanInput.disabled=!0},d.prototype.show=function(){this.fileBasedScanRegion.style.display="block",this.fileScanInput.disabled=!1},d.prototype.isShowing=function(){return this.fileBasedScanRegion.style.display==="block"},d.prototype.resetValue=function(){this.fileScanInput.value="",this.setInitialValueToButton()},d.prototype.createFileBasedScanRegion=function(){var s=document.createElement("div");return s.style.textAlign="center",s.style.margin="auto",s.style.width="80%",s.style.maxWidth="600px",s.style.border=this.fileBasedScanRegionDefaultBorder(),s.style.padding="10px",s.style.marginBottom="10px",s},d.prototype.fileBasedScanRegionDefaultBorder=function(){return"6px dashed #ebebeb"},d.prototype.fileBasedScanRegionActiveBorder=function(){return"6px dashed rgb(153 151 151)"},d.prototype.createDragAndDropMessage=function(){var s=document.createElement("div");return s.innerText=eo.dragAndDropMessage(),s.style.fontWeight="400",s},d.prototype.setImageNameToButton=function(s){var u=20;if(s.length>u){var g=s.substring(0,8),A=s.length,E=s.substring(A-8,A);s="".concat(g,"....").concat(E)}var O=eo.fileSelectionChooseAnother()+" - "+s;this.fileSelectionButton.innerText=O},d.prototype.setInitialValueToButton=function(){var s=eo.fileSelectionChooseImage()+" - "+eo.fileSelectionNoImageSelected();this.fileSelectionButton.innerText=s},d.prototype.getFileScanInputId=function(){return"html5-qrcode-private-filescan-input"},d.create=function(s,u,g){var A=new d(s,u,g);return A},d}(),R4=function(){function d(s){this.selectElement=Qc.createElement("select",el.CAMERA_SELECTION_SELECT_ID),this.cameras=s,this.options=[]}return d.prototype.render=function(s){var u=document.createElement("span");u.style.marginRight="10px";var g=this.cameras.length;if(g===0)throw new Error("No cameras found");if(g===1)u.style.display="none";else{var A=eo.selectCamera();u.innerText="".concat(A," (").concat(this.cameras.length,")  ")}for(var E=1,O=0,r=this.cameras;O<r.length;O++){var U=r[O],W=U.id,Y=U.label==null?W:U.label;(!Y||Y==="")&&(Y=[eo.anonymousCameraPrefix(),E++].join(" "));var se=document.createElement("option");se.value=W,se.innerText=Y,this.options.push(se),this.selectElement.appendChild(se)}u.appendChild(this.selectElement),s.appendChild(u)},d.prototype.disable=function(){this.selectElement.disabled=!0},d.prototype.isDisabled=function(){return this.selectElement.disabled===!0},d.prototype.enable=function(){this.selectElement.disabled=!1},d.prototype.getValue=function(){return this.selectElement.value},d.prototype.hasValue=function(s){for(var u=0,g=this.options;u<g.length;u++){var A=g[u];if(A.value===s)return!0}return!1},d.prototype.setValue=function(s){if(!this.hasValue(s))throw new Error("".concat(s," is not present in the camera list."));this.selectElement.value=s},d.prototype.hasSingleItem=function(){return this.cameras.length===1},d.prototype.numCameras=function(){return this.cameras.length},d.create=function(s,u){var g=new d(u);return g.render(s),g},d}(),k4=function(){function d(){this.onChangeCallback=null,this.zoomElementContainer=document.createElement("div"),this.rangeInput=Qc.createElement("input",el.ZOOM_SLIDER_ID),this.rangeInput.type="range",this.rangeText=document.createElement("span"),this.rangeInput.min="1",this.rangeInput.max="5",this.rangeInput.value="1",this.rangeInput.step="0.1"}return d.prototype.render=function(s,u){this.zoomElementContainer.style.display=u?"block":"none",this.zoomElementContainer.style.padding="5px 10px",this.zoomElementContainer.style.textAlign="center",s.appendChild(this.zoomElementContainer),this.rangeInput.style.display="inline-block",this.rangeInput.style.width="50%",this.rangeInput.style.height="5px",this.rangeInput.style.background="#d3d3d3",this.rangeInput.style.outline="none",this.rangeInput.style.opacity="0.7";var g=eo.zoom();this.rangeText.innerText="".concat(this.rangeInput.value,"x ").concat(g),this.rangeText.style.marginRight="10px";var A=this;this.rangeInput.addEventListener("input",function(){return A.onValueChange()}),this.rangeInput.addEventListener("change",function(){return A.onValueChange()}),this.zoomElementContainer.appendChild(this.rangeInput),this.zoomElementContainer.appendChild(this.rangeText)},d.prototype.onValueChange=function(){var s=eo.zoom();this.rangeText.innerText="".concat(this.rangeInput.value,"x ").concat(s),this.onChangeCallback&&this.onChangeCallback(parseFloat(this.rangeInput.value))},d.prototype.setValues=function(s,u,g,A){this.rangeInput.min=s.toString(),this.rangeInput.max=u.toString(),this.rangeInput.step=A.toString(),this.rangeInput.value=g.toString(),this.onValueChange()},d.prototype.show=function(){this.zoomElementContainer.style.display="block"},d.prototype.hide=function(){this.zoomElementContainer.style.display="none"},d.prototype.setOnCameraZoomValueChangeCallback=function(s){this.onChangeCallback=s},d.prototype.removeOnCameraZoomValueChangeCallback=function(){this.onChangeCallback=null},d.create=function(s,u){var g=new d;return g.render(s,u),g},d}(),Ja;(function(d){d[d.STATUS_DEFAULT=0]="STATUS_DEFAULT",d[d.STATUS_SUCCESS=1]="STATUS_SUCCESS",d[d.STATUS_WARNING=2]="STATUS_WARNING",d[d.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"})(Ja||(Ja={}));function B4(d){return{fps:d.fps,qrbox:d.qrbox,aspectRatio:d.aspectRatio,disableFlip:d.disableFlip,videoConstraints:d.videoConstraints}}function N4(d,s){return{formatsToSupport:d.formatsToSupport,useBarCodeDetectorIfSupported:d.useBarCodeDetectorIfSupported,experimentalFeatures:d.experimentalFeatures,verbose:s}}var F4=function(){function d(s,u,g){if(this.lastMatchFound=null,this.cameraScanImage=null,this.fileScanImage=null,this.fileSelectionUi=null,this.elementId=s,this.config=this.createConfig(u),this.verbose=g===!0,!document.getElementById(s))throw"HTML Element with id=".concat(s," not found");this.scanTypeSelector=new Hu(this.config.supportedScanTypes),this.currentScanType=this.scanTypeSelector.getDefaultScanType(),this.sectionSwapAllowed=!0,this.logger=new EC(this.verbose),this.persistedDataManager=new S4,u.rememberLastUsedCamera!==!0&&this.persistedDataManager.reset()}return d.prototype.render=function(s,u){var g=this;this.lastMatchFound=null,this.qrCodeSuccessCallback=function(E,O){if(s)s(E,O);else{if(g.lastMatchFound===E)return;g.lastMatchFound=E,g.setHeaderMessage(eo.lastMatch(E),Ja.STATUS_SUCCESS)}},this.qrCodeErrorCallback=function(E,O){u&&u(E,O)};var A=document.getElementById(this.elementId);if(!A)throw"HTML Element with id=".concat(this.elementId," not found");A.innerHTML="",this.createBasicLayout(A),this.html5Qrcode=new D_(this.getScanRegionId(),N4(this.config,this.verbose))},d.prototype.pause=function(s){(vc(s)||s!==!0)&&(s=!1),this.getHtml5QrcodeOrFail().pause(s)},d.prototype.resume=function(){this.getHtml5QrcodeOrFail().resume()},d.prototype.getState=function(){return this.getHtml5QrcodeOrFail().getState()},d.prototype.clear=function(){var s=this,u=function(){var g=document.getElementById(s.elementId);g&&(g.innerHTML="",s.resetBasicLayout(g))};return this.html5Qrcode?new Promise(function(g,A){if(!s.html5Qrcode){g();return}s.html5Qrcode.isScanning?s.html5Qrcode.stop().then(function(E){if(!s.html5Qrcode){g();return}s.html5Qrcode.clear(),u(),g()}).catch(function(E){s.verbose&&s.logger.logError("Unable to stop qrcode scanner",E),A(E)}):(s.html5Qrcode.clear(),u(),g())}):Promise.resolve()},d.prototype.getRunningTrackCapabilities=function(){return this.getHtml5QrcodeOrFail().getRunningTrackCapabilities()},d.prototype.getRunningTrackSettings=function(){return this.getHtml5QrcodeOrFail().getRunningTrackSettings()},d.prototype.applyVideoConstraints=function(s){return this.getHtml5QrcodeOrFail().applyVideoConstraints(s)},d.prototype.getHtml5QrcodeOrFail=function(){if(!this.html5Qrcode)throw"Code scanner not initialized.";return this.html5Qrcode},d.prototype.createConfig=function(s){return s?(s.fps||(s.fps=jl.SCAN_DEFAULT_FPS),s.rememberLastUsedCamera!==!jl.DEFAULT_REMEMBER_LAST_CAMERA_USED&&(s.rememberLastUsedCamera=jl.DEFAULT_REMEMBER_LAST_CAMERA_USED),s.supportedScanTypes||(s.supportedScanTypes=jl.DEFAULT_SUPPORTED_SCAN_TYPE),s):{fps:jl.SCAN_DEFAULT_FPS,rememberLastUsedCamera:jl.DEFAULT_REMEMBER_LAST_CAMERA_USED,supportedScanTypes:jl.DEFAULT_SUPPORTED_SCAN_TYPE}},d.prototype.createBasicLayout=function(s){s.style.position="relative",s.style.padding="0px",s.style.border="1px solid silver",this.createHeader(s);var u=document.createElement("div"),g=this.getScanRegionId();u.id=g,u.style.width="100%",u.style.minHeight="100px",u.style.textAlign="center",s.appendChild(u),Hu.isCameraScanType(this.currentScanType)?this.insertCameraScanImageToScanRegion():this.insertFileScanImageToScanRegion();var A=document.createElement("div"),E=this.getDashboardId();A.id=E,A.style.width="100%",s.appendChild(A),this.setupInitialDashboard(A)},d.prototype.resetBasicLayout=function(s){s.style.border="none"},d.prototype.setupInitialDashboard=function(s){this.createSection(s),this.createSectionControlPanel(),this.scanTypeSelector.hasMoreThanOneScanType()&&this.createSectionSwap()},d.prototype.createHeader=function(s){var u=document.createElement("div");u.style.textAlign="left",u.style.margin="0px",s.appendChild(u);var g=new M4;g.renderInto(u);var A=document.createElement("div");A.id=this.getHeaderMessageContainerId(),A.style.display="none",A.style.textAlign="center",A.style.fontSize="14px",A.style.padding="2px 10px",A.style.margin="4px",A.style.borderTop="1px solid #f6f6f6",u.appendChild(A)},d.prototype.createSection=function(s){var u=document.createElement("div");u.id=this.getDashboardSectionId(),u.style.width="100%",u.style.padding="10px 0px 10px 0px",u.style.textAlign="left",s.appendChild(u)},d.prototype.createCameraListUi=function(s,u,g){var A=this;A.showHideScanTypeSwapLink(!1),A.setHeaderMessage(eo.cameraPermissionRequesting());var E=function(){g||A.createPermissionButton(s,u)};D_.getCameras().then(function(O){A.persistedDataManager.setHasPermission(!0),A.showHideScanTypeSwapLink(!0),A.resetHeaderMessage(),O&&O.length>0?(s.removeChild(u),A.renderCameraSelection(O)):(A.setHeaderMessage(eo.noCameraFound(),Ja.STATUS_WARNING),E())}).catch(function(O){A.persistedDataManager.setHasPermission(!1),g?g.disabled=!1:E(),A.setHeaderMessage(O,Ja.STATUS_WARNING),A.showHideScanTypeSwapLink(!0)})},d.prototype.createPermissionButton=function(s,u){var g=this,A=Qc.createElement("button",this.getCameraPermissionButtonId());A.innerText=eo.cameraPermissionTitle(),A.addEventListener("click",function(){A.disabled=!0,g.createCameraListUi(s,u,A)}),u.appendChild(A)},d.prototype.createPermissionsUi=function(s,u){var g=this;if(Hu.isCameraScanType(this.currentScanType)&&this.persistedDataManager.hasCameraPermissions()){Lb.hasPermissions().then(function(A){A?g.createCameraListUi(s,u):(g.persistedDataManager.setHasPermission(!1),g.createPermissionButton(s,u))}).catch(function(A){g.persistedDataManager.setHasPermission(!1),g.createPermissionButton(s,u)});return}this.createPermissionButton(s,u)},d.prototype.createSectionControlPanel=function(){var s=document.getElementById(this.getDashboardSectionId()),u=document.createElement("div");s.appendChild(u);var g=document.createElement("div");g.id=this.getDashboardSectionCameraScanRegionId(),g.style.display=Hu.isCameraScanType(this.currentScanType)?"block":"none",u.appendChild(g);var A=document.createElement("div");A.style.textAlign="center",g.appendChild(A),this.scanTypeSelector.isCameraScanRequired()&&this.createPermissionsUi(g,A),this.renderFileScanUi(u)},d.prototype.renderFileScanUi=function(s){var u=Hu.isFileScanType(this.currentScanType),g=this,A=function(E){if(!g.html5Qrcode)throw"html5Qrcode not defined";Hu.isFileScanType(g.currentScanType)&&(g.setHeaderMessage(eo.loadingImage()),g.html5Qrcode.scanFileV2(E,!0).then(function(O){g.resetHeaderMessage(),g.qrCodeSuccessCallback(O.decodedText,O)}).catch(function(O){g.setHeaderMessage(O,Ja.STATUS_WARNING),g.qrCodeErrorCallback(O,CC.createFrom(O))}))};this.fileSelectionUi=D4.create(s,u,A)},d.prototype.renderCameraSelection=function(s){var u=this,g=this,A=document.getElementById(this.getDashboardSectionCameraScanRegionId());A.style.textAlign="center";var E=k4.create(A,!1),O=function(K){var N=K.zoomFeature();if(N.isSupported()){E.setOnCameraZoomValueChangeCallback(function(q){N.apply(q)});var z=1;u.config.defaultZoomValueIfSupported&&(z=u.config.defaultZoomValueIfSupported),z=i4(z,N.min(),N.max()),E.setValues(N.min(),N.max(),z,N.step()),E.show()}},r=R4.create(A,s),U=document.createElement("span"),W=Qc.createElement("button",el.CAMERA_START_BUTTON_ID);W.innerText=eo.scanButtonStartScanningText(),U.appendChild(W);var Y=Qc.createElement("button",el.CAMERA_STOP_BUTTON_ID);Y.innerText=eo.scanButtonStopScanningText(),Y.style.display="none",Y.disabled=!0,U.appendChild(Y);var se,Ae=function(K){if(!K.torchFeature().isSupported()){se&&se.hide();return}se?se.updateTorchCapability(K.torchFeature()):se=P4.create(U,K.torchFeature(),{display:"none",marginLeft:"5px"},function(N){g.setHeaderMessage(N,Ja.STATUS_WARNING)}),se.show()};A.appendChild(U);var Ce=function(K){K||(W.style.display="none"),W.innerText=eo.scanButtonStartScanningText(),W.style.opacity="1",W.disabled=!1,K&&(W.style.display="inline-block")};if(W.addEventListener("click",function(K){W.innerText=eo.scanButtonScanningStarting(),r.disable(),W.disabled=!0,W.style.opacity="0.5",u.scanTypeSelector.hasMoreThanOneScanType()&&g.showHideScanTypeSwapLink(!1),g.resetHeaderMessage();var N=r.getValue();g.persistedDataManager.setLastUsedCameraId(N),g.html5Qrcode.start(N,B4(g.config),g.qrCodeSuccessCallback,g.qrCodeErrorCallback).then(function(z){Y.disabled=!1,Y.style.display="inline-block",Ce(!1);var q=g.html5Qrcode.getRunningTrackCameraCapabilities();u.config.showTorchButtonIfSupported===!0&&Ae(q),u.config.showZoomSliderIfSupported===!0&&O(q)}).catch(function(z){g.showHideScanTypeSwapLink(!0),r.enable(),Ce(!0),g.setHeaderMessage(z,Ja.STATUS_WARNING)})}),r.hasSingleItem()&&W.click(),Y.addEventListener("click",function(K){if(!g.html5Qrcode)throw"html5Qrcode not defined";Y.disabled=!0,g.html5Qrcode.stop().then(function(N){u.scanTypeSelector.hasMoreThanOneScanType()&&g.showHideScanTypeSwapLink(!0),r.enable(),W.disabled=!1,Y.style.display="none",W.style.display="inline-block",se&&(se.reset(),se.hide()),E.removeOnCameraZoomValueChangeCallback(),E.hide(),g.insertCameraScanImageToScanRegion()}).catch(function(N){Y.disabled=!1,g.setHeaderMessage(N,Ja.STATUS_WARNING)})}),g.persistedDataManager.getLastUsedCameraId()){var he=g.persistedDataManager.getLastUsedCameraId();r.hasValue(he)?(r.setValue(he),W.click()):g.persistedDataManager.resetLastUsedCameraId()}},d.prototype.createSectionSwap=function(){var s=this,u=eo.textIfCameraScanSelected(),g=eo.textIfFileScanSelected(),A=document.getElementById(this.getDashboardSectionId()),E=document.createElement("div");E.style.textAlign="center";var O=Qc.createElement("span",this.getDashboardSectionSwapLinkId());O.style.textDecoration="underline",O.style.cursor="pointer",O.innerText=Hu.isCameraScanType(this.currentScanType)?u:g,O.addEventListener("click",function(){if(!s.sectionSwapAllowed){s.verbose&&s.logger.logError("Section swap called when not allowed");return}s.resetHeaderMessage(),s.fileSelectionUi.resetValue(),s.sectionSwapAllowed=!1,Hu.isCameraScanType(s.currentScanType)?(s.clearScanRegion(),s.getCameraScanRegion().style.display="none",s.fileSelectionUi.show(),O.innerText=g,s.currentScanType=Yu.SCAN_TYPE_FILE,s.insertFileScanImageToScanRegion()):(s.clearScanRegion(),s.getCameraScanRegion().style.display="block",s.fileSelectionUi.hide(),O.innerText=u,s.currentScanType=Yu.SCAN_TYPE_CAMERA,s.insertCameraScanImageToScanRegion(),s.startCameraScanIfPermissionExistsOnSwap()),s.sectionSwapAllowed=!0}),E.appendChild(O),A.appendChild(E)},d.prototype.startCameraScanIfPermissionExistsOnSwap=function(){var s=this,u=this;if(this.persistedDataManager.hasCameraPermissions()){Lb.hasPermissions().then(function(g){if(g){var A=document.getElementById(u.getCameraPermissionButtonId());if(!A)throw s.logger.logError("Permission button not found, fail;"),"Permission button not found";A.click()}else u.persistedDataManager.setHasPermission(!1)}).catch(function(g){u.persistedDataManager.setHasPermission(!1)});return}},d.prototype.resetHeaderMessage=function(){var s=document.getElementById(this.getHeaderMessageContainerId());s.style.display="none"},d.prototype.setHeaderMessage=function(s,u){u||(u=Ja.STATUS_DEFAULT);var g=this.getHeaderMessageDiv();switch(g.innerText=s,g.style.display="block",u){case Ja.STATUS_SUCCESS:g.style.background="rgba(106, 175, 80, 0.26)",g.style.color="#477735";break;case Ja.STATUS_WARNING:g.style.background="rgba(203, 36, 49, 0.14)",g.style.color="#cb2431";break;case Ja.STATUS_DEFAULT:default:g.style.background="rgba(0, 0, 0, 0)",g.style.color="rgb(17, 17, 17)";break}},d.prototype.showHideScanTypeSwapLink=function(s){this.scanTypeSelector.hasMoreThanOneScanType()&&(s!==!0&&(s=!1),this.sectionSwapAllowed=s,this.getDashboardSectionSwapLink().style.display=s?"inline-block":"none")},d.prototype.insertCameraScanImageToScanRegion=function(){var s=this,u=document.getElementById(this.getScanRegionId());if(this.cameraScanImage){u.innerHTML="<br>",u.appendChild(this.cameraScanImage);return}this.cameraScanImage=new Image,this.cameraScanImage.onload=function(g){u.innerHTML="<br>",u.appendChild(s.cameraScanImage)},this.cameraScanImage.width=64,this.cameraScanImage.style.opacity="0.8",this.cameraScanImage.src=C4,this.cameraScanImage.alt=eo.cameraScanAltText()},d.prototype.insertFileScanImageToScanRegion=function(){var s=this,u=document.getElementById(this.getScanRegionId());if(this.fileScanImage){u.innerHTML="<br>",u.appendChild(this.fileScanImage);return}this.fileScanImage=new Image,this.fileScanImage.onload=function(g){u.innerHTML="<br>",u.appendChild(s.fileScanImage)},this.fileScanImage.width=64,this.fileScanImage.style.opacity="0.8",this.fileScanImage.src=E4,this.fileScanImage.alt=eo.fileScanAltText()},d.prototype.clearScanRegion=function(){var s=document.getElementById(this.getScanRegionId());s.innerHTML=""},d.prototype.getDashboardSectionId=function(){return"".concat(this.elementId,"__dashboard_section")},d.prototype.getDashboardSectionCameraScanRegionId=function(){return"".concat(this.elementId,"__dashboard_section_csr")},d.prototype.getDashboardSectionSwapLinkId=function(){return el.SCAN_TYPE_CHANGE_ANCHOR_ID},d.prototype.getScanRegionId=function(){return"".concat(this.elementId,"__scan_region")},d.prototype.getDashboardId=function(){return"".concat(this.elementId,"__dashboard")},d.prototype.getHeaderMessageContainerId=function(){return"".concat(this.elementId,"__header_message")},d.prototype.getCameraPermissionButtonId=function(){return el.CAMERA_PERMISSION_BUTTON_ID},d.prototype.getCameraScanRegion=function(){return document.getElementById(this.getDashboardSectionCameraScanRegionId())},d.prototype.getDashboardSectionSwapLink=function(){return document.getElementById(this.getDashboardSectionSwapLinkId())},d.prototype.getHeaderMessageDiv=function(){return document.getElementById(this.getHeaderMessageContainerId())},d}(),Ad="Browser",Ei="type",Tn="name",Mi="model",Ln="version",Ai="vendor",Pb="UNKNOWN",vi={mobile:"mobile",tablet:"tablet",console:"console",smarttv:"smarttv",wearable:"wearable",embedded:"embedded"},h_={iPhone:"iPhone",iPad:"iPad",iPod:"iPod",iPod_touch:"iPod touch"},$n={Apple:"Apple",Samsung:"Samsung",Huawei:"Huawei",Xiaomi:"Xiaomi",Motorola:"Motorola",LG:"LG",Google:"Google",Sony:"Sony",Amazon:"Amazon",BlackBerry:"BlackBerry",Asus:"Asus",Microsoft:"Microsoft",Facebook:"Facebook",Zebra:"Zebra",Sharp:"Sharp"},xc={Mac_OS:"Mac OS",Windows:"Windows",iOS:"iOS",Android:"Android",Windows_Phone:"Windows Phone",Linux:"Linux",Chromium_OS:"Chromium OS"},Oo={Chrome:"Chrome",Safari:"Safari",Mobile_Safari:"Mobile Safari",Internet_Explorer:"Internet Explorer",Edge:"Edge",Firefox:"Firefox",Opera:"Opera",UC:"UC",WeChat:"WeChat",IE:"IE",Chromium:"Chromium"},Db=(d,s)=>s.includes(d);function R_(d,s){let u=Object.keys(s);for(let g=0;g<u.length;g++){let A=u[g];if(typeof s[A]=="object"&&s[A].length>0){for(let E=0;E<s[A].length;E++)if(Db(s[A][E],d))return A===Pb?void 0:A}else if(Db(s[A],d))return A===Pb?void 0:A}return d}function d_(d,s){let u=0,g,A,E,O,r=null,U,W={};for(;u<s.length&&!r;){let Y=s[u],se=s[u+1];for(g=A=0;g<Y.length&&!r&&Y[g];)if(r=Y[g++].exec(d),r)for(E=0;E<se.length;E++)U=r[++A],O=se[E],Array.isArray(O)?O.length===2?typeof O[1]=="function"?W[O[0]]=O[1](U):W[O[0]]=O[1]:O.length===3?typeof O[1]=="function"?W[O[0]]=U?O[1](U,O[2]):void 0:W[O[0]]=U?U.replace(O[1],O[2]):void 0:O.length===4&&(W[O[0]]=U?O[3](U.replace(O[1],O[2])):void 0):W[O]=U||void 0;u+=2}return W}function z4(d){return(d==null?void 0:d.replace(/[^\d\.]/g,"").split(".")[0])||void 0}function Rb(d,s){return d=d==null?void 0:d.replace(/^\s\s*/,""),typeof s>"u"?d:d==null?void 0:d.substring(0,350)}function k_(){return typeof window<"u"?window.navigator:void 0}function V4(){return typeof process<"u"?process:void 0}var f_=d=>{if(k_()){let s=k_();return s&&s.platform&&(s.platform.includes(d)||s.platform==="MacIntel"&&s.maxTouchPoints>=1&&!window.MSStream)||!1}return!1},U4=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|samsungbrowser.*mobile|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android|ipad|playbook|silk/i,j4=[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[Mi,[Ai,$n],[Ei,vi.tablet]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[Mi,[Ai,$n.Samsung],[Ei,vi.mobile]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[Mi,[Ai,$n.Apple],[Ei,vi.mobile]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[Mi,[Ai,$n.Apple],[Ei,vi.tablet]],[/(macintosh);/i],[Mi,[Ai,$n.Apple]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[Mi,[Ai,$n.Sharp],[Ei,vi.mobile]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[Mi,[Ai,$n.Huawei],[Ei,vi.tablet]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[Mi,[Ai,$n.Huawei],[Ei,vi.mobile]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[Mi,/_/g," "],[Ai,$n.Xiaomi],[Ei,vi.mobile]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[Mi,/_/g," "],[Ai,$n.Xiaomi],[Ei,vi.tablet]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[Mi,[Ai,"OPPO"],[Ei,vi.mobile]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[Mi,[Ai,"Vivo"],[Ei,vi.mobile]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[Mi,[Ai,"Realme"],[Ei,vi.mobile]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[Mi,[Ai,$n.Motorola],[Ei,vi.mobile]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[Mi,[Ai,$n.Motorola],[Ei,vi.tablet]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[Mi,[Ai,$n.LG],[Ei,vi.tablet]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[Mi,[Ai,$n.LG],[Ei,vi.mobile]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[Mi,[Ai,"Lenovo"],[Ei,vi.tablet]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[Mi,/_/g," "],[Ai,"Nokia"],[Ei,vi.mobile]],[/(pixel c)\b/i],[Mi,[Ai,$n.Google],[Ei,vi.tablet]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[Mi,[Ai,$n.Google],[Ei,vi.mobile]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[Mi,[Ai,$n.Sony],[Ei,vi.mobile]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[Mi,"Xperia Tablet"],[Ai,$n.Sony],[Ei,vi.tablet]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[Mi,[Ai,"OnePlus"],[Ei,vi.mobile]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[Mi,[Ai,$n.Amazon],[Ei,vi.tablet]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[Mi,/(.+)/g,"Fire Phone $1"],[Ai,$n.Amazon],[Ei,vi.mobile]],[/(playbook);[-\w\),; ]+(rim)/i],[Mi,Ai,[Ei,vi.tablet]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[Mi,[Ai,$n.BlackBerry],[Ei,vi.mobile]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[Mi,[Ai,$n.Asus],[Ei,vi.tablet]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[Mi,[Ai,$n.Asus],[Ei,vi.mobile]],[/(nexus 9)/i],[Mi,[Ai,"HTC"],[Ei,vi.tablet]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[Ai,[Mi,/_/g," "],[Ei,vi.mobile]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[Mi,[Ai,"Acer"],[Ei,vi.tablet]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[Mi,[Ai,"Meizu"],[Ei,vi.mobile]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[Ai,Mi,[Ei,vi.mobile]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[Ai,Mi,[Ei,vi.tablet]],[/(surface duo)/i],[Mi,[Ai,$n.Microsoft],[Ei,vi.tablet]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[Mi,[Ai,"Fairphone"],[Ei,vi.mobile]],[/(u304aa)/i],[Mi,[Ai,"AT&T"],[Ei,vi.mobile]],[/\bsie-(\w*)/i],[Mi,[Ai,"Siemens"],[Ei,vi.mobile]],[/\b(rct\w+) b/i],[Mi,[Ai,"RCA"],[Ei,vi.tablet]],[/\b(venue[\d ]{2,7}) b/i],[Mi,[Ai,"Dell"],[Ei,vi.tablet]],[/\b(q(?:mv|ta)\w+) b/i],[Mi,[Ai,"Verizon"],[Ei,vi.tablet]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[Mi,[Ai,"Barnes & Noble"],[Ei,vi.tablet]],[/\b(tm\d{3}\w+) b/i],[Mi,[Ai,"NuVision"],[Ei,vi.tablet]],[/\b(k88) b/i],[Mi,[Ai,"ZTE"],[Ei,vi.tablet]],[/\b(nx\d{3}j) b/i],[Mi,[Ai,"ZTE"],[Ei,vi.mobile]],[/\b(gen\d{3}) b.+49h/i],[Mi,[Ai,"Swiss"],[Ei,vi.mobile]],[/\b(zur\d{3}) b/i],[Mi,[Ai,"Swiss"],[Ei,vi.tablet]],[/\b((zeki)?tb.*\b) b/i],[Mi,[Ai,"Zeki"],[Ei,vi.tablet]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[Ai,"Dragon Touch"],Mi,[Ei,vi.tablet]],[/\b(ns-?\w{0,9}) b/i],[Mi,[Ai,"Insignia"],[Ei,vi.tablet]],[/\b((nxa|next)-?\w{0,9}) b/i],[Mi,[Ai,"NextBook"],[Ei,vi.tablet]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[Ai,"Voice"],Mi,[Ei,vi.mobile]],[/\b(lvtel\-)?(v1[12]) b/i],[[Ai,"LvTel"],Mi,[Ei,vi.mobile]],[/\b(ph-1) /i],[Mi,[Ai,"Essential"],[Ei,vi.mobile]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[Mi,[Ai,"Envizen"],[Ei,vi.tablet]],[/\b(trio[-\w\. ]+) b/i],[Mi,[Ai,"MachSpeed"],[Ei,vi.tablet]],[/\btu_(1491) b/i],[Mi,[Ai,"Rotor"],[Ei,vi.tablet]],[/(shield[\w ]+) b/i],[Mi,[Ai,"Nvidia"],[Ei,vi.tablet]],[/(sprint) (\w+)/i],[Ai,Mi,[Ei,vi.mobile]],[/(kin\.[onetw]{3})/i],[[Mi,/\./g," "],[Ai,$n.Microsoft],[Ei,vi.mobile]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[Mi,[Ai,$n.Zebra],[Ei,vi.tablet]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[Mi,[Ai,$n.Zebra],[Ei,vi.mobile]],[/smart-tv.+(samsung)/i],[Ai,[Ei,vi.smarttv]],[/hbbtv.+maple;(\d+)/i],[[Mi,/^/,"SmartTV"],[Ai,$n.Samsung],[Ei,vi.smarttv]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[Ai,$n.LG],[Ei,vi.smarttv]],[/(apple) ?tv/i],[Ai,[Mi,`${$n.Apple} TV`],[Ei,vi.smarttv]],[/crkey/i],[[Mi,`${Oo.Chrome}cast`],[Ai,$n.Google],[Ei,vi.smarttv]],[/droid.+aft(\w+)( bui|\))/i],[Mi,[Ai,$n.Amazon],[Ei,vi.smarttv]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[Mi,[Ai,$n.Sharp],[Ei,vi.smarttv]],[/(bravia[\w ]+)( bui|\))/i],[Mi,[Ai,$n.Sony],[Ei,vi.smarttv]],[/(mitv-\w{5}) bui/i],[Mi,[Ai,$n.Xiaomi],[Ei,vi.smarttv]],[/Hbbtv.*(technisat) (.*);/i],[Ai,Mi,[Ei,vi.smarttv]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[Ai,Rb],[Mi,Rb],[Ei,vi.smarttv]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[Ei,vi.smarttv]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[Ai,Mi,[Ei,vi.console]],[/droid.+; (shield) bui/i],[Mi,[Ai,"Nvidia"],[Ei,vi.console]],[/(playstation [345portablevi]+)/i],[Mi,[Ai,$n.Sony],[Ei,vi.console]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[Mi,[Ai,$n.Microsoft],[Ei,vi.console]],[/((pebble))app/i],[Ai,Mi,[Ei,vi.wearable]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[Mi,[Ai,$n.Apple],[Ei,vi.wearable]],[/droid.+; (glass) \d/i],[Mi,[Ai,$n.Google],[Ei,vi.wearable]],[/droid.+; (wt63?0{2,3})\)/i],[Mi,[Ai,$n.Zebra],[Ei,vi.wearable]],[/(quest( 2| pro)?)/i],[Mi,[Ai,$n.Facebook],[Ei,vi.wearable]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[Ai,[Ei,vi.embedded]],[/(aeobc)\b/i],[Mi,[Ai,$n.Amazon],[Ei,vi.embedded]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[Mi,[Ei,vi.mobile]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[Mi,[Ei,vi.tablet]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[Ei,vi.tablet]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[Ei,vi.mobile]],[/(android[-\w\. ]{0,9});.+buil/i],[Mi,[Ai,"Generic"]]],kb={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},q4=[[/microsoft (windows) (vista|xp)/i],[Tn,Ln],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[Tn,[Ln,R_,kb]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[Tn,xc.Windows],[Ln,R_,kb]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[Ln,/_/g,"."],[Tn,xc.iOS]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[Tn,xc.Mac_OS],[Ln,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[Ln,Tn],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[Tn,Ln],[/\(bb(10);/i],[Ln,[Tn,$n.BlackBerry]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[Ln,[Tn,`${Oo.Firefox} OS`]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[Ln,[Tn,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[Ln,[Tn,"watchOS"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[Tn,xc.Chromium_OS],Ln],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/(vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(linux) ?([\w\.]*)/i],[Tn,Ln],[/(unix) ?([\w\.]*)/i],[Tn,Ln]],H4=Object.defineProperty,G4=Object.defineProperties,W4=Object.getOwnPropertyDescriptors,Bb=Object.getOwnPropertySymbols,$4=Object.prototype.hasOwnProperty,Z4=Object.prototype.propertyIsEnumerable,B_=(d,s,u)=>s in d?H4(d,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):d[s]=u,p_=(d,s)=>{for(var u in s||(s={}))$4.call(s,u)&&B_(d,u,s[u]);if(Bb)for(var u of Bb(s))Z4.call(s,u)&&B_(d,u,s[u]);return d},X4=(d,s)=>G4(d,W4(s)),Y4=(d,s,u)=>B_(d,s+"",u),K4=class{constructor(d,s,u){this.navigator=s,this.process=u,Y4(this,"userAgent"),d?this.userAgent=d:this.navigator?this.userAgent=(s==null?void 0:s.userAgent)||(s==null?void 0:s.vendor)||"":this.userAgent=""}detect(){var d,s;if(this.process&&!this.userAgent)throw new Error("Only support browser now");this.userAgent||this.handleMissingError();let{browser:u}=this.detectBrowser(),{os:g}=this.detectOS(),{device:A}=this.detectDevice(),{isMobile:E}=this.detectMobile(),O=()=>f_("iPad"),r=()=>f_("iPhone"),U=()=>f_("iPod");return{os:p_({},g),browser:X4(p_({},u),{majorVersion:z4(u.version)}),device:p_({},A),is:{mobile:E||A.type===vi.mobile||A.type===vi.tablet||O(),mobileOnly:A.type===vi.mobile,tablet:A.type===vi.tablet||O(),mac:g.name===xc.Mac_OS&&!r()&&!O()&&!U(),windows:g.name===xc.Windows,iOS:g.name===xc.iOS||r()||O()||U(),android:g.name===xc.Android,winPhone:g.name===xc.Windows_Phone,linux:g.name===xc.Linux,edge:u.name===Oo.Edge,chrome:((d=u.name)==null?void 0:d.includes(Oo.Chrome))||!1,safari:u.name===Oo.Safari||u.name===Oo.Mobile_Safari||((s=u.name)==null?void 0:s.startsWith("ios"))||!1,firefox:u.name===Oo.Firefox,opera:u.name===Oo.Opera,IE:u.name===Oo.IE||u.name===Oo.Internet_Explorer,chromium:u.name===Oo.Chromium,wechat:u.name===Oo.WeChat,iPhone:A.model===h_.iPhone||r(),iPad:A.model===h_.iPad||O(),iPod:A.model===h_.iPod||U()}}}detectBrowser(){return{browser:d_(this.userAgent,eO)}}detectOS(){return{os:d_(this.userAgent,q4)}}detectDevice(){return{device:d_(this.userAgent,j4)}}detectMobile(){return{isMobile:U4.test(this.userAgent)}}handleMissingError(){throw new Error(`Please pass user-agent.
> browser(navigator.userAgent or headers['user-agent']).`)}};function Q4(d){return new K4(d,k_(),V4()).detect()}var J4={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},eO=[[/\b(?:crmo|crios)\/([\w\.]+)/i],[Ln,[Tn,Oo.Chrome]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[Ln,[Tn,Oo.Edge]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[Tn,Ln],[/opios[\/ ]+([\w\.]+)/i],[Ln,[Tn,`${Oo.Opera} Mini`]],[/\bopr\/([\w\.]+)/i],[Ln,[Tn,Oo.Opera]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[Tn,Ln],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[Ln,[Tn,`UC${Ad}`]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[Ln,[Tn,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[Ln,[Tn,Oo.WeChat]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[Ln,[Tn,Oo.IE]],[/ya(?:search)?browser\/([\w\.]+)/i],[Ln,[Tn,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[Tn,/(.+)/,`$1 Secure ${Ad}`],Ln],[/\bfocus\/([\w\.]+)/i],[Ln,[Tn,`${Oo.Firefox} Focus`]],[/\bopt\/([\w\.]+)/i],[Ln,[Tn,`${Oo.Opera} Touch`]],[/dolfin\/([\w\.]+)/i],[Ln,[Tn,"Dolphin"]],[/miuibrowser\/([\w\.]+)/i],[Ln,[Tn,`MIUI ${Ad}`]],[/fxios\/([-\w\.]+)/i],[Ln,[Tn,Oo.Firefox]],[/\bqihu|(qi?ho?o?|360)browser/i],[[Tn,`360 ${Ad}`]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[Tn,/(.+)/,`$1 ${Ad}`],Ln],[/(comodo_dragon)\/([\w\.]+)/i],[[Tn,/_/g," "],Ln],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[Tn,Ln],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[Tn],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[Tn,$n.Facebook],Ln],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[Tn,Ln],[/\bgsa\/([\w\.]+) .*safari\//i],[Ln,[Tn,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[Ln,[Tn,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[Ln,[Tn,`${Oo.Chrome} Headless`]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[Tn,`${Oo.Chrome} WebView`],Ln],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[Ln,[Tn,`Android ${Ad}`]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[Tn,Ln],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[Ln,[Tn,Oo.Mobile_Safari]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[Ln,Tn],[/(AppleWebKit)\/([0-9\.]+).*Mobile/i,/(AppleWebKit)\/([0-9\.]+).*Gecko\)$/i],[[Tn,"ios-webview"],Ln],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[Tn,[Ln,R_,J4]],[/(webkit|khtml)\/([\w\.]+)/i],[Tn,Ln],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[Tn,"Netscape"],Ln],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[Tn,Ln]],MC={exports:{}};/*!
* sweetalert2 v11.12.4
* Released under the MIT License.
*/(function(d,s){(function(u,g){d.exports=g()})(Po,function(){function u(be,Z){(Z==null||Z>be.length)&&(Z=be.length);for(var oe=0,we=Array(Z);oe<Z;oe++)we[oe]=be[oe];return we}function g(be){if(Array.isArray(be))return be}function A(be){if(Array.isArray(be))return u(be)}function E(be,Z,oe){if(typeof be=="function"?be===Z:be.has(Z))return arguments.length<3?Z:oe;throw new TypeError("Private element is not present on this object")}function O(be){if(be===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return be}function r(be,Z,oe){return Z=q(Z),He(be,Q()?Reflect.construct(Z,oe||[],q(be).constructor):Z.apply(be,oe))}function U(be,Z){if(Z.has(be))throw new TypeError("Cannot initialize the same private elements twice on an object")}function W(be,Z){if(!(be instanceof Z))throw new TypeError("Cannot call a class as a function")}function Y(be,Z){return be.get(E(be,Z))}function se(be,Z,oe){U(be,Z),Z.set(be,oe)}function Ae(be,Z,oe){return be.set(E(be,Z),oe),oe}function Ce(be,Z,oe){if(Q())return Reflect.construct.apply(null,arguments);var we=[null];we.push.apply(we,Z);var tt=new(be.bind.apply(be,we));return tt}function he(be,Z){for(var oe=0;oe<Z.length;oe++){var we=Z[oe];we.enumerable=we.enumerable||!1,we.configurable=!0,"value"in we&&(we.writable=!0),Object.defineProperty(be,_i(we.key),we)}}function K(be,Z,oe){return Z&&he(be.prototype,Z),Object.defineProperty(be,"prototype",{writable:!1}),be}function N(be,Z){var oe=typeof Symbol<"u"&&be[Symbol.iterator]||be["@@iterator"];if(!oe){if(Array.isArray(be)||(oe=Un(be))||Z){oe&&(be=oe);var we=0,tt=function(){};return{s:tt,n:function(){return we>=be.length?{done:!0}:{done:!1,value:be[we++]}},e:function(bn){throw bn},f:tt}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ft,Li=!0,zn=!1;return{s:function(){oe=oe.call(be)},n:function(){var bn=oe.next();return Li=bn.done,bn},e:function(bn){zn=!0,Ft=bn},f:function(){try{Li||oe.return==null||oe.return()}finally{if(zn)throw Ft}}}}function z(){return z=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(be,Z,oe){var we=xt(be,Z);if(we){var tt=Object.getOwnPropertyDescriptor(we,Z);return tt.get?tt.get.call(arguments.length<3?be:oe):tt.value}},z.apply(null,arguments)}function q(be){return q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(Z){return Z.__proto__||Object.getPrototypeOf(Z)},q(be)}function G(be,Z){if(typeof Z!="function"&&Z!==null)throw new TypeError("Super expression must either be null or a function");be.prototype=Object.create(Z&&Z.prototype,{constructor:{value:be,writable:!0,configurable:!0}}),Object.defineProperty(be,"prototype",{writable:!1}),Z&&nt(be,Z)}function Q(){try{var be=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Q=function(){return!!be})()}function ee(be){if(typeof Symbol<"u"&&be[Symbol.iterator]!=null||be["@@iterator"]!=null)return Array.from(be)}function fe(be,Z){var oe=be==null?null:typeof Symbol<"u"&&be[Symbol.iterator]||be["@@iterator"];if(oe!=null){var we,tt,Ft,Li,zn=[],bn=!0,po=!1;try{if(Ft=(oe=oe.call(be)).next,Z!==0)for(;!(bn=(we=Ft.call(oe)).done)&&(zn.push(we.value),zn.length!==Z);bn=!0);}catch(sc){po=!0,tt=sc}finally{try{if(!bn&&oe.return!=null&&(Li=oe.return(),Object(Li)!==Li))return}finally{if(po)throw tt}}return zn}}function ce(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ue(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function He(be,Z){if(Z&&(typeof Z=="object"||typeof Z=="function"))return Z;if(Z!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return O(be)}function nt(be,Z){return nt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(oe,we){return oe.__proto__=we,oe},nt(be,Z)}function vt(be,Z){return g(be)||fe(be,Z)||Un(be,Z)||ce()}function xt(be,Z){for(;!{}.hasOwnProperty.call(be,Z)&&(be=q(be))!==null;);return be}function Ot(be,Z,oe,we){var tt=z(q(be.prototype),Z,oe);return function(Ft){return tt.apply(oe,Ft)}}function Ui(be){return A(be)||ee(be)||Un(be)||Ue()}function Mt(be,Z){if(typeof be!="object"||!be)return be;var oe=be[Symbol.toPrimitive];if(oe!==void 0){var we=oe.call(be,Z);if(typeof we!="object")return we;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(be)}function _i(be){var Z=Mt(be,"string");return typeof Z=="symbol"?Z:Z+""}function di(be){"@babel/helpers - typeof";return di=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Z){return typeof Z}:function(Z){return Z&&typeof Symbol=="function"&&Z.constructor===Symbol&&Z!==Symbol.prototype?"symbol":typeof Z},di(be)}function Un(be,Z){if(be){if(typeof be=="string")return u(be,Z);var oe={}.toString.call(be).slice(8,-1);return oe==="Object"&&be.constructor&&(oe=be.constructor.name),oe==="Map"||oe==="Set"?Array.from(be):oe==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(oe)?u(be,Z):void 0}}var Nn=100,Vi={},Vr=function(){Vi.previousActiveElement instanceof HTMLElement?(Vi.previousActiveElement.focus(),Vi.previousActiveElement=null):document.body&&document.body.focus()},Oi=function(Z){return new Promise(function(oe){if(!Z)return oe();var we=window.scrollX,tt=window.scrollY;Vi.restoreFocusTimeout=setTimeout(function(){Vr(),oe()},Nn),window.scrollTo(we,tt)})},ir="swal2-",fn=["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","default-outline","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error"],At=fn.reduce(function(be,Z){return be[Z]=ir+Z,be},{}),Ri=["success","warning","info","question","error"],Lr=Ri.reduce(function(be,Z){return be[Z]=ir+Z,be},{}),si="SweetAlert2:",zi=function(Z){return Z.charAt(0).toUpperCase()+Z.slice(1)},Qi=function(Z){console.warn("".concat(si," ").concat(di(Z)==="object"?Z.join(" "):Z))},Sn=function(Z){console.error("".concat(si," ").concat(Z))},Co=[],fi=function(Z){Co.includes(Z)||(Co.push(Z),Qi(Z))},$r=function(Z){var oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;fi('"'.concat(Z,'" is deprecated and will be removed in the next major release.').concat(oe?' Use "'.concat(oe,'" instead.'):""))},Or=function(Z){return typeof Z=="function"?Z():Z},Hi=function(Z){return Z&&typeof Z.toPromise=="function"},Hn=function(Z){return Hi(Z)?Z.toPromise():Promise.resolve(Z)},Fn=function(Z){return Z&&Promise.resolve(Z)===Z},ti=function(){return document.body.querySelector(".".concat(At.container))},Ii=function(Z){var oe=ti();return oe?oe.querySelector(Z):null},wi=function(Z){return Ii(".".concat(Z))},on=function(){return wi(At.popup)},Do=function(){return wi(At.icon)},so=function(){return wi(At["icon-content"])},Go=function(){return wi(At.title)},Pr=function(){return wi(At["html-container"])},Ro=function(){return wi(At.image)},ao=function(){return wi(At["progress-steps"])},yr=function(){return wi(At["validation-message"])},ko=function(){return Ii(".".concat(At.actions," .").concat(At.confirm))},Bo=function(){return Ii(".".concat(At.actions," .").concat(At.cancel))},Wo=function(){return Ii(".".concat(At.actions," .").concat(At.deny))},er=function(){return wi(At["input-label"])},pi=function(){return Ii(".".concat(At.loader))},xi=function(){return wi(At.actions)},Gn=function(){return wi(At.footer)},an=function(){return wi(At["timer-progress-bar"])},Jo=function(){return wi(At.close)},Ds=`
  a[href],
  area[href],
  input:not([disabled]),
  select:not([disabled]),
  textarea:not([disabled]),
  button:not([disabled]),
  iframe,
  object,
  embed,
  [tabindex="0"],
  [contenteditable],
  audio[controls],
  video[controls],
  summary
`,$o=function(){var Z=on();if(!Z)return[];var oe=Z.querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])'),we=Array.from(oe).sort(function(Li,zn){var bn=parseInt(Li.getAttribute("tabindex")||"0"),po=parseInt(zn.getAttribute("tabindex")||"0");return bn>po?1:bn<po?-1:0}),tt=Z.querySelectorAll(Ds),Ft=Array.from(tt).filter(function(Li){return Li.getAttribute("tabindex")!=="-1"});return Ui(new Set(we.concat(Ft))).filter(function(Li){return ae(Li)})},gn=function(){return Tr(document.body,At.shown)&&!Tr(document.body,At["toast-shown"])&&!Tr(document.body,At["no-backdrop"])},No=function(){var Z=on();return Z?Tr(Z,At.toast):!1},Es=function(){var Z=on();return Z?Z.hasAttribute("data-loading"):!1},Ur=function(Z,oe){if(Z.textContent="",oe){var we=new DOMParser,tt=we.parseFromString(oe,"text/html"),Ft=tt.querySelector("head");Ft&&Array.from(Ft.childNodes).forEach(function(zn){Z.appendChild(zn)});var Li=tt.querySelector("body");Li&&Array.from(Li.childNodes).forEach(function(zn){zn instanceof HTMLVideoElement||zn instanceof HTMLAudioElement?Z.appendChild(zn.cloneNode(!0)):Z.appendChild(zn)})}},Tr=function(Z,oe){if(!oe)return!1;for(var we=oe.split(/\s+/),tt=0;tt<we.length;tt++)if(!Z.classList.contains(we[tt]))return!1;return!0},Rs=function(Z,oe){Array.from(Z.classList).forEach(function(we){!Object.values(At).includes(we)&&!Object.values(Lr).includes(we)&&!Object.values(oe.showClass||{}).includes(we)&&Z.classList.remove(we)})},tr=function(Z,oe,we){if(Rs(Z,oe),!!oe.customClass){var tt=oe.customClass[we];if(tt){if(typeof tt!="string"&&!tt.forEach){Qi("Invalid type of customClass.".concat(we,'! Expected string or iterable object, got "').concat(di(tt),'"'));return}yn(Z,tt)}}},Fo=function(Z,oe){if(!oe)return null;switch(oe){case"select":case"textarea":case"file":return Z.querySelector(".".concat(At.popup," > .").concat(At[oe]));case"checkbox":return Z.querySelector(".".concat(At.popup," > .").concat(At.checkbox," input"));case"radio":return Z.querySelector(".".concat(At.popup," > .").concat(At.radio," input:checked"))||Z.querySelector(".".concat(At.popup," > .").concat(At.radio," input:first-child"));case"range":return Z.querySelector(".".concat(At.popup," > .").concat(At.range," input"));default:return Z.querySelector(".".concat(At.popup," > .").concat(At.input))}},Eo=function(Z){if(Z.focus(),Z.type!=="file"){var oe=Z.value;Z.value="",Z.value=oe}},uo=function(Z,oe,we){!Z||!oe||(typeof oe=="string"&&(oe=oe.split(/\s+/).filter(Boolean)),oe.forEach(function(tt){Array.isArray(Z)?Z.forEach(function(Ft){we?Ft.classList.add(tt):Ft.classList.remove(tt)}):we?Z.classList.add(tt):Z.classList.remove(tt)}))},yn=function(Z,oe){uo(Z,oe,!0)},Kn=function(Z,oe){uo(Z,oe,!1)},To=function(Z,oe){for(var we=Array.from(Z.children),tt=0;tt<we.length;tt++){var Ft=we[tt];if(Ft instanceof HTMLElement&&Tr(Ft,oe))return Ft}},Cr=function(Z,oe,we){we==="".concat(parseInt(we))&&(we=parseInt(we)),we||parseInt(we)===0?Z.style.setProperty(oe,typeof we=="number"?"".concat(we,"px"):we):Z.style.removeProperty(oe)},hr=function(Z){var oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"flex";Z&&(Z.style.display=oe)},nr=function(Z){Z&&(Z.style.display="none")},Ke=function(Z){var oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"block";Z&&new MutationObserver(function(){re(Z,Z.innerHTML,oe)}).observe(Z,{childList:!0,subtree:!0})},ve=function(Z,oe,we,tt){var Ft=Z.querySelector(oe);Ft&&Ft.style.setProperty(we,tt)},re=function(Z,oe){var we=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"flex";oe?hr(Z,we):nr(Z)},ae=function(Z){return!!(Z&&(Z.offsetWidth||Z.offsetHeight||Z.getClientRects().length))},Ee=function(){return!ae(ko())&&!ae(Wo())&&!ae(Bo())},Oe=function(Z){return Z.scrollHeight>Z.clientHeight},Re=function(Z){var oe=window.getComputedStyle(Z),we=parseFloat(oe.getPropertyValue("animation-duration")||"0"),tt=parseFloat(oe.getPropertyValue("transition-duration")||"0");return we>0||tt>0},je=function(Z){var oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,we=an();we&&ae(we)&&(oe&&(we.style.transition="none",we.style.width="100%"),setTimeout(function(){we.style.transition="width ".concat(Z/1e3,"s linear"),we.style.width="0%"},10))},Je=function(){var Z=an();if(Z){var oe=parseInt(window.getComputedStyle(Z).width);Z.style.removeProperty("transition"),Z.style.width="100%";var we=parseInt(window.getComputedStyle(Z).width),tt=oe/we*100;Z.style.width="".concat(tt,"%")}},Ge=function(){return typeof window>"u"||typeof document>"u"},rt=`
 <div aria-labelledby="`.concat(At.title,'" aria-describedby="').concat(At["html-container"],'" class="').concat(At.popup,`" tabindex="-1">
   <button type="button" class="`).concat(At.close,`"></button>
   <ul class="`).concat(At["progress-steps"],`"></ul>
   <div class="`).concat(At.icon,`"></div>
   <img class="`).concat(At.image,`" />
   <h2 class="`).concat(At.title,'" id="').concat(At.title,`"></h2>
   <div class="`).concat(At["html-container"],'" id="').concat(At["html-container"],`"></div>
   <input class="`).concat(At.input,'" id="').concat(At.input,`" />
   <input type="file" class="`).concat(At.file,`" />
   <div class="`).concat(At.range,`">
     <input type="range" />
     <output></output>
   </div>
   <select class="`).concat(At.select,'" id="').concat(At.select,`"></select>
   <div class="`).concat(At.radio,`"></div>
   <label class="`).concat(At.checkbox,`">
     <input type="checkbox" id="`).concat(At.checkbox,`" />
     <span class="`).concat(At.label,`"></span>
   </label>
   <textarea class="`).concat(At.textarea,'" id="').concat(At.textarea,`"></textarea>
   <div class="`).concat(At["validation-message"],'" id="').concat(At["validation-message"],`"></div>
   <div class="`).concat(At.actions,`">
     <div class="`).concat(At.loader,`"></div>
     <button type="button" class="`).concat(At.confirm,`"></button>
     <button type="button" class="`).concat(At.deny,`"></button>
     <button type="button" class="`).concat(At.cancel,`"></button>
   </div>
   <div class="`).concat(At.footer,`"></div>
   <div class="`).concat(At["timer-progress-bar-container"],`">
     <div class="`).concat(At["timer-progress-bar"],`"></div>
   </div>
 </div>
`).replace(/(^|\n)\s*/g,""),ht=function(){var Z=ti();return Z?(Z.remove(),Kn([document.documentElement,document.body],[At["no-backdrop"],At["toast-shown"],At["has-column"]]),!0):!1},pt=function(){Vi.currentInstance.resetValidationMessage()},$t=function(){var Z=on(),oe=To(Z,At.input),we=To(Z,At.file),tt=Z.querySelector(".".concat(At.range," input")),Ft=Z.querySelector(".".concat(At.range," output")),Li=To(Z,At.select),zn=Z.querySelector(".".concat(At.checkbox," input")),bn=To(Z,At.textarea);oe.oninput=pt,we.onchange=pt,Li.onchange=pt,zn.onchange=pt,bn.oninput=pt,tt.oninput=function(){pt(),Ft.value=tt.value},tt.onchange=function(){pt(),Ft.value=tt.value}},oi=function(Z){return typeof Z=="string"?document.querySelector(Z):Z},bi=function(Z){var oe=on();oe.setAttribute("role",Z.toast?"alert":"dialog"),oe.setAttribute("aria-live",Z.toast?"polite":"assertive"),Z.toast||oe.setAttribute("aria-modal","true")},mt=function(Z){window.getComputedStyle(Z).direction==="rtl"&&yn(ti(),At.rtl)},Ti=function(Z){var oe=ht();if(Ge()){Sn("SweetAlert2 requires document to initialize");return}var we=document.createElement("div");we.className=At.container,oe&&yn(we,At["no-transition"]),Ur(we,rt);var tt=oi(Z.target);tt.appendChild(we),bi(Z),mt(tt),$t()},ui=function(Z,oe){Z instanceof HTMLElement?oe.appendChild(Z):di(Z)==="object"?Gt(Z,oe):Z&&Ur(oe,Z)},Gt=function(Z,oe){Z.jquery?Yi(oe,Z):Ur(oe,Z.toString())},Yi=function(Z,oe){if(Z.textContent="",0 in oe)for(var we=0;we in oe;we++)Z.appendChild(oe[we].cloneNode(!0));else Z.appendChild(oe.cloneNode(!0))},ei=function(){if(Ge())return!1;var be=document.createElement("div");return typeof be.style.webkitAnimation<"u"?"webkitAnimationEnd":typeof be.style.animation<"u"?"animationend":!1}(),ii=function(Z,oe){var we=xi(),tt=pi();!we||!tt||(!oe.showConfirmButton&&!oe.showDenyButton&&!oe.showCancelButton?nr(we):hr(we),tr(we,oe,"actions"),yi(we,tt,oe),Ur(tt,oe.loaderHtml||""),tr(tt,oe,"loader"))};function yi(be,Z,oe){var we=ko(),tt=Wo(),Ft=Bo();!we||!tt||!Ft||(tn(we,"confirm",oe),tn(tt,"deny",oe),tn(Ft,"cancel",oe),Xi(we,tt,Ft,oe),oe.reverseButtons&&(oe.toast?(be.insertBefore(Ft,we),be.insertBefore(tt,we)):(be.insertBefore(Ft,Z),be.insertBefore(tt,Z),be.insertBefore(we,Z))))}function Xi(be,Z,oe,we){if(!we.buttonsStyling){Kn([be,Z,oe],At.styled);return}yn([be,Z,oe],At.styled),we.confirmButtonColor&&(be.style.backgroundColor=we.confirmButtonColor,yn(be,At["default-outline"])),we.denyButtonColor&&(Z.style.backgroundColor=we.denyButtonColor,yn(Z,At["default-outline"])),we.cancelButtonColor&&(oe.style.backgroundColor=we.cancelButtonColor,yn(oe,At["default-outline"]))}function tn(be,Z,oe){var we=zi(Z);re(be,oe["show".concat(we,"Button")],"inline-block"),Ur(be,oe["".concat(Z,"ButtonText")]||""),be.setAttribute("aria-label",oe["".concat(Z,"ButtonAriaLabel")]||""),be.className=At[Z],tr(be,oe,"".concat(Z,"Button"))}var Dn=function(Z,oe){var we=Jo();we&&(Ur(we,oe.closeButtonHtml||""),tr(we,oe,"closeButton"),re(we,oe.showCloseButton),we.setAttribute("aria-label",oe.closeButtonAriaLabel||""))},pn=function(Z,oe){var we=ti();we&&(Ar(we,oe.backdrop),es(we,oe.position),ar(we,oe.grow),tr(we,oe,"container"))};function Ar(be,Z){typeof Z=="string"?be.style.background=Z:Z||yn([document.documentElement,document.body],At["no-backdrop"])}function es(be,Z){Z&&(Z in At?yn(be,At[Z]):(Qi('The "position" parameter is not valid, defaulting to "center"'),yn(be,At.center)))}function ar(be,Z){Z&&yn(be,At["grow-".concat(Z)])}var _n={innerParams:new WeakMap,domCache:new WeakMap},Pi=["input","file","range","select","radio","checkbox","textarea"],zo=function(Z,oe){var we=on();if(we){var tt=_n.innerParams.get(Z),Ft=!tt||oe.input!==tt.input;Pi.forEach(function(Li){var zn=To(we,At[Li]);zn&&(Ct(Li,oe.inputAttributes),zn.className=At[Li],Ft&&nr(zn))}),oe.input&&(Ft&&Rn(oe),We(oe))}},Rn=function(Z){if(Z.input){if(!gr[Z.input]){Sn("Unexpected type of input! Expected ".concat(Object.keys(gr).join(" | "),', got "').concat(Z.input,'"'));return}var oe=jr(Z.input);if(oe){var we=gr[Z.input](oe,Z);hr(oe),Z.inputAutoFocus&&setTimeout(function(){Eo(we)})}}},Zr=function(Z){for(var oe=0;oe<Z.attributes.length;oe++){var we=Z.attributes[oe].name;["id","type","value","style"].includes(we)||Z.removeAttribute(we)}},Ct=function(Z,oe){var we=on();if(we){var tt=Fo(we,Z);if(tt){Zr(tt);for(var Ft in oe)tt.setAttribute(Ft,oe[Ft])}}},We=function(Z){if(Z.input){var oe=jr(Z.input);oe&&tr(oe,Z,"input")}},ki=function(Z,oe){!Z.placeholder&&oe.inputPlaceholder&&(Z.placeholder=oe.inputPlaceholder)},dr=function(Z,oe,we){if(we.inputLabel){var tt=document.createElement("label"),Ft=At["input-label"];tt.setAttribute("for",Z.id),tt.className=Ft,di(we.customClass)==="object"&&yn(tt,we.customClass.inputLabel),tt.innerText=we.inputLabel,oe.insertAdjacentElement("beforebegin",tt)}},jr=function(Z){var oe=on();if(oe)return To(oe,At[Z]||At.input)},So=function(Z,oe){["string","number"].includes(di(oe))?Z.value="".concat(oe):Fn(oe)||Qi('Unexpected type of inputValue! Expected "string", "number" or "Promise", got "'.concat(di(oe),'"'))},gr={};gr.text=gr.email=gr.password=gr.number=gr.tel=gr.url=gr.search=gr.date=gr["datetime-local"]=gr.time=gr.week=gr.month=function(be,Z){return So(be,Z.inputValue),dr(be,be,Z),ki(be,Z),be.type=Z.input,be},gr.file=function(be,Z){return dr(be,be,Z),ki(be,Z),be},gr.range=function(be,Z){var oe=be.querySelector("input"),we=be.querySelector("output");return So(oe,Z.inputValue),oe.type=Z.input,So(we,Z.inputValue),dr(oe,be,Z),be},gr.select=function(be,Z){if(be.textContent="",Z.inputPlaceholder){var oe=document.createElement("option");Ur(oe,Z.inputPlaceholder),oe.value="",oe.disabled=!0,oe.selected=!0,be.appendChild(oe)}return dr(be,be,Z),be},gr.radio=function(be){return be.textContent="",be},gr.checkbox=function(be,Z){var oe=Fo(on(),"checkbox");oe.value="1",oe.checked=!!Z.inputValue;var we=be.querySelector("span");return Ur(we,Z.inputPlaceholder),oe},gr.textarea=function(be,Z){So(be,Z.inputValue),ki(be,Z),dr(be,be,Z);var oe=function(tt){return parseInt(window.getComputedStyle(tt).marginLeft)+parseInt(window.getComputedStyle(tt).marginRight)};return setTimeout(function(){if("MutationObserver"in window){var we=parseInt(window.getComputedStyle(on()).width),tt=function(){if(document.body.contains(be)){var Li=be.offsetWidth+oe(be);Li>we?on().style.width="".concat(Li,"px"):Cr(on(),"width",Z.width)}};new MutationObserver(tt).observe(be,{attributes:!0,attributeFilter:["style"]})}}),be};var _o=function(Z,oe){var we=Pr();we&&(Ke(we),tr(we,oe,"htmlContainer"),oe.html?(ui(oe.html,we),hr(we,"block")):oe.text?(we.textContent=oe.text,hr(we,"block")):nr(we),zo(Z,oe))},Wi=function(Z,oe){var we=Gn();we&&(Ke(we),re(we,oe.footer,"block"),oe.footer&&ui(oe.footer,we),tr(we,oe,"footer"))},lr=function(Z,oe){var we=_n.innerParams.get(Z),tt=Do();if(tt){if(we&&oe.icon===we.icon){Us(tt,oe),Vs(tt,oe);return}if(!oe.icon&&!oe.iconHtml){nr(tt);return}if(oe.icon&&Object.keys(Lr).indexOf(oe.icon)===-1){Sn('Unknown icon! Expected "success", "error", "warning", "info" or "question", got "'.concat(oe.icon,'"')),nr(tt);return}hr(tt),Us(tt,oe),Vs(tt,oe),yn(tt,oe.showClass&&oe.showClass.icon)}},Vs=function(Z,oe){for(var we=0,tt=Object.entries(Lr);we<tt.length;we++){var Ft=vt(tt[we],2),Li=Ft[0],zn=Ft[1];oe.icon!==Li&&Kn(Z,zn)}yn(Z,oe.icon&&Lr[oe.icon]),ms(Z,oe),ks(),tr(Z,oe,"icon")},ks=function(){var Z=on();if(Z)for(var oe=window.getComputedStyle(Z).getPropertyValue("background-color"),we=Z.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix"),tt=0;tt<we.length;tt++)we[tt].style.backgroundColor=oe},pa=`
  <div class="swal2-success-circular-line-left"></div>
  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>
  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>
  <div class="swal2-success-circular-line-right"></div>
`,Bs=`
  <span class="swal2-x-mark">
    <span class="swal2-x-mark-line-left"></span>
    <span class="swal2-x-mark-line-right"></span>
  </span>
`,Us=function(Z,oe){if(!(!oe.icon&&!oe.iconHtml)){var we=Z.innerHTML,tt="";if(oe.iconHtml)tt=Bi(oe.iconHtml);else if(oe.icon==="success")tt=pa,we=we.replace(/ style=".*?"/g,"");else if(oe.icon==="error")tt=Bs;else if(oe.icon){var Ft={question:"?",warning:"!",info:"i"};tt=Bi(Ft[oe.icon])}we.trim()!==tt.trim()&&Ur(Z,tt)}},ms=function(Z,oe){if(oe.iconColor){Z.style.color=oe.iconColor,Z.style.borderColor=oe.iconColor;for(var we=0,tt=[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"];we<tt.length;we++){var Ft=tt[we];ve(Z,Ft,"background-color",oe.iconColor)}ve(Z,".swal2-success-ring","border-color",oe.iconColor)}},Bi=function(Z){return'<div class="'.concat(At["icon-content"],'">').concat(Z,"</div>")},Zo=function(Z,oe){var we=Ro();if(we){if(!oe.imageUrl){nr(we);return}hr(we,""),we.setAttribute("src",oe.imageUrl),we.setAttribute("alt",oe.imageAlt||""),Cr(we,"width",oe.imageWidth),Cr(we,"height",oe.imageHeight),we.className=At.image,tr(we,oe,"image")}},Xo=function(Z,oe){var we=ti(),tt=on();if(!(!we||!tt)){if(oe.toast){Cr(we,"width",oe.width),tt.style.width="100%";var Ft=pi();Ft&&tt.insertBefore(Ft,Do())}else Cr(tt,"width",oe.width);Cr(tt,"padding",oe.padding),oe.color&&(tt.style.color=oe.color),oe.background&&(tt.style.background=oe.background),nr(yr()),en(tt,oe)}},en=function(Z,oe){var we=oe.showClass||{};Z.className="".concat(At.popup," ").concat(ae(Z)?we.popup:""),oe.toast?(yn([document.documentElement,document.body],At["toast-shown"]),yn(Z,At.toast)):yn(Z,At.modal),tr(Z,oe,"popup"),typeof oe.customClass=="string"&&yn(Z,oe.customClass),oe.icon&&yn(Z,At["icon-".concat(oe.icon)])},ma=function(Z,oe){var we=ao();if(we){var tt=oe.progressSteps,Ft=oe.currentProgressStep;if(!tt||tt.length===0||Ft===void 0){nr(we);return}hr(we),we.textContent="",Ft>=tt.length&&Qi("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),tt.forEach(function(Li,zn){var bn=hn(Li);if(we.appendChild(bn),zn===Ft&&yn(bn,At["active-progress-step"]),zn!==tt.length-1){var po=io(oe);we.appendChild(po)}})}},hn=function(Z){var oe=document.createElement("li");return yn(oe,At["progress-step"]),Ur(oe,Z),oe},io=function(Z){var oe=document.createElement("li");return yn(oe,At["progress-step-line"]),Z.progressStepsDistance&&Cr(oe,"width",Z.progressStepsDistance),oe},Qs=function(Z,oe){var we=Go();we&&(Ke(we),re(we,oe.title||oe.titleText,"block"),oe.title&&ui(oe.title,we),oe.titleText&&(we.innerText=oe.titleText),tr(we,oe,"title"))},Ns=function(Z,oe){Xo(Z,oe),pn(Z,oe),ma(Z,oe),lr(Z,oe),Zo(Z,oe),Qs(Z,oe),Dn(Z,oe),_o(Z,oe),ii(Z,oe),Wi(Z,oe);var we=on();typeof oe.didRender=="function"&&we&&oe.didRender(we)},ga=function(){return ae(on())},Yo=function(){var Z;return(Z=ko())===null||Z===void 0?void 0:Z.click()},Yt=function(){var Z;return(Z=Wo())===null||Z===void 0?void 0:Z.click()},Js=function(){var Z;return(Z=Bo())===null||Z===void 0?void 0:Z.click()},ts=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),nn=function(Z){Z.keydownTarget&&Z.keydownHandlerAdded&&(Z.keydownTarget.removeEventListener("keydown",Z.keydownHandler,{capture:Z.keydownListenerCapture}),Z.keydownHandlerAdded=!1)},ho=function(Z,oe,we){nn(Z),oe.toast||(Z.keydownHandler=function(tt){return eu(oe,tt,we)},Z.keydownTarget=oe.keydownListenerCapture?window:on(),Z.keydownListenerCapture=oe.keydownListenerCapture,Z.keydownTarget.addEventListener("keydown",Z.keydownHandler,{capture:Z.keydownListenerCapture}),Z.keydownHandlerAdded=!0)},_a=function(Z,oe){var we,tt=$o();if(tt.length){Z=Z+oe,Z===tt.length?Z=0:Z===-1&&(Z=tt.length-1),tt[Z].focus();return}(we=on())===null||we===void 0||we.focus()},js=["ArrowRight","ArrowDown"],fo=["ArrowLeft","ArrowUp"],eu=function(Z,oe,we){Z&&(oe.isComposing||oe.keyCode===229||(Z.stopKeydownPropagation&&oe.stopPropagation(),oe.key==="Enter"?Ki(oe,Z):oe.key==="Tab"?il(oe):[].concat(js,fo).includes(oe.key)?Na(oe.key):oe.key==="Escape"&&ls(oe,Z,we)))},Ki=function(Z,oe){if(Or(oe.allowEnterKey)){var we=Fo(on(),oe.input);if(Z.target&&we&&Z.target instanceof HTMLElement&&Z.target.outerHTML===we.outerHTML){if(["textarea","file"].includes(oe.input))return;Yo(),Z.preventDefault()}}},il=function(Z){for(var oe=Z.target,we=$o(),tt=-1,Ft=0;Ft<we.length;Ft++)if(oe===we[Ft]){tt=Ft;break}Z.shiftKey?_a(tt,-1):_a(tt,1),Z.stopPropagation(),Z.preventDefault()},Na=function(Z){var oe=xi(),we=ko(),tt=Wo(),Ft=Bo();if(!(!oe||!we||!tt||!Ft)){var Li=[we,tt,Ft];if(!(document.activeElement instanceof HTMLElement&&!Li.includes(document.activeElement))){var zn=js.includes(Z)?"nextElementSibling":"previousElementSibling",bn=document.activeElement;if(bn){for(var po=0;po<oe.children.length;po++){if(bn=bn[zn],!bn)return;if(bn instanceof HTMLButtonElement&&ae(bn))break}bn instanceof HTMLButtonElement&&bn.focus()}}}},ls=function(Z,oe,we){Or(oe.allowEscapeKey)&&(Z.preventDefault(),we(ts.esc))},ya={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap},An=function(){var Z=ti(),oe=Array.from(document.body.children);oe.forEach(function(we){we.contains(Z)||(we.hasAttribute("aria-hidden")&&we.setAttribute("data-previous-aria-hidden",we.getAttribute("aria-hidden")||""),we.setAttribute("aria-hidden","true"))})},Zl=function(){var Z=Array.from(document.body.children);Z.forEach(function(oe){oe.hasAttribute("data-previous-aria-hidden")?(oe.setAttribute("aria-hidden",oe.getAttribute("data-previous-aria-hidden")||""),oe.removeAttribute("data-previous-aria-hidden")):oe.removeAttribute("aria-hidden")})},va=typeof window<"u"&&!!window.GestureEvent,Fs=function(){if(va&&!Tr(document.body,At.iosfix)){var Z=document.body.scrollTop;document.body.style.top="".concat(Z*-1,"px"),yn(document.body,At.iosfix),Tc()}},Tc=function(){var Z=ti();if(Z){var oe;Z.ontouchstart=function(we){oe=Nt(we)},Z.ontouchmove=function(we){oe&&(we.preventDefault(),we.stopPropagation())}}},Nt=function(Z){var oe=Z.target,we=ti(),tt=Pr();return!we||!tt||On(Z)||Xr(Z)?!1:oe===we||!Oe(we)&&oe instanceof HTMLElement&&oe.tagName!=="INPUT"&&oe.tagName!=="TEXTAREA"&&!(Oe(tt)&&tt.contains(oe))},On=function(Z){return Z.touches&&Z.touches.length&&Z.touches[0].touchType==="stylus"},Xr=function(Z){return Z.touches&&Z.touches.length>1},zs=function(){if(Tr(document.body,At.iosfix)){var Z=parseInt(document.body.style.top,10);Kn(document.body,At.iosfix),document.body.style.top="",document.body.scrollTop=Z*-1}},Xl=function(){var Z=document.createElement("div");Z.className=At["scrollbar-measure"],document.body.appendChild(Z);var oe=Z.getBoundingClientRect().width-Z.clientWidth;return document.body.removeChild(Z),oe},is=null,Sc=function(Z){is===null&&(document.body.scrollHeight>window.innerHeight||Z==="scroll")&&(is=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight="".concat(is+Xl(),"px"))},Dr=function(){is!==null&&(document.body.style.paddingRight="".concat(is,"px"),is=null)};function Ir(be,Z,oe,we){No()?cr(be,we):(Oi(oe).then(function(){return cr(be,we)}),nn(Vi)),va?(Z.setAttribute("style","display:none !important"),Z.removeAttribute("class"),Z.innerHTML=""):Z.remove(),gn()&&(Dr(),zs(),Zl()),Rr()}function Rr(){Kn([document.documentElement,document.body],[At.shown,At["height-auto"],At["no-backdrop"],At["toast-shown"]])}function kr(be){be=rr(be);var Z=ya.swalPromiseResolve.get(this),oe=Mr(this);this.isAwaitingPromise?be.isDismissed||(gs(this),Z(be)):oe&&Z(be)}var Mr=function(Z){var oe=on();if(!oe)return!1;var we=_n.innerParams.get(Z);if(!we||Tr(oe,we.hideClass.popup))return!1;Kn(oe,we.showClass.popup),yn(oe,we.hideClass.popup);var tt=ti();return Kn(tt,we.showClass.backdrop),yn(tt,we.hideClass.backdrop),ln(Z,oe,we),!0};function Fa(be){var Z=ya.swalPromiseReject.get(this);gs(this),Z&&Z(be)}var gs=function(Z){Z.isAwaitingPromise&&(delete Z.isAwaitingPromise,_n.innerParams.get(Z)||Z._destroy())},rr=function(Z){return typeof Z>"u"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},Z)},ln=function(Z,oe,we){var tt=ti(),Ft=ei&&Re(oe);typeof we.willClose=="function"&&we.willClose(oe),Ft?nl(Z,oe,tt,we.returnFocus,we.didClose):Ir(Z,tt,we.returnFocus,we.didClose)},nl=function(Z,oe,we,tt,Ft){ei&&(Vi.swalCloseEventFinishedCallback=Ir.bind(null,Z,we,tt,Ft),oe.addEventListener(ei,function(Li){Li.target===oe&&(Vi.swalCloseEventFinishedCallback(),delete Vi.swalCloseEventFinishedCallback)}))},cr=function(Z,oe){setTimeout(function(){typeof oe=="function"&&oe.bind(Z.params)(),Z._destroy&&Z._destroy()})},Vo=function(Z){var oe=on();if(oe||new Sa,oe=on(),!!oe){var we=pi();No()?nr(Do()):_s(oe,Z),hr(we),oe.setAttribute("data-loading","true"),oe.setAttribute("aria-busy","true"),oe.focus()}},_s=function(Z,oe){var we=xi(),tt=pi();!we||!tt||(!oe&&ae(ko())&&(oe=ko()),hr(we),oe&&(nr(oe),tt.setAttribute("data-button-to-replace",oe.className),we.insertBefore(tt,oe)),yn([Z,we],At.loading))},Ac=function(Z,oe){oe.input==="select"||oe.input==="radio"?za(Z,oe):["text","email","number","tel","textarea"].some(function(we){return we===oe.input})&&(Hi(oe.inputValue)||Fn(oe.inputValue))&&(Vo(ko()),Cl(Z,oe))},cs=function(Z,oe){var we=Z.getInput();if(!we)return null;switch(oe.input){case"checkbox":return Yl(we);case"radio":return bl(we);case"file":return rl(we);default:return oe.inputAutoTrim?we.value.trim():we.value}},Yl=function(Z){return Z.checked?1:0},bl=function(Z){return Z.checked?Z.value:null},rl=function(Z){return Z.files&&Z.files.length?Z.getAttribute("multiple")!==null?Z.files:Z.files[0]:null},za=function(Z,oe){var we=on();if(we){var tt=function(Li){oe.input==="select"?Ao(we,xa(Li),oe):oe.input==="radio"&&Va(we,xa(Li),oe)};Hi(oe.inputOptions)||Fn(oe.inputOptions)?(Vo(ko()),Hn(oe.inputOptions).then(function(Ft){Z.hideLoading(),tt(Ft)})):di(oe.inputOptions)==="object"?tt(oe.inputOptions):Sn("Unexpected type of inputOptions! Expected object, Map or Promise, got ".concat(di(oe.inputOptions)))}},Cl=function(Z,oe){var we=Z.getInput();we&&(nr(we),Hn(oe.inputValue).then(function(tt){we.value=oe.input==="number"?"".concat(parseFloat(tt)||0):"".concat(tt),hr(we),we.focus(),Z.hideLoading()}).catch(function(tt){Sn("Error in inputValue promise: ".concat(tt)),we.value="",hr(we),we.focus(),Z.hideLoading()}))};function Ao(be,Z,oe){var we=To(be,At.select);if(we){var tt=function(Li,zn,bn){var po=document.createElement("option");po.value=bn,Ur(po,zn),po.selected=Kl(bn,oe.inputValue),Li.appendChild(po)};Z.forEach(function(Ft){var Li=Ft[0],zn=Ft[1];if(Array.isArray(zn)){var bn=document.createElement("optgroup");bn.label=Li,bn.disabled=!1,we.appendChild(bn),zn.forEach(function(po){return tt(bn,po[1],po[0])})}else tt(we,zn,Li)}),we.focus()}}function Va(be,Z,oe){var we=To(be,At.radio);if(we){Z.forEach(function(Ft){var Li=Ft[0],zn=Ft[1],bn=document.createElement("input"),po=document.createElement("label");bn.type="radio",bn.name=At.radio,bn.value=Li,Kl(Li,oe.inputValue)&&(bn.checked=!0);var sc=document.createElement("span");Ur(sc,zn),sc.className=At.label,po.appendChild(bn),po.appendChild(sc),we.appendChild(po)});var tt=we.querySelectorAll("input");tt.length&&tt[0].focus()}}var xa=function(Z){var oe=[];return Z instanceof Map?Z.forEach(function(we,tt){var Ft=we;di(Ft)==="object"&&(Ft=xa(Ft)),oe.push([tt,Ft])}):Object.keys(Z).forEach(function(we){var tt=Z[we];di(tt)==="object"&&(tt=xa(tt)),oe.push([we,tt])}),oe},Kl=function(Z,oe){return!!oe&&oe.toString()===Z.toString()},qs=void 0,tu=function(Z){var oe=_n.innerParams.get(Z);Z.disableButtons(),oe.input?ns(Z,"confirm"):ba(Z,!0)},Ko=function(Z){var oe=_n.innerParams.get(Z);Z.disableButtons(),oe.returnInputValueOnDeny?ns(Z,"deny"):us(Z,!1)},Ua=function(Z,oe){Z.disableButtons(),oe(ts.cancel)},ns=function(Z,oe){var we=_n.innerParams.get(Z);if(!we.input){Sn('The "input" parameter is needed to be set when using returnInputValueOn'.concat(zi(oe)));return}var tt=Z.getInput(),Ft=cs(Z,we);we.inputValidator?ol(Z,Ft,oe):tt&&!tt.checkValidity()?(Z.enableButtons(),Z.showValidationMessage(we.validationMessage||tt.validationMessage)):oe==="deny"?us(Z,Ft):ba(Z,Ft)},ol=function(Z,oe,we){var tt=_n.innerParams.get(Z);Z.disableInput();var Ft=Promise.resolve().then(function(){return Hn(tt.inputValidator(oe,tt.validationMessage))});Ft.then(function(Li){Z.enableButtons(),Z.enableInput(),Li?Z.showValidationMessage(Li):we==="deny"?us(Z,oe):ba(Z,oe)})},us=function(Z,oe){var we=_n.innerParams.get(Z||qs);if(we.showLoaderOnDeny&&Vo(Wo()),we.preDeny){Z.isAwaitingPromise=!0;var tt=Promise.resolve().then(function(){return Hn(we.preDeny(oe,we.validationMessage))});tt.then(function(Ft){Ft===!1?(Z.hideLoading(),gs(Z)):Z.close({isDenied:!0,value:typeof Ft>"u"?oe:Ft})}).catch(function(Ft){return wa(Z||qs,Ft)})}else Z.close({isDenied:!0,value:oe})},sl=function(Z,oe){Z.close({isConfirmed:!0,value:oe})},wa=function(Z,oe){Z.rejectPromise(oe)},ba=function(Z,oe){var we=_n.innerParams.get(Z||qs);if(we.showLoaderOnConfirm&&Vo(),we.preConfirm){Z.resetValidationMessage(),Z.isAwaitingPromise=!0;var tt=Promise.resolve().then(function(){return Hn(we.preConfirm(oe,we.validationMessage))});tt.then(function(Ft){ae(yr())||Ft===!1?(Z.hideLoading(),gs(Z)):sl(Z,typeof Ft>"u"?oe:Ft)}).catch(function(Ft){return wa(Z||qs,Ft)})}else sl(Z,oe)};function Ca(){var be=_n.innerParams.get(this);if(be){var Z=_n.domCache.get(this);nr(Z.loader),No()?be.icon&&hr(Do()):Ts(Z),Kn([Z.popup,Z.actions],At.loading),Z.popup.removeAttribute("aria-busy"),Z.popup.removeAttribute("data-loading"),Z.confirmButton.disabled=!1,Z.denyButton.disabled=!1,Z.cancelButton.disabled=!1}}var Ts=function(Z){var oe=Z.popup.getElementsByClassName(Z.loader.getAttribute("data-button-to-replace"));oe.length?hr(oe[0],"inline-block"):Ee()&&nr(Z.actions)};function Ic(){var be=_n.innerParams.get(this),Z=_n.domCache.get(this);return Z?Fo(Z.popup,be.input):null}function El(be,Z,oe){var we=_n.domCache.get(be);Z.forEach(function(tt){we[tt].disabled=oe})}function ea(be,Z){var oe=on();if(!(!oe||!be))if(be.type==="radio")for(var we=oe.querySelectorAll('[name="'.concat(At.radio,'"]')),tt=0;tt<we.length;tt++)we[tt].disabled=Z;else be.disabled=Z}function Zn(){El(this,["confirmButton","denyButton","cancelButton"],!1)}function ja(){El(this,["confirmButton","denyButton","cancelButton"],!0)}function Te(){ea(this.getInput(),!1)}function c(){ea(this.getInput(),!0)}function m(be){var Z=_n.domCache.get(this),oe=_n.innerParams.get(this);Ur(Z.validationMessage,be),Z.validationMessage.className=At["validation-message"],oe.customClass&&oe.customClass.validationMessage&&yn(Z.validationMessage,oe.customClass.validationMessage),hr(Z.validationMessage);var we=this.getInput();we&&(we.setAttribute("aria-invalid","true"),we.setAttribute("aria-describedby",At["validation-message"]),Eo(we),yn(we,At.inputerror))}function v(){var be=_n.domCache.get(this);be.validationMessage&&nr(be.validationMessage);var Z=this.getInput();Z&&(Z.removeAttribute("aria-invalid"),Z.removeAttribute("aria-describedby"),Kn(Z,At.inputerror))}var C={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,animation:!0,showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0},I=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","willClose"],L={allowEnterKey:void 0},k=["allowOutsideClick","allowEnterKey","backdrop","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],j=function(Z){return Object.prototype.hasOwnProperty.call(C,Z)},J=function(Z){return I.indexOf(Z)!==-1},pe=function(Z){return L[Z]},Ie=function(Z){j(Z)||Qi('Unknown parameter "'.concat(Z,'"'))},Ne=function(Z){k.includes(Z)&&Qi('The parameter "'.concat(Z,'" is incompatible with toasts'))},Ye=function(Z){var oe=pe(Z);oe&&$r(Z,oe)},at=function(Z){Z.backdrop===!1&&Z.allowOutsideClick&&Qi('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`');for(var oe in Z)Ie(oe),Z.toast&&Ne(oe),Ye(oe)};function ut(be){var Z=on(),oe=_n.innerParams.get(this);if(!Z||Tr(Z,oe.hideClass.popup)){Qi("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");return}var we=Et(be),tt=Object.assign({},oe,we);Ns(this,tt),_n.innerParams.set(this,tt),Object.defineProperties(this,{params:{value:Object.assign({},this.params,be),writable:!1,enumerable:!0}})}var Et=function(Z){var oe={};return Object.keys(Z).forEach(function(we){J(we)?oe[we]=Z[we]:Qi("Invalid parameter to update: ".concat(we))}),oe};function Rt(){var be=_n.domCache.get(this),Z=_n.innerParams.get(this);if(!Z){gi(this);return}be.popup&&Vi.swalCloseEventFinishedCallback&&(Vi.swalCloseEventFinishedCallback(),delete Vi.swalCloseEventFinishedCallback),typeof Z.didDestroy=="function"&&Z.didDestroy(),mi(this)}var mi=function(Z){gi(Z),delete Z.params,delete Vi.keydownHandler,delete Vi.keydownTarget,delete Vi.currentInstance},gi=function(Z){Z.isAwaitingPromise?(ai(_n,Z),Z.isAwaitingPromise=!0):(ai(ya,Z),ai(_n,Z),delete Z.isAwaitingPromise,delete Z.disableButtons,delete Z.enableButtons,delete Z.getInput,delete Z.disableInput,delete Z.enableInput,delete Z.hideLoading,delete Z.disableLoading,delete Z.showValidationMessage,delete Z.resetValidationMessage,delete Z.close,delete Z.closePopup,delete Z.closeModal,delete Z.closeToast,delete Z.rejectPromise,delete Z.update,delete Z._destroy)},ai=function(Z,oe){for(var we in Z)Z[we].delete(oe)},Xn=Object.freeze({__proto__:null,_destroy:Rt,close:kr,closeModal:kr,closePopup:kr,closeToast:kr,disableButtons:ja,disableInput:c,disableLoading:Ca,enableButtons:Zn,enableInput:Te,getInput:Ic,handleAwaitingPromise:gs,hideLoading:Ca,rejectPromise:Fa,resetValidationMessage:v,showValidationMessage:m,update:ut}),wn=function(Z,oe,we){Z.toast?yo(Z,oe,we):(fr(oe),Uo(oe),ys(Z,oe,we))},yo=function(Z,oe,we){oe.popup.onclick=function(){Z&&(Ss(Z)||Z.timer||Z.input)||we(ts.close)}},Ss=function(Z){return!!(Z.showConfirmButton||Z.showDenyButton||Z.showCancelButton||Z.showCloseButton)},Yr=!1,fr=function(Z){Z.popup.onmousedown=function(){Z.container.onmouseup=function(oe){Z.container.onmouseup=function(){},oe.target===Z.container&&(Yr=!0)}}},Uo=function(Z){Z.container.onmousedown=function(oe){oe.target===Z.container&&oe.preventDefault(),Z.popup.onmouseup=function(we){Z.popup.onmouseup=function(){},(we.target===Z.popup||we.target instanceof HTMLElement&&Z.popup.contains(we.target))&&(Yr=!0)}}},ys=function(Z,oe,we){oe.container.onclick=function(tt){if(Yr){Yr=!1;return}tt.target===oe.container&&Or(Z.allowOutsideClick)&&we(ts.backdrop)}},ta=function(Z){return di(Z)==="object"&&Z.jquery},ia=function(Z){return Z instanceof Element||ta(Z)},Tl=function(Z){var oe={};return di(Z[0])==="object"&&!ia(Z[0])?Object.assign(oe,Z[0]):["title","html","icon"].forEach(function(we,tt){var Ft=Z[tt];typeof Ft=="string"||ia(Ft)?oe[we]=Ft:Ft!==void 0&&Sn("Unexpected type of ".concat(we,'! Expected "string" or "Element", got ').concat(di(Ft)))}),oe};function vs(){for(var be=arguments.length,Z=new Array(be),oe=0;oe<be;oe++)Z[oe]=arguments[oe];return Ce(this,Z)}function qa(be){var Z=function(oe){function we(){return W(this,we),r(this,we,arguments)}return G(we,oe),K(we,[{key:"_main",value:function(Ft,Li){return Ot(we,"_main",this)([Ft,Object.assign({},be,Li)])}}])}(this);return Z}var Bh=function(){return Vi.timeout&&Vi.timeout.getTimerLeft()},iu=function(){if(Vi.timeout)return Je(),Vi.timeout.stop()},al=function(){if(Vi.timeout){var Z=Vi.timeout.start();return je(Z),Z}},Nh=function(){var Z=Vi.timeout;return Z&&(Z.running?iu():al())},nu=function(Z){if(Vi.timeout){var oe=Vi.timeout.increase(Z);return je(oe,!0),oe}},ru=function(){return!!(Vi.timeout&&Vi.timeout.isRunning())},Sl=!1,Mc={};function kn(){var be=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"data-swal-template";Mc[be]=this,Sl||(document.body.addEventListener("click",$d),Sl=!0)}var $d=function(Z){for(var oe=Z.target;oe&&oe!==document;oe=oe.parentNode)for(var we in Mc){var tt=oe.getAttribute(we);if(tt){Mc[we].fire({template:tt});return}}},Fi=Object.freeze({__proto__:null,argsToParams:Tl,bindClickHandler:kn,clickCancel:Js,clickConfirm:Yo,clickDeny:Yt,enableLoading:Vo,fire:vs,getActions:xi,getCancelButton:Bo,getCloseButton:Jo,getConfirmButton:ko,getContainer:ti,getDenyButton:Wo,getFocusableElements:$o,getFooter:Gn,getHtmlContainer:Pr,getIcon:Do,getIconContent:so,getImage:Ro,getInputLabel:er,getLoader:pi,getPopup:on,getProgressSteps:ao,getTimerLeft:Bh,getTimerProgressBar:an,getTitle:Go,getValidationMessage:yr,increaseTimer:nu,isDeprecatedParameter:pe,isLoading:Es,isTimerRunning:ru,isUpdatableParameter:J,isValidParameter:j,isVisible:ga,mixin:qa,resumeTimer:al,showLoading:Vo,stopTimer:iu,toggleTimer:Nh}),Fh=function(){function be(Z,oe){W(this,be),this.callback=Z,this.remaining=oe,this.running=!1,this.start()}return K(be,[{key:"start",value:function(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}},{key:"stop",value:function(){return this.started&&this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=new Date().getTime()-this.started.getTime()),this.remaining}},{key:"increase",value:function(oe){var we=this.running;return we&&this.stop(),this.remaining+=oe,we&&this.start(),this.remaining}},{key:"getTimerLeft",value:function(){return this.running&&(this.stop(),this.start()),this.remaining}},{key:"isRunning",value:function(){return this.running}}])}(),Lc=["swal-title","swal-html","swal-footer"],Qu=function(Z){var oe=typeof Z.template=="string"?document.querySelector(Z.template):Z.template;if(!oe)return{};var we=oe.content;Ql(we);var tt=Object.assign(Ea(we),Ju(we),na(we),ci(we),Bn(we),In(we),Hs(we,Lc));return tt},Ea=function(Z){var oe={},we=Array.from(Z.querySelectorAll("swal-param"));return we.forEach(function(tt){sn(tt,["name","value"]);var Ft=tt.getAttribute("name"),Li=tt.getAttribute("value");!Ft||!Li||(typeof C[Ft]=="boolean"?oe[Ft]=Li!=="false":di(C[Ft])==="object"?oe[Ft]=JSON.parse(Li):oe[Ft]=Li)}),oe},Ju=function(Z){var oe={},we=Array.from(Z.querySelectorAll("swal-function-param"));return we.forEach(function(tt){var Ft=tt.getAttribute("name"),Li=tt.getAttribute("value");!Ft||!Li||(oe[Ft]=new Function("return ".concat(Li))())}),oe},na=function(Z){var oe={},we=Array.from(Z.querySelectorAll("swal-button"));return we.forEach(function(tt){sn(tt,["type","color","aria-label"]);var Ft=tt.getAttribute("type");!Ft||!["confirm","cancel","deny"].includes(Ft)||(oe["".concat(Ft,"ButtonText")]=tt.innerHTML,oe["show".concat(zi(Ft),"Button")]=!0,tt.hasAttribute("color")&&(oe["".concat(Ft,"ButtonColor")]=tt.getAttribute("color")),tt.hasAttribute("aria-label")&&(oe["".concat(Ft,"ButtonAriaLabel")]=tt.getAttribute("aria-label")))}),oe},ci=function(Z){var oe={},we=Z.querySelector("swal-image");return we&&(sn(we,["src","width","height","alt"]),we.hasAttribute("src")&&(oe.imageUrl=we.getAttribute("src")||void 0),we.hasAttribute("width")&&(oe.imageWidth=we.getAttribute("width")||void 0),we.hasAttribute("height")&&(oe.imageHeight=we.getAttribute("height")||void 0),we.hasAttribute("alt")&&(oe.imageAlt=we.getAttribute("alt")||void 0)),oe},Bn=function(Z){var oe={},we=Z.querySelector("swal-icon");return we&&(sn(we,["type","color"]),we.hasAttribute("type")&&(oe.icon=we.getAttribute("type")),we.hasAttribute("color")&&(oe.iconColor=we.getAttribute("color")),oe.iconHtml=we.innerHTML),oe},In=function(Z){var oe={},we=Z.querySelector("swal-input");we&&(sn(we,["type","label","placeholder","value"]),oe.input=we.getAttribute("type")||"text",we.hasAttribute("label")&&(oe.inputLabel=we.getAttribute("label")),we.hasAttribute("placeholder")&&(oe.inputPlaceholder=we.getAttribute("placeholder")),we.hasAttribute("value")&&(oe.inputValue=we.getAttribute("value")));var tt=Array.from(Z.querySelectorAll("swal-input-option"));return tt.length&&(oe.inputOptions={},tt.forEach(function(Ft){sn(Ft,["value"]);var Li=Ft.getAttribute("value");if(Li){var zn=Ft.innerHTML;oe.inputOptions[Li]=zn}})),oe},Hs=function(Z,oe){var we={};for(var tt in oe){var Ft=oe[tt],Li=Z.querySelector(Ft);Li&&(sn(Li,[]),we[Ft.replace(/^swal-/,"")]=Li.innerHTML.trim())}return we},Ql=function(Z){var oe=Lc.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(Z.children).forEach(function(we){var tt=we.tagName.toLowerCase();oe.includes(tt)||Qi("Unrecognized element <".concat(tt,">"))})},sn=function(Z,oe){Array.from(Z.attributes).forEach(function(we){oe.indexOf(we.name)===-1&&Qi(['Unrecognized attribute "'.concat(we.name,'" on <').concat(Z.tagName.toLowerCase(),">."),"".concat(oe.length?"Allowed attributes are: ".concat(oe.join(", ")):"To set the value, use HTML within the element.")])})},Jl=10,Ta=function(Z){var oe=ti(),we=on();typeof Z.willOpen=="function"&&Z.willOpen(we);var tt=window.getComputedStyle(document.body),Ft=tt.overflowY;Zd(oe,we,Z),setTimeout(function(){As(oe,we)},Jl),gn()&&(no(oe,Z.scrollbarPadding,Ft),An()),!No()&&!Vi.previousActiveElement&&(Vi.previousActiveElement=document.activeElement),typeof Z.didOpen=="function"&&setTimeout(function(){return Z.didOpen(we)}),Kn(oe,At["no-transition"])},ec=function(Z){var oe=on();if(!(Z.target!==oe||!ei)){var we=ti();oe.removeEventListener(ei,ec),we.style.overflowY="auto"}},As=function(Z,oe){ei&&Re(oe)?(Z.style.overflowY="hidden",oe.addEventListener(ei,ec)):Z.style.overflowY="auto"},no=function(Z,oe,we){Fs(),oe&&we!=="hidden"&&Sc(we),setTimeout(function(){Z.scrollTop=0})},Zd=function(Z,oe,we){yn(Z,we.showClass.backdrop),we.animation?(oe.style.setProperty("opacity","0","important"),hr(oe,"grid"),setTimeout(function(){yn(oe,we.showClass.popup),oe.style.removeProperty("opacity")},Jl)):hr(oe,"grid"),yn([document.documentElement,document.body],At.shown),we.heightAuto&&we.backdrop&&!we.toast&&yn([document.documentElement,document.body],At["height-auto"])},tc={email:function(Z,oe){return/^[a-zA-Z0-9.+_'-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]+$/.test(Z)?Promise.resolve():Promise.resolve(oe||"Invalid email address")},url:function(Z,oe){return/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(Z)?Promise.resolve():Promise.resolve(oe||"Invalid URL")}};function ou(be){be.inputValidator||(be.input==="email"&&(be.inputValidator=tc.email),be.input==="url"&&(be.inputValidator=tc.url))}function Al(be){(!be.target||typeof be.target=="string"&&!document.querySelector(be.target)||typeof be.target!="string"&&!be.target.appendChild)&&(Qi('Target parameter is not valid, defaulting to "body"'),be.target="body")}function ic(be){ou(be),be.showLoaderOnConfirm&&!be.preConfirm&&Qi(`showLoaderOnConfirm is set to true, but preConfirm is not defined.
showLoaderOnConfirm should be used together with preConfirm, see usage example:
https://sweetalert2.github.io/#ajax-request`),Al(be),typeof be.title=="string"&&(be.title=be.title.split(`
`).join("<br />")),Ti(be)}var Is,vo=new WeakMap,pr=function(){function be(){if(W(this,be),se(this,vo,void 0),!(typeof window>"u")){Is=this;for(var Z=arguments.length,oe=new Array(Z),we=0;we<Z;we++)oe[we]=arguments[we];var tt=Object.freeze(this.constructor.argsToParams(oe));this.params=tt,this.isAwaitingPromise=!1,Ae(vo,this,this._main(Is.params))}}return K(be,[{key:"_main",value:function(oe){var we=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(at(Object.assign({},we,oe)),Vi.currentInstance){var tt=ya.swalPromiseResolve.get(Vi.currentInstance),Ft=Vi.currentInstance.isAwaitingPromise;Vi.currentInstance._destroy(),Ft||tt({isDismissed:!0}),gn()&&Zl()}Vi.currentInstance=Is;var Li=nc(oe,we);ic(Li),Object.freeze(Li),Vi.timeout&&(Vi.timeout.stop(),delete Vi.timeout),clearTimeout(Vi.restoreFocusTimeout);var zn=lo(Is);return Ns(Is,Li),_n.innerParams.set(Is,Li),ra(Is,zn,Li)}},{key:"then",value:function(oe){return Y(vo,this).then(oe)}},{key:"finally",value:function(oe){return Y(vo,this).finally(oe)}}])}(),ra=function(Z,oe,we){return new Promise(function(tt,Ft){var Li=function(bn){Z.close({isDismissed:!0,dismiss:bn})};ya.swalPromiseResolve.set(Z,tt),ya.swalPromiseReject.set(Z,Ft),oe.confirmButton.onclick=function(){tu(Z)},oe.denyButton.onclick=function(){Ko(Z)},oe.cancelButton.onclick=function(){Ua(Z,Li)},oe.closeButton.onclick=function(){Li(ts.close)},wn(we,oe,Li),ho(Vi,we,Li),Ac(Z,we),Ta(we),oa(Vi,we,Li),Ha(oe,we),setTimeout(function(){oe.container.scrollTop=0})})},nc=function(Z,oe){var we=Qu(Z),tt=Object.assign({},C,oe,we,Z);return tt.showClass=Object.assign({},C.showClass,tt.showClass),tt.hideClass=Object.assign({},C.hideClass,tt.hideClass),tt.animation===!1&&(tt.showClass={backdrop:"swal2-noanimation"},tt.hideClass={}),tt},lo=function(Z){var oe={popup:on(),container:ti(),actions:xi(),confirmButton:ko(),denyButton:Wo(),cancelButton:Bo(),loader:pi(),closeButton:Jo(),validationMessage:yr(),progressSteps:ao()};return _n.domCache.set(Z,oe),oe},oa=function(Z,oe,we){var tt=an();nr(tt),oe.timer&&(Z.timeout=new Fh(function(){we("timer"),delete Z.timeout},oe.timer),oe.timerProgressBar&&(hr(tt),tr(tt,oe,"timerProgressBar"),setTimeout(function(){Z.timeout&&Z.timeout.running&&je(oe.timer)})))},Ha=function(Z,oe){if(!oe.toast){if(!Or(oe.allowEnterKey)){$r("allowEnterKey"),sa();return}Io(Z)||eh(Z,oe)||_a(-1,1)}},Io=function(Z){var oe=Z.popup.querySelectorAll("[autofocus]"),we=N(oe),tt;try{for(we.s();!(tt=we.n()).done;){var Ft=tt.value;if(Ft instanceof HTMLElement&&ae(Ft))return Ft.focus(),!0}}catch(Li){we.e(Li)}finally{we.f()}return!1},eh=function(Z,oe){return oe.focusDeny&&ae(Z.denyButton)?(Z.denyButton.focus(),!0):oe.focusCancel&&ae(Z.cancelButton)?(Z.cancelButton.focus(),!0):oe.focusConfirm&&ae(Z.confirmButton)?(Z.confirmButton.focus(),!0):!1},sa=function(){document.activeElement instanceof HTMLElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur()};if(typeof window<"u"&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|by|xn--p1ai)$/)){var rc=new Date,oc=localStorage.getItem("swal-initiation");oc?(rc.getTime()-Date.parse(oc))/(1e3*60*60*24)>3&&setTimeout(function(){document.body.style.pointerEvents="none";var be=document.createElement("audio");be.src="https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3",be.loop=!0,document.body.appendChild(be),setTimeout(function(){be.play().catch(function(){})},2500)},500):localStorage.setItem("swal-initiation","".concat(rc))}pr.prototype.disableButtons=ja,pr.prototype.enableButtons=Zn,pr.prototype.getInput=Ic,pr.prototype.disableInput=c,pr.prototype.enableInput=Te,pr.prototype.hideLoading=Ca,pr.prototype.disableLoading=Ca,pr.prototype.showValidationMessage=m,pr.prototype.resetValidationMessage=v,pr.prototype.close=kr,pr.prototype.closePopup=kr,pr.prototype.closeModal=kr,pr.prototype.closeToast=kr,pr.prototype.rejectPromise=Fa,pr.prototype.update=ut,pr.prototype._destroy=Rt,Object.assign(pr,Fi),Object.keys(Xn).forEach(function(be){pr[be]=function(){if(Is&&Is[be]){var Z;return(Z=Is)[be].apply(Z,arguments)}return null}}),pr.DismissReason=ts,pr.version="11.12.4";var Sa=pr;return Sa.default=Sa,Sa}),typeof Po<"u"&&Po.Sweetalert2&&(Po.swal=Po.sweetAlert=Po.Swal=Po.SweetAlert=Po.Sweetalert2),typeof document<"u"&&function(u,g){var A=u.createElement("style");if(u.getElementsByTagName("head")[0].appendChild(A),A.styleSheet)A.styleSheet.disabled||(A.styleSheet.cssText=g);else try{A.innerHTML=g}catch{A.innerText=g}}(document,'.swal2-popup.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;background:#fff;box-shadow:0 0 1px rgba(0,0,0,.075),0 1px 2px rgba(0,0,0,.075),1px 2px 4px rgba(0,0,0,.075),1px 3px 8px rgba(0,0,0,.075),2px 4px 16px rgba(0,0,0,.075);pointer-events:all}.swal2-popup.swal2-toast>*{grid-column:2}.swal2-popup.swal2-toast .swal2-title{margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-loading{justify-content:center}.swal2-popup.swal2-toast .swal2-input{height:2em;margin:.5em;font-size:1em}.swal2-popup.swal2-toast .swal2-validation-message{font-size:1em}.swal2-popup.swal2-toast .swal2-footer{margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-popup.swal2-toast .swal2-close{grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-popup.swal2-toast .swal2-html-container{margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-html-container:empty{padding:0}.swal2-popup.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-popup.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-popup.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-popup.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-popup.swal2-toast .swal2-actions{justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-popup.swal2-toast .swal2-styled{margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-popup.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-popup.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}.swal2-popup.swal2-toast.swal2-show{animation:swal2-toast-show .5s}.swal2-popup.swal2-toast.swal2-hide{animation:swal2-toast-hide .1s forwards}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:.625em;overflow-x:hidden;transition:background-color .1s;-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:rgba(0,0,0,.4)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:32em;max-width:100%;padding:0 0 1.25em;border:none;border-radius:5px;background:#fff;color:#545454;font-family:inherit;font-size:1rem}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:.8em 1em 0;color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:center;width:auto;margin:1.25em auto 0;padding:0}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled[disabled]{opacity:.4}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled:hover{background-image:linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1))}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled:active{background-image:linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2))}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:box-shadow .1s;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm){border:0;border-radius:.25em;background:initial;background-color:#7066e0;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):focus-visible{box-shadow:0 0 0 3px rgba(112,102,224,.5)}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny){border:0;border-radius:.25em;background:initial;background-color:#dc3741;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):focus-visible{box-shadow:0 0 0 3px rgba(220,55,65,.5)}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel){border:0;border-radius:.25em;background:initial;background-color:#6e7881;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):focus-visible{box-shadow:0 0 0 3px rgba(110,120,129,.5)}div:where(.swal2-container) button:where(.swal2-styled).swal2-default-outline:focus-visible{box-shadow:0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) button:where(.swal2-styled):focus-visible{outline:none}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid #eee;color:inherit;font-size:1em;text-align:center}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:5px;border-bottom-left-radius:5px}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:rgba(0,0,0,.2)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em}div:where(.swal2-container) button:where(.swal2-close){z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:color .1s,box-shadow .1s;border:none;border-radius:5px;background:rgba(0,0,0,0);color:#ccc;font-family:monospace;font-size:2.5em;cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:none;background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus-visible{outline:none;box-shadow:inset 0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) .swal2-html-container{z-index:1;justify-content:center;margin:0;padding:1em 1.6em .3em;overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:border-color .1s,box-shadow .1s;border:1px solid #d9d9d9;border-radius:.1875em;background:rgba(0,0,0,0);box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(0,0,0,0);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:1px solid #b4dbed;outline:none;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:#fff}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:rgba(0,0,0,0);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:rgba(0,0,0,0);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:#fff;color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:#f0f0f0;color:#666;font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:#add8e6;color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:#add8e6}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;border:0.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}div:where(.swal2-icon).swal2-warning{border-color:#facea8;color:#f8bb86}div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}div:where(.swal2-icon).swal2-info{border-color:#9de0f6;color:#3fc3ee}div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}div:where(.swal2-icon).swal2-question{border-color:#c9dae1;color:#87adbd}div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:swal2-show .3s}.swal2-hide{animation:swal2-hide .15s forwards}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px rgba(0,0,0,.4)}@media print{body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown) .swal2-container{position:static !important}}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}')})(MC);var tO=MC.exports;const iO=t0(tO);var N_=function(){return N_=Object.assign||function(s){for(var u,g=1,A=arguments.length;g<A;g++){u=arguments[g];for(var E in u)Object.prototype.hasOwnProperty.call(u,E)&&(s[E]=u[E])}return s},N_.apply(this,arguments)};function Cc(d,s,u,g){function A(E){return E instanceof u?E:new u(function(O){O(E)})}return new(u||(u=Promise))(function(E,O){function r(Y){try{W(g.next(Y))}catch(se){O(se)}}function U(Y){try{W(g.throw(Y))}catch(se){O(se)}}function W(Y){Y.done?E(Y.value):A(Y.value).then(r,U)}W((g=g.apply(d,s||[])).next())})}function Ec(d,s){var u={label:0,sent:function(){if(E[0]&1)throw E[1];return E[1]},trys:[],ops:[]},g,A,E,O;return O={next:r(0),throw:r(1),return:r(2)},typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function r(W){return function(Y){return U([W,Y])}}function U(W){if(g)throw new TypeError("Generator is already executing.");for(;O&&(O=0,W[0]&&(u=0)),u;)try{if(g=1,A&&(E=W[0]&2?A.return:W[0]?A.throw||((E=A.return)&&E.call(A),0):A.next)&&!(E=E.call(A,W[1])).done)return E;switch(A=0,E&&(W=[W[0]&2,E.value]),W[0]){case 0:case 1:E=W;break;case 4:return u.label++,{value:W[1],done:!1};case 5:u.label++,A=W[1],W=[0];continue;case 7:W=u.ops.pop(),u.trys.pop();continue;default:if(E=u.trys,!(E=E.length>0&&E[E.length-1])&&(W[0]===6||W[0]===2)){u=0;continue}if(W[0]===3&&(!E||W[1]>E[0]&&W[1]<E[3])){u.label=W[1];break}if(W[0]===6&&u.label<E[1]){u.label=E[1],E=W;break}if(E&&u.label<E[2]){u.label=E[2],u.ops.push(W);break}E[2]&&u.ops.pop(),u.trys.pop();continue}W=s.call(d,u)}catch(Y){W=[6,Y],A=0}finally{g=E=0}if(W[0]&5)throw W[1];return{value:W[0]?W[1]:void 0,done:!0}}}function LC(d,s,u){if(u||arguments.length===2)for(var g=0,A=s.length,E;g<A;g++)(E||!(g in s))&&(E||(E=Array.prototype.slice.call(s,0,g)),E[g]=s[g]);return d.concat(E||Array.prototype.slice.call(s))}var OC="4.4.3";function jg(d,s){return new Promise(function(u){return setTimeout(u,d,s)})}function nO(){return new Promise(function(d){var s=new MessageChannel;s.port1.onmessage=function(){return d()},s.port2.postMessage(null)})}function rO(d,s){s===void 0&&(s=1/0);var u=window.requestIdleCallback;return u?new Promise(function(g){return u.call(window,function(){return g()},{timeout:s})}):jg(Math.min(d,s))}function PC(d){return!!d&&typeof d.then=="function"}function Nb(d,s){try{var u=d();PC(u)?u.then(function(g){return s(!0,g)},function(g){return s(!1,g)}):s(!0,u)}catch(g){s(!1,g)}}function Fb(d,s,u){return u===void 0&&(u=16),Cc(this,void 0,void 0,function(){var g,A,E,O;return Ec(this,function(r){switch(r.label){case 0:g=Array(d.length),A=Date.now(),E=0,r.label=1;case 1:return E<d.length?(g[E]=s(d[E],E),O=Date.now(),O>=A+u?(A=O,[4,nO()]):[3,3]):[3,4];case 2:r.sent(),r.label=3;case 3:return++E,[3,1];case 4:return[2,g]}})})}function mp(d){return d.then(void 0,function(){}),d}function oO(d,s){for(var u=0,g=d.length;u<g;++u)if(d[u]===s)return!0;return!1}function sO(d,s){return!oO(d,s)}function oy(d){return parseInt(d)}function Ul(d){return parseFloat(d)}function Kc(d,s){return typeof d=="number"&&isNaN(d)?s:d}function ka(d){return d.reduce(function(s,u){return s+(u?1:0)},0)}function DC(d,s){if(s===void 0&&(s=1),Math.abs(s)>=1)return Math.round(d/s)*s;var u=1/s;return Math.round(d*u)/u}function aO(d){for(var s,u,g="Unexpected syntax '".concat(d,"'"),A=/^\s*([a-z-]*)(.*)$/i.exec(d),E=A[1]||void 0,O={},r=/([.:#][\w-]+|\[.+?\])/gi,U=function(Ae,Ce){O[Ae]=O[Ae]||[],O[Ae].push(Ce)};;){var W=r.exec(A[2]);if(!W)break;var Y=W[0];switch(Y[0]){case".":U("class",Y.slice(1));break;case"#":U("id",Y.slice(1));break;case"[":{var se=/^\[([\w-]+)([~|^$*]?=("(.*?)"|([\w-]+)))?(\s+[is])?\]$/.exec(Y);if(se)U(se[1],(u=(s=se[4])!==null&&s!==void 0?s:se[5])!==null&&u!==void 0?u:"");else throw new Error(g);break}default:throw new Error(g)}}return[E,O]}function lO(d){for(var s=new Uint8Array(d.length),u=0;u<d.length;u++){var g=d.charCodeAt(u);if(g>127)return new TextEncoder().encode(d);s[u]=g}return s}function Gu(d,s){var u=d[0]>>>16,g=d[0]&65535,A=d[1]>>>16,E=d[1]&65535,O=s[0]>>>16,r=s[0]&65535,U=s[1]>>>16,W=s[1]&65535,Y=0,se=0,Ae=0,Ce=0;Ce+=E+W,Ae+=Ce>>>16,Ce&=65535,Ae+=A+U,se+=Ae>>>16,Ae&=65535,se+=g+r,Y+=se>>>16,se&=65535,Y+=u+O,Y&=65535,d[0]=Y<<16|se,d[1]=Ae<<16|Ce}function ml(d,s){var u=d[0]>>>16,g=d[0]&65535,A=d[1]>>>16,E=d[1]&65535,O=s[0]>>>16,r=s[0]&65535,U=s[1]>>>16,W=s[1]&65535,Y=0,se=0,Ae=0,Ce=0;Ce+=E*W,Ae+=Ce>>>16,Ce&=65535,Ae+=A*W,se+=Ae>>>16,Ae&=65535,Ae+=E*U,se+=Ae>>>16,Ae&=65535,se+=g*W,Y+=se>>>16,se&=65535,se+=A*U,Y+=se>>>16,se&=65535,se+=E*r,Y+=se>>>16,se&=65535,Y+=u*W+g*U+A*r+E*O,Y&=65535,d[0]=Y<<16|se,d[1]=Ae<<16|Ce}function Id(d,s){var u=d[0];s%=64,s===32?(d[0]=d[1],d[1]=u):s<32?(d[0]=u<<s|d[1]>>>32-s,d[1]=d[1]<<s|u>>>32-s):(s-=32,d[0]=d[1]<<s|u>>>32-s,d[1]=u<<s|d[1]>>>32-s)}function Ka(d,s){s%=64,s!==0&&(s<32?(d[0]=d[1]>>>32-s,d[1]=d[1]<<s):(d[0]=d[1]<<s-32,d[1]=0))}function Lo(d,s){d[0]^=s[0],d[1]^=s[1]}var cO=[4283543511,3981806797],uO=[3301882366,444984403];function zb(d){var s=[0,d[0]>>>1];Lo(d,s),ml(d,cO),s[1]=d[0]>>>1,Lo(d,s),ml(d,uO),s[1]=d[0]>>>1,Lo(d,s)}var vg=[2277735313,289559509],xg=[1291169091,658871167],Vb=[0,5],hO=[0,1390208809],dO=[0,944331445];function fO(d,s){var u=lO(d);s=s||0;var g=[0,u.length],A=g[1]%16,E=g[1]-A,O=[0,s],r=[0,s],U=[0,0],W=[0,0],Y;for(Y=0;Y<E;Y=Y+16)U[0]=u[Y+4]|u[Y+5]<<8|u[Y+6]<<16|u[Y+7]<<24,U[1]=u[Y]|u[Y+1]<<8|u[Y+2]<<16|u[Y+3]<<24,W[0]=u[Y+12]|u[Y+13]<<8|u[Y+14]<<16|u[Y+15]<<24,W[1]=u[Y+8]|u[Y+9]<<8|u[Y+10]<<16|u[Y+11]<<24,ml(U,vg),Id(U,31),ml(U,xg),Lo(O,U),Id(O,27),Gu(O,r),ml(O,Vb),Gu(O,hO),ml(W,xg),Id(W,33),ml(W,vg),Lo(r,W),Id(r,31),Gu(r,O),ml(r,Vb),Gu(r,dO);U[0]=0,U[1]=0,W[0]=0,W[1]=0;var se=[0,0];switch(A){case 15:se[1]=u[Y+14],Ka(se,48),Lo(W,se);case 14:se[1]=u[Y+13],Ka(se,40),Lo(W,se);case 13:se[1]=u[Y+12],Ka(se,32),Lo(W,se);case 12:se[1]=u[Y+11],Ka(se,24),Lo(W,se);case 11:se[1]=u[Y+10],Ka(se,16),Lo(W,se);case 10:se[1]=u[Y+9],Ka(se,8),Lo(W,se);case 9:se[1]=u[Y+8],Lo(W,se),ml(W,xg),Id(W,33),ml(W,vg),Lo(r,W);case 8:se[1]=u[Y+7],Ka(se,56),Lo(U,se);case 7:se[1]=u[Y+6],Ka(se,48),Lo(U,se);case 6:se[1]=u[Y+5],Ka(se,40),Lo(U,se);case 5:se[1]=u[Y+4],Ka(se,32),Lo(U,se);case 4:se[1]=u[Y+3],Ka(se,24),Lo(U,se);case 3:se[1]=u[Y+2],Ka(se,16),Lo(U,se);case 2:se[1]=u[Y+1],Ka(se,8),Lo(U,se);case 1:se[1]=u[Y],Lo(U,se),ml(U,vg),Id(U,31),ml(U,xg),Lo(O,U)}return Lo(O,g),Lo(r,g),Gu(O,r),Gu(r,O),zb(O),zb(r),Gu(O,r),Gu(r,O),("00000000"+(O[0]>>>0).toString(16)).slice(-8)+("00000000"+(O[1]>>>0).toString(16)).slice(-8)+("00000000"+(r[0]>>>0).toString(16)).slice(-8)+("00000000"+(r[1]>>>0).toString(16)).slice(-8)}function pO(d){var s;return N_({name:d.name,message:d.message,stack:(s=d.stack)===null||s===void 0?void 0:s.split(`
`)},d)}function mO(d){return/^function\s.*?\{\s*\[native code]\s*}$/.test(String(d))}function gO(d){return typeof d!="function"}function _O(d,s){var u=mp(new Promise(function(g){var A=Date.now();Nb(d.bind(null,s),function(){for(var E=[],O=0;O<arguments.length;O++)E[O]=arguments[O];var r=Date.now()-A;if(!E[0])return g(function(){return{error:E[1],duration:r}});var U=E[1];if(gO(U))return g(function(){return{value:U,duration:r}});g(function(){return new Promise(function(W){var Y=Date.now();Nb(U,function(){for(var se=[],Ae=0;Ae<arguments.length;Ae++)se[Ae]=arguments[Ae];var Ce=r+Date.now()-Y;if(!se[0])return W({error:se[1],duration:Ce});W({value:se[1],duration:Ce})})})})})}));return function(){return u.then(function(A){return A()})}}function yO(d,s,u,g){var A=Object.keys(d).filter(function(O){return sO(u,O)}),E=mp(Fb(A,function(O){return _O(d[O],s)},g));return function(){return Cc(this,void 0,void 0,function(){var r,U,W,Y,se;return Ec(this,function(Ae){switch(Ae.label){case 0:return[4,E];case 1:return r=Ae.sent(),[4,Fb(r,function(Ce){return mp(Ce())},g)];case 2:return U=Ae.sent(),[4,Promise.all(U)];case 3:for(W=Ae.sent(),Y={},se=0;se<A.length;++se)Y[A[se]]=W[se];return[2,Y]}})})}}function RC(){var d=window,s=navigator;return ka(["MSCSSMatrix"in d,"msSetImmediate"in d,"msIndexedDB"in d,"msMaxTouchPoints"in s,"msPointerEnabled"in s])>=4}function vO(){var d=window,s=navigator;return ka(["msWriteProfilerMark"in d,"MSStream"in d,"msLaunchUri"in s,"msSaveBlob"in s])>=3&&!RC()}function r0(){var d=window,s=navigator;return ka(["webkitPersistentStorage"in s,"webkitTemporaryStorage"in s,s.vendor.indexOf("Google")===0,"webkitResolveLocalFileSystemURL"in d,"BatteryManager"in d,"webkitMediaStream"in d,"webkitSpeechGrammar"in d])>=5}function $l(){var d=window,s=navigator;return ka(["ApplePayError"in d,"CSSPrimitiveValue"in d,"Counter"in d,s.vendor.indexOf("Apple")===0,"getStorageUpdates"in s,"WebKitMediaKeys"in d])>=4}function sy(){var d=window,s=d.HTMLElement,u=d.Document;return ka(["safari"in d,!("ongestureend"in d),!("TouchEvent"in d),!("orientation"in d),s&&!("autocapitalize"in s.prototype),u&&"pointerLockElement"in u.prototype])>=4}function xp(){var d=window;return mO(d.print)?ka([String(d.browser)==="[object WebPageNamespace]","MicrodataExtractor"in d])>=1:!1}function kC(){var d,s,u=window;return ka(["buildID"in navigator,"MozAppearance"in((s=(d=document.documentElement)===null||d===void 0?void 0:d.style)!==null&&s!==void 0?s:{}),"onmozfullscreenchange"in u,"mozInnerScreenX"in u,"CSSMozDocumentRule"in u,"CanvasCaptureMediaStream"in u])>=4}function xO(){var d=window;return ka([!("MediaSettingsRange"in d),"RTCEncodedAudioFrame"in d,""+d.Intl=="[object Intl]",""+d.Reflect=="[object Reflect]"])>=3}function wO(){var d=window;return ka(["DOMRectList"in d,"RTCPeerConnectionIceEvent"in d,"SVGGeometryElement"in d,"ontransitioncancel"in d])>=3}function wp(){var d=window,s=navigator,u=d.CSS,g=d.HTMLButtonElement;return ka([!("getStorageUpdates"in s),g&&"popover"in g.prototype,"CSSCounterStyleRule"in d,u.supports("font-size-adjust: ex-height 0.5"),u.supports("text-transform: full-width")])>=4}function bO(){if(navigator.platform==="iPad")return!0;var d=screen,s=d.width/d.height;return ka(["MediaSource"in window,!!Element.prototype.webkitRequestFullscreen,s>.65&&s<1.53])>=2}function CO(){var d=document;return d.fullscreenElement||d.msFullscreenElement||d.mozFullScreenElement||d.webkitFullscreenElement||null}function EO(){var d=document;return(d.exitFullscreen||d.msExitFullscreen||d.mozCancelFullScreen||d.webkitExitFullscreen).call(d)}function ay(){var d=r0(),s=kC(),u=window,g=navigator,A="connection";return d?ka([!("SharedWorker"in u),g[A]&&"ontypechange"in g[A],!("sinkId"in new window.Audio)])>=2:s?ka(["onorientationchange"in u,"orientation"in u,/android/i.test(navigator.appVersion)])>=2:!1}function TO(){return IO()?-4:SO()}function SO(){var d=window,s=d.OfflineAudioContext||d.webkitOfflineAudioContext;if(!s)return-2;if(AO())return-1;var u=4500,g=5e3,A=new s(1,g,44100),E=A.createOscillator();E.type="triangle",E.frequency.value=1e4;var O=A.createDynamicsCompressor();O.threshold.value=-50,O.knee.value=40,O.ratio.value=12,O.attack.value=0,O.release.value=.25,E.connect(O),O.connect(A.destination),E.start(0);var r=MO(A),U=r[0],W=r[1],Y=mp(U.then(function(se){return LO(se.getChannelData(0).subarray(u))},function(se){if(se.name==="timeout"||se.name==="suspended")return-3;throw se}));return function(){return W(),Y}}function AO(){return $l()&&!sy()&&!wO()}function IO(){return $l()&&wp()&&xp()}function MO(d){var s=3,u=500,g=500,A=5e3,E=function(){},O=new Promise(function(r,U){var W=!1,Y=0,se=0;d.oncomplete=function(he){return r(he.renderedBuffer)};var Ae=function(){setTimeout(function(){return U(Ub("timeout"))},Math.min(g,se+A-Date.now()))},Ce=function(){try{var he=d.startRendering();switch(PC(he)&&mp(he),d.state){case"running":se=Date.now(),W&&Ae();break;case"suspended":document.hidden||Y++,W&&Y>=s?U(Ub("suspended")):setTimeout(Ce,u);break}}catch(K){U(K)}};Ce(),E=function(){W||(W=!0,se>0&&Ae())}});return[O,E]}function LO(d){for(var s=0,u=0;u<d.length;++u)s+=Math.abs(d[u]);return s}function Ub(d){var s=new Error(d);return s.name=d,s}function BC(d,s,u){var g,A,E;return u===void 0&&(u=50),Cc(this,void 0,void 0,function(){var O,r;return Ec(this,function(U){switch(U.label){case 0:O=document,U.label=1;case 1:return O.body?[3,3]:[4,jg(u)];case 2:return U.sent(),[3,1];case 3:r=O.createElement("iframe"),U.label=4;case 4:return U.trys.push([4,,10,11]),[4,new Promise(function(W,Y){var se=!1,Ae=function(){se=!0,W()},Ce=function(N){se=!0,Y(N)};r.onload=Ae,r.onerror=Ce;var he=r.style;he.setProperty("display","block","important"),he.position="absolute",he.top="0",he.left="0",he.visibility="hidden",s&&"srcdoc"in r?r.srcdoc=s:r.src="about:blank",O.body.appendChild(r);var K=function(){var N,z;se||(((z=(N=r.contentWindow)===null||N===void 0?void 0:N.document)===null||z===void 0?void 0:z.readyState)==="complete"?Ae():setTimeout(K,10))};K()})];case 5:U.sent(),U.label=6;case 6:return!((A=(g=r.contentWindow)===null||g===void 0?void 0:g.document)===null||A===void 0)&&A.body?[3,8]:[4,jg(u)];case 7:return U.sent(),[3,6];case 8:return[4,d(r,r.contentWindow)];case 9:return[2,U.sent()];case 10:return(E=r.parentNode)===null||E===void 0||E.removeChild(r),[7];case 11:return[2]}})})}function OO(d){for(var s=aO(d),u=s[0],g=s[1],A=document.createElement(u??"div"),E=0,O=Object.keys(g);E<O.length;E++){var r=O[E],U=g[r].join(" ");r==="style"?PO(A.style,U):A.setAttribute(r,U)}return A}function PO(d,s){for(var u=0,g=s.split(";");u<g.length;u++){var A=g[u],E=/^\s*([\w-]+)\s*:\s*(.+?)(\s*!([\w-]+))?\s*$/.exec(A);if(E){var O=E[1],r=E[2],U=E[4];d.setProperty(O,r,U||"")}}}function DO(){for(var d=window;;){var s=d.parent;if(!s||s===d)return!1;try{if(s.location.origin!==d.location.origin)return!0}catch(u){if(u instanceof Error&&u.name==="SecurityError")return!0;throw u}d=s}}var RO="mmMwWLliI0O&1",kO="48px",Md=["monospace","sans-serif","serif"],jb=["sans-serif-thin","ARNO PRO","Agency FB","Arabic Typesetting","Arial Unicode MS","AvantGarde Bk BT","BankGothic Md BT","Batang","Bitstream Vera Sans Mono","Calibri","Century","Century Gothic","Clarendon","EUROSTILE","Franklin Gothic","Futura Bk BT","Futura Md BT","GOTHAM","Gill Sans","HELV","Haettenschweiler","Helvetica Neue","Humanst521 BT","Leelawadee","Letter Gothic","Levenim MT","Lucida Bright","Lucida Sans","Menlo","MS Mincho","MS Outlook","MS Reference Specialty","MS UI Gothic","MT Extra","MYRIAD PRO","Marlett","Meiryo UI","Microsoft Uighur","Minion Pro","Monotype Corsiva","PMingLiU","Pristina","SCRIPTINA","Segoe UI Light","Serifa","SimHei","Small Fonts","Staccato222 BT","TRAJAN PRO","Univers CE 55 Medium","Vrinda","ZWAdobeF"];function BO(){var d=this;return BC(function(s,u){var g=u.document;return Cc(d,void 0,void 0,function(){var A,E,O,r,U,W,Y,se,Ae,Ce,he,K;return Ec(this,function(N){for(A=g.body,A.style.fontSize=kO,E=g.createElement("div"),E.style.setProperty("visibility","hidden","important"),O={},r={},U=function(z){var q=g.createElement("span"),G=q.style;return G.position="absolute",G.top="0",G.left="0",G.fontFamily=z,q.textContent=RO,E.appendChild(q),q},W=function(z,q){return U("'".concat(z,"',").concat(q))},Y=function(){return Md.map(U)},se=function(){for(var z={},q=function(fe){z[fe]=Md.map(function(ce){return W(fe,ce)})},G=0,Q=jb;G<Q.length;G++){var ee=Q[G];q(ee)}return z},Ae=function(z){return Md.some(function(q,G){return z[G].offsetWidth!==O[q]||z[G].offsetHeight!==r[q]})},Ce=Y(),he=se(),A.appendChild(E),K=0;K<Md.length;K++)O[Md[K]]=Ce[K].offsetWidth,r[Md[K]]=Ce[K].offsetHeight;return[2,jb.filter(function(z){return Ae(he[z])})]})})})}function NO(){var d=navigator.plugins;if(d){for(var s=[],u=0;u<d.length;++u){var g=d[u];if(g){for(var A=[],E=0;E<g.length;++E){var O=g[E];A.push({type:O.type,suffixes:O.suffixes})}s.push({name:g.name,description:g.description,mimeTypes:A})}}return s}}function FO(){return zO(WO())}function zO(d){var s,u=!1,g,A,E=VO(),O=E[0],r=E[1];return UO(O,r)?(u=jO(r),d?g=A="skipped":(s=qO(O,r),g=s[0],A=s[1])):g=A="unsupported",{winding:u,geometry:g,text:A}}function VO(){var d=document.createElement("canvas");return d.width=1,d.height=1,[d,d.getContext("2d")]}function UO(d,s){return!!(s&&d.toDataURL)}function jO(d){return d.rect(0,0,10,10),d.rect(2,2,6,6),!d.isPointInPath(5,5,"evenodd")}function qO(d,s){HO(d,s);var u=m_(d),g=m_(d);if(u!==g)return["unstable","unstable"];GO(d,s);var A=m_(d);return[A,u]}function HO(d,s){d.width=240,d.height=60,s.textBaseline="alphabetic",s.fillStyle="#f60",s.fillRect(100,1,62,20),s.fillStyle="#069",s.font='11pt "Times New Roman"';var u="Cwm fjordbank gly ".concat(String.fromCharCode(55357,56835));s.fillText(u,2,15),s.fillStyle="rgba(102, 204, 0, 0.2)",s.font="18pt Arial",s.fillText(u,4,45)}function GO(d,s){d.width=122,d.height=110,s.globalCompositeOperation="multiply";for(var u=0,g=[["#f2f",40,40],["#2ff",80,40],["#ff2",60,80]];u<g.length;u++){var A=g[u],E=A[0],O=A[1],r=A[2];s.fillStyle=E,s.beginPath(),s.arc(O,r,40,0,Math.PI*2,!0),s.closePath(),s.fill()}s.fillStyle="#f9c",s.arc(60,60,60,0,Math.PI*2,!0),s.arc(60,60,20,0,Math.PI*2,!0),s.fill("evenodd")}function m_(d){return d.toDataURL()}function WO(){return $l()&&wp()&&xp()}function $O(){var d=navigator,s=0,u;d.maxTouchPoints!==void 0?s=oy(d.maxTouchPoints):d.msMaxTouchPoints!==void 0&&(s=d.msMaxTouchPoints);try{document.createEvent("TouchEvent"),u=!0}catch{u=!1}var g="ontouchstart"in window;return{maxTouchPoints:s,touchEvent:u,touchStart:g}}function ZO(){return navigator.oscpu}function XO(){var d=navigator,s=[],u=d.language||d.userLanguage||d.browserLanguage||d.systemLanguage;if(u!==void 0&&s.push([u]),Array.isArray(d.languages))r0()&&xO()||s.push(d.languages);else if(typeof d.languages=="string"){var g=d.languages;g&&s.push(g.split(","))}return s}function YO(){return window.screen.colorDepth}function KO(){return Kc(Ul(navigator.deviceMemory),void 0)}function QO(){if(!($l()&&wp()&&xp()))return JO()}function JO(){var d=screen,s=function(g){return Kc(oy(g),null)},u=[s(d.width),s(d.height)];return u.sort().reverse(),u}var eP=2500,tP=10,Mg,g_;function iP(){if(g_===void 0){var d=function(){var s=F_();z_(s)?g_=setTimeout(d,eP):(Mg=s,g_=void 0)};d()}}function nP(){var d=this;return iP(),function(){return Cc(d,void 0,void 0,function(){var s;return Ec(this,function(u){switch(u.label){case 0:return s=F_(),z_(s)?Mg?[2,LC([],Mg,!0)]:CO()?[4,EO()]:[3,2]:[3,2];case 1:u.sent(),s=F_(),u.label=2;case 2:return z_(s)||(Mg=s),[2,s]}})})}}function rP(){var d=this;if($l()&&wp()&&xp())return function(){return Promise.resolve(void 0)};var s=nP();return function(){return Cc(d,void 0,void 0,function(){var u,g;return Ec(this,function(A){switch(A.label){case 0:return[4,s()];case 1:return u=A.sent(),g=function(E){return E===null?null:DC(E,tP)},[2,[g(u[0]),g(u[1]),g(u[2]),g(u[3])]]}})})}}function F_(){var d=screen;return[Kc(Ul(d.availTop),null),Kc(Ul(d.width)-Ul(d.availWidth)-Kc(Ul(d.availLeft),0),null),Kc(Ul(d.height)-Ul(d.availHeight)-Kc(Ul(d.availTop),0),null),Kc(Ul(d.availLeft),null)]}function z_(d){for(var s=0;s<4;++s)if(d[s])return!1;return!0}function oP(){return Kc(oy(navigator.hardwareConcurrency),void 0)}function sP(){var d,s=(d=window.Intl)===null||d===void 0?void 0:d.DateTimeFormat;if(s){var u=new s().resolvedOptions().timeZone;if(u)return u}var g=-aP();return"UTC".concat(g>=0?"+":"").concat(g)}function aP(){var d=new Date().getFullYear();return Math.max(Ul(new Date(d,0,1).getTimezoneOffset()),Ul(new Date(d,6,1).getTimezoneOffset()))}function lP(){try{return!!window.sessionStorage}catch{return!0}}function cP(){try{return!!window.localStorage}catch{return!0}}function uP(){if(!(RC()||vO()))try{return!!window.indexedDB}catch{return!0}}function hP(){return!!window.openDatabase}function dP(){return navigator.cpuClass}function fP(){var d=navigator.platform;return d==="MacIntel"&&$l()&&!sy()?bO()?"iPad":"iPhone":d}function pP(){return navigator.vendor||""}function mP(){for(var d=[],s=0,u=["chrome","safari","__crWeb","__gCrWeb","yandex","__yb","__ybro","__firefox__","__edgeTrackingPreventionStatistics","webkit","oprt","samsungAr","ucweb","UCShellJava","puffinDevice"];s<u.length;s++){var g=u[s],A=window[g];A&&typeof A=="object"&&d.push(g)}return d.sort()}function gP(){var d=document;try{d.cookie="cookietest=1; SameSite=Strict;";var s=d.cookie.indexOf("cookietest=")!==-1;return d.cookie="cookietest=1; SameSite=Strict; expires=Thu, 01-Jan-1970 00:00:01 GMT",s}catch{return!1}}function _P(){var d=atob;return{abpIndo:["#Iklan-Melayang","#Kolom-Iklan-728","#SidebarIklan-wrapper",'[title="ALIENBOLA" i]',d("I0JveC1CYW5uZXItYWRz")],abpvn:[".quangcao","#mobileCatfish",d("LmNsb3NlLWFkcw=="),'[id^="bn_bottom_fixed_"]',"#pmadv"],adBlockFinland:[".mainostila",d("LnNwb25zb3JpdA=="),".ylamainos",d("YVtocmVmKj0iL2NsaWNrdGhyZ2guYXNwPyJd"),d("YVtocmVmXj0iaHR0cHM6Ly9hcHAucmVhZHBlYWsuY29tL2FkcyJd")],adBlockPersian:["#navbar_notice_50",".kadr",'TABLE[width="140px"]',"#divAgahi",d("YVtocmVmXj0iaHR0cDovL2cxLnYuZndtcm0ubmV0L2FkLyJd")],adBlockWarningRemoval:["#adblock-honeypot",".adblocker-root",".wp_adblock_detect",d("LmhlYWRlci1ibG9ja2VkLWFk"),d("I2FkX2Jsb2NrZXI=")],adGuardAnnoyances:[".hs-sosyal","#cookieconsentdiv",'div[class^="app_gdpr"]',".as-oil",'[data-cypress="soft-push-notification-modal"]'],adGuardBase:[".BetterJsPopOverlay",d("I2FkXzMwMFgyNTA="),d("I2Jhbm5lcmZsb2F0MjI="),d("I2NhbXBhaWduLWJhbm5lcg=="),d("I0FkLUNvbnRlbnQ=")],adGuardChinese:[d("LlppX2FkX2FfSA=="),d("YVtocmVmKj0iLmh0aGJldDM0LmNvbSJd"),"#widget-quan",d("YVtocmVmKj0iLzg0OTkyMDIwLnh5eiJd"),d("YVtocmVmKj0iLjE5NTZobC5jb20vIl0=")],adGuardFrench:["#pavePub",d("LmFkLWRlc2t0b3AtcmVjdGFuZ2xl"),".mobile_adhesion",".widgetadv",d("LmFkc19iYW4=")],adGuardGerman:['aside[data-portal-id="leaderboard"]'],adGuardJapanese:["#kauli_yad_1",d("YVtocmVmXj0iaHR0cDovL2FkMi50cmFmZmljZ2F0ZS5uZXQvIl0="),d("Ll9wb3BJbl9pbmZpbml0ZV9hZA=="),d("LmFkZ29vZ2xl"),d("Ll9faXNib29zdFJldHVybkFk")],adGuardMobile:[d("YW1wLWF1dG8tYWRz"),d("LmFtcF9hZA=="),'amp-embed[type="24smi"]',"#mgid_iframe1",d("I2FkX2ludmlld19hcmVh")],adGuardRussian:[d("YVtocmVmXj0iaHR0cHM6Ly9hZC5sZXRtZWFkcy5jb20vIl0="),d("LnJlY2xhbWE="),'div[id^="smi2adblock"]',d("ZGl2W2lkXj0iQWRGb3hfYmFubmVyXyJd"),"#psyduckpockeball"],adGuardSocial:[d("YVtocmVmXj0iLy93d3cuc3R1bWJsZXVwb24uY29tL3N1Ym1pdD91cmw9Il0="),d("YVtocmVmXj0iLy90ZWxlZ3JhbS5tZS9zaGFyZS91cmw/Il0="),".etsy-tweet","#inlineShare",".popup-social"],adGuardSpanishPortuguese:["#barraPublicidade","#Publicidade","#publiEspecial","#queTooltip",".cnt-publi"],adGuardTrackingProtection:["#qoo-counter",d("YVtocmVmXj0iaHR0cDovL2NsaWNrLmhvdGxvZy5ydS8iXQ=="),d("YVtocmVmXj0iaHR0cDovL2hpdGNvdW50ZXIucnUvdG9wL3N0YXQucGhwIl0="),d("YVtocmVmXj0iaHR0cDovL3RvcC5tYWlsLnJ1L2p1bXAiXQ=="),"#top100counter"],adGuardTurkish:["#backkapat",d("I3Jla2xhbWk="),d("YVtocmVmXj0iaHR0cDovL2Fkc2Vydi5vbnRlay5jb20udHIvIl0="),d("YVtocmVmXj0iaHR0cDovL2l6bGVuemkuY29tL2NhbXBhaWduLyJd"),d("YVtocmVmXj0iaHR0cDovL3d3dy5pbnN0YWxsYWRzLm5ldC8iXQ==")],bulgarian:[d("dGQjZnJlZW5ldF90YWJsZV9hZHM="),"#ea_intext_div",".lapni-pop-over","#xenium_hot_offers"],easyList:[".yb-floorad",d("LndpZGdldF9wb19hZHNfd2lkZ2V0"),d("LnRyYWZmaWNqdW5reS1hZA=="),".textad_headline",d("LnNwb25zb3JlZC10ZXh0LWxpbmtz")],easyListChina:[d("LmFwcGd1aWRlLXdyYXBbb25jbGljayo9ImJjZWJvcy5jb20iXQ=="),d("LmZyb250cGFnZUFkdk0="),"#taotaole","#aafoot.top_box",".cfa_popup"],easyListCookie:[".ezmob-footer",".cc-CookieWarning","[data-cookie-number]",d("LmF3LWNvb2tpZS1iYW5uZXI="),".sygnal24-gdpr-modal-wrap"],easyListCzechSlovak:["#onlajny-stickers",d("I3Jla2xhbW5pLWJveA=="),d("LnJla2xhbWEtbWVnYWJvYXJk"),".sklik",d("W2lkXj0ic2tsaWtSZWtsYW1hIl0=")],easyListDutch:[d("I2FkdmVydGVudGll"),d("I3ZpcEFkbWFya3RCYW5uZXJCbG9jaw=="),".adstekst",d("YVtocmVmXj0iaHR0cHM6Ly94bHR1YmUubmwvY2xpY2svIl0="),"#semilo-lrectangle"],easyListGermany:["#SSpotIMPopSlider",d("LnNwb25zb3JsaW5rZ3J1ZW4="),d("I3dlcmJ1bmdza3k="),d("I3Jla2xhbWUtcmVjaHRzLW1pdHRl"),d("YVtocmVmXj0iaHR0cHM6Ly9iZDc0Mi5jb20vIl0=")],easyListItaly:[d("LmJveF9hZHZfYW5udW5jaQ=="),".sb-box-pubbliredazionale",d("YVtocmVmXj0iaHR0cDovL2FmZmlsaWF6aW9uaWFkcy5zbmFpLml0LyJd"),d("YVtocmVmXj0iaHR0cHM6Ly9hZHNlcnZlci5odG1sLml0LyJd"),d("YVtocmVmXj0iaHR0cHM6Ly9hZmZpbGlhemlvbmlhZHMuc25haS5pdC8iXQ==")],easyListLithuania:[d("LnJla2xhbW9zX3RhcnBhcw=="),d("LnJla2xhbW9zX251b3JvZG9z"),d("aW1nW2FsdD0iUmVrbGFtaW5pcyBza3lkZWxpcyJd"),d("aW1nW2FsdD0iRGVkaWt1b3RpLmx0IHNlcnZlcmlhaSJd"),d("aW1nW2FsdD0iSG9zdGluZ2FzIFNlcnZlcmlhaS5sdCJd")],estonian:[d("QVtocmVmKj0iaHR0cDovL3BheTRyZXN1bHRzMjQuZXUiXQ==")],fanboyAnnoyances:["#ac-lre-player",".navigate-to-top","#subscribe_popup",".newsletter_holder","#back-top"],fanboyAntiFacebook:[".util-bar-module-firefly-visible"],fanboyEnhancedTrackers:[".open.pushModal","#issuem-leaky-paywall-articles-zero-remaining-nag","#sovrn_container",'div[class$="-hide"][zoompage-fontsize][style="display: block;"]',".BlockNag__Card"],fanboySocial:["#FollowUs","#meteored_share","#social_follow",".article-sharer",".community__social-desc"],frellwitSwedish:[d("YVtocmVmKj0iY2FzaW5vcHJvLnNlIl1bdGFyZ2V0PSJfYmxhbmsiXQ=="),d("YVtocmVmKj0iZG9rdG9yLXNlLm9uZWxpbmsubWUiXQ=="),"article.category-samarbete",d("ZGl2LmhvbGlkQWRz"),"ul.adsmodern"],greekAdBlock:[d("QVtocmVmKj0iYWRtYW4ub3RlbmV0LmdyL2NsaWNrPyJd"),d("QVtocmVmKj0iaHR0cDovL2F4aWFiYW5uZXJzLmV4b2R1cy5nci8iXQ=="),d("QVtocmVmKj0iaHR0cDovL2ludGVyYWN0aXZlLmZvcnRobmV0LmdyL2NsaWNrPyJd"),"DIV.agores300","TABLE.advright"],hungarian:["#cemp_doboz",".optimonk-iframe-container",d("LmFkX19tYWlu"),d("W2NsYXNzKj0iR29vZ2xlQWRzIl0="),"#hirdetesek_box"],iDontCareAboutCookies:['.alert-info[data-block-track*="CookieNotice"]',".ModuleTemplateCookieIndicator",".o--cookies--container","#cookies-policy-sticky","#stickyCookieBar"],icelandicAbp:[d("QVtocmVmXj0iL2ZyYW1ld29yay9yZXNvdXJjZXMvZm9ybXMvYWRzLmFzcHgiXQ==")],latvian:[d("YVtocmVmPSJodHRwOi8vd3d3LnNhbGlkemluaS5sdi8iXVtzdHlsZT0iZGlzcGxheTogYmxvY2s7IHdpZHRoOiAxMjBweDsgaGVpZ2h0OiA0MHB4OyBvdmVyZmxvdzogaGlkZGVuOyBwb3NpdGlvbjogcmVsYXRpdmU7Il0="),d("YVtocmVmPSJodHRwOi8vd3d3LnNhbGlkemluaS5sdi8iXVtzdHlsZT0iZGlzcGxheTogYmxvY2s7IHdpZHRoOiA4OHB4OyBoZWlnaHQ6IDMxcHg7IG92ZXJmbG93OiBoaWRkZW47IHBvc2l0aW9uOiByZWxhdGl2ZTsiXQ==")],listKr:[d("YVtocmVmKj0iLy9hZC5wbGFuYnBsdXMuY28ua3IvIl0="),d("I2xpdmVyZUFkV3JhcHBlcg=="),d("YVtocmVmKj0iLy9hZHYuaW1hZHJlcC5jby5rci8iXQ=="),d("aW5zLmZhc3R2aWV3LWFk"),".revenue_unit_item.dable"],listeAr:[d("LmdlbWluaUxCMUFk"),".right-and-left-sponsers",d("YVtocmVmKj0iLmFmbGFtLmluZm8iXQ=="),d("YVtocmVmKj0iYm9vcmFxLm9yZyJd"),d("YVtocmVmKj0iZHViaXp6bGUuY29tL2FyLz91dG1fc291cmNlPSJd")],listeFr:[d("YVtocmVmXj0iaHR0cDovL3Byb21vLnZhZG9yLmNvbS8iXQ=="),d("I2FkY29udGFpbmVyX3JlY2hlcmNoZQ=="),d("YVtocmVmKj0id2Vib3JhbWEuZnIvZmNnaS1iaW4vIl0="),".site-pub-interstitiel",'div[id^="crt-"][data-criteo-id]'],officialPolish:["#ceneo-placeholder-ceneo-12",d("W2hyZWZePSJodHRwczovL2FmZi5zZW5kaHViLnBsLyJd"),d("YVtocmVmXj0iaHR0cDovL2Fkdm1hbmFnZXIudGVjaGZ1bi5wbC9yZWRpcmVjdC8iXQ=="),d("YVtocmVmXj0iaHR0cDovL3d3dy50cml6ZXIucGwvP3V0bV9zb3VyY2UiXQ=="),d("ZGl2I3NrYXBpZWNfYWQ=")],ro:[d("YVtocmVmXj0iLy9hZmZ0cmsuYWx0ZXgucm8vQ291bnRlci9DbGljayJd"),d("YVtocmVmXj0iaHR0cHM6Ly9ibGFja2ZyaWRheXNhbGVzLnJvL3Ryay9zaG9wLyJd"),d("YVtocmVmXj0iaHR0cHM6Ly9ldmVudC4ycGVyZm9ybWFudC5jb20vZXZlbnRzL2NsaWNrIl0="),d("YVtocmVmXj0iaHR0cHM6Ly9sLnByb2ZpdHNoYXJlLnJvLyJd"),'a[href^="/url/"]'],ruAd:[d("YVtocmVmKj0iLy9mZWJyYXJlLnJ1LyJd"),d("YVtocmVmKj0iLy91dGltZy5ydS8iXQ=="),d("YVtocmVmKj0iOi8vY2hpa2lkaWtpLnJ1Il0="),"#pgeldiz",".yandex-rtb-block"],thaiAds:["a[href*=macau-uta-popup]",d("I2Fkcy1nb29nbGUtbWlkZGxlX3JlY3RhbmdsZS1ncm91cA=="),d("LmFkczMwMHM="),".bumq",".img-kosana"],webAnnoyancesUltralist:["#mod-social-share-2","#social-tools",d("LmN0cGwtZnVsbGJhbm5lcg=="),".zergnet-recommend",".yt.btn-link.btn-md.btn"]}}function yP(d){var s=d===void 0?{}:d,u=s.debug;return Cc(this,void 0,void 0,function(){var g,A,E,O,r,U;return Ec(this,function(W){switch(W.label){case 0:return vP()?(g=_P(),A=Object.keys(g),E=(U=[]).concat.apply(U,A.map(function(Y){return g[Y]})),[4,xP(E)]):[2,void 0];case 1:return O=W.sent(),u&&wP(g,O),r=A.filter(function(Y){var se=g[Y],Ae=ka(se.map(function(Ce){return O[Ce]}));return Ae>se.length*.6}),r.sort(),[2,r]}})})}function vP(){return $l()||ay()}function xP(d){var s;return Cc(this,void 0,void 0,function(){var u,g,A,E,U,O,r,U;return Ec(this,function(W){switch(W.label){case 0:for(u=document,g=u.createElement("div"),A=new Array(d.length),E={},qb(g),U=0;U<d.length;++U)O=OO(d[U]),O.tagName==="DIALOG"&&O.show(),r=u.createElement("div"),qb(r),r.appendChild(O),g.appendChild(r),A[U]=O;W.label=1;case 1:return u.body?[3,3]:[4,jg(50)];case 2:return W.sent(),[3,1];case 3:u.body.appendChild(g);try{for(U=0;U<d.length;++U)A[U].offsetParent||(E[d[U]]=!0)}finally{(s=g.parentNode)===null||s===void 0||s.removeChild(g)}return[2,E]}})})}function qb(d){d.style.setProperty("visibility","hidden","important"),d.style.setProperty("display","block","important")}function wP(d,s){for(var u="DOM blockers debug:\n```",g=0,A=Object.keys(d);g<A.length;g++){var E=A[g];u+=`
`.concat(E,":");for(var O=0,r=d[E];O<r.length;O++){var U=r[O];u+=`
  `.concat(s[U]?"🚫":"➡️"," ").concat(U)}}console.log("".concat(u,"\n```"))}function bP(){for(var d=0,s=["rec2020","p3","srgb"];d<s.length;d++){var u=s[d];if(matchMedia("(color-gamut: ".concat(u,")")).matches)return u}}function CP(){if(Hb("inverted"))return!0;if(Hb("none"))return!1}function Hb(d){return matchMedia("(inverted-colors: ".concat(d,")")).matches}function EP(){if(Gb("active"))return!0;if(Gb("none"))return!1}function Gb(d){return matchMedia("(forced-colors: ".concat(d,")")).matches}var TP=100;function SP(){if(matchMedia("(min-monochrome: 0)").matches){for(var d=0;d<=TP;++d)if(matchMedia("(max-monochrome: ".concat(d,")")).matches)return d;throw new Error("Too high value")}}function AP(){if(Ld("no-preference"))return 0;if(Ld("high")||Ld("more"))return 1;if(Ld("low")||Ld("less"))return-1;if(Ld("forced"))return 10}function Ld(d){return matchMedia("(prefers-contrast: ".concat(d,")")).matches}function IP(){if(Wb("reduce"))return!0;if(Wb("no-preference"))return!1}function Wb(d){return matchMedia("(prefers-reduced-motion: ".concat(d,")")).matches}function MP(){if($b("reduce"))return!0;if($b("no-preference"))return!1}function $b(d){return matchMedia("(prefers-reduced-transparency: ".concat(d,")")).matches}function LP(){if(Zb("high"))return!0;if(Zb("standard"))return!1}function Zb(d){return matchMedia("(dynamic-range: ".concat(d,")")).matches}var Gr=Math,ua=function(){return 0};function OP(){var d=Gr.acos||ua,s=Gr.acosh||ua,u=Gr.asin||ua,g=Gr.asinh||ua,A=Gr.atanh||ua,E=Gr.atan||ua,O=Gr.sin||ua,r=Gr.sinh||ua,U=Gr.cos||ua,W=Gr.cosh||ua,Y=Gr.tan||ua,se=Gr.tanh||ua,Ae=Gr.exp||ua,Ce=Gr.expm1||ua,he=Gr.log1p||ua,K=function(Ue){return Gr.pow(Gr.PI,Ue)},N=function(Ue){return Gr.log(Ue+Gr.sqrt(Ue*Ue-1))},z=function(Ue){return Gr.log(Ue+Gr.sqrt(Ue*Ue+1))},q=function(Ue){return Gr.log((1+Ue)/(1-Ue))/2},G=function(Ue){return Gr.exp(Ue)-1/Gr.exp(Ue)/2},Q=function(Ue){return(Gr.exp(Ue)+1/Gr.exp(Ue))/2},ee=function(Ue){return Gr.exp(Ue)-1},fe=function(Ue){return(Gr.exp(2*Ue)-1)/(Gr.exp(2*Ue)+1)},ce=function(Ue){return Gr.log(1+Ue)};return{acos:d(.12312423423423424),acosh:s(1e308),acoshPf:N(1e154),asin:u(.12312423423423424),asinh:g(1),asinhPf:z(1),atanh:A(.5),atanhPf:q(.5),atan:E(.5),sin:O(-1e300),sinh:r(1),sinhPf:G(1),cos:U(10.000000000123),cosh:W(1),coshPf:Q(1),tan:Y(-1e300),tanh:se(1),tanhPf:fe(1),exp:Ae(1),expm1:Ce(1),expm1Pf:ee(1),log1p:he(10),log1pPf:ce(10),powPI:K(-100)}}var PP="mmMwWLliI0fiflO&1",__={default:[],apple:[{font:"-apple-system-body"}],serif:[{fontFamily:"serif"}],sans:[{fontFamily:"sans-serif"}],mono:[{fontFamily:"monospace"}],min:[{fontSize:"1px"}],system:[{fontFamily:"system-ui"}]};function DP(){return RP(function(d,s){for(var u={},g={},A=0,E=Object.keys(__);A<E.length;A++){var O=E[A],r=__[O],U=r[0],W=U===void 0?{}:U,Y=r[1],se=Y===void 0?PP:Y,Ae=d.createElement("span");Ae.textContent=se,Ae.style.whiteSpace="nowrap";for(var Ce=0,he=Object.keys(W);Ce<he.length;Ce++){var K=he[Ce],N=W[K];N!==void 0&&(Ae.style[K]=N)}u[O]=Ae,s.append(d.createElement("br"),Ae)}for(var z=0,q=Object.keys(__);z<q.length;z++){var O=q[z];g[O]=u[O].getBoundingClientRect().width}return g})}function RP(d,s){return s===void 0&&(s=4e3),BC(function(u,g){var A=g.document,E=A.body,O=E.style;O.width="".concat(s,"px"),O.webkitTextSizeAdjust=O.textSizeAdjust="none",r0()?E.style.zoom="".concat(1/g.devicePixelRatio):$l()&&(E.style.zoom="reset");var r=A.createElement("div");return r.textContent=LC([],Array(s/20<<0),!0).map(function(){return"word"}).join(" "),E.appendChild(r),d(A,E)},'<!doctype html><html><head><meta name="viewport" content="width=device-width, initial-scale=1">')}function kP(){return navigator.pdfViewerEnabled}function BP(){var d=new Float32Array(1),s=new Uint8Array(d.buffer);return d[0]=1/0,d[0]=d[0]-d[0],s[3]}function NP(){var d=window.ApplePaySession;if(typeof(d==null?void 0:d.canMakePayments)!="function")return-1;if(FP())return-3;try{return d.canMakePayments()?1:0}catch(s){return zP(s)}}var FP=DO;function zP(d){if(d instanceof Error&&d.name==="InvalidAccessError"&&/\bfrom\b.*\binsecure\b/i.test(d.message))return-2;throw d}function VP(){var d,s=document.createElement("a"),u=(d=s.attributionSourceId)!==null&&d!==void 0?d:s.attributionsourceid;return u===void 0?void 0:String(u)}var NC=-1,FC=-2,UP=new Set([10752,2849,2884,2885,2886,2928,2929,2930,2931,2932,2960,2961,2962,2963,2964,2965,2966,2967,2968,2978,3024,3042,3088,3089,3106,3107,32773,32777,32777,32823,32824,32936,32937,32938,32939,32968,32969,32970,32971,3317,33170,3333,3379,3386,33901,33902,34016,34024,34076,3408,3410,3411,3412,3413,3414,3415,34467,34816,34817,34818,34819,34877,34921,34930,35660,35661,35724,35738,35739,36003,36004,36005,36347,36348,36349,37440,37441,37443,7936,7937,7938]),jP=new Set([34047,35723,36063,34852,34853,34854,34229,36392,36795,38449]),qP=["FRAGMENT_SHADER","VERTEX_SHADER"],HP=["LOW_FLOAT","MEDIUM_FLOAT","HIGH_FLOAT","LOW_INT","MEDIUM_INT","HIGH_INT"],zC="WEBGL_debug_renderer_info",GP="WEBGL_polygon_mode";function WP(d){var s,u,g,A,E,O,r=d.cache,U=VC(r);if(!U)return NC;if(!jC(U))return FC;var W=UC()?null:U.getExtension(zC);return{version:((s=U.getParameter(U.VERSION))===null||s===void 0?void 0:s.toString())||"",vendor:((u=U.getParameter(U.VENDOR))===null||u===void 0?void 0:u.toString())||"",vendorUnmasked:W?(g=U.getParameter(W.UNMASKED_VENDOR_WEBGL))===null||g===void 0?void 0:g.toString():"",renderer:((A=U.getParameter(U.RENDERER))===null||A===void 0?void 0:A.toString())||"",rendererUnmasked:W?(E=U.getParameter(W.UNMASKED_RENDERER_WEBGL))===null||E===void 0?void 0:E.toString():"",shadingLanguageVersion:((O=U.getParameter(U.SHADING_LANGUAGE_VERSION))===null||O===void 0?void 0:O.toString())||""}}function $P(d){var s=d.cache,u=VC(s);if(!u)return NC;if(!jC(u))return FC;var g=u.getSupportedExtensions(),A=u.getContextAttributes(),E=[],O=[],r=[],U=[];if(A)for(var W=0,Y=Object.keys(A);W<Y.length;W++){var se=Y[W];E.push("".concat(se,"=").concat(A[se]))}for(var Ae=Xb(u),Ce=0,he=Ae;Ce<he.length;Ce++){var K=he[Ce],N=u[K];O.push("".concat(K,"=").concat(N).concat(UP.has(N)?"=".concat(u.getParameter(N)):""))}if(g)for(var z=0,q=g;z<q.length;z++){var G=q[z];if(!(G===zC&&UC()||G===GP&&YP())){var Q=u.getExtension(G);if(Q)for(var ee=0,fe=Xb(Q);ee<fe.length;ee++){var K=fe[ee],N=Q[K];r.push("".concat(K,"=").concat(N).concat(jP.has(N)?"=".concat(u.getParameter(N)):""))}}}for(var ce=0,Ue=qP;ce<Ue.length;ce++)for(var He=Ue[ce],nt=0,vt=HP;nt<vt.length;nt++){var xt=vt[nt],Ot=ZP(u,He,xt);U.push("".concat(He,".").concat(xt,"=").concat(Ot.join(",")))}return r.sort(),O.sort(),{contextAttributes:E,parameters:O,shaderPrecisions:U,extensions:g,extensionParameters:r}}function VC(d){if(d.webgl)return d.webgl.context;var s=document.createElement("canvas"),u;s.addEventListener("webglCreateContextError",function(){return u=void 0});for(var g=0,A=["webgl","experimental-webgl"];g<A.length;g++){var E=A[g];try{u=s.getContext(E)}catch{}if(u)break}return d.webgl={context:u},u}function ZP(d,s,u){var g=d.getShaderPrecisionFormat(d[s],d[u]);return g?[g.rangeMin,g.rangeMax,g.precision]:[]}function Xb(d){var s=Object.keys(d.__proto__);return s.filter(XP)}function XP(d){return typeof d=="string"&&!d.match(/[^A-Z0-9_x]/)}function UC(){return kC()}function YP(){return r0()||$l()}function jC(d){return typeof d.getParameter=="function"}function KP(){var d,s=ay()||$l();return s?window.AudioContext&&(d=new AudioContext().baseLatency)!==null&&d!==void 0?d:-1:-2}var QP={fonts:BO,domBlockers:yP,fontPreferences:DP,audio:TO,screenFrame:rP,canvas:FO,osCpu:ZO,languages:XO,colorDepth:YO,deviceMemory:KO,screenResolution:QO,hardwareConcurrency:oP,timezone:sP,sessionStorage:lP,localStorage:cP,indexedDB:uP,openDatabase:hP,cpuClass:dP,platform:fP,plugins:NO,touchSupport:$O,vendor:pP,vendorFlavors:mP,cookiesEnabled:gP,colorGamut:bP,invertedColors:CP,forcedColors:EP,monochrome:SP,contrast:AP,reducedMotion:IP,reducedTransparency:MP,hdr:LP,math:OP,pdfViewerEnabled:kP,architecture:BP,applePay:NP,privateClickMeasurement:VP,audioBaseLatency:KP,webGlBasics:WP,webGlExtensions:$P};function JP(d){return yO(QP,d,[])}var eD="$ if upgrade to Pro: https://fpjs.dev/pro";function tD(d){var s=iD(d),u=nD(s);return{score:s,comment:eD.replace(/\$/g,"".concat(u))}}function iD(d){if(ay())return .4;if($l())return sy()&&!(wp()&&xp())?.5:.3;var s="value"in d.platform?d.platform.value:"";return/^Win/.test(s)?.6:/^Mac/.test(s)?.5:.7}function nD(d){return DC(.99+.01*d,1e-4)}function rD(d){for(var s="",u=0,g=Object.keys(d).sort();u<g.length;u++){var A=g[u],E=d[A],O="error"in E?"error":JSON.stringify(E.value);s+="".concat(s?"|":"").concat(A.replace(/([:|\\])/g,"\\$1"),":").concat(O)}return s}function qC(d){return JSON.stringify(d,function(s,u){return u instanceof Error?pO(u):u},2)}function HC(d){return fO(rD(d))}function oD(d){var s,u=tD(d);return{get visitorId(){return s===void 0&&(s=HC(this.components)),s},set visitorId(g){s=g},confidence:u,components:d,version:OC}}function sD(d){return d===void 0&&(d=50),rO(d,d*2)}function aD(d,s){var u=Date.now();return{get:function(g){return Cc(this,void 0,void 0,function(){var A,E,O;return Ec(this,function(r){switch(r.label){case 0:return A=Date.now(),[4,d()];case 1:return E=r.sent(),O=oD(E),(s||g!=null&&g.debug)&&console.log("Copy the text below to get the debug data:\n\n```\nversion: ".concat(O.version,`
userAgent: `).concat(navigator.userAgent,`
timeBetweenLoadAndGet: `).concat(A-u,`
visitorId: `).concat(O.visitorId,`
components: `).concat(qC(E),"\n```")),[2,O]}})})}}}function lD(){if(!(window.__fpjs_d_m||Math.random()>=.001))try{var d=new XMLHttpRequest;d.open("get","https://m1.openfpcdn.io/fingerprintjs/v".concat(OC,"/npm-monitoring"),!0),d.send()}catch(s){console.error(s)}}function cD(d){var s;return d===void 0&&(d={}),Cc(this,void 0,void 0,function(){var u,g,A;return Ec(this,function(E){switch(E.label){case 0:return(!((s=d.monitoring)!==null&&s!==void 0)||s)&&lD(),u=d.delayFallback,g=d.debug,[4,sD(u)];case 1:return E.sent(),A=JP({cache:{},debug:g}),[2,aD(A,g)]}})})}var uD={load:cD,hashComponents:HC,componentsToDebugString:qC};function y_(d,s){d.split(/\s+/).forEach(u=>{s(u)})}class hD{constructor(){this._events=void 0,this._events={}}on(s,u){y_(s,g=>{const A=this._events[g]||[];A.push(u),this._events[g]=A})}off(s,u){var g=arguments.length;if(g===0){this._events={};return}y_(s,A=>{if(g===1){delete this._events[A];return}const E=this._events[A];E!==void 0&&(E.splice(E.indexOf(u),1),this._events[A]=E)})}trigger(s,...u){var g=this;y_(s,A=>{const E=g._events[A];E!==void 0&&E.forEach(O=>{O.apply(g,u)})})}}function dD(d){return d.plugins={},class extends d{constructor(...s){super(...s),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(s,u){d.plugins[s]={name:s,fn:u}}initializePlugins(s){var u,g;const A=this,E=[];if(Array.isArray(s))s.forEach(O=>{typeof O=="string"?E.push(O):(A.plugins.settings[O.name]=O.options,E.push(O.name))});else if(s)for(u in s)s.hasOwnProperty(u)&&(A.plugins.settings[u]=s[u],E.push(u));for(;g=E.shift();)A.require(g)}loadPlugin(s){var u=this,g=u.plugins,A=d.plugins[s];if(!d.plugins.hasOwnProperty(s))throw new Error('Unable to find "'+s+'" plugin');g.requested[s]=!0,g.loaded[s]=A.fn.apply(u,[u.plugins.settings[s]||{}]),g.names.push(s)}require(s){var u=this,g=u.plugins;if(!u.plugins.loaded.hasOwnProperty(s)){if(g.requested[s])throw new Error('Plugin has circular dependency ("'+s+'")');u.loadPlugin(s)}return g.loaded[s]}}}/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const o0=d=>(d=d.filter(Boolean),d.length<2?d[0]||"":pD(d)==1?"["+d.join("")+"]":"(?:"+d.join("|")+")"),GC=d=>{if(!fD(d))return d.join("");let s="",u=0;const g=()=>{u>1&&(s+="{"+u+"}")};return d.forEach((A,E)=>{if(A===d[E-1]){u++;return}g(),s+=A,u=1}),g(),s},WC=d=>{let s=ly(d);return o0(s)},fD=d=>new Set(d).size!==d.length,gp=d=>(d+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),pD=d=>d.reduce((s,u)=>Math.max(s,mD(u)),0),mD=d=>ly(d).length,ly=d=>Array.from(d);/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const $C=d=>{if(d.length===1)return[[d]];let s=[];const u=d.substring(1);return $C(u).forEach(function(A){let E=A.slice(0);E[0]=d.charAt(0)+E[0],s.push(E),E=A.slice(0),E.unshift(d.charAt(0)),s.push(E)}),s};/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const gD=[[0,65535]],_D="[̀-ͯ·ʾʼ]";let qg,ZC;const yD=3,cy={},Yb={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let d in Yb){let s=Yb[d]||"";for(let u=0;u<s.length;u++){let g=s.substring(u,u+1);cy[g]=d}}const vD=new RegExp(Object.keys(cy).join("|")+"|"+_D,"gu"),xD=d=>{qg===void 0&&(qg=ED(d||gD))},Kb=(d,s="NFKD")=>d.normalize(s),Hg=d=>ly(d).reduce((s,u)=>s+wD(u),""),wD=d=>(d=Kb(d).toLowerCase().replace(vD,s=>cy[s]||""),Kb(d,"NFC"));function*bD(d){for(const[s,u]of d)for(let g=s;g<=u;g++){let A=String.fromCharCode(g),E=Hg(A);E!=A.toLowerCase()&&(E.length>yD||E.length!=0&&(yield{folded:E,composed:A,code_point:g}))}}const CD=d=>{const s={},u=(g,A)=>{const E=s[g]||new Set,O=new RegExp("^"+WC(E)+"$","iu");A.match(O)||(E.add(gp(A)),s[g]=E)};for(let g of bD(d))u(g.folded,g.folded),u(g.folded,g.composed);return s},ED=d=>{const s=CD(d),u={};let g=[];for(let E in s){let O=s[E];O&&(u[E]=WC(O)),E.length>1&&g.push(gp(E))}g.sort((E,O)=>O.length-E.length);const A=o0(g);return ZC=new RegExp("^"+A,"u"),u},TD=(d,s=1)=>{let u=0;return d=d.map(g=>(qg[g]&&(u+=g.length),qg[g]||g)),u>=s?GC(d):""},SD=(d,s=1)=>(s=Math.max(s,d.length-1),o0($C(d).map(u=>TD(u,s)))),Qb=(d,s=!0)=>{let u=d.length>1?1:0;return o0(d.map(g=>{let A=[];const E=s?g.length():g.length()-1;for(let O=0;O<E;O++)A.push(SD(g.substrs[O]||"",u));return GC(A)}))},AD=(d,s)=>{for(const u of s){if(u.start!=d.start||u.end!=d.end||u.substrs.join("")!==d.substrs.join(""))continue;let g=d.parts;const A=O=>{for(const r of g){if(r.start===O.start&&r.substr===O.substr)return!1;if(!(O.length==1||r.length==1)&&(O.start<r.start&&O.end>r.start||r.start<O.start&&r.end>O.start))return!0}return!1};if(!(u.parts.filter(A).length>0))return!0}return!1};class Gg{constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(s){s&&(this.parts.push(s),this.substrs.push(s.substr),this.start=Math.min(s.start,this.start),this.end=Math.max(s.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(s,u){let g=new Gg,A=JSON.parse(JSON.stringify(this.parts)),E=A.pop();for(const U of A)g.add(U);let O=u.substr.substring(0,s-E.start),r=O.length;return g.add({start:E.start,end:E.start+r,length:r,substr:O}),g}}const ID=d=>{xD(),d=Hg(d);let s="",u=[new Gg];for(let g=0;g<d.length;g++){let E=d.substring(g).match(ZC);const O=d.substring(g,g+1),r=E?E[0]:null;let U=[],W=new Set;for(const Y of u){const se=Y.last();if(!se||se.length==1||se.end<=g)if(r){const Ae=r.length;Y.add({start:g,end:g+Ae,length:Ae,substr:r}),W.add("1")}else Y.add({start:g,end:g+1,length:1,substr:O}),W.add("2");else if(r){let Ae=Y.clone(g,se);const Ce=r.length;Ae.add({start:g,end:g+Ce,length:Ce,substr:r}),U.push(Ae)}else W.add("3")}if(U.length>0){U=U.sort((Y,se)=>Y.length()-se.length());for(let Y of U)AD(Y,u)||u.push(Y);continue}if(g>0&&W.size==1&&!W.has("3")){s+=Qb(u,!1);let Y=new Gg;const se=u[0];se&&Y.add(se.last()),u=[Y]}}return s+=Qb(u,!0),s};/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */const MD=(d,s)=>{if(d)return d[s]},LD=(d,s)=>{if(d){for(var u,g=s.split(".");(u=g.shift())&&(d=d[u]););return d}},v_=(d,s,u)=>{var g,A;return!d||(d=d+"",s.regex==null)||(A=d.search(s.regex),A===-1)?0:(g=s.string.length/d.length,A===0&&(g+=.5),g*u)},x_=(d,s)=>{var u=d[s];if(typeof u=="function")return u;u&&!Array.isArray(u)&&(d[s]=[u])},da=(d,s)=>{if(Array.isArray(d))d.forEach(s);else for(var u in d)d.hasOwnProperty(u)&&s(d[u],u)},OD=(d,s)=>typeof d=="number"&&typeof s=="number"?d>s?1:d<s?-1:0:(d=Hg(d+"").toLowerCase(),s=Hg(s+"").toLowerCase(),d>s?1:s>d?-1:0);/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */class PD{constructor(s,u){this.items=void 0,this.settings=void 0,this.items=s,this.settings=u||{diacritics:!0}}tokenize(s,u,g){if(!s||!s.length)return[];const A=[],E=s.split(/\s+/);var O;return g&&(O=new RegExp("^("+Object.keys(g).map(gp).join("|")+"):(.*)$")),E.forEach(r=>{let U,W=null,Y=null;O&&(U=r.match(O))&&(W=U[1],r=U[2]),r.length>0&&(this.settings.diacritics?Y=ID(r)||null:Y=gp(r),Y&&u&&(Y="\\b"+Y)),A.push({string:r,regex:Y?new RegExp(Y,"iu"):null,field:W})}),A}getScoreFunction(s,u){var g=this.prepareSearch(s,u);return this._getScoreFunction(g)}_getScoreFunction(s){const u=s.tokens,g=u.length;if(!g)return function(){return 0};const A=s.options.fields,E=s.weights,O=A.length,r=s.getAttrFn;if(!O)return function(){return 1};const U=function(){return O===1?function(W,Y){const se=A[0].field;return v_(r(Y,se),W,E[se]||1)}:function(W,Y){var se=0;if(W.field){const Ae=r(Y,W.field);!W.regex&&Ae?se+=1/O:se+=v_(Ae,W,1)}else da(E,(Ae,Ce)=>{se+=v_(r(Y,Ce),W,Ae)});return se/O}}();return g===1?function(W){return U(u[0],W)}:s.options.conjunction==="and"?function(W){var Y,se=0;for(let Ae of u){if(Y=U(Ae,W),Y<=0)return 0;se+=Y}return se/g}:function(W){var Y=0;return da(u,se=>{Y+=U(se,W)}),Y/g}}getSortFunction(s,u){var g=this.prepareSearch(s,u);return this._getSortFunction(g)}_getSortFunction(s){var u,g=[];const A=this,E=s.options,O=!s.query&&E.sort_empty?E.sort_empty:E.sort;if(typeof O=="function")return O.bind(this);const r=function(Y,se){return Y==="$score"?se.score:s.getAttrFn(A.items[se.id],Y)};if(O)for(let W of O)(s.query||W.field!=="$score")&&g.push(W);if(s.query){u=!0;for(let W of g)if(W.field==="$score"){u=!1;break}u&&g.unshift({field:"$score",direction:"desc"})}else g=g.filter(W=>W.field!=="$score");return g.length?function(W,Y){var se,Ae;for(let Ce of g)if(Ae=Ce.field,se=(Ce.direction==="desc"?-1:1)*OD(r(Ae,W),r(Ae,Y)),se)return se;return 0}:null}prepareSearch(s,u){const g={};var A=Object.assign({},u);if(x_(A,"sort"),x_(A,"sort_empty"),A.fields){x_(A,"fields");const E=[];A.fields.forEach(O=>{typeof O=="string"&&(O={field:O,weight:1}),E.push(O),g[O.field]="weight"in O?O.weight:1}),A.fields=E}return{options:A,query:s.toLowerCase().trim(),tokens:this.tokenize(s,A.respect_word_boundaries,g),total:0,items:[],weights:g,getAttrFn:A.nesting?LD:MD}}search(s,u){var g=this,A,E;E=this.prepareSearch(s,u),u=E.options,s=E.query;const O=u.score||g._getScoreFunction(E);s.length?da(g.items,(U,W)=>{A=O(U),(u.filter===!1||A>0)&&E.items.push({score:A,id:W})}):da(g.items,(U,W)=>{E.items.push({score:1,id:W})});const r=g._getSortFunction(E);return r&&E.items.sort(r),E.total=E.items.length,typeof u.limit=="number"&&(E.items=E.items.slice(0,u.limit)),E}}const Pd=(d,s)=>{if(Array.isArray(d))d.forEach(s);else for(var u in d)d.hasOwnProperty(u)&&s(d[u],u)},Ps=d=>{if(d.jquery)return d[0];if(d instanceof HTMLElement)return d;if(XC(d)){var s=document.createElement("template");return s.innerHTML=d.trim(),s.content.firstChild}return document.querySelector(d)},XC=d=>typeof d=="string"&&d.indexOf("<")>-1,DD=d=>d.replace(/['"\\]/g,"\\$&"),w_=(d,s)=>{var u=document.createEvent("HTMLEvents");u.initEvent(s,!0,!1),d.dispatchEvent(u)},wg=(d,s)=>{Object.assign(d.style,s)},ha=(d,...s)=>{var u=YC(s);d=KC(d),d.map(g=>{u.map(A=>{g.classList.add(A)})})},Yc=(d,...s)=>{var u=YC(s);d=KC(d),d.map(g=>{u.map(A=>{g.classList.remove(A)})})},YC=d=>{var s=[];return Pd(d,u=>{typeof u=="string"&&(u=u.trim().split(/[\11\12\14\15\40]/)),Array.isArray(u)&&(s=s.concat(u))}),s.filter(Boolean)},KC=d=>(Array.isArray(d)||(d=[d]),d),Lg=(d,s,u)=>{if(!(u&&!u.contains(d)))for(;d&&d.matches;){if(d.matches(s))return d;d=d.parentNode}},Jb=(d,s=0)=>s>0?d[d.length-1]:d[0],RD=d=>Object.keys(d).length===0,Wg=(d,s)=>{if(!d)return-1;s=s||d.nodeName;for(var u=0;d=d.previousElementSibling;)d.matches(s)&&u++;return u},wo=(d,s)=>{Pd(s,(u,g)=>{u==null?d.removeAttribute(g):d.setAttribute(g,""+u)})},V_=(d,s)=>{d.parentNode&&d.parentNode.replaceChild(s,d)},kD=(d,s)=>{if(s===null)return;if(typeof s=="string"){if(!s.length)return;s=new RegExp(s,"i")}const u=E=>{var O=E.data.match(s);if(O&&E.data.length>0){var r=document.createElement("span");r.className="highlight";var U=E.splitText(O.index);U.splitText(O[0].length);var W=U.cloneNode(!0);return r.appendChild(W),V_(U,r),1}return 0},g=E=>{E.nodeType===1&&E.childNodes&&!/(script|style)/i.test(E.tagName)&&(E.className!=="highlight"||E.tagName!=="SPAN")&&Array.from(E.childNodes).forEach(O=>{A(O)})},A=E=>E.nodeType===3?u(E):(g(E),0);A(d)},BD=d=>{var s=d.querySelectorAll("span.highlight");Array.prototype.forEach.call(s,function(u){var g=u.parentNode;g.replaceChild(u.firstChild,u),g.normalize()})},ND=65,FD=13,QC=27,U_=37,zD=38,JC=39,VD=40,e2=8,UD=46,j_=9,jD=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),bg=jD?"metaKey":"ctrlKey";var t2={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,refreshThrottle:300,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(d){return d.length>0},render:{}};const gl=d=>typeof d>"u"||d===null?null:Og(d),Og=d=>typeof d=="boolean"?d?"1":"0":d+"",Pg=d=>(d+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),qD=(d,s)=>s>0?setTimeout(d,s):(d.call(null),null),HD=(d,s)=>{var u;return function(g,A){var E=this;u&&(E.loading=Math.max(E.loading-1,0),clearTimeout(u)),u=setTimeout(function(){u=null,E.loadedSearches[g]=!0,d.call(E,g,A)},s)}},i2=(d,s,u)=>{var g,A=d.trigger,E={};d.trigger=function(){var O=arguments[0];if(s.indexOf(O)!==-1)E[O]=arguments;else return A.apply(d,arguments)},u.apply(d,[]),d.trigger=A;for(g of s)g in E&&A.apply(d,E[g])},GD=d=>({start:d.selectionStart||0,length:(d.selectionEnd||0)-(d.selectionStart||0)}),Qr=(d,s=!1)=>{d&&(d.preventDefault(),s&&d.stopPropagation())},Jr=(d,s,u,g)=>{d.addEventListener(s,u,g)},Mh=(d,s)=>{if(!s||!s[d])return!1;var u=(s.altKey?1:0)+(s.ctrlKey?1:0)+(s.shiftKey?1:0)+(s.metaKey?1:0);return u===1},b_=(d,s)=>{const u=d.getAttribute("id");return u||(d.setAttribute("id",s),s)},n2=d=>d.replace(/[\\"']/g,"\\$&"),Lh=(d,s)=>{s&&d.append(s)};function r2(d,s){var u=Object.assign({},t2,s),g=u.dataAttr,A=u.labelField,E=u.valueField,O=u.disabledField,r=u.optgroupField,U=u.optgroupLabelField,W=u.optgroupValueField,Y=d.tagName.toLowerCase(),se=d.getAttribute("placeholder")||d.getAttribute("data-placeholder");if(!se&&!u.allowEmptyOption){let K=d.querySelector('option[value=""]');K&&(se=K.textContent)}var Ae={placeholder:se,options:[],optgroups:[],items:[],maxItems:null},Ce=()=>{var K,N=Ae.options,z={},q=1;let G=0;var Q=ce=>{var Ue=Object.assign({},ce.dataset),He=g&&Ue[g];return typeof He=="string"&&He.length&&(Ue=Object.assign(Ue,JSON.parse(He))),Ue},ee=(ce,Ue)=>{var He=gl(ce.value);if(He!=null&&!(!He&&!u.allowEmptyOption)){if(z.hasOwnProperty(He)){if(Ue){var nt=z[He][r];nt?Array.isArray(nt)?nt.push(Ue):z[He][r]=[nt,Ue]:z[He][r]=Ue}}else{var vt=Q(ce);vt[A]=vt[A]||ce.textContent,vt[E]=vt[E]||He,vt[O]=vt[O]||ce.disabled,vt[r]=vt[r]||Ue,vt.$option=ce,vt.$order=vt.$order||++G,z[He]=vt,N.push(vt)}ce.selected&&Ae.items.push(He)}},fe=ce=>{var Ue,He;He=Q(ce),He[U]=He[U]||ce.getAttribute("label")||"",He[W]=He[W]||q++,He[O]=He[O]||ce.disabled,He.$order=He.$order||++G,Ae.optgroups.push(He),Ue=He[W],Pd(ce.children,nt=>{ee(nt,Ue)})};Ae.maxItems=d.hasAttribute("multiple")?null:1,Pd(d.children,ce=>{K=ce.tagName.toLowerCase(),K==="optgroup"?fe(ce):K==="option"&&ee(ce)})},he=()=>{const K=d.getAttribute(g);if(K)Ae.options=JSON.parse(K),Pd(Ae.options,z=>{Ae.items.push(z[E])});else{var N=d.value.trim()||"";if(!u.allowEmptyOption&&!N.length)return;const z=N.split(u.delimiter);Pd(z,q=>{const G={};G[A]=q,G[E]=q,Ae.options.push(G)}),Ae.items=z}};return Y==="select"?Ce():he(),Object.assign({},t2,Ae,s)}var o2=0;class fa extends dD(hD){constructor(s,u){super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.focus_node=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.isOpen=!1,this.isDisabled=!1,this.isReadOnly=!1,this.isRequired=void 0,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.currentResults=void 0,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.refreshTimeout=null,o2++;var g,A=Ps(s);if(A.tomselect)throw new Error("Tom Select already initialized on this element");A.tomselect=this;var E=window.getComputedStyle&&window.getComputedStyle(A,null);g=E.getPropertyValue("direction");const O=r2(A,u);this.settings=O,this.input=A,this.tabIndex=A.tabIndex||0,this.is_select_tag=A.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(g),this.inputId=b_(A,"tomselect-"+o2),this.isRequired=A.required,this.sifter=new PD(this.options,{diacritics:O.diacritics}),O.mode=O.mode||(O.maxItems===1?"single":"multi"),typeof O.hideSelected!="boolean"&&(O.hideSelected=O.mode==="multi"),typeof O.hidePlaceholder!="boolean"&&(O.hidePlaceholder=O.mode!=="multi");var r=O.createFilter;typeof r!="function"&&(typeof r=="string"&&(r=new RegExp(r)),r instanceof RegExp?O.createFilter=N=>r.test(N):O.createFilter=N=>this.settings.duplicates||!this.options[N]),this.initializePlugins(O.plugins),this.setupCallbacks(),this.setupTemplates();const U=Ps("<div>"),W=Ps("<div>"),Y=this._render("dropdown"),se=Ps('<div role="listbox" tabindex="-1">'),Ae=this.input.getAttribute("class")||"",Ce=O.mode;var he;if(ha(U,O.wrapperClass,Ae,Ce),ha(W,O.controlClass),Lh(U,W),ha(Y,O.dropdownClass,Ce),O.copyClassesToDropdown&&ha(Y,Ae),ha(se,O.dropdownContentClass),Lh(Y,se),Ps(O.dropdownParent||U).appendChild(Y),XC(O.controlInput)){he=Ps(O.controlInput);var K=["autocorrect","autocapitalize","autocomplete","spellcheck"];da(K,N=>{A.getAttribute(N)&&wo(he,{[N]:A.getAttribute(N)})}),he.tabIndex=-1,W.appendChild(he),this.focus_node=he}else O.controlInput?(he=Ps(O.controlInput),this.focus_node=he):(he=Ps("<input/>"),this.focus_node=W);this.wrapper=U,this.dropdown=Y,this.dropdown_content=se,this.control=W,this.control_input=he,this.setup()}setup(){const s=this,u=s.settings,g=s.control_input,A=s.dropdown,E=s.dropdown_content,O=s.wrapper,r=s.control,U=s.input,W=s.focus_node,Y={passive:!0},se=s.inputId+"-ts-dropdown";wo(E,{id:se}),wo(W,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":se});const Ae=b_(W,s.inputId+"-ts-control"),Ce="label[for='"+DD(s.inputId)+"']",he=document.querySelector(Ce),K=s.focus.bind(s);if(he){Jr(he,"click",K),wo(he,{for:Ae});const q=b_(he,s.inputId+"-ts-label");wo(W,{"aria-labelledby":q}),wo(E,{"aria-labelledby":q})}if(O.style.width=U.style.width,s.plugins.names.length){const q="plugin-"+s.plugins.names.join(" plugin-");ha([O,A],q)}(u.maxItems===null||u.maxItems>1)&&s.is_select_tag&&wo(U,{multiple:"multiple"}),u.placeholder&&wo(g,{placeholder:u.placeholder}),!u.splitOn&&u.delimiter&&(u.splitOn=new RegExp("\\s*"+gp(u.delimiter)+"+\\s*")),u.load&&u.loadThrottle&&(u.load=HD(u.load,u.loadThrottle)),Jr(A,"mousemove",()=>{s.ignoreHover=!1}),Jr(A,"mouseenter",q=>{var G=Lg(q.target,"[data-selectable]",A);G&&s.onOptionHover(q,G)},{capture:!0}),Jr(A,"click",q=>{const G=Lg(q.target,"[data-selectable]");G&&(s.onOptionSelect(q,G),Qr(q,!0))}),Jr(r,"click",q=>{var G=Lg(q.target,"[data-ts-item]",r);if(G&&s.onItemSelect(q,G)){Qr(q,!0);return}g.value==""&&(s.onClick(),Qr(q,!0))}),Jr(W,"keydown",q=>s.onKeyDown(q)),Jr(g,"keypress",q=>s.onKeyPress(q)),Jr(g,"input",q=>s.onInput(q)),Jr(W,"blur",q=>s.onBlur(q)),Jr(W,"focus",q=>s.onFocus(q)),Jr(g,"paste",q=>s.onPaste(q));const N=q=>{const G=q.composedPath()[0];if(!O.contains(G)&&!A.contains(G)){s.isFocused&&s.blur(),s.inputState();return}G==g&&s.isOpen?q.stopPropagation():Qr(q,!0)},z=()=>{s.isOpen&&s.positionDropdown()};Jr(document,"mousedown",N),Jr(window,"scroll",z,Y),Jr(window,"resize",z,Y),this._destroy=()=>{document.removeEventListener("mousedown",N),window.removeEventListener("scroll",z),window.removeEventListener("resize",z),he&&he.removeEventListener("click",K)},this.revertSettings={innerHTML:U.innerHTML,tabIndex:U.tabIndex},U.tabIndex=-1,U.insertAdjacentElement("afterend",s.wrapper),s.sync(!1),u.items=[],delete u.optgroups,delete u.options,Jr(U,"invalid",()=>{s.isValid&&(s.isValid=!1,s.isInvalid=!0,s.refreshState())}),s.updateOriginalInput(),s.refreshItems(),s.close(!1),s.inputState(),s.isSetup=!0,U.disabled?s.disable():U.readOnly?s.setReadOnly(!0):s.enable(),s.on("change",this.onChange),ha(U,"tomselected","ts-hidden-accessible"),s.trigger("initialize"),u.preload===!0&&s.preload()}setupOptions(s=[],u=[]){this.addOptions(s),da(u,g=>{this.registerOptionGroup(g)})}setupTemplates(){var s=this,u=s.settings.labelField,g=s.settings.optgroupLabelField,A={optgroup:E=>{let O=document.createElement("div");return O.className="optgroup",O.appendChild(E.options),O},optgroup_header:(E,O)=>'<div class="optgroup-header">'+O(E[g])+"</div>",option:(E,O)=>"<div>"+O(E[u])+"</div>",item:(E,O)=>"<div>"+O(E[u])+"</div>",option_create:(E,O)=>'<div class="create">Add <strong>'+O(E.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};s.settings.render=Object.assign({},A,s.settings.render)}setupCallbacks(){var s,u,g={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(s in g)u=this.settings[g[s]],u&&this.on(s,u)}sync(s=!0){const u=this,g=s?r2(u.input,{delimiter:u.settings.delimiter}):u.settings;u.setupOptions(g.options,g.optgroups),u.setValue(g.items||[],!0),u.lastQuery=null}onClick(){var s=this;if(s.activeItems.length>0){s.clearActiveItems(),s.focus();return}s.isFocused&&s.isOpen?s.blur():s.focus()}onMouseDown(){}onChange(){w_(this.input,"input"),w_(this.input,"change")}onPaste(s){var u=this;if(u.isInputHidden||u.isLocked){Qr(s);return}u.settings.splitOn&&setTimeout(()=>{var g=u.inputValue();if(g.match(u.settings.splitOn)){var A=g.trim().split(u.settings.splitOn);da(A,E=>{gl(E)&&(this.options[E]?u.addItem(E):u.createItem(E))})}},0)}onKeyPress(s){var u=this;if(u.isLocked){Qr(s);return}var g=String.fromCharCode(s.keyCode||s.which);if(u.settings.create&&u.settings.mode==="multi"&&g===u.settings.delimiter){u.createItem(),Qr(s);return}}onKeyDown(s){var u=this;if(u.ignoreHover=!0,u.isLocked){s.keyCode!==j_&&Qr(s);return}switch(s.keyCode){case ND:if(Mh(bg,s)&&u.control_input.value==""){Qr(s),u.selectAll();return}break;case QC:u.isOpen&&(Qr(s,!0),u.close()),u.clearActiveItems();return;case VD:if(!u.isOpen&&u.hasOptions)u.open();else if(u.activeOption){let g=u.getAdjacent(u.activeOption,1);g&&u.setActiveOption(g)}Qr(s);return;case zD:if(u.activeOption){let g=u.getAdjacent(u.activeOption,-1);g&&u.setActiveOption(g)}Qr(s);return;case FD:u.canSelect(u.activeOption)?(u.onOptionSelect(s,u.activeOption),Qr(s)):(u.settings.create&&u.createItem()||document.activeElement==u.control_input&&u.isOpen)&&Qr(s);return;case U_:u.advanceSelection(-1,s);return;case JC:u.advanceSelection(1,s);return;case j_:u.settings.selectOnTab&&(u.canSelect(u.activeOption)&&(u.onOptionSelect(s,u.activeOption),Qr(s)),u.settings.create&&u.createItem()&&Qr(s));return;case e2:case UD:u.deleteSelection(s);return}u.isInputHidden&&!Mh(bg,s)&&Qr(s)}onInput(s){if(this.isLocked)return;const u=this.inputValue();if(this.lastValue!==u){if(this.lastValue=u,u==""){this._onInput();return}this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=qD(()=>{this.refreshTimeout=null,this._onInput()},this.settings.refreshThrottle)}}_onInput(){const s=this.lastValue;this.settings.shouldLoad.call(this,s)&&this.load(s),this.refreshOptions(),this.trigger("type",s)}onOptionHover(s,u){this.ignoreHover||this.setActiveOption(u,!1)}onFocus(s){var u=this,g=u.isFocused;if(u.isDisabled||u.isReadOnly){u.blur(),Qr(s);return}u.ignoreFocus||(u.isFocused=!0,u.settings.preload==="focus"&&u.preload(),g||u.trigger("focus"),u.activeItems.length||(u.inputState(),u.refreshOptions(!!u.settings.openOnFocus)),u.refreshState())}onBlur(s){if(document.hasFocus()!==!1){var u=this;if(u.isFocused){u.isFocused=!1,u.ignoreFocus=!1;var g=()=>{u.close(),u.setActiveItem(),u.setCaret(u.items.length),u.trigger("blur")};u.settings.create&&u.settings.createOnBlur?u.createItem(null,g):g()}}}onOptionSelect(s,u){var g,A=this;u.parentElement&&u.parentElement.matches("[data-disabled]")||(u.classList.contains("create")?A.createItem(null,()=>{A.settings.closeAfterSelect&&A.close()}):(g=u.dataset.value,typeof g<"u"&&(A.lastQuery=null,A.addItem(g),A.settings.closeAfterSelect&&A.close(),!A.settings.hideSelected&&s.type&&/click/.test(s.type)&&A.setActiveOption(u))))}canSelect(s){return!!(this.isOpen&&s&&this.dropdown_content.contains(s))}onItemSelect(s,u){var g=this;return!g.isLocked&&g.settings.mode==="multi"?(Qr(s),g.setActiveItem(u,s),!0):!1}canLoad(s){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(s))}load(s){const u=this;if(!u.canLoad(s))return;ha(u.wrapper,u.settings.loadingClass),u.loading++;const g=u.loadCallback.bind(u);u.settings.load.call(u,s,g)}loadCallback(s,u){const g=this;g.loading=Math.max(g.loading-1,0),g.lastQuery=null,g.clearActiveOption(),g.setupOptions(s,u),g.refreshOptions(g.isFocused&&!g.isInputHidden),g.loading||Yc(g.wrapper,g.settings.loadingClass),g.trigger("load",s,u)}preload(){var s=this.wrapper.classList;s.contains("preloaded")||(s.add("preloaded"),this.load(""))}setTextboxValue(s=""){var u=this.control_input,g=u.value!==s;g&&(u.value=s,w_(u,"update"),this.lastValue=s)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(s,u){var g=u?[]:["change"];i2(this,g,()=>{this.clear(u),this.addItems(s,u)})}setMaxItems(s){s===0&&(s=null),this.settings.maxItems=s,this.refreshState()}setActiveItem(s,u){var g=this,A,E,O,r,U,W;if(g.settings.mode!=="single"){if(!s){g.clearActiveItems(),g.isFocused&&g.inputState();return}if(A=u&&u.type.toLowerCase(),A==="click"&&Mh("shiftKey",u)&&g.activeItems.length){for(W=g.getLastActive(),O=Array.prototype.indexOf.call(g.control.children,W),r=Array.prototype.indexOf.call(g.control.children,s),O>r&&(U=O,O=r,r=U),E=O;E<=r;E++)s=g.control.children[E],g.activeItems.indexOf(s)===-1&&g.setActiveItemClass(s);Qr(u)}else A==="click"&&Mh(bg,u)||A==="keydown"&&Mh("shiftKey",u)?s.classList.contains("active")?g.removeActiveItem(s):g.setActiveItemClass(s):(g.clearActiveItems(),g.setActiveItemClass(s));g.inputState(),g.isFocused||g.focus()}}setActiveItemClass(s){const u=this,g=u.control.querySelector(".last-active");g&&Yc(g,"last-active"),ha(s,"active last-active"),u.trigger("item_select",s),u.activeItems.indexOf(s)==-1&&u.activeItems.push(s)}removeActiveItem(s){var u=this.activeItems.indexOf(s);this.activeItems.splice(u,1),Yc(s,"active")}clearActiveItems(){Yc(this.activeItems,"active"),this.activeItems=[]}setActiveOption(s,u=!0){s!==this.activeOption&&(this.clearActiveOption(),s&&(this.activeOption=s,wo(this.focus_node,{"aria-activedescendant":s.getAttribute("id")}),wo(s,{"aria-selected":"true"}),ha(s,"active"),u&&this.scrollToOption(s)))}scrollToOption(s,u){if(!s)return;const g=this.dropdown_content,A=g.clientHeight,E=g.scrollTop||0,O=s.offsetHeight,r=s.getBoundingClientRect().top-g.getBoundingClientRect().top+E;r+O>A+E?this.scroll(r-A+O,u):r<E&&this.scroll(r,u)}scroll(s,u){const g=this.dropdown_content;u&&(g.style.scrollBehavior=u),g.scrollTop=s,g.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(Yc(this.activeOption,"active"),wo(this.activeOption,{"aria-selected":null})),this.activeOption=null,wo(this.focus_node,{"aria-activedescendant":null})}selectAll(){const s=this;if(s.settings.mode==="single")return;const u=s.controlChildren();u.length&&(s.inputState(),s.close(),s.activeItems=u,da(u,g=>{s.setActiveItemClass(g)}))}inputState(){var s=this;s.control.contains(s.control_input)&&(wo(s.control_input,{placeholder:s.settings.placeholder}),s.activeItems.length>0||!s.isFocused&&s.settings.hidePlaceholder&&s.items.length>0?(s.setTextboxValue(),s.isInputHidden=!0):(s.settings.hidePlaceholder&&s.items.length>0&&wo(s.control_input,{placeholder:""}),s.isInputHidden=!1),s.wrapper.classList.toggle("input-hidden",s.isInputHidden))}inputValue(){return this.control_input.value.trim()}focus(){var s=this;s.isDisabled||s.isReadOnly||(s.ignoreFocus=!0,s.control_input.offsetWidth?s.control_input.focus():s.focus_node.focus(),setTimeout(()=>{s.ignoreFocus=!1,s.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(s){return this.sifter.getScoreFunction(s,this.getSearchOptions())}getSearchOptions(){var s=this.settings,u=s.sortField;return typeof s.sortField=="string"&&(u=[{field:s.sortField}]),{fields:s.searchField,conjunction:s.searchConjunction,sort:u,nesting:s.nesting}}search(s){var u,g,A=this,E=this.getSearchOptions();if(A.settings.score&&(g=A.settings.score.call(A,s),typeof g!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return s!==A.lastQuery?(A.lastQuery=s,u=A.sifter.search(s,Object.assign(E,{score:g})),A.currentResults=u):u=Object.assign({},A.currentResults),A.settings.hideSelected&&(u.items=u.items.filter(O=>{let r=gl(O.id);return!(r&&A.items.indexOf(r)!==-1)})),u}refreshOptions(s=!0){var u,g,A,E,O,r,U,W,Y,se;const Ae={},Ce=[];var he=this,K=he.inputValue();const N=K===he.lastQuery||K==""&&he.lastQuery==null;var z=he.search(K),q=null,G=he.settings.shouldOpen||!1,Q=he.dropdown_content;N&&(q=he.activeOption,q&&(Y=q.closest("[data-group]"))),E=z.items.length,typeof he.settings.maxOptions=="number"&&(E=Math.min(E,he.settings.maxOptions)),E>0&&(G=!0);const ee=(ce,Ue)=>{let He=Ae[ce];if(He!==void 0){let vt=Ce[He];if(vt!==void 0)return[He,vt.fragment]}let nt=document.createDocumentFragment();return He=Ce.length,Ce.push({fragment:nt,order:Ue,optgroup:ce}),[He,nt]};for(u=0;u<E;u++){let ce=z.items[u];if(!ce)continue;let Ue=ce.id,He=he.options[Ue];if(He===void 0)continue;let nt=Og(Ue),vt=he.getOption(nt,!0);for(he.settings.hideSelected||vt.classList.toggle("selected",he.items.includes(nt)),O=He[he.settings.optgroupField]||"",r=Array.isArray(O)?O:[O],g=0,A=r&&r.length;g<A;g++){O=r[g];let xt=He.$order,Ot=he.optgroups[O];Ot===void 0?O="":xt=Ot.$order;const[Ui,Mt]=ee(O,xt);g>0&&(vt=vt.cloneNode(!0),wo(vt,{id:He.$id+"-clone-"+g,"aria-selected":null}),vt.classList.add("ts-cloned"),Yc(vt,"active"),he.activeOption&&he.activeOption.dataset.value==Ue&&Y&&Y.dataset.group===O.toString()&&(q=vt)),Mt.appendChild(vt),O!=""&&(Ae[O]=Ui)}}he.settings.lockOptgroupOrder&&Ce.sort((ce,Ue)=>ce.order-Ue.order),U=document.createDocumentFragment(),da(Ce,ce=>{let Ue=ce.fragment,He=ce.optgroup;if(!Ue||!Ue.children.length)return;let nt=he.optgroups[He];if(nt!==void 0){let vt=document.createDocumentFragment(),xt=he.render("optgroup_header",nt);Lh(vt,xt),Lh(vt,Ue);let Ot=he.render("optgroup",{group:nt,options:vt});Lh(U,Ot)}else Lh(U,Ue)}),Q.innerHTML="",Lh(Q,U),he.settings.highlight&&(BD(Q),z.query.length&&z.tokens.length&&da(z.tokens,ce=>{kD(Q,ce.regex)}));var fe=ce=>{let Ue=he.render(ce,{input:K});return Ue&&(G=!0,Q.insertBefore(Ue,Q.firstChild)),Ue};if(he.loading?fe("loading"):he.settings.shouldLoad.call(he,K)?z.items.length===0&&fe("no_results"):fe("not_loading"),W=he.canCreate(K),W&&(se=fe("option_create")),he.hasOptions=z.items.length>0||W,G){if(z.items.length>0){if(!q&&he.settings.mode==="single"&&he.items[0]!=null&&(q=he.getOption(he.items[0])),!Q.contains(q)){let ce=0;se&&!he.settings.addPrecedence&&(ce=1),q=he.selectable()[ce]}}else se&&(q=se);s&&!he.isOpen&&(he.open(),he.scrollToOption(q,"auto")),he.setActiveOption(q)}else he.clearActiveOption(),s&&he.isOpen&&he.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(s,u=!1){const g=this;if(Array.isArray(s))return g.addOptions(s,u),!1;const A=gl(s[g.settings.valueField]);return A===null||g.options.hasOwnProperty(A)?!1:(s.$order=s.$order||++g.order,s.$id=g.inputId+"-opt-"+s.$order,g.options[A]=s,g.lastQuery=null,u&&(g.userOptions[A]=u,g.trigger("option_add",A,s)),A)}addOptions(s,u=!1){da(s,g=>{this.addOption(g,u)})}registerOption(s){return this.addOption(s)}registerOptionGroup(s){var u=gl(s[this.settings.optgroupValueField]);return u===null?!1:(s.$order=s.$order||++this.order,this.optgroups[u]=s,u)}addOptionGroup(s,u){var g;u[this.settings.optgroupValueField]=s,(g=this.registerOptionGroup(u))&&this.trigger("optgroup_add",g,u)}removeOptionGroup(s){this.optgroups.hasOwnProperty(s)&&(delete this.optgroups[s],this.clearCache(),this.trigger("optgroup_remove",s))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(s,u){const g=this;var A,E;const O=gl(s),r=gl(u[g.settings.valueField]);if(O===null)return;const U=g.options[O];if(U==null)return;if(typeof r!="string")throw new Error("Value must be set in option data");const W=g.getOption(O),Y=g.getItem(O);if(u.$order=u.$order||U.$order,delete g.options[O],g.uncacheValue(r),g.options[r]=u,W){if(g.dropdown_content.contains(W)){const se=g._render("option",u);V_(W,se),g.activeOption===W&&g.setActiveOption(se)}W.remove()}Y&&(E=g.items.indexOf(O),E!==-1&&g.items.splice(E,1,r),A=g._render("item",u),Y.classList.contains("active")&&ha(A,"active"),V_(Y,A)),g.lastQuery=null}removeOption(s,u){const g=this;s=Og(s),g.uncacheValue(s),delete g.userOptions[s],delete g.options[s],g.lastQuery=null,g.trigger("option_remove",s),g.removeItem(s,u)}clearOptions(s){const u=(s||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const g={};da(this.options,(A,E)=>{u(A,E)&&(g[E]=A)}),this.options=this.sifter.items=g,this.lastQuery=null,this.trigger("option_clear")}clearFilter(s,u){return this.items.indexOf(u)>=0}getOption(s,u=!1){const g=gl(s);if(g===null)return null;const A=this.options[g];if(A!=null){if(A.$div)return A.$div;if(u)return this._render("option",A)}return null}getAdjacent(s,u,g="option"){var A=this,E;if(!s)return null;g=="item"?E=A.controlChildren():E=A.dropdown_content.querySelectorAll("[data-selectable]");for(let O=0;O<E.length;O++)if(E[O]==s)return u>0?E[O+1]:E[O-1];return null}getItem(s){if(typeof s=="object")return s;var u=gl(s);return u!==null?this.control.querySelector(`[data-value="${n2(u)}"]`):null}addItems(s,u){var g=this,A=Array.isArray(s)?s:[s];A=A.filter(O=>g.items.indexOf(O)===-1);const E=A[A.length-1];A.forEach(O=>{g.isPending=O!==E,g.addItem(O,u)})}addItem(s,u){var g=u?[]:["change","dropdown_close"];i2(this,g,()=>{var A,E;const O=this,r=O.settings.mode,U=gl(s);if(!(U&&O.items.indexOf(U)!==-1&&(r==="single"&&O.close(),r==="single"||!O.settings.duplicates))&&!(U===null||!O.options.hasOwnProperty(U))&&(r==="single"&&O.clear(u),!(r==="multi"&&O.isFull()))){if(A=O._render("item",O.options[U]),O.control.contains(A)&&(A=A.cloneNode(!0)),E=O.isFull(),O.items.splice(O.caretPos,0,U),O.insertAtCaret(A),O.isSetup){if(!O.isPending&&O.settings.hideSelected){let W=O.getOption(U),Y=O.getAdjacent(W,1);Y&&O.setActiveOption(Y)}!O.isPending&&!O.settings.closeAfterSelect&&O.refreshOptions(O.isFocused&&r!=="single"),O.settings.closeAfterSelect!=!1&&O.isFull()?O.close():O.isPending||O.positionDropdown(),O.trigger("item_add",U,A),O.isPending||O.updateOriginalInput({silent:u})}(!O.isPending||!E&&O.isFull())&&(O.inputState(),O.refreshState())}})}removeItem(s=null,u){const g=this;if(s=g.getItem(s),!s)return;var A,E;const O=s.dataset.value;A=Wg(s),s.remove(),s.classList.contains("active")&&(E=g.activeItems.indexOf(s),g.activeItems.splice(E,1),Yc(s,"active")),g.items.splice(A,1),g.lastQuery=null,!g.settings.persist&&g.userOptions.hasOwnProperty(O)&&g.removeOption(O,u),A<g.caretPos&&g.setCaret(g.caretPos-1),g.updateOriginalInput({silent:u}),g.refreshState(),g.positionDropdown(),g.trigger("item_remove",O,s)}createItem(s=null,u=()=>{}){arguments.length===3&&(u=arguments[2]),typeof u!="function"&&(u=()=>{});var g=this,A=g.caretPos,E;if(s=s||g.inputValue(),!g.canCreate(s))return u(),!1;g.lock();var O=!1,r=U=>{if(g.unlock(),!U||typeof U!="object")return u();var W=gl(U[g.settings.valueField]);if(typeof W!="string")return u();g.setTextboxValue(),g.addOption(U,!0),g.setCaret(A),g.addItem(W),u(U),O=!0};return typeof g.settings.create=="function"?E=g.settings.create.call(this,s,r):E={[g.settings.labelField]:s,[g.settings.valueField]:s},O||r(E),!0}refreshItems(){var s=this;s.lastQuery=null,s.isSetup&&s.addItems(s.items),s.updateOriginalInput(),s.refreshState()}refreshState(){const s=this;s.refreshValidityState();const u=s.isFull(),g=s.isLocked;s.wrapper.classList.toggle("rtl",s.rtl);const A=s.wrapper.classList;A.toggle("focus",s.isFocused),A.toggle("disabled",s.isDisabled),A.toggle("readonly",s.isReadOnly),A.toggle("required",s.isRequired),A.toggle("invalid",!s.isValid),A.toggle("locked",g),A.toggle("full",u),A.toggle("input-active",s.isFocused&&!s.isInputHidden),A.toggle("dropdown-active",s.isOpen),A.toggle("has-options",RD(s.options)),A.toggle("has-items",s.items.length>0)}refreshValidityState(){var s=this;s.input.validity&&(s.isValid=s.input.validity.valid,s.isInvalid=!s.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(s={}){const u=this;var g,A;const E=u.input.querySelector('option[value=""]');if(u.is_select_tag){let W=function(Y,se,Ae){return Y||(Y=Ps('<option value="'+Pg(se)+'">'+Pg(Ae)+"</option>")),Y!=E&&u.input.append(Y),r.push(Y),(Y!=E||U>0)&&(Y.selected=!0),Y};var O=W;const r=[],U=u.input.querySelectorAll("option:checked").length;u.input.querySelectorAll("option:checked").forEach(Y=>{Y.selected=!1}),u.items.length==0&&u.settings.mode=="single"?W(E,"",""):u.items.forEach(Y=>{if(g=u.options[Y],A=g[u.settings.labelField]||"",r.includes(g.$option)){const se=u.input.querySelector(`option[value="${n2(Y)}"]:not(:checked)`);W(se,Y,A)}else g.$option=W(g.$option,Y,A)})}else u.input.value=u.getValue();u.isSetup&&(s.silent||u.trigger("change",u.getValue()))}open(){var s=this;s.isLocked||s.isOpen||s.settings.mode==="multi"&&s.isFull()||(s.isOpen=!0,wo(s.focus_node,{"aria-expanded":"true"}),s.refreshState(),wg(s.dropdown,{visibility:"hidden",display:"block"}),s.positionDropdown(),wg(s.dropdown,{visibility:"visible",display:"block"}),s.focus(),s.trigger("dropdown_open",s.dropdown))}close(s=!0){var u=this,g=u.isOpen;s&&(u.setTextboxValue(),u.settings.mode==="single"&&u.items.length&&u.inputState()),u.isOpen=!1,wo(u.focus_node,{"aria-expanded":"false"}),wg(u.dropdown,{display:"none"}),u.settings.hideSelected&&u.clearActiveOption(),u.refreshState(),g&&u.trigger("dropdown_close",u.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var s=this.control,u=s.getBoundingClientRect(),g=s.offsetHeight+u.top+window.scrollY,A=u.left+window.scrollX;wg(this.dropdown,{width:u.width+"px",top:g+"px",left:A+"px"})}}clear(s){var u=this;if(u.items.length){var g=u.controlChildren();da(g,A=>{u.removeItem(A,!0)}),u.inputState(),s||u.updateOriginalInput(),u.trigger("clear")}}insertAtCaret(s){const u=this,g=u.caretPos,A=u.control;A.insertBefore(s,A.children[g]||null),u.setCaret(g+1)}deleteSelection(s){var u,g,A,E,O=this;u=s&&s.keyCode===e2?-1:1,g=GD(O.control_input);const r=[];if(O.activeItems.length)E=Jb(O.activeItems,u),A=Wg(E),u>0&&A++,da(O.activeItems,U=>r.push(U));else if((O.isFocused||O.settings.mode==="single")&&O.items.length){const U=O.controlChildren();let W;u<0&&g.start===0&&g.length===0?W=U[O.caretPos-1]:u>0&&g.start===O.inputValue().length&&(W=U[O.caretPos]),W!==void 0&&r.push(W)}if(!O.shouldDelete(r,s))return!1;for(Qr(s,!0),typeof A<"u"&&O.setCaret(A);r.length;)O.removeItem(r.pop());return O.inputState(),O.positionDropdown(),O.refreshOptions(!1),!0}shouldDelete(s,u){const g=s.map(A=>A.dataset.value);return!(!g.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(g,u)===!1)}advanceSelection(s,u){var g,A,E=this;E.rtl&&(s*=-1),!E.inputValue().length&&(Mh(bg,u)||Mh("shiftKey",u)?(g=E.getLastActive(s),g?g.classList.contains("active")?A=E.getAdjacent(g,s,"item"):A=g:s>0?A=E.control_input.nextElementSibling:A=E.control_input.previousElementSibling,A&&(A.classList.contains("active")&&E.removeActiveItem(g),E.setActiveItemClass(A))):E.moveCaret(s))}moveCaret(s){}getLastActive(s){let u=this.control.querySelector(".last-active");if(u)return u;var g=this.control.querySelectorAll(".active");if(g)return Jb(g,s)}setCaret(s){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.setLocked(!0)}unlock(){this.setLocked(!1)}setLocked(s=this.isReadOnly||this.isDisabled){this.isLocked=s,this.refreshState()}disable(){this.setDisabled(!0),this.close()}enable(){this.setDisabled(!1)}setDisabled(s){this.focus_node.tabIndex=s?-1:this.tabIndex,this.isDisabled=s,this.input.disabled=s,this.control_input.disabled=s,this.setLocked()}setReadOnly(s){this.isReadOnly=s,this.input.readOnly=s,this.control_input.readOnly=s,this.setLocked()}destroy(){var s=this,u=s.revertSettings;s.trigger("destroy"),s.off(),s.wrapper.remove(),s.dropdown.remove(),s.input.innerHTML=u.innerHTML,s.input.tabIndex=u.tabIndex,Yc(s.input,"tomselected","ts-hidden-accessible"),s._destroy(),delete s.input.tomselect}render(s,u){var g,A;const E=this;if(typeof this.settings.render[s]!="function"||(A=E.settings.render[s].call(this,u,Pg),!A))return null;if(A=Ps(A),s==="option"||s==="option_create"?u[E.settings.disabledField]?wo(A,{"aria-disabled":"true"}):wo(A,{"data-selectable":""}):s==="optgroup"&&(g=u.group[E.settings.optgroupValueField],wo(A,{"data-group":g}),u.group[E.settings.disabledField]&&wo(A,{"data-disabled":""})),s==="option"||s==="item"){const O=Og(u[E.settings.valueField]);wo(A,{"data-value":O}),s==="item"?(ha(A,E.settings.itemClass),wo(A,{"data-ts-item":""})):(ha(A,E.settings.optionClass),wo(A,{role:"option",id:u.$id}),u.$div=A,E.options[O]=u)}return A}_render(s,u){const g=this.render(s,u);if(g==null)throw"HTMLElement expected";return g}clearCache(){da(this.options,s=>{s.$div&&(s.$div.remove(),delete s.$div)})}uncacheValue(s){const u=this.getOption(s);u&&u.remove()}canCreate(s){return this.settings.create&&s.length>0&&this.settings.createFilter.call(this,s)}hook(s,u,g){var A=this,E=A[u];A[u]=function(){var O,r;return s==="after"&&(O=E.apply(A,arguments)),r=g.apply(A,arguments),s==="instead"?r:(s==="before"&&(O=E.apply(A,arguments)),O)}}}function WD(){Jr(this.input,"change",()=>{this.sync()})}function $D(d){var s=this,u=s.onOptionSelect;s.settings.hideSelected=!1;const g=Object.assign({className:"tomselect-checkbox",checkedClassNames:void 0,uncheckedClassNames:void 0},d);var A=function(r,U){U?(r.checked=!0,g.uncheckedClassNames&&r.classList.remove(...g.uncheckedClassNames),g.checkedClassNames&&r.classList.add(...g.checkedClassNames)):(r.checked=!1,g.checkedClassNames&&r.classList.remove(...g.checkedClassNames),g.uncheckedClassNames&&r.classList.add(...g.uncheckedClassNames))},E=function(r){setTimeout(()=>{var U=r.querySelector("input."+g.className);U instanceof HTMLInputElement&&A(U,r.classList.contains("selected"))},1)};s.hook("after","setupTemplates",()=>{var O=s.settings.render.option;s.settings.render.option=(r,U)=>{var W=Ps(O.call(s,r,U)),Y=document.createElement("input");g.className&&Y.classList.add(g.className),Y.addEventListener("click",function(Ae){Qr(Ae)}),Y.type="checkbox";const se=gl(r[s.settings.valueField]);return A(Y,!!(se&&s.items.indexOf(se)>-1)),W.prepend(Y),W}}),s.on("item_remove",O=>{var r=s.getOption(O);r&&(r.classList.remove("selected"),E(r))}),s.on("item_add",O=>{var r=s.getOption(O);r&&E(r)}),s.hook("instead","onOptionSelect",(O,r)=>{if(r.classList.contains("selected")){r.classList.remove("selected"),s.removeItem(r.dataset.value),s.refreshOptions(),Qr(O,!0);return}u.call(s,O,r),E(r)})}function ZD(d){const s=this,u=Object.assign({className:"clear-button",title:"Clear All",html:g=>`<div class="${g.className}" title="${g.title}">&#10799;</div>`},d);s.on("initialize",()=>{var g=Ps(u.html(u));g.addEventListener("click",A=>{s.isLocked||(s.clear(),s.settings.mode==="single"&&s.settings.allowEmptyOption&&s.addItem(""),A.preventDefault(),A.stopPropagation())}),s.control.appendChild(g)})}const XD=(d,s)=>{var u;(u=d.parentNode)==null||u.insertBefore(s,d.nextSibling)},YD=(d,s)=>{var u;(u=d.parentNode)==null||u.insertBefore(s,d)},KD=(d,s)=>{do{var u;if(s=(u=s)==null?void 0:u.previousElementSibling,d==s)return!0}while(s&&s.previousElementSibling);return!1};function QD(){var d=this;if(d.settings.mode!=="multi")return;var s=d.lock,u=d.unlock;let g=!0,A;d.hook("after","setupTemplates",()=>{var E=d.settings.render.item;d.settings.render.item=(O,r)=>{const U=Ps(E.call(d,O,r));wo(U,{draggable:"true"});const W=K=>{g||Qr(K),K.stopPropagation()},Y=K=>{A=U,setTimeout(()=>{U.classList.add("ts-dragging")},0)},se=K=>{K.preventDefault(),U.classList.add("ts-drag-over"),Ce(U,A)},Ae=()=>{U.classList.remove("ts-drag-over")},Ce=(K,N)=>{N!==void 0&&(KD(N,U)?XD(K,N):YD(K,N))},he=()=>{var K;document.querySelectorAll(".ts-drag-over").forEach(z=>z.classList.remove("ts-drag-over")),(K=A)==null||K.classList.remove("ts-dragging"),A=void 0;var N=[];d.control.querySelectorAll("[data-value]").forEach(z=>{if(z.dataset.value){let q=z.dataset.value;q&&N.push(q)}}),d.setValue(N)};return Jr(U,"mousedown",W),Jr(U,"dragstart",Y),Jr(U,"dragenter",se),Jr(U,"dragover",se),Jr(U,"dragleave",Ae),Jr(U,"dragend",he),U}}),d.hook("instead","lock",()=>(g=!1,s.call(d))),d.hook("instead","unlock",()=>(g=!0,u.call(d)))}function JD(d){const s=this,u=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:g=>'<div class="'+g.headerClass+'"><div class="'+g.titleRowClass+'"><span class="'+g.labelClass+'">'+g.title+'</span><a class="'+g.closeClass+'">&times;</a></div></div>'},d);s.on("initialize",()=>{var g=Ps(u.html(u)),A=g.querySelector("."+u.closeClass);A&&A.addEventListener("click",E=>{Qr(E,!0),s.close()}),s.dropdown.insertBefore(g,s.dropdown.firstChild)})}function eR(){var d=this;d.hook("instead","setCaret",s=>{d.settings.mode==="single"||!d.control.contains(d.control_input)?s=d.items.length:(s=Math.max(0,Math.min(d.items.length,s)),s!=d.caretPos&&!d.isPending&&d.controlChildren().forEach((u,g)=>{g<s?d.control_input.insertAdjacentElement("beforebegin",u):d.control.appendChild(u)})),d.caretPos=s}),d.hook("instead","moveCaret",s=>{if(!d.isFocused)return;const u=d.getLastActive(s);if(u){const g=Wg(u);d.setCaret(s>0?g+1:g),d.setActiveItem(),Yc(u,"last-active")}else d.setCaret(d.caretPos+s)})}function tR(){const d=this;d.settings.shouldOpen=!0,d.hook("before","setup",()=>{d.focus_node=d.control,ha(d.control_input,"dropdown-input");const s=Ps('<div class="dropdown-input-wrap">');s.append(d.control_input),d.dropdown.insertBefore(s,d.dropdown.firstChild);const u=Ps('<input class="items-placeholder" tabindex="-1" />');u.placeholder=d.settings.placeholder||"",d.control.append(u)}),d.on("initialize",()=>{d.control_input.addEventListener("keydown",u=>{switch(u.keyCode){case QC:d.isOpen&&(Qr(u,!0),d.close()),d.clearActiveItems();return;case j_:d.focus_node.tabIndex=-1;break}return d.onKeyDown.call(d,u)}),d.on("blur",()=>{d.focus_node.tabIndex=d.isDisabled?-1:d.tabIndex}),d.on("dropdown_open",()=>{d.control_input.focus()});const s=d.onBlur;d.hook("instead","onBlur",u=>{if(!(u&&u.relatedTarget==d.control_input))return s.call(d)}),Jr(d.control_input,"blur",()=>d.onBlur()),d.hook("before","close",()=>{d.isOpen&&d.focus_node.focus({preventScroll:!0})})})}function iR(){var d=this;d.on("initialize",()=>{var s=document.createElement("span"),u=d.control_input;s.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",d.wrapper.appendChild(s);var g=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const E of g)s.style[E]=u.style[E];var A=()=>{s.textContent=u.value,u.style.width=s.clientWidth+"px"};A(),d.on("update item_add item_remove",A),Jr(u,"input",A),Jr(u,"keyup",A),Jr(u,"blur",A),Jr(u,"update",A)})}function nR(){var d=this,s=d.deleteSelection;this.hook("instead","deleteSelection",u=>d.activeItems.length?s.call(d,u):!1)}function rR(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}function oR(){var d=this,s=d.onKeyDown;d.hook("instead","onKeyDown",u=>{var g,A,E,O;if(!d.isOpen||!(u.keyCode===U_||u.keyCode===JC))return s.call(d,u);d.ignoreHover=!0,O=Lg(d.activeOption,"[data-group]"),g=Wg(d.activeOption,"[data-selectable]"),O&&(u.keyCode===U_?O=O.previousSibling:O=O.nextSibling,O&&(E=O.querySelectorAll("[data-selectable]"),A=E[Math.min(E.length-1,g)],A&&d.setActiveOption(A)))})}function sR(d){const s=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},d);var u=this;if(s.append){var g='<a href="javascript:void(0)" class="'+s.className+'" tabindex="-1" title="'+Pg(s.title)+'">'+s.label+"</a>";u.hook("after","setupTemplates",()=>{var A=u.settings.render.item;u.settings.render.item=(E,O)=>{var r=Ps(A.call(u,E,O)),U=Ps(g);return r.appendChild(U),Jr(U,"mousedown",W=>{Qr(W,!0)}),Jr(U,"click",W=>{u.isLocked||(Qr(W,!0),!u.isLocked&&u.shouldDelete([r],W)&&(u.removeItem(r),u.refreshOptions(!1),u.inputState()))}),r}})}}function aR(d){const s=this,u=Object.assign({text:g=>g[s.settings.labelField]},d);s.on("item_remove",function(g){if(s.isFocused&&s.control_input.value.trim()===""){var A=s.options[g];A&&s.setTextboxValue(u.text.call(s,A))}})}function lR(){const d=this,s=d.canLoad,u=d.clearActiveOption,g=d.loadCallback;var A={},E,O=!1,r,U=[];if(d.settings.shouldLoadMore||(d.settings.shouldLoadMore=()=>{if(E.clientHeight/(E.scrollHeight-E.scrollTop)>.9)return!0;if(d.activeOption){var Ae=d.selectable(),Ce=Array.from(Ae).indexOf(d.activeOption);if(Ce>=Ae.length-2)return!0}return!1}),!d.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";d.settings.sortField=[{field:"$order"},{field:"$score"}];const W=se=>typeof d.settings.maxOptions=="number"&&E.children.length>=d.settings.maxOptions?!1:!!(se in A&&A[se]),Y=(se,Ae)=>d.items.indexOf(Ae)>=0||U.indexOf(Ae)>=0;d.setNextUrl=(se,Ae)=>{A[se]=Ae},d.getUrl=se=>{if(se in A){const Ae=A[se];return A[se]=!1,Ae}return d.clearPagination(),d.settings.firstUrl.call(d,se)},d.clearPagination=()=>{A={}},d.hook("instead","clearActiveOption",()=>{if(!O)return u.call(d)}),d.hook("instead","canLoad",se=>se in A?W(se):s.call(d,se)),d.hook("instead","loadCallback",(se,Ae)=>{if(!O)d.clearOptions(Y);else if(r){const Ce=se[0];Ce!==void 0&&(r.dataset.value=Ce[d.settings.valueField])}g.call(d,se,Ae),O=!1}),d.hook("after","refreshOptions",()=>{const se=d.lastValue;var Ae;W(se)?(Ae=d.render("loading_more",{query:se}),Ae&&(Ae.setAttribute("data-selectable",""),r=Ae)):se in A&&!E.querySelector(".no-results")&&(Ae=d.render("no_more_results",{query:se})),Ae&&(ha(Ae,d.settings.optionClass),E.append(Ae))}),d.on("initialize",()=>{U=Object.keys(d.options),E=d.dropdown_content,d.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},d.settings.render),E.addEventListener("scroll",()=>{d.settings.shouldLoadMore.call(d)&&W(d.lastValue)&&(O||(O=!0,d.load.call(d,d.lastValue)))})})}fa.define("change_listener",WD);fa.define("checkbox_options",$D);fa.define("clear_button",ZD);fa.define("drag_drop",QD);fa.define("dropdown_header",JD);fa.define("caret_position",eR);fa.define("dropdown_input",tR);fa.define("input_autogrow",iR);fa.define("no_backspace_delete",nR);fa.define("no_active_items",rR);fa.define("optgroup_columns",oR);fa.define("remove_button",sR);fa.define("restore_on_backspace",aR);fa.define("virtual_scroll",lR);window.axios=R3;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";window.mapboxgl=F3;window.MapboxGeocoder=e4;window.Html5QrcodeScanner=F4;window.Html5Qrcode=D_;window.detect=Q4;window.Swal=iO;window.FingerprintJS=uD;window.TomSelect=fa;const up=d=>d==="true",Ho=(d,s,u="")=>(window.getComputedStyle(d).getPropertyValue(s)||u).replace(" ",""),cR=(d,s,u="")=>{let g="";return d.classList.forEach(A=>{A.includes(s)&&(g=A)}),g.match(/:(.*)]/)?g.match(/:(.*)]/)[1]:u},uR=()=>/iPad|iPhone|iPod/.test(navigator.platform)?!0:navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),hR=()=>navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),uy=(d,s,u="auto",g=10,A=null)=>{const E=s.getBoundingClientRect(),O=A?A.getBoundingClientRect():null,r=window.innerHeight,U=O?E.top-O.top:E.top,W=(A?O.bottom:r)-E.bottom,Y=d.clientHeight+g;return u==="bottom"?W>=Y:u==="top"?U>=Y:U>=Y||W>=Y},dR=d=>d instanceof HTMLInputElement||d instanceof HTMLTextAreaElement||d instanceof HTMLSelectElement,hy=d=>d?window.getComputedStyle(d).display==="none"?!0:hy(d.parentElement):!1,$g=(d,s=200)=>{let u;return(...g)=>{clearTimeout(u),u=setTimeout(()=>{d.apply(void 0,g)},s)}},to=(d,s,u=null)=>{const g=new CustomEvent(d,{detail:{payload:u},bubbles:!0,cancelable:!0,composed:!1});s.dispatchEvent(g)},vl=(d,s)=>{const u=()=>{s(),d.removeEventListener("transitionend",u,!0)},g=window.getComputedStyle(d),A=g.getPropertyValue("transition-duration");g.getPropertyValue("transition-property")!=="none"&&parseFloat(A)>0?d.addEventListener("transitionend",u,!0):s()},Wr=d=>{const s=document.createElement("template");return d=d.trim(),s.innerHTML=d,s.content.firstChild},Pa=(d,s,u=" ",g="add")=>{d.split(u).forEach(E=>g==="add"?s.classList.add(E):s.classList.remove(E))},fR={historyIndex:-1,addHistory(d){this.historyIndex=d},existsInHistory(d){return d>this.historyIndex},clearHistory(){this.historyIndex=-1}};/*
 * HSBasePlugin
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class as{constructor(s,u,g){this.el=s,this.options=u,this.events=g,this.el=s,this.options=u,this.events={}}createCollection(s,u){var g;s.push({id:((g=u==null?void 0:u.el)==null?void 0:g.id)||s.length+1,element:u})}fireEvent(s,u=null){if(this.events.hasOwnProperty(s))return this.events[s](u)}on(s,u){this.events[s]=u}}/*
 * HSCopyMarkup
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class bp extends as{constructor(s,u){super(s,u);const g=s.getAttribute("data-hs-copy-markup"),E={...g?JSON.parse(g):{},...u};this.targetSelector=(E==null?void 0:E.targetSelector)||null,this.wrapperSelector=(E==null?void 0:E.wrapperSelector)||null,this.limit=(E==null?void 0:E.limit)||null,this.items=[],this.targetSelector&&this.init()}init(){this.createCollection(window.$hsCopyMarkupCollection,this),this.setTarget(),this.setWrapper(),this.addPredefinedItems(),this.el.addEventListener("click",()=>this.copy())}copy(){if(this.limit&&this.items.length>=this.limit)return!1;this.el.hasAttribute("disabled")&&this.el.setAttribute("disabled","");const s=this.target.cloneNode(!0);this.addToItems(s),this.limit&&this.items.length>=this.limit&&this.el.setAttribute("disabled","disabled"),this.fireEvent("copy",s),to("copy.hs.copyMarkup",s,s)}addPredefinedItems(){Array.from(this.wrapper.children).filter(s=>!s.classList.contains("[--ignore-for-count]")).forEach(s=>{this.addToItems(s)})}setTarget(){const s=typeof this.targetSelector=="string"?document.querySelector(this.targetSelector).cloneNode(!0):this.targetSelector.cloneNode(!0);s.removeAttribute("id"),this.target=s}setWrapper(){this.wrapper=typeof this.wrapperSelector=="string"?document.querySelector(this.wrapperSelector):this.wrapperSelector}addToItems(s){const u=s.querySelector("[data-hs-copy-markup-delete-item]");this.wrapper?this.wrapper.append(s):this.el.before(s),u&&u.addEventListener("click",()=>this.delete(s)),this.items.push(s)}delete(s){const u=this.items.indexOf(s);u!==-1&&this.items.splice(u,1),s.remove(),this.fireEvent("delete",s),to("delete.hs.copyMarkup",s,s)}static getInstance(s,u){const g=window.$hsCopyMarkupCollection.find(A=>A.element.el===(typeof s=="string"?document.querySelector(s):s));return g?u?g:g.element:null}static autoInit(){window.$hsCopyMarkupCollection||(window.$hsCopyMarkupCollection=[]),document.querySelectorAll("[data-hs-copy-markup]:not(.--prevent-on-load-init)").forEach(s=>{if(!window.$hsCopyMarkupCollection.find(u=>{var g;return((g=u==null?void 0:u.element)==null?void 0:g.el)===s})){const u=s.getAttribute("data-hs-copy-markup"),g=u?JSON.parse(u):{};new bp(s,g)}})}}window.addEventListener("load",()=>{bp.autoInit()});typeof window<"u"&&(window.HSCopyMarkup=bp);/*
 * HSAccordion
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class Bd extends as{constructor(s,u,g){super(s,u,g),this.toggle=this.el.querySelector(".hs-accordion-toggle")||null,this.content=this.el.querySelector(".hs-accordion-content")||null,this.group=this.el.closest(".hs-accordion-group")||null,this.isAlwaysOpened=this.group.hasAttribute("data-hs-accordion-always-open")||!1,this.toggle&&this.content&&this.init()}init(){this.createCollection(window.$hsAccordionCollection,this),this.toggle.addEventListener("click",s=>{s.stopPropagation(),this.el.classList.contains("active")?this.hide():this.show()})}show(){var s;if(this.group&&!this.isAlwaysOpened&&this.group.querySelector(":scope > .hs-accordion.active")&&this.group.querySelector(":scope > .hs-accordion.active")!==this.el&&window.$hsAccordionCollection.find(g=>g.element.el===this.group.querySelector(":scope > .hs-accordion.active")).element.hide(),this.el.classList.contains("active"))return!1;this.el.classList.add("active"),(s=this==null?void 0:this.toggle)!=null&&s.ariaExpanded&&(this.toggle.ariaExpanded="true"),this.content.style.display="block",this.content.style.height="0",setTimeout(()=>{this.content.style.height=`${this.content.scrollHeight}px`}),vl(this.content,()=>{this.content.style.display="block",this.content.style.height="",this.fireEvent("open",this.el),to("open.hs.accordion",this.el,this.el)})}hide(){var s;if(!this.el.classList.contains("active"))return!1;this.el.classList.remove("active"),(s=this==null?void 0:this.toggle)!=null&&s.ariaExpanded&&(this.toggle.ariaExpanded="false"),this.content.style.height=`${this.content.scrollHeight}px`,setTimeout(()=>{this.content.style.height="0"}),vl(this.content,()=>{this.content.style.display="",this.content.style.height="0",this.fireEvent("close",this.el),to("close.hs.accordion",this.el,this.el)})}static getInstance(s,u){const g=window.$hsAccordionCollection.find(A=>A.element.el===(typeof s=="string"?document.querySelector(s):s));return g?u?g:g.element.el:null}static show(s){const u=window.$hsAccordionCollection.find(g=>g.element.el===(typeof s=="string"?document.querySelector(s):s));u&&u.element.content.style.display!=="block"&&u.element.show()}static hide(s){const u=window.$hsAccordionCollection.find(g=>g.element.el===(typeof s=="string"?document.querySelector(s):s));u&&u.element.content.style.display==="block"&&u.element.hide()}static autoInit(){window.$hsAccordionCollection||(window.$hsAccordionCollection=[]),document.querySelectorAll(".hs-accordion:not(.--prevent-on-load-init)").forEach(s=>{window.$hsAccordionCollection.find(u=>{var g;return((g=u==null?void 0:u.element)==null?void 0:g.el)===s})||new Bd(s)})}static treeView(){if(!document.querySelectorAll(".hs-accordion-treeview-root").length)return!1;this.selectable=[],document.querySelectorAll(".hs-accordion-treeview-root").forEach(s=>{const u=s==null?void 0:s.getAttribute("data-hs-accordion-options"),g=u?JSON.parse(u):{};this.selectable.push({el:s,options:{...g}})}),this.selectable.length&&this.selectable.forEach(s=>{const{el:u}=s;u.querySelectorAll(".hs-accordion-selectable").forEach(g=>{g.addEventListener("click",A=>{A.stopPropagation(),this.toggleSelected(s,g)})})})}static toggleSelected(s,u){u.classList.contains("selected")?u.classList.remove("selected"):(s.el.querySelectorAll(".hs-accordion-selectable").forEach(g=>g.classList.remove("selected")),u.classList.add("selected"))}static on(s,u,g){const A=window.$hsAccordionCollection.find(E=>E.element.el===(typeof u=="string"?document.querySelector(u):u));A&&(A.element.events[s]=g)}}window.addEventListener("load",()=>{Bd.autoInit(),document.querySelectorAll(".hs-accordion-treeview-root").length&&Bd.treeView()});typeof window<"u"&&(window.HSAccordion=Bd);/*
 * HSCarousel
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class Cp extends as{constructor(s,u){var O,r,U;super(s,u);const g=s.getAttribute("data-hs-carousel"),E={...g?JSON.parse(g):{},...u};this.currentIndex=E.currentIndex||0,this.loadingClasses=E.loadingClasses?`${E.loadingClasses}`.split(","):null,this.loadingClassesRemove=(O=this.loadingClasses)!=null&&O[0]?this.loadingClasses[0].split(" "):"opacity-0",this.loadingClassesAdd=(r=this.loadingClasses)!=null&&r[1]?this.loadingClasses[1].split(" "):"",this.afterLoadingClassesAdd=(U=this.loadingClasses)!=null&&U[2]?this.loadingClasses[2].split(" "):"",this.isAutoPlay=typeof E.isAutoPlay<"u"?E.isAutoPlay:!1,this.speed=E.speed||4e3,this.isInfiniteLoop=typeof E.isInfiniteLoop<"u"?E.isInfiniteLoop:!0,this.isRTL=typeof E.isRTL<"u"?E.isRTL:!1,this.inner=this.el.querySelector(".hs-carousel-body")||null,this.slides=this.el.querySelectorAll(".hs-carousel-slide")||[],this.prev=this.el.querySelector(".hs-carousel-prev")||null,this.next=this.el.querySelector(".hs-carousel-next")||null,this.dots=this.el.querySelectorAll(".hs-carousel-pagination > *")||null,this.sliderWidth=this.inner.parentElement.clientWidth,this.touchX={start:0,end:0},this.init()}init(){this.createCollection(window.$hsCarouselCollection,this),this.inner&&(this.calculateWidth(),this.loadingClassesRemove&&(typeof this.loadingClassesRemove=="string"?this.inner.classList.remove(this.loadingClassesRemove):this.inner.classList.remove(...this.loadingClassesRemove)),this.loadingClassesAdd&&(typeof this.loadingClassesAdd=="string"?this.inner.classList.add(this.loadingClassesAdd):this.inner.classList.add(...this.loadingClassesAdd))),this.prev&&this.prev.addEventListener("click",()=>{this.goToPrev(),this.isAutoPlay&&(this.resetTimer(),this.setTimer())}),this.next&&this.next.addEventListener("click",()=>{this.goToNext(),this.isAutoPlay&&(this.resetTimer(),this.setTimer())}),this.dots&&this.dots.forEach((s,u)=>s.addEventListener("click",()=>{this.goTo(u),this.isAutoPlay&&(this.resetTimer(),this.setTimer())})),this.slides.length&&(this.addCurrentClass(),this.isInfiniteLoop||this.addDisabledClass(),this.isAutoPlay&&this.autoPlay()),this.inner&&this.afterLoadingClassesAdd&&setTimeout(()=>{typeof this.afterLoadingClassesAdd=="string"?this.inner.classList.add(this.afterLoadingClassesAdd):this.inner.classList.add(...this.afterLoadingClassesAdd)}),this.el.classList.add("init"),this.el.addEventListener("touchstart",s=>{this.touchX.start=s.changedTouches[0].screenX}),this.el.addEventListener("touchend",s=>{this.touchX.end=s.changedTouches[0].screenX,this.detectDirection()}),this.observeResize()}observeResize(){new ResizeObserver(()=>this.recalculateWidth()).observe(document.querySelector("body"))}calculateWidth(){this.inner.style.width=`${this.sliderWidth*this.slides.length}px`,this.inner.style.transform=this.calculateTransform(),this.slides.forEach(s=>{s.style.width=`${this.sliderWidth}px`})}addCurrentClass(){this.slides.forEach((s,u)=>{u===this.currentIndex?s.classList.add("active"):s.classList.remove("active")}),this.dots&&this.dots.forEach((s,u)=>{u===this.currentIndex?s.classList.add("active"):s.classList.remove("active")})}addDisabledClass(){if(!this.prev||!this.next)return!1;this.currentIndex===0?(this.next.classList.remove("disabled"),this.prev.classList.add("disabled")):this.currentIndex===this.slides.length-1?(this.prev.classList.remove("disabled"),this.next.classList.add("disabled")):(this.prev.classList.remove("disabled"),this.next.classList.remove("disabled"))}autoPlay(){this.setTimer()}setTimer(){this.timer=setInterval(()=>{this.currentIndex===this.slides.length-1?this.goTo(0):this.goToNext()},this.speed)}resetTimer(){clearInterval(this.timer)}detectDirection(){const{start:s,end:u}=this.touchX;u<s&&this.goToNext(),u>s&&this.goToPrev()}recalculateWidth(){this.sliderWidth=this.inner.parentElement.clientWidth,this.calculateWidth()}calculateTransform(){let s=this.currentIndex*this.sliderWidth;return this.isRTL?`translate(${s}px, 0px)`:`translate(-${s}px, 0px)`}goToPrev(){this.currentIndex===0&&this.isInfiniteLoop?(this.currentIndex=this.slides.length-1,this.inner.style.transform=this.calculateTransform(),this.addCurrentClass()):this.currentIndex!==0&&(this.currentIndex-=1,this.inner.style.transform=this.calculateTransform(),this.addCurrentClass(),this.addDisabledClass())}goToNext(){this.currentIndex===this.slides.length-1&&this.isInfiniteLoop?(this.currentIndex=0,this.inner.style.transform=this.calculateTransform(),this.addCurrentClass()):this.currentIndex<this.slides.length-1&&(this.currentIndex+=1,this.inner.style.transform=this.calculateTransform(),this.addCurrentClass(),this.addDisabledClass())}goTo(s){this.currentIndex=s,this.inner.style.transform=this.calculateTransform(),this.addCurrentClass(),this.isInfiniteLoop||this.addDisabledClass()}static getInstance(s,u){const g=window.$hsCarouselCollection.find(A=>A.element.el===(typeof s=="string"?document.querySelector(s):s));return g?u?g:g.element:null}static autoInit(){window.$hsCarouselCollection||(window.$hsCarouselCollection=[]),document.querySelectorAll("[data-hs-carousel]:not(.--prevent-on-load-init)").forEach(s=>{window.$hsCarouselCollection.find(u=>{var g;return((g=u==null?void 0:u.element)==null?void 0:g.el)===s})||new Cp(s)})}}window.addEventListener("load",()=>{Cp.autoInit()});window.addEventListener("resize",()=>{if(!window.$hsCarouselCollection)return!1;window.$hsCarouselCollection.forEach(d=>{d.element.recalculateWidth()})});typeof window<"u"&&(window.HSCarousel=Cp);/*
 * HSCollapse
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class Ep extends as{constructor(s,u,g){super(s,u,g),this.contentId=this.el.dataset.hsCollapse,this.content=document.querySelector(this.contentId),this.animationInProcess=!1,this.content&&this.init()}init(){var s;this.createCollection(window.$hsCollapseCollection,this),(s=this==null?void 0:this.el)!=null&&s.ariaExpanded&&(this.el.classList.contains("open")?this.el.ariaExpanded="true":this.el.ariaExpanded="false"),this.el.addEventListener("click",()=>{this.content.classList.contains("open")?this.hide():this.show()})}hideAllMegaMenuItems(){this.content.querySelectorAll(".hs-mega-menu-content.block").forEach(s=>{s.classList.remove("block"),s.classList.add("hidden")})}show(){var s;if(this.animationInProcess||this.el.classList.contains("open"))return!1;this.animationInProcess=!0,this.el.classList.add("open"),(s=this==null?void 0:this.el)!=null&&s.ariaExpanded&&(this.el.ariaExpanded="true"),this.content.classList.add("open"),this.content.classList.remove("hidden"),this.content.style.height="0",setTimeout(()=>{this.content.style.height=`${this.content.scrollHeight}px`,this.fireEvent("beforeOpen",this.el),to("beforeOpen.hs.collapse",this.el,this.el)}),vl(this.content,()=>{this.content.style.height="",this.fireEvent("open",this.el),to("open.hs.collapse",this.el,this.el),this.animationInProcess=!1})}hide(){var s;if(this.animationInProcess||!this.el.classList.contains("open"))return!1;this.animationInProcess=!0,this.el.classList.remove("open"),(s=this==null?void 0:this.el)!=null&&s.ariaExpanded&&(this.el.ariaExpanded="false"),this.content.style.height=`${this.content.scrollHeight}px`,setTimeout(()=>{this.content.style.height="0"}),this.content.classList.remove("open"),vl(this.content,()=>{this.content.classList.add("hidden"),this.content.style.height="",this.fireEvent("hide",this.el),to("hide.hs.collapse",this.el,this.el),this.animationInProcess=!1}),this.content.querySelectorAll(".hs-mega-menu-content.block").length&&this.hideAllMegaMenuItems()}static getInstance(s,u=!1){const g=window.$hsCollapseCollection.find(A=>A.element.el===(typeof s=="string"?document.querySelector(s):s));return g?u?g:g.element.el:null}static autoInit(){window.$hsCollapseCollection||(window.$hsCollapseCollection=[]),document.querySelectorAll(".hs-collapse-toggle:not(.--prevent-on-load-init)").forEach(s=>{window.$hsCollapseCollection.find(u=>{var g;return((g=u==null?void 0:u.element)==null?void 0:g.el)===s})||new Ep(s)})}static show(s){const u=window.$hsCollapseCollection.find(g=>g.element.el===(typeof s=="string"?document.querySelector(s):s));u&&u.element.content.classList.contains("hidden")&&u.element.show()}static hide(s){const u=window.$hsCollapseCollection.find(g=>g.element.el===(typeof s=="string"?document.querySelector(s):s));u&&!u.element.content.classList.contains("hidden")&&u.element.hide()}static on(s,u,g){const A=window.$hsCollapseCollection.find(E=>E.element.el===(typeof u=="string"?document.querySelector(u):u));A&&(A.element.events[s]=g)}}window.addEventListener("load",()=>{Ep.autoInit()});typeof window<"u"&&(window.HSCollapse=Ep);const eE={auto:"auto","auto-start":"auto-start","auto-end":"auto-end",top:"top","top-left":"top-start","top-right":"top-end",bottom:"bottom","bottom-left":"bottom-start","bottom-right":"bottom-end",right:"right","right-start":"right-start","right-end":"right-end",left:"left","left-start":"left-start","left-end":"left-end"},pR=["Escape","ArrowUp","ArrowDown","Home","End","Enter"],mR=["ArrowUp","ArrowLeft","ArrowDown","ArrowRight","Home","End"],gR=["ArrowUp","ArrowLeft","ArrowDown","ArrowRight","Home","End","Escape","Enter","Tab"],_R=["ArrowUp","ArrowLeft","ArrowDown","ArrowRight","Home","End","Escape","Enter"],s2={sm:640,md:768,lg:1024,xl:1280,"2xl":1536};/*
 * HSComboBox
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class ql extends as{constructor(s,u,g){super(s,u,g);const A=s.getAttribute("data-hs-combo-box"),O={...A?JSON.parse(A):{},...u};this.gap=5,this.viewport=(typeof(O==null?void 0:O.viewport)=="string"?document.querySelector(O==null?void 0:O.viewport):O==null?void 0:O.viewport)??null,this.preventVisibility=(O==null?void 0:O.preventVisibility)??!1,this.apiUrl=(O==null?void 0:O.apiUrl)??null,this.apiDataPart=(O==null?void 0:O.apiDataPart)??null,this.apiQuery=(O==null?void 0:O.apiQuery)??null,this.apiSearchQuery=(O==null?void 0:O.apiSearchQuery)??null,this.apiHeaders=(O==null?void 0:O.apiHeaders)??{},this.apiGroupField=(O==null?void 0:O.apiGroupField)??null,this.outputItemTemplate=(O==null?void 0:O.outputItemTemplate)??`<div class="cursor-pointer py-2 px-4 w-full text-sm text-gray-800 hover:bg-gray-100 rounded-lg focus:outline-none focus:bg-gray-100 dark:bg-neutral-900 dark:hover:bg-neutral-800 dark:text-neutral-200 dark:focus:bg-neutral-800" data-hs-combo-box-output-item>
				<div class="flex justify-between items-center w-full">
					<span data-hs-combo-box-search-text></span>
					<span class="hidden hs-combo-box-selected:block">
						<svg class="shrink-0 size-3.5 text-blue-600 dark:text-blue-500" xmlns="http:.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<polyline points="20 6 9 17 4 12"></polyline>
						</svg>
					</span>
				</div>
			</div>`,this.outputEmptyTemplate=(O==null?void 0:O.outputEmptyTemplate)??'<div class="py-2 px-4 w-full text-sm text-gray-800 rounded-lg dark:bg-neutral-900 dark:text-neutral-200">Nothing found...</div>',this.outputLoaderTemplate=(O==null?void 0:O.outputLoaderTemplate)??`<div class="flex justify-center items-center py-2 px-4 text-sm text-gray-800 rounded-lg bg-white dark:bg-neutral-900 dark:text-neutral-200">
				<div class="animate-spin inline-block size-6 border-[3px] border-current border-t-transparent text-blue-600 rounded-full dark:text-blue-500" role="status" aria-label="loading">
					<span class="sr-only">Loading...</span>
				</div>
			</div>`,this.groupingType=(O==null?void 0:O.groupingType)??null,this.groupingTitleTemplate=(O==null?void 0:O.groupingTitleTemplate)??(this.groupingType==="default"?'<div class="block mb-1 text-xs font-semibold uppercase text-blue-600 dark:text-blue-500"></div>':'<button type="button" class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-semibold whitespace-nowrap rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none"></button>'),this.tabsWrapperTemplate=(O==null?void 0:O.tabsWrapperTemplate)??'<div class="overflow-x-auto p-4"></div>',this.preventSelection=(O==null?void 0:O.preventSelection)??!1,this.preventAutoPosition=(O==null?void 0:O.preventAutoPosition)??!1,this.isOpenOnFocus=(O==null?void 0:O.isOpenOnFocus)??!1,this.input=this.el.querySelector("[data-hs-combo-box-input]")??null,this.output=this.el.querySelector("[data-hs-combo-box-output]")??null,this.itemsWrapper=this.el.querySelector("[data-hs-combo-box-output-items-wrapper]")??null,this.items=Array.from(this.el.querySelectorAll("[data-hs-combo-box-output-item]"))??[],this.tabs=[],this.toggle=this.el.querySelector("[data-hs-combo-box-toggle]")??null,this.toggleClose=this.el.querySelector("[data-hs-combo-box-close]")??null,this.toggleOpen=this.el.querySelector("[data-hs-combo-box-open]")??null,this.outputPlaceholder=null,this.selected=this.value=this.el.querySelector("[data-hs-combo-box-input]").value??"",this.isOpened=!1,this.isCurrent=!1,this.animationInProcess=!1,this.selectedGroup="all",this.init()}init(){this.createCollection(window.$hsComboBoxCollection,this),this.build()}build(){this.buildInput(),this.groupingType&&this.setGroups(),this.buildItems(),this.preventVisibility&&(this.preventAutoPosition||this.recalculateDirection()),this.toggle&&this.buildToggle(),this.toggleClose&&this.buildToggleClose(),this.toggleOpen&&this.buildToggleOpen()}setResultAndRender(s=""){let u=this.preventVisibility?this.input.value:s;this.setResults(u),this.apiSearchQuery&&this.itemsFromJson()}buildInput(){this.isOpenOnFocus&&this.input.addEventListener("focus",()=>{this.isOpened||(this.setResultAndRender(),this.open())}),this.input.addEventListener("input",$g(s=>{this.setResultAndRender(s.target.value),this.input.value!==""?this.el.classList.add("has-value"):this.el.classList.remove("has-value"),this.isOpened||this.open()}))}buildItems(){this.output.role="listbox",this.output.tabIndex=-1,this.output.ariaOrientation="vertical",this.apiUrl?this.itemsFromJson():(this.itemsWrapper?this.itemsWrapper.innerHTML="":this.output.innerHTML="",this.itemsFromHtml())}setResults(s){this.value=s,this.resultItems(),this.hasVisibleItems()?this.destroyOutputPlaceholder():this.buildOutputPlaceholder()}isItemExists(s){return this.items.some(u=>{var O;const g=u.getAttribute("data-hs-combo-box-output-item-group-field")??null,A=JSON.parse(u.getAttribute("data-hs-combo-box-output-item"))??null;let E=null;return g&&((O=A==null?void 0:A.group)!=null&&O.name)&&(E=s[g]),Array.from(u.querySelectorAll("[data-hs-combo-box-search-text]")).some(r=>{var W;return(W=A==null?void 0:A.group)!=null&&W.name&&E?E===A.group.name&&r.getAttribute("data-hs-combo-box-search-text")===s[r.getAttribute("data-hs-combo-box-output-item-field")]:r.getAttribute("data-hs-combo-box-search-text")===s[r.getAttribute("data-hs-combo-box-output-item-field")]})})}isTextExists(s,u){const g=u.map(A=>A.toLowerCase());return Array.from(s.querySelectorAll("[data-hs-combo-box-search-text]")).some(A=>g.includes(A.getAttribute("data-hs-combo-box-search-text").toLowerCase()))}isTextExistsAny(s,u){return Array.from(s.querySelectorAll("[data-hs-combo-box-search-text]")).some(g=>g.getAttribute("data-hs-combo-box-search-text").toLowerCase().includes(u.toLowerCase()))}valuesBySelector(s){return Array.from(s.querySelectorAll("[data-hs-combo-box-search-text]")).reduce((u,g)=>[...u,g.getAttribute("data-hs-combo-box-search-text")],[])}buildOutputLoader(){if(this.outputLoader)return!1;this.outputLoader=Wr(this.outputLoaderTemplate),this.items.length||this.outputPlaceholder?(this.outputLoader.style.position="absolute",this.outputLoader.style.top="0",this.outputLoader.style.bottom="0",this.outputLoader.style.left="0",this.outputLoader.style.right="0",this.outputLoader.style.zIndex="2"):(this.outputLoader.style.position="",this.outputLoader.style.top="",this.outputLoader.style.bottom="",this.outputLoader.style.left="",this.outputLoader.style.right="",this.outputLoader.style.zIndex="",this.outputLoader.style.height="30px"),this.output.append(this.outputLoader)}destroyOutputLoader(){this.outputLoader&&this.outputLoader.remove(),this.outputLoader=null}async itemsFromJson(){this.buildOutputLoader();try{const s=`${this.apiQuery}`,u=`${this.apiSearchQuery}=${this.value.toLowerCase()}`;let g=this.apiUrl;this.apiQuery&&this.apiSearchQuery?g+=`?${u}&${s}`:this.apiQuery?g+=`?${s}`:this.apiSearchQuery&&(g+=`?${u}`);let E=await(await fetch(g,this.apiHeaders)).json();this.apiDataPart&&(E=E[this.apiDataPart]),this.apiSearchQuery&&(this.items=[]),this.itemsWrapper?this.itemsWrapper.innerHTML="":this.output.innerHTML="",this.groupingType==="tabs"?(this.setApiGroups(E),this.groupTabsRender(),this.jsonItemsRender(E)):this.groupingType==="default"?(this.setApiGroups(E),this.groups.forEach(O=>{const r=Wr(this.groupingTitleTemplate);r.setAttribute("data-hs-combo-box-group-title",O.name),r.classList.add("--exclude-accessibility"),r.innerText=O.title;const U=E.filter(W=>W[this.apiGroupField]===O.name);this.itemsWrapper?this.itemsWrapper.append(r):this.output.append(r),this.jsonItemsRender(U)})):this.jsonItemsRender(E),this.setResults(this.input.value)}catch(s){console.error(s)}this.destroyOutputLoader()}jsonItemsRender(s){s.forEach((u,g)=>{const A=Wr(this.outputItemTemplate);A.querySelectorAll("[data-hs-combo-box-output-item-field]").forEach(E=>{const O=u[E.getAttribute("data-hs-combo-box-output-item-field")],r=E.hasAttribute("data-hs-combo-box-output-item-hide-if-empty");E.textContent=O??"",!O&&r&&(E.style.display="none")}),A.querySelectorAll("[data-hs-combo-box-search-text]").forEach(E=>{E.setAttribute("data-hs-combo-box-search-text",u[E.getAttribute("data-hs-combo-box-output-item-field")]??"")}),A.querySelectorAll("[data-hs-combo-box-output-item-attr]").forEach(E=>{JSON.parse(E.getAttribute("data-hs-combo-box-output-item-attr")).forEach(r=>{E.setAttribute(r.attr,u[r.valueFrom])})}),A.setAttribute("tabIndex",`${g}`),(this.groupingType==="tabs"||this.groupingType==="default")&&A.setAttribute("data-hs-combo-box-output-item",`{"group": {"name": "${u[this.apiGroupField]}", "title": "${u[this.apiGroupField]}"}}`),this.items=[...this.items,A],this.preventSelection||A.addEventListener("click",()=>{this.close(A.querySelector("[data-hs-combo-box-value]").getAttribute("data-hs-combo-box-search-text")),this.setSelectedByValue(this.valuesBySelector(A))}),this.appendItemsToWrapper(A)})}setGroups(){const s=[];this.items.forEach(u=>{const{group:g}=JSON.parse(u.getAttribute("data-hs-combo-box-output-item"));s.some(A=>(A==null?void 0:A.name)===g.name)||s.push(g)}),this.groups=s}setCurrent(){window.$hsComboBoxCollection.length&&(window.$hsComboBoxCollection.map(s=>s.element.isCurrent=!1),this.isCurrent=!0)}setApiGroups(s){const u=[];s.forEach(g=>{const A=g[this.apiGroupField];u.some(E=>E.name===A)||u.push({name:A,title:A})}),this.groups=u}sortItems(){const s=(u,g)=>{const A=u.querySelector("[data-hs-combo-box-value]").getAttribute("data-hs-combo-box-search-text"),E=g.querySelector("[data-hs-combo-box-value]").getAttribute("data-hs-combo-box-search-text");return A<E?-1:A>E?1:0};return this.items.sort(s)}itemRender(s){const u=s.querySelector("[data-hs-combo-box-value]").getAttribute("data-hs-combo-box-search-text");this.itemsWrapper?this.itemsWrapper.append(s):this.output.append(s),this.preventSelection||s.addEventListener("click",()=>{this.close(u),this.setSelectedByValue(this.valuesBySelector(s))})}plainRender(s){s.forEach(u=>{this.itemRender(u)})}groupTabsRender(){const s=Wr(this.tabsWrapperTemplate),u=Wr('<div class="flex flex-nowrap gap-x-2"></div>');s.append(u),this.output.insertBefore(s,this.output.firstChild);const g=Wr(this.groupingTitleTemplate);g.setAttribute("data-hs-combo-box-group-title","all"),g.classList.add("--exclude-accessibility","active"),g.innerText="All",this.tabs=[...this.tabs,g],u.append(g),g.addEventListener("click",()=>{this.selectedGroup="all";const A=this.tabs.find(E=>E.getAttribute("data-hs-combo-box-group-title")===this.selectedGroup);this.tabs.forEach(E=>E.classList.remove("active")),A.classList.add("active"),this.setItemsVisibility()}),this.groups.forEach(A=>{const E=Wr(this.groupingTitleTemplate);E.setAttribute("data-hs-combo-box-group-title",A.name),E.classList.add("--exclude-accessibility"),E.innerText=A.title,this.tabs=[...this.tabs,E],u.append(E),E.addEventListener("click",()=>{this.selectedGroup=A.name;const O=this.tabs.find(r=>r.getAttribute("data-hs-combo-box-group-title")===this.selectedGroup);this.tabs.forEach(r=>r.classList.remove("active")),O.classList.add("active"),this.setItemsVisibility()})})}groupDefaultRender(){this.groups.forEach(s=>{const u=Wr(this.groupingTitleTemplate);u.setAttribute("data-hs-combo-box-group-title",s.name),u.classList.add("--exclude-accessibility"),u.innerText=s.title,this.itemsWrapper?this.itemsWrapper.append(u):this.output.append(u);const g=this.sortItems().filter(A=>{const{group:E}=JSON.parse(A.getAttribute("data-hs-combo-box-output-item"));return E.name===s.name});this.plainRender(g)})}itemsFromHtml(){if(this.groupingType==="default")this.groupDefaultRender();else if(this.groupingType==="tabs"){const s=this.sortItems();this.groupTabsRender(),this.plainRender(s)}else{const s=this.sortItems();this.plainRender(s)}this.setResults(this.input.value)}buildToggle(){var s,u,g,A;this.isOpened?((s=this==null?void 0:this.toggle)!=null&&s.ariaExpanded&&(this.toggle.ariaExpanded="true"),(u=this==null?void 0:this.input)!=null&&u.ariaExpanded&&(this.input.ariaExpanded="true")):((g=this==null?void 0:this.toggle)!=null&&g.ariaExpanded&&(this.toggle.ariaExpanded="false"),(A=this==null?void 0:this.input)!=null&&A.ariaExpanded&&(this.input.ariaExpanded="false")),this.toggle.addEventListener("click",()=>{this.isOpened?this.close():this.open(this.toggle.getAttribute("data-hs-combo-box-toggle"))})}buildToggleClose(){this.toggleClose.addEventListener("click",()=>this.close())}buildToggleOpen(){this.toggleOpen.addEventListener("click",()=>this.open())}setSelectedByValue(s){this.items.forEach(u=>{this.isTextExists(u,s)?u.classList.add("selected"):u.classList.remove("selected")})}setValue(s){this.selected=s,this.value=s,this.input.value=s,this.fireEvent("select",this.el),to("select.hs.combobox",this.el,this.value)}setItemsVisibility(){this.groupingType==="tabs"&&this.selectedGroup!=="all"&&this.items.forEach(u=>{u.style.display="none"});const s=this.groupingType==="tabs"?this.selectedGroup==="all"?this.items:this.items.filter(u=>{const{group:g}=JSON.parse(u.getAttribute("data-hs-combo-box-output-item"));return g.name===this.selectedGroup}):this.items;this.groupingType==="tabs"&&this.selectedGroup!=="all"&&s.forEach(u=>{u.style.display="block"}),s.forEach(u=>{this.isTextExistsAny(u,this.value)?u.style.display="block":u.style.display="none"}),this.groupingType==="default"&&this.output.querySelectorAll("[data-hs-combo-box-group-title]").forEach(u=>{const g=u.getAttribute("data-hs-combo-box-group-title");this.items.filter(E=>{const{group:O}=JSON.parse(E.getAttribute("data-hs-combo-box-output-item"));return O.name===g&&E.style.display==="block"}).length?u.style.display="block":u.style.display="none"})}hasVisibleItems(){return this.items.length?this.items.some(s=>s.style.display==="block"):!1}appendItemsToWrapper(s){this.itemsWrapper?this.itemsWrapper.append(s):this.output.append(s)}buildOutputPlaceholder(){this.outputPlaceholder||(this.outputPlaceholder=Wr(this.outputEmptyTemplate)),this.appendItemsToWrapper(this.outputPlaceholder)}destroyOutputPlaceholder(){this.outputPlaceholder&&this.outputPlaceholder.remove(),this.outputPlaceholder=null}resultItems(){if(!this.items.length)return!1;this.setItemsVisibility(),this.setSelectedByValue([this.selected])}setValueAndOpen(s){this.value=s,this.items.length&&this.setItemsVisibility()}open(s){if(this.animationInProcess||(typeof s<"u"&&this.setValueAndOpen(s),this.preventVisibility))return!1;this.animationInProcess=!0,this.output.style.display="block",this.preventAutoPosition||this.recalculateDirection(),setTimeout(()=>{var u,g;(u=this==null?void 0:this.input)!=null&&u.ariaExpanded&&(this.input.ariaExpanded="true"),(g=this==null?void 0:this.toggle)!=null&&g.ariaExpanded&&(this.toggle.ariaExpanded="true"),this.el.classList.add("active"),this.animationInProcess=!1}),this.isOpened=!0}setValueAndClear(s){s?this.setValue(s):this.setValue(this.selected),this.outputPlaceholder&&this.destroyOutputPlaceholder()}close(s){var u,g;if(this.animationInProcess)return!1;if(this.preventVisibility)return this.setValueAndClear(s),this.input.value!==""?this.el.classList.add("has-value"):this.el.classList.remove("has-value"),!1;this.animationInProcess=!0,(u=this==null?void 0:this.input)!=null&&u.ariaExpanded&&(this.input.ariaExpanded="false"),(g=this==null?void 0:this.toggle)!=null&&g.ariaExpanded&&(this.toggle.ariaExpanded="false"),this.el.classList.remove("active"),this.preventAutoPosition||(this.output.classList.remove("bottom-full","top-full"),this.output.style.marginTop="",this.output.style.marginBottom=""),vl(this.output,()=>{this.output.style.display="none",this.setValueAndClear(s),this.animationInProcess=!1}),this.input.value!==""?this.el.classList.add("has-value"):this.el.classList.remove("has-value"),this.isOpened=!1}recalculateDirection(){uy(this.output,this.input,"bottom",this.gap,this.viewport)?(this.output.classList.remove("bottom-full"),this.output.style.marginBottom="",this.output.classList.add("top-full"),this.output.style.marginTop=`${this.gap}px`):(this.output.classList.remove("top-full"),this.output.style.marginTop="",this.output.classList.add("bottom-full"),this.output.style.marginBottom=`${this.gap}px`)}static getInstance(s,u){const g=window.$hsComboBoxCollection.find(A=>A.element.el===(typeof s=="string"?document.querySelector(s):s));return g?u?g:g.element:null}static autoInit(){window.$hsComboBoxCollection||(window.$hsComboBoxCollection=[]),document.querySelectorAll("[data-hs-combo-box]:not(.--prevent-on-load-init)").forEach(s=>{if(!window.$hsComboBoxCollection.find(u=>{var g;return((g=u==null?void 0:u.element)==null?void 0:g.el)===s})){const u=s.getAttribute("data-hs-combo-box"),g=u?JSON.parse(u):{};new ql(s,g)}}),window.$hsComboBoxCollection&&(window.addEventListener("click",s=>{const u=s.target;ql.closeCurrentlyOpened(u)}),document.addEventListener("keydown",s=>ql.accessibility(s)))}static close(s){const u=window.$hsComboBoxCollection.find(g=>g.element.el===(typeof s=="string"?document.querySelector(s):s));u&&u.element.isOpened&&u.element.close()}static closeCurrentlyOpened(s=null){if(!s.closest("[data-hs-combo-box].active")){const u=window.$hsComboBoxCollection.filter(g=>g.element.isOpened)||null;u&&u.forEach(g=>{g.element.close()})}}static getPreparedItems(s=!1,u){return u?(s?Array.from(u.querySelectorAll(":scope > *:not(.--exclude-accessibility)")).filter(E=>E.style.display!=="none").reverse():Array.from(u.querySelectorAll(":scope > *:not(.--exclude-accessibility)")).filter(E=>E.style.display!=="none")).filter(E=>!E.classList.contains("disabled")):null}static setHighlighted(s,u,g){u.focus(),g.value=u.querySelector("[data-hs-combo-box-value]").getAttribute("data-hs-combo-box-search-text"),s&&s.classList.remove("hs-combo-box-output-item-highlighted"),u.classList.add("hs-combo-box-output-item-highlighted")}static accessibility(s){if(window.$hsComboBoxCollection.find(g=>g.element.preventVisibility?g.element.isCurrent:g.element.isOpened)&&_R.includes(s.code)&&!s.metaKey)switch(s.code){case"Escape":s.preventDefault(),this.onEscape();break;case"ArrowUp":s.preventDefault(),s.stopImmediatePropagation(),this.onArrow();break;case"ArrowDown":s.preventDefault(),s.stopImmediatePropagation(),this.onArrow(!1);break;case"Home":s.preventDefault(),s.stopImmediatePropagation(),this.onStartEnd();break;case"End":s.preventDefault(),s.stopImmediatePropagation(),this.onStartEnd(!1);break;case"Enter":s.preventDefault(),this.onEnter(s);break}}static onEscape(){const s=window.$hsComboBoxCollection.find(u=>!u.element.preventVisibility&&u.element.isOpened);s&&(s.element.close(),s.element.input.blur())}static onArrow(s=!0){const u=window.$hsComboBoxCollection.find(g=>g.element.preventVisibility?g.element.isCurrent:g.element.isOpened);if(u){const g=u.element.itemsWrapper??u.element.output;if(!g)return!1;const A=ql.getPreparedItems(s,g),E=g.querySelector(".hs-combo-box-output-item-highlighted");let O=null;E||A[0].classList.add("hs-combo-box-output-item-highlighted");let r=A.findIndex(U=>U===E);r+1<A.length&&r++,O=A[r],ql.setHighlighted(E,O,u.element.input)}}static onStartEnd(s=!0){const u=window.$hsComboBoxCollection.find(g=>g.element.preventVisibility?g.element.isCurrent:g.element.isOpened);if(u){const g=u.element.itemsWrapper??u.element.output;if(!g)return!1;const A=ql.getPreparedItems(s,g),E=g.querySelector(".hs-combo-box-output-item-highlighted");A.length&&ql.setHighlighted(E,A[0],u.element.input)}}static onEnter(s){const u=s.target,g=window.$hsComboBoxCollection.find(E=>!hy(E.element.el)&&s.target.closest("[data-hs-combo-box]")===E.element.el),A=g.element.el.querySelector(".hs-combo-box-output-item-highlighted a");u.hasAttribute("data-hs-combo-box-input")?(g.element.close(),u.blur()):(g.element.preventSelection||g.element.setSelectedByValue(g.element.valuesBySelector(s.target)),g.element.preventSelection&&A&&window.location.assign(A.getAttribute("href")),g.element.close(g.element.preventSelection?null:s.target.querySelector("[data-hs-combo-box-value]").getAttribute("data-hs-combo-box-search-text")))}}window.addEventListener("load",()=>{ql.autoInit()});document.addEventListener("scroll",()=>{if(!window.$hsComboBoxCollection)return!1;const d=window.$hsComboBoxCollection.find(s=>s.element.isOpened);d&&!d.element.preventAutoPosition&&d.element.recalculateDirection()});typeof window<"u"&&(window.HSComboBox=ql);var Da="top",xl="bottom",wl="right",Ra="left",dy="auto",Tp=[Da,xl,wl,Ra],Nd="start",_p="end",yR="clippingParents",tE="viewport",hp="popper",vR="reference",a2=Tp.reduce(function(d,s){return d.concat([s+"-"+Nd,s+"-"+_p])},[]),iE=[].concat(Tp,[dy]).reduce(function(d,s){return d.concat([s,s+"-"+Nd,s+"-"+_p])},[]),xR="beforeRead",wR="read",bR="afterRead",CR="beforeMain",ER="main",TR="afterMain",SR="beforeWrite",AR="write",IR="afterWrite",MR=[xR,wR,bR,CR,ER,TR,SR,AR,IR];function bc(d){return d?(d.nodeName||"").toLowerCase():null}function tl(d){if(d==null)return window;if(d.toString()!=="[object Window]"){var s=d.ownerDocument;return s&&s.defaultView||window}return d}function kh(d){var s=tl(d).Element;return d instanceof s||d instanceof Element}function yl(d){var s=tl(d).HTMLElement;return d instanceof s||d instanceof HTMLElement}function fy(d){if(typeof ShadowRoot>"u")return!1;var s=tl(d).ShadowRoot;return d instanceof s||d instanceof ShadowRoot}function LR(d){var s=d.state;Object.keys(s.elements).forEach(function(u){var g=s.styles[u]||{},A=s.attributes[u]||{},E=s.elements[u];!yl(E)||!bc(E)||(Object.assign(E.style,g),Object.keys(A).forEach(function(O){var r=A[O];r===!1?E.removeAttribute(O):E.setAttribute(O,r===!0?"":r)}))})}function OR(d){var s=d.state,u={popper:{position:s.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(s.elements.popper.style,u.popper),s.styles=u,s.elements.arrow&&Object.assign(s.elements.arrow.style,u.arrow),function(){Object.keys(s.elements).forEach(function(g){var A=s.elements[g],E=s.attributes[g]||{},O=Object.keys(s.styles.hasOwnProperty(g)?s.styles[g]:u[g]),r=O.reduce(function(U,W){return U[W]="",U},{});!yl(A)||!bc(A)||(Object.assign(A.style,r),Object.keys(E).forEach(function(U){A.removeAttribute(U)}))})}}const PR={name:"applyStyles",enabled:!0,phase:"write",fn:LR,effect:OR,requires:["computeStyles"]};function wc(d){return d.split("-")[0]}var Ph=Math.max,Zg=Math.min,Fd=Math.round;function q_(){var d=navigator.userAgentData;return d!=null&&d.brands&&Array.isArray(d.brands)?d.brands.map(function(s){return s.brand+"/"+s.version}).join(" "):navigator.userAgent}function nE(){return!/^((?!chrome|android).)*safari/i.test(q_())}function zd(d,s,u){s===void 0&&(s=!1),u===void 0&&(u=!1);var g=d.getBoundingClientRect(),A=1,E=1;s&&yl(d)&&(A=d.offsetWidth>0&&Fd(g.width)/d.offsetWidth||1,E=d.offsetHeight>0&&Fd(g.height)/d.offsetHeight||1);var O=kh(d)?tl(d):window,r=O.visualViewport,U=!nE()&&u,W=(g.left+(U&&r?r.offsetLeft:0))/A,Y=(g.top+(U&&r?r.offsetTop:0))/E,se=g.width/A,Ae=g.height/E;return{width:se,height:Ae,top:Y,right:W+se,bottom:Y+Ae,left:W,x:W,y:Y}}function py(d){var s=zd(d),u=d.offsetWidth,g=d.offsetHeight;return Math.abs(s.width-u)<=1&&(u=s.width),Math.abs(s.height-g)<=1&&(g=s.height),{x:d.offsetLeft,y:d.offsetTop,width:u,height:g}}function rE(d,s){var u=s.getRootNode&&s.getRootNode();if(d.contains(s))return!0;if(u&&fy(u)){var g=s;do{if(g&&d.isSameNode(g))return!0;g=g.parentNode||g.host}while(g)}return!1}function Jc(d){return tl(d).getComputedStyle(d)}function DR(d){return["table","td","th"].indexOf(bc(d))>=0}function Ku(d){return((kh(d)?d.ownerDocument:d.document)||window.document).documentElement}function s0(d){return bc(d)==="html"?d:d.assignedSlot||d.parentNode||(fy(d)?d.host:null)||Ku(d)}function l2(d){return!yl(d)||Jc(d).position==="fixed"?null:d.offsetParent}function RR(d){var s=/firefox/i.test(q_()),u=/Trident/i.test(q_());if(u&&yl(d)){var g=Jc(d);if(g.position==="fixed")return null}var A=s0(d);for(fy(A)&&(A=A.host);yl(A)&&["html","body"].indexOf(bc(A))<0;){var E=Jc(A);if(E.transform!=="none"||E.perspective!=="none"||E.contain==="paint"||["transform","perspective"].indexOf(E.willChange)!==-1||s&&E.willChange==="filter"||s&&E.filter&&E.filter!=="none")return A;A=A.parentNode}return null}function Sp(d){for(var s=tl(d),u=l2(d);u&&DR(u)&&Jc(u).position==="static";)u=l2(u);return u&&(bc(u)==="html"||bc(u)==="body"&&Jc(u).position==="static")?s:u||RR(d)||s}function my(d){return["top","bottom"].indexOf(d)>=0?"x":"y"}function dp(d,s,u){return Ph(d,Zg(s,u))}function kR(d,s,u){var g=dp(d,s,u);return g>u?u:g}function oE(){return{top:0,right:0,bottom:0,left:0}}function sE(d){return Object.assign({},oE(),d)}function aE(d,s){return s.reduce(function(u,g){return u[g]=d,u},{})}var BR=function(s,u){return s=typeof s=="function"?s(Object.assign({},u.rects,{placement:u.placement})):s,sE(typeof s!="number"?s:aE(s,Tp))};function NR(d){var s,u=d.state,g=d.name,A=d.options,E=u.elements.arrow,O=u.modifiersData.popperOffsets,r=wc(u.placement),U=my(r),W=[Ra,wl].indexOf(r)>=0,Y=W?"height":"width";if(!(!E||!O)){var se=BR(A.padding,u),Ae=py(E),Ce=U==="y"?Da:Ra,he=U==="y"?xl:wl,K=u.rects.reference[Y]+u.rects.reference[U]-O[U]-u.rects.popper[Y],N=O[U]-u.rects.reference[U],z=Sp(E),q=z?U==="y"?z.clientHeight||0:z.clientWidth||0:0,G=K/2-N/2,Q=se[Ce],ee=q-Ae[Y]-se[he],fe=q/2-Ae[Y]/2+G,ce=dp(Q,fe,ee),Ue=U;u.modifiersData[g]=(s={},s[Ue]=ce,s.centerOffset=ce-fe,s)}}function FR(d){var s=d.state,u=d.options,g=u.element,A=g===void 0?"[data-popper-arrow]":g;A!=null&&(typeof A=="string"&&(A=s.elements.popper.querySelector(A),!A)||rE(s.elements.popper,A)&&(s.elements.arrow=A))}const zR={name:"arrow",enabled:!0,phase:"main",fn:NR,effect:FR,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Vd(d){return d.split("-")[1]}var VR={top:"auto",right:"auto",bottom:"auto",left:"auto"};function UR(d,s){var u=d.x,g=d.y,A=s.devicePixelRatio||1;return{x:Fd(u*A)/A||0,y:Fd(g*A)/A||0}}function c2(d){var s,u=d.popper,g=d.popperRect,A=d.placement,E=d.variation,O=d.offsets,r=d.position,U=d.gpuAcceleration,W=d.adaptive,Y=d.roundOffsets,se=d.isFixed,Ae=O.x,Ce=Ae===void 0?0:Ae,he=O.y,K=he===void 0?0:he,N=typeof Y=="function"?Y({x:Ce,y:K}):{x:Ce,y:K};Ce=N.x,K=N.y;var z=O.hasOwnProperty("x"),q=O.hasOwnProperty("y"),G=Ra,Q=Da,ee=window;if(W){var fe=Sp(u),ce="clientHeight",Ue="clientWidth";if(fe===tl(u)&&(fe=Ku(u),Jc(fe).position!=="static"&&r==="absolute"&&(ce="scrollHeight",Ue="scrollWidth")),fe=fe,A===Da||(A===Ra||A===wl)&&E===_p){Q=xl;var He=se&&fe===ee&&ee.visualViewport?ee.visualViewport.height:fe[ce];K-=He-g.height,K*=U?1:-1}if(A===Ra||(A===Da||A===xl)&&E===_p){G=wl;var nt=se&&fe===ee&&ee.visualViewport?ee.visualViewport.width:fe[Ue];Ce-=nt-g.width,Ce*=U?1:-1}}var vt=Object.assign({position:r},W&&VR),xt=Y===!0?UR({x:Ce,y:K},tl(u)):{x:Ce,y:K};if(Ce=xt.x,K=xt.y,U){var Ot;return Object.assign({},vt,(Ot={},Ot[Q]=q?"0":"",Ot[G]=z?"0":"",Ot.transform=(ee.devicePixelRatio||1)<=1?"translate("+Ce+"px, "+K+"px)":"translate3d("+Ce+"px, "+K+"px, 0)",Ot))}return Object.assign({},vt,(s={},s[Q]=q?K+"px":"",s[G]=z?Ce+"px":"",s.transform="",s))}function jR(d){var s=d.state,u=d.options,g=u.gpuAcceleration,A=g===void 0?!0:g,E=u.adaptive,O=E===void 0?!0:E,r=u.roundOffsets,U=r===void 0?!0:r,W={placement:wc(s.placement),variation:Vd(s.placement),popper:s.elements.popper,popperRect:s.rects.popper,gpuAcceleration:A,isFixed:s.options.strategy==="fixed"};s.modifiersData.popperOffsets!=null&&(s.styles.popper=Object.assign({},s.styles.popper,c2(Object.assign({},W,{offsets:s.modifiersData.popperOffsets,position:s.options.strategy,adaptive:O,roundOffsets:U})))),s.modifiersData.arrow!=null&&(s.styles.arrow=Object.assign({},s.styles.arrow,c2(Object.assign({},W,{offsets:s.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:U})))),s.attributes.popper=Object.assign({},s.attributes.popper,{"data-popper-placement":s.placement})}const qR={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:jR,data:{}};var Cg={passive:!0};function HR(d){var s=d.state,u=d.instance,g=d.options,A=g.scroll,E=A===void 0?!0:A,O=g.resize,r=O===void 0?!0:O,U=tl(s.elements.popper),W=[].concat(s.scrollParents.reference,s.scrollParents.popper);return E&&W.forEach(function(Y){Y.addEventListener("scroll",u.update,Cg)}),r&&U.addEventListener("resize",u.update,Cg),function(){E&&W.forEach(function(Y){Y.removeEventListener("scroll",u.update,Cg)}),r&&U.removeEventListener("resize",u.update,Cg)}}const GR={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:HR,data:{}};var WR={left:"right",right:"left",bottom:"top",top:"bottom"};function Dg(d){return d.replace(/left|right|bottom|top/g,function(s){return WR[s]})}var $R={start:"end",end:"start"};function u2(d){return d.replace(/start|end/g,function(s){return $R[s]})}function gy(d){var s=tl(d),u=s.pageXOffset,g=s.pageYOffset;return{scrollLeft:u,scrollTop:g}}function _y(d){return zd(Ku(d)).left+gy(d).scrollLeft}function ZR(d,s){var u=tl(d),g=Ku(d),A=u.visualViewport,E=g.clientWidth,O=g.clientHeight,r=0,U=0;if(A){E=A.width,O=A.height;var W=nE();(W||!W&&s==="fixed")&&(r=A.offsetLeft,U=A.offsetTop)}return{width:E,height:O,x:r+_y(d),y:U}}function XR(d){var s,u=Ku(d),g=gy(d),A=(s=d.ownerDocument)==null?void 0:s.body,E=Ph(u.scrollWidth,u.clientWidth,A?A.scrollWidth:0,A?A.clientWidth:0),O=Ph(u.scrollHeight,u.clientHeight,A?A.scrollHeight:0,A?A.clientHeight:0),r=-g.scrollLeft+_y(d),U=-g.scrollTop;return Jc(A||u).direction==="rtl"&&(r+=Ph(u.clientWidth,A?A.clientWidth:0)-E),{width:E,height:O,x:r,y:U}}function yy(d){var s=Jc(d),u=s.overflow,g=s.overflowX,A=s.overflowY;return/auto|scroll|overlay|hidden/.test(u+A+g)}function lE(d){return["html","body","#document"].indexOf(bc(d))>=0?d.ownerDocument.body:yl(d)&&yy(d)?d:lE(s0(d))}function fp(d,s){var u;s===void 0&&(s=[]);var g=lE(d),A=g===((u=d.ownerDocument)==null?void 0:u.body),E=tl(g),O=A?[E].concat(E.visualViewport||[],yy(g)?g:[]):g,r=s.concat(O);return A?r:r.concat(fp(s0(O)))}function H_(d){return Object.assign({},d,{left:d.x,top:d.y,right:d.x+d.width,bottom:d.y+d.height})}function YR(d,s){var u=zd(d,!1,s==="fixed");return u.top=u.top+d.clientTop,u.left=u.left+d.clientLeft,u.bottom=u.top+d.clientHeight,u.right=u.left+d.clientWidth,u.width=d.clientWidth,u.height=d.clientHeight,u.x=u.left,u.y=u.top,u}function h2(d,s,u){return s===tE?H_(ZR(d,u)):kh(s)?YR(s,u):H_(XR(Ku(d)))}function KR(d){var s=fp(s0(d)),u=["absolute","fixed"].indexOf(Jc(d).position)>=0,g=u&&yl(d)?Sp(d):d;return kh(g)?s.filter(function(A){return kh(A)&&rE(A,g)&&bc(A)!=="body"}):[]}function QR(d,s,u,g){var A=s==="clippingParents"?KR(d):[].concat(s),E=[].concat(A,[u]),O=E[0],r=E.reduce(function(U,W){var Y=h2(d,W,g);return U.top=Ph(Y.top,U.top),U.right=Zg(Y.right,U.right),U.bottom=Zg(Y.bottom,U.bottom),U.left=Ph(Y.left,U.left),U},h2(d,O,g));return r.width=r.right-r.left,r.height=r.bottom-r.top,r.x=r.left,r.y=r.top,r}function cE(d){var s=d.reference,u=d.element,g=d.placement,A=g?wc(g):null,E=g?Vd(g):null,O=s.x+s.width/2-u.width/2,r=s.y+s.height/2-u.height/2,U;switch(A){case Da:U={x:O,y:s.y-u.height};break;case xl:U={x:O,y:s.y+s.height};break;case wl:U={x:s.x+s.width,y:r};break;case Ra:U={x:s.x-u.width,y:r};break;default:U={x:s.x,y:s.y}}var W=A?my(A):null;if(W!=null){var Y=W==="y"?"height":"width";switch(E){case Nd:U[W]=U[W]-(s[Y]/2-u[Y]/2);break;case _p:U[W]=U[W]+(s[Y]/2-u[Y]/2);break}}return U}function yp(d,s){s===void 0&&(s={});var u=s,g=u.placement,A=g===void 0?d.placement:g,E=u.strategy,O=E===void 0?d.strategy:E,r=u.boundary,U=r===void 0?yR:r,W=u.rootBoundary,Y=W===void 0?tE:W,se=u.elementContext,Ae=se===void 0?hp:se,Ce=u.altBoundary,he=Ce===void 0?!1:Ce,K=u.padding,N=K===void 0?0:K,z=sE(typeof N!="number"?N:aE(N,Tp)),q=Ae===hp?vR:hp,G=d.rects.popper,Q=d.elements[he?q:Ae],ee=QR(kh(Q)?Q:Q.contextElement||Ku(d.elements.popper),U,Y,O),fe=zd(d.elements.reference),ce=cE({reference:fe,element:G,strategy:"absolute",placement:A}),Ue=H_(Object.assign({},G,ce)),He=Ae===hp?Ue:fe,nt={top:ee.top-He.top+z.top,bottom:He.bottom-ee.bottom+z.bottom,left:ee.left-He.left+z.left,right:He.right-ee.right+z.right},vt=d.modifiersData.offset;if(Ae===hp&&vt){var xt=vt[A];Object.keys(nt).forEach(function(Ot){var Ui=[wl,xl].indexOf(Ot)>=0?1:-1,Mt=[Da,xl].indexOf(Ot)>=0?"y":"x";nt[Ot]+=xt[Mt]*Ui})}return nt}function JR(d,s){s===void 0&&(s={});var u=s,g=u.placement,A=u.boundary,E=u.rootBoundary,O=u.padding,r=u.flipVariations,U=u.allowedAutoPlacements,W=U===void 0?iE:U,Y=Vd(g),se=Y?r?a2:a2.filter(function(he){return Vd(he)===Y}):Tp,Ae=se.filter(function(he){return W.indexOf(he)>=0});Ae.length===0&&(Ae=se);var Ce=Ae.reduce(function(he,K){return he[K]=yp(d,{placement:K,boundary:A,rootBoundary:E,padding:O})[wc(K)],he},{});return Object.keys(Ce).sort(function(he,K){return Ce[he]-Ce[K]})}function ek(d){if(wc(d)===dy)return[];var s=Dg(d);return[u2(d),s,u2(s)]}function tk(d){var s=d.state,u=d.options,g=d.name;if(!s.modifiersData[g]._skip){for(var A=u.mainAxis,E=A===void 0?!0:A,O=u.altAxis,r=O===void 0?!0:O,U=u.fallbackPlacements,W=u.padding,Y=u.boundary,se=u.rootBoundary,Ae=u.altBoundary,Ce=u.flipVariations,he=Ce===void 0?!0:Ce,K=u.allowedAutoPlacements,N=s.options.placement,z=wc(N),q=z===N,G=U||(q||!he?[Dg(N)]:ek(N)),Q=[N].concat(G).reduce(function(fn,At){return fn.concat(wc(At)===dy?JR(s,{placement:At,boundary:Y,rootBoundary:se,padding:W,flipVariations:he,allowedAutoPlacements:K}):At)},[]),ee=s.rects.reference,fe=s.rects.popper,ce=new Map,Ue=!0,He=Q[0],nt=0;nt<Q.length;nt++){var vt=Q[nt],xt=wc(vt),Ot=Vd(vt)===Nd,Ui=[Da,xl].indexOf(xt)>=0,Mt=Ui?"width":"height",_i=yp(s,{placement:vt,boundary:Y,rootBoundary:se,altBoundary:Ae,padding:W}),di=Ui?Ot?wl:Ra:Ot?xl:Da;ee[Mt]>fe[Mt]&&(di=Dg(di));var Un=Dg(di),Nn=[];if(E&&Nn.push(_i[xt]<=0),r&&Nn.push(_i[di]<=0,_i[Un]<=0),Nn.every(function(fn){return fn})){He=vt,Ue=!1;break}ce.set(vt,Nn)}if(Ue)for(var Vi=he?3:1,Vr=function(At){var Ri=Q.find(function(Lr){var si=ce.get(Lr);if(si)return si.slice(0,At).every(function(zi){return zi})});if(Ri)return He=Ri,"break"},Oi=Vi;Oi>0;Oi--){var ir=Vr(Oi);if(ir==="break")break}s.placement!==He&&(s.modifiersData[g]._skip=!0,s.placement=He,s.reset=!0)}}const ik={name:"flip",enabled:!0,phase:"main",fn:tk,requiresIfExists:["offset"],data:{_skip:!1}};function d2(d,s,u){return u===void 0&&(u={x:0,y:0}),{top:d.top-s.height-u.y,right:d.right-s.width+u.x,bottom:d.bottom-s.height+u.y,left:d.left-s.width-u.x}}function f2(d){return[Da,wl,xl,Ra].some(function(s){return d[s]>=0})}function nk(d){var s=d.state,u=d.name,g=s.rects.reference,A=s.rects.popper,E=s.modifiersData.preventOverflow,O=yp(s,{elementContext:"reference"}),r=yp(s,{altBoundary:!0}),U=d2(O,g),W=d2(r,A,E),Y=f2(U),se=f2(W);s.modifiersData[u]={referenceClippingOffsets:U,popperEscapeOffsets:W,isReferenceHidden:Y,hasPopperEscaped:se},s.attributes.popper=Object.assign({},s.attributes.popper,{"data-popper-reference-hidden":Y,"data-popper-escaped":se})}const rk={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:nk};function ok(d,s,u){var g=wc(d),A=[Ra,Da].indexOf(g)>=0?-1:1,E=typeof u=="function"?u(Object.assign({},s,{placement:d})):u,O=E[0],r=E[1];return O=O||0,r=(r||0)*A,[Ra,wl].indexOf(g)>=0?{x:r,y:O}:{x:O,y:r}}function sk(d){var s=d.state,u=d.options,g=d.name,A=u.offset,E=A===void 0?[0,0]:A,O=iE.reduce(function(Y,se){return Y[se]=ok(se,s.rects,E),Y},{}),r=O[s.placement],U=r.x,W=r.y;s.modifiersData.popperOffsets!=null&&(s.modifiersData.popperOffsets.x+=U,s.modifiersData.popperOffsets.y+=W),s.modifiersData[g]=O}const ak={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:sk};function lk(d){var s=d.state,u=d.name;s.modifiersData[u]=cE({reference:s.rects.reference,element:s.rects.popper,strategy:"absolute",placement:s.placement})}const ck={name:"popperOffsets",enabled:!0,phase:"read",fn:lk,data:{}};function uk(d){return d==="x"?"y":"x"}function hk(d){var s=d.state,u=d.options,g=d.name,A=u.mainAxis,E=A===void 0?!0:A,O=u.altAxis,r=O===void 0?!1:O,U=u.boundary,W=u.rootBoundary,Y=u.altBoundary,se=u.padding,Ae=u.tether,Ce=Ae===void 0?!0:Ae,he=u.tetherOffset,K=he===void 0?0:he,N=yp(s,{boundary:U,rootBoundary:W,padding:se,altBoundary:Y}),z=wc(s.placement),q=Vd(s.placement),G=!q,Q=my(z),ee=uk(Q),fe=s.modifiersData.popperOffsets,ce=s.rects.reference,Ue=s.rects.popper,He=typeof K=="function"?K(Object.assign({},s.rects,{placement:s.placement})):K,nt=typeof He=="number"?{mainAxis:He,altAxis:He}:Object.assign({mainAxis:0,altAxis:0},He),vt=s.modifiersData.offset?s.modifiersData.offset[s.placement]:null,xt={x:0,y:0};if(fe){if(E){var Ot,Ui=Q==="y"?Da:Ra,Mt=Q==="y"?xl:wl,_i=Q==="y"?"height":"width",di=fe[Q],Un=di+N[Ui],Nn=di-N[Mt],Vi=Ce?-Ue[_i]/2:0,Vr=q===Nd?ce[_i]:Ue[_i],Oi=q===Nd?-Ue[_i]:-ce[_i],ir=s.elements.arrow,fn=Ce&&ir?py(ir):{width:0,height:0},At=s.modifiersData["arrow#persistent"]?s.modifiersData["arrow#persistent"].padding:oE(),Ri=At[Ui],Lr=At[Mt],si=dp(0,ce[_i],fn[_i]),zi=G?ce[_i]/2-Vi-si-Ri-nt.mainAxis:Vr-si-Ri-nt.mainAxis,Qi=G?-ce[_i]/2+Vi+si+Lr+nt.mainAxis:Oi+si+Lr+nt.mainAxis,Sn=s.elements.arrow&&Sp(s.elements.arrow),Co=Sn?Q==="y"?Sn.clientTop||0:Sn.clientLeft||0:0,fi=(Ot=vt==null?void 0:vt[Q])!=null?Ot:0,$r=di+zi-fi-Co,Or=di+Qi-fi,Hi=dp(Ce?Zg(Un,$r):Un,di,Ce?Ph(Nn,Or):Nn);fe[Q]=Hi,xt[Q]=Hi-di}if(r){var Hn,Fn=Q==="x"?Da:Ra,ti=Q==="x"?xl:wl,Ii=fe[ee],wi=ee==="y"?"height":"width",on=Ii+N[Fn],Do=Ii-N[ti],so=[Da,Ra].indexOf(z)!==-1,Go=(Hn=vt==null?void 0:vt[ee])!=null?Hn:0,Pr=so?on:Ii-ce[wi]-Ue[wi]-Go+nt.altAxis,Ro=so?Ii+ce[wi]+Ue[wi]-Go-nt.altAxis:Do,ao=Ce&&so?kR(Pr,Ii,Ro):dp(Ce?Pr:on,Ii,Ce?Ro:Do);fe[ee]=ao,xt[ee]=ao-Ii}s.modifiersData[g]=xt}}const dk={name:"preventOverflow",enabled:!0,phase:"main",fn:hk,requiresIfExists:["offset"]};function fk(d){return{scrollLeft:d.scrollLeft,scrollTop:d.scrollTop}}function pk(d){return d===tl(d)||!yl(d)?gy(d):fk(d)}function mk(d){var s=d.getBoundingClientRect(),u=Fd(s.width)/d.offsetWidth||1,g=Fd(s.height)/d.offsetHeight||1;return u!==1||g!==1}function gk(d,s,u){u===void 0&&(u=!1);var g=yl(s),A=yl(s)&&mk(s),E=Ku(s),O=zd(d,A,u),r={scrollLeft:0,scrollTop:0},U={x:0,y:0};return(g||!g&&!u)&&((bc(s)!=="body"||yy(E))&&(r=pk(s)),yl(s)?(U=zd(s,!0),U.x+=s.clientLeft,U.y+=s.clientTop):E&&(U.x=_y(E))),{x:O.left+r.scrollLeft-U.x,y:O.top+r.scrollTop-U.y,width:O.width,height:O.height}}function _k(d){var s=new Map,u=new Set,g=[];d.forEach(function(E){s.set(E.name,E)});function A(E){u.add(E.name);var O=[].concat(E.requires||[],E.requiresIfExists||[]);O.forEach(function(r){if(!u.has(r)){var U=s.get(r);U&&A(U)}}),g.push(E)}return d.forEach(function(E){u.has(E.name)||A(E)}),g}function yk(d){var s=_k(d);return MR.reduce(function(u,g){return u.concat(s.filter(function(A){return A.phase===g}))},[])}function vk(d){var s;return function(){return s||(s=new Promise(function(u){Promise.resolve().then(function(){s=void 0,u(d())})})),s}}function xk(d){var s=d.reduce(function(u,g){var A=u[g.name];return u[g.name]=A?Object.assign({},A,g,{options:Object.assign({},A.options,g.options),data:Object.assign({},A.data,g.data)}):g,u},{});return Object.keys(s).map(function(u){return s[u]})}var p2={placement:"bottom",modifiers:[],strategy:"absolute"};function m2(){for(var d=arguments.length,s=new Array(d),u=0;u<d;u++)s[u]=arguments[u];return!s.some(function(g){return!(g&&typeof g.getBoundingClientRect=="function")})}function wk(d){d===void 0&&(d={});var s=d,u=s.defaultModifiers,g=u===void 0?[]:u,A=s.defaultOptions,E=A===void 0?p2:A;return function(r,U,W){W===void 0&&(W=E);var Y={placement:"bottom",orderedModifiers:[],options:Object.assign({},p2,E),modifiersData:{},elements:{reference:r,popper:U},attributes:{},styles:{}},se=[],Ae=!1,Ce={state:Y,setOptions:function(z){var q=typeof z=="function"?z(Y.options):z;K(),Y.options=Object.assign({},E,Y.options,q),Y.scrollParents={reference:kh(r)?fp(r):r.contextElement?fp(r.contextElement):[],popper:fp(U)};var G=yk(xk([].concat(g,Y.options.modifiers)));return Y.orderedModifiers=G.filter(function(Q){return Q.enabled}),he(),Ce.update()},forceUpdate:function(){if(!Ae){var z=Y.elements,q=z.reference,G=z.popper;if(m2(q,G)){Y.rects={reference:gk(q,Sp(G),Y.options.strategy==="fixed"),popper:py(G)},Y.reset=!1,Y.placement=Y.options.placement,Y.orderedModifiers.forEach(function(nt){return Y.modifiersData[nt.name]=Object.assign({},nt.data)});for(var Q=0;Q<Y.orderedModifiers.length;Q++){if(Y.reset===!0){Y.reset=!1,Q=-1;continue}var ee=Y.orderedModifiers[Q],fe=ee.fn,ce=ee.options,Ue=ce===void 0?{}:ce,He=ee.name;typeof fe=="function"&&(Y=fe({state:Y,options:Ue,name:He,instance:Ce})||Y)}}}},update:vk(function(){return new Promise(function(N){Ce.forceUpdate(),N(Y)})}),destroy:function(){K(),Ae=!0}};if(!m2(r,U))return Ce;Ce.setOptions(W).then(function(N){!Ae&&W.onFirstUpdate&&W.onFirstUpdate(N)});function he(){Y.orderedModifiers.forEach(function(N){var z=N.name,q=N.options,G=q===void 0?{}:q,Q=N.effect;if(typeof Q=="function"){var ee=Q({state:Y,name:z,instance:Ce,options:G}),fe=function(){};se.push(ee||fe)}})}function K(){se.forEach(function(N){return N()}),se=[]}return Ce}}var bk=[GR,ck,qR,PR,ak,ik,dk,zR,rk],uE=wk({defaultModifiers:bk});/*
 * HSDropdown
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class Wu extends as{constructor(s,u,g){super(s,u,g),this.toggle=this.el.querySelector(":scope > .hs-dropdown-toggle")||this.el.querySelector(":scope > .hs-dropdown-toggle-wrapper > .hs-dropdown-toggle")||this.el.children[0],this.closers=Array.from(this.el.querySelectorAll(":scope .hs-dropdown-close"))||null,this.menu=this.el.querySelector(":scope > .hs-dropdown-menu"),this.eventMode=Ho(this.el,"--trigger","click"),this.closeMode=Ho(this.el,"--auto-close","true"),this.animationInProcess=!1,this.toggle&&this.menu&&this.init()}init(){if(this.createCollection(window.$hsDropdownCollection,this),this.toggle.disabled)return!1;this.toggle&&this.buildToggle(),this.menu&&this.buildMenu(),this.closers&&this.buildClosers(),!uR()&&!hR()&&(this.el.addEventListener("mouseenter",()=>this.onMouseEnterHandler()),this.el.addEventListener("mouseleave",()=>this.onMouseLeaveHandler()))}resizeHandler(){this.eventMode=Ho(this.el,"--trigger","click"),this.closeMode=Ho(this.el,"--auto-close","true")}buildToggle(){var s;(s=this==null?void 0:this.toggle)!=null&&s.ariaExpanded&&(this.el.classList.contains("open")?this.toggle.ariaExpanded="true":this.toggle.ariaExpanded="false"),this.toggle.addEventListener("click",u=>this.onClickHandler(u))}buildMenu(){this.menu.role="menu"}buildClosers(){this.closers.forEach(s=>{s.addEventListener("click",()=>this.close())})}onClickHandler(s){this.el.classList.contains("open")&&!this.menu.classList.contains("hidden")?this.close():this.open()}onMouseEnterHandler(){if(this.eventMode!=="hover")return!1;this.el._popper&&this.forceClearState(),!this.el.classList.contains("open")&&this.menu.classList.contains("hidden")&&this.open()}onMouseLeaveHandler(){if(this.eventMode!=="hover")return!1;this.el.classList.contains("open")&&!this.menu.classList.contains("hidden")&&this.close()}destroyPopper(){this.menu.classList.remove("block"),this.menu.classList.add("hidden"),this.menu.style.inset=null,this.menu.style.position=null,this.el&&this.el._popper&&this.el._popper.destroy(),this.animationInProcess=!1}absoluteStrategyModifiers(){return[{name:"applyStyles",fn:s=>{const u=(window.getComputedStyle(this.el).getPropertyValue("--strategy")||"absolute").replace(" ",""),g=(window.getComputedStyle(this.el).getPropertyValue("--adaptive")||"adaptive").replace(" ","");s.state.elements.popper.style.position=u,s.state.elements.popper.style.transform=g==="adaptive"?s.state.styles.popper.transform:null,s.state.elements.popper.style.top=null,s.state.elements.popper.style.bottom=null,s.state.elements.popper.style.left=null,s.state.elements.popper.style.right=null,s.state.elements.popper.style.margin=0}}]}open(){if(this.el.classList.contains("open")||this.animationInProcess)return!1;this.animationInProcess=!0;const s=(window.getComputedStyle(this.el).getPropertyValue("--placement")||"").replace(" ",""),u=(window.getComputedStyle(this.el).getPropertyValue("--flip")||"true").replace(" ",""),g=(window.getComputedStyle(this.el).getPropertyValue("--strategy")||"fixed").replace(" ",""),A=parseInt((window.getComputedStyle(this.el).getPropertyValue("--offset")||"10").replace(" ","")),E=(window.getComputedStyle(this.el).getPropertyValue("--gpu-acceleration")||"true").replace(" ","");g!=="static"&&(this.el._popper=uE(this.el,this.menu,{placement:eE[s]||"bottom-start",strategy:g,modifiers:[...g!=="fixed"?this.absoluteStrategyModifiers():[],{name:"flip",enabled:u==="true"},{name:"offset",options:{offset:[0,A]}},{name:"computeStyles",options:{adaptive:g==="fixed",gpuAcceleration:E==="true"}}]})),this.menu.style.margin=null,this.menu.classList.remove("hidden"),this.menu.classList.add("block"),setTimeout(()=>{var O;(O=this==null?void 0:this.toggle)!=null&&O.ariaExpanded&&(this.toggle.ariaExpanded="true"),this.el.classList.add("open"),this.animationInProcess=!1}),this.fireEvent("open",this.el),to("open.hs.dropdown",this.el,this.el)}close(s=!0){if(this.animationInProcess||!this.el.classList.contains("open"))return!1;const u=()=>{var g;this.menu.style.margin=null,(g=this==null?void 0:this.toggle)!=null&&g.ariaExpanded&&(this.toggle.ariaExpanded="false"),this.el.classList.remove("open"),this.fireEvent("close",this.el),to("close.hs.dropdown",this.el,this.el)};if(this.animationInProcess=!0,s){const g=this.el.querySelector("[data-hs-dropdown-transition]")||this.menu;vl(g,()=>this.destroyPopper())}else this.destroyPopper();u()}forceClearState(){this.destroyPopper(),this.menu.style.margin=null,this.el.classList.remove("open")}static getInstance(s,u){const g=window.$hsDropdownCollection.find(A=>A.element.el===(typeof s=="string"?document.querySelector(s):s));return g?u?g:g.element.el:null}static autoInit(){if(window.$hsDropdownCollection||(window.$hsDropdownCollection=[]),document.querySelectorAll(".hs-dropdown:not(.--prevent-on-load-init)").forEach(s=>{window.$hsDropdownCollection.find(u=>{var g;return((g=u==null?void 0:u.element)==null?void 0:g.el)===s})||new Wu(s)}),window.$hsDropdownCollection){document.addEventListener("keydown",u=>Wu.accessibility(u)),window.addEventListener("click",u=>{const g=u.target;Wu.closeCurrentlyOpened(g)});let s=window.innerWidth;window.addEventListener("resize",()=>{window.innerWidth!==s&&(s=innerWidth,Wu.closeCurrentlyOpened(null,!1))})}}static open(s){const u=window.$hsDropdownCollection.find(g=>g.element.el===(typeof s=="string"?document.querySelector(s):s));u&&u.element.menu.classList.contains("hidden")&&u.element.open()}static close(s){const u=window.$hsDropdownCollection.find(g=>g.element.el===(typeof s=="string"?document.querySelector(s):s));u&&!u.element.menu.classList.contains("hidden")&&u.element.close()}static accessibility(s){this.history=fR;const u=window.$hsDropdownCollection.find(g=>g.element.el.classList.contains("open"));if(u&&(pR.includes(s.code)||s.code.length===4&&s.code[s.code.length-1].match(/^[A-Z]*$/))&&!s.metaKey&&!u.element.menu.querySelector("input:focus")&&!u.element.menu.querySelector("textarea:focus"))switch(s.code){case"Escape":u.element.menu.querySelector(".hs-select.active")||(s.preventDefault(),this.onEscape(s));break;case"Enter":!u.element.menu.querySelector(".hs-select button:focus")&&!u.element.menu.querySelector(".hs-collapse-toggle:focus")&&this.onEnter(s);break;case"ArrowUp":s.preventDefault(),s.stopImmediatePropagation(),this.onArrow();break;case"ArrowDown":s.preventDefault(),s.stopImmediatePropagation(),this.onArrow(!1);break;case"Home":s.preventDefault(),s.stopImmediatePropagation(),this.onStartEnd();break;case"End":s.preventDefault(),s.stopImmediatePropagation(),this.onStartEnd(!1);break;default:s.preventDefault(),this.onFirstLetter(s.key);break}}static onEscape(s){const u=s.target.closest(".hs-dropdown.open");if(window.$hsDropdownCollection.find(g=>g.element.el===u)){const g=window.$hsDropdownCollection.find(A=>A.element.el===u);g&&(g.element.close(),g.element.toggle.focus())}else this.closeCurrentlyOpened()}static onEnter(s){const u=s.target.parentElement;if(window.$hsDropdownCollection.find(g=>g.element.el===u)){s.preventDefault();const g=window.$hsDropdownCollection.find(A=>A.element.el===u);g&&g.element.open()}}static onArrow(s=!0){const u=window.$hsDropdownCollection.find(g=>g.element.el.classList.contains("open"));if(u){const g=u.element.menu;if(!g)return!1;const E=(s?Array.from(g.querySelectorAll("a:not([hidden]), .hs-dropdown > button:not([hidden])")).reverse():Array.from(g.querySelectorAll("a:not([hidden]), .hs-dropdown > button:not([hidden])"))).filter(U=>!U.classList.contains("disabled")),O=g.querySelector("a:focus, button:focus");let r=E.findIndex(U=>U===O);r+1<E.length&&r++,E[r].focus()}}static onStartEnd(s=!0){const u=window.$hsDropdownCollection.find(g=>g.element.el.classList.contains("open"));if(u){const g=u.element.menu;if(!g)return!1;const E=(s?Array.from(g.querySelectorAll("a")):Array.from(g.querySelectorAll("a")).reverse()).filter(O=>!O.classList.contains("disabled"));E.length&&E[0].focus()}}static onFirstLetter(s){const u=window.$hsDropdownCollection.find(g=>g.element.el.classList.contains("open"));if(u){const g=u.element.menu;if(!g)return!1;const A=Array.from(g.querySelectorAll("a")),E=()=>A.findIndex((r,U)=>r.innerText.toLowerCase().charAt(0)===s.toLowerCase()&&this.history.existsInHistory(U));let O=E();O===-1&&(this.history.clearHistory(),O=E()),O!==-1&&(A[O].focus(),this.history.addHistory(O))}}static closeCurrentlyOpened(s=null,u=!0){const g=s&&s.closest(".hs-dropdown")&&s.closest(".hs-dropdown").parentElement.closest(".hs-dropdown")?s.closest(".hs-dropdown").parentElement.closest(".hs-dropdown"):null;let A=g?window.$hsDropdownCollection.filter(E=>E.element.el.classList.contains("open")&&E.element.menu.closest(".hs-dropdown").parentElement.closest(".hs-dropdown")===g):window.$hsDropdownCollection.filter(E=>E.element.el.classList.contains("open"));s&&s.closest(".hs-dropdown")&&cR(s.closest(".hs-dropdown"),"--auto-close")==="inside"&&(A=A.filter(E=>E.element.el!==s.closest(".hs-dropdown"))),A&&A.forEach(E=>{if(E.element.closeMode==="false"||E.element.closeMode==="outside")return!1;E.element.close(u)})}static on(s,u,g){const A=window.$hsDropdownCollection.find(E=>E.element.el===(typeof u=="string"?document.querySelector(u):u));A&&(A.element.events[s]=g)}}window.addEventListener("load",()=>{Wu.autoInit()});window.addEventListener("resize",()=>{window.$hsDropdownCollection||(window.$hsDropdownCollection=[]),window.$hsDropdownCollection.forEach(d=>d.element.resizeHandler())});typeof window<"u"&&(window.HSDropdown=Wu);/*
 * HSInputNumber
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class Ap extends as{constructor(s,u){super(s,u),this.input=this.el.querySelector("[data-hs-input-number-input]")||null,this.increment=this.el.querySelector("[data-hs-input-number-increment]")||null,this.decrement=this.el.querySelector("[data-hs-input-number-decrement]")||null,this.input&&this.checkIsNumberAndConvert();const g=this.el.dataset.hsInputNumber,E={...g?JSON.parse(g):{step:1},...u};this.minInputValue="min"in E?E.min:0,this.maxInputValue="max"in E?E.max:null,this.step="step"in E&&E.step>0?E.step:1,this.init()}init(){this.createCollection(window.$hsInputNumberCollection,this),this.input&&this.increment&&this.build()}checkIsNumberAndConvert(){const s=this.input.value.trim(),u=this.cleanAndExtractNumber(s);u!==null?(this.inputValue=u,this.input.value=u.toString()):(this.inputValue=0,this.input.value="0")}cleanAndExtractNumber(s){const u=[];let g=!1;s.split("").forEach(O=>{O>="0"&&O<="9"?u.push(O):O==="."&&!g&&(u.push(O),g=!0)});const A=u.join(""),E=parseFloat(A);return isNaN(E)?null:E}build(){this.input&&this.buildInput(),this.increment&&this.buildIncrement(),this.decrement&&this.buildDecrement(),this.inputValue<=0&&this.minInputValue===0&&(this.inputValue=0,this.input.value="0"),(this.inputValue<=0||this.minInputValue<0)&&this.changeValue(),this.input.hasAttribute("disabled")&&this.disableButtons()}buildInput(){this.input.addEventListener("input",()=>this.changeValue())}buildIncrement(){this.increment.addEventListener("click",()=>{this.changeValue("increment")})}buildDecrement(){this.decrement.addEventListener("click",()=>{this.changeValue("decrement")})}changeValue(s="none"){const u={inputValue:this.inputValue},g=this.minInputValue??Number.MIN_SAFE_INTEGER,A=this.maxInputValue??Number.MAX_SAFE_INTEGER;switch(this.inputValue=isNaN(this.inputValue)?0:this.inputValue,s){case"increment":const E=this.inputValue+this.step;this.inputValue=E>=g&&E<=A?E:A,this.input.value=this.inputValue.toString();break;case"decrement":const O=this.inputValue-this.step;this.inputValue=O>=g&&O<=A?O:g,this.input.value=this.inputValue.toString();break;default:const r=isNaN(parseInt(this.input.value))?0:parseInt(this.input.value);this.inputValue=r>=A?A:r<=g?g:r,this.inputValue<=g&&(this.input.value=this.inputValue.toString());break}u.inputValue=this.inputValue,this.inputValue===g?(this.el.classList.add("disabled"),this.decrement&&this.disableButtons("decrement")):(this.el.classList.remove("disabled"),this.decrement&&this.enableButtons("decrement")),this.inputValue===A?(this.el.classList.add("disabled"),this.increment&&this.disableButtons("increment")):(this.el.classList.remove("disabled"),this.increment&&this.enableButtons("increment")),this.fireEvent("change",u),to("change.hs.inputNumber",this.el,u)}disableButtons(s="all"){s==="all"?((this.increment.tagName==="BUTTON"||this.increment.tagName==="INPUT")&&this.increment.setAttribute("disabled","disabled"),(this.decrement.tagName==="BUTTON"||this.decrement.tagName==="INPUT")&&this.decrement.setAttribute("disabled","disabled")):s==="increment"?(this.increment.tagName==="BUTTON"||this.increment.tagName==="INPUT")&&this.increment.setAttribute("disabled","disabled"):s==="decrement"&&(this.decrement.tagName==="BUTTON"||this.decrement.tagName==="INPUT")&&this.decrement.setAttribute("disabled","disabled")}enableButtons(s="all"){s==="all"?((this.increment.tagName==="BUTTON"||this.increment.tagName==="INPUT")&&this.increment.removeAttribute("disabled"),(this.decrement.tagName==="BUTTON"||this.decrement.tagName==="INPUT")&&this.decrement.removeAttribute("disabled")):s==="increment"?(this.increment.tagName==="BUTTON"||this.increment.tagName==="INPUT")&&this.increment.removeAttribute("disabled"):s==="decrement"&&(this.decrement.tagName==="BUTTON"||this.decrement.tagName==="INPUT")&&this.decrement.removeAttribute("disabled")}static getInstance(s,u){const g=window.$hsInputNumberCollection.find(A=>A.element.el===(typeof s=="string"?document.querySelector(s):s));return g?u?g:g.element:null}static autoInit(){window.$hsInputNumberCollection||(window.$hsInputNumberCollection=[]),document.querySelectorAll("[data-hs-input-number]:not(.--prevent-on-load-init)").forEach(s=>{window.$hsInputNumberCollection.find(u=>{var g;return((g=u==null?void 0:u.element)==null?void 0:g.el)===s})||new Ap(s)})}}window.addEventListener("load",()=>{Ap.autoInit()});typeof window<"u"&&(window.HSInputNumber=Ap);/*
 * HSOverlay
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class $u extends as{constructor(s,u,g){var r;super(s,u,g);const A=s.getAttribute("data-hs-overlay-options"),O={...A?JSON.parse(A):{},...u};if(this.hiddenClass=(O==null?void 0:O.hiddenClass)||"hidden",this.emulateScrollbarSpace=(O==null?void 0:O.emulateScrollbarSpace)||!1,this.isClosePrev=(O==null?void 0:O.isClosePrev)??!0,this.backdropClasses=(O==null?void 0:O.backdropClasses)??"hs-overlay-backdrop transition duration fixed inset-0 bg-gray-900 bg-opacity-50 dark:bg-opacity-80 dark:bg-neutral-900",this.backdropExtraClasses=(O==null?void 0:O.backdropExtraClasses)??"",this.openNextOverlay=!1,this.autoHide=null,this.overlayId=this.el.getAttribute("data-hs-overlay"),this.overlay=document.querySelector(this.overlayId),this.overlay){this.isCloseWhenClickInside=up(Ho(this.overlay,"--close-when-click-inside","false")||"false"),this.isTabAccessibilityLimited=up(Ho(this.overlay,"--tab-accessibility-limited","true")||"true"),this.isLayoutAffect=up(Ho(this.overlay,"--is-layout-affect","false")||"false"),this.hasAutofocus=up(Ho(this.overlay,"--has-autofocus","true")||"true"),this.hasAbilityToCloseOnBackdropClick=up(this.overlay.getAttribute("data-hs-overlay-keyboard")||"true");const U=Ho(this.overlay,"--auto-close");this.autoClose=!isNaN(+U)&&isFinite(+U)?+U:s2[U]||null;const W=Ho(this.overlay,"--opened");this.openedBreakpoint=(!isNaN(+W)&&isFinite(+W)?+W:s2[W])||null}this.animationTarget=((r=this==null?void 0:this.overlay)==null?void 0:r.querySelector(".hs-overlay-animation-target"))||this.overlay,this.overlay&&this.init()}init(){var s;if(this.createCollection(window.$hsOverlayCollection,this),this.isLayoutAffect&&this.openedBreakpoint){const u=$u.getInstance(this.el,!0);$u.setOpened(this.openedBreakpoint,u)}(s=this==null?void 0:this.el)!=null&&s.ariaExpanded&&(this.overlay.classList.contains("opened")?this.el.ariaExpanded="true":this.el.ariaExpanded="false"),this.el.addEventListener("click",()=>{this.overlay.classList.contains("opened")?this.close():this.open()}),this.overlay.addEventListener("click",u=>{u.target.id&&`#${u.target.id}`===this.overlayId&&this.isCloseWhenClickInside&&this.hasAbilityToCloseOnBackdropClick&&this.close()})}hideAuto(){const s=parseInt(Ho(this.overlay,"--auto-hide","0"));s&&(this.autoHide=setTimeout(()=>{this.close()},s))}checkTimer(){this.autoHide&&(clearTimeout(this.autoHide),this.autoHide=null)}buildBackdrop(){const s=this.overlay.classList.value.split(" "),u=parseInt(window.getComputedStyle(this.overlay).getPropertyValue("z-index")),g=this.overlay.getAttribute("data-hs-overlay-backdrop-container")||!1;let A=document.createElement("div"),E=`${this.backdropClasses} ${this.backdropExtraClasses}`;const O=Ho(this.overlay,"--overlay-backdrop","true")!=="static",r=Ho(this.overlay,"--overlay-backdrop","true")==="false";A.id=`${this.overlay.id}-backdrop`,"style"in A&&(A.style.zIndex=`${u-1}`);for(const U of s)(U.startsWith("hs-overlay-backdrop-open:")||U.includes(":hs-overlay-backdrop-open:"))&&(E+=` ${U}`);r||(g&&(A=document.querySelector(g).cloneNode(!0),A.classList.remove("hidden"),E=`${A.classList.toString()}`,A.classList.value=""),O&&A.addEventListener("click",()=>this.close(),!0),A.setAttribute("data-hs-overlay-backdrop-template",""),document.body.appendChild(A),setTimeout(()=>{A.classList.value=E}))}destroyBackdrop(){const s=document.querySelector(`#${this.overlay.id}-backdrop`);s&&(this.openNextOverlay&&(s.style.transitionDuration=`${parseFloat(window.getComputedStyle(s).transitionDuration.replace(/[^\d.-]/g,""))*1.8}s`),s.classList.add("opacity-0"),vl(s,()=>{s.remove()}))}focusElement(){const s=this.overlay.querySelector("[autofocus]");if(s)s.focus();else return!1}getScrollbarSize(){let s=document.createElement("div");s.style.overflow="scroll",s.style.width="100px",s.style.height="100px",document.body.appendChild(s);let u=s.offsetWidth-s.clientWidth;return document.body.removeChild(s),u}open(){if(!this.overlay)return!1;const s=document.querySelectorAll(".hs-overlay.open"),u=window.$hsOverlayCollection.find(E=>Array.from(s).includes(E.element.overlay)&&!E.element.isLayoutAffect),g=document.querySelectorAll(`[data-hs-overlay="#${this.overlay.id}"]`),A=Ho(this.overlay,"--body-scroll","false")!=="true";if(this.isClosePrev&&u)return this.openNextOverlay=!0,u.element.close().then(()=>{this.open(),this.openNextOverlay=!1});A&&(document.body.style.overflow="hidden",this.emulateScrollbarSpace&&(document.body.style.paddingRight=`${this.getScrollbarSize()}px`)),this.buildBackdrop(),this.checkTimer(),this.hideAuto(),g.forEach(E=>{E.ariaExpanded&&(E.ariaExpanded="true")}),this.overlay.classList.remove(this.hiddenClass),this.overlay.setAttribute("aria-overlay","true"),this.overlay.setAttribute("tabindex","-1"),setTimeout(()=>{if(this.overlay.classList.contains("opened"))return!1;this.overlay.classList.add("open","opened"),this.isLayoutAffect&&document.body.classList.add("hs-overlay-body-open"),this.fireEvent("open",this.el),to("open.hs.overlay",this.el,this.el),this.hasAutofocus&&this.focusElement()},50)}close(s=!1){this.isLayoutAffect&&document.body.classList.remove("hs-overlay-body-open");const u=g=>{if(this.overlay.classList.contains("open"))return!1;document.querySelectorAll(`[data-hs-overlay="#${this.overlay.id}"]`).forEach(E=>{E.ariaExpanded&&(E.ariaExpanded="false")}),this.overlay.classList.add(this.hiddenClass),this.destroyBackdrop(),this.fireEvent("close",this.el),to("close.hs.overlay",this.el,this.el),document.querySelector(".hs-overlay.opened")||(document.body.style.overflow="",this.emulateScrollbarSpace&&(document.body.style.paddingRight="")),g(this.overlay)};return new Promise(g=>{if(!this.overlay)return!1;this.overlay.classList.remove("open","opened"),this.overlay.removeAttribute("aria-overlay"),this.overlay.removeAttribute("tabindex"),s?u(g):vl(this.animationTarget,()=>u(g))})}static getInstance(s,u){const g=window.$hsOverlayCollection.find(A=>A.element.el===(typeof s=="string"?document.querySelector(s):s)||A.element.overlay===(typeof s=="string"?document.querySelector(s):s));return g?u?g:g.element.el:null}static autoInit(){window.$hsOverlayCollection||(window.$hsOverlayCollection=[]),document.querySelectorAll("[data-hs-overlay]:not(.--prevent-on-load-init)").forEach(s=>{window.$hsOverlayCollection.find(u=>{var g;return((g=u==null?void 0:u.element)==null?void 0:g.el)===s})||new $u(s)}),window.$hsOverlayCollection&&document.addEventListener("keydown",s=>$u.accessibility(s))}static open(s){const u=window.$hsOverlayCollection.find(g=>g.element.el===(typeof s=="string"?document.querySelector(s):s)||g.element.overlay===(typeof s=="string"?document.querySelector(s):s));u&&u.element.overlay.classList.contains(u.element.hiddenClass)&&u.element.open()}static close(s){const u=window.$hsOverlayCollection.find(g=>g.element.el===(typeof s=="string"?document.querySelector(s):s)||g.element.overlay===(typeof s=="string"?document.querySelector(s):s));u&&!u.element.overlay.classList.contains(u.element.hiddenClass)&&u.element.close()}static setOpened(s,u){document.body.clientWidth>=s?(document.body.classList.add("hs-overlay-body-open"),u.element.overlay.classList.add("opened")):u.element.close(!0)}static accessibility(s){var r,U;const u=window.$hsOverlayCollection.filter(W=>W.element.overlay.classList.contains("open")),g=u[u.length-1],A=(U=(r=g==null?void 0:g.element)==null?void 0:r.overlay)==null?void 0:U.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),E=[];A!=null&&A.length&&A.forEach(W=>{hy(W)||E.push(W)});const O=g&&!s.metaKey;if(O&&!g.element.isTabAccessibilityLimited&&s.code==="Tab")return!1;O&&E.length&&s.code==="Tab"&&(s.preventDefault(),this.onTab(g,E)),O&&s.code==="Escape"&&(s.preventDefault(),this.onEscape(g))}static onEscape(s){s&&s.element.hasAbilityToCloseOnBackdropClick&&s.element.close()}static onTab(s,u){if(!u.length)return!1;const g=s.element.overlay.querySelector(":focus"),A=Array.from(u).indexOf(g);if(A>-1){const E=(A+1)%u.length;u[E].focus()}else u[0].focus()}static on(s,u,g){const A=window.$hsOverlayCollection.find(E=>E.element.el===(typeof u=="string"?document.querySelector(u):u)||E.element.overlay===(typeof u=="string"?document.querySelector(u):u));A&&(A.element.events[s]=g)}}const Ck=()=>{if(!window.$hsOverlayCollection.length||!window.$hsOverlayCollection.find(s=>s.element.autoClose))return!1;window.$hsOverlayCollection.filter(s=>s.element.autoClose).forEach(s=>{document.body.clientWidth>=s.element.autoClose&&s.element.close(!0)})},Ek=()=>{if(!window.$hsOverlayCollection.length||!window.$hsOverlayCollection.find(s=>s.element.autoClose))return!1;window.$hsOverlayCollection.filter(s=>s.element.autoClose).forEach(s=>{document.body.clientWidth>=s.element.autoClose&&s.element.close(!0)})},Tk=()=>{if(!window.$hsOverlayCollection.length||!window.$hsOverlayCollection.find(s=>s.element.overlay.classList.contains("opened")))return!1;window.$hsOverlayCollection.filter(s=>s.element.overlay.classList.contains("opened")).forEach(s=>{const u=parseInt(window.getComputedStyle(s.element.overlay).getPropertyValue("z-index")),g=document.querySelector(`#${s.element.overlay.id}-backdrop`),A=parseInt(window.getComputedStyle(g).getPropertyValue("z-index"));if(u===A+1)return!1;"style"in g&&(g.style.zIndex=`${u-1}`),document.body.classList.add("hs-overlay-body-open")})};window.addEventListener("load",()=>{$u.autoInit()});window.addEventListener("resize",()=>{Ck(),Ek(),Tk()});typeof window<"u"&&(window.HSOverlay=$u);/*
 * HSPinInput
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class Ip extends as{constructor(s,u){super(s,u);const g=s.getAttribute("data-hs-pin-input"),E={...g?JSON.parse(g):{},...u};this.items=this.el.querySelectorAll("[data-hs-pin-input-item]"),this.currentItem=null,this.currentValue=new Array(this.items.length).fill(""),this.placeholders=[],this.availableCharsRE=new RegExp((E==null?void 0:E.availableCharsRE)||"^[a-zA-Z0-9]+$"),this.init()}init(){this.createCollection(window.$hsPinInputCollection,this),this.items.length&&this.build()}build(){this.buildInputItems()}buildInputItems(){this.items.forEach((s,u)=>{this.placeholders.push(s.getAttribute("placeholder")||""),s.hasAttribute("autofocus")&&this.onFocusIn(u),s.addEventListener("input",g=>this.onInput(g,u)),s.addEventListener("paste",g=>this.onPaste(g)),s.addEventListener("keydown",g=>this.onKeydown(g,u)),s.addEventListener("focusin",()=>this.onFocusIn(u)),s.addEventListener("focusout",()=>this.onFocusOut(u))})}checkIfNumber(s){return s.match(this.availableCharsRE)}autoFillAll(s){Array.from(s).forEach((u,g)=>{if(!(this!=null&&this.items[g]))return!1;this.items[g].value=u,this.items[g].dispatchEvent(new Event("input",{bubbles:!0}))})}setCurrentValue(){this.currentValue=Array.from(this.items).map(s=>s.value)}toggleCompleted(){this.currentValue.includes("")?this.el.classList.remove("active"):this.el.classList.add("active")}onInput(s,u){const g=s.target.value;if(this.currentItem=s.target,this.currentItem.value="",this.currentItem.value=g[g.length-1],!this.checkIfNumber(this.currentItem.value))return this.currentItem.value=this.currentValue[u]||"",!1;if(this.setCurrentValue(),this.currentItem.value){if(u<this.items.length-1&&this.items[u+1].focus(),!this.currentValue.includes("")){const A={currentValue:this.currentValue};this.fireEvent("completed",A),to("completed.hs.pinInput",this.el,A)}this.toggleCompleted()}else u>0&&this.items[u-1].focus()}onKeydown(s,u){s.key==="Backspace"&&u>0&&(this.items[u].value===""?(this.items[u-1].value="",this.items[u-1].focus()):this.items[u].value=""),this.setCurrentValue(),this.toggleCompleted()}onFocusIn(s){this.items[s].setAttribute("placeholder","")}onFocusOut(s){this.items[s].setAttribute("placeholder",this.placeholders[s])}onPaste(s){s.preventDefault(),this.items.forEach(u=>{document.activeElement===u&&this.autoFillAll(s.clipboardData.getData("text"))})}static getInstance(s,u){const g=window.$hsPinInputCollection.find(A=>A.element.el===(typeof s=="string"?document.querySelector(s):s));return g?u?g:g.element:null}static autoInit(){window.$hsPinInputCollection||(window.$hsPinInputCollection=[]),document.querySelectorAll("[data-hs-pin-input]:not(.--prevent-on-load-init)").forEach(s=>{window.$hsPinInputCollection.find(u=>{var g;return((g=u==null?void 0:u.element)==null?void 0:g.el)===s})||new Ip(s)})}}window.addEventListener("load",()=>{Ip.autoInit()});typeof window<"u"&&(window.HSPinInput=Ip);/*
 * HSRemoveElement
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class Mp extends as{constructor(s,u){super(s,u);const g=s.getAttribute("data-hs-remove-element-options"),E={...g?JSON.parse(g):{},...u};this.removeTargetId=this.el.getAttribute("data-hs-remove-element"),this.removeTarget=document.querySelector(this.removeTargetId),this.removeTargetAnimationClass=(E==null?void 0:E.removeTargetAnimationClass)||"hs-removing",this.removeTarget&&this.init()}init(){this.createCollection(window.$hsRemoveElementCollection,this),this.el.addEventListener("click",()=>this.remove())}remove(){if(!this.removeTarget)return!1;this.removeTarget.classList.add(this.removeTargetAnimationClass),vl(this.removeTarget,()=>{this.removeTarget.remove()})}static autoInit(){window.$hsRemoveElementCollection||(window.$hsRemoveElementCollection=[]),document.querySelectorAll("[data-hs-remove-element]:not(.--prevent-on-load-init)").forEach(s=>{window.$hsRemoveElementCollection.find(u=>{var g;return((g=u==null?void 0:u.element)==null?void 0:g.el)===s})||new Mp(s)})}}window.addEventListener("load",()=>{Mp.autoInit()});typeof window<"u"&&(window.HSRemoveElement=Mp);/*
 * HSScrollspy
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class Lp extends as{constructor(s,u={}){super(s,u),this.activeSection=null,this.contentId=this.el.getAttribute("data-hs-scrollspy"),this.content=document.querySelector(this.contentId),this.links=this.el.querySelectorAll("[href]"),this.sections=[],this.scrollableId=this.el.getAttribute("data-hs-scrollspy-scrollable-parent"),this.scrollable=this.scrollableId?document.querySelector(this.scrollableId):document,this.init()}init(){this.createCollection(window.$hsScrollspyCollection,this),this.links.forEach(s=>{this.sections.push(this.scrollable.querySelector(s.getAttribute("href")))}),Array.from(this.sections).forEach(s=>{if(!s.getAttribute("id"))return!1;this.scrollable.addEventListener("scroll",u=>this.update(u,s))}),this.links.forEach(s=>{s.addEventListener("click",u=>{if(u.preventDefault(),s.getAttribute("href")==="javascript:;")return!1;this.scrollTo(s)})})}update(s,u){const g=parseInt(Ho(this.el,"--scrollspy-offset","0")),A=parseInt(Ho(u,"--scrollspy-offset"))||g,E=s.target===document?0:parseInt(String(s.target.getBoundingClientRect().top)),O=parseInt(String(u.getBoundingClientRect().top))-A-E,r=u.offsetHeight;if(O<=0&&O+r>0){if(this.activeSection===u)return!1;this.links.forEach(W=>{W.classList.remove("active")});const U=this.el.querySelector(`[href="#${u.getAttribute("id")}"]`);if(U){U.classList.add("active");const W=U.closest("[data-hs-scrollspy-group]");if(W){const Y=W.querySelector("[href]");Y&&Y.classList.add("active")}}this.activeSection=u}}scrollTo(s){const u=s.getAttribute("href"),g=document.querySelector(u),A=parseInt(Ho(this.el,"--scrollspy-offset","0")),E=parseInt(Ho(g,"--scrollspy-offset"))||A,O=this.scrollable===document?0:this.scrollable.offsetTop,r=g.offsetTop-E-O,U=this.scrollable===document?window:this.scrollable,W=()=>{window.history.replaceState(null,null,s.getAttribute("href")),"scrollTo"in U&&U.scrollTo({top:r,left:0,behavior:"smooth"})},Y=this.fireEvent("beforeScroll",this.el);to("beforeScroll.hs.scrollspy",this.el,this.el),Y instanceof Promise?Y.then(()=>W()):W()}static getInstance(s,u=!1){const g=window.$hsScrollspyCollection.find(A=>A.element.el===(typeof s=="string"?document.querySelector(s):s));return g?u?g:g.element.el:null}static autoInit(){window.$hsScrollspyCollection||(window.$hsScrollspyCollection=[]),document.querySelectorAll("[data-hs-scrollspy]:not(.--prevent-on-load-init)").forEach(s=>{window.$hsScrollspyCollection.find(u=>{var g;return((g=u==null?void 0:u.element)==null?void 0:g.el)===s})||new Lp(s)})}}window.addEventListener("load",()=>{Lp.autoInit()});typeof window<"u"&&(window.HSScrollspy=Lp);/*
 * HSSelect
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class Dh extends as{constructor(s,u){super(s,u);const g=s.getAttribute("data-hs-select"),E={...g?JSON.parse(g):{},...u},O={items:", ",betweenItemsAndCounter:"and"};this.value=(E==null?void 0:E.value)||this.el.value||null,this.placeholder=(E==null?void 0:E.placeholder)||"Select...",this.hasSearch=(E==null?void 0:E.hasSearch)||!1,this.preventSearchFocus=(E==null?void 0:E.preventSearchFocus)||!1,this.mode=(E==null?void 0:E.mode)||"default",this.viewport=typeof(E==null?void 0:E.viewport)<"u"?document.querySelector(E==null?void 0:E.viewport):null,this.isOpened=!!(E!=null&&E.isOpened)||!1,this.isMultiple=this.el.hasAttribute("multiple")||!1,this.isDisabled=this.el.hasAttribute("disabled")||!1,this.selectedItems=[],this.wrapperClasses=(E==null?void 0:E.wrapperClasses)||null,this.toggleTag=(E==null?void 0:E.toggleTag)||null,this.toggleClasses=(E==null?void 0:E.toggleClasses)||null,this.toggleSeparators={...O,...E==null?void 0:E.toggleSeparators},this.toggleCountText=(E==null?void 0:E.toggleCountText)||null,this.toggleCountTextMinItems=(E==null?void 0:E.toggleCountTextMinItems)||1,this.toggleCountTextMode=(E==null?void 0:E.toggleCountTextMode)||"countAfterLimit",this.tagsItemTemplate=(E==null?void 0:E.tagsItemTemplate)||null,this.tagsItemClasses=(E==null?void 0:E.tagsItemClasses)||null,this.tagsInputClasses=(E==null?void 0:E.tagsInputClasses)||null,this.dropdownTag=(E==null?void 0:E.dropdownTag)||null,this.dropdownClasses=(E==null?void 0:E.dropdownClasses)||null,this.dropdownDirectionClasses=(E==null?void 0:E.dropdownDirectionClasses)||null,this.dropdownSpace=(E==null?void 0:E.dropdownSpace)||10,this.searchWrapperTemplate=(E==null?void 0:E.searchWrapperTemplate)||null,this.searchWrapperClasses=(E==null?void 0:E.searchWrapperClasses)||"bg-white p-2 sticky top-0",this.searchClasses=(E==null?void 0:E.searchClasses)||"block w-[calc(100%-2rem)] text-sm border-gray-200 rounded-md focus:border-blue-500 focus:ring-blue-500 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-400 py-2 px-3 my-2 mx-4",this.searchPlaceholder=(E==null?void 0:E.searchPlaceholder)||"Search...",this.searchNoResultText=(E==null?void 0:E.searchNoResultText)||"No results found",this.searchNoResultClasses=(E==null?void 0:E.searchNoResultClasses)||"px-4 text-sm text-gray-800 dark:text-neutral-200",this.optionTemplate=(E==null?void 0:E.optionTemplate)||null,this.optionTag=(E==null?void 0:E.optionTag)||null,this.optionClasses=(E==null?void 0:E.optionClasses)||null,this.extraMarkup=(E==null?void 0:E.extraMarkup)||null,this.descriptionClasses=(E==null?void 0:E.descriptionClasses)||null,this.iconClasses=(E==null?void 0:E.iconClasses)||null,this.isAddTagOnEnter=(E==null?void 0:E.isAddTagOnEnter)??!0,this.animationInProcess=!1,this.selectOptions=[],this.tagsInputHelper=null,this.init()}setValue(s){this.value=s,this.clearSelections(),Array.isArray(s)?(this.toggleTextWrapper.innerHTML=this.value.length?this.stringFromValue():this.placeholder,this.unselectMultipleItems(),this.selectMultipleItems()):(this.setToggleTitle(),this.toggle.querySelector("[data-icon]")&&this.setToggleIcon(),this.toggle.querySelector("[data-title]")&&this.setToggleTitle(),this.selectSingleItem())}init(){this.createCollection(window.$hsSelectCollection,this),this.build()}build(){if(this.el.style.display="none",this.el.children&&Array.from(this.el.children).filter(s=>s.value&&s.value!=="").forEach(s=>{const u=s.getAttribute("data-hs-select-option");this.selectOptions=[...this.selectOptions,{title:s.textContent,val:s.value,disabled:s.disabled,options:u!=="undefined"?JSON.parse(u):null}]}),this.isMultiple){const s=Array.from(this.el.children).filter(u=>u.selected);if(s){const u=[];s.forEach(g=>{u.push(g.value)}),this.value=u}}this.buildWrapper(),this.mode==="tags"?this.buildTags():this.buildToggle(),this.buildDropdown(),this.extraMarkup&&this.buildExtraMarkup()}buildWrapper(){this.wrapper=document.createElement("div"),this.wrapper.classList.add("hs-select","relative"),this.mode==="tags"&&this.wrapper.addEventListener("click",s=>{!s.target.closest("[data-hs-select-dropdown]")&&!s.target.closest("[data-tag-value]")&&this.tagsInput.focus()}),this.wrapperClasses&&Pa(this.wrapperClasses,this.wrapper),this.el.before(this.wrapper),this.wrapper.append(this.el)}buildExtraMarkup(){const s=u=>{this.wrapper.append(Wr(u))};Array.isArray(this.extraMarkup)?this.extraMarkup.forEach(u=>s(u)):s(this.extraMarkup)}buildToggle(){var g,A;let s,u;this.toggleTextWrapper=document.createElement("span"),this.toggleTextWrapper.classList.add("truncate"),this.toggle=Wr(this.toggleTag||"<div></div>"),s=this.toggle.querySelector("[data-icon]"),u=this.toggle.querySelector("[data-title]"),!this.isMultiple&&s&&this.setToggleIcon(),!this.isMultiple&&u&&this.setToggleTitle(),this.isMultiple?this.toggleTextWrapper.innerHTML=this.value.length?this.stringFromValue():this.placeholder:this.toggleTextWrapper.innerHTML=((g=this.getItemByValue(this.value))==null?void 0:g.title)||this.placeholder,u||this.toggle.append(this.toggleTextWrapper),this.toggleClasses&&Pa(this.toggleClasses,this.toggle),this.isDisabled&&this.toggle.classList.add("disabled"),this.wrapper&&this.wrapper.append(this.toggle),(A=this.toggle)!=null&&A.ariaExpanded&&(this.isOpened?this.toggle.ariaExpanded="true":this.toggle.ariaExpanded="false"),this.toggle.addEventListener("click",()=>{if(this.isDisabled)return!1;this.isOpened?this.close():this.open()})}setToggleIcon(){var u,g;const s=this.toggle.querySelector("[data-icon]");if(s.innerHTML="",s){const A=Wr(((g=(u=this.getItemByValue(this.value))==null?void 0:u.options)==null?void 0:g.icon)||"");s.append(A),A?s.classList.remove("hidden"):s.classList.add("hidden")}}setToggleTitle(){var u;const s=this.toggle.querySelector("[data-title]");if(s.classList.add("truncate"),s.innerHTML="",s){const g=((u=this.getItemByValue(this.value))==null?void 0:u.title)||this.placeholder;s.innerHTML=g,this.toggle.append(s)}}buildTags(){this.isDisabled&&this.wrapper.classList.add("disabled"),this.buildTagsInput(),this.setTagsItems()}reassignTagsInputPlaceholder(s){this.tagsInput.placeholder=s,this.tagsInputHelper.innerHTML=s,this.calculateInputWidth()}buildTagsItem(s){var U,W,Y;const u=this.getItemByValue(s);let g,A,E,O;const r=document.createElement("div");if(r.setAttribute("data-tag-value",s),this.tagsItemClasses&&Pa(this.tagsItemClasses,r),this.tagsItemTemplate&&(g=Wr(this.tagsItemTemplate),r.append(g)),(U=u==null?void 0:u.options)!=null&&U.icon){const se=Wr((W=u==null?void 0:u.options)==null?void 0:W.icon);O=g?g.querySelector("[data-icon]"):document.createElement("span"),O.append(se),g||r.append(O)}g&&g.querySelector("[data-icon]")&&!((Y=u==null?void 0:u.options)!=null&&Y.icon)&&g.querySelector("[data-icon]").classList.add("hidden"),A=g?g.querySelector("[data-title]"):document.createElement("span"),A.textContent=u.title||"",g||r.append(A),g?E=g.querySelector("[data-remove]"):(E=document.createElement("span"),E.textContent="X",r.append(E)),E.addEventListener("click",()=>{this.value=this.value.filter(se=>se!==s),this.selectedItems=this.selectedItems.filter(se=>se!==s),this.value.length||this.reassignTagsInputPlaceholder(this.placeholder),this.unselectMultipleItems(),this.selectMultipleItems(),r.remove()}),this.wrapper.append(r)}getItemByValue(s){return this.selectOptions.find(u=>u.val===s)}setTagsItems(){this.value&&this.value.forEach(s=>{this.selectedItems.includes(s)||this.buildTagsItem(s),this.selectedItems=this.selectedItems.includes(s)?this.selectedItems:[...this.selectedItems,s]})}buildTagsInput(){this.tagsInput=document.createElement("input"),this.tagsInputClasses&&Pa(this.tagsInputClasses,this.tagsInput),this.tagsInput.addEventListener("focus",()=>this.open()),this.tagsInput.addEventListener("input",()=>this.calculateInputWidth()),this.tagsInput.addEventListener("input",$g(s=>this.searchOptions(s.target.value))),this.tagsInput.addEventListener("keydown",s=>{if(s.key==="Enter"&&this.isAddTagOnEnter){const u=s.target.value;if(this.selectOptions.find(g=>g.val===u))return!1;this.addSelectOption(u,u),this.buildOption(u,u),this.dropdown.querySelector(`[data-value="${u}"]`).click(),this.resetTagsInputField()}}),this.wrapper.append(this.tagsInput),setTimeout(()=>{this.adjustInputWidth(),this.reassignTagsInputPlaceholder(this.value.length?"":this.placeholder)})}buildDropdown(){this.dropdown=Wr(this.dropdownTag||"<div></div>"),this.dropdown.setAttribute("data-hs-select-dropdown",""),this.dropdown.classList.add("absolute","top-full"),this.dropdown.role="listbox",this.dropdown.tabIndex=-1,this.dropdown.ariaOrientation="vertical",this.isOpened||this.dropdown.classList.add("hidden"),this.dropdownClasses&&Pa(this.dropdownClasses,this.dropdown),this.wrapper&&this.wrapper.append(this.dropdown),this.dropdown&&this.hasSearch&&this.buildSearch(),this.selectOptions&&this.selectOptions.forEach((s,u)=>this.buildOption(s.title,s.val,s.disabled,s.selected,s.options,`${u}`))}buildSearch(){let s;this.searchWrapper=Wr(this.searchWrapperTemplate||"<div></div>"),this.searchWrapperClasses&&Pa(this.searchWrapperClasses,this.searchWrapper),s=this.searchWrapper.querySelector("[data-input]"),this.search=Wr('<input type="text" />'),this.search.placeholder=this.searchPlaceholder,this.searchClasses&&Pa(this.searchClasses,this.search),this.search.addEventListener("input",$g(u=>this.searchOptions(u.target.value))),s?s.append(this.search):this.searchWrapper.append(this.search),this.dropdown.append(this.searchWrapper)}buildOption(s,u,g=!1,A=!1,E,O="1"){let r=null,U=null,W=null,Y=null;const se=Wr(this.optionTag||"<div></div>");if(se.setAttribute("data-value",u),se.setAttribute("data-title-value",s),se.setAttribute("tabIndex",O),se.classList.add("cursor-pointer"),g&&se.classList.add("disabled"),A&&(this.isMultiple?this.value=[...this.value,u]:this.value=u),this.optionTemplate&&(r=Wr(this.optionTemplate),se.append(r)),r?(U=r.querySelector("[data-title]"),U.textContent=s||""):se.textContent=s||"",E){if(E.icon){const Ae=Wr(E.icon);if(Ae.classList.add("max-w-full"),r)W=r.querySelector("[data-icon]"),W.append(Ae);else{const Ce=Wr("<div></div>");this.iconClasses&&Pa(this.iconClasses,Ce),Ce.append(Ae),se.append(Ce)}}if(E.description)if(r)Y=r.querySelector("[data-description]"),Y.append(E.description);else{const Ae=Wr("<div></div>");Ae.textContent=E.description,this.descriptionClasses&&Pa(this.descriptionClasses,Ae),se.append(Ae)}}r&&r.querySelector("[data-icon]")&&!E&&!(E!=null&&E.icon)&&r.querySelector("[data-icon]").classList.add("hidden"),this.value&&(this.isMultiple?this.value.includes(u):this.value===u)&&se.classList.add("selected"),g||se.addEventListener("click",()=>this.onSelectOption(u)),this.optionClasses&&Pa(this.optionClasses,se),this.dropdown&&this.dropdown.append(se),A&&this.setNewValue()}destroyOption(s){const u=this.dropdown.querySelector(`[data-value="${s}"]`);if(!u)return!1;u.remove()}buildOriginalOption(s,u,g,A,E){const O=Wr("<option></option>");O.setAttribute("value",u),g&&O.setAttribute("disabled","disabled"),A&&O.setAttribute("selected","selected"),O.setAttribute("data-hs-select-option",JSON.stringify(E)),O.innerText=s,this.el.append(O)}destroyOriginalOption(s){const u=this.el.querySelector(`[value="${s}"]`);if(!u)return!1;u.remove()}buildTagsInputHelper(){this.tagsInputHelper=document.createElement("span"),this.tagsInputHelper.style.fontSize=window.getComputedStyle(this.tagsInput).fontSize,this.tagsInputHelper.style.fontFamily=window.getComputedStyle(this.tagsInput).fontFamily,this.tagsInputHelper.style.fontWeight=window.getComputedStyle(this.tagsInput).fontWeight,this.tagsInputHelper.style.letterSpacing=window.getComputedStyle(this.tagsInput).letterSpacing,this.tagsInputHelper.style.visibility="hidden",this.tagsInputHelper.style.whiteSpace="pre",this.tagsInputHelper.style.position="absolute",this.wrapper.appendChild(this.tagsInputHelper)}calculateInputWidth(){this.tagsInputHelper.textContent=this.tagsInput.value||this.tagsInput.placeholder;const s=parseInt(window.getComputedStyle(this.tagsInput).paddingLeft)+parseInt(window.getComputedStyle(this.tagsInput).paddingRight),u=parseInt(window.getComputedStyle(this.tagsInput).borderLeftWidth)+parseInt(window.getComputedStyle(this.tagsInput).borderRightWidth),g=this.tagsInputHelper.offsetWidth+s+u,A=this.wrapper.offsetWidth-(parseInt(window.getComputedStyle(this.wrapper).paddingLeft)+parseInt(window.getComputedStyle(this.wrapper).paddingRight));this.tagsInput.style.width=`${Math.min(g,A)+2}px`}adjustInputWidth(){this.buildTagsInputHelper(),this.calculateInputWidth()}onSelectOption(s){if(this.clearSelections(),this.isMultiple?(this.value=this.value.includes(s)?Array.from(this.value).filter(u=>u!==s):[...Array.from(this.value),s],this.selectMultipleItems(),this.setNewValue()):(this.value=s,this.selectSingleItem(),this.setNewValue()),this.fireEvent("change",this.value),to("change.hs.select",this.el,this.value),this.mode==="tags"){const u=this.selectedItems.filter(g=>!this.value.includes(g));u.length&&u.forEach(g=>{this.selectedItems=this.selectedItems.filter(A=>A!==g),this.wrapper.querySelector(`[data-tag-value="${g}"]`).remove()}),this.resetTagsInputField()}this.isMultiple||(this.toggle.querySelector("[data-icon]")&&this.setToggleIcon(),this.toggle.querySelector("[data-title]")&&this.setToggleTitle(),this.close()),!this.value.length&&this.mode==="tags"&&this.reassignTagsInputPlaceholder(this.placeholder),this.isOpened&&this.mode==="tags"&&this.tagsInput&&this.tagsInput.focus(),this.triggerChangeEventForNativeSelect()}triggerChangeEventForNativeSelect(){const s=new Event("change",{bubbles:!0});this.el.dispatchEvent(s)}addSelectOption(s,u,g,A,E){this.selectOptions=[...this.selectOptions,{title:s,val:u,disabled:g,selected:A,options:E}]}removeSelectOption(s,u=!1){if(!!!this.selectOptions.some(A=>A.val===s))return!1;this.selectOptions=this.selectOptions.filter(A=>A.val!==s),console.log(u),this.value=u?this.value.filter(A=>A!==s):s,console.log(this.value)}resetTagsInputField(){this.tagsInput.value="",this.reassignTagsInputPlaceholder(""),this.searchOptions("")}clearSelections(){Array.from(this.dropdown.children).forEach(s=>{s.classList.contains("selected")&&s.classList.remove("selected")}),Array.from(this.el.children).forEach(s=>{s.selected&&(s.selected=!1)})}setNewValue(){this.mode==="tags"?this.setTagsItems():(console.log(),this.value.length?this.toggleTextWrapper.innerHTML=this.stringFromValue():this.toggleTextWrapper.innerHTML=this.placeholder)}stringFromValue(){const s=[];let u="";if(this.selectOptions.forEach(g=>{this.isMultiple?this.value.includes(g.val)&&s.push(g.title):this.value===g.val&&s.push(g.title)}),this.toggleCountText&&this.toggleCountText!==""&&s.length>=this.toggleCountTextMinItems)if(this.toggleCountTextMode==="nItemsAndCount"){const g=s.slice(0,this.toggleCountTextMinItems-1);u=`${g.join(this.toggleSeparators.items)} ${this.toggleSeparators.betweenItemsAndCounter} ${s.length-g.length} ${this.toggleCountText}`}else u=`${s.length} ${this.toggleCountText}`;else u=s.join(this.toggleSeparators.items);return u}selectSingleItem(){const s=Array.from(this.el.children).find(g=>this.value===g.value);s.selected=!0;const u=Array.from(this.dropdown.children).find(g=>this.value===g.getAttribute("data-value"));u&&u.classList.add("selected")}selectMultipleItems(){Array.from(this.dropdown.children).filter(s=>this.value.includes(s.getAttribute("data-value"))).forEach(s=>s.classList.add("selected")),Array.from(this.el.children).filter(s=>this.value.includes(s.value)).forEach(s=>s.selected=!0)}unselectMultipleItems(){Array.from(this.dropdown.children).forEach(s=>s.classList.remove("selected")),Array.from(this.el.children).forEach(s=>s.selected=!1)}searchOptions(s){this.searchNoResult&&(this.searchNoResult.remove(),this.searchNoResult=null),this.searchNoResult=Wr("<span></span>"),this.searchNoResult.innerText=this.searchNoResultText,Pa(this.searchNoResultClasses,this.searchNoResult);const u=this.dropdown.querySelectorAll("[data-value]");let g=!1;u.forEach(A=>{A.getAttribute("data-title-value").toLocaleLowerCase().includes(s.toLocaleLowerCase())?(A.classList.remove("hidden"),g=!0):A.classList.add("hidden")}),g||this.dropdown.append(this.searchNoResult)}eraseToggleIcon(){const s=this.toggle.querySelector("[data-icon]");s&&(s.innerHTML=null,s.classList.add("hidden"))}eraseToggleTitle(){const s=this.toggle.querySelector("[data-title]");s?s.innerHTML=this.placeholder:this.toggleTextWrapper.innerHTML=this.placeholder}destroy(){const s=this.el.parentElement.parentElement;this.el.classList.remove("hidden"),this.el.style.display="",s.prepend(this.el),s.querySelector(".hs-select").remove(),this.wrapper=null}open(){var u;const s=((u=window==null?void 0:window.$hsSelectCollection)==null?void 0:u.find(g=>g.element.isOpened))||null;if(s&&s.element.close(),this.animationInProcess)return!1;this.animationInProcess=!0,this.dropdown.classList.remove("hidden"),this.recalculateDirection(),setTimeout(()=>{var g;(g=this==null?void 0:this.toggle)!=null&&g.ariaExpanded&&(this.toggle.ariaExpanded="true"),this.wrapper.classList.add("active"),this.dropdown.classList.add("opened"),this.hasSearch&&!this.preventSearchFocus&&this.search.focus(),this.animationInProcess=!1}),this.isOpened=!0}close(){var s,u,g,A;if(this.animationInProcess)return!1;this.animationInProcess=!0,(s=this==null?void 0:this.toggle)!=null&&s.ariaExpanded&&(this.toggle.ariaExpanded="false"),this.wrapper.classList.remove("active"),this.dropdown.classList.remove("opened","bottom-full","top-full"),(u=this.dropdownDirectionClasses)!=null&&u.bottom&&this.dropdown.classList.remove(this.dropdownDirectionClasses.bottom),(g=this.dropdownDirectionClasses)!=null&&g.top&&this.dropdown.classList.remove(this.dropdownDirectionClasses.top),this.dropdown.style.marginTop="",this.dropdown.style.marginBottom="",vl(this.dropdown,()=>{this.dropdown.classList.add("hidden"),this.hasSearch&&(this.search.value="",this.search.dispatchEvent(new Event("input",{bubbles:!0})),this.search.blur()),this.animationInProcess=!1}),(A=this.dropdown.querySelector(".hs-select-option-highlighted"))==null||A.classList.remove("hs-select-option-highlighted"),this.isOpened=!1}addOption(s){let u=`${this.selectOptions.length}`;const g=A=>{const{title:E,val:O,disabled:r,selected:U,options:W}=A;!!this.selectOptions.some(se=>se.val===O)||(this.addSelectOption(E,O,r,U,W),this.buildOption(E,O,r,U,W,u),this.buildOriginalOption(E,O,r,U,W),U&&!this.isMultiple&&this.onSelectOption(O))};Array.isArray(s)?s.forEach(A=>{g(A)}):g(s)}removeOption(s){const u=(g,A=!1)=>{!!this.selectOptions.some(O=>O.val===g)&&(this.removeSelectOption(g,A),this.destroyOption(g),this.destroyOriginalOption(g),this.value===g&&(this.value=null,this.eraseToggleTitle(),this.eraseToggleIcon()))};Array.isArray(s)?s.forEach(g=>{u(g,this.isMultiple)}):u(s,this.isMultiple),this.setNewValue()}recalculateDirection(){var s,u,g,A;uy(this.dropdown,this.toggle||this.tagsInput,"bottom",this.dropdownSpace,this.viewport)?(this.dropdown.classList.remove("bottom-full"),(s=this.dropdownDirectionClasses)!=null&&s.bottom&&this.dropdown.classList.remove(this.dropdownDirectionClasses.bottom),this.dropdown.style.marginBottom="",this.dropdown.classList.add("top-full"),(u=this.dropdownDirectionClasses)!=null&&u.top&&this.dropdown.classList.add(this.dropdownDirectionClasses.top),this.dropdown.style.marginTop=`${this.dropdownSpace}px`):(this.dropdown.classList.remove("top-full"),(g=this.dropdownDirectionClasses)!=null&&g.top&&this.dropdown.classList.remove(this.dropdownDirectionClasses.top),this.dropdown.style.marginTop="",this.dropdown.classList.add("bottom-full"),(A=this.dropdownDirectionClasses)!=null&&A.bottom&&this.dropdown.classList.add(this.dropdownDirectionClasses.bottom),this.dropdown.style.marginBottom=`${this.dropdownSpace}px`)}static getInstance(s,u){const g=window.$hsSelectCollection.find(A=>A.element.el===(typeof s=="string"?document.querySelector(s):s));return g?u?g:g.element:null}static autoInit(){window.$hsSelectCollection||(window.$hsSelectCollection=[]),document.querySelectorAll("[data-hs-select]:not(.--prevent-on-load-init)").forEach(s=>{if(!window.$hsSelectCollection.find(u=>{var g;return((g=u==null?void 0:u.element)==null?void 0:g.el)===s})){const u=s.getAttribute("data-hs-select"),g=u?JSON.parse(u):{};new Dh(s,g)}}),window.$hsSelectCollection&&(window.addEventListener("click",s=>{const u=s.target;Dh.closeCurrentlyOpened(u)}),document.addEventListener("keydown",s=>Dh.accessibility(s)))}static open(s){const u=window.$hsSelectCollection.find(g=>g.element.el===(typeof s=="string"?document.querySelector(s):s));u&&!u.element.isOpened&&u.element.open()}static close(s){const u=window.$hsSelectCollection.find(g=>g.element.el===(typeof s=="string"?document.querySelector(s):s));u&&u.element.isOpened&&u.element.close()}static closeCurrentlyOpened(s=null){if(!s.closest(".hs-select.active")){const u=window.$hsSelectCollection.filter(g=>g.element.isOpened)||null;u&&u.forEach(g=>{g.element.close()})}}static accessibility(s){if(window.$hsSelectCollection.find(g=>g.element.isOpened)&&gR.includes(s.code)&&!s.metaKey)switch(s.code){case"Escape":s.preventDefault(),this.onEscape();break;case"ArrowUp":s.preventDefault(),s.stopImmediatePropagation(),this.onArrow();break;case"ArrowDown":s.preventDefault(),s.stopImmediatePropagation(),this.onArrow(!1);break;case"Tab":s.preventDefault(),s.stopImmediatePropagation(),this.onTab(s.shiftKey);break;case"Home":s.preventDefault(),s.stopImmediatePropagation(),this.onStartEnd();break;case"End":s.preventDefault(),s.stopImmediatePropagation(),this.onStartEnd(!1);break;case"Enter":s.preventDefault(),this.onEnter(s);break}}static onEscape(){const s=window.$hsSelectCollection.find(u=>u.element.isOpened);s&&s.element.close()}static onArrow(s=!0){const u=window.$hsSelectCollection.find(g=>g.element.isOpened);if(u){const g=u.element.dropdown;if(!g)return!1;const E=(s?Array.from(g.querySelectorAll(":scope > *:not(.hidden)")).reverse():Array.from(g.querySelectorAll(":scope > *:not(.hidden)"))).filter(U=>!U.classList.contains("disabled")),O=g.querySelector(".hs-select-option-highlighted")||g.querySelector(".selected");O||E[0].classList.add("hs-select-option-highlighted");let r=E.findIndex(U=>U===O);r+1<E.length&&r++,E[r].focus(),O&&O.classList.remove("hs-select-option-highlighted"),E[r].classList.add("hs-select-option-highlighted")}}static onTab(s=!0){const u=window.$hsSelectCollection.find(g=>g.element.isOpened);if(u){const g=u.element.dropdown;if(!g)return!1;const E=(s?Array.from(g.querySelectorAll(":scope >  *:not(.hidden)")).reverse():Array.from(g.querySelectorAll(":scope >  *:not(.hidden)"))).filter(U=>!U.classList.contains("disabled")),O=g.querySelector(".hs-select-option-highlighted")||g.querySelector(".selected");O||E[0].classList.add("hs-select-option-highlighted");let r=E.findIndex(U=>U===O);if(r+1<E.length)r++;else return O&&O.classList.remove("hs-select-option-highlighted"),u.element.close(),u.element.toggle.focus(),!1;E[r].focus(),O&&O.classList.remove("hs-select-option-highlighted"),E[r].classList.add("hs-select-option-highlighted")}}static onStartEnd(s=!0){const u=window.$hsSelectCollection.find(g=>g.element.isOpened);if(u){const g=u.element.dropdown;if(!g)return!1;const E=(s?Array.from(g.querySelectorAll(":scope >  *:not(.hidden)")):Array.from(g.querySelectorAll(":scope >  *:not(.hidden)")).reverse()).filter(r=>!r.classList.contains("disabled")),O=g.querySelector(".hs-select-option-highlighted");E.length&&(E[0].focus(),O&&O.classList.remove("hs-select-option-highlighted"),E[0].classList.add("hs-select-option-highlighted"))}}static onEnter(s){const u=s.target.previousSibling;if(window.$hsSelectCollection.find(g=>g.element.el===u)){const g=window.$hsSelectCollection.find(E=>E.element.isOpened),A=window.$hsSelectCollection.find(E=>E.element.el===u);g.element.close(),A.element.open()}else{const g=window.$hsSelectCollection.find(A=>A.element.isOpened);g&&g.element.onSelectOption(s.target.dataset.value||"")}}}window.addEventListener("load",()=>{Dh.autoInit()});document.addEventListener("scroll",()=>{if(!window.$hsSelectCollection)return!1;const d=window.$hsSelectCollection.find(s=>s.element.isOpened);d&&d.element.recalculateDirection()});typeof window<"u"&&(window.HSSelect=Dh);/*
 * HSStepper
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class Op extends as{constructor(s,u){super(s,u);const g=s.getAttribute("data-hs-stepper"),E={...g?JSON.parse(g):{},...u};this.currentIndex=(E==null?void 0:E.currentIndex)||1,this.mode=(E==null?void 0:E.mode)||"linear",this.isCompleted=typeof(E==null?void 0:E.isCompleted)<"u"?E==null?void 0:E.isCompleted:!1,this.totalSteps=1,this.navItems=[],this.contentItems=[],this.init()}init(){this.createCollection(window.$hsStepperCollection,this),this.buildNav(),this.buildContent(),this.buildButtons(),this.setTotalSteps()}getUncompletedSteps(s=!1){return this.navItems.filter(({isCompleted:u,isSkip:g})=>s?!u||g:!u&&!g)}setTotalSteps(){this.navItems.forEach(s=>{const{index:u}=s;u>this.totalSteps&&(this.totalSteps=u)})}buildNav(){this.el.querySelectorAll("[data-hs-stepper-nav-item]").forEach(s=>this.addNavItem(s)),this.navItems.forEach(s=>this.buildNavItem(s))}buildNavItem(s){const{index:u,isDisabled:g,el:A}=s;u===this.currentIndex&&this.setCurrentNavItem(),(this.mode!=="linear"||g)&&A.addEventListener("click",()=>this.handleNavItemClick(s))}addNavItem(s){const{index:u,isFinal:g=!1,isCompleted:A=!1,isSkip:E=!1,isOptional:O=!1,isDisabled:r=!1,isProcessed:U=!1,hasError:W=!1}=JSON.parse(s.getAttribute("data-hs-stepper-nav-item"));A&&s.classList.add("success"),E&&s.classList.add("skipped"),r&&((s.tagName==="BUTTON"||s.tagName==="INPUT")&&s.setAttribute("disabled","disabled"),s.classList.add("disabled")),W&&s.classList.add("error"),this.navItems.push({index:u,isFinal:g,isCompleted:A,isSkip:E,isOptional:O,isDisabled:r,isProcessed:U,hasError:W,el:s})}setCurrentNavItem(){this.navItems.forEach(s=>{const{index:u,el:g}=s;u===this.currentIndex?this.setCurrentNavItemActions(g):this.unsetCurrentNavItemActions(g)})}setCurrentNavItemActions(s){s.classList.add("active"),this.fireEvent("active",this.currentIndex),to("active.hs.stepper",this.el,this.currentIndex)}getNavItem(s=this.currentIndex){return this.navItems.find(({index:u})=>u===s)}setProcessedNavItemActions(s){s.isProcessed=!0,s.el.classList.add("processed")}setErrorNavItemActions(s){s.hasError=!0,s.el.classList.add("error")}unsetCurrentNavItemActions(s){s.classList.remove("active")}handleNavItemClick(s){const{index:u}=s;this.currentIndex=u,this.setCurrentNavItem(),this.setCurrentContentItem(),this.checkForTheFirstStep()}buildContent(){this.el.querySelectorAll("[data-hs-stepper-content-item]").forEach(s=>this.addContentItem(s)),this.navItems.forEach(s=>this.buildContentItem(s))}buildContentItem(s){const{index:u}=s;u===this.currentIndex&&this.setCurrentContentItem()}addContentItem(s){const{index:u,isFinal:g=!1,isCompleted:A=!1,isSkip:E=!1}=JSON.parse(s.getAttribute("data-hs-stepper-content-item"));A&&s.classList.add("success"),E&&s.classList.add("skipped"),this.contentItems.push({index:u,isFinal:g,isCompleted:A,isSkip:E,el:s})}setCurrentContentItem(){if(this.isCompleted){const s=this.contentItems.find(({isFinal:g})=>g),u=this.contentItems.filter(({isFinal:g})=>!g);return s.el.style.display="",u.forEach(({el:g})=>g.style.display="none"),!1}this.contentItems.forEach(s=>{const{index:u,el:g}=s;u===this.currentIndex?this.setCurrentContentItemActions(g):this.unsetCurrentContentItemActions(g)})}hideAllContentItems(){this.contentItems.forEach(({el:s})=>s.style.display="none")}setCurrentContentItemActions(s){s.style.display=""}unsetCurrentContentItemActions(s){s.style.display="none"}disableAll(){const s=this.getNavItem(this.currentIndex);s.hasError=!1,s.isCompleted=!1,s.isDisabled=!1,s.el.classList.remove("error","success"),this.disableButtons()}disableNavItemActions(s){s.isDisabled=!0,s.el.classList.add("disabled")}enableNavItemActions(s){s.isDisabled=!1,s.el.classList.remove("disabled")}buildButtons(){this.backBtn=this.el.querySelector("[data-hs-stepper-back-btn]"),this.nextBtn=this.el.querySelector("[data-hs-stepper-next-btn]"),this.skipBtn=this.el.querySelector("[data-hs-stepper-skip-btn]"),this.completeStepBtn=this.el.querySelector("[data-hs-stepper-complete-step-btn]"),this.finishBtn=this.el.querySelector("[data-hs-stepper-finish-btn]"),this.resetBtn=this.el.querySelector("[data-hs-stepper-reset-btn]"),this.buildBackButton(),this.buildNextButton(),this.buildSkipButton(),this.buildCompleteStepButton(),this.buildFinishButton(),this.buildResetButton()}buildBackButton(){this.backBtn&&(this.checkForTheFirstStep(),this.backBtn.addEventListener("click",()=>{if(this.handleBackButtonClick(),this.mode==="linear"){const s=this.navItems.find(({index:g})=>g===this.currentIndex),u=this.contentItems.find(({index:g})=>g===this.currentIndex);if(!s||!u)return;s.isCompleted&&(s.isCompleted=!1,s.isSkip=!1,s.el.classList.remove("success","skipped")),u.isCompleted&&(u.isCompleted=!1,u.isSkip=!1,u.el.classList.remove("success","skipped")),this.mode==="linear"&&this.currentIndex!==this.totalSteps&&(this.nextBtn&&(this.nextBtn.style.display=""),this.completeStepBtn&&(this.completeStepBtn.style.display="")),this.showSkipButton(),this.showFinishButton(),this.showCompleteStepButton()}}))}handleBackButtonClick(){this.currentIndex!==1&&(this.mode==="linear"&&this.removeOptionalClasses(),this.currentIndex--,this.mode==="linear"&&this.removeOptionalClasses(),this.setCurrentNavItem(),this.setCurrentContentItem(),this.checkForTheFirstStep(),this.completeStepBtn&&this.changeTextAndDisableCompleteButtonIfStepCompleted(),this.fireEvent("back",this.currentIndex),to("back.hs.stepper",this.el,this.currentIndex))}checkForTheFirstStep(){this.currentIndex===1?this.setToDisabled(this.backBtn):this.setToNonDisabled(this.backBtn)}setToDisabled(s){(s.tagName==="BUTTON"||s.tagName==="INPUT")&&s.setAttribute("disabled","disabled"),s.classList.add("disabled")}setToNonDisabled(s){(s.tagName==="BUTTON"||s.tagName==="INPUT")&&s.removeAttribute("disabled"),s.classList.remove("disabled")}buildNextButton(){this.nextBtn&&this.nextBtn.addEventListener("click",()=>{var s;if(this.fireEvent("beforeNext",this.currentIndex),to("beforeNext.hs.stepper",this.el,this.currentIndex),(s=this.getNavItem(this.currentIndex))!=null&&s.isProcessed)return this.disableAll(),!1;this.goToNext()})}unsetProcessedNavItemActions(s){s.isProcessed=!1,s.el.classList.remove("processed")}handleNextButtonClick(s=!0){if(s)this.currentIndex===this.totalSteps?this.currentIndex=1:this.currentIndex++;else{const u=this.getUncompletedSteps();if(u.length===1){const{index:g}=u[0];this.currentIndex=g}else{if(this.currentIndex===this.totalSteps)return;this.currentIndex++}}this.mode==="linear"&&this.removeOptionalClasses(),this.setCurrentNavItem(),this.setCurrentContentItem(),this.checkForTheFirstStep(),this.completeStepBtn&&this.changeTextAndDisableCompleteButtonIfStepCompleted(),this.showSkipButton(),this.showFinishButton(),this.showCompleteStepButton(),this.fireEvent("next",this.currentIndex),to("next.hs.stepper",this.el,this.currentIndex)}removeOptionalClasses(){const s=this.navItems.find(({index:g})=>g===this.currentIndex),u=this.contentItems.find(({index:g})=>g===this.currentIndex);s.isSkip=!1,s.hasError=!1,s.isDisabled=!1,u.isSkip=!1,s.el.classList.remove("skipped","success","error"),u.el.classList.remove("skipped","success","error")}buildSkipButton(){this.skipBtn&&(this.showSkipButton(),this.skipBtn.addEventListener("click",()=>{this.handleSkipButtonClick(),this.mode==="linear"&&this.currentIndex===this.totalSteps&&(this.nextBtn&&(this.nextBtn.style.display="none"),this.completeStepBtn&&(this.completeStepBtn.style.display="none"),this.finishBtn&&(this.finishBtn.style.display=""))}))}setSkipItem(s){const u=this.navItems.find(({index:A})=>A===(s||this.currentIndex)),g=this.contentItems.find(({index:A})=>A===(s||this.currentIndex));!u||!g||(this.setSkipItemActions(u),this.setSkipItemActions(g))}setSkipItemActions(s){s.isSkip=!0,s.el.classList.add("skipped")}showSkipButton(){if(!this.skipBtn)return;const{isOptional:s}=this.navItems.find(({index:u})=>u===this.currentIndex);s?this.skipBtn.style.display="":this.skipBtn.style.display="none"}handleSkipButtonClick(){this.setSkipItem(),this.handleNextButtonClick(),this.fireEvent("skip",this.currentIndex),to("skip.hs.stepper",this.el,this.currentIndex)}buildCompleteStepButton(){this.completeStepBtn&&(this.completeStepBtnDefaultText=this.completeStepBtn.innerText,this.completeStepBtn.addEventListener("click",()=>this.handleCompleteStepButtonClick()))}changeTextAndDisableCompleteButtonIfStepCompleted(){const s=this.navItems.find(({index:g})=>g===this.currentIndex),{completedText:u}=JSON.parse(this.completeStepBtn.getAttribute("data-hs-stepper-complete-step-btn"));s&&(s.isCompleted?(this.completeStepBtn.innerText=u||this.completeStepBtnDefaultText,this.completeStepBtn.setAttribute("disabled","disabled"),this.completeStepBtn.classList.add("disabled")):(this.completeStepBtn.innerText=this.completeStepBtnDefaultText,this.completeStepBtn.removeAttribute("disabled"),this.completeStepBtn.classList.remove("disabled")))}setCompleteItem(s){const u=this.navItems.find(({index:A})=>A===(s||this.currentIndex)),g=this.contentItems.find(({index:A})=>A===(s||this.currentIndex));!u||!g||(this.setCompleteItemActions(u),this.setCompleteItemActions(g))}setCompleteItemActions(s){s.isCompleted=!0,s.el.classList.add("success")}showCompleteStepButton(){if(!this.completeStepBtn)return;this.getUncompletedSteps().length===1?this.completeStepBtn.style.display="none":this.completeStepBtn.style.display=""}handleCompleteStepButtonClick(){this.setCompleteItem(),this.fireEvent("complete",this.currentIndex),to("complete.hs.stepper",this.el,this.currentIndex),this.handleNextButtonClick(!1),this.showFinishButton(),this.showCompleteStepButton(),this.checkForTheFirstStep(),this.completeStepBtn&&this.changeTextAndDisableCompleteButtonIfStepCompleted(),this.showSkipButton()}buildFinishButton(){this.finishBtn&&(this.isCompleted&&this.setCompleted(),this.finishBtn.addEventListener("click",()=>this.handleFinishButtonClick()))}setCompleted(){this.el.classList.add("completed")}unsetCompleted(){this.el.classList.remove("completed")}showFinishButton(){if(!this.finishBtn)return;this.getUncompletedSteps().length===1?this.finishBtn.style.display="":this.finishBtn.style.display="none"}handleFinishButtonClick(){const s=this.getUncompletedSteps(),u=this.getUncompletedSteps(!0),{el:g}=this.contentItems.find(({isFinal:O})=>O);s.length&&s.forEach(({index:O})=>this.setCompleteItem(O)),this.currentIndex=this.totalSteps,this.setCurrentNavItem(),this.hideAllContentItems();const A=this.navItems.find(({index:O})=>O===this.currentIndex);(A?A.el:null).classList.remove("active"),g.style.display="block",this.backBtn&&(this.backBtn.style.display="none"),this.nextBtn&&(this.nextBtn.style.display="none"),this.skipBtn&&(this.skipBtn.style.display="none"),this.completeStepBtn&&(this.completeStepBtn.style.display="none"),this.finishBtn&&(this.finishBtn.style.display="none"),this.resetBtn&&(this.resetBtn.style.display=""),u.length<=1&&(this.isCompleted=!0,this.setCompleted()),this.fireEvent("finish",this.currentIndex),to("finish.hs.stepper",this.el,this.currentIndex)}buildResetButton(){this.resetBtn&&this.resetBtn.addEventListener("click",()=>this.handleResetButtonClick())}handleResetButtonClick(){this.backBtn&&(this.backBtn.style.display=""),this.nextBtn&&(this.nextBtn.style.display=""),this.completeStepBtn&&(this.completeStepBtn.style.display="",this.completeStepBtn.innerText=this.completeStepBtnDefaultText,this.completeStepBtn.removeAttribute("disabled"),this.completeStepBtn.classList.remove("disabled")),this.resetBtn&&(this.resetBtn.style.display="none"),this.navItems.forEach(s=>{const{el:u}=s;s.isSkip=!1,s.isCompleted=!1,this.unsetCurrentNavItemActions(u),u.classList.remove("success","skipped")}),this.contentItems.forEach(s=>{const{el:u}=s;s.isSkip=!1,s.isCompleted=!1,this.unsetCurrentContentItemActions(u),u.classList.remove("success","skipped")}),this.currentIndex=1,this.setCurrentNavItem(),this.setCurrentContentItem(),this.showFinishButton(),this.showCompleteStepButton(),this.checkForTheFirstStep(),this.unsetCompleted(),this.isCompleted=!1,this.fireEvent("reset",this.currentIndex),to("reset.hs.stepper",this.el,this.currentIndex)}setProcessedNavItem(s){const u=this.getNavItem(s);u&&this.setProcessedNavItemActions(u)}unsetProcessedNavItem(s){const u=this.getNavItem(s);u&&this.unsetProcessedNavItemActions(u)}goToNext(){this.mode==="linear"&&this.setCompleteItem(),this.handleNextButtonClick(this.mode!=="linear"),this.mode==="linear"&&this.currentIndex===this.totalSteps&&(this.nextBtn&&(this.nextBtn.style.display="none"),this.completeStepBtn&&(this.completeStepBtn.style.display="none"))}disableButtons(){this.backBtn&&this.setToDisabled(this.backBtn),this.nextBtn&&this.setToDisabled(this.nextBtn)}enableButtons(){this.backBtn&&this.setToNonDisabled(this.backBtn),this.nextBtn&&this.setToNonDisabled(this.nextBtn)}setErrorNavItem(s){const u=this.getNavItem(s);u&&this.setErrorNavItemActions(u)}static getInstance(s,u){const g=window.$hsStepperCollection.find(A=>A.element.el===(typeof s=="string"?document.querySelector(s):s));return g?u?g:g.element:null}static autoInit(){window.$hsStepperCollection||(window.$hsStepperCollection=[]),document.querySelectorAll("[data-hs-stepper]:not(.--prevent-on-load-init)").forEach(s=>{window.$hsStepperCollection.find(u=>{var g;return((g=u==null?void 0:u.element)==null?void 0:g.el)===s})||new Op(s)})}}window.addEventListener("load",()=>{Op.autoInit()});typeof window<"u"&&(window.HSStepper=Op);/*
 * HSStrongPassword
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class Pp extends as{constructor(s,u){super(s,u),this.isOpened=!1,this.strength=0,this.passedRules=new Set;const g=s.getAttribute("data-hs-strong-password"),E={...g?JSON.parse(g):{},...u};this.target=E!=null&&E.target?typeof(E==null?void 0:E.target)=="string"?document.querySelector(E.target):E.target:null,this.hints=E!=null&&E.hints?typeof(E==null?void 0:E.hints)=="string"?document.querySelector(E.hints):E.hints:null,this.stripClasses=(E==null?void 0:E.stripClasses)||null,this.minLength=(E==null?void 0:E.minLength)||6,this.mode=(E==null?void 0:E.mode)||"default",this.popoverSpace=(E==null?void 0:E.popoverSpace)||10,this.checksExclude=(E==null?void 0:E.checksExclude)||[],this.availableChecks=["lowercase","uppercase","numbers","special-characters","min-length"].filter(O=>!this.checksExclude.includes(O)),this.specialCharactersSet=(E==null?void 0:E.specialCharactersSet)||"!\"#$%&'()*+,-./:;<=>?@[\\\\\\]^_`{|}~",this.target&&this.init()}init(){this.createCollection(window.$hsStrongPasswordCollection,this),this.availableChecks.length&&this.build()}build(){this.buildStrips(),this.hints&&this.buildHints(),this.setStrength(this.target.value),this.target.addEventListener("input",s=>{this.setStrength(s.target.value)})}buildStrips(){if(this.el.innerHTML="",this.stripClasses)for(let s=0;s<this.availableChecks.length;s++){const u=Wr("<div></div>");Pa(this.stripClasses,u),this.el.append(u)}}buildHints(){this.weakness=this.hints.querySelector("[data-hs-strong-password-hints-weakness-text]")||null,this.rules=Array.from(this.hints.querySelectorAll("[data-hs-strong-password-hints-rule-text]"))||null,this.rules.forEach(s=>{var g;const u=s.getAttribute("data-hs-strong-password-hints-rule-text");(g=this.checksExclude)!=null&&g.includes(u)&&s.remove()}),this.weakness&&this.buildWeakness(),this.rules&&this.buildRules(),this.mode==="popover"&&(this.target.addEventListener("focus",()=>{this.isOpened=!0,this.hints.classList.remove("hidden"),this.hints.classList.add("block"),this.recalculateDirection()}),this.target.addEventListener("blur",()=>{this.isOpened=!1,this.hints.classList.remove("block","bottom-full","top-full"),this.hints.classList.add("hidden"),this.hints.style.marginTop="",this.hints.style.marginBottom=""}))}buildWeakness(){this.checkStrength(this.target.value),this.setWeaknessText(),this.target.addEventListener("input",()=>setTimeout(()=>this.setWeaknessText()))}buildRules(){this.setRulesText(),this.target.addEventListener("input",()=>setTimeout(()=>this.setRulesText()))}setWeaknessText(){const s=this.weakness.getAttribute("data-hs-strong-password-hints-weakness-text"),u=JSON.parse(s);this.weakness.textContent=u[this.strength]}setRulesText(){this.rules.forEach(s=>{const u=s.getAttribute("data-hs-strong-password-hints-rule-text");this.checkIfPassed(s,this.passedRules.has(u))})}togglePopover(){const s=this.el.querySelector(".popover");s&&s.classList.toggle("show")}checkStrength(s){const u=new Set,g={lowercase:/[a-z]+/,uppercase:/[A-Z]+/,numbers:/[0-9]+/,"special-characters":new RegExp(`[${this.specialCharactersSet}]`)};let A=0;return this.availableChecks.includes("lowercase")&&s.match(g.lowercase)&&(A+=1,u.add("lowercase")),this.availableChecks.includes("uppercase")&&s.match(g.uppercase)&&(A+=1,u.add("uppercase")),this.availableChecks.includes("numbers")&&s.match(g.numbers)&&(A+=1,u.add("numbers")),this.availableChecks.includes("special-characters")&&s.match(g["special-characters"])&&(A+=1,u.add("special-characters")),this.availableChecks.includes("min-length")&&s.length>=this.minLength&&(A+=1,u.add("min-length")),s.length||(A=0),A===this.availableChecks.length?this.el.classList.add("accepted"):this.el.classList.remove("accepted"),this.strength=A,this.passedRules=u,{strength:this.strength,rules:this.passedRules}}checkIfPassed(s,u=!1){const g=s.querySelector("[data-check]"),A=s.querySelector("[data-uncheck]");u?(s.classList.add("active"),g.classList.remove("hidden"),A.classList.add("hidden")):(s.classList.remove("active"),g.classList.add("hidden"),A.classList.remove("hidden"))}setStrength(s){const{strength:u,rules:g}=this.checkStrength(s),A={strength:u,rules:g};this.hideStrips(u),this.fireEvent("change",A),to("change.hs.strongPassword",this.el,A)}hideStrips(s){Array.from(this.el.children).forEach((u,g)=>{g<s?u.classList.add("passed"):u.classList.remove("passed")})}recalculateDirection(){uy(this.hints,this.target,"bottom",this.popoverSpace)?(this.hints.classList.remove("bottom-full"),this.hints.classList.add("top-full"),this.hints.style.marginBottom="",this.hints.style.marginTop=`${this.popoverSpace}px`):(this.hints.classList.remove("top-full"),this.hints.classList.add("bottom-full"),this.hints.style.marginTop="",this.hints.style.marginBottom=`${this.popoverSpace}px`)}static getInstance(s){const u=window.$hsStrongPasswordCollection.find(g=>g.element.el===(typeof s=="string"?document.querySelector(s):s));return u?u.element:null}static autoInit(){window.$hsStrongPasswordCollection||(window.$hsStrongPasswordCollection=[]),document.querySelectorAll("[data-hs-strong-password]:not(.--prevent-on-load-init)").forEach(s=>{if(!window.$hsStrongPasswordCollection.find(u=>{var g;return((g=u==null?void 0:u.element)==null?void 0:g.el)===s})){const u=s.getAttribute("data-hs-strong-password"),g=u?JSON.parse(u):{};new Pp(s,g)}})}}window.addEventListener("load",()=>{Pp.autoInit()});document.addEventListener("scroll",()=>{if(!window.$hsStrongPasswordCollection)return!1;const d=window.$hsStrongPasswordCollection.find(s=>s.element.isOpened);d&&d.element.recalculateDirection()});typeof window<"u"&&(window.HSStrongPassword=Pp);/*
 * HSTabs
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class Ud extends as{constructor(s,u,g){super(s,u,g),this.toggles=this.el.querySelectorAll("[data-hs-tab]"),this.extraToggleId=this.el.getAttribute("data-hs-tab-select"),this.extraToggle=document.querySelector(this.extraToggleId),this.current=Array.from(this.toggles).find(A=>A.classList.contains("active")),this.currentContentId=this.current.getAttribute("data-hs-tab"),this.currentContent=document.querySelector(this.currentContentId),this.prev=null,this.prevContentId=null,this.prevContent=null,this.init()}init(){this.createCollection(window.$hsTabsCollection,this),this.toggles.forEach(s=>{s.addEventListener("click",()=>this.open(s))}),this.extraToggle&&this.extraToggle.addEventListener("change",s=>this.change(s))}open(s){var u,g;this.prev=this.current,this.prevContentId=this.currentContentId,this.prevContent=this.currentContent,this.current=s,this.currentContentId=this.current.getAttribute("data-hs-tab"),this.currentContent=document.querySelector(this.currentContentId),(u=this==null?void 0:this.prev)!=null&&u.ariaSelected&&(this.prev.ariaSelected="false"),this.prev.classList.remove("active"),this.prevContent.classList.add("hidden"),(g=this==null?void 0:this.current)!=null&&g.ariaSelected&&(this.current.ariaSelected="true"),this.current.classList.add("active"),this.currentContent.classList.remove("hidden"),this.fireEvent("change",{el:s,prev:this.prevContentId,current:this.currentContentId}),to("change.hs.tab",s,{el:s,prev:this.prevContentId,current:this.currentContentId})}change(s){const u=document.querySelector(`[data-hs-tab="${s.target.value}"]`);u&&u.click()}static getInstance(s,u){const g=window.$hsTabsCollection.find(A=>A.element.el===(typeof s=="string"?document.querySelector(s):s));return g?u?g:g.element:null}static autoInit(){window.$hsTabsCollection||(window.$hsTabsCollection=[]),document.querySelectorAll('[role="tablist"]:not(select):not(.--prevent-on-load-init)').forEach(s=>{window.$hsTabsCollection.find(u=>{var g;return((g=u==null?void 0:u.element)==null?void 0:g.el)===s})||new Ud(s)}),window.$hsTabsCollection&&document.addEventListener("keydown",s=>Ud.accessibility(s))}static open(s){const u=window.$hsTabsCollection.find(A=>Array.from(A.element.toggles).includes(typeof s=="string"?document.querySelector(s):s)),g=Array.from(u.element.toggles).find(A=>A===(typeof s=="string"?document.querySelector(s):s));g&&!g.classList.contains("active")&&u.element.open(g)}static accessibility(s){const u=document.querySelector("[data-hs-tab]:focus");if(u&&mR.includes(s.code)&&!s.metaKey){const g=u.closest('[role="tablist"]').getAttribute("data-hs-tabs-vertical");switch(s.preventDefault(),s.code){case(g==="true"?"ArrowUp":"ArrowLeft"):this.onArrow();break;case(g==="true"?"ArrowDown":"ArrowRight"):this.onArrow(!1);break;case"Home":this.onStartEnd();break;case"End":this.onStartEnd(!1);break}}}static onArrow(s=!0){const u=document.querySelector("[data-hs-tab]:focus").closest('[role="tablist"]'),g=window.$hsTabsCollection.find(A=>A.element.el===u);if(g){const A=s?Array.from(g.element.toggles).reverse():Array.from(g.element.toggles),E=A.find(r=>document.activeElement===r);let O=A.findIndex(r=>r===E);O=O+1<A.length?O+1:0,A[O].focus(),A[O].click()}}static onStartEnd(s=!0){const u=document.querySelector("[data-hs-tab]:focus").closest('[role="tablist"]'),g=window.$hsTabsCollection.find(A=>A.element.el===u);if(g){const A=s?Array.from(g.element.toggles):Array.from(g.element.toggles).reverse();A.length&&(A[0].focus(),A[0].click())}}static on(s,u,g){const A=window.$hsTabsCollection.find(E=>Array.from(E.element.toggles).includes(typeof u=="string"?document.querySelector(u):u));A&&(A.element.events[s]=g)}}window.addEventListener("load",()=>{Ud.autoInit()});typeof window<"u"&&(window.HSTabs=Ud);/*
 * HSThemeSwitch
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class jd extends as{constructor(s,u){super(s,u);const g=s.getAttribute("data-hs-theme-switch"),E={...g?JSON.parse(g):{},...u};this.theme=(E==null?void 0:E.theme)||localStorage.getItem("hs_theme")||"default",this.themeSet=["light","dark","default"],this.init()}init(){this.createCollection(window.$hsThemeSwitchCollection,this),this.theme!=="default"&&this.setAppearance()}setResetStyles(){const s=document.createElement("style");return s.innerText="*{transition: unset !important;}",s.setAttribute("data-hs-appearance-onload-styles",""),document.head.appendChild(s),s}addSystemThemeObserver(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:s})=>{s?this.setAppearance("dark",!1):this.setAppearance("default",!1)})}removeSystemThemeObserver(){window.matchMedia("(prefers-color-scheme: dark)").removeEventListener}setAppearance(s=this.theme,u=!0,g=!0){const A=document.querySelector("html"),E=this.setResetStyles();u&&localStorage.setItem("hs_theme",s),s==="auto"&&(s=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"default"),A.classList.remove("light","dark","default","auto"),A.classList.add(s),setTimeout(()=>E.remove()),g&&window.dispatchEvent(new CustomEvent("on-hs-appearance-change",{detail:s}))}static getInstance(s){const u=window.$hsThemeSwitchCollection.find(g=>g.element.el===(typeof s=="string"?document.querySelector(s):s));return u?u.element:null}static autoInit(){window.$hsThemeSwitchCollection||(window.$hsThemeSwitchCollection=[]);const s=u=>{localStorage.getItem("hs_theme")==="auto"?u.addSystemThemeObserver():u.removeSystemThemeObserver()};document.querySelectorAll("[data-hs-theme-switch]:not(.--prevent-on-load-init)").forEach(u=>{if(!window.$hsThemeSwitchCollection.find(g=>{var A;return((A=g==null?void 0:g.element)==null?void 0:A.el)===u})){const g=new jd(u);g.el.checked=g.theme==="dark",s(g),g.el.addEventListener("change",A=>{const E=A.target.checked?"dark":"default";g.setAppearance(E),s(g)})}}),document.querySelectorAll("[data-hs-theme-click-value]:not(.--prevent-on-load-init)").forEach(u=>{const g=u.getAttribute("data-hs-theme-click-value"),A=new jd(u);s(A),A.el.addEventListener("click",()=>{A.setAppearance(g),s(A)})})}}window.addEventListener("load",()=>{jd.autoInit()});window.$hsThemeSwitchCollection&&window.addEventListener("on-hs-appearance-change",d=>{window.$hsThemeSwitchCollection.forEach(s=>{s.element.el.checked=d.detail==="dark"})});typeof window<"u"&&(window.HSThemeSwitch=jd);/*
 * HSToggleCount
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class Dp extends as{constructor(s,u){super(s,u);const g=s.getAttribute("data-hs-toggle-count"),E={...g?JSON.parse(g):{},...u};this.target=E!=null&&E.target?typeof(E==null?void 0:E.target)=="string"?document.querySelector(E.target):E.target:null,this.min=(E==null?void 0:E.min)||0,this.max=(E==null?void 0:E.max)||0,this.duration=(E==null?void 0:E.duration)||700,this.isChecked=this.target.checked||!1,this.target&&this.init()}init(){this.createCollection(window.$hsToggleCountCollection,this),this.isChecked&&(this.el.innerText=String(this.max)),this.target.addEventListener("change",()=>{this.isChecked=!this.isChecked,this.toggle()})}toggle(){this.isChecked?this.countUp():this.countDown()}animate(s,u){let g=0;const A=E=>{g||(g=E);const O=Math.min((E-g)/this.duration,1);this.el.innerText=String(Math.floor(O*(u-s)+s)),O<1&&window.requestAnimationFrame(A)};window.requestAnimationFrame(A)}countUp(){this.animate(this.min,this.max)}countDown(){this.animate(this.max,this.min)}static getInstance(s,u){const g=window.$hsToggleCountCollection.find(A=>A.element.el===(typeof s=="string"?document.querySelector(s):s));return g?u?g:g.element:null}static autoInit(){window.$hsToggleCountCollection||(window.$hsToggleCountCollection=[]),document.querySelectorAll("[data-hs-toggle-count]:not(.--prevent-on-load-init)").forEach(s=>{window.$hsToggleCountCollection.find(u=>{var g;return((g=u==null?void 0:u.element)==null?void 0:g.el)===s})||new Dp(s)})}}window.addEventListener("load",()=>{Dp.autoInit()});typeof window<"u"&&(window.HSToggleCount=Dp);/*
 * HSTogglePassword
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class qd extends as{constructor(s,u){super(s,u);const g=s.getAttribute("data-hs-toggle-password"),E={...g?JSON.parse(g):{},...u},O=[];E!=null&&E.target&&typeof(E==null?void 0:E.target)=="string"?(E==null?void 0:E.target.split(",")).forEach(U=>{O.push(document.querySelector(U))}):E!=null&&E.target&&typeof(E==null?void 0:E.target)=="object"?E.target.forEach(r=>O.push(document.querySelector(r))):E.target.forEach(r=>O.push(r)),this.target=O,this.isShown=this.el.hasAttribute("type")?this.el.checked:!1,this.eventType=dR(this.el)?"change":"click",this.isMultiple=this.target.length>1&&!!this.el.closest("[data-hs-toggle-password-group]"),this.target&&this.init()}init(){this.createCollection(window.$hsTogglePasswordCollection,this),this.isShown?this.show():this.hide(),this.el.addEventListener(this.eventType,()=>{this.isShown?this.hide():this.show(),this.fireEvent("toggle",this.target),to("toggle.hs.toggle-select",this.el,this.target)})}getMultipleToggles(){const u=this.el.closest("[data-hs-toggle-password-group]").querySelectorAll("[data-hs-toggle-password]"),g=[];return u.forEach(A=>{g.push(qd.getInstance(A))}),g}show(){this.isMultiple?(this.getMultipleToggles().forEach(u=>u?u.isShown=!0:!1),this.el.closest("[data-hs-toggle-password-group]").classList.add("active")):(this.isShown=!0,this.el.classList.add("active")),this.target.forEach(s=>{s.type="text"})}hide(){this.isMultiple?(this.getMultipleToggles().forEach(u=>u?u.isShown=!1:!1),this.el.closest("[data-hs-toggle-password-group]").classList.remove("active")):(this.isShown=!1,this.el.classList.remove("active")),this.target.forEach(s=>{s.type="password"})}static getInstance(s,u){const g=window.$hsTogglePasswordCollection.find(A=>A.element.el===(typeof s=="string"?document.querySelector(s):s));return g?u?g:g.element:null}static autoInit(){window.$hsTogglePasswordCollection||(window.$hsTogglePasswordCollection=[]),document.querySelectorAll("[data-hs-toggle-password]:not(.--prevent-on-load-init)").forEach(s=>{window.$hsTogglePasswordCollection.find(u=>{var g;return((g=u==null?void 0:u.element)==null?void 0:g.el)===s})||new qd(s)})}}window.addEventListener("load",()=>{qd.autoInit()});typeof window<"u"&&(window.HSTogglePassword=qd);/*
 * HSTooltip
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class Rp extends as{constructor(s,u,g){super(s,u,g),this.el&&(this.toggle=this.el.querySelector(".hs-tooltip-toggle")||this.el,this.content=this.el.querySelector(".hs-tooltip-content"),this.eventMode=Ho(this.el,"--trigger")||"hover",this.preventPopper=Ho(this.el,"--prevent-popper","false"),this.placement=Ho(this.el,"--placement"),this.strategy=Ho(this.el,"--strategy")),this.el&&this.toggle&&this.content&&this.init()}init(){this.createCollection(window.$hsTooltipCollection,this),this.eventMode==="click"?this.toggle.addEventListener("click",()=>this.click()):this.eventMode==="focus"?this.toggle.addEventListener("click",()=>this.focus()):this.eventMode==="hover"&&(this.toggle.addEventListener("mouseenter",()=>this.enter()),this.toggle.addEventListener("mouseleave",()=>this.leave())),this.preventPopper==="false"&&this.buildPopper()}enter(){this.show()}leave(){this.hide()}click(){if(this.el.classList.contains("show"))return!1;this.show();const s=()=>{setTimeout(()=>{this.hide(),this.toggle.removeEventListener("click",s,!0),this.toggle.removeEventListener("blur",s,!0)})};this.toggle.addEventListener("click",s,!0),this.toggle.addEventListener("blur",s,!0)}focus(){this.show();const s=()=>{this.hide(),this.toggle.removeEventListener("blur",s,!0)};this.toggle.addEventListener("blur",s,!0)}buildPopper(){this.popperInstance=uE(this.toggle,this.content,{placement:eE[this.placement]||"top",strategy:this.strategy||"fixed",modifiers:[{name:"offset",options:{offset:[0,5]}}]})}show(){this.content.classList.remove("hidden"),this.preventPopper==="false"&&(this.popperInstance.setOptions(s=>({...s,modifiers:[...s.modifiers,{name:"eventListeners",enabled:!0}]})),this.popperInstance.update()),setTimeout(()=>{this.el.classList.add("show"),this.fireEvent("show",this.el),to("show.hs.tooltip",this.el,this.el)})}hide(){this.el.classList.remove("show"),this.preventPopper==="false"&&this.popperInstance.setOptions(s=>({...s,modifiers:[...s.modifiers,{name:"eventListeners",enabled:!1}]})),this.fireEvent("hide",this.el),to("hide.hs.tooltip",this.el,this.el),vl(this.content,()=>{if(this.el.classList.contains("show"))return!1;this.content.classList.add("hidden")})}static getInstance(s,u=!1){const g=window.$hsTooltipCollection.find(A=>A.element.el===(typeof s=="string"?document.querySelector(s):s));return g?u?g:g.element.el:null}static autoInit(){window.$hsTooltipCollection||(window.$hsTooltipCollection=[]),document.querySelectorAll(".hs-tooltip").forEach(s=>{window.$hsTooltipCollection.find(u=>{var g;return((g=u==null?void 0:u.element)==null?void 0:g.el)===s})||new Rp(s)})}static show(s){const u=window.$hsTooltipCollection.find(g=>g.element.el===(typeof s=="string"?document.querySelector(s):s));if(u)switch(u.element.eventMode){case"click":u.element.click();break;case"focus":u.element.focus();break;default:u.element.enter();break}}static hide(s){const u=window.$hsTooltipCollection.find(g=>g.element.el===(typeof s=="string"?document.querySelector(s):s));u&&u.element.hide()}static on(s,u,g){const A=window.$hsTooltipCollection.find(E=>E.element.el===(typeof u=="string"?document.querySelector(u):u));A&&(A.element.events[s]=g)}}window.addEventListener("load",()=>{Rp.autoInit()});typeof window<"u"&&(window.HSTooltip=Rp);/*
 * HSDataTable
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */class kp extends as{constructor(s,u,g){var r,U,W,Y,se,Ae,Ce,he,K,N,z;super(s,u,g),this.el=typeof s=="string"?document.querySelector(s):s;const A=[];Array.from(this.el.querySelectorAll("thead th, thead td")).forEach((q,G)=>{q.classList.contains("--exclude-from-ordering")&&A.push({targets:G,orderable:!1})});const E=this.el.getAttribute("data-hs-datatable"),O=E?JSON.parse(E):{};this.concatOptions={searching:!0,lengthChange:!1,order:[],columnDefs:[...A],...O,...u},this.table=this.el.querySelector("table"),this.search=this.el.querySelector("[data-hs-datatable-search]")??null,this.pageEntities=this.el.querySelector("[data-hs-datatable-page-entities]")??null,this.paging=this.el.querySelector("[data-hs-datatable-paging]")??null,this.pagingPrev=this.el.querySelector("[data-hs-datatable-paging-prev]")??null,this.pagingNext=this.el.querySelector("[data-hs-datatable-paging-next]")??null,this.pagingPages=this.el.querySelector("[data-hs-datatable-paging-pages]")??null,this.info=this.el.querySelector("[data-hs-datatable-info]")??null,this.infoFrom=this.el.querySelector("[data-hs-datatable-info-from]")??null,this.infoTo=this.el.querySelector("[data-hs-datatable-info-to]")??null,this.infoLength=this.el.querySelector("[data-hs-datatable-info-length]")??null,(r=this.concatOptions)!=null&&r.rowSelectingOptions&&(this.rowSelectingAll=((W=(U=this.concatOptions)==null?void 0:U.rowSelectingOptions)!=null&&W.selectAllSelector?document.querySelector((se=(Y=this.concatOptions)==null?void 0:Y.rowSelectingOptions)==null?void 0:se.selectAllSelector):document.querySelector("[data-hs-datatable-row-selecting-all]"))??null),(Ae=this.concatOptions)!=null&&Ae.rowSelectingOptions&&(this.rowSelectingIndividual=((he=(Ce=this.concatOptions)==null?void 0:Ce.rowSelectingOptions)==null?void 0:he.individualSelector)??"[data-hs-datatable-row-selecting-individual]"??null),this.pageEntities&&(this.concatOptions.pageLength=parseInt(this.pageEntities.value)),this.maxPagesToShow=3,this.isRowSelecting=!!((K=this.concatOptions)!=null&&K.rowSelectingOptions),this.pageBtnClasses=((z=(N=this.concatOptions)==null?void 0:N.pagingOptions)==null?void 0:z.pageBtnClasses)??null,this.init()}init(){this.createCollection(window.$hsDataTableCollection,this),this.initTable(),this.search&&this.initSearch(),this.pageEntities&&this.initPageEntities(),this.paging&&this.initPaging(),this.pagingPrev&&this.initPagingPrev(),this.pagingNext&&this.initPagingNext(),this.pagingPages&&this.buildPagingPages(),this.info&&this.initInfo(),this.isRowSelecting&&this.initRowSelecting()}initTable(){this.dataTable=new DataTable(this.table,this.concatOptions),this.isRowSelecting&&this.triggerChangeEventToRow(),this.dataTable.on("draw",()=>{this.isRowSelecting&&this.updateSelectAllCheckbox(),this.isRowSelecting&&this.triggerChangeEventToRow(),this.updateInfo(),this.updatePaging()})}initSearch(){this.search.addEventListener("input",$g(s=>this.onSearchInput(s.target.value)))}onSearchInput(s){this.dataTable.search(s).draw()}initPageEntities(){this.pageEntities.addEventListener("change",s=>this.onEntitiesChange(parseInt(s.target.value)))}onEntitiesChange(s){this.dataTable.page.len(s).draw()}initInfo(){this.infoFrom&&this.initInfoFrom(),this.infoTo&&this.initInfoTo(),this.infoLength&&this.initInfoLength()}initInfoFrom(){const{start:s}=this.dataTable.page.info();this.infoFrom.innerText=`${s+1}`}initInfoTo(){const{end:s}=this.dataTable.page.info();this.infoTo.innerText=`${s}`}initInfoLength(){const{recordsTotal:s}=this.dataTable.page.info();this.infoLength.innerText=`${s}`}updateInfo(){this.initInfo()}initPaging(){this.hidePagingIfSinglePage()}hidePagingIfSinglePage(){const{pages:s}=this.dataTable.page.info();s<2?(this.paging.classList.add("hidden"),this.paging.style.display="none"):(this.paging.classList.remove("hidden"),this.paging.style.display="")}initPagingPrev(){this.pagingPrev.addEventListener("click",()=>{this.onPrevClick()})}onPrevClick(){this.dataTable.page("previous").draw("page")}disablePagingArrow(s,u){u?(s.classList.add("disabled"),s.setAttribute("disabled","disabled")):(s.classList.remove("disabled"),s.removeAttribute("disabled"))}initPagingNext(){this.pagingNext.addEventListener("click",()=>{this.onNextClick()})}onNextClick(){this.dataTable.page("next").draw("page")}buildPagingPages(){this.updatePaging()}updatePaging(){const{page:s,pages:u,length:g}=this.dataTable.page.info(),A=this.dataTable.rows({search:"applied"}).count(),E=Math.ceil(A/g),O=s+1;let r=Math.max(1,O-Math.floor(this.maxPagesToShow/2)),U=Math.min(E,r+(this.maxPagesToShow-1));U-r+1<this.maxPagesToShow&&(r=Math.max(1,U-this.maxPagesToShow+1)),this.pagingPages.innerHTML="",r>1&&(this.buildPagingPage(1),r>2&&this.pagingPages.appendChild(Wr('<span class="ellipsis">...</span>')));for(let W=r;W<=U;W++)this.buildPagingPage(W);U<E&&(U<E-1&&this.pagingPages.appendChild(Wr('<span class="ellipsis">...</span>')),this.buildPagingPage(E)),this.disablePagingArrow(this.pagingPrev,s===0),this.disablePagingArrow(this.pagingNext,s===u-1),this.hidePagingIfSinglePage()}buildPagingPage(s){const{page:u}=this.dataTable.page.info(),g=Wr('<button type="button"></button>');g.innerText=`${s}`,g.setAttribute("data-page",`${s}`),this.pageBtnClasses&&Pa(this.pageBtnClasses,g),u===s-1&&g.classList.add("active"),g.addEventListener("click",()=>this.onPageClick(s)),this.pagingPages.append(g)}onPageClick(s){this.dataTable.page(s-1).draw("page")}initRowSelecting(){this.rowSelectingAll.addEventListener("change",()=>this.onSelectAllChange())}triggerChangeEventToRow(){this.table.querySelectorAll(`tbody ${this.rowSelectingIndividual}`).forEach(s=>{s.addEventListener("change",()=>{this.updateSelectAllCheckbox()})})}onSelectAllChange(){let s=this.rowSelectingAll.checked;Array.from(this.dataTable.rows({page:"current",search:"applied"}).nodes()).forEach(g=>{const A=g.querySelector(this.rowSelectingIndividual);A&&(A.checked=s)}),this.updateSelectAllCheckbox()}updateSelectAllCheckbox(){if(!this.dataTable.rows({search:"applied"}).count())return this.rowSelectingAll.checked=!1,!1;let u=!0;Array.from(this.dataTable.rows({page:"current",search:"applied"}).nodes()).forEach(A=>{const E=A.querySelector(this.rowSelectingIndividual);if(E&&!E.checked)return u=!1,!1}),this.rowSelectingAll.checked=u}static getInstance(s,u){const g=window.$hsDataTableCollection.find(A=>A.element.el===(typeof s=="string"?document.querySelector(s):s));return g?u?g:g.element.el:null}static autoInit(){window.$hsDataTableCollection||(window.$hsDataTableCollection=[]),document.querySelectorAll("[data-hs-datatable]:not(.--prevent-on-load-init)").forEach(s=>{window.$hsDataTableCollection.find(u=>{var g;return((g=u==null?void 0:u.element)==null?void 0:g.el)===s})||new kp(s)})}}window.addEventListener("load",()=>{document.querySelectorAll("[data-hs-datatable]:not(.--prevent-on-load-init)").length&&(typeof jQuery>"u"&&console.error("HSDataTable: jQuery is not available, please add it to the page."),typeof DataTable>"u"&&console.error("HSDataTable: DataTable is not available, please add it to the page.")),typeof DataTable<"u"&&typeof jQuery<"u"&&kp.autoInit()});typeof window<"u"&&(window.HSDataTable=kp);/*
 * HSFileUpload
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */typeof Dropzone<"u"&&(Dropzone.autoDiscover=!1);class Bp extends as{constructor(s,u,g){var O;super(s,u,g),this.extensions={},this.el=typeof s=="string"?document.querySelector(s):s;const A=this.el.getAttribute("data-hs-file-upload"),E=A?JSON.parse(A):{};this.previewTemplate=((O=this.el.querySelector("[data-hs-file-upload-preview]"))==null?void 0:O.innerHTML)||`<div class="p-3 bg-white border border-solid border-gray-300 rounded-xl dark:bg-neutral-800 dark:border-neutral-600">
			<div class="mb-2 flex justify-between items-center">
				<div class="flex items-center gap-x-3">
					<span class="size-8 flex justify-center items-center border border-gray-200 text-gray-500 rounded-lg dark:border-neutral-700 dark:text-neutral-500" data-hs-file-upload-file-icon></span>
					<div>
						<p class="text-sm font-medium text-gray-800 dark:text-white">
							<span class="truncate inline-block max-w-[300px] align-bottom" data-hs-file-upload-file-name></span>.<span data-hs-file-upload-file-ext></span>
						</p>
						<p class="text-xs text-gray-500 dark:text-neutral-500" data-hs-file-upload-file-size></p>
					</div>
				</div>
				<div class="inline-flex items-center gap-x-2">
					<button type="button" class="text-gray-500 hover:text-gray-800 dark:text-neutral-500 dark:hover:text-neutral-200" data-hs-file-upload-remove>
						<svg class="shrink-0 size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" x2="10" y1="11" y2="17"></line><line x1="14" x2="14" y1="11" y2="17"></line></svg>
					</button>
				</div>
			</div>
			<div class="flex items-center gap-x-3 whitespace-nowrap">
				<div class="flex w-full h-2 bg-gray-200 rounded-full overflow-hidden dark:bg-neutral-700" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" data-hs-file-upload-progress-bar>
					<div class="flex flex-col justify-center rounded-full overflow-hidden bg-blue-600 text-xs text-white text-center whitespace-nowrap transition-all duration-500 hs-file-upload-complete:bg-green-600 dark:bg-blue-500" style="width: 0" data-hs-file-upload-progress-bar-pane></div>
				</div>
				<div class="w-10 text-end">
					<span class="text-sm text-gray-800 dark:text-white">
						<span data-hs-file-upload-progress-bar-value>0</span>%
					</span>
				</div>
			</div>
		</div>`,this.extensions=_.merge({default:{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/></svg>',class:"size-5"},xls:{icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.0243 1.43996H7.08805C6.82501 1.43996 6.57277 1.54445 6.38677 1.73043C6.20077 1.91642 6.09631 2.16868 6.09631 2.43171V6.64796L15.0243 11.856L19.4883 13.7398L23.9523 11.856V6.64796L15.0243 1.43996Z" fill="#21A366"></path><path d="M6.09631 6.64796H15.0243V11.856H6.09631V6.64796Z" fill="#107C41"></path><path d="M22.9605 1.43996H15.0243V6.64796H23.9523V2.43171C23.9523 2.16868 23.8478 1.91642 23.6618 1.73043C23.4758 1.54445 23.2235 1.43996 22.9605 1.43996Z" fill="#33C481"></path><path d="M15.0243 11.856H6.09631V21.2802C6.09631 21.5433 6.20077 21.7955 6.38677 21.9815C6.57277 22.1675 6.82501 22.272 7.08805 22.272H22.9606C23.2236 22.272 23.4759 22.1675 23.6618 21.9815C23.8478 21.7955 23.9523 21.5433 23.9523 21.2802V17.064L15.0243 11.856Z" fill="#185C37"></path><path d="M15.0243 11.856H23.9523V17.064H15.0243V11.856Z" fill="#107C41"></path><path opacity="0.1" d="M12.5446 5.15996H6.09631V19.296H12.5446C12.8073 19.2952 13.0591 19.1904 13.245 19.0046C13.4308 18.8188 13.5355 18.567 13.5363 18.3042V6.1517C13.5355 5.88892 13.4308 5.63712 13.245 5.4513C13.0591 5.26548 12.8073 5.16074 12.5446 5.15996Z" fill="black"></path><path opacity="0.2" d="M11.8006 5.90396H6.09631V20.04H11.8006C12.0633 20.0392 12.3151 19.9344 12.501 19.7486C12.6868 19.5628 12.7915 19.311 12.7923 19.0482V6.8957C12.7915 6.6329 12.6868 6.38114 12.501 6.19532C12.3151 6.0095 12.0633 5.90475 11.8006 5.90396Z" fill="black"></path><path opacity="0.2" d="M11.8006 5.90396H6.09631V18.552H11.8006C12.0633 18.5512 12.3151 18.4464 12.501 18.2606C12.6868 18.0748 12.7915 17.823 12.7923 17.5602V6.8957C12.7915 6.6329 12.6868 6.38114 12.501 6.19532C12.3151 6.0095 12.0633 5.90475 11.8006 5.90396Z" fill="black"></path><path opacity="0.2" d="M11.0566 5.90396H6.09631V18.552H11.0566C11.3193 18.5512 11.5711 18.4464 11.757 18.2606C11.9428 18.0748 12.0475 17.823 12.0483 17.5602V6.8957C12.0475 6.6329 11.9428 6.38114 11.757 6.19532C11.5711 6.0095 11.3193 5.90475 11.0566 5.90396Z" fill="black"></path><path d="M1.13604 5.90396H11.0566C11.3195 5.90396 11.5718 6.00842 11.7578 6.19442C11.9438 6.38042 12.0483 6.63266 12.0483 6.8957V16.8162C12.0483 17.0793 11.9438 17.3315 11.7578 17.5175C11.5718 17.7035 11.3195 17.808 11.0566 17.808H1.13604C0.873012 17.808 0.620754 17.7035 0.434765 17.5175C0.248775 17.3315 0.144287 17.0793 0.144287 16.8162V6.8957C0.144287 6.63266 0.248775 6.38042 0.434765 6.19442C0.620754 6.00842 0.873012 5.90396 1.13604 5.90396Z" fill="#107C41"></path><path d="M2.77283 15.576L5.18041 11.8455L2.9752 8.13596H4.74964L5.95343 10.5071C6.06401 10.7318 6.14015 10.8994 6.18185 11.01H6.19745C6.27683 10.8305 6.35987 10.6559 6.44669 10.4863L7.73309 8.13596H9.36167L7.09991 11.8247L9.41897 15.576H7.68545L6.29489 12.972C6.22943 12.861 6.17387 12.7445 6.12899 12.6238H6.10817C6.06761 12.7419 6.01367 12.855 5.94748 12.9608L4.51676 15.576H2.77283Z" fill="white"></path></svg>',class:"size-5"},doc:{icon:'<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M30.6141 1.91994H9.45071C9.09999 1.91994 8.76367 2.05926 8.51567 2.30725C8.26767 2.55523 8.12839 2.89158 8.12839 3.24228V8.86395L20.0324 12.3359L31.9364 8.86395V3.24228C31.9364 2.89158 31.797 2.55523 31.549 2.30725C31.3011 2.05926 30.9647 1.91994 30.6141 1.91994Z" fill="#41A5EE"></path><path d="M31.9364 8.86395H8.12839V15.8079L20.0324 19.2799L31.9364 15.8079V8.86395Z" fill="#2B7CD3"></path><path d="M31.9364 15.8079H8.12839V22.7519L20.0324 26.2239L31.9364 22.7519V15.8079Z" fill="#185ABD"></path><path d="M31.9364 22.752H8.12839V28.3736C8.12839 28.7244 8.26767 29.0607 8.51567 29.3087C8.76367 29.5567 9.09999 29.696 9.45071 29.696H30.6141C30.9647 29.696 31.3011 29.5567 31.549 29.3087C31.797 29.0607 31.9364 28.7244 31.9364 28.3736V22.752Z" fill="#103F91"></path><path opacity="0.1" d="M16.7261 6.87994H8.12839V25.7279H16.7261C17.0764 25.7269 17.4121 25.5872 17.6599 25.3395C17.9077 25.0917 18.0473 24.756 18.0484 24.4056V8.20226C18.0473 7.8519 17.9077 7.51616 17.6599 7.2684C17.4121 7.02064 17.0764 6.88099 16.7261 6.87994Z" class="fill-black dark:fill-neutral-200" fill="currentColor"></path><path opacity="0.2" d="M15.7341 7.87194H8.12839V26.7199H15.7341C16.0844 26.7189 16.4201 26.5792 16.6679 26.3315C16.9157 26.0837 17.0553 25.748 17.0564 25.3976V9.19426C17.0553 8.84386 16.9157 8.50818 16.6679 8.26042C16.4201 8.01266 16.0844 7.87299 15.7341 7.87194Z" class="fill-black dark:fill-neutral-200" fill="currentColor"></path><path opacity="0.2" d="M15.7341 7.87194H8.12839V24.7359H15.7341C16.0844 24.7349 16.4201 24.5952 16.6679 24.3475C16.9157 24.0997 17.0553 23.764 17.0564 23.4136V9.19426C17.0553 8.84386 16.9157 8.50818 16.6679 8.26042C16.4201 8.01266 16.0844 7.87299 15.7341 7.87194Z" class="fill-black dark:fill-neutral-200" fill="currentColor"></path><path opacity="0.2" d="M14.7421 7.87194H8.12839V24.7359H14.7421C15.0924 24.7349 15.4281 24.5952 15.6759 24.3475C15.9237 24.0997 16.0633 23.764 16.0644 23.4136V9.19426C16.0633 8.84386 15.9237 8.50818 15.6759 8.26042C15.4281 8.01266 15.0924 7.87299 14.7421 7.87194Z" class="fill-black dark:fill-neutral-200" fill="currentColor"></path><path d="M1.51472 7.87194H14.7421C15.0927 7.87194 15.4291 8.01122 15.6771 8.25922C15.925 8.50722 16.0644 8.84354 16.0644 9.19426V22.4216C16.0644 22.7723 15.925 23.1087 15.6771 23.3567C15.4291 23.6047 15.0927 23.7439 14.7421 23.7439H1.51472C1.16401 23.7439 0.827669 23.6047 0.579687 23.3567C0.3317 23.1087 0.192383 22.7723 0.192383 22.4216V9.19426C0.192383 8.84354 0.3317 8.50722 0.579687 8.25922C0.827669 8.01122 1.16401 7.87194 1.51472 7.87194Z" fill="#185ABD"></path><path d="M12.0468 20.7679H10.2612L8.17801 13.9231L5.99558 20.7679H4.20998L2.22598 10.8479H4.01158L5.40038 17.7919L7.48358 11.0463H8.97161L10.9556 17.7919L12.3444 10.8479H14.0308L12.0468 20.7679Z" fill="white"></path></svg>',class:"size-5"},zip:{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 22h2a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v18"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><circle cx="10" cy="20" r="2"/><path d="M10 7V6"/><path d="M10 12v-1"/><path d="M10 18v-2"/></svg>',class:"size-5"}},E.extensions),this.singleton=E.singleton,this.concatOptions={clickable:this.el.querySelector("[data-hs-file-upload-trigger]"),previewsContainer:this.el.querySelector("[data-hs-file-upload-previews]"),addRemoveLinks:!1,previewTemplate:this.previewTemplate,autoHideTrigger:!1,...E,...u},this.init()}init(){this.createCollection(window.$hsFileUploadCollection,this),this.initDropzone()}initDropzone(){const s=this.el.querySelector("[data-hs-file-upload-clear]"),u=Array.from(this.el.querySelectorAll("[data-hs-file-upload-pseudo-trigger]"));this.dropzone=new Dropzone(this.el,this.concatOptions),this.dropzone.on("addedfile",g=>this.onAddFile(g)),this.dropzone.on("removedfile",()=>this.onRemoveFile()),this.dropzone.on("uploadprogress",(g,A)=>this.onUploadProgress(g,A)),this.dropzone.on("complete",g=>this.onComplete(g)),s&&(s.onclick=()=>{this.dropzone.files.length&&this.dropzone.removeAllFiles(!0)}),u.length&&u.forEach(g=>{g.onclick=()=>{var A,E;(A=this.concatOptions)!=null&&A.clickable&&((E=this.concatOptions)==null?void 0:E.clickable).click()}})}onAddFile(s){const{previewElement:u}=s,g=s.previewElement.querySelector("[data-hs-file-upload-reload]");if(!u)return!1;this.singleton&&this.dropzone.files.length>1&&this.dropzone.removeFile(this.dropzone.files[0]),g&&g.addEventListener("click",A=>{A.preventDefault(),A.stopPropagation();const E=document.createElement("input");E.type="file",E.click(),E.addEventListener("change",O=>{var W;const U=(W=O.target.files)==null?void 0:W[0];if(U){const Y=U;Y.status=Dropzone.ADDED,Y.accepted=!0,Y.previewElement=s.previewElement,Y.previewTemplate=s.previewTemplate,Y.previewsContainer=s.previewsContainer,this.dropzone.removeFile(s),this.dropzone.addFile(Y)}})}),this.previewAccepted(s)}previewAccepted(s){const{previewElement:u}=s,g=this.splitFileName(s.name),A=u.querySelector("[data-hs-file-upload-file-name]"),E=u.querySelector("[data-hs-file-upload-file-ext]"),O=u.querySelector("[data-hs-file-upload-file-size]"),r=u.querySelector("[data-hs-file-upload-file-icon]"),U=this.el.querySelector("[data-hs-file-upload-trigger]"),W=u.querySelector("[data-dz-thumbnail]"),Y=u.querySelector("[data-hs-file-upload-remove]");A&&(A.textContent=g.name),E&&(E.textContent=g.extension),O&&(O.textContent=this.formatFileSize(s.size)),W&&(s.type.includes("image/")?W.classList.remove("hidden"):this.setIcon(g.extension,r)),this.dropzone.files.length>0&&this.concatOptions.autoHideTrigger&&(U.style.display="none"),Y&&(Y.onclick=()=>this.dropzone.removeFile(s))}onRemoveFile(){const s=this.el.querySelector("[data-hs-file-upload-trigger]");this.dropzone.files.length===0&&this.concatOptions.autoHideTrigger&&(s.style.display="")}onUploadProgress(s,u){const{previewElement:g}=s;if(!g)return!1;const A=g.querySelector("[data-hs-file-upload-progress-bar]"),E=g.querySelector("[data-hs-file-upload-progress-bar-pane]"),O=g.querySelector("[data-hs-file-upload-progress-bar-value]"),r=Math.floor(u);A&&A.setAttribute("aria-valuenow",`${r}`),E&&(E.style.width=`${r}%`),O&&(O.innerText=`${r}`)}onComplete(s){const{previewElement:u}=s;if(!u)return!1;u.classList.add("complete")}setIcon(s,u){const g=this.createIcon(s);u.append(g)}createIcon(s){var g,A;const u=(g=this.extensions[s])!=null&&g.icon?Wr(this.extensions[s].icon):Wr(this.extensions.default.icon);return Pa((A=this.extensions[s])!=null&&A.class?this.extensions[s].class:this.extensions.default.class,u),u}formatFileSize(s){return s<1024?s.toFixed(2)+" B":s<1024*1024?(s/1024).toFixed(2)+" KB":s<1024*1024*1024?(s/(1024*1024)).toFixed(2)+" MB":s<1024*1024*1024*1024?(s/(1024*1024*1024)).toFixed(2)+" GB":(s/(1024*1024*1024*1024)).toFixed(2)+" TB"}splitFileName(s){let u=s.lastIndexOf(".");return u==-1?{name:s,extension:""}:{name:s.substring(0,u),extension:s.substring(u+1)}}static getInstance(s,u){const g=window.$hsFileUploadCollection.find(A=>A.element.el===(typeof s=="string"?document.querySelector(s):s));return g?u?g:g.element.el:null}static autoInit(){window.$hsFileUploadCollection||(window.$hsFileUploadCollection=[]),document.querySelectorAll("[data-hs-file-upload]:not(.--prevent-on-load-init)").forEach(s=>{window.$hsFileUploadCollection.find(u=>{var g;return((g=u==null?void 0:u.element)==null?void 0:g.el)===s})||new Bp(s)})}}window.addEventListener("load",()=>{document.querySelectorAll("[data-hs-file-upload]:not(.--prevent-on-load-init)").length&&(typeof _>"u"&&console.error("HSFileUpload: Lodash is not available, please add it to the page."),typeof Dropzone>"u"&&console.error("HSFileUpload: Dropzone is not available, please add it to the page.")),typeof _<"u"&&typeof Dropzone<"u"&&Bp.autoInit()});typeof window<"u"&&(window.HSFileUpload=Bp);const Eg=[{key:"copy-markup",fn:bp,collection:"$hsCopyMarkupCollection"},{key:"accordion",fn:Bd,collection:"$hsAccordionCollection"},{key:"carousel",fn:Cp,collection:"$hsCarouselCollection"},{key:"collapse",fn:Ep,collection:"$hsCollapseCollection"},{key:"combobox",fn:ql,collection:"$hsComboBoxCollection"},{key:"datatable",fn:kp,collection:"$hsDataTableCollection"},{key:"dropdown",fn:Wu,collection:"$hsDropdownCollection"},{key:"file-upload",fn:Bp,collection:"$hsFileUploadCollection"},{key:"input-number",fn:Ap,collection:"$hsInputNumberCollection"},{key:"overlay",fn:$u,collection:"$hsOverlayCollection"},{key:"pin-input",fn:Ip,collection:"$hsPinInputCollection"},{key:"remove-element",fn:Mp,collection:"$hsRemoveElementCollection"},{key:"scrollspy",fn:Lp,collection:"$hsScrollspyCollection"},{key:"select",fn:Dh,collection:"$hsSelectCollection"},{key:"stepper",fn:Op,collection:"$hsStepperCollection"},{key:"strong-password",fn:Pp,collection:"$hsStrongPasswordCollection"},{key:"tabs",fn:Ud,collection:"$hsTabsCollection"},{key:"theme-switch",fn:jd,collection:"$hsThemeSwitchCollection"},{key:"toggle-count",fn:Dp,collection:"$hsToggleCountCollection"},{key:"toggle-password",fn:qd,collection:"$hsTogglePasswordCollection"},{key:"tooltip",fn:Rp,collection:"$hsTooltipCollection"}];/*
 * HSStaticMethods
 * @version: 2.4.1
 * @author: Preline Labs Ltd.
 * @license: Licensed under MIT and Preline UI Fair Use License (https://preline.co/docs/license.html)
 * Copyright 2024 Preline Labs Ltd.
 */const Sk={getClassProperty:Ho,afterTransition:vl,autoInit(d="all"){d==="all"?Eg.forEach(({fn:s})=>{s==null||s.autoInit()}):Eg.forEach(({key:s,fn:u})=>{d.includes(s)&&(u==null||u.autoInit())})},cleanCollection(d="all"){d==="all"?Eg.forEach(({collection:s})=>{window[s]instanceof Array&&(window[s]=[])}):Eg.forEach(({key:s,collection:u})=>{d.includes(s)&&window[u]instanceof Array&&(window[u]=[])})}};typeof window<"u"&&(window.HSStaticMethods=Sk);typeof DataTable<"u"&&typeof jQuery<"u"&&require("./plugins/datatable").default;typeof _<"u"&&typeof Dropzone<"u"&&require("./plugins/file-upload").default;
